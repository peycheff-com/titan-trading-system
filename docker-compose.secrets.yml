# Optional overlay to load secrets from Docker secrets files
# Usage: docker compose -f docker-compose.prod.yml -f docker-compose.secrets.yml up -d

services:
  postgres:
    secrets:
      - titan_db_password
    environment:
      - POSTGRES_PASSWORD_FILE=/run/secrets/titan_db_password

  titan-brain:
    secrets:
      - titan_db_password
      - titan_hmac_secret
    environment:
      - TITAN_DB_PASSWORD_FILE=/run/secrets/titan_db_password
      - HMAC_SECRET_FILE=/run/secrets/titan_hmac_secret

  titan-execution:
    secrets:
      - binance_api_key
      - binance_api_secret
      - bybit_api_key
      - bybit_api_secret
    environment:
      - BINANCE_API_KEY_FILE=/run/secrets/binance_api_key
      - BINANCE_API_SECRET_FILE=/run/secrets/binance_api_secret
      - BYBIT_API_KEY_FILE=/run/secrets/bybit_api_key
      - BYBIT_API_SECRET_FILE=/run/secrets/bybit_api_secret

  titan-scavenger:
    secrets:
      - binance_api_key
      - binance_api_secret
      - bybit_api_key
      - bybit_api_secret
    environment:
      - BINANCE_API_KEY_FILE=/run/secrets/binance_api_key
      - BINANCE_API_SECRET_FILE=/run/secrets/binance_api_secret
      - BYBIT_API_KEY_FILE=/run/secrets/bybit_api_key
      - BYBIT_API_SECRET_FILE=/run/secrets/bybit_api_secret

  titan-sentinel:
    secrets:
      - binance_api_key
      - binance_api_secret
      - bybit_api_key
      - bybit_api_secret
    environment:
      - BINANCE_API_KEY_FILE=/run/secrets/binance_api_key
      - BINANCE_API_SECRET_FILE=/run/secrets/binance_api_secret
      - BYBIT_API_KEY_FILE=/run/secrets/bybit_api_key
      - BYBIT_API_SECRET_FILE=/run/secrets/bybit_api_secret

  titan-ai-quant:
    secrets:
      - gemini_api_key
    environment:
      - GEMINI_API_KEY_FILE=/run/secrets/gemini_api_key

  grafana:
    secrets:
      - grafana_admin_password
    environment:
      - GF_SECURITY_ADMIN_PASSWORD__FILE=/run/secrets/grafana_admin_password

secrets:
  titan_db_password:
    file: ./secrets/titan_db_password
  titan_hmac_secret:
    file: ./secrets/titan_hmac_secret
  binance_api_key:
    file: ./secrets/binance_api_key
  binance_api_secret:
    file: ./secrets/binance_api_secret
  bybit_api_key:
    file: ./secrets/bybit_api_key
  bybit_api_secret:
    file: ./secrets/bybit_api_secret
  gemini_api_key:
    file: ./secrets/gemini_api_key
  grafana_admin_password:
    file: ./secrets/grafana_admin_password
