
    [96mtests/unit/TitanBrain.test.ts[0m:[93m181[0m:[93m5[0m - [91merror[0m[90m TS2345: [0mArgument of type 'BrainConfig' is not assignable to parameter of type 'TitanBrainConfig'.
      Type 'BrainConfig' is missing the following properties from type 'TitanBrainConfig': brain, allocationEngine, performanceTracker, riskGuardian, and 10 more.

    [7m181[0m     brainConfig,
    [7m   [0m [91m    ~~~~~~~~~~~[0m

PASS tests/unit/CapitalFlowManager.test.ts (7.869 s)
PASS tests/services/CircuitBreaker.test.ts (7.882 s)
PASS tests/unit/NotificationService.test.ts (8.719 s)
  ‚óè Console

    console.error
      Telegram test failed: Error: Notification failed after 3 attempts: API error
          at NotificationService.retryRequest (/Users/ivan/Code/trading/titan/services/titan-brain/src/server/NotificationService.ts:336:11)
          at NotificationService.sendTelegramNotification (/Users/ivan/Code/trading/titan/services/titan-brain/src/server/NotificationService.ts:208:5)
          at NotificationService.testNotifications (/Users/ivan/Code/trading/titan/services/titan-brain/src/server/NotificationService.ts:364:9)
          at Object.<anonymous> (/Users/ivan/Code/trading/titan/services/titan-brain/tests/unit/NotificationService.test.ts:178:23)

      366 |         results.telegram = true;
      367 |       } catch (error) {
    > 368 |         console.error('Telegram test failed:', error);
          |                 ^
      369 |       }
      370 |     }
      371 |

      at NotificationService.testNotifications (src/server/NotificationService.ts:368:17)
      at Object.<anonymous> (tests/unit/NotificationService.test.ts:178:23)

(node:9946) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 21 SIGTERM listeners added to [process]. MaxListeners is 20. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:9946) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 21 SIGINT listeners added to [process]. MaxListeners is 20. Use emitter.setMaxListeners() to increase limit
(node:9946) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 21 SIGUSR2 listeners added to [process]. MaxListeners is 20. Use emitter.setMaxListeners() to increase limit
(node:9946) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 21 uncaughtException listeners added to [process]. MaxListeners is 20. Use emitter.setMaxListeners() to increase limit
(node:9946) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 21 unhandledRejection listeners added to [process]. MaxListeners is 20. Use emitter.setMaxListeners() to increase limit
PASS tests/startup/StartupManager.test.ts (19.79 s)
A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.

Summary of all failing tests
FAIL tests/server/ExecutionEngineClient.test.ts
  ‚óè ExecutionEngineClient ‚Ä∫ closeAllPositions ‚Ä∫ should include t_signal and required fields on emergency publish

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

      143 |       await client.closeAllPositions();
      144 |
    > 145 |       expect(mockPublishEnvelope).toHaveBeenCalledTimes(1);
          |                                   ^
      146 |       const [subject, payload] = mockPublishEnvelope.mock.calls[0];
      147 |
      148 |       expect(subject).toBe("titan.cmd.exec.place.v1.auto.main.ALL");

      at Object.<anonymous> (tests/server/ExecutionEngineClient.test.ts:145:35)

FAIL tests/unit/TitanBrain.test.ts
  ‚óè Test suite failed to run

    [96mtests/unit/TitanBrain.test.ts[0m:[93m181[0m:[93m5[0m - [91merror[0m[90m TS2345: [0mArgument of type 'BrainConfig' is not assignable to parameter of type 'TitanBrainConfig'.
      Type 'BrainConfig' is missing the following properties from type 'TitanBrainConfig': brain, allocationEngine, performanceTracker, riskGuardian, and 10 more.

    [7m181[0m     brainConfig,
    [7m   [0m [91m    ~~~~~~~~~~~[0m


Test Suites: 2 failed, 60 passed, 62 total
Tests:       1 failed, 2 skipped, 861 passed, 864 total
Snapshots:   0 total
Time:        20.575 s, estimated 22 s
Ran all test suites.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/ivan/Code/trading/titan/services/titan-brain
npm error workspace titan-brain@1.0.0
npm error location /Users/ivan/Code/trading/titan/services/titan-brain
npm error command failed
npm error command sh -c npm run test:unit --silent
