<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://titan.internal/system-source-of-truth/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.13"><title>Titan Trading System: Canonical Source of Truth - Titan Trading System</title><link rel=stylesheet href=../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#titan-trading-system-canonical-source-of-truth class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Titan Trading System" class="md-header__button md-logo" aria-label="Titan Trading System" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Titan Trading System </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Titan Trading System: Canonical Source of Truth </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/peycheff-com/titan-trading-system title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> peycheff-com/titan-trading-system </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../START_HERE.md class=md-tabs__link> Start Here </a> </li> <li class=md-tabs__item> <a href=../tutorials/index.md class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../how-to/index.md class=md-tabs__link> How-To Guides </a> </li> <li class=md-tabs__item> <a href=../reference/index.md class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../explanation/index.md class=md-tabs__link> Explanation </a> </li> <li class=md-tabs__item> <a href=../security/secrets-management.md class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../DOCS_AUDIT_REPORT.md class=md-tabs__link> Audit Reports </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Titan Trading System" class="md-nav__button md-logo" aria-label="Titan Trading System" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Titan Trading System </label> <div class=md-nav__source> <a href=https://github.com/peycheff-com/titan-trading-system title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> peycheff-com/titan-trading-system </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../START_HERE.md class=md-nav__link> <span class=md-ellipsis> Start Here </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tutorials/index.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> How-To Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> How-To Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../how-to/index.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../how-to/deploy-production.md class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../security/secrets-management.md class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Runbooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Runbooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../runbooks/incident_response/ class=md-nav__link> <span class=md-ellipsis> Incident Response Protocol </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/index.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../canonical/SYSTEM_SOURCE_OF_TRUTH.md class=md-nav__link> <span class=md-ellipsis> Canonical Truth </span> </a> </li> <li class=md-nav__item> <a href=../api/README.md class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Explanation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Explanation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../explanation/index.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../explanation/architecture_overview.md class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../explanation/ha-strategy/ class=md-nav__link> <span class=md-ellipsis> HA Strategy </span> </a> </li> <li class=md-nav__item> <a href=../explanation/execution-routing/ class=md-nav__link> <span class=md-ellipsis> Execution Routing </span> </a> </li> <li class=md-nav__item> <a href=../explanation/ci-quality-gates.md class=md-nav__link> <span class=md-ellipsis> CI Gates </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../security/secrets-management.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Audit Reports </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Audit Reports </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../DOCS_AUDIT_REPORT.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-canonical-header class=md-nav__link> <span class=md-ellipsis> 1. Canonical Header </span> </a> </li> <li class=md-nav__item> <a href=#2-system-invariants-non-negotiables class=md-nav__link> <span class=md-ellipsis> 2. System Invariants (Non-negotiables) </span> </a> </li> <li class=md-nav__item> <a href=#3-organism-topology class=md-nav__link> <span class=md-ellipsis> 3. Organism Topology </span> </a> <nav class=md-nav aria-label="3. Organism Topology"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-service-inventory class=md-nav__link> <span class=md-ellipsis> 3.1 Service Inventory </span> </a> </li> <li class=md-nav__item> <a href=#32-infrastructure-services-docker-composeprodyml class=md-nav__link> <span class=md-ellipsis> 3.2 Infrastructure Services (docker-compose.prod.yml) </span> </a> </li> <li class=md-nav__item> <a href=#33-signal-flow-diagram class=md-nav__link> <span class=md-ellipsis> 3.3 Signal Flow Diagram </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-build-boot-truth-graph class=md-nav__link> <span class=md-ellipsis> 4. Build &amp; Boot Truth Graph </span> </a> <nav class=md-nav aria-label="4. Build & Boot Truth Graph"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-monorepo-structure class=md-nav__link> <span class=md-ellipsis> 4.1 Monorepo Structure </span> </a> </li> <li class=md-nav__item> <a href=#42-build-commands class=md-nav__link> <span class=md-ellipsis> 4.2 Build Commands </span> </a> </li> <li class=md-nav__item> <a href=#43-dev-vs-prod-boot class=md-nav__link> <span class=md-ellipsis> 4.3 Dev vs Prod Boot </span> </a> </li> <li class=md-nav__item> <a href=#44-ci-pipeline-7-jobs class=md-nav__link> <span class=md-ellipsis> 4.4 CI Pipeline (7 Jobs) </span> </a> </li> <li class=md-nav__item> <a href=#45-live-vs-dead-scripts class=md-nav__link> <span class=md-ellipsis> 4.5 Live vs Dead Scripts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-configuration-canon class=md-nav__link> <span class=md-ellipsis> 5. Configuration Canon </span> </a> <nav class=md-nav aria-label="5. Configuration Canon"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-environment-variables-critical class=md-nav__link> <span class=md-ellipsis> 5.1 Environment Variables (Critical) </span> </a> </li> <li class=md-nav__item> <a href=#52-configuration-files class=md-nav__link> <span class=md-ellipsis> 5.2 Configuration Files </span> </a> </li> <li class=md-nav__item> <a href=#53-single-source-of-truth-per-domain class=md-nav__link> <span class=md-ellipsis> 5.3 Single Source of Truth per Domain </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-event-bus-canon-nats-jetstream class=md-nav__link> <span class=md-ellipsis> 6. Event Bus Canon (NATS JetStream) </span> </a> <nav class=md-nav aria-label="6. Event Bus Canon (NATS JetStream)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-stream-definitions class=md-nav__link> <span class=md-ellipsis> 6.1 Stream Definitions </span> </a> </li> <li class=md-nav__item> <a href=#62-subject-namespace-map class=md-nav__link> <span class=md-ellipsis> 6.2 Subject Namespace Map </span> </a> </li> <li class=md-nav__item> <a href=#63-nats-acl-matrix class=md-nav__link> <span class=md-ellipsis> 6.3 NATS ACL Matrix </span> </a> </li> <li class=md-nav__item> <a href=#64-message-envelope-schema class=md-nav__link> <span class=md-ellipsis> 6.4 Message Envelope Schema </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-data-truth-postgresql class=md-nav__link> <span class=md-ellipsis> 7. Data Truth (PostgreSQL) </span> </a> <nav class=md-nav aria-label="7. Data Truth (PostgreSQL)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-table-ownership class=md-nav__link> <span class=md-ellipsis> 7.1 Table Ownership </span> </a> </li> <li class=md-nav__item> <a href=#72-migration-system class=md-nav__link> <span class=md-ellipsis> 7.2 Migration System </span> </a> </li> <li class=md-nav__item> <a href=#73-migrations class=md-nav__link> <span class=md-ellipsis> 7.3 Migrations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-risk-immune-system class=md-nav__link> <span class=md-ellipsis> 8. Risk Immune System </span> </a> <nav class=md-nav aria-label="8. Risk Immune System"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-canonical-risk-policy class=md-nav__link> <span class=md-ellipsis> 8.1 Canonical Risk Policy </span> </a> </li> <li class=md-nav__item> <a href=#82-policy-enforcement-points class=md-nav__link> <span class=md-ellipsis> 8.2 Policy Enforcement Points </span> </a> </li> <li class=md-nav__item> <a href=#83-circuit-breaker-states class=md-nav__link> <span class=md-ellipsis> 8.3 Circuit Breaker States </span> </a> </li> <li class=md-nav__item> <a href=#84-kill-switches class=md-nav__link> <span class=md-ellipsis> 8.4 Kill Switches </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-execution-boundary-and-order-lifecycle class=md-nav__link> <span class=md-ellipsis> 9. Execution Boundary and Order Lifecycle </span> </a> <nav class=md-nav aria-label="9. Execution Boundary and Order Lifecycle"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-boundary-contract class=md-nav__link> <span class=md-ellipsis> 9.1 Boundary Contract </span> </a> </li> <li class=md-nav__item> <a href=#92-allowed-vs-forbidden-channels class=md-nav__link> <span class=md-ellipsis> 9.2 Allowed vs Forbidden Channels </span> </a> </li> <li class=md-nav__item> <a href=#93-order-lifecycle class=md-nav__link> <span class=md-ellipsis> 9.3 Order Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=#94-idempotency-rules class=md-nav__link> <span class=md-ellipsis> 9.4 Idempotency Rules </span> </a> </li> <li class=md-nav__item> <a href=#95-truth-layer-definition class=md-nav__link> <span class=md-ellipsis> 9.5 Truth Layer Definition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-observability-and-operability class=md-nav__link> <span class=md-ellipsis> 10. Observability and Operability </span> </a> <nav class=md-nav aria-label="10. Observability and Operability"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#101-health-endpoints class=md-nav__link> <span class=md-ellipsis> 10.1 Health Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#nats-subjects-auto-generated class=md-nav__link> <span class=md-ellipsis> NATS Subjects (Auto-Generated) </span> </a> </li> <li class=md-nav__item> <a href=#jetstream-streams class=md-nav__link> <span class=md-ellipsis> JetStream Streams </span> </a> </li> <li class=md-nav__item> <a href=#102-metrics-endpoints class=md-nav__link> <span class=md-ellipsis> 10.2 Metrics Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#103-critical-metrics class=md-nav__link> <span class=md-ellipsis> 10.3 Critical Metrics </span> </a> </li> <li class=md-nav__item> <a href=#104-log-correlation class=md-nav__link> <span class=md-ellipsis> 10.4 Log Correlation </span> </a> </li> <li class=md-nav__item> <a href=#105-tracing class=md-nav__link> <span class=md-ellipsis> 10.5 Tracing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#11-security-canon class=md-nav__link> <span class=md-ellipsis> 11. Security Canon </span> </a> <nav class=md-nav aria-label="11. Security Canon"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#111-hmac-signing-boundaries class=md-nav__link> <span class=md-ellipsis> 11.1 HMAC Signing Boundaries </span> </a> </li> <li class=md-nav__item> <a href=#112-fail-closed-behavior class=md-nav__link> <span class=md-ellipsis> 11.2 Fail-Closed Behavior </span> </a> </li> <li class=md-nav__item> <a href=#113-secret-handling class=md-nav__link> <span class=md-ellipsis> 11.3 Secret Handling </span> </a> </li> <li class=md-nav__item> <a href=#114-rate-limiting class=md-nav__link> <span class=md-ellipsis> 11.4 Rate Limiting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#12-contradictions-and-dual-truth-findings class=md-nav__link> <span class=md-ellipsis> 12. Contradictions and Dual Truth Findings </span> </a> </li> <li class=md-nav__item> <a href=#13-deadlegacyunused-inventory class=md-nav__link> <span class=md-ellipsis> 13. Dead/Legacy/Unused Inventory </span> </a> <nav class=md-nav aria-label="13. Dead/Legacy/Unused Inventory"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#131-detected-by-knip-analysis class=md-nav__link> <span class=md-ellipsis> 13.1 Detected by Knip Analysis </span> </a> </li> <li class=md-nav__item> <a href=#132-legacy-services class=md-nav__link> <span class=md-ellipsis> 13.2 Legacy Services </span> </a> </li> <li class=md-nav__item> <a href=#133-legacy-nats-subjects class=md-nav__link> <span class=md-ellipsis> 13.3 Legacy NATS Subjects </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#14-canonical-artifacts-and-hash-ledger class=md-nav__link> <span class=md-ellipsis> 14. Canonical Artifacts and Hash Ledger </span> </a> <nav class=md-nav aria-label="14. Canonical Artifacts and Hash Ledger"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#141-critical-artifacts-sha256 class=md-nav__link> <span class=md-ellipsis> 14.1 Critical Artifacts (SHA256) </span> </a> </li> <li class=md-nav__item> <a href=#142-hash-computation-command class=md-nav__link> <span class=md-ellipsis> 14.2 Hash Computation Command </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#15-closure-tasks class=md-nav__link> <span class=md-ellipsis> 15. Closure Tasks </span> </a> </li> <li class=md-nav__item> <a href=#16-mandatory-command-evidence class=md-nav__link> <span class=md-ellipsis> 16. Mandatory Command Evidence </span> </a> <nav class=md-nav aria-label="16. Mandatory Command Evidence"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#161-git-rev-parse-head class=md-nav__link> <span class=md-ellipsis> 16.1 git rev-parse HEAD </span> </a> </li> <li class=md-nav__item> <a href=#162-git-status-porcelain class=md-nav__link> <span class=md-ellipsis> 16.2 git status --porcelain </span> </a> </li> <li class=md-nav__item> <a href=#163-npm-run-script-inventory class=md-nav__link> <span class=md-ellipsis> 16.3 npm run (script inventory) </span> </a> </li> <li class=md-nav__item> <a href=#164-docker-compose-config class=md-nav__link> <span class=md-ellipsis> 16.4 docker compose config </span> </a> </li> <li class=md-nav__item> <a href=#165-cargo-metadata class=md-nav__link> <span class=md-ellipsis> 16.5 cargo metadata </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#document-verification class=md-nav__link> <span class=md-ellipsis> Document Verification </span> </a> </li> <li class=md-nav__item> <a href=#106-reconciliation-truth-convergence class=md-nav__link> <span class=md-ellipsis> 10.6 Reconciliation &amp; Truth Convergence </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=titan-trading-system-canonical-source-of-truth>Titan Trading System: Canonical Source of Truth</h1> <blockquote> <p>[!IMPORTANT] This document is the <strong>single, authoritative source of truth</strong> for the Titan Trading System. All statements are derived from repository artifacts at the commit hash specified below. Any discrepancy between this document and reality should be resolved in favor of the repository's physical state. <strong>Any conflicting doc is non-authoritative.</strong></p> </blockquote> <hr> <h2 id=1-canonical-header>1. Canonical Header</h2> <blockquote> <p><strong>Context Map</strong>: See <a href=../knowledge-graph/ >Knowledge Graph</a> and <a href=../ai-readme/ >AI Agent Instructions</a>.</p> </blockquote> <table> <thead> <tr> <th>Field</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><strong>Repository Name</strong></td> <td><code>titan</code> (peycheff-com/titan-trading-system)</td> </tr> <tr> <td><strong>Default Branch</strong></td> <td><code>main</code></td> </tr> <tr> <td><strong>Commit Hash</strong></td> <td><code>a77c842f9af7953cec76954d6d2696cf4ac7ca0d</code></td> </tr> <tr> <td><strong>Generation Timestamp</strong></td> <td>2026-02-10T20:02:00Z</td> </tr> <tr> <td><strong>Node.js Version</strong></td> <td>v22.19.0</td> </tr> <tr> <td><strong>NPM Version</strong></td> <td>11.6.2</td> </tr> <tr> <td><strong>Rust Toolchain</strong></td> <td>rustc 1.89.0 (29483883e 2025-08-04)</td> </tr> <tr> <td><strong>Cargo Version</strong></td> <td>1.89.0 (c24e10642 2025-06-23)</td> </tr> <tr> <td><strong>Document SHA256</strong></td> <td>Compute via: <code>shasum -a 256 docs/system-source-of-truth.md</code></td> </tr> </tbody> </table> <hr> <h2 id=2-system-invariants-non-negotiables>2. System Invariants (Non-negotiables)</h2> <p>These are the <strong>inviolable rules</strong> governing the Titan system. Each invariant is backed by <strong>symbol-based evidence</strong> (not line numbers) for resilience to refactoring.</p> <blockquote> <p>[!NOTE] Evidence references use symbol names to survive code changes. Verify via: <code>grep -r "SymbolName" path/to/file</code></p> </blockquote> <table> <thead> <tr> <th>ID</th> <th>Invariant</th> <th>Evidence (Symbol-Based)</th> </tr> </thead> <tbody> <tr> <td>I-01</td> <td>All trading signals MUST be mediated through Titan Brain before reaching Execution</td> <td><code>ExecutionPipeline.process_intent()</code> in <code>nats_engine.rs</code></td> </tr> <tr> <td>I-02</td> <td>HMAC_SECRET is <strong>fail-closed</strong>: empty secret = <code>panic!</code> in production</td> <td><code>HmacValidator::new()</code> panic block in <code>security.rs</code></td> </tr> <tr> <td>I-03</td> <td>Risk Policy hash MUST match between TypeScript and Rust at boot</td> <td><code>RiskPolicy.computeHash()</code> in TS, <code>RiskPolicy::get_hash()</code> in Rust</td> </tr> <tr> <td>I-04</td> <td>Symbol whitelist is the sole source of tradeable pairs</td> <td><code>symbolWhitelist</code> field in <code>packages/shared/risk_policy.json</code></td> </tr> <tr> <td>I-05</td> <td>All phase services (Scavenger, Hunter, Sentinel) require Brain approval before execution</td> <td><code>publish</code> ACLs in <code>config/nats.conf</code> (titan.cmd.* subjects)</td> </tr> <tr> <td>I-06</td> <td>Circuit breaker activation is final until operator ARM command with HMAC signature</td> <td><code>GlobalHaltState.set_halt()</code> + <code>validate_risk_command()</code> in <code>security.rs</code></td> </tr> <tr> <td>I-07</td> <td>Execution engine only processes intents from <code>titan.cmd.execution.&gt;</code> subjects</td> <td>Consumer <code>EXECUTION_CORE</code> filter in <code>nats_engine.rs</code></td> </tr> <tr> <td>I-08</td> <td>JetStream streams are authoritative for event persistence (<code>TITAN_CMD</code>, <code>TITAN_EVT</code>)</td> <td>Stream init in <code>NatsClient.ensureJetStreamResources()</code> (TS) and <code>nats_engine.rs</code></td> </tr> <tr> <td>I-09</td> <td>Envelope signatures require <code>ts</code>, <code>nonce</code>, and <code>sig</code> fields; missing any = rejection</td> <td><code>HmacValidator::validate()</code> field checks in <code>security.rs</code></td> </tr> <tr> <td>I-10</td> <td>Timestamp drift tolerance is 5 minutes (300,000ms) by default</td> <td><code>HMAC_TIMESTAMP_TOLERANCE</code> env var parsed in <code>HmacValidator::new()</code></td> </tr> <tr> <td>I-11</td> <td>Rate limiting enforced via TokenBucket in Rust (default 10 RPS for Bybit)</td> <td><code>struct TokenBucket</code> in <code>rate_limiter.rs</code></td> </tr> <tr> <td>I-12</td> <td>RiskGuard is final veto before order submission; it evaluates policy + shadow state</td> <td><code>RiskGuard::evaluate()</code> in <code>risk_guard.rs</code></td> </tr> <tr> <td>I-13</td> <td>NATS users have granular publish/subscribe ACLs preventing cross-service impersonation</td> <td><code>authorization { users [ ... ] }</code> block in <code>config/nats.conf</code></td> </tr> <tr> <td>I-14</td> <td>Database tables use Row Level Security (RLS) enabled by default</td> <td><code>ALTER TABLE ... ENABLE ROW LEVEL SECURITY</code> in <code>schema.sql</code></td> </tr> <tr> <td>I-15</td> <td><code>fills</code> and <code>event_log</code> tables are partitioned by month for performance and retention</td> <td><code>PARTITION BY RANGE</code> in <code>schema.sql</code> table definitions</td> </tr> <tr> <td>I-16</td> <td>Circuit breaker states are: Normal → Cautious → Defensive → Emergency</td> <td><code>pub enum RiskState</code> in <code>risk_policy.rs</code></td> </tr> <tr> <td>I-17</td> <td>All services must expose <code>/health</code> endpoint for orchestration health checks</td> <td><code>healthcheck</code> directives in <code>docker-compose.prod.yml</code></td> </tr> <tr> <td>I-18</td> <td>Phase services broadcast state via <code>titan.evt.phase.*</code> subjects</td> <td><code>publish: ["titan.evt.phase.*"]</code> ACLs in <code>config/nats.conf</code></td> </tr> <tr> <td>I-19</td> <td>DLQ (Dead Letter Queue) exists at <code>titan.dlq.execution.core</code></td> <td><code>DLQ_EXECUTION_CORE</code> constant in <code>subjects.rs</code></td> </tr> <tr> <td>I-20</td> <td>Risk policy embedded at Rust compile time via <code>include_str!</code></td> <td><code>const RISK_POLICY_JSON: &amp;str = include_str!()</code> in <code>risk_policy.rs</code></td> </tr> </tbody> </table> <hr> <h2 id=3-organism-topology>3. Organism Topology</h2> <h3 id=31-service-inventory>3.1 Service Inventory</h3> <table> <thead> <tr> <th>Service</th> <th>Language</th> <th>Port</th> <th>Entrypoint</th> <th>Dockerfile</th> </tr> </thead> <tbody> <tr> <td><strong>titan-brain</strong></td> <td>TypeScript</td> <td>3100</td> <td><code>services/titan-brain/src/index.ts</code></td> <td><code>services/titan-brain/Dockerfile</code></td> </tr> <tr> <td><strong>titan-execution-rs</strong></td> <td>Rust</td> <td>3002</td> <td><code>services/titan-execution-rs/src/main.rs</code></td> <td><code>services/titan-execution-rs/Dockerfile</code></td> </tr> <tr> <td><strong>titan-phase1-scavenger</strong></td> <td>TypeScript</td> <td>8081</td> <td><code>services/titan-phase1-scavenger/src/index.tsx</code></td> <td><code>services/titan-phase1-scavenger/Dockerfile</code></td> </tr> <tr> <td><strong>titan-phase2-hunter</strong></td> <td>TypeScript</td> <td>8083</td> <td><code>services/titan-phase2-hunter/src/index.ts</code></td> <td><code>services/titan-phase2-hunter/Dockerfile</code></td> </tr> <tr> <td><strong>titan-phase3-sentinel</strong></td> <td>TypeScript</td> <td>8084</td> <td><code>services/titan-phase3-sentinel/src/index.tsx</code></td> <td><code>services/titan-phase3-sentinel/Dockerfile</code></td> </tr> <tr> <td><strong>titan-ai-quant</strong></td> <td>TypeScript</td> <td>8082</td> <td><code>services/titan-ai-quant/src/index.ts</code> (lib)</td> <td><code>services/titan-ai-quant/Dockerfile</code></td> </tr> <tr> <td><strong>titan-powerlaw-lab</strong></td> <td>TypeScript</td> <td>-</td> <td><code>services/titan-powerlaw-lab/src/main.ts</code></td> <td><code>services/titan-powerlaw-lab/Dockerfile</code></td> </tr> <tr> <td><strong>titan-console</strong></td> <td>React/Vite</td> <td>3001</td> <td><code>apps/titan-console/</code></td> <td><code>apps/titan-console/Dockerfile</code></td> </tr> </tbody> </table> <h3 id=32-infrastructure-services-docker-composeprodyml>3.2 Infrastructure Services (docker-compose.prod.yml)</h3> <table> <thead> <tr> <th>Service</th> <th>Image</th> <th>Port(s)</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><code>traefik</code></td> <td>traefik:v3.0</td> <td>80, 443</td> <td>Reverse proxy, TLS termination</td> </tr> <tr> <td><code>nats</code></td> <td>nats:2.10.22-alpine</td> <td>4222, 8222</td> <td>Event bus, JetStream persistence</td> </tr> <tr> <td><code>postgres</code></td> <td>postgres:16-alpine</td> <td>5432</td> <td>Primary truth ledger</td> </tr> <tr> <td><code>redis</code></td> <td>redis:alpine</td> <td>6379</td> <td>Idempotency cache, distributed state</td> </tr> <tr> <td><code>prometheus</code></td> <td>prom/prometheus</td> <td>9090</td> <td>Metrics collection</td> </tr> <tr> <td><code>grafana</code></td> <td>grafana/grafana</td> <td>3000</td> <td>Observability dashboards</td> </tr> <tr> <td><code>titan-tempo</code></td> <td>grafana/tempo</td> <td>3200, 4317</td> <td>Distributed tracing (4317=OTLP/gRPC)</td> </tr> </tbody> </table> <h3 id=33-signal-flow-diagram>3.3 Signal Flow Diagram</h3> <pre class=mermaid><code>graph TD
    subgraph "Strategy Layer"
        S1["Phase 1: Scavenger&lt;br/&gt;(Port 8081)"]
        S2["Phase 2: Hunter&lt;br/&gt;(Port 8083)"]
        S3["Phase 3: Sentinel&lt;br/&gt;(Port 8084)"]
    end

    subgraph "Orchestration Layer"
        B["Titan Brain&lt;br/&gt;(Port 3100)"]
    end

    subgraph "Execution Layer"
        E["Titan Execution-RS&lt;br/&gt;(Port 3002)"]
    end

    subgraph "External"
        EX["Exchange APIs&lt;br/&gt;(Bybit/Binance)"]
    end

    S1 --&gt;|"titan.evt.phase.*"| N["NATS JetStream"]
    S2 --&gt;|"titan.evt.phase.*"| N
    S3 --&gt;|"titan.evt.phase.*"| N
    N --&gt;|Events| B
     B --&gt;|"titan.cmd.execute.&gt;"| N
    N --&gt;|Commands| E
    E --&gt;|"titan.evt.execution.fill.v1"| N
    E --&gt;|REST/WS| EX</code></pre> <hr> <h2 id=4-build-boot-truth-graph>4. Build &amp; Boot Truth Graph</h2> <h3 id=41-monorepo-structure>4.1 Monorepo Structure</h3> <div class=highlight><pre><span></span><code>titan/
├── apps/
│   └── titan-console/          # React/Vite frontend
├── packages/
│   └── shared/                 # @titan/shared (schemas, messaging, config)
└── services/
    ├── titan-brain/            # TypeScript orchestrator
    ├── titan-execution-rs/     # Rust execution engine
    ├── titan-phase1-scavenger/ # Phase 1 strategy
    ├── titan-phase2-hunter/    # Phase 2 strategy
    ├── titan-phase3-sentinel/  # Phase 3 strategy
    ├── titan-ai-quant/         # AI optimization library
    └── titan-powerlaw-lab/     # Power law analysis
</code></pre></div> <h3 id=42-build-commands>4.2 Build Commands</h3> <table> <thead> <tr> <th>Command</th> <th>Purpose</th> <th>Evidence</th> </tr> </thead> <tbody> <tr> <td><code>npm run build</code></td> <td>Build all TS services via Turbo + provenance</td> <td><code>package.json:32</code></td> </tr> <tr> <td><code>npm run start:brain</code></td> <td>Start Brain service</td> <td><code>package.json:13</code></td> </tr> <tr> <td><code>npm run start:execution</code></td> <td>Build + run Rust execution (release)</td> <td><code>package.json:14</code></td> </tr> <tr> <td><code>npm run start:prod</code></td> <td>Production startup script</td> <td><code>package.json:22</code> → <code>scrip../start_production.sh</code></td> </tr> <tr> <td><code>cargo build --release</code></td> <td>Production Rust binary</td> <td><code>services/titan-execution-rs/Cargo.toml</code></td> </tr> </tbody> </table> <h3 id=43-dev-vs-prod-boot>4.3 Dev vs Prod Boot</h3> <p><strong>Development:</strong></p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>nats<span class=w> </span>postgres<span class=w> </span>redis
npm<span class=w> </span>run<span class=w> </span>start:brain
npm<span class=w> </span>run<span class=w> </span>start:execution
npm<span class=w> </span>run<span class=w> </span>start:console
</code></pre></div> <p><strong>Production:</strong></p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.prod.yml<span class=w> </span>up<span class=w> </span>-d
<span class=c1># OR</span>
npm<span class=w> </span>run<span class=w> </span>start:prod<span class=w>  </span><span class=c1># Runs scrip../start_production.sh</span>
</code></pre></div> <h3 id=44-ci-pipeline-7-jobs>4.4 CI Pipeline (7 Jobs)</h3> <table> <thead> <tr> <th>Job</th> <th>Description</th> <th>Status</th> <th>Evidence</th> </tr> </thead> <tbody> <tr> <td><code>config-validation</code></td> <td>Validates configuration schemas</td> <td>Required</td> <td><code>.github/workflows/ci.yml:13-31</code></td> </tr> <tr> <td><code>sota-checks</code></td> <td>Zombie deps, circular deps, immutability, knip</td> <td>Required</td> <td><code>.github/workflows/ci.yml:36-78</code></td> </tr> <tr> <td><code>security-scan</code></td> <td>NPM audit, cargo audit, SBOM generation</td> <td>Required</td> <td><code>.github/workflows/ci.yml:83-137</code></td> </tr> <tr> <td><code>contract-check</code></td> <td>Schema drift detection</td> <td>Required</td> <td><code>.github/workflows/ci.yml:142-157</code></td> </tr> <tr> <td><code>node-services</code></td> <td>Lint, test, build for 7 TS services</td> <td>Required</td> <td><code>.github/workflows/ci.yml:162-213</code></td> </tr> <tr> <td><code>rust-services</code></td> <td>fmt, clippy, test, build for execution-rs</td> <td>Required</td> <td><code>.github/workflows/ci.yml:218-265</code></td> </tr> <tr> <td><code>status-check</code></td> <td>Final gate aggregation</td> <td>Required</td> <td><code>.github/workflows/ci.yml:270-289</code></td> </tr> <tr> <td><code>deploy-production</code></td> <td>VPS Deployment Strategy (Blue/Green-ish)</td> <td>CD Only</td> <td><code>.github/workflows/deploy-prod.yml</code></td> </tr> </tbody> </table> <h3 id=45-live-vs-dead-scripts>4.5 Live vs Dead Scripts</h3> <table> <thead> <tr> <th>Script Category</th> <th>Examples</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><strong>Live</strong></td> <td><code>sota:*</code>, <code>start:*</code>, <code>build</code>, <code>test</code>, <code>lint</code></td> <td>Active</td> </tr> <tr> <td><strong>Deprecated</strong></td> <td>None identified</td> <td>-</td> </tr> </tbody> </table> <hr> <h2 id=5-configuration-canon>5. Configuration Canon</h2> <h3 id=51-environment-variables-critical>5.1 Environment Variables (Critical)</h3> <table> <thead> <tr> <th>Variable</th> <th>Required</th> <th>Purpose</th> <th>Source</th> </tr> </thead> <tbody> <tr> <td><code>HMAC_SECRET</code></td> <td><strong>Yes</strong></td> <td>Command signing (fail-closed)</td> <td><code>.env</code> / Vault</td> </tr> <tr> <td><code>TITAN_MASTER_PASSWORD</code></td> <td><strong>Yes</strong></td> <td>Operator authentication</td> <td><code>.env</code> / Vault</td> </tr> <tr> <td><code>DATABASE_URL</code></td> <td><strong>Yes</strong></td> <td>Postgres connection string</td> <td><code>.env</code></td> </tr> <tr> <td><code>NATS_URL</code></td> <td><strong>Yes</strong></td> <td>NATS server address</td> <td><code>.env</code></td> </tr> <tr> <td><code>NATS_USER</code></td> <td><strong>Yes</strong></td> <td>NATS authentication</td> <td><code>.env</code></td> </tr> <tr> <td><code>NATS_PASS</code></td> <td><strong>Yes</strong></td> <td>NATS authentication</td> <td><code>.env</code></td> </tr> <tr> <td><code>BYBIT_API_KEY</code></td> <td><strong>Yes</strong></td> <td>Exchange credentials</td> <td><code>.env</code> / Vault</td> </tr> <tr> <td><code>BYBIT_API_SECRET</code></td> <td><strong>Yes</strong></td> <td>Exchange credentials</td> <td><code>.env</code> / Vault</td> </tr> <tr> <td><code>BINANCE_API_KEY</code></td> <td>Trade</td> <td>Exchange credentials (optional)</td> <td><code>.env</code></td> </tr> <tr> <td><code>REDIS_URL</code></td> <td><strong>Yes</strong></td> <td>Redis for idempotency</td> <td><code>.env</code></td> </tr> </tbody> </table> <p><strong>Evidence:</strong> <code>.env.example:1-177</code></p> <h3 id=52-configuration-files>5.2 Configuration Files</h3> <table> <thead> <tr> <th>File</th> <th>Purpose</th> <th>Hash (SHA256)</th> </tr> </thead> <tbody> <tr> <td><code>docker-compose.prod.yml</code></td> <td>Production orchestration</td> <td><code>f5957a020975044ad2500e8c88d62fffc5e92fef8d30a7cc4e9e65fbebf33701</code></td> </tr> <tr> <td><code>docker-compose.yml</code></td> <td>Development orchestration</td> <td><code>4e002c4d03e329539fba06b6fb41b27337150f5091f003b4e94f792495f9ce93</code></td> </tr> <tr> <td><code>packages/shared/risk_policy.json</code></td> <td>Canonical risk policy</td> <td><code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code></td> </tr> <tr> <td><code>config/nats.conf</code></td> <td>NATS server + ACL configuration</td> <td><code>42b0a657e815a911688710bfa9776eeb4bc7215c635d99bf787c5e3851b74971</code></td> </tr> <tr> <td><code>services/titan-brain/src/db/schema.sql</code></td> <td>Database schema</td> <td><code>aa1b8369ecb230b1a1809f52c482f6f48a734df4393dc4ce74c474259bfe0bd0</code></td> </tr> </tbody> </table> <h3 id=53-single-source-of-truth-per-domain>5.3 Single Source of Truth per Domain</h3> <table> <thead> <tr> <th>Domain</th> <th>Source</th> <th>Loaded By</th> </tr> </thead> <tbody> <tr> <td>Risk Policy</td> <td><code>packages/shared/risk_policy.json</code></td> <td>TS: Zod parse, Rust: <code>include_str!</code></td> </tr> <tr> <td>NATS Subjects</td> <td><code>packages/shared/src/messaging/powerlaw_subjects.ts</code></td> <td>All services import</td> </tr> <tr> <td>Fee Schedule</td> <td><code>packages/shared/fee_schedule.json</code></td> <td>Brain, Execution</td> </tr> <tr> <td>Database Schema</td> <td><code>services/titan-brain/src/db/schema.sql</code></td> <td>Brain migrations</td> </tr> <tr> <td>Exchange Credentials</td> <td><code>.env</code> / Vault</td> <td>All services via <code>loadSecretsFromFiles()</code></td> </tr> </tbody> </table> <hr> <h2 id=6-event-bus-canon-nats-jetstream>6. Event Bus Canon (NATS JetStream)</h2> <h3 id=61-stream-definitions>6.1 Stream Definitions</h3> <table> <thead> <tr> <th>Stream Name</th> <th>Subjects</th> <th>Retention</th> <th>Evidence</th> </tr> </thead> <tbody> <tr> <td><code>TITAN_COMMANDS</code></td> <td><code>titan.cmd.&gt;</code></td> <td>WorkQueue</td> <td><code>packages/shared/src/messaging/NatsClient.ts:175-183</code></td> </tr> <tr> <td><code>TITAN_EVENTS</code></td> <td><code>titan.evt.&gt;</code></td> <td><strong>Limits</strong></td> <td><code>packages/shared/src/messaging/NatsClient.ts:184-191</code></td> </tr> <tr> <td><code>TITAN_DATA</code></td> <td><code>titan.data.&gt;</code></td> <td><strong>Limits</strong></td> <td><code>packages/shared/src/messaging/NatsClient.ts:192-197</code></td> </tr> <tr> <td><code>TITAN_SIGNALS</code></td> <td><code>titan.signal.&gt;</code></td> <td>Limits</td> <td><strong>DEPRECATED</strong> — No longer initialized in code. Scheduled for removal.</td> </tr> </tbody> </table> <blockquote> <p>[!NOTE] Additional connectivity-layer streams (<code>TITAN_VENUE_STATUS</code>, <code>TITAN_MARKET_TRADES</code>) are defined in <a href=../connectivity/nats-topology/ >connectivity/nats-topology.md</a>.</p> </blockquote> <h3 id=62-subject-namespace-map>6.2 Subject Namespace Map</h3> <table> <thead> <tr> <th>Subject Pattern</th> <th>Publisher(s)</th> <th>Subscriber(s)</th> <th>Type</th> <th>Payload Schema</th> </tr> </thead> <tbody> <tr> <td><code>titan.cmd.execution.place.v1.&gt;</code></td> <td>Brain</td> <td>Execution</td> <td>Command</td> <td><code>IntentEnvelope</code></td> </tr> <tr> <td><code>titan.evt.execution.fill.v1</code></td> <td>Execution</td> <td>Brain, Console</td> <td>Event</td> <td><code>FillEvent</code></td> </tr> <tr> <td><code>titan.evt.scavenger.signal.v1</code></td> <td>Scavenger</td> <td>Brain</td> <td>Signal</td> <td><code>PhaseDiagnostics</code></td> </tr> <tr> <td><code>titan.evt.hunter.&gt;</code></td> <td>Hunter</td> <td>Brain</td> <td>Signal</td> <td><code>IntentSignal</code></td> </tr> <tr> <td><code>titan.evt.sentinel.&gt;</code></td> <td>Sentinel</td> <td>Brain</td> <td>Signal</td> <td><code>ArbitrageSignal</code></td> </tr> <tr> <td><code>titan.evt.phase.*</code></td> <td>All phases</td> <td>Brain</td> <td>Telemetry</td> <td><code>PhasePosture</code></td> </tr> <tr> <td><code>powerlaw.metrics.*</code></td> <td>PowerLaw Lab</td> <td>All phases, Quant</td> <td>Data</td> <td><code>PowerLawMetrics</code></td> </tr> <tr> <td><code>titan.ai.*</code></td> <td>AI Quant, PowerLaw</td> <td>Hunter, Brain</td> <td>Data</td> <td>Various</td> </tr> <tr> <td><code>titan.evt.budget.update</code></td> <td>Brain</td> <td>All phases</td> <td>Event</td> <td><code>BudgetUpdate</code></td> </tr> <tr> <td><code>titan.cmd.risk.*</code></td> <td>Brain</td> <td>Execution</td> <td>Command</td> <td><code>RiskCommand</code></td> </tr> <tr> <td><code>titan.cmd.sys.halt.v1</code></td> <td>Brain/Operator</td> <td>Execution</td> <td>Command</td> <td><code>HaltPayload</code></td> </tr> </tbody> </table> <h3 id=63-nats-acl-matrix>6.3 NATS ACL Matrix</h3> <table> <thead> <tr> <th>User</th> <th>Publish Permissions</th> <th>Subscribe Permissions</th> </tr> </thead> <tbody> <tr> <td><code>brain</code></td> <td><code>&gt;</code> (full)</td> <td><code>&gt;</code> (full)</td> </tr> <tr> <td><code>execution</code></td> <td><code>titan.evt.execution.fill.v1</code>, <code>titan.evt.execution.&gt;</code>, <code>titan.evt.phase.&gt;</code></td> <td><code>titan.cmd.execution.place.v1.&gt;</code>, <code>titan.cmd.risk.&gt;</code>, <code>titan.cmd.sys.halt.v1</code></td> </tr> <tr> <td><code>scavenger</code></td> <td><code>titan.evt.scavenger.signal.v1</code>, <code>titan.evt.phase.&gt;</code></td> <td><code>powerlaw.metrics.&gt;</code>, <code>titan.evt.budget.update.v1</code></td> </tr> <tr> <td><code>hunter</code></td> <td><code>titan.evt.hunter.&gt;</code>, <code>titan.evt.phase.&gt;</code></td> <td><code>titan.cmd.hunter.&gt;</code>, <code>powerlaw.metrics.&gt;</code></td> </tr> <tr> <td><code>sentinel</code></td> <td><code>titan.evt.sentinel.&gt;</code>, <code>titan.evt.phase.&gt;</code></td> <td><code>titan.cmd.sentinel.&gt;</code>, <code>powerlaw.metrics.&gt;</code></td> </tr> <tr> <td><code>powerlaw</code></td> <td><code>titan.evt.powerlaw.&gt;</code>, <code>titan.data.powerlaw.&gt;</code>, <code>titan.ai.&gt;</code></td> <td><code>titan.data.market.&gt;</code>, <code>titan.evt.&gt;</code></td> </tr> <tr> <td><code>quant</code></td> <td><code>titan.evt.quant.&gt;</code>, <code>titan.cmd.ai.&gt;</code></td> <td><code>titan.cmd.ai.&gt;</code>, <code>titan.evt.&gt;</code>, <code>titan.data.powerlaw.&gt;</code></td> </tr> <tr> <td><code>console</code></td> <td><code>$JS.API.&gt;</code></td> <td><code>titan.data.&gt;</code>, <code>titan.evt.&gt;</code>, <code>_INBOX.&gt;</code></td> </tr> </tbody> </table> <p><strong>Evidence:</strong> <code>config/nats.conf:22-101</code></p> <h3 id=64-message-envelope-schema>6.4 Message Envelope Schema</h3> <p><strong>Required Fields (IntentEnvelope):</strong></p> <ul> <li><code>type</code>: Message type identifier</li> <li><code>payload</code>: Actual message content</li> <li><code>source</code>: Origin service identifier</li> <li><code>ts</code>: Unix timestamp (milliseconds)</li> <li><code>nonce</code>: Unique request identifier</li> <li><code>sig</code>: HMAC-SHA256 signature (hex)</li> </ul> <p><strong>Evidence:</strong> <code>packages/shared/src/schemas/intentSchema.ts</code></p> <hr> <h2 id=7-data-truth-postgresql>7. Data Truth (PostgreSQL)</h2> <h3 id=71-table-ownership>7.1 Table Ownership</h3> <table> <thead> <tr> <th>Table</th> <th>Owner Service</th> <th>Purpose</th> <th>Partitioned</th> <th>RLS</th> </tr> </thead> <tbody> <tr> <td><code>allocation_history</code></td> <td>Brain</td> <td>Tracks phase allocation changes</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>phase_trades</code></td> <td>Brain</td> <td>Individual trade records per phase</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>phase_performance</code></td> <td>Brain</td> <td>Aggregated performance metrics</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>brain_decisions</code></td> <td>Brain</td> <td>Signal approval/rejection audit trail</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>treasury_operations</code></td> <td>Brain</td> <td>Capital movement ledger</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>circuit_breaker_events</code></td> <td>Brain</td> <td>Breaker activation log</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>risk_snapshots</code></td> <td>Brain</td> <td>Periodic risk state captures</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>high_watermark</code></td> <td>Brain</td> <td>Peak equity tracking</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>system_state</code></td> <td>Brain</td> <td>Recovery checkpointing (JSONB)</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>manual_overrides</code></td> <td>Brain</td> <td>Operator allocation interventions</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>operators</code></td> <td>Brain</td> <td>User credentials and permissions</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>fills</code></td> <td>Brain</td> <td>Trade execution records</td> <td><strong>Yes</strong></td> <td>Enabled</td> </tr> <tr> <td><code>event_log</code></td> <td>Brain</td> <td>Event sourcing journal</td> <td><strong>Yes</strong></td> <td>Enabled</td> </tr> <tr> <td><code>ledger_accounts</code></td> <td>Brain</td> <td>Double-entry accounting accounts</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>ledger_transactions</code></td> <td>Brain</td> <td>Accounting transaction headers</td> <td>No</td> <td>Enabled</td> </tr> <tr> <td><code>ledger_entries</code></td> <td>Brain</td> <td>Accounting debit/credit entries</td> <td>No</td> <td>Enabled</td> </tr> </tbody> </table> <h3 id=72-migration-system>7.2 Migration System</h3> <table> <thead> <tr> <th>Aspect</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><strong>Location</strong></td> <td><code>services/titan-brain/migrations/</code></td> </tr> <tr> <td><strong>System</strong></td> <td>Idempotent runner (<code>scripts/ops/run_migrations.sh</code>) with <code>_titan_migrations</code> tracking table (SHA256 drift detection)</td> </tr> <tr> <td><strong>Current Schema</strong></td> <td><code>services/titan-brain/src/db/schema.sql</code></td> </tr> <tr> <td><strong>CI Validation</strong></td> <td><code>scripts/ci/test_fresh_bootstrap.sh</code> (ephemeral Postgres → migrate → validate → idempotency proof)</td> </tr> </tbody> </table> <h3 id=73-migrations>7.3 Migrations</h3> <table> <thead> <tr> <th>Migration File</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><code>003_dedup_fills.sql</code></td> <td>Fill deduplication constraints</td> </tr> <tr> <td><code>004_performance_view.sql</code></td> <td>Performance aggregation views</td> </tr> <tr> <td><code>20240523_canary_config.sql</code></td> <td>Canary deployment configuration</td> </tr> </tbody> </table> <hr> <h2 id=8-risk-immune-system>8. Risk Immune System</h2> <h3 id=81-canonical-risk-policy>8.1 Canonical Risk Policy</h3> <p><strong>Source File:</strong> <code>packages/shared/risk_policy.json</code><br> <strong>SHA256 Hash:</strong> <code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code></p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;maxAccountLeverage&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>10.0</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;maxPositionNotional&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>50000.0</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;maxDailyLoss&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>-1000.0</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;maxOpenOrdersPerSymbol&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;symbolWhitelist&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;BTC/USDT&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;ETH/USDT&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;SOL/USDT&quot;</span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;maxSlippageBps&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>100</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;maxStalenessMs&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>5000</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;maxCorrelation&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.7</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;correlationPenalty&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.5</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;minConfidenceScore&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>0.7</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;minStopDistanceMultiplier&quot;</span><span class=p>:</span><span class=w> </span><span class=mf>1.5</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;lastUpdated&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
<span class=p>}</span>
</code></pre></div> <h3 id=82-policy-enforcement-points>8.2 Policy Enforcement Points</h3> <table> <thead> <tr> <th>Layer</th> <th>File</th> <th>Method</th> </tr> </thead> <tbody> <tr> <td>Strategy (TS)</td> <td><code>packages/shared/src/schemas/RiskPolicy.ts:5-26</code></td> <td>Zod schema validation</td> </tr> <tr> <td>Execution (Rust)</td> <td><code>services/titan-execution-rs/src/risk_policy.rs:17-75</code></td> <td>Serde deserialization</td> </tr> <tr> <td>Hash Verification</td> <td>Both layers compute SHA256; mismatch = abort</td> <td><code>getCanonicalRiskPolicy()</code>, <code>RiskPolicy::get_hash()</code></td> </tr> </tbody> </table> <h3 id=83-circuit-breaker-states>8.3 Circuit Breaker States</h3> <table> <thead> <tr> <th>State</th> <th>Trigger Condition</th> <th>Effect</th> </tr> </thead> <tbody> <tr> <td><code>Normal</code></td> <td>All metrics within bounds</td> <td>Full trading enabled</td> </tr> <tr> <td><code>Cautious</code></td> <td>50% daily drawdown limit consumed</td> <td>Position sizing reduced 50%</td> </tr> <tr> <td><code>Defensive</code></td> <td>75% daily drawdown limit consumed</td> <td>New positions blocked</td> </tr> <tr> <td><code>Emergency</code></td> <td>Max daily loss breached OR operator halt</td> <td>All positions flattened</td> </tr> </tbody> </table> <p><strong>Evidence:</strong> <code>services/titan-execution-rs/src/risk_policy.rs:8-15</code></p> <h3 id=84-kill-switches>8.4 Kill Switches</h3> <table> <thead> <tr> <th>Mechanism</th> <th>Trigger</th> <th>Evidence</th> </tr> </thead> <tbody> <tr> <td><code>GlobalHalt</code></td> <td>Operator command via <code>titan.cmd.sys.halt.v1</code></td> <td><code>services/titan-execution-rs/src/circuit_breaker.rs</code></td> </tr> <tr> <td><code>ArmedState</code></td> <td>Disarm command prevents new orders</td> <td><code>services/titan-execution-rs/src/armed_state.rs</code></td> </tr> <tr> <td><code>RiskGuard</code></td> <td>Policy violation</td> <td><code>services/titan-execution-rs/src/risk_guard.rs</code></td> </tr> </tbody> </table> <hr> <h2 id=9-execution-boundary-and-order-lifecycle>9. Execution Boundary and Order Lifecycle</h2> <h3 id=91-boundary-contract>9.1 Boundary Contract</h3> <div class=highlight><pre><span></span><code>┌─────────────────┐         ┌──────────────────┐         ┌─────────────────┐
│  Strategy/Brain │ ──CMD──▶│  titan-execution │ ──REST──▶│    Exchange     │
│   (Orchestration)│◀──EVT── │      (Rust)      │◀──WS──── │   (Bybit/Binance) │
└─────────────────┘         └──────────────────┘         └─────────────────┘
</code></pre></div> <h3 id=92-allowed-vs-forbidden-channels>9.2 Allowed vs Forbidden Channels</h3> <table> <thead> <tr> <th>Channel Type</th> <th>Allowed</th> <th>Forbidden</th> </tr> </thead> <tbody> <tr> <td>Trade Intent</td> <td>NATS <code>titan.cmd.execution.place.v1.&gt;</code></td> <td>Direct HTTP to exchange from Brain</td> </tr> <tr> <td>Fill Events</td> <td>NATS <code>titan.evt.execution.fill.v1</code></td> <td>Database writes from Execution</td> </tr> <tr> <td>Risk Commands</td> <td>NATS <code>titan.cmd.risk.*</code></td> <td>Direct gRPC/HTTP bypass</td> </tr> </tbody> </table> <h3 id=93-order-lifecycle>9.3 Order Lifecycle</h3> <ol> <li><strong>Signal Generated</strong> (Phase 1/2/3) → Published to <code>titan.evt.*</code></li> <li><strong>Brain Approval</strong> → Validates against policy, allocations</li> <li><strong>Command Published</strong> → <code>titan.cmd.execution.place.v1.{venue}.{account}.{symbol}</code></li> <li><strong>HMAC Validated</strong> (Execution) → <code>security.rs:64-128</code></li> <li><strong>Risk Guard Check</strong> → <code>risk_guard.rs:130-198</code></li> <li><strong>Order Submitted</strong> → Exchange adapter</li> <li><strong>Fill Received</strong> → Published to <code>titan.evt.execution.fill.v1</code></li> <li><strong>Brain Records</strong> → Fills table + event log</li> </ol> <h3 id=94-idempotency-rules>9.4 Idempotency Rules</h3> <table> <thead> <tr> <th>Mechanism</th> <th>Implementation</th> <th>Evidence</th> </tr> </thead> <tbody> <tr> <td>Signal ID Cache</td> <td>Redis-backed, TTL 5 minutes</td> <td><code>.env.example:176</code> (<code>SIGNAL_CACHE_TTL_MS</code>)</td> </tr> <tr> <td>Nonce Tracking</td> <td>Envelope nonce prevents replay</td> <td><code>security.rs:78</code></td> </tr> <tr> <td>Order Dedup</td> <td>Fill ID unique constraint</td> <td><code>schema.sql:157</code> (<code>fill_id</code> in PRIMARY KEY)</td> </tr> </tbody> </table> <h3 id=95-truth-layer-definition>9.5 Truth Layer Definition</h3> <p><strong>"Verified" status requires:</strong></p> <ol> <li>Fill confirmed by exchange WebSocket ACK</li> <li>Fill recorded in <code>fills</code> table with <code>t_exchange</code> timestamp</li> <li>Fill event published to NATS</li> </ol> <p><strong>Evidence:</strong> <code>services/titan-execution-rs/src/nats_engine.rs</code> (fill publishing logic)</p> <hr> <h2 id=10-observability-and-operability>10. Observability and Operability</h2> <h3 id=101-health-endpoints>10.1 Health Endpoints</h3> <h3 id=nats-subjects-auto-generated>NATS Subjects (Auto-Generated)</h3> <!-- AUTH_SUBJECT_MAP_START --> <table> <thead> <tr> <th>Constant Path</th> <th>Subject Pattern</th> </tr> </thead> <tbody> <tr> <td><code>CMD.EXECUTION.PLACE</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>CMD.EXECUTION.PREFIX</code></td> <td><code>titan.cmd.execution.place.v1</code></td> </tr> <tr> <td><code>CMD.EXECUTION.ALL</code></td> <td><code>titan.cmd.execution.place.v1.&gt;</code></td> </tr> <tr> <td><code>CMD.ALL</code></td> <td><code>titan.cmd.execution.place.v1.&gt;</code></td> </tr> <tr> <td><code>CMD.RISK.CONTROL</code></td> <td><code>titan.cmd.risk.control.v1</code></td> </tr> <tr> <td><code>CMD.RISK.FLATTEN</code></td> <td><code>titan.cmd.risk.flatten</code></td> </tr> <tr> <td><code>CMD.RISK.POLICY</code></td> <td><code>titan.cmd.risk.policy.v1</code></td> </tr> <tr> <td><code>CMD.CONFIG.ROLLBACK</code></td> <td><code>titan.cmd.config.rollback</code></td> </tr> <tr> <td><code>CMD.OPERATOR.ARM</code></td> <td><code>titan.cmd.operator.arm.v1</code></td> </tr> <tr> <td><code>CMD.OPERATOR.DISARM</code></td> <td><code>titan.cmd.operator.disarm.v1</code></td> </tr> <tr> <td><code>CMD.OPERATOR.ALL</code></td> <td><code>titan.cmd.operator.v1.&gt;</code></td> </tr> <tr> <td><code>CMD.SYS.HALT</code></td> <td><code>titan.cmd.sys.halt.v1</code></td> </tr> <tr> <td><code>CMD.HUNTER.ALL</code></td> <td><code>titan.cmd.hunter.v1.&gt;</code></td> </tr> <tr> <td><code>CMD.SENTINEL.ALL</code></td> <td><code>titan.cmd.sentinel.v1.&gt;</code></td> </tr> <tr> <td><code>CMD.AI.OPTIMIZE</code></td> <td><code>titan.cmd.ai.optimize.v1</code></td> </tr> <tr> <td><code>CMD.AI.OPTIMIZE_PROPOSAL</code></td> <td><code>titan.cmd.ai.optimize.proposal.v1</code></td> </tr> <tr> <td><code>CMD.AI.ALL</code></td> <td><code>titan.cmd.ai.v1.&gt;</code></td> </tr> <tr> <td><code>EVT.ANALYSIS.TRADE_COMPLETED</code></td> <td><code>titan.evt.analysis.trade_completed.v1</code></td> </tr> <tr> <td><code>EVT.ALERT.DRIFT</code></td> <td><code>titan.evt.alert.drift.v1</code></td> </tr> <tr> <td><code>EVT.ALERT.INTEGRITY</code></td> <td><code>titan.evt.alert.integrity.v1</code></td> </tr> <tr> <td><code>EVT.ALERT.LATENCY</code></td> <td><code>titan.evt.alert.latency.v1</code></td> </tr> <tr> <td><code>EVT.EXECUTION.FILL</code></td> <td><code>titan.evt.execution.fill.v1</code></td> </tr> <tr> <td><code>EVT.EXECUTION.SHADOW_FILL</code></td> <td><code>titan.evt.execution.shadow_fill.v1</code></td> </tr> <tr> <td><code>EVT.EXECUTION.REPORT</code></td> <td><code>titan.evt.execution.report.v1</code></td> </tr> <tr> <td><code>EVT.EXECUTION.REJECT</code></td> <td><code>titan.evt.execution.reject.v1</code></td> </tr> <tr> <td><code>EVT.EXECUTION.BALANCE</code></td> <td><code>titan.evt.execution.balance</code></td> </tr> <tr> <td><code>EVT.EXECUTION.ALL</code></td> <td><code>titan.evt.execution.&gt;</code></td> </tr> <tr> <td><code>EVT.SCAVENGER.SIGNAL</code></td> <td><code>titan.evt.scavenger.signal.v1</code></td> </tr> <tr> <td><code>EVT.HUNTER.ALL</code></td> <td><code>titan.evt.hunter.&gt;</code></td> </tr> <tr> <td><code>EVT.SENTINEL.ALL</code></td> <td><code>titan.evt.sentinel.&gt;</code></td> </tr> <tr> <td><code>EVT.POWERLAW.IMPACT</code></td> <td><code>titan.evt.powerlaw.impact.v1</code></td> </tr> <tr> <td><code>EVT.POWERLAW.ALL</code></td> <td><code>titan.evt.powerlaw.&gt;</code></td> </tr> <tr> <td><code>EVT.QUANT.ALL</code></td> <td><code>titan.evt.quant.&gt;</code></td> </tr> <tr> <td><code>EVT.PHASE.INTENT</code></td> <td><code>titan.evt.phase.intent.v1</code></td> </tr> <tr> <td><code>EVT.PHASE.POSTURE</code></td> <td><code>titan.evt.phase.posture.v1</code></td> </tr> <tr> <td><code>EVT.PHASE.DIAGNOSTICS</code></td> <td><code>titan.evt.phase.diagnostics.v1</code></td> </tr> <tr> <td><code>EVT.PHASE.ALL</code></td> <td><code>titan.evt.phase.&gt;</code></td> </tr> <tr> <td><code>EVT.BRAIN.SIGNAL</code></td> <td><code>titan.evt.brain.signal.v1</code></td> </tr> <tr> <td><code>EVT.BRAIN.REGIME</code></td> <td><code>titan.evt.brain.regime.v1</code></td> </tr> <tr> <td><code>EVT.ANALYTICS.POWERLAW</code></td> <td><code>titan.evt.analytics.powerlaw.v1</code></td> </tr> <tr> <td><code>EVT.BUDGET.UPDATE</code></td> <td><code>titan.evt.budget.update.v1</code></td> </tr> <tr> <td><code>EVT.AUDIT.OPERATOR</code></td> <td><code>titan.evt.audit.operator.v1</code></td> </tr> <tr> <td><code>EVT.RISK.CORRELATION_WARNING</code></td> <td><code>titan.evt.risk.correlation_warning.v1</code></td> </tr> <tr> <td><code>EVT.RISK.STATE</code></td> <td><code>titan.evt.risk.state.v1</code></td> </tr> <tr> <td><code>EVT.SYS.FAILOVER_INITIATED</code></td> <td><code>titan.evt.sys.failover_initiated.v1</code></td> </tr> <tr> <td><code>EVT.SYS.RESTORE_INITIATED</code></td> <td><code>titan.evt.sys.restore_initiated.v1</code></td> </tr> <tr> <td><code>DATA.POWERLAW.METRICS</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>DATA.POWERLAW.PREFIX</code></td> <td><code>titan.data.powerlaw.metrics.v1</code></td> </tr> <tr> <td><code>DATA.POWERLAW.ALL</code></td> <td><code>titan.data.powerlaw.metrics.v1.&gt;</code></td> </tr> <tr> <td><code>DATA.EXECUTION.CONSTRAINTS</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>DATA.EXECUTION.PREFIX</code></td> <td><code>titan.data.execution.constraints.v1</code></td> </tr> <tr> <td><code>DATA.EXECUTION.ALL</code></td> <td><code>titan.data.execution.constraints.v1.&gt;</code></td> </tr> <tr> <td><code>DATA.MARKET.TICKER</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>DATA.MARKET.PREFIX</code></td> <td><code>titan.data.market.ticker.v1</code></td> </tr> <tr> <td><code>DATA.MARKET.ALL</code></td> <td><code>titan.data.market.ticker.v1.&gt;</code></td> </tr> <tr> <td><code>DATA.DASHBOARD.UPDATE</code></td> <td><code>titan.data.dashboard.update.v1</code></td> </tr> <tr> <td><code>SYS.HEARTBEAT</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>SYS.RPC.GET_POSITIONS</code></td> <td><code>Function(...args)</code></td> </tr> <tr> <td><code>SYS.RPC.GET_BALANCES</code></td> <td><code>Function(...args)</code></td> </tr> </tbody> </table> <!-- AUTH_SUBJECT_MAP_END --> <h3 id=jetstream-streams>JetStream Streams</h3> <h3 id=102-metrics-endpoints>10.2 Metrics Endpoints</h3> <p>| titan-execution | <code>/metrics</code> | Prometheus | | titan-brain | <code>/metrics</code> | Prometheus | | NATS | <code>:8222/varz</code> | JSON |</p> <h3 id=103-critical-metrics>10.3 Critical Metrics</h3> <table> <thead> <tr> <th>Metric</th> <th>Source</th> <th>Alert Threshold</th> </tr> </thead> <tbody> <tr> <td>Position exposure</td> <td>Execution</td> <td>&gt; 80% of max notional</td> </tr> <tr> <td>Account leverage</td> <td>Execution</td> <td>&gt; 8x (of 10x max)</td> </tr> <tr> <td>Daily drawdown</td> <td>Brain</td> <td>&gt; 50% of <code>maxDailyLoss</code> consumed → alert; 100% → Emergency</td> </tr> <tr> <td>Order latency p99</td> <td>Execution</td> <td>&gt; 500ms</td> </tr> <tr> <td>HMAC rejection rate</td> <td>Execution</td> <td>&gt; 1 per minute</td> </tr> </tbody> </table> <h3 id=104-log-correlation>10.4 Log Correlation</h3> <table> <thead> <tr> <th>ID Type</th> <th>Format</th> <th>Usage</th> </tr> </thead> <tbody> <tr> <td><code>signal_id</code></td> <td>UUID v4</td> <td>End-to-end signal tracking</td> </tr> <tr> <td><code>correlation_id</code></td> <td>UUID v4</td> <td>Request correlation</td> </tr> <tr> <td><code>order_id</code></td> <td>Exchange-provided</td> <td>Exchange order tracking</td> </tr> <tr> <td><code>fill_id</code></td> <td>Exchange-provided</td> <td>Fill deduplication</td> </tr> </tbody> </table> <h3 id=105-tracing>10.5 Tracing</h3> <p>OpenTelemetry configured via:</p> <ul> <li><code>opentelemetry-otlp</code> in Rust (<code>Cargo.toml:46</code>)</li> <li>Tempo receiver on <code>4317</code> (OTLP/gRPC)</li> </ul> <hr> <h2 id=11-security-canon>11. Security Canon</h2> <h3 id=111-hmac-signing-boundaries>11.1 HMAC Signing Boundaries</h3> <table> <thead> <tr> <th>Boundary</th> <th>What is Signed</th> <th>Where Verified</th> </tr> </thead> <tbody> <tr> <td>Brain → Execution</td> <td><code>ts.nonce.payload_json</code></td> <td><code>security.rs:64-128</code></td> </tr> <tr> <td>Operator → Execution</td> <td><code>timestamp:action:actor_id:command_id</code></td> <td><code>security.rs:130-184</code></td> </tr> </tbody> </table> <h3 id=112-fail-closed-behavior>11.2 Fail-Closed Behavior</h3> <div class=highlight><pre><span></span><code><span class=c1>// services/titan-execution-rs/src/security.rs:35-49</span>
<span class=k>if</span><span class=w> </span><span class=n>secret</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>allow_empty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>env</span><span class=p>::</span><span class=n>var</span><span class=p>(</span><span class=s>&quot;HMAC_ALLOW_EMPTY_SECRET&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=p>.</span><span class=n>unwrap_or</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>allow_empty</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>warn</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;⚠️ HMAC_SECRET not set but HMAC_ALLOW_EMPTY_SECRET=true. TEST MODE ONLY.&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=fm>panic!</span><span class=p>(</span><span class=s>&quot;FATAL: HMAC_SECRET environment variable is required.&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h3 id=113-secret-handling>11.3 Secret Handling</h3> <table> <thead> <tr> <th>Secret</th> <th>Storage</th> <th>Load Method</th> </tr> </thead> <tbody> <tr> <td><code>HMAC_SECRET</code></td> <td><code>.env</code> / Vault</td> <td><code>std::env::var()</code> + panic on miss</td> </tr> <tr> <td>Exchange API keys</td> <td><code>.env</code> / Vault</td> <td><code>loadSecretsFromFiles()</code></td> </tr> <tr> <td><code>TITAN_MASTER_PASSWORD</code></td> <td><code>.env</code> / Vault</td> <td>Brain config loader</td> </tr> </tbody> </table> <h3 id=114-rate-limiting>11.4 Rate Limiting</h3> <table> <thead> <tr> <th>Service</th> <th>Limit</th> <th>Implementation</th> </tr> </thead> <tbody> <tr> <td>titan-execution</td> <td>10 RPS per exchange</td> <td><code>rate_limiter.rs</code> (TokenBucket)</td> </tr> <tr> <td>Brain API</td> <td>12 RPS</td> <td><code>.env.example:126</code></td> </tr> </tbody> </table> <hr> <h2 id=12-contradictions-and-dual-truth-findings>12. Contradictions and Dual Truth Findings</h2> <table> <thead> <tr> <th>ID</th> <th>Finding</th> <th>Resolution</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td>D-01</td> <td>Two risk_policy.json files exist</td> <td>Files are <strong>byte-identical</strong> (same SHA256)</td> <td>RESOLVED</td> </tr> <tr> <td>D-02</td> <td>Legacy NATS subjects (<code>titan.data.*</code>) vs new (<code>titan.data.*</code>)</td> <td>Migration map exists; both active during transition</td> <td>DOCUMENTED</td> </tr> <tr> <td>D-03</td> <td><code>docker compose config</code> requires NATS_SYS_PASSWORD</td> <td><code>validate_prod_env.sh</code> checks all required vars pre-deploy; <code>:?</code> fail-fast syntax in compose</td> <td><strong>RESOLVED</strong></td> </tr> </tbody> </table> <p><strong>Dual Truth Verification:</strong></p> <div class=highlight><pre><span></span><code><span class=c1># Verify risk policy files are identical</span>
shasum<span class=w> </span>-a<span class=w> </span><span class=m>256</span><span class=w> </span>packages/shared/risk_policy.json<span class=w> </span>services/titan-execution-rs/src/risk_policy.json
<span class=c1># Output: d4fb422e... (both files)</span>
</code></pre></div> <hr> <h2 id=13-deadlegacyunused-inventory>13. Dead/Legacy/Unused Inventory</h2> <h3 id=131-detected-by-knip-analysis>13.1 Detected by Knip Analysis</h3> <table> <thead> <tr> <th>Item Type</th> <th>Path/Pattern</th> <th>Evidence</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td>Unlisted dependency</td> <td><code>@titan/shared</code> in scripts/verification</td> <td><code>knip</code> output</td> <td>Add to deps</td> </tr> <tr> <td>Unlisted dependency</td> <td><code>globals</code> in eslint configs</td> <td><code>knip</code> output</td> <td>Add to deps</td> </tr> <tr> <td>Unlisted binary</td> <td><code>tsx</code>, <code>ts-node</code>, <code>python3</code></td> <td><code>knip</code> output</td> <td>Add to deps</td> </tr> <tr> <td>Unused exports</td> <td>220 unused exports (mostly UI components)</td> <td><code>knip</code> output</td> <td>Review</td> </tr> <tr> <td>Unresolved imports</td> <td><code>identity-obj-proxy</code>, <code>@jest/test-sequencer</code></td> <td>Jest config issues</td> <td>Fix config</td> </tr> </tbody> </table> <h3 id=132-legacy-services>13.2 Legacy Services</h3> <table> <thead> <tr> <th>Service</th> <th>Path</th> <th>Status</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td><code>canonical-powerlaw-service</code></td> <td><code>services/canonical-powerlaw-service/</code></td> <td><strong>Deleted</strong></td> <td>✅ Removed</td> </tr> <tr> <td><code>titan-memory</code></td> <td><code>services/titan-memory/</code></td> <td><strong>Deleted</strong></td> <td>✅ Removed</td> </tr> </tbody> </table> <h3 id=133-legacy-nats-subjects>13.3 Legacy NATS Subjects</h3> <table> <thead> <tr> <th>Subject Pattern</th> <th>Status</th> <th>Replacement</th> <th>Deadline</th> </tr> </thead> <tbody> <tr> <td><code>signal.*</code></td> <td>Deprecated</td> <td><code>titan.data.*</code></td> <td><strong>Feb 28, 2026</strong></td> </tr> </tbody> </table> <hr> <h2 id=14-canonical-artifacts-and-hash-ledger>14. Canonical Artifacts and Hash Ledger</h2> <h3 id=141-critical-artifacts-sha256>14.1 Critical Artifacts (SHA256)</h3> <table> <thead> <tr> <th>Artifact</th> <th>SHA256</th> </tr> </thead> <tbody> <tr> <td><code>docker-compose.prod.yml</code></td> <td><code>f5957a020975044ad2500e8c88d62fffc5e92fef8d30a7cc4e9e65fbebf33701</code></td> </tr> <tr> <td><code>docker-compose.yml</code></td> <td><code>4e002c4d03e329539fba06b6fb41b27337150f5091f003b4e94f792495f9ce93</code></td> </tr> <tr> <td><code>packages/shared/risk_policy.json</code></td> <td><code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code></td> </tr> <tr> <td><code>services/titan-execution-rs/src/risk_policy.json</code></td> <td><code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code></td> </tr> <tr> <td><code>config/nats.conf</code></td> <td><code>42b0a657e815a911688710bfa9776eeb4bc7215c635d99bf787c5e3851b74971</code></td> </tr> <tr> <td><code>services/titan-brain/src/db/schema.sql</code></td> <td><code>aa1b8369ecb230b1a1809f52c482f6f48a734df4393dc4ce74c474259bfe0bd0</code></td> </tr> <tr> <td><code>packages/shared/src/schemas/RiskPolicy.ts</code></td> <td><code>12964aaf9d30f6f4876fa5ff54da8d3035c4556ead4ff9765a5106adac7c2932</code></td> </tr> <tr> <td><code>packages/shared/src/messaging/NatsClient.ts</code></td> <td><code>f2e9f3ec1f4fe22b0f2d5dc112a654d071016c572b189f946e89a7d9be5ab9d1</code></td> </tr> <tr> <td><code>packages/shared/src/messaging/ExecutionClient.ts</code></td> <td><code>d413c4efa4676dfd5d8fe93ac203ae316e48b4b6b958ea1286d38599a6e8f5f9</code></td> </tr> <tr> <td><code>services/titan-execution-rs/src/risk_policy.rs</code></td> <td><code>6808e7ca92f856ffe465f88311be6d8721dd28cb96795eddf4b1e81a725d562e</code></td> </tr> <tr> <td><code>services/titan-execution-rs/src/security.rs</code></td> <td><code>624f0384eb51573ede5f94d3783d78a51e93ab8130cad43802dcc4b38cad5d34</code></td> </tr> <tr> <td><code>services/titan-execution-rs/src/nats_engine.rs</code></td> <td><code>92bf7301558e51d4320203efa64b526489fa89e2aae1c36974778dcc00c0d6ee</code></td> </tr> <tr> <td><code>services/titan-brain/src/index.ts</code></td> <td><code>b03c71431500b41ac163b05a3e80d5a5095e7b75ff30855c090069e097be1c76</code></td> </tr> <tr> <td><code>turbo.json</code></td> <td><code>40a2fb5f91c04664d838e8057aa47591000414d44c2465870f93d498377564e7</code></td> </tr> <tr> <td><code>.github/workflows/ci.yml</code></td> <td><code>46659f81fb57ec1f6245a7c2847a75e91f1649bceaba8012a63b1bfd15c3d2de</code></td> </tr> <tr> <td><code>.github/workflows/deploy-prod.yml</code></td> <td><code>7e455b9a699af2924128f2bc3382cbf0d11d3eae3d5c3b60d7acf55947b67593</code></td> </tr> </tbody> </table> <h3 id=142-hash-computation-command>14.2 Hash Computation Command</h3> <div class=highlight><pre><span></span><code>shasum<span class=w> </span>-a<span class=w> </span><span class=m>256</span><span class=w> </span>&lt;file&gt;
</code></pre></div> <hr> <h2 id=15-closure-tasks>15. Closure Tasks</h2> <table> <thead> <tr> <th>ID</th> <th>Task</th> <th>Priority</th> <th>Evidence Trigger</th> </tr> </thead> <tbody> <tr> <td>C-01</td> <td>Add <code>@titan/shared</code> to dependencies in verification scripts</td> <td>Medium</td> <td>Knip unlisted dependency warning</td> </tr> <tr> <td>C-02</td> <td>Add missing binaries (<code>tsx</code>, <code>ts-node</code>, <code>python3</code>) to package.json</td> <td>Low</td> <td>Knip unlisted binaries warning</td> </tr> <tr> <td>C-05</td> <td>Complete NATS subject migration from <code>titan.data.*</code> to <code>titan.data.*</code></td> <td>High</td> <td><code>powerlaw_subjects.ts:77</code> deprecation notice</td> </tr> <tr> <td>C-06</td> <td>Review 220 unused exports identified by Knip</td> <td>Low</td> <td>Knip unused exports output</td> </tr> <tr> <td>C-07</td> <td>Set <code>NATS_SYS_PASSWORD</code> environment variable for production</td> <td><strong>RESOLVED</strong></td> <td><code>validate_prod_env.sh</code> + fail-fast <code>:?</code> syntax</td> </tr> </tbody> </table> <hr> <h2 id=16-mandatory-command-evidence>16. Mandatory Command Evidence</h2> <h3 id=161-git-rev-parse-head>16.1 git rev-parse HEAD</h3> <div class=highlight><pre><span></span><code>a77c842f9af7953cec76954d6d2696cf4ac7ca0d
</code></pre></div> <h3 id=162-git-status-porcelain>16.2 git status --porcelain</h3> <div class=highlight><pre><span></span><code>M<span class=w> </span>knip.json
M<span class=w> </span>package-lock.json
M<span class=w> </span>package.json
M<span class=w> </span>services/titan-ai-quant/package.json
M<span class=w> </span>services/titan-phase2-hunter/package.json
M<span class=w> </span>services/titan-phase3-sentinel/package.json
</code></pre></div> <h3 id=163-npm-run-script-inventory>16.3 npm run (script inventory)</h3> <div class=highlight><pre><span></span><code>start:brain, start:execution, start:console, start:scavenger, 
start:hunter, start:sentinel, start:powerlaw-lab, start:ai-quant,
start:prod, build, test:all, lint:all, lint:fix, format, format:check,
validate:config, sota:circular, sota:arch, sota:complexity, sota:god,
sota:dead, sota:zombie, sota:secrets, sota:flake, sota:immutability,
sota:audit, sota:license, ... (60+ scripts)
</code></pre></div> <h3 id=164-docker-compose-config>16.4 docker compose config</h3> <div class=highlight><pre><span></span><code>Passes when .env contains all required variables.
validate_prod_env.sh enforces 14 required vars + rejects known defaults.
</code></pre></div> <h3 id=165-cargo-metadata>16.5 cargo metadata</h3> <div class=highlight><pre><span></span><code>Package: titan-execution-rs v0.1.0
Dependencies: tokio, async-nats, serde, actix-web, hmac, sha2, 
              opentelemetry, prometheus, crossbeam-channel, etc.
</code></pre></div> <hr> <h2 id=document-verification>Document Verification</h2> <p>To verify this document against the repository state:</p> <div class=highlight><pre><span></span><code><span class=c1># 1. Verify commit hash</span>
git<span class=w> </span>rev-parse<span class=w> </span>HEAD<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-q<span class=w> </span><span class=s2>&quot;a77c842f9af7953cec76954d6d2696cf4ac7ca0d&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;✓ Commit matches&quot;</span>

<span class=c1># 2. Verify critical artifact hashes</span>
shasum<span class=w> </span>-a<span class=w> </span><span class=m>256</span><span class=w> </span>packages/shared/risk_policy.json<span class=w> </span>services/titan-execution-rs/src/risk_policy.json<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>grep<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>grep<span class=w> </span>-q<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;✓ Risk policy parity confirmed&quot;</span>

<span class=c1># 3. Run configuration validation</span>
npm<span class=w> </span>run<span class=w> </span>validate:config

<span class=c1># 4. Verify NATS ACLs</span>
grep<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;user:&quot;</span><span class=w> </span>config/nats.conf<span class=w>  </span><span class=c1># Should return 8 users</span>
</code></pre></div> <hr> <h2 id=106-reconciliation-truth-convergence>10.6 Reconciliation &amp; Truth Convergence</h2> <blockquote> <p>[!IMPORTANT] <strong>Production Standard</strong>: Truth is not just "Event Emitted", it is "Exchange Acknowledged and Verified".</p> </blockquote> <p>The system implements a rigorous <strong>Reconciliation Loop</strong> to survive WebSocket disconnects and state drift:</p> <ol> <li><strong>Scheduled Reconcile</strong>: Every 1 minute, Brain queries the Exchange REST API for open orders and positions.</li> <li><strong>Snapshot Digest</strong>: Brain creates a <code>PositionSnapshot</code> containing the authoritative state.</li> <li><strong>Drift Detection</strong>:<ul> <li>If <code>Brain State</code> != <code>Exchange State</code>, it enters <strong>Truth Degrade Mode</strong>.</li> <li><strong>Action</strong>: All Risk limits are frozen (no new risk).</li> <li><strong>Self-Healing</strong>: Brain emits synthetic checks or alerts operator if manual intervention is needed.</li> </ul> </li> <li><strong>Hard Proof Test</strong>:<ul> <li>The system MUST demonstrate convergence without manual cleanup after a simulated 5-minute network partition during active trading.</li> </ul> </li> </ol> <hr> <p><strong>Document Generated</strong>: 2026-02-10T20:02:00Z<br> <strong>Generator</strong>: Canonical System Cartographer (AI-Assisted)<br> <strong>Verification Status</strong>: Evidence-backed from repository artifacts</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.c8d2eff1.min.js></script> </body> </html>