e4a0f8c1c564541033858694c1278e26
"use strict";
/**
 * Position Manager for Titan Phase 2 - The Hunter
 *
 * Handles automated position management including:
 * - Move stop to breakeven at 1.5R profit
 * - Take partial profit at 2R profit (50% close)
 * - Update trailing stop with 1 ATR distance
 * - Tighten stop after 48h to 0.5 ATR
 * - Close position for stop/target hits
 *
 * Requirements: 12.1-12.7 (Position Management)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.PositionManager = void 0;
const events_1 = require("events");
class PositionManager extends events_1.EventEmitter {
    positions = new Map();
    config;
    bybitClient;
    updateInterval = null;
    UPDATE_FREQUENCY = 5000; // 5 seconds
    constructor(bybitClient, config) {
        super();
        this.bybitClient = bybitClient;
        this.config = {
            breakevenRLevel: 1.5,
            partialProfitRLevel: 2.0,
            partialProfitPercentage: 50,
            trailingStopDistance: 1.0,
            tightenAfterHours: 48,
            tightenedStopDistance: 0.5,
            ...config
        };
        // Start position monitoring
        this.startMonitoring();
    }
    /**
     * Add a new position to management
     * @param position - Position to manage
     */
    addPosition(position) {
        this.positions.set(position.id, { ...position });
        console.log(`üìä Position Manager: Added position ${position.id} (${position.symbol} ${position.side})`);
    }
    /**
     * Remove a position from management
     * @param positionId - Position ID to remove
     */
    removePosition(positionId) {
        const position = this.positions.get(positionId);
        if (position) {
            this.positions.delete(positionId);
            console.log(`üìä Position Manager: Removed position ${positionId}`);
        }
    }
    /**
     * Get all managed positions
     * @returns Array of managed positions
     */
    getPositions() {
        return Array.from(this.positions.values());
    }
    /**
     * Get a specific position
     * @param positionId - Position ID
     * @returns Position or undefined
     */
    getPosition(positionId) {
        return this.positions.get(positionId);
    }
    /**
     * Update position with current market data
     * @param update - Position update data
     */
    updatePosition(update) {
        const position = this.positions.get(update.id);
        if (!position)
            return;
        // Update current price and P&L
        position.currentPrice = update.currentPrice;
        position.unrealizedPnL = update.unrealizedPnL;
        // Calculate current R value
        const riskAmount = Math.abs(position.entryPrice - position.stopLoss) * position.quantity;
        if (riskAmount > 0) {
            position.rValue = update.unrealizedPnL / riskAmount;
        }
        // Update position in map
        this.positions.set(update.id, position);
        // Check for management actions
        this.checkPositionManagement(position);
    }
    /**
     * Move stop loss to breakeven at 1.5R profit
     * @param position - Position to update
     * @returns Promise with success status
     */
    async moveStopToBreakeven(position) {
        try {
            // Check if already at breakeven
            if (Math.abs(position.stopLoss - position.entryPrice) < 0.01) {
                return true; // Already at breakeven
            }
            // Check if position has reached 1.5R profit
            if (position.rValue < this.config.breakevenRLevel) {
                return false; // Not profitable enough yet
            }
            console.log(`üéØ Moving stop to breakeven for ${position.symbol} at ${position.rValue.toFixed(2)}R`);
            // Set stop loss to entry price (breakeven)
            const success = await this.bybitClient.setStopLoss(position.symbol, position.entryPrice);
            if (success) {
                position.stopLoss = position.entryPrice;
                this.positions.set(position.id, position);
                this.emit('position:breakeven', position);
                console.log(`‚úÖ Stop moved to breakeven: ${position.symbol} @ ${position.entryPrice}`);
                return true;
            }
            return false;
        }
        catch (error) {
            console.error(`‚ùå Failed to move stop to breakeven for ${position.symbol}:`, error);
            this.emit('position:error', position, error);
            return false;
        }
    }
    /**
     * Take partial profit at 2R profit (50% close)
     * @param position - Position to partially close
     * @returns Promise with success status
     */
    async takePartialProfit(position) {
        try {
            // Check if position has reached 2R profit
            if (position.rValue < this.config.partialProfitRLevel) {
                return false; // Not profitable enough yet
            }
            // Check if partial profit already taken (quantity would be reduced)
            const originalQuantity = position.quantity;
            const partialQuantity = originalQuantity * (this.config.partialProfitPercentage / 100);
            console.log(`üí∞ Taking partial profit for ${position.symbol} at ${position.rValue.toFixed(2)}R`);
            // Place market order to close partial position
            const orderParams = {
                phase: 'phase2',
                symbol: position.symbol,
                side: position.side === 'LONG' ? 'Sell' : 'Buy',
                type: 'MARKET',
                qty: partialQuantity,
                leverage: position.leverage
            };
            const result = await this.bybitClient.placeOrderWithRetry(orderParams);
            if (result.status === 'FILLED') {
                // Update position quantity
                position.quantity -= partialQuantity;
                position.realizedPnL += (partialQuantity * (position.currentPrice - position.entryPrice));
                this.positions.set(position.id, position);
                this.emit('position:partial', position, partialQuantity);
                console.log(`‚úÖ Partial profit taken: ${position.symbol} closed ${partialQuantity} at ${result.price}`);
                return true;
            }
            return false;
        }
        catch (error) {
            console.error(`‚ùå Failed to take partial profit for ${position.symbol}:`, error);
            this.emit('position:error', position, error);
            return false;
        }
    }
    /**
     * Update trailing stop with 1 ATR distance
     * @param position - Position to update trailing stop
     * @returns Promise with success status
     */
    async updateTrailingStop(position) {
        try {
            // Only trail if position is profitable
            if (position.rValue <= 0) {
                return false;
            }
            const atrDistance = position.atr * this.config.trailingStopDistance;
            let newStopLoss;
            if (position.side === 'LONG') {
                // For long positions, trail stop up
                newStopLoss = position.currentPrice - atrDistance;
                // Only update if new stop is higher than current stop
                if (newStopLoss <= position.stopLoss) {
                    return false;
                }
            }
            else {
                // For short positions, trail stop down
                newStopLoss = position.currentPrice + atrDistance;
                // Only update if new stop is lower than current stop
                if (newStopLoss >= position.stopLoss) {
                    return false;
                }
            }
            console.log(`üìà Updating trailing stop for ${position.symbol}: ${position.stopLoss.toFixed(2)} ‚Üí ${newStopLoss.toFixed(2)}`);
            // Set new stop loss
            const success = await this.bybitClient.setStopLoss(position.symbol, newStopLoss);
            if (success) {
                position.stopLoss = newStopLoss;
                this.positions.set(position.id, position);
                this.emit('position:trailing', position, newStopLoss);
                console.log(`‚úÖ Trailing stop updated: ${position.symbol} @ ${newStopLoss.toFixed(2)}`);
                return true;
            }
            return false;
        }
        catch (error) {
            console.error(`‚ùå Failed to update trailing stop for ${position.symbol}:`, error);
            this.emit('position:error', position, error);
            return false;
        }
    }
    /**
     * Tighten stop loss to 0.5 ATR after 48 hours
     * @param position - Position to tighten stop
     * @returns Promise with success status
     */
    async tightenStopAfter48h(position) {
        try {
            // Check if position is older than configured hours
            const hoursOpen = (Date.now() - position.entryTime) / (1000 * 60 * 60);
            if (hoursOpen < this.config.tightenAfterHours) {
                return false; // Not old enough yet
            }
            const tightenedDistance = position.atr * this.config.tightenedStopDistance;
            let newStopLoss;
            if (position.side === 'LONG') {
                newStopLoss = position.currentPrice - tightenedDistance;
                // Only tighten if new stop is higher than current stop
                if (newStopLoss <= position.stopLoss) {
                    return false;
                }
            }
            else {
                newStopLoss = position.currentPrice + tightenedDistance;
                // Only tighten if new stop is lower than current stop
                if (newStopLoss >= position.stopLoss) {
                    return false;
                }
            }
            console.log(`‚è∞ Tightening stop after ${hoursOpen.toFixed(1)}h for ${position.symbol}: ${position.stopLoss.toFixed(2)} ‚Üí ${newStopLoss.toFixed(2)}`);
            // Set tightened stop loss
            const success = await this.bybitClient.setStopLoss(position.symbol, newStopLoss);
            if (success) {
                position.stopLoss = newStopLoss;
                this.positions.set(position.id, position);
                this.emit('position:tightened', position, newStopLoss);
                console.log(`‚úÖ Stop tightened: ${position.symbol} @ ${newStopLoss.toFixed(2)}`);
                return true;
            }
            return false;
        }
        catch (error) {
            console.error(`‚ùå Failed to tighten stop for ${position.symbol}:`, error);
            this.emit('position:error', position, error);
            return false;
        }
    }
    /**
     * Close position for stop/target hits
     * @param position - Position to close
     * @param reason - Reason for closing
     * @returns Promise with success status
     */
    async closePosition(position, reason) {
        try {
            console.log(`üö™ Closing position ${position.symbol} - Reason: ${reason}`);
            // Place market order to close entire position
            const orderParams = {
                phase: 'phase2',
                symbol: position.symbol,
                side: position.side === 'LONG' ? 'Sell' : 'Buy',
                type: 'MARKET',
                qty: position.quantity,
                leverage: position.leverage
            };
            const result = await this.bybitClient.placeOrderWithRetry(orderParams);
            if (result.status === 'FILLED') {
                // Update position status
                position.status = 'CLOSED';
                position.realizedPnL += (position.quantity * (result.price - position.entryPrice));
                // Remove from active management
                this.positions.delete(position.id);
                this.emit('position:closed', position, reason);
                console.log(`‚úÖ Position closed: ${position.symbol} at ${result.price} (${reason})`);
                return true;
            }
            return false;
        }
        catch (error) {
            console.error(`‚ùå Failed to close position ${position.symbol}:`, error);
            this.emit('position:error', position, error);
            return false;
        }
    }
    /**
     * Check if position needs management actions
     * @param position - Position to check
     */
    async checkPositionManagement(position) {
        try {
            // Check for stop/target hits first
            if (this.checkStopHit(position)) {
                await this.closePosition(position, 'STOP_HIT');
                return;
            }
            if (this.checkTargetHit(position)) {
                await this.closePosition(position, 'TARGET_HIT');
                return;
            }
            // Check for management actions (in order of priority)
            // 1. Move to breakeven at 1.5R
            if (position.rValue >= this.config.breakevenRLevel &&
                Math.abs(position.stopLoss - position.entryPrice) > 0.01) {
                await this.moveStopToBreakeven(position);
            }
            // 2. Take partial profit at 2R
            if (position.rValue >= this.config.partialProfitRLevel) {
                await this.takePartialProfit(position);
            }
            // 3. Update trailing stop if profitable
            if (position.rValue > 0) {
                await this.updateTrailingStop(position);
            }
            // 4. Tighten stop after 48h
            const hoursOpen = (Date.now() - position.entryTime) / (1000 * 60 * 60);
            if (hoursOpen >= this.config.tightenAfterHours) {
                await this.tightenStopAfter48h(position);
            }
        }
        catch (error) {
            console.error(`‚ùå Error in position management for ${position.symbol}:`, error);
            this.emit('position:error', position, error);
        }
    }
    /**
     * Check if stop loss was hit
     * @param position - Position to check
     * @returns True if stop was hit
     */
    checkStopHit(position) {
        if (position.side === 'LONG') {
            return position.currentPrice <= position.stopLoss;
        }
        else {
            return position.currentPrice >= position.stopLoss;
        }
    }
    /**
     * Check if take profit was hit
     * @param position - Position to check
     * @returns True if target was hit
     */
    checkTargetHit(position) {
        if (position.side === 'LONG') {
            return position.currentPrice >= position.takeProfit;
        }
        else {
            return position.currentPrice <= position.takeProfit;
        }
    }
    /**
     * Start monitoring positions
     */
    startMonitoring() {
        if (this.updateInterval) {
            clearInterval(this.updateInterval);
        }
        this.updateInterval = setInterval(async () => {
            await this.updateAllPositions();
        }, this.UPDATE_FREQUENCY);
        console.log(`üìä Position Manager: Started monitoring (${this.UPDATE_FREQUENCY}ms interval)`);
    }
    /**
     * Stop monitoring positions
     */
    stopMonitoring() {
        if (this.updateInterval) {
            clearInterval(this.updateInterval);
            this.updateInterval = null;
        }
        console.log(`üìä Position Manager: Stopped monitoring`);
    }
    /**
     * Update all positions with current market data
     */
    async updateAllPositions() {
        const positions = Array.from(this.positions.values());
        for (const position of positions) {
            try {
                // Get current price from exchange
                const currentPrice = await this.bybitClient.getCurrentPrice(position.symbol);
                // Calculate unrealized P&L
                const priceDiff = position.side === 'LONG'
                    ? currentPrice - position.entryPrice
                    : position.entryPrice - currentPrice;
                const unrealizedPnL = priceDiff * position.quantity;
                // Update position
                this.updatePosition({
                    id: position.id,
                    currentPrice,
                    unrealizedPnL,
                    timestamp: Date.now()
                });
            }
            catch (error) {
                console.error(`‚ùå Failed to update position ${position.symbol}:`, error);
            }
        }
    }
    /**
     * Get position statistics
     * @returns Position statistics
     */
    getStatistics() {
        const positions = Array.from(this.positions.values());
        const openPositions = positions.filter(p => p.status === 'OPEN');
        const totalUnrealizedPnL = openPositions.reduce((sum, p) => sum + p.unrealizedPnL, 0);
        const totalRealizedPnL = positions.reduce((sum, p) => sum + p.realizedPnL, 0);
        const averageRValue = openPositions.length > 0
            ? openPositions.reduce((sum, p) => sum + p.rValue, 0) / openPositions.length
            : 0;
        return {
            totalPositions: positions.length,
            openPositions: openPositions.length,
            totalUnrealizedPnL,
            totalRealizedPnL,
            averageRValue
        };
    }
    /**
     * Update configuration
     * @param newConfig - New configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log(`üìä Position Manager: Configuration updated`);
    }
    /**
     * Emergency close all positions
     * @returns Promise with results
     */
    async emergencyCloseAll() {
        console.log(`üö® Emergency closing all positions`);
        const positions = Array.from(this.positions.values());
        let success = 0;
        let failed = 0;
        for (const position of positions) {
            try {
                const result = await this.closePosition(position, 'MANUAL');
                if (result) {
                    success++;
                }
                else {
                    failed++;
                }
            }
            catch (error) {
                console.error(`‚ùå Failed to emergency close ${position.symbol}:`, error);
                failed++;
            }
        }
        console.log(`üö® Emergency close complete: ${success} success, ${failed} failed`);
        return { success, failed };
    }
    /**
     * Cleanup resources
     */
    destroy() {
        this.stopMonitoring();
        this.positions.clear();
        this.removeAllListeners();
        console.log(`üìä Position Manager: Destroyed`);
    }
}
exports.PositionManager = PositionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL3Jpc2svUG9zaXRpb25NYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBRUgsbUNBQXNDO0FBNkJ0QyxNQUFhLGVBQWdCLFNBQVEscUJBQVk7SUFDdkMsU0FBUyxHQUEwQixJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQzdDLE1BQU0sQ0FBd0I7SUFDOUIsV0FBVyxDQUFtQjtJQUM5QixjQUFjLEdBQTBCLElBQUksQ0FBQztJQUNwQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsQ0FBQyxZQUFZO0lBRXRELFlBQVksV0FBNkIsRUFBRSxNQUF1QztRQUNoRixLQUFLLEVBQUUsQ0FBQztRQUVSLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixlQUFlLEVBQUUsR0FBRztZQUNwQixtQkFBbUIsRUFBRSxHQUFHO1lBQ3hCLHVCQUF1QixFQUFFLEVBQUU7WUFDM0Isb0JBQW9CLEVBQUUsR0FBRztZQUN6QixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLHFCQUFxQixFQUFFLEdBQUc7WUFDMUIsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVGLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLFdBQVcsQ0FBQyxRQUFrQjtRQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLFFBQVEsQ0FBQyxFQUFFLEtBQUssUUFBUSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztJQUMxRyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksY0FBYyxDQUFDLFVBQWtC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QztDQUNGO0FBdmhCRCwwQ0F1aEJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1waGFzZTItaHVudGVyL3NyYy9yaXNrL1Bvc2l0aW9uTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBvc2l0aW9uIE1hbmFnZXIgZm9yIFRpdGFuIFBoYXNlIDIgLSBUaGUgSHVudGVyXG4gKiBcbiAqIEhhbmRsZXMgYXV0b21hdGVkIHBvc2l0aW9uIG1hbmFnZW1lbnQgaW5jbHVkaW5nOlxuICogLSBNb3ZlIHN0b3AgdG8gYnJlYWtldmVuIGF0IDEuNVIgcHJvZml0XG4gKiAtIFRha2UgcGFydGlhbCBwcm9maXQgYXQgMlIgcHJvZml0ICg1MCUgY2xvc2UpXG4gKiAtIFVwZGF0ZSB0cmFpbGluZyBzdG9wIHdpdGggMSBBVFIgZGlzdGFuY2VcbiAqIC0gVGlnaHRlbiBzdG9wIGFmdGVyIDQ4aCB0byAwLjUgQVRSXG4gKiAtIENsb3NlIHBvc2l0aW9uIGZvciBzdG9wL3RhcmdldCBoaXRzXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMTIuMS0xMi43IChQb3NpdGlvbiBNYW5hZ2VtZW50KVxuICovXG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyBcbiAgUG9zaXRpb24sIFxuICBQb3NpdGlvblVwZGF0ZSwgXG4gIFRyYWlsaW5nU3RvcENvbmZpZywgXG4gIFBhcnRpYWxQcm9maXRDb25maWcsXG4gIE9yZGVyUGFyYW1zLFxuICBPcmRlclJlc3VsdFxufSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBCeWJpdFBlcnBzQ2xpZW50IH0gZnJvbSAnLi4vZXhjaGFuZ2VzL0J5Yml0UGVycHNDbGllbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBvc2l0aW9uTWFuYWdlckNvbmZpZyB7XG4gIGJyZWFrZXZlblJMZXZlbDogbnVtYmVyOyAvLyBSIGxldmVsIHRvIG1vdmUgc3RvcCB0byBicmVha2V2ZW4gKGRlZmF1bHQ6IDEuNSlcbiAgcGFydGlhbFByb2ZpdFJMZXZlbDogbnVtYmVyOyAvLyBSIGxldmVsIHRvIHRha2UgcGFydGlhbCBwcm9maXQgKGRlZmF1bHQ6IDIuMClcbiAgcGFydGlhbFByb2ZpdFBlcmNlbnRhZ2U6IG51bWJlcjsgLy8gUGVyY2VudGFnZSB0byBjbG9zZSBhdCBwYXJ0aWFsIChkZWZhdWx0OiA1MClcbiAgdHJhaWxpbmdTdG9wRGlzdGFuY2U6IG51bWJlcjsgLy8gQVRSIG11bHRpcGxpZXIgZm9yIHRyYWlsaW5nIHN0b3AgKGRlZmF1bHQ6IDEuMClcbiAgdGlnaHRlbkFmdGVySG91cnM6IG51bWJlcjsgLy8gSG91cnMgYWZ0ZXIgd2hpY2ggdG8gdGlnaHRlbiBzdG9wIChkZWZhdWx0OiA0OClcbiAgdGlnaHRlbmVkU3RvcERpc3RhbmNlOiBudW1iZXI7IC8vIEFUUiBtdWx0aXBsaWVyIGZvciB0aWdodGVuZWQgc3RvcCAoZGVmYXVsdDogMC41KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvc2l0aW9uTWFuYWdlckV2ZW50cyB7XG4gICdwb3NpdGlvbjpicmVha2V2ZW4nOiAocG9zaXRpb246IFBvc2l0aW9uKSA9PiB2b2lkO1xuICAncG9zaXRpb246cGFydGlhbCc6IChwb3NpdGlvbjogUG9zaXRpb24sIGNsb3NlZFF1YW50aXR5OiBudW1iZXIpID0+IHZvaWQ7XG4gICdwb3NpdGlvbjp0cmFpbGluZyc6IChwb3NpdGlvbjogUG9zaXRpb24sIG5ld1N0b3BMb3NzOiBudW1iZXIpID0+IHZvaWQ7XG4gICdwb3NpdGlvbjp0aWdodGVuZWQnOiAocG9zaXRpb246IFBvc2l0aW9uLCBuZXdTdG9wTG9zczogbnVtYmVyKSA9PiB2b2lkO1xuICAncG9zaXRpb246Y2xvc2VkJzogKHBvc2l0aW9uOiBQb3NpdGlvbiwgcmVhc29uOiAnU1RPUF9ISVQnIHwgJ1RBUkdFVF9ISVQnIHwgJ01BTlVBTCcpID0+IHZvaWQ7XG4gICdwb3NpdGlvbjplcnJvcic6IChwb3NpdGlvbjogUG9zaXRpb24sIGVycm9yOiBFcnJvcikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIFBvc2l0aW9uTWFuYWdlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgcG9zaXRpb25zOiBNYXA8c3RyaW5nLCBQb3NpdGlvbj4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY29uZmlnOiBQb3NpdGlvbk1hbmFnZXJDb25maWc7XG4gIHByaXZhdGUgYnliaXRDbGllbnQ6IEJ5Yml0UGVycHNDbGllbnQ7XG4gIHByaXZhdGUgdXBkYXRlSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgVVBEQVRFX0ZSRVFVRU5DWSA9IDUwMDA7IC8vIDUgc2Vjb25kc1xuXG4gIGNvbnN0cnVjdG9yKGJ5Yml0Q2xpZW50OiBCeWJpdFBlcnBzQ2xpZW50LCBjb25maWc/OiBQYXJ0aWFsPFBvc2l0aW9uTWFuYWdlckNvbmZpZz4pIHtcbiAgICBzdXBlcigpO1xuICAgIFxuICAgIHRoaXMuYnliaXRDbGllbnQgPSBieWJpdENsaWVudDtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIGJyZWFrZXZlblJMZXZlbDogMS41LFxuICAgICAgcGFydGlhbFByb2ZpdFJMZXZlbDogMi4wLFxuICAgICAgcGFydGlhbFByb2ZpdFBlcmNlbnRhZ2U6IDUwLFxuICAgICAgdHJhaWxpbmdTdG9wRGlzdGFuY2U6IDEuMCxcbiAgICAgIHRpZ2h0ZW5BZnRlckhvdXJzOiA0OCxcbiAgICAgIHRpZ2h0ZW5lZFN0b3BEaXN0YW5jZTogMC41LFxuICAgICAgLi4uY29uZmlnXG4gICAgfTtcblxuICAgIC8vIFN0YXJ0IHBvc2l0aW9uIG1vbml0b3JpbmdcbiAgICB0aGlzLnN0YXJ0TW9uaXRvcmluZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBwb3NpdGlvbiB0byBtYW5hZ2VtZW50XG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIG1hbmFnZVxuICAgKi9cbiAgcHVibGljIGFkZFBvc2l0aW9uKHBvc2l0aW9uOiBQb3NpdGlvbik6IHZvaWQge1xuICAgIHRoaXMucG9zaXRpb25zLnNldChwb3NpdGlvbi5pZCwgeyAuLi5wb3NpdGlvbiB9KTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBQb3NpdGlvbiBNYW5hZ2VyOiBBZGRlZCBwb3NpdGlvbiAke3Bvc2l0aW9uLmlkfSAoJHtwb3NpdGlvbi5zeW1ib2x9ICR7cG9zaXRpb24uc2lkZX0pYCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgcG9zaXRpb24gZnJvbSBtYW5hZ2VtZW50XG4gICAqIEBwYXJhbSBwb3NpdGlvbklkIC0gUG9zaXRpb24gSUQgdG8gcmVtb3ZlXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlUG9zaXRpb24ocG9zaXRpb25JZDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9ucy5nZXQocG9zaXRpb25JZCk7XG4gICAgaWYgKHBvc2l0aW9uKSB7XG4gICAgICB0aGlzLnBvc2l0aW9ucy5kZWxldGUocG9zaXRpb25JZCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBQb3NpdGlvbiBNYW5hZ2VyOiBSZW1vdmVkIHBvc2l0aW9uICR7cG9zaXRpb25JZH1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBtYW5hZ2VkIHBvc2l0aW9uc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBtYW5hZ2VkIHBvc2l0aW9uc1xuICAgKi9cbiAgcHVibGljIGdldFBvc2l0aW9ucygpOiBQb3NpdGlvbltdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnBvc2l0aW9ucy52YWx1ZXMoKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgc3BlY2lmaWMgcG9zaXRpb25cbiAgICogQHBhcmFtIHBvc2l0aW9uSWQgLSBQb3NpdGlvbiBJRFxuICAgKiBAcmV0dXJucyBQb3NpdGlvbiBvciB1bmRlZmluZWRcbiAgICovXG4gIHB1YmxpYyBnZXRQb3NpdGlvbihwb3NpdGlvbklkOiBzdHJpbmcpOiBQb3NpdGlvbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmdldChwb3NpdGlvbklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcG9zaXRpb24gd2l0aCBjdXJyZW50IG1hcmtldCBkYXRhXG4gICAqIEBwYXJhbSB1cGRhdGUgLSBQb3NpdGlvbiB1cGRhdGUgZGF0YVxuICAgKi9cbiAgcHVibGljIHVwZGF0ZVBvc2l0aW9uKHVwZGF0ZTogUG9zaXRpb25VcGRhdGUpOiB2b2lkIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMucG9zaXRpb25zLmdldCh1cGRhdGUuaWQpO1xuICAgIGlmICghcG9zaXRpb24pIHJldHVybjtcblxuICAgIC8vIFVwZGF0ZSBjdXJyZW50IHByaWNlIGFuZCBQJkxcbiAgICBwb3NpdGlvbi5jdXJyZW50UHJpY2UgPSB1cGRhdGUuY3VycmVudFByaWNlO1xuICAgIHBvc2l0aW9uLnVucmVhbGl6ZWRQbkwgPSB1cGRhdGUudW5yZWFsaXplZFBuTDtcblxuICAgIC8vIENhbGN1bGF0ZSBjdXJyZW50IFIgdmFsdWVcbiAgICBjb25zdCByaXNrQW1vdW50ID0gTWF0aC5hYnMocG9zaXRpb24uZW50cnlQcmljZSAtIHBvc2l0aW9uLnN0b3BMb3NzKSAqIHBvc2l0aW9uLnF1YW50aXR5O1xuICAgIGlmIChyaXNrQW1vdW50ID4gMCkge1xuICAgICAgcG9zaXRpb24uclZhbHVlID0gdXBkYXRlLnVucmVhbGl6ZWRQbkwgLyByaXNrQW1vdW50O1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBwb3NpdGlvbiBpbiBtYXBcbiAgICB0aGlzLnBvc2l0aW9ucy5zZXQodXBkYXRlLmlkLCBwb3NpdGlvbik7XG5cbiAgICAvLyBDaGVjayBmb3IgbWFuYWdlbWVudCBhY3Rpb25zXG4gICAgdGhpcy5jaGVja1Bvc2l0aW9uTWFuYWdlbWVudChwb3NpdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBzdG9wIGxvc3MgdG8gYnJlYWtldmVuIGF0IDEuNVIgcHJvZml0XG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIHVwZGF0ZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBtb3ZlU3RvcFRvQnJlYWtldmVuKHBvc2l0aW9uOiBQb3NpdGlvbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBhbHJlYWR5IGF0IGJyZWFrZXZlblxuICAgICAgaWYgKE1hdGguYWJzKHBvc2l0aW9uLnN0b3BMb3NzIC0gcG9zaXRpb24uZW50cnlQcmljZSkgPCAwLjAxKSB7XG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBBbHJlYWR5IGF0IGJyZWFrZXZlblxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBwb3NpdGlvbiBoYXMgcmVhY2hlZCAxLjVSIHByb2ZpdFxuICAgICAgaWYgKHBvc2l0aW9uLnJWYWx1ZSA8IHRoaXMuY29uZmlnLmJyZWFrZXZlblJMZXZlbCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIE5vdCBwcm9maXRhYmxlIGVub3VnaCB5ZXRcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfjq8gTW92aW5nIHN0b3AgdG8gYnJlYWtldmVuIGZvciAke3Bvc2l0aW9uLnN5bWJvbH0gYXQgJHtwb3NpdGlvbi5yVmFsdWUudG9GaXhlZCgyKX1SYCk7XG5cbiAgICAgIC8vIFNldCBzdG9wIGxvc3MgdG8gZW50cnkgcHJpY2UgKGJyZWFrZXZlbilcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLmJ5Yml0Q2xpZW50LnNldFN0b3BMb3NzKHBvc2l0aW9uLnN5bWJvbCwgcG9zaXRpb24uZW50cnlQcmljZSk7XG4gICAgICBcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHBvc2l0aW9uLnN0b3BMb3NzID0gcG9zaXRpb24uZW50cnlQcmljZTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbnMuc2V0KHBvc2l0aW9uLmlkLCBwb3NpdGlvbik7XG4gICAgICAgIHRoaXMuZW1pdCgncG9zaXRpb246YnJlYWtldmVuJywgcG9zaXRpb24pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBTdG9wIG1vdmVkIHRvIGJyZWFrZXZlbjogJHtwb3NpdGlvbi5zeW1ib2x9IEAgJHtwb3NpdGlvbi5lbnRyeVByaWNlfWApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIG1vdmUgc3RvcCB0byBicmVha2V2ZW4gZm9yICR7cG9zaXRpb24uc3ltYm9sfTpgLCBlcnJvcik7XG4gICAgICB0aGlzLmVtaXQoJ3Bvc2l0aW9uOmVycm9yJywgcG9zaXRpb24sIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBwYXJ0aWFsIHByb2ZpdCBhdCAyUiBwcm9maXQgKDUwJSBjbG9zZSlcbiAgICogQHBhcmFtIHBvc2l0aW9uIC0gUG9zaXRpb24gdG8gcGFydGlhbGx5IGNsb3NlXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCBzdWNjZXNzIHN0YXR1c1xuICAgKi9cbiAgcHVibGljIGFzeW5jIHRha2VQYXJ0aWFsUHJvZml0KHBvc2l0aW9uOiBQb3NpdGlvbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBwb3NpdGlvbiBoYXMgcmVhY2hlZCAyUiBwcm9maXRcbiAgICAgIGlmIChwb3NpdGlvbi5yVmFsdWUgPCB0aGlzLmNvbmZpZy5wYXJ0aWFsUHJvZml0UkxldmVsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTsgLy8gTm90IHByb2ZpdGFibGUgZW5vdWdoIHlldFxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBwYXJ0aWFsIHByb2ZpdCBhbHJlYWR5IHRha2VuIChxdWFudGl0eSB3b3VsZCBiZSByZWR1Y2VkKVxuICAgICAgY29uc3Qgb3JpZ2luYWxRdWFudGl0eSA9IHBvc2l0aW9uLnF1YW50aXR5O1xuICAgICAgY29uc3QgcGFydGlhbFF1YW50aXR5ID0gb3JpZ2luYWxRdWFudGl0eSAqICh0aGlzLmNvbmZpZy5wYXJ0aWFsUHJvZml0UGVyY2VudGFnZSAvIDEwMCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn5KwIFRha2luZyBwYXJ0aWFsIHByb2ZpdCBmb3IgJHtwb3NpdGlvbi5zeW1ib2x9IGF0ICR7cG9zaXRpb24uclZhbHVlLnRvRml4ZWQoMil9UmApO1xuXG4gICAgICAvLyBQbGFjZSBtYXJrZXQgb3JkZXIgdG8gY2xvc2UgcGFydGlhbCBwb3NpdGlvblxuICAgICAgY29uc3Qgb3JkZXJQYXJhbXM6IE9yZGVyUGFyYW1zID0ge1xuICAgICAgICBwaGFzZTogJ3BoYXNlMicsXG4gICAgICAgIHN5bWJvbDogcG9zaXRpb24uc3ltYm9sLFxuICAgICAgICBzaWRlOiBwb3NpdGlvbi5zaWRlID09PSAnTE9ORycgPyAnU2VsbCcgOiAnQnV5JyxcbiAgICAgICAgdHlwZTogJ01BUktFVCcsXG4gICAgICAgIHF0eTogcGFydGlhbFF1YW50aXR5LFxuICAgICAgICBsZXZlcmFnZTogcG9zaXRpb24ubGV2ZXJhZ2VcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYnliaXRDbGllbnQucGxhY2VPcmRlcldpdGhSZXRyeShvcmRlclBhcmFtcyk7XG4gICAgICBcbiAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAnRklMTEVEJykge1xuICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb24gcXVhbnRpdHlcbiAgICAgICAgcG9zaXRpb24ucXVhbnRpdHkgLT0gcGFydGlhbFF1YW50aXR5O1xuICAgICAgICBwb3NpdGlvbi5yZWFsaXplZFBuTCArPSAocGFydGlhbFF1YW50aXR5ICogKHBvc2l0aW9uLmN1cnJlbnRQcmljZSAtIHBvc2l0aW9uLmVudHJ5UHJpY2UpKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMucG9zaXRpb25zLnNldChwb3NpdGlvbi5pZCwgcG9zaXRpb24pO1xuICAgICAgICB0aGlzLmVtaXQoJ3Bvc2l0aW9uOnBhcnRpYWwnLCBwb3NpdGlvbiwgcGFydGlhbFF1YW50aXR5KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgUGFydGlhbCBwcm9maXQgdGFrZW46ICR7cG9zaXRpb24uc3ltYm9sfSBjbG9zZWQgJHtwYXJ0aWFsUXVhbnRpdHl9IGF0ICR7cmVzdWx0LnByaWNlfWApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIHRha2UgcGFydGlhbCBwcm9maXQgZm9yICR7cG9zaXRpb24uc3ltYm9sfTpgLCBlcnJvcik7XG4gICAgICB0aGlzLmVtaXQoJ3Bvc2l0aW9uOmVycm9yJywgcG9zaXRpb24sIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRyYWlsaW5nIHN0b3Agd2l0aCAxIEFUUiBkaXN0YW5jZVxuICAgKiBAcGFyYW0gcG9zaXRpb24gLSBQb3NpdGlvbiB0byB1cGRhdGUgdHJhaWxpbmcgc3RvcFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyB1cGRhdGVUcmFpbGluZ1N0b3AocG9zaXRpb246IFBvc2l0aW9uKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIE9ubHkgdHJhaWwgaWYgcG9zaXRpb24gaXMgcHJvZml0YWJsZVxuICAgICAgaWYgKHBvc2l0aW9uLnJWYWx1ZSA8PSAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXRyRGlzdGFuY2UgPSBwb3NpdGlvbi5hdHIgKiB0aGlzLmNvbmZpZy50cmFpbGluZ1N0b3BEaXN0YW5jZTtcbiAgICAgIGxldCBuZXdTdG9wTG9zczogbnVtYmVyO1xuXG4gICAgICBpZiAocG9zaXRpb24uc2lkZSA9PT0gJ0xPTkcnKSB7XG4gICAgICAgIC8vIEZvciBsb25nIHBvc2l0aW9ucywgdHJhaWwgc3RvcCB1cFxuICAgICAgICBuZXdTdG9wTG9zcyA9IHBvc2l0aW9uLmN1cnJlbnRQcmljZSAtIGF0ckRpc3RhbmNlO1xuICAgICAgICBcbiAgICAgICAgLy8gT25seSB1cGRhdGUgaWYgbmV3IHN0b3AgaXMgaGlnaGVyIHRoYW4gY3VycmVudCBzdG9wXG4gICAgICAgIGlmIChuZXdTdG9wTG9zcyA8PSBwb3NpdGlvbi5zdG9wTG9zcykge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRm9yIHNob3J0IHBvc2l0aW9ucywgdHJhaWwgc3RvcCBkb3duXG4gICAgICAgIG5ld1N0b3BMb3NzID0gcG9zaXRpb24uY3VycmVudFByaWNlICsgYXRyRGlzdGFuY2U7XG4gICAgICAgIFxuICAgICAgICAvLyBPbmx5IHVwZGF0ZSBpZiBuZXcgc3RvcCBpcyBsb3dlciB0aGFuIGN1cnJlbnQgc3RvcFxuICAgICAgICBpZiAobmV3U3RvcExvc3MgPj0gcG9zaXRpb24uc3RvcExvc3MpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfk4ggVXBkYXRpbmcgdHJhaWxpbmcgc3RvcCBmb3IgJHtwb3NpdGlvbi5zeW1ib2x9OiAke3Bvc2l0aW9uLnN0b3BMb3NzLnRvRml4ZWQoMil9IOKGkiAke25ld1N0b3BMb3NzLnRvRml4ZWQoMil9YCk7XG5cbiAgICAgIC8vIFNldCBuZXcgc3RvcCBsb3NzXG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5ieWJpdENsaWVudC5zZXRTdG9wTG9zcyhwb3NpdGlvbi5zeW1ib2wsIG5ld1N0b3BMb3NzKTtcbiAgICAgIFxuICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgcG9zaXRpb24uc3RvcExvc3MgPSBuZXdTdG9wTG9zcztcbiAgICAgICAgdGhpcy5wb3NpdGlvbnMuc2V0KHBvc2l0aW9uLmlkLCBwb3NpdGlvbik7XG4gICAgICAgIHRoaXMuZW1pdCgncG9zaXRpb246dHJhaWxpbmcnLCBwb3NpdGlvbiwgbmV3U3RvcExvc3MpO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBUcmFpbGluZyBzdG9wIHVwZGF0ZWQ6ICR7cG9zaXRpb24uc3ltYm9sfSBAICR7bmV3U3RvcExvc3MudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byB1cGRhdGUgdHJhaWxpbmcgc3RvcCBmb3IgJHtwb3NpdGlvbi5zeW1ib2x9OmAsIGVycm9yKTtcbiAgICAgIHRoaXMuZW1pdCgncG9zaXRpb246ZXJyb3InLCBwb3NpdGlvbiwgZXJyb3IgYXMgRXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaWdodGVuIHN0b3AgbG9zcyB0byAwLjUgQVRSIGFmdGVyIDQ4IGhvdXJzXG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIHRpZ2h0ZW4gc3RvcFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyB0aWdodGVuU3RvcEFmdGVyNDhoKHBvc2l0aW9uOiBQb3NpdGlvbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBwb3NpdGlvbiBpcyBvbGRlciB0aGFuIGNvbmZpZ3VyZWQgaG91cnNcbiAgICAgIGNvbnN0IGhvdXJzT3BlbiA9IChEYXRlLm5vdygpIC0gcG9zaXRpb24uZW50cnlUaW1lKSAvICgxMDAwICogNjAgKiA2MCk7XG4gICAgICBpZiAoaG91cnNPcGVuIDwgdGhpcy5jb25maWcudGlnaHRlbkFmdGVySG91cnMpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBOb3Qgb2xkIGVub3VnaCB5ZXRcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGlnaHRlbmVkRGlzdGFuY2UgPSBwb3NpdGlvbi5hdHIgKiB0aGlzLmNvbmZpZy50aWdodGVuZWRTdG9wRGlzdGFuY2U7XG4gICAgICBsZXQgbmV3U3RvcExvc3M6IG51bWJlcjtcblxuICAgICAgaWYgKHBvc2l0aW9uLnNpZGUgPT09ICdMT05HJykge1xuICAgICAgICBuZXdTdG9wTG9zcyA9IHBvc2l0aW9uLmN1cnJlbnRQcmljZSAtIHRpZ2h0ZW5lZERpc3RhbmNlO1xuICAgICAgICBcbiAgICAgICAgLy8gT25seSB0aWdodGVuIGlmIG5ldyBzdG9wIGlzIGhpZ2hlciB0aGFuIGN1cnJlbnQgc3RvcFxuICAgICAgICBpZiAobmV3U3RvcExvc3MgPD0gcG9zaXRpb24uc3RvcExvc3MpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1N0b3BMb3NzID0gcG9zaXRpb24uY3VycmVudFByaWNlICsgdGlnaHRlbmVkRGlzdGFuY2U7XG4gICAgICAgIFxuICAgICAgICAvLyBPbmx5IHRpZ2h0ZW4gaWYgbmV3IHN0b3AgaXMgbG93ZXIgdGhhbiBjdXJyZW50IHN0b3BcbiAgICAgICAgaWYgKG5ld1N0b3BMb3NzID49IHBvc2l0aW9uLnN0b3BMb3NzKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDij7AgVGlnaHRlbmluZyBzdG9wIGFmdGVyICR7aG91cnNPcGVuLnRvRml4ZWQoMSl9aCBmb3IgJHtwb3NpdGlvbi5zeW1ib2x9OiAke3Bvc2l0aW9uLnN0b3BMb3NzLnRvRml4ZWQoMil9IOKGkiAke25ld1N0b3BMb3NzLnRvRml4ZWQoMil9YCk7XG5cbiAgICAgIC8vIFNldCB0aWdodGVuZWQgc3RvcCBsb3NzXG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5ieWJpdENsaWVudC5zZXRTdG9wTG9zcyhwb3NpdGlvbi5zeW1ib2wsIG5ld1N0b3BMb3NzKTtcbiAgICAgIFxuICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgcG9zaXRpb24uc3RvcExvc3MgPSBuZXdTdG9wTG9zcztcbiAgICAgICAgdGhpcy5wb3NpdGlvbnMuc2V0KHBvc2l0aW9uLmlkLCBwb3NpdGlvbik7XG4gICAgICAgIHRoaXMuZW1pdCgncG9zaXRpb246dGlnaHRlbmVkJywgcG9zaXRpb24sIG5ld1N0b3BMb3NzKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgU3RvcCB0aWdodGVuZWQ6ICR7cG9zaXRpb24uc3ltYm9sfSBAICR7bmV3U3RvcExvc3MudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byB0aWdodGVuIHN0b3AgZm9yICR7cG9zaXRpb24uc3ltYm9sfTpgLCBlcnJvcik7XG4gICAgICB0aGlzLmVtaXQoJ3Bvc2l0aW9uOmVycm9yJywgcG9zaXRpb24sIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2UgcG9zaXRpb24gZm9yIHN0b3AvdGFyZ2V0IGhpdHNcbiAgICogQHBhcmFtIHBvc2l0aW9uIC0gUG9zaXRpb24gdG8gY2xvc2VcbiAgICogQHBhcmFtIHJlYXNvbiAtIFJlYXNvbiBmb3IgY2xvc2luZ1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjbG9zZVBvc2l0aW9uKHBvc2l0aW9uOiBQb3NpdGlvbiwgcmVhc29uOiAnU1RPUF9ISVQnIHwgJ1RBUkdFVF9ISVQnIHwgJ01BTlVBTCcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coYPCfmqogQ2xvc2luZyBwb3NpdGlvbiAke3Bvc2l0aW9uLnN5bWJvbH0gLSBSZWFzb246ICR7cmVhc29ufWApO1xuXG4gICAgICAvLyBQbGFjZSBtYXJrZXQgb3JkZXIgdG8gY2xvc2UgZW50aXJlIHBvc2l0aW9uXG4gICAgICBjb25zdCBvcmRlclBhcmFtczogT3JkZXJQYXJhbXMgPSB7XG4gICAgICAgIHBoYXNlOiAncGhhc2UyJyxcbiAgICAgICAgc3ltYm9sOiBwb3NpdGlvbi5zeW1ib2wsXG4gICAgICAgIHNpZGU6IHBvc2l0aW9uLnNpZGUgPT09ICdMT05HJyA/ICdTZWxsJyA6ICdCdXknLFxuICAgICAgICB0eXBlOiAnTUFSS0VUJyxcbiAgICAgICAgcXR5OiBwb3NpdGlvbi5xdWFudGl0eSxcbiAgICAgICAgbGV2ZXJhZ2U6IHBvc2l0aW9uLmxldmVyYWdlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmJ5Yml0Q2xpZW50LnBsYWNlT3JkZXJXaXRoUmV0cnkob3JkZXJQYXJhbXMpO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gJ0ZJTExFRCcpIHtcbiAgICAgICAgLy8gVXBkYXRlIHBvc2l0aW9uIHN0YXR1c1xuICAgICAgICBwb3NpdGlvbi5zdGF0dXMgPSAnQ0xPU0VEJztcbiAgICAgICAgcG9zaXRpb24ucmVhbGl6ZWRQbkwgKz0gKHBvc2l0aW9uLnF1YW50aXR5ICogKHJlc3VsdC5wcmljZSAtIHBvc2l0aW9uLmVudHJ5UHJpY2UpKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlbW92ZSBmcm9tIGFjdGl2ZSBtYW5hZ2VtZW50XG4gICAgICAgIHRoaXMucG9zaXRpb25zLmRlbGV0ZShwb3NpdGlvbi5pZCk7XG4gICAgICAgIHRoaXMuZW1pdCgncG9zaXRpb246Y2xvc2VkJywgcG9zaXRpb24sIHJlYXNvbik7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFBvc2l0aW9uIGNsb3NlZDogJHtwb3NpdGlvbi5zeW1ib2x9IGF0ICR7cmVzdWx0LnByaWNlfSAoJHtyZWFzb259KWApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIGNsb3NlIHBvc2l0aW9uICR7cG9zaXRpb24uc3ltYm9sfTpgLCBlcnJvcik7XG4gICAgICB0aGlzLmVtaXQoJ3Bvc2l0aW9uOmVycm9yJywgcG9zaXRpb24sIGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcG9zaXRpb24gbmVlZHMgbWFuYWdlbWVudCBhY3Rpb25zXG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIGNoZWNrXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrUG9zaXRpb25NYW5hZ2VtZW50KHBvc2l0aW9uOiBQb3NpdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBmb3Igc3RvcC90YXJnZXQgaGl0cyBmaXJzdFxuICAgICAgaWYgKHRoaXMuY2hlY2tTdG9wSGl0KHBvc2l0aW9uKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsb3NlUG9zaXRpb24ocG9zaXRpb24sICdTVE9QX0hJVCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNoZWNrVGFyZ2V0SGl0KHBvc2l0aW9uKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmNsb3NlUG9zaXRpb24ocG9zaXRpb24sICdUQVJHRVRfSElUJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIG1hbmFnZW1lbnQgYWN0aW9ucyAoaW4gb3JkZXIgb2YgcHJpb3JpdHkpXG4gICAgICBcbiAgICAgIC8vIDEuIE1vdmUgdG8gYnJlYWtldmVuIGF0IDEuNVJcbiAgICAgIGlmIChwb3NpdGlvbi5yVmFsdWUgPj0gdGhpcy5jb25maWcuYnJlYWtldmVuUkxldmVsICYmIFxuICAgICAgICAgIE1hdGguYWJzKHBvc2l0aW9uLnN0b3BMb3NzIC0gcG9zaXRpb24uZW50cnlQcmljZSkgPiAwLjAxKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubW92ZVN0b3BUb0JyZWFrZXZlbihwb3NpdGlvbik7XG4gICAgICB9XG5cbiAgICAgIC8vIDIuIFRha2UgcGFydGlhbCBwcm9maXQgYXQgMlJcbiAgICAgIGlmIChwb3NpdGlvbi5yVmFsdWUgPj0gdGhpcy5jb25maWcucGFydGlhbFByb2ZpdFJMZXZlbCkge1xuICAgICAgICBhd2FpdCB0aGlzLnRha2VQYXJ0aWFsUHJvZml0KHBvc2l0aW9uKTtcbiAgICAgIH1cblxuICAgICAgLy8gMy4gVXBkYXRlIHRyYWlsaW5nIHN0b3AgaWYgcHJvZml0YWJsZVxuICAgICAgaWYgKHBvc2l0aW9uLnJWYWx1ZSA+IDApIHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVUcmFpbGluZ1N0b3AocG9zaXRpb24pO1xuICAgICAgfVxuXG4gICAgICAvLyA0LiBUaWdodGVuIHN0b3AgYWZ0ZXIgNDhoXG4gICAgICBjb25zdCBob3Vyc09wZW4gPSAoRGF0ZS5ub3coKSAtIHBvc2l0aW9uLmVudHJ5VGltZSkgLyAoMTAwMCAqIDYwICogNjApO1xuICAgICAgaWYgKGhvdXJzT3BlbiA+PSB0aGlzLmNvbmZpZy50aWdodGVuQWZ0ZXJIb3Vycykge1xuICAgICAgICBhd2FpdCB0aGlzLnRpZ2h0ZW5TdG9wQWZ0ZXI0OGgocG9zaXRpb24pO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBpbiBwb3NpdGlvbiBtYW5hZ2VtZW50IGZvciAke3Bvc2l0aW9uLnN5bWJvbH06YCwgZXJyb3IpO1xuICAgICAgdGhpcy5lbWl0KCdwb3NpdGlvbjplcnJvcicsIHBvc2l0aW9uLCBlcnJvciBhcyBFcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHN0b3AgbG9zcyB3YXMgaGl0XG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIGNoZWNrXG4gICAqIEByZXR1cm5zIFRydWUgaWYgc3RvcCB3YXMgaGl0XG4gICAqL1xuICBwcml2YXRlIGNoZWNrU3RvcEhpdChwb3NpdGlvbjogUG9zaXRpb24pOiBib29sZWFuIHtcbiAgICBpZiAocG9zaXRpb24uc2lkZSA9PT0gJ0xPTkcnKSB7XG4gICAgICByZXR1cm4gcG9zaXRpb24uY3VycmVudFByaWNlIDw9IHBvc2l0aW9uLnN0b3BMb3NzO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcG9zaXRpb24uY3VycmVudFByaWNlID49IHBvc2l0aW9uLnN0b3BMb3NzO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0YWtlIHByb2ZpdCB3YXMgaGl0XG4gICAqIEBwYXJhbSBwb3NpdGlvbiAtIFBvc2l0aW9uIHRvIGNoZWNrXG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGFyZ2V0IHdhcyBoaXRcbiAgICovXG4gIHByaXZhdGUgY2hlY2tUYXJnZXRIaXQocG9zaXRpb246IFBvc2l0aW9uKTogYm9vbGVhbiB7XG4gICAgaWYgKHBvc2l0aW9uLnNpZGUgPT09ICdMT05HJykge1xuICAgICAgcmV0dXJuIHBvc2l0aW9uLmN1cnJlbnRQcmljZSA+PSBwb3NpdGlvbi50YWtlUHJvZml0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcG9zaXRpb24uY3VycmVudFByaWNlIDw9IHBvc2l0aW9uLnRha2VQcm9maXQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IG1vbml0b3JpbmcgcG9zaXRpb25zXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0TW9uaXRvcmluZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy51cGRhdGVJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZUludGVydmFsKTtcbiAgICB9XG5cbiAgICB0aGlzLnVwZGF0ZUludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVBbGxQb3NpdGlvbnMoKTtcbiAgICB9LCB0aGlzLlVQREFURV9GUkVRVUVOQ1kpO1xuXG4gICAgY29uc29sZS5sb2coYPCfk4ogUG9zaXRpb24gTWFuYWdlcjogU3RhcnRlZCBtb25pdG9yaW5nICgke3RoaXMuVVBEQVRFX0ZSRVFVRU5DWX1tcyBpbnRlcnZhbClgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIG1vbml0b3JpbmcgcG9zaXRpb25zXG4gICAqL1xuICBwdWJsaWMgc3RvcE1vbml0b3JpbmcoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudXBkYXRlSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVJbnRlcnZhbCk7XG4gICAgICB0aGlzLnVwZGF0ZUludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgY29uc29sZS5sb2coYPCfk4ogUG9zaXRpb24gTWFuYWdlcjogU3RvcHBlZCBtb25pdG9yaW5nYCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGFsbCBwb3NpdGlvbnMgd2l0aCBjdXJyZW50IG1hcmtldCBkYXRhXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUFsbFBvc2l0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwb3NpdGlvbnMgPSBBcnJheS5mcm9tKHRoaXMucG9zaXRpb25zLnZhbHVlcygpKTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IHBvc2l0aW9uIG9mIHBvc2l0aW9ucykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgcHJpY2UgZnJvbSBleGNoYW5nZVxuICAgICAgICBjb25zdCBjdXJyZW50UHJpY2UgPSBhd2FpdCB0aGlzLmJ5Yml0Q2xpZW50LmdldEN1cnJlbnRQcmljZShwb3NpdGlvbi5zeW1ib2wpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHVucmVhbGl6ZWQgUCZMXG4gICAgICAgIGNvbnN0IHByaWNlRGlmZiA9IHBvc2l0aW9uLnNpZGUgPT09ICdMT05HJyBcbiAgICAgICAgICA/IGN1cnJlbnRQcmljZSAtIHBvc2l0aW9uLmVudHJ5UHJpY2VcbiAgICAgICAgICA6IHBvc2l0aW9uLmVudHJ5UHJpY2UgLSBjdXJyZW50UHJpY2U7XG4gICAgICAgIGNvbnN0IHVucmVhbGl6ZWRQbkwgPSBwcmljZURpZmYgKiBwb3NpdGlvbi5xdWFudGl0eTtcblxuICAgICAgICAvLyBVcGRhdGUgcG9zaXRpb25cbiAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbih7XG4gICAgICAgICAgaWQ6IHBvc2l0aW9uLmlkLFxuICAgICAgICAgIGN1cnJlbnRQcmljZSxcbiAgICAgICAgICB1bnJlYWxpemVkUG5MLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgICB9KTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byB1cGRhdGUgcG9zaXRpb24gJHtwb3NpdGlvbi5zeW1ib2x9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBvc2l0aW9uIHN0YXRpc3RpY3NcbiAgICogQHJldHVybnMgUG9zaXRpb24gc3RhdGlzdGljc1xuICAgKi9cbiAgcHVibGljIGdldFN0YXRpc3RpY3MoKToge1xuICAgIHRvdGFsUG9zaXRpb25zOiBudW1iZXI7XG4gICAgb3BlblBvc2l0aW9uczogbnVtYmVyO1xuICAgIHRvdGFsVW5yZWFsaXplZFBuTDogbnVtYmVyO1xuICAgIHRvdGFsUmVhbGl6ZWRQbkw6IG51bWJlcjtcbiAgICBhdmVyYWdlUlZhbHVlOiBudW1iZXI7XG4gIH0ge1xuICAgIGNvbnN0IHBvc2l0aW9ucyA9IEFycmF5LmZyb20odGhpcy5wb3NpdGlvbnMudmFsdWVzKCkpO1xuICAgIGNvbnN0IG9wZW5Qb3NpdGlvbnMgPSBwb3NpdGlvbnMuZmlsdGVyKHAgPT4gcC5zdGF0dXMgPT09ICdPUEVOJyk7XG4gICAgXG4gICAgY29uc3QgdG90YWxVbnJlYWxpemVkUG5MID0gb3BlblBvc2l0aW9ucy5yZWR1Y2UoKHN1bSwgcCkgPT4gc3VtICsgcC51bnJlYWxpemVkUG5MLCAwKTtcbiAgICBjb25zdCB0b3RhbFJlYWxpemVkUG5MID0gcG9zaXRpb25zLnJlZHVjZSgoc3VtLCBwKSA9PiBzdW0gKyBwLnJlYWxpemVkUG5MLCAwKTtcbiAgICBjb25zdCBhdmVyYWdlUlZhbHVlID0gb3BlblBvc2l0aW9ucy5sZW5ndGggPiAwIFxuICAgICAgPyBvcGVuUG9zaXRpb25zLnJlZHVjZSgoc3VtLCBwKSA9PiBzdW0gKyBwLnJWYWx1ZSwgMCkgLyBvcGVuUG9zaXRpb25zLmxlbmd0aCBcbiAgICAgIDogMDtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbFBvc2l0aW9uczogcG9zaXRpb25zLmxlbmd0aCxcbiAgICAgIG9wZW5Qb3NpdGlvbnM6IG9wZW5Qb3NpdGlvbnMubGVuZ3RoLFxuICAgICAgdG90YWxVbnJlYWxpemVkUG5MLFxuICAgICAgdG90YWxSZWFsaXplZFBuTCxcbiAgICAgIGF2ZXJhZ2VSVmFsdWVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBjb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSBuZXdDb25maWcgLSBOZXcgY29uZmlndXJhdGlvblxuICAgKi9cbiAgcHVibGljIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8UG9zaXRpb25NYW5hZ2VyQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4ubmV3Q29uZmlnIH07XG4gICAgY29uc29sZS5sb2coYPCfk4ogUG9zaXRpb24gTWFuYWdlcjogQ29uZmlndXJhdGlvbiB1cGRhdGVkYCk7XG4gIH1cblxuICAvKipcbiAgICogRW1lcmdlbmN5IGNsb3NlIGFsbCBwb3NpdGlvbnNcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHJlc3VsdHNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBlbWVyZ2VuY3lDbG9zZUFsbCgpOiBQcm9taXNlPHsgc3VjY2VzczogbnVtYmVyOyBmYWlsZWQ6IG51bWJlciB9PiB7XG4gICAgY29uc29sZS5sb2coYPCfmqggRW1lcmdlbmN5IGNsb3NpbmcgYWxsIHBvc2l0aW9uc2ApO1xuICAgIFxuICAgIGNvbnN0IHBvc2l0aW9ucyA9IEFycmF5LmZyb20odGhpcy5wb3NpdGlvbnMudmFsdWVzKCkpO1xuICAgIGxldCBzdWNjZXNzID0gMDtcbiAgICBsZXQgZmFpbGVkID0gMDtcblxuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgcG9zaXRpb25zKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsb3NlUG9zaXRpb24ocG9zaXRpb24sICdNQU5VQUwnKTtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHN1Y2Nlc3MrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmYWlsZWQrKztcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBlbWVyZ2VuY3kgY2xvc2UgJHtwb3NpdGlvbi5zeW1ib2x9OmAsIGVycm9yKTtcbiAgICAgICAgZmFpbGVkKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfmqggRW1lcmdlbmN5IGNsb3NlIGNvbXBsZXRlOiAke3N1Y2Nlc3N9IHN1Y2Nlc3MsICR7ZmFpbGVkfSBmYWlsZWRgKTtcbiAgICByZXR1cm4geyBzdWNjZXNzLCBmYWlsZWQgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIHJlc291cmNlc1xuICAgKi9cbiAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wTW9uaXRvcmluZygpO1xuICAgIHRoaXMucG9zaXRpb25zLmNsZWFyKCk7XG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBQb3NpdGlvbiBNYW5hZ2VyOiBEZXN0cm95ZWRgKTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgZXZlbnQgaW50ZXJmYWNlIGZvciBUeXBlU2NyaXB0XG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgUG9zaXRpb25NYW5hZ2VyIHtcbiAgb248VSBleHRlbmRzIGtleW9mIFBvc2l0aW9uTWFuYWdlckV2ZW50cz4oZXZlbnQ6IFUsIGxpc3RlbmVyOiBQb3NpdGlvbk1hbmFnZXJFdmVudHNbVV0pOiB0aGlzO1xuICBlbWl0PFUgZXh0ZW5kcyBrZXlvZiBQb3NpdGlvbk1hbmFnZXJFdmVudHM+KGV2ZW50OiBVLCAuLi5hcmdzOiBQYXJhbWV0ZXJzPFBvc2l0aW9uTWFuYWdlckV2ZW50c1tVXT4pOiBib29sZWFuO1xufSJdLCJ2ZXJzaW9uIjozfQ==