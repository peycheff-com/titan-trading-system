{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/CorrelationManager.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/CorrelationManager.test.ts"],"sourcesContent":["/**\n * Unit Tests for CorrelationManager\n * \n * Tests correlation calculations, position limits, and high beta detection\n */\n\nimport { CorrelationManager, CorrelationManagerConfig } from '../../src/risk/CorrelationManager';\nimport { Position, OHLCV } from '../../src/types';\n\n// Mock BybitPerpsClient\nconst mockBybitClient = {\n  fetchOHLCV: jest.fn()\n};\n\ndescribe('CorrelationManager', () => {\n  let correlationManager: CorrelationManager;\n  let config: CorrelationManagerConfig;\n\n  beforeEach(() => {\n    config = {\n      correlationThreshold: 0.7,\n      rejectThreshold: 0.85,\n      groupCorrelationThreshold: 0.5,\n      maxCorrelatedExposure: 0.4,\n      highBetaThreshold: 0.9,\n      highBetaReduction: 0.3,\n      rollingWindowHours: 24,\n      updateIntervalMs: 300000\n    };\n\n    correlationManager = new CorrelationManager(mockBybitClient as any, config);\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    correlationManager.destroy();\n  });\n\n  describe('calcCorrelation', () => {\n    it('should calculate correlation between two symbols', async () => {\n      // Mock price data - perfectly correlated (both go up)\n      const priceData1: OHLCV[] = Array.from({ length: 24 }, (_, i) => ({\n        timestamp: Date.now() - (23 - i) * 60 * 60 * 1000,\n        open: 100 + i,\n        high: 105 + i,\n        low: 95 + i,\n        close: 100 + i,\n        volume: 1000\n      }));\n\n      const priceData2: OHLCV[] = Array.from({ length: 24 }, (_, i) => ({\n        timestamp: Date.now() - (23 - i) * 60 * 60 * 1000,\n        open: 200 + i * 2,\n        high: 210 + i * 2,\n        low: 190 + i * 2,\n        close: 200 + i * 2,\n        volume: 1000\n      }));\n\n      mockBybitClient.fetchOHLCV\n        .mockResolvedValueOnce(priceData1)\n        .mockResolvedValueOnce(priceData2);\n\n      const correlation = await correlationManager.calcCorrelation('BTCUSDT', 'ETHUSDT');\n\n      expect(correlation).toBeGreaterThan(0.9); // Should be highly correlated\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledTimes(2);\n    });\n\n    it('should return 0 for insufficient data', async () => {\n      // Mock insufficient data\n      const shortData: OHLCV[] = Array.from({ length: 5 }, (_, i) => ({\n        timestamp: Date.now() - i * 60 * 60 * 1000,\n        open: 100,\n        high: 105,\n        low: 95,\n        close: 100,\n        volume: 1000\n      }));\n\n      mockBybitClient.fetchOHLCV\n        .mockResolvedValueOnce(shortData)\n        .mockResolvedValueOnce(shortData);\n\n      const correlation = await correlationManager.calcCorrelation('BTCUSDT', 'ETHUSDT');\n\n      expect(correlation).toBe(0);\n    });\n\n    it('should handle API errors gracefully', async () => {\n      mockBybitClient.fetchOHLCV.mockRejectedValue(new Error('API Error'));\n\n      const correlation = await correlationManager.calcCorrelation('BTCUSDT', 'ETHUSDT');\n\n      expect(correlation).toBe(0);\n    });\n  });\n\n  describe('checkCorrelationLimit', () => {\n    const mockPositions: Position[] = [\n      {\n        id: 'pos1',\n        symbol: 'ETHUSDT',\n        side: 'LONG',\n        entryPrice: 2000,\n        currentPrice: 2100,\n        quantity: 1,\n        leverage: 3,\n        stopLoss: 1900,\n        takeProfit: 2300,\n        unrealizedPnL: 100,\n        realizedPnL: 0,\n        entryTime: Date.now() - 60000,\n        status: 'OPEN',\n        rValue: 1.5,\n        atr: 50\n      }\n    ];\n\n    it('should reject signal when correlation exceeds reject threshold', async () => {\n      // Mock high correlation (0.9)\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.9);\n\n      const result = await correlationManager.checkCorrelationLimit('BTCUSDT', mockPositions, 1000);\n\n      expect(result.allowed).toBe(false);\n      expect(result.reason).toContain('CORRELATION_REJECT');\n      expect(result.correlation).toBe(0.9);\n    });\n\n    it('should reduce position size when correlation exceeds threshold', async () => {\n      // Mock medium correlation (0.75)\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.75);\n\n      const result = await correlationManager.checkCorrelationLimit('BTCUSDT', mockPositions, 1000);\n\n      expect(result.allowed).toBe(true);\n      expect(result.adjustedSize).toBe(500); // 50% reduction\n      expect(result.reason).toContain('CORRELATION_REDUCE');\n      expect(result.correlation).toBe(0.75);\n    });\n\n    it('should allow position when correlation is below threshold', async () => {\n      // Mock low correlation (0.3)\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.3);\n\n      const result = await correlationManager.checkCorrelationLimit('BTCUSDT', mockPositions, 1000);\n\n      expect(result.allowed).toBe(true);\n      expect(result.adjustedSize).toBeUndefined();\n      expect(result.correlation).toBe(0.3);\n    });\n\n    it('should handle empty positions array', async () => {\n      const result = await correlationManager.checkCorrelationLimit('BTCUSDT', [], 1000);\n\n      expect(result.allowed).toBe(true);\n      expect(result.correlation).toBe(0);\n    });\n  });\n\n  describe('calcTotalCorrelatedExposure', () => {\n    const mockPositions: Position[] = [\n      {\n        id: 'pos1',\n        symbol: 'BTCUSDT',\n        side: 'LONG',\n        entryPrice: 50000,\n        currentPrice: 51000,\n        quantity: 0.1,\n        leverage: 3,\n        stopLoss: 49000,\n        takeProfit: 53000,\n        unrealizedPnL: 100,\n        realizedPnL: 0,\n        entryTime: Date.now(),\n        status: 'OPEN',\n        rValue: 1.0,\n        atr: 1000\n      },\n      {\n        id: 'pos2',\n        symbol: 'ETHUSDT',\n        side: 'LONG',\n        entryPrice: 3000,\n        currentPrice: 3100,\n        quantity: 1,\n        leverage: 3,\n        stopLoss: 2900,\n        takeProfit: 3300,\n        unrealizedPnL: 100,\n        realizedPnL: 0,\n        entryTime: Date.now(),\n        status: 'OPEN',\n        rValue: 1.0,\n        atr: 100\n      }\n    ];\n\n    it('should calculate total correlated exposure', async () => {\n      // Mock correlation matrix with high correlation\n      jest.spyOn(correlationManager, 'generateCorrelationMatrix').mockResolvedValue({\n        symbols: ['BTCUSDT', 'ETHUSDT'],\n        matrix: [\n          [1.0, 0.8],\n          [0.8, 1.0]\n        ],\n        timestamp: Date.now()\n      });\n\n      const totalEquity = 10000;\n      const exposure = await correlationManager.calcTotalCorrelatedExposure(mockPositions, totalEquity);\n\n      expect(exposure).toBeGreaterThan(0);\n      // Exposure can be > 1 due to leverage, so just check it's a reasonable number\n      expect(exposure).toBeLessThan(10); // Should be less than 10x equity\n    });\n\n    it('should return 0 for single position', async () => {\n      const singlePosition = [mockPositions[0]];\n      const exposure = await correlationManager.calcTotalCorrelatedExposure(singlePosition, 10000);\n\n      expect(exposure).toBe(0);\n    });\n\n    it('should handle empty positions array', async () => {\n      const exposure = await correlationManager.calcTotalCorrelatedExposure([], 10000);\n\n      expect(exposure).toBe(0);\n    });\n  });\n\n  describe('detectHighBeta', () => {\n    it('should detect high beta market conditions', async () => {\n      const topSymbols = ['ETHUSDT', 'ADAUSDT', 'DOTUSDT', 'LINKUSDT'];\n      \n      // Mock high BTC correlation for all symbols\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.95);\n\n      const highBetaState = await correlationManager.detectHighBeta(topSymbols);\n\n      expect(highBetaState.isHighBeta).toBe(true);\n      expect(highBetaState.btcCorrelation).toBeGreaterThanOrEqual(0.9);\n      expect(highBetaState.affectedSymbols).toHaveLength(4);\n    });\n\n    it('should detect normal market conditions', async () => {\n      const topSymbols = ['ETHUSDT', 'ADAUSDT', 'DOTUSDT', 'LINKUSDT'];\n      \n      // Mock low BTC correlation\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.3);\n\n      const highBetaState = await correlationManager.detectHighBeta(topSymbols);\n\n      expect(highBetaState.isHighBeta).toBe(false);\n      expect(highBetaState.btcCorrelation).toBeLessThan(0.9);\n      expect(highBetaState.affectedSymbols).toHaveLength(0);\n    });\n\n    it('should handle empty symbols array', async () => {\n      const highBetaState = await correlationManager.detectHighBeta([]);\n\n      expect(highBetaState.isHighBeta).toBe(false);\n      expect(highBetaState.btcCorrelation).toBe(0);\n      expect(highBetaState.affectedSymbols).toHaveLength(0);\n    });\n  });\n\n  describe('generateCorrelationMatrix', () => {\n    it('should generate correlation matrix for given symbols', async () => {\n      const symbols = ['BTCUSDT', 'ETHUSDT', 'ADAUSDT'];\n      \n      // Mock correlation calculations\n      jest.spyOn(correlationManager, 'calcCorrelation')\n        .mockResolvedValueOnce(0.8) // BTC-ETH\n        .mockResolvedValueOnce(0.6) // BTC-ADA\n        .mockResolvedValueOnce(0.7); // ETH-ADA\n\n      const matrix = await correlationManager.generateCorrelationMatrix(symbols);\n\n      expect(matrix.symbols).toEqual(symbols);\n      expect(matrix.matrix).toHaveLength(3);\n      expect(matrix.matrix[0]).toHaveLength(3);\n      \n      // Check diagonal is 1.0 (perfect self-correlation)\n      expect(matrix.matrix[0][0]).toBe(1.0);\n      expect(matrix.matrix[1][1]).toBe(1.0);\n      expect(matrix.matrix[2][2]).toBe(1.0);\n      \n      // Check symmetry\n      expect(matrix.matrix[0][1]).toBe(matrix.matrix[1][0]);\n      expect(matrix.matrix[0][2]).toBe(matrix.matrix[2][0]);\n      expect(matrix.matrix[1][2]).toBe(matrix.matrix[2][1]);\n    });\n\n    it('should handle empty symbols array', async () => {\n      const matrix = await correlationManager.generateCorrelationMatrix([]);\n\n      expect(matrix.symbols).toEqual([]);\n      expect(matrix.matrix).toEqual([]);\n    });\n\n    it('should handle single symbol', async () => {\n      const symbols = ['BTCUSDT'];\n      const matrix = await correlationManager.generateCorrelationMatrix(symbols);\n\n      expect(matrix.symbols).toEqual(symbols);\n      expect(matrix.matrix).toEqual([[1.0]]);\n    });\n  });\n\n  describe('Configuration and Statistics', () => {\n    it('should update configuration', () => {\n      const newConfig = { correlationThreshold: 0.8 };\n      correlationManager.updateConfig(newConfig);\n\n      // Configuration should be updated (tested through behavior)\n      expect(true).toBe(true); // Placeholder assertion\n    });\n\n    it('should return statistics', () => {\n      const stats = correlationManager.getStatistics();\n\n      expect(stats).toHaveProperty('cachedPairs');\n      expect(stats).toHaveProperty('cachedSymbols');\n      expect(stats).toHaveProperty('highBetaActive');\n      expect(stats).toHaveProperty('avgBtcCorrelation');\n      \n      expect(typeof stats.cachedPairs).toBe('number');\n      expect(typeof stats.cachedSymbols).toBe('number');\n      expect(typeof stats.highBetaActive).toBe('boolean');\n      expect(typeof stats.avgBtcCorrelation).toBe('number');\n    });\n\n    it('should clear cache', () => {\n      correlationManager.clearCache();\n      \n      const stats = correlationManager.getStatistics();\n      expect(stats.cachedPairs).toBe(0);\n      expect(stats.cachedSymbols).toBe(0);\n      expect(stats.highBetaActive).toBe(false);\n    });\n  });\n\n  describe('Event Emission', () => {\n    it('should emit correlation:updated event', async () => {\n      const eventSpy = jest.fn();\n      correlationManager.on('correlation:updated', eventSpy);\n\n      await correlationManager.generateCorrelationMatrix(['BTCUSDT', 'ETHUSDT']);\n\n      expect(eventSpy).toHaveBeenCalledWith(expect.objectContaining({\n        symbols: ['BTCUSDT', 'ETHUSDT'],\n        matrix: expect.any(Array),\n        timestamp: expect.any(Number)\n      }));\n    });\n\n    it('should emit correlation:high_beta event', async () => {\n      const eventSpy = jest.fn();\n      correlationManager.on('correlation:high_beta', eventSpy);\n\n      // Mock high correlation to trigger high beta\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.95);\n\n      await correlationManager.detectHighBeta(['ETHUSDT']);\n\n      expect(eventSpy).toHaveBeenCalledWith(expect.objectContaining({\n        isHighBeta: true,\n        btcCorrelation: expect.any(Number),\n        affectedSymbols: expect.any(Array),\n        timestamp: expect.any(Number)\n      }));\n    });\n\n    it('should emit correlation:reject event', async () => {\n      const eventSpy = jest.fn();\n      correlationManager.on('correlation:reject', eventSpy);\n\n      const mockPositions: Position[] = [{\n        id: 'pos1',\n        symbol: 'ETHUSDT',\n        side: 'LONG',\n        entryPrice: 2000,\n        currentPrice: 2100,\n        quantity: 1,\n        leverage: 3,\n        stopLoss: 1900,\n        takeProfit: 2300,\n        unrealizedPnL: 100,\n        realizedPnL: 0,\n        entryTime: Date.now(),\n        status: 'OPEN',\n        rValue: 1.0,\n        atr: 50\n      }];\n\n      // Mock high correlation to trigger rejection\n      jest.spyOn(correlationManager, 'calcCorrelation').mockResolvedValue(0.9);\n\n      await correlationManager.checkCorrelationLimit('BTCUSDT', mockPositions, 1000);\n\n      expect(eventSpy).toHaveBeenCalledWith('BTCUSDT', 0.9, 'ETHUSDT');\n    });\n  });\n\n  describe('Monitoring Lifecycle', () => {\n    it('should start and stop monitoring', () => {\n      // Monitoring should start automatically in constructor\n      expect(true).toBe(true); // Placeholder - monitoring is internal\n\n      correlationManager.stopMonitoring();\n      correlationManager.startMonitoring = jest.fn();\n      \n      // Should be able to restart\n      expect(true).toBe(true); // Placeholder\n    });\n\n    it('should cleanup resources on destroy', () => {\n      const stopSpy = jest.spyOn(correlationManager, 'stopMonitoring');\n      const clearSpy = jest.spyOn(correlationManager, 'clearCache');\n\n      correlationManager.destroy();\n\n      expect(stopSpy).toHaveBeenCalled();\n      expect(clearSpy).toHaveBeenCalled();\n    });\n  });\n});"],"version":3}