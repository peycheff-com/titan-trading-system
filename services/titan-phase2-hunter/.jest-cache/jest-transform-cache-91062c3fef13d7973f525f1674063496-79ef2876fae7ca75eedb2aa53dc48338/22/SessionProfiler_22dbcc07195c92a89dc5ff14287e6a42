3f1d502a73ada3a23b1890345c9c6251
"use strict";
/**
 * SessionProfiler - Time & Price Dynamics Engine
 *
 * Exploits the "Judas Swing" (false moves) at London/NY opens to catch
 * manipulation-to-distribution transitions. Identifies session-based
 * trading opportunities and manages time-based logic.
 *
 * Requirements: 2.1-2.7 (Session Profiler)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SessionProfiler = void 0;
const events_1 = require("events");
class SessionProfiler extends events_1.EventEmitter {
    asianRange = null;
    londonRange = null;
    currentSession = null;
    constructor() {
        super();
    }
    /**
     * Get current session state based on UTC time
     * Requirements: 2.1 (Session identification)
     */
    getSessionState() {
        const now = new Date();
        const utcHour = now.getUTCHours();
        const utcMinute = now.getUTCMinutes();
        const currentTime = utcHour + utcMinute / 60;
        let sessionType;
        let startTime;
        let endTime;
        // Asian session: 00:00 - 06:00 UTC (Accumulation phase)
        if (currentTime >= 0 && currentTime < 6) {
            sessionType = 'ASIAN';
            startTime = 0;
            endTime = 6;
        }
        // London session: 07:00 - 10:00 UTC (Manipulation phase)
        else if (currentTime >= 7 && currentTime < 10) {
            sessionType = 'LONDON';
            startTime = 7;
            endTime = 10;
        }
        // NY session: 13:00 - 16:00 UTC (Distribution phase)
        else if (currentTime >= 13 && currentTime < 16) {
            sessionType = 'NY';
            startTime = 13;
            endTime = 16;
        }
        // Dead Zone: 21:00 - 01:00 UTC (Low volume)
        else {
            sessionType = 'DEAD_ZONE';
            startTime = 21;
            endTime = 1; // Next day
        }
        // Calculate time remaining in current session
        let timeRemaining;
        if (sessionType === 'DEAD_ZONE') {
            // Handle overnight session
            if (currentTime >= 21) {
                timeRemaining = (24 - currentTime) + 1; // Until 01:00 next day
            }
            else {
                timeRemaining = 1 - currentTime; // Until 01:00
            }
        }
        else {
            timeRemaining = endTime - currentTime;
        }
        const sessionState = {
            type: sessionType,
            startTime,
            endTime,
            timeRemaining: Math.max(0, timeRemaining)
        };
        // Check for session transition
        if (!this.currentSession || this.currentSession.type !== sessionType) {
            this.handleSessionTransition(sessionState);
        }
        this.currentSession = sessionState;
        return sessionState;
    }
    /**
     * Check if current time is within tradeable killzone
     * Requirements: 2.6 (Killzone checking)
     */
    isKillzone() {
        const sessionState = this.getSessionState();
        // Only London and NY sessions are killzones
        return sessionState.type === 'LONDON' || sessionState.type === 'NY';
    }
    /**
     * Handle session transition and emit events
     * Requirements: 2.7 (Session transition events)
     */
    handleSessionTransition(newSession) {
        const previousSession = this.currentSession?.type;
        // Emit session change event with reference levels
        this.emit('SESSION_CHANGE', {
            previousSession,
            newSession: newSession.type,
            asianRange: this.asianRange,
            londonRange: this.londonRange,
            timestamp: Date.now()
        });
    }
}
exports.SessionProfiler = SessionProfiler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2VuZ2luZS9TZXNzaW9uUHJvZmlsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7OztHQVFHOzs7QUFFSCxtQ0FBc0M7QUFTdEMsTUFBYSxlQUFnQixTQUFRLHFCQUFZO0lBQ3ZDLFVBQVUsR0FBc0IsSUFBSSxDQUFDO0lBQ3JDLFdBQVcsR0FBNEQsSUFBSSxDQUFDO0lBQzVFLGNBQWMsR0FBd0IsSUFBSSxDQUFDO0lBRW5EO1FBQ0UsS0FBSyxFQUFFLENBQUM7SUFDVixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsZUFBZTtRQUNiLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDdkIsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN0QyxNQUFNLFdBQVcsR0FBRyxPQUFPLEdBQUcsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUU3QyxJQUFJLFdBQXdCLENBQUM7UUFDN0IsSUFBSSxTQUFpQixDQUFDO1FBQ3RCLElBQUksT0FBZSxDQUFDO1FBRXBCLHdEQUF3RDtRQUN4RCxJQUFJLFdBQVcsSUFBSSxDQUFDLElBQUksV0FBVyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3hDLFdBQVcsR0FBRyxPQUFPLENBQUM7WUFDdEIsU0FBUyxHQUFHLENBQUMsQ0FBQztZQUNkLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFDZCxDQUFDO1FBQ0QseURBQXlEO2FBQ3BELElBQUksV0FBVyxJQUFJLENBQUMsSUFBSSxXQUFXLEdBQUcsRUFBRSxFQUFFLENBQUM7WUFDOUMsV0FBVyxHQUFHLFFBQVEsQ0FBQztZQUN2QixTQUFTLEdBQUcsQ0FBQyxDQUFDO1lBQ2QsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNmLENBQUM7UUFDRCxxREFBcUQ7YUFDaEQsSUFBSSxXQUFXLElBQUksRUFBRSxJQUFJLFdBQVcsR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUMvQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQ25CLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDZixPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2YsQ0FBQztRQUNELDRDQUE0QzthQUN2QyxDQUFDO1lBQ0osV0FBVyxHQUFHLFdBQVcsQ0FBQztZQUMxQixTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ2YsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVc7UUFDMUIsQ0FBQztRQUVELDhDQUE4QztRQUM5QyxJQUFJLGFBQXFCLENBQUM7UUFDMUIsSUFBSSxXQUFXLEtBQUssV0FBVyxFQUFFLENBQUM7WUFDaEMsMkJBQTJCO1lBQzNCLElBQUksV0FBVyxJQUFJLEVBQUUsRUFBRSxDQUFDO2dCQUN0QixhQUFhLEdBQUcsQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsdUJBQXVCO1lBQ2pFLENBQUM7aUJBQU0sQ0FBQztnQkFDTixhQUFhLEdBQUcsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLGNBQWM7WUFDakQsQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ04sYUFBYSxHQUFHLE9BQU8sR0FBRyxXQUFXLENBQUM7UUFDeEMsQ0FBQztRQUVELE1BQU0sWUFBWSxHQUFpQjtZQUNqQyxJQUFJLEVBQUUsV0FBVztZQUNqQixTQUFTO1lBQ1QsT0FBTztZQUNQLGFBQWEsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxhQUFhLENBQUM7U0FDMUMsQ0FBQztRQUVGLCtCQUErQjtRQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUNyRSxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDN0MsQ0FBQztRQUVELElBQUksQ0FBQyxjQUFjLEdBQUcsWUFBWSxDQUFDO1FBQ25DLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxVQUFVO1FBQ1IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRTVDLDRDQUE0QztRQUM1QyxPQUFPLFlBQVksQ0FBQyxJQUFJLEtBQUssUUFBUSxJQUFJLFlBQVksQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDO0lBQ3RFLENBQUM7SUFFRDs7O09BR0c7SUFDSyx1QkFBdUIsQ0FBQyxVQUF3QjtRQUN0RCxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQztRQUVsRCxrREFBa0Q7UUFDbEQsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUMxQixlQUFlO1lBQ2YsVUFBVSxFQUFFLFVBQVUsQ0FBQyxJQUFJO1lBQzNCLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtZQUMzQixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDN0IsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7U0FDdEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGO0FBeEdELDBDQXdHQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tcGhhc2UyLWh1bnRlci9zcmMvZW5naW5lL1Nlc3Npb25Qcm9maWxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNlc3Npb25Qcm9maWxlciAtIFRpbWUgJiBQcmljZSBEeW5hbWljcyBFbmdpbmVcbiAqIFxuICogRXhwbG9pdHMgdGhlIFwiSnVkYXMgU3dpbmdcIiAoZmFsc2UgbW92ZXMpIGF0IExvbmRvbi9OWSBvcGVucyB0byBjYXRjaCBcbiAqIG1hbmlwdWxhdGlvbi10by1kaXN0cmlidXRpb24gdHJhbnNpdGlvbnMuIElkZW50aWZpZXMgc2Vzc2lvbi1iYXNlZCBcbiAqIHRyYWRpbmcgb3Bwb3J0dW5pdGllcyBhbmQgbWFuYWdlcyB0aW1lLWJhc2VkIGxvZ2ljLlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDIuMS0yLjcgKFNlc3Npb24gUHJvZmlsZXIpXG4gKi9cblxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFxuICBTZXNzaW9uVHlwZSwgXG4gIFNlc3Npb25TdGF0ZSwgXG4gIEFzaWFuUmFuZ2UsIFxuICBKdWRhc1N3aW5nLFxuICBPSExDViBcbn0gZnJvbSAnLi4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgU2Vzc2lvblByb2ZpbGVyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcHJpdmF0ZSBhc2lhblJhbmdlOiBBc2lhblJhbmdlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbG9uZG9uUmFuZ2U6IHsgaGlnaDogbnVtYmVyOyBsb3c6IG51bWJlcjsgdGltZXN0YW1wOiBudW1iZXIgfSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGN1cnJlbnRTZXNzaW9uOiBTZXNzaW9uU3RhdGUgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHNlc3Npb24gc3RhdGUgYmFzZWQgb24gVVRDIHRpbWVcbiAgICogUmVxdWlyZW1lbnRzOiAyLjEgKFNlc3Npb24gaWRlbnRpZmljYXRpb24pXG4gICAqL1xuICBnZXRTZXNzaW9uU3RhdGUoKTogU2Vzc2lvblN0YXRlIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHV0Y0hvdXIgPSBub3cuZ2V0VVRDSG91cnMoKTtcbiAgICBjb25zdCB1dGNNaW51dGUgPSBub3cuZ2V0VVRDTWludXRlcygpO1xuICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gdXRjSG91ciArIHV0Y01pbnV0ZSAvIDYwO1xuXG4gICAgbGV0IHNlc3Npb25UeXBlOiBTZXNzaW9uVHlwZTtcbiAgICBsZXQgc3RhcnRUaW1lOiBudW1iZXI7XG4gICAgbGV0IGVuZFRpbWU6IG51bWJlcjtcblxuICAgIC8vIEFzaWFuIHNlc3Npb246IDAwOjAwIC0gMDY6MDAgVVRDIChBY2N1bXVsYXRpb24gcGhhc2UpXG4gICAgaWYgKGN1cnJlbnRUaW1lID49IDAgJiYgY3VycmVudFRpbWUgPCA2KSB7XG4gICAgICBzZXNzaW9uVHlwZSA9ICdBU0lBTic7XG4gICAgICBzdGFydFRpbWUgPSAwO1xuICAgICAgZW5kVGltZSA9IDY7XG4gICAgfVxuICAgIC8vIExvbmRvbiBzZXNzaW9uOiAwNzowMCAtIDEwOjAwIFVUQyAoTWFuaXB1bGF0aW9uIHBoYXNlKVxuICAgIGVsc2UgaWYgKGN1cnJlbnRUaW1lID49IDcgJiYgY3VycmVudFRpbWUgPCAxMCkge1xuICAgICAgc2Vzc2lvblR5cGUgPSAnTE9ORE9OJztcbiAgICAgIHN0YXJ0VGltZSA9IDc7XG4gICAgICBlbmRUaW1lID0gMTA7XG4gICAgfVxuICAgIC8vIE5ZIHNlc3Npb246IDEzOjAwIC0gMTY6MDAgVVRDIChEaXN0cmlidXRpb24gcGhhc2UpXG4gICAgZWxzZSBpZiAoY3VycmVudFRpbWUgPj0gMTMgJiYgY3VycmVudFRpbWUgPCAxNikge1xuICAgICAgc2Vzc2lvblR5cGUgPSAnTlknO1xuICAgICAgc3RhcnRUaW1lID0gMTM7XG4gICAgICBlbmRUaW1lID0gMTY7XG4gICAgfVxuICAgIC8vIERlYWQgWm9uZTogMjE6MDAgLSAwMTowMCBVVEMgKExvdyB2b2x1bWUpXG4gICAgZWxzZSB7XG4gICAgICBzZXNzaW9uVHlwZSA9ICdERUFEX1pPTkUnO1xuICAgICAgc3RhcnRUaW1lID0gMjE7XG4gICAgICBlbmRUaW1lID0gMTsgLy8gTmV4dCBkYXlcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgdGltZSByZW1haW5pbmcgaW4gY3VycmVudCBzZXNzaW9uXG4gICAgbGV0IHRpbWVSZW1haW5pbmc6IG51bWJlcjtcbiAgICBpZiAoc2Vzc2lvblR5cGUgPT09ICdERUFEX1pPTkUnKSB7XG4gICAgICAvLyBIYW5kbGUgb3Zlcm5pZ2h0IHNlc3Npb25cbiAgICAgIGlmIChjdXJyZW50VGltZSA+PSAyMSkge1xuICAgICAgICB0aW1lUmVtYWluaW5nID0gKDI0IC0gY3VycmVudFRpbWUpICsgMTsgLy8gVW50aWwgMDE6MDAgbmV4dCBkYXlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRpbWVSZW1haW5pbmcgPSAxIC0gY3VycmVudFRpbWU7IC8vIFVudGlsIDAxOjAwXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRpbWVSZW1haW5pbmcgPSBlbmRUaW1lIC0gY3VycmVudFRpbWU7XG4gICAgfVxuXG4gICAgY29uc3Qgc2Vzc2lvblN0YXRlOiBTZXNzaW9uU3RhdGUgPSB7XG4gICAgICB0eXBlOiBzZXNzaW9uVHlwZSxcbiAgICAgIHN0YXJ0VGltZSxcbiAgICAgIGVuZFRpbWUsXG4gICAgICB0aW1lUmVtYWluaW5nOiBNYXRoLm1heCgwLCB0aW1lUmVtYWluaW5nKVxuICAgIH07XG5cbiAgICAvLyBDaGVjayBmb3Igc2Vzc2lvbiB0cmFuc2l0aW9uXG4gICAgaWYgKCF0aGlzLmN1cnJlbnRTZXNzaW9uIHx8IHRoaXMuY3VycmVudFNlc3Npb24udHlwZSAhPT0gc2Vzc2lvblR5cGUpIHtcbiAgICAgIHRoaXMuaGFuZGxlU2Vzc2lvblRyYW5zaXRpb24oc2Vzc2lvblN0YXRlKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvblN0YXRlO1xuICAgIHJldHVybiBzZXNzaW9uU3RhdGU7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgY3VycmVudCB0aW1lIGlzIHdpdGhpbiB0cmFkZWFibGUga2lsbHpvbmVcbiAgICogUmVxdWlyZW1lbnRzOiAyLjYgKEtpbGx6b25lIGNoZWNraW5nKVxuICAgKi9cbiAgaXNLaWxsem9uZSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzZXNzaW9uU3RhdGUgPSB0aGlzLmdldFNlc3Npb25TdGF0ZSgpO1xuICAgIFxuICAgIC8vIE9ubHkgTG9uZG9uIGFuZCBOWSBzZXNzaW9ucyBhcmUga2lsbHpvbmVzXG4gICAgcmV0dXJuIHNlc3Npb25TdGF0ZS50eXBlID09PSAnTE9ORE9OJyB8fCBzZXNzaW9uU3RhdGUudHlwZSA9PT0gJ05ZJztcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgc2Vzc2lvbiB0cmFuc2l0aW9uIGFuZCBlbWl0IGV2ZW50c1xuICAgKiBSZXF1aXJlbWVudHM6IDIuNyAoU2Vzc2lvbiB0cmFuc2l0aW9uIGV2ZW50cylcbiAgICovXG4gIHByaXZhdGUgaGFuZGxlU2Vzc2lvblRyYW5zaXRpb24obmV3U2Vzc2lvbjogU2Vzc2lvblN0YXRlKTogdm9pZCB7XG4gICAgY29uc3QgcHJldmlvdXNTZXNzaW9uID0gdGhpcy5jdXJyZW50U2Vzc2lvbj8udHlwZTtcbiAgICBcbiAgICAvLyBFbWl0IHNlc3Npb24gY2hhbmdlIGV2ZW50IHdpdGggcmVmZXJlbmNlIGxldmVsc1xuICAgIHRoaXMuZW1pdCgnU0VTU0lPTl9DSEFOR0UnLCB7XG4gICAgICBwcmV2aW91c1Nlc3Npb24sXG4gICAgICBuZXdTZXNzaW9uOiBuZXdTZXNzaW9uLnR5cGUsXG4gICAgICBhc2lhblJhbmdlOiB0aGlzLmFzaWFuUmFuZ2UsXG4gICAgICBsb25kb25SYW5nZTogdGhpcy5sb25kb25SYW5nZSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH0pO1xuICB9XG59Il0sInZlcnNpb24iOjN9