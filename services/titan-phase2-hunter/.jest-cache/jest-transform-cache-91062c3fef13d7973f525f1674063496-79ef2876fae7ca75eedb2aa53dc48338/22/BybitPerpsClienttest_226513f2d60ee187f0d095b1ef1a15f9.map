{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/BybitPerpsClient.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/BybitPerpsClient.test.ts"],"sourcesContent":["/**\n * Unit tests for BybitPerpsClient\n */\n\nimport { BybitPerpsClient } from '../../src/exchanges/BybitPerpsClient';\nimport { OrderParams, OrderStatus } from '../../src/types';\n\n// Mock node-fetch\njest.mock('node-fetch', () => jest.fn());\n\nconst mockFetch = require('node-fetch') as jest.MockedFunction<typeof fetch>;\n\ndescribe('BybitPerpsClient', () => {\n  let client: BybitPerpsClient;\n  const mockApiKey = 'test-api-key';\n  const mockApiSecret = 'test-api-secret';\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    client = new BybitPerpsClient(mockApiKey, mockApiSecret);\n  });\n\n  afterEach(() => {\n    client.clearCache();\n  });\n\n  describe('fetchTopSymbols', () => {\n    it('should fetch and return top 100 symbols by volume', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              symbol: 'BTCUSDT',\n              turnover24h: '1000000000',\n              lastPrice: '50000'\n            },\n            {\n              symbol: 'ETHUSDT',\n              turnover24h: '500000000',\n              lastPrice: '3000'\n            },\n            {\n              symbol: 'ADAUSDT',\n              turnover24h: '100000000',\n              lastPrice: '0.5'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const symbols = await client.fetchTopSymbols();\n\n      expect(symbols).toEqual(['BTCUSDT', 'ETHUSDT', 'ADAUSDT']);\n      expect(mockFetch).toHaveBeenCalledWith(\n        expect.stringContaining('/v5/market/tickers'),\n        expect.objectContaining({\n          method: 'GET'\n        })\n      );\n    });\n\n    it('should return cached data on subsequent calls', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              symbol: 'BTCUSDT',\n              turnover24h: '1000000000',\n              lastPrice: '50000'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      // First call\n      const symbols1 = await client.fetchTopSymbols();\n      \n      // Second call (should use cache)\n      const symbols2 = await client.fetchTopSymbols();\n\n      expect(symbols1).toEqual(symbols2);\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should handle API errors', async () => {\n      const mockResponse = {\n        retCode: 10001,\n        retMsg: 'Invalid API key'\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await expect(client.fetchTopSymbols()).rejects.toThrow('Bybit API error: Invalid API key');\n    });\n  });\n\n  describe('fetchOHLCV', () => {\n    it('should fetch OHLCV data and convert to standard format', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          symbol: 'BTCUSDT',\n          category: 'linear',\n          list: [\n            ['1640995200000', '50000', '51000', '49000', '50500', '100'],\n            ['1640995260000', '50500', '52000', '50000', '51500', '150']\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const ohlcv = await client.fetchOHLCV('BTCUSDT', '1m', 2);\n\n      expect(ohlcv).toHaveLength(2);\n      expect(ohlcv[0]).toEqual({\n        timestamp: 1640995200000,\n        open: 50000,\n        high: 51000,\n        low: 49000,\n        close: 50500,\n        volume: 100\n      });\n      expect(ohlcv[1]).toEqual({\n        timestamp: 1640995260000,\n        open: 50500,\n        high: 52000,\n        low: 50000,\n        close: 51500,\n        volume: 150\n      });\n    });\n\n    it('should convert intervals correctly', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          symbol: 'BTCUSDT',\n          category: 'linear',\n          list: []\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await client.fetchOHLCV('BTCUSDT', '4h', 100);\n\n      expect(mockFetch).toHaveBeenCalledWith(\n        expect.stringContaining('interval=240'),\n        expect.any(Object)\n      );\n    });\n\n    it('should cache OHLCV data', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          symbol: 'BTCUSDT',\n          category: 'linear',\n          list: [\n            ['1640995200000', '50000', '51000', '49000', '50500', '100']\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      // First call\n      const ohlcv1 = await client.fetchOHLCV('BTCUSDT', '1m', 1);\n      \n      // Second call (should use cache)\n      const ohlcv2 = await client.fetchOHLCV('BTCUSDT', '1m', 1);\n\n      expect(ohlcv1).toEqual(ohlcv2);\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('getCurrentPrice', () => {\n    it('should fetch current price for symbol', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              symbol: 'BTCUSDT',\n              lastPrice: '50000.50'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const price = await client.getCurrentPrice('BTCUSDT');\n\n      expect(price).toBe(50000.50);\n      expect(mockFetch).toHaveBeenCalledWith(\n        expect.stringContaining('symbol=BTCUSDT'),\n        expect.any(Object)\n      );\n    });\n\n    it('should handle missing ticker data', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: []\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await expect(client.getCurrentPrice('INVALID')).rejects.toThrow('No ticker data found');\n    });\n  });\n\n  describe('getEquity', () => {\n    it('should fetch account equity', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              totalEquity: '10000.50',\n              totalWalletBalance: '9500.00'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const equity = await client.getEquity();\n\n      expect(equity).toBe(10000.50);\n      expect(mockFetch).toHaveBeenCalledWith(\n        expect.stringContaining('/v5/account/wallet-balance'),\n        expect.objectContaining({\n          headers: expect.objectContaining({\n            'X-BAPI-API-KEY': mockApiKey,\n            'X-BAPI-SIGN': expect.any(String)\n          })\n        })\n      );\n    });\n  });\n\n  describe('placeOrder', () => {\n    it('should place market order successfully', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          orderId: '12345',\n          orderLinkId: '',\n          symbol: 'BTCUSDT',\n          createTime: '1640995200000',\n          side: 'Buy',\n          orderType: 'Market',\n          qty: '0.1',\n          price: '',\n          avgPrice: '50000',\n          orderStatus: 'Filled'\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'MARKET',\n        qty: 0.1,\n        leverage: 5\n      };\n\n      const result = await client.placeOrder(orderParams);\n\n      expect(result).toEqual({\n        orderId: '12345',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        qty: 0.1,\n        price: 50000,\n        status: 'FILLED',\n        timestamp: 1640995200000\n      });\n    });\n\n    it('should place limit order with price', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          orderId: '12346',\n          symbol: 'BTCUSDT',\n          createTime: '1640995200000',\n          side: 'Buy',\n          orderType: 'Limit',\n          qty: '0.1',\n          price: '49000',\n          orderStatus: 'New'\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'LIMIT',\n        price: 49000,\n        qty: 0.1,\n        leverage: 5\n      };\n\n      const result = await client.placeOrder(orderParams);\n\n      expect(result.status).toBe('NEW');\n      expect(result.price).toBe(49000);\n    });\n\n    it('should place post-only order', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          orderId: '12347',\n          symbol: 'BTCUSDT',\n          createTime: '1640995200000',\n          side: 'Buy',\n          orderType: 'Limit',\n          qty: '0.1',\n          price: '49000',\n          orderStatus: 'New'\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'POST_ONLY',\n        price: 49000,\n        qty: 0.1,\n        leverage: 5\n      };\n\n      await client.placeOrder(orderParams);\n\n      // Verify POST_ONLY is converted to Limit with PostOnly timeInForce\n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.orderType).toBe('Limit');\n      expect(requestBody.timeInForce).toBe('PostOnly');\n    });\n\n    it('should include stop loss and take profit', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          orderId: '12348',\n          symbol: 'BTCUSDT',\n          createTime: '1640995200000',\n          side: 'Buy',\n          orderType: 'Market',\n          qty: '0.1',\n          orderStatus: 'Filled'\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'MARKET',\n        qty: 0.1,\n        leverage: 5,\n        stopLoss: 48000,\n        takeProfit: 52000\n      };\n\n      await client.placeOrder(orderParams);\n\n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.stopLoss).toBe('48000');\n      expect(requestBody.takeProfit).toBe('52000');\n    });\n\n    it('should throw error for limit order without price', async () => {\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'LIMIT',\n        qty: 0.1,\n        leverage: 5\n      };\n\n      await expect(client.placeOrder(orderParams)).rejects.toThrow('Price is required for limit orders');\n    });\n  });\n\n  describe('placeOrderWithRetry', () => {\n    it('should retry failed orders', async () => {\n      // First call fails\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n      \n      // Second call succeeds\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          orderId: '12349',\n          symbol: 'BTCUSDT',\n          createTime: '1640995200000',\n          side: 'Buy',\n          orderType: 'Market',\n          qty: '0.1',\n          orderStatus: 'Filled'\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'MARKET',\n        qty: 0.1,\n        leverage: 5\n      };\n\n      const result = await client.placeOrderWithRetry(orderParams, 1);\n\n      expect(result.orderId).toBe('12349');\n      expect(mockFetch).toHaveBeenCalledTimes(2);\n    });\n\n    it('should fail after max retries', async () => {\n      mockFetch.mockRejectedValue(new Error('Network error'));\n\n      const orderParams: OrderParams = {\n        phase: 'phase2',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        type: 'MARKET',\n        qty: 0.1,\n        leverage: 5\n      };\n\n      await expect(client.placeOrderWithRetry(orderParams, 1)).rejects.toThrow('Order failed after 2 attempts');\n      expect(mockFetch).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('setLeverage', () => {\n    it('should set leverage for symbol', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {}\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const result = await client.setLeverage('BTCUSDT', 10);\n\n      expect(result).toBe(true);\n      \n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.symbol).toBe('BTCUSDT');\n      expect(requestBody.buyLeverage).toBe('10');\n      expect(requestBody.sellLeverage).toBe('10');\n    });\n  });\n\n  describe('setStopLoss', () => {\n    it('should set stop loss for position', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {}\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const result = await client.setStopLoss('BTCUSDT', 48000);\n\n      expect(result).toBe(true);\n      \n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.symbol).toBe('BTCUSDT');\n      expect(requestBody.stopLoss).toBe('48000');\n      expect(requestBody.positionIdx).toBe('0');\n    });\n  });\n\n  describe('setTakeProfit', () => {\n    it('should set take profit for position', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {}\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const result = await client.setTakeProfit('BTCUSDT', 52000);\n\n      expect(result).toBe(true);\n      \n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.symbol).toBe('BTCUSDT');\n      expect(requestBody.takeProfit).toBe('52000');\n      expect(requestBody.positionIdx).toBe('0');\n    });\n  });\n\n  describe('getOrderStatus', () => {\n    it('should get order status', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              orderId: '12345',\n              orderStatus: 'Filled'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const status = await client.getOrderStatus('12345', 'BTCUSDT');\n\n      expect(status).toBe('FILLED');\n    });\n\n    it('should handle order not found', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: []\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await expect(client.getOrderStatus('invalid', 'BTCUSDT')).rejects.toThrow('Order invalid not found');\n    });\n  });\n\n  describe('cancelOrder', () => {\n    it('should cancel order successfully', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {}\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const result = await client.cancelOrder('12345', 'BTCUSDT');\n\n      expect(result).toBe(true);\n      \n      const requestBody = JSON.parse(mockFetch.mock.calls[0][1].body);\n      expect(requestBody.orderId).toBe('12345');\n      expect(requestBody.symbol).toBe('BTCUSDT');\n    });\n  });\n\n  describe('getPositionInfo', () => {\n    it('should get position info', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: [\n            {\n              symbol: 'BTCUSDT',\n              side: 'Buy',\n              size: '0.1',\n              avgPrice: '50000',\n              unrealisedPnl: '100'\n            }\n          ]\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const position = await client.getPositionInfo('BTCUSDT');\n\n      expect(position).toEqual({\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        size: '0.1',\n        avgPrice: '50000',\n        unrealisedPnl: '100'\n      });\n    });\n\n    it('should return null for no position', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: {\n          list: []\n        }\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      const position = await client.getPositionInfo('BTCUSDT');\n\n      expect(position).toBeNull();\n    });\n  });\n\n  describe('cache management', () => {\n    it('should clear cache', () => {\n      client.clearCache();\n      expect(client.getCacheSize()).toBe(0);\n    });\n\n    it('should track cache size', async () => {\n      const mockResponse = {\n        retCode: 0,\n        retMsg: 'OK',\n        result: { list: [] }\n      };\n\n      mockFetch.mockResolvedValue({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await client.fetchTopSymbols();\n      expect(client.getCacheSize()).toBe(1);\n\n      await client.fetchOHLCV('BTCUSDT', '1m');\n      expect(client.getCacheSize()).toBe(2);\n    });\n  });\n\n  describe('error handling', () => {\n    it('should handle HTTP errors', async () => {\n      mockFetch.mockResolvedValueOnce({\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error'\n      } as any);\n\n      await expect(client.getCurrentPrice('BTCUSDT')).rejects.toThrow('HTTP 500: Internal Server Error');\n    });\n\n    it('should handle network errors', async () => {\n      mockFetch.mockRejectedValueOnce(new Error('Network error'));\n\n      await expect(client.getCurrentPrice('BTCUSDT')).rejects.toThrow('Request failed: Network error');\n    });\n\n    it('should handle API errors', async () => {\n      const mockResponse = {\n        retCode: 10001,\n        retMsg: 'Invalid API key'\n      };\n\n      mockFetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockResponse\n      } as any);\n\n      await expect(client.getCurrentPrice('BTCUSDT')).rejects.toThrow('Bybit API error: Invalid API key');\n    });\n  });\n});"],"version":3}