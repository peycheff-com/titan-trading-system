35a14a8a3306f6936b28ea7fbba9d834
"use strict";
/**
 * Backtest Engine for Titan Phase 2 - The Hunter
 *
 * Validates the Holographic Market Structure strategy on historical data with realistic
 * execution simulation including slippage, fees, and market conditions analysis.
 *
 * Requirements: 17.1-17.7 (Backtesting & Forward Testing)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.BacktestEngine = void 0;
const Logger_1 = require("../logging/Logger");
class BacktestEngine {
    bybitClient;
    hologramEngine;
    sessionProfiler;
    inefficiencyMapper;
    cvdValidator;
    signalGenerator;
    config;
    isRunning = false;
    constructor(bybitClient, hologramEngine, sessionProfiler, inefficiencyMapper, cvdValidator, signalGenerator) {
        this.bybitClient = bybitClient;
        this.hologramEngine = hologramEngine;
        this.sessionProfiler = sessionProfiler;
        this.inefficiencyMapper = inefficiencyMapper;
        this.cvdValidator = cvdValidator;
        this.signalGenerator = signalGenerator;
        // Default configuration
        this.config = {
            startDate: Date.now() - (30 * 24 * 60 * 60 * 1000), // 30 days ago
            endDate: Date.now(),
            symbols: ['BTCUSDT', 'ETHUSDT'],
            initialEquity: 10000,
            riskPerTrade: 0.02,
            maxLeverage: 3,
            maxConcurrentPositions: 3,
            slippageModel: {
                postOnlySlippage: 0.001, // 0.1%
                iocSlippage: 0.002, // 0.2%
                marketSlippage: 0.003 // 0.3%
            },
            feeModel: {
                makerFee: -0.0001, // -0.01% (rebate)
                takerFee: 0.0005 // 0.05%
            },
            timeframe: '15m'
        };
    }
    /**
     * Fetch historical OHLCV data for specified date range and symbols
     * Requirements: 17.1
     */
    async fetchHistoricalData(symbols, timeframe, startDate, endDate) {
        const historicalData = new Map();
        try {
            console.log(`üìä Fetching historical data for ${symbols.length} symbols from ${new Date(startDate).toISOString()} to ${new Date(endDate).toISOString()}`);
            for (const symbol of symbols) {
                try {
                    // Calculate required number of candles
                    const timeframeMs = this.getTimeframeMs(timeframe);
                    const duration = endDate - startDate;
                    const requiredCandles = Math.ceil(duration / timeframeMs) + 100; // Add buffer for indicators
                    // Fetch data in chunks if needed (Bybit limit is 1000 candles per request)
                    const allCandles = [];
                    let currentEndTime = endDate;
                    while (currentEndTime > startDate && allCandles.length < requiredCandles) {
                        const chunkSize = Math.min(1000, requiredCandles - allCandles.length);
                        const candles = await this.bybitClient.fetchOHLCV(symbol, timeframe, chunkSize);
                        if (candles.length === 0)
                            break;
                        // Filter candles within date range
                        const filteredCandles = candles.filter(candle => candle.timestamp >= startDate && candle.timestamp <= endDate);
                        allCandles.unshift(...filteredCandles);
                        // Update currentEndTime for next chunk
                        currentEndTime = candles[0].timestamp - timeframeMs;
                        // Add delay to respect rate limits
                        await this.sleep(100);
                    }
                    // Sort by timestamp and remove duplicates
                    const uniqueCandles = Array.from(new Map(allCandles.map(candle => [candle.timestamp, candle])).values()).sort((a, b) => a.timestamp - b.timestamp);
                    historicalData.set(symbol, uniqueCandles);
                    console.log(`‚úÖ Fetched ${uniqueCandles.length} candles for ${symbol}`);
                }
                catch (error) {
                    console.error(`‚ùå Failed to fetch data for ${symbol}:`, error);
                    (0, Logger_1.logError)('ERROR', `Failed to fetch historical data for ${symbol}`, {
                        symbol,
                        component: 'BacktestEngine',
                        function: 'fetchHistoricalData',
                        stack: error.stack
                    });
                }
            }
            console.log(`‚úÖ Historical data fetch complete: ${historicalData.size} symbols`);
            return historicalData;
        }
        catch (error) {
            console.error('‚ùå Error fetching historical data:', error);
            throw new Error(`Failed to fetch historical data: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Simulate trade execution with realistic slippage
     * Requirements: 17.2
     */
    simulateTrade(signal, orderType, currentPrice) {
        let slippagePercent;
        let filled = true;
        // Apply slippage based on order type
        switch (orderType) {
            case 'POST_ONLY':
                slippagePercent = this.config.slippageModel.postOnlySlippage;
                // Post-Only orders have a chance of not filling if price moves away
                if (Math.random() < 0.1) { // 10% chance of no fill
                    filled = false;
                }
                break;
            case 'IOC':
                slippagePercent = this.config.slippageModel.iocSlippage;
                break;
            case 'MARKET':
                slippagePercent = this.config.slippageModel.marketSlippage;
                break;
            default:
                slippagePercent = this.config.slippageModel.iocSlippage;
        }
        if (!filled) {
            return { fillPrice: 0, slippage: 0, filled: false };
        }
        // Calculate slippage direction based on trade direction
        const slippageDirection = signal.direction === 'LONG' ? 1 : -1;
        const slippageAmount = currentPrice * slippagePercent * slippageDirection;
        const fillPrice = currentPrice + slippageAmount;
        const slippage = Math.abs(slippageAmount);
        return { fillPrice, slippage, filled: true };
    }
    /**
     * Apply fee model to trades
     * Requirements: 17.3
     */
    applyFees(notionalValue, orderType) {
        let feeRate;
        // Apply fees based on order type
        switch (orderType) {
            case 'POST_ONLY':
                feeRate = this.config.feeModel.makerFee; // Negative = rebate
                break;
            case 'IOC':
            case 'MARKET':
                feeRate = this.config.feeModel.takerFee;
                break;
            default:
                feeRate = this.config.feeModel.takerFee;
        }
        return notionalValue * feeRate;
    }
    /**
     * Calculate comprehensive backtest results
     * Requirements: 17.4
     */
    calcBacktestResults(trades, config) {
        if (trades.length === 0) {
            return this.getEmptyMetrics(config);
        }
        const duration = config.endDate - config.startDate;
        const durationYears = duration / (365.25 * 24 * 60 * 60 * 1000);
        // Basic trade statistics
        const winningTrades = trades.filter(t => t.pnl > 0);
        const losingTrades = trades.filter(t => t.pnl < 0);
        const totalPnl = trades.reduce((sum, t) => sum + t.pnl, 0);
        const totalFees = trades.reduce((sum, t) => sum + t.fees, 0);
        const totalSlippage = trades.reduce((sum, t) => sum + t.slippage, 0);
        // Calculate equity curve for drawdown analysis
        let runningEquity = config.initialEquity;
        let maxEquity = config.initialEquity;
        let maxDrawdown = 0;
        let currentDrawdownStart = 0;
        let maxDrawdownDuration = 0;
        for (const trade of trades) {
            runningEquity += trade.pnl;
            if (runningEquity > maxEquity) {
                maxEquity = runningEquity;
                currentDrawdownStart = 0;
            }
            else {
                const drawdown = (maxEquity - runningEquity) / maxEquity;
                if (drawdown > maxDrawdown) {
                    maxDrawdown = drawdown;
                }
                if (currentDrawdownStart === 0) {
                    currentDrawdownStart = trade.exitTime;
                }
                else {
                    const drawdownDuration = trade.exitTime - currentDrawdownStart;
                    if (drawdownDuration > maxDrawdownDuration) {
                        maxDrawdownDuration = drawdownDuration;
                    }
                }
            }
        }
        const finalEquity = config.initialEquity + totalPnl;
        const totalReturn = (finalEquity - config.initialEquity) / config.initialEquity;
        const annualizedReturn = Math.pow(1 + totalReturn, 1 / durationYears) - 1;
        // Risk metrics
        const returns = trades.map(t => t.pnlPercent);
        const avgReturn = returns.reduce((sum, r) => sum + r, 0) / returns.length;
        const returnStdDev = Math.sqrt(returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length);
        const sharpeRatio = returnStdDev > 0 ? (avgReturn / returnStdDev) * Math.sqrt(252) : 0;
        const negativeReturns = returns.filter(r => r < 0);
        const downsideStdDev = negativeReturns.length > 0
            ? Math.sqrt(negativeReturns.reduce((sum, r) => sum + Math.pow(r, 2), 0) / negativeReturns.length)
            : 0;
        const sortinoRatio = downsideStdDev > 0 ? (avgReturn / downsideStdDev) * Math.sqrt(252) : 0;
        const calmarRatio = maxDrawdown > 0 ? annualizedReturn / maxDrawdown : 0;
        // Trade statistics
        const winRate = winningTrades.length / trades.length;
        const grossProfit = winningTrades.reduce((sum, t) => sum + t.pnl, 0);
        const grossLoss = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));
        const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? Infinity : 0;
        const averageWin = winningTrades.length > 0
            ? winningTrades.reduce((sum, t) => sum + t.pnl, 0) / winningTrades.length
            : 0;
        const averageLoss = losingTrades.length > 0
            ? losingTrades.reduce((sum, t) => sum + t.pnl, 0) / losingTrades.length
            : 0;
        const largestWin = winningTrades.length > 0
            ? Math.max(...winningTrades.map(t => t.pnl))
            : 0;
        const largestLoss = losingTrades.length > 0
            ? Math.min(...losingTrades.map(t => t.pnl))
            : 0;
        const averageHoldTime = trades.reduce((sum, t) => sum + t.holdTime, 0) / trades.length;
        // Consecutive wins/losses
        let maxConsecutiveWins = 0;
        let maxConsecutiveLosses = 0;
        let currentWinStreak = 0;
        let currentLossStreak = 0;
        for (const trade of trades) {
            if (trade.pnl > 0) {
                currentWinStreak++;
                currentLossStreak = 0;
                maxConsecutiveWins = Math.max(maxConsecutiveWins, currentWinStreak);
            }
            else {
                currentLossStreak++;
                currentWinStreak = 0;
                maxConsecutiveLosses = Math.max(maxConsecutiveLosses, currentLossStreak);
            }
        }
        // Position statistics
        const positionCounts = trades.map(t => 1); // Simplified - would need actual concurrent position tracking
        const maxConcurrentPositions = Math.max(...positionCounts);
        const averagePositionsOpen = positionCounts.reduce((sum, c) => sum + c, 0) / positionCounts.length;
        return {
            startDate: config.startDate,
            endDate: config.endDate,
            duration,
            initialEquity: config.initialEquity,
            finalEquity,
            totalReturn,
            annualizedReturn,
            maxDrawdown,
            maxDrawdownDuration,
            sharpeRatio,
            sortinoRatio,
            calmarRatio,
            winRate,
            profitFactor,
            totalTrades: trades.length,
            averageWin,
            averageLoss,
            largestWin,
            largestLoss,
            consecutiveWins: maxConsecutiveWins,
            consecutiveLosses: maxConsecutiveLosses,
            averageHoldTime,
            totalFees,
            totalSlippage,
            maxConcurrentPositions,
            averagePositionsOpen
        };
    }
    /**
     * Generate equity curve chart data
     * Requirements: 17.5
     */
    generateEquityCurve(trades, initialEquity) {
        const equityCurve = [];
        let runningEquity = initialEquity;
        let maxEquity = initialEquity;
        let openPositions = 0;
        // Add starting point
        equityCurve.push({
            timestamp: trades.length > 0 ? trades[0].entryTime : Date.now(),
            equity: initialEquity,
            drawdown: 0,
            openPositions: 0
        });
        for (const trade of trades) {
            // Entry point
            openPositions++;
            equityCurve.push({
                timestamp: trade.entryTime,
                equity: runningEquity,
                drawdown: maxEquity > 0 ? (maxEquity - runningEquity) / maxEquity : 0,
                openPositions
            });
            // Exit point
            runningEquity += trade.pnl;
            openPositions--;
            if (runningEquity > maxEquity) {
                maxEquity = runningEquity;
            }
            equityCurve.push({
                timestamp: trade.exitTime,
                equity: runningEquity,
                drawdown: maxEquity > 0 ? (maxEquity - runningEquity) / maxEquity : 0,
                openPositions
            });
        }
        return equityCurve;
    }
    /**
     * Analyze losing periods and correlate with market conditions
     * Requirements: 17.6
     */
    analyzeLosingPeriods(trades, historicalData) {
        const losingPeriods = [];
        let currentPeriod = null;
        let consecutiveLosses = 0;
        for (const trade of trades) {
            if (trade.pnl < 0) {
                consecutiveLosses++;
                if (!currentPeriod) {
                    // Start new losing period
                    currentPeriod = {
                        startTime: trade.entryTime,
                        consecutiveLosses: 1,
                        totalLoss: trade.pnl,
                        maxDrawdown: Math.abs(trade.pnl)
                    };
                }
                else {
                    // Continue losing period
                    currentPeriod.consecutiveLosses = consecutiveLosses;
                    currentPeriod.totalLoss += trade.pnl;
                    currentPeriod.maxDrawdown = Math.max(currentPeriod.maxDrawdown, Math.abs(currentPeriod.totalLoss));
                }
            }
            else {
                // End losing period if it exists
                if (currentPeriod && consecutiveLosses >= 3) {
                    currentPeriod.endTime = trade.entryTime;
                    currentPeriod.duration = currentPeriod.endTime - currentPeriod.startTime;
                    // Analyze market conditions during this period
                    currentPeriod.marketConditions = this.analyzeMarketConditions(currentPeriod.startTime, currentPeriod.endTime, historicalData);
                    // Generate suggested adjustments
                    currentPeriod.suggestedAdjustments = this.generateAdjustmentSuggestions(currentPeriod);
                    losingPeriods.push(currentPeriod);
                }
                currentPeriod = null;
                consecutiveLosses = 0;
            }
        }
        // Handle ongoing losing period at end
        if (currentPeriod && consecutiveLosses >= 3) {
            const lastTrade = trades[trades.length - 1];
            currentPeriod.endTime = lastTrade.exitTime;
            currentPeriod.duration = currentPeriod.endTime - currentPeriod.startTime;
            currentPeriod.marketConditions = this.analyzeMarketConditions(currentPeriod.startTime, currentPeriod.endTime, historicalData);
            currentPeriod.suggestedAdjustments = this.generateAdjustmentSuggestions(currentPeriod);
            losingPeriods.push(currentPeriod);
        }
        return losingPeriods;
    }
    /**
     * Run complete backtest
     */
    async runBacktest(config = {}) {
        if (this.isRunning) {
            throw new Error('Backtest is already running');
        }
        this.isRunning = true;
        this.config = { ...this.config, ...config };
        try {
            console.log('üöÄ Starting backtest...');
            console.log(`üìÖ Period: ${new Date(this.config.startDate).toISOString()} to ${new Date(this.config.endDate).toISOString()}`);
            console.log(`üí∞ Initial Equity: $${this.config.initialEquity.toLocaleString()}`);
            console.log(`üìä Symbols: ${this.config.symbols.join(', ')}`);
            // Fetch historical data
            const historicalData = await this.fetchHistoricalData(this.config.symbols, this.config.timeframe, this.config.startDate, this.config.endDate);
            // Simulate trading
            const trades = await this.simulateTrading(historicalData);
            // Calculate results
            const metrics = this.calcBacktestResults(trades, this.config);
            const equityCurve = this.generateEquityCurve(trades, this.config.initialEquity);
            const drawdownCurve = this.generateDrawdownCurve(equityCurve);
            const losingPeriods = this.analyzeLosingPeriods(trades, historicalData);
            const marketConditionAnalysis = this.analyzeMarketConditionPerformance(trades, historicalData);
            const results = {
                config: this.config,
                trades,
                metrics,
                equityCurve,
                drawdownCurve,
                losingPeriods,
                marketConditionAnalysis
            };
            console.log('‚úÖ Backtest completed successfully');
            console.log(`üìà Total Return: ${(metrics.totalReturn * 100).toFixed(2)}%`);
            console.log(`üéØ Win Rate: ${(metrics.winRate * 100).toFixed(1)}%`);
            console.log(`üíπ Profit Factor: ${metrics.profitFactor.toFixed(2)}`);
            console.log(`üìâ Max Drawdown: ${(metrics.maxDrawdown * 100).toFixed(2)}%`);
            return results;
        }
        catch (error) {
            console.error('‚ùå Backtest failed:', error);
            throw error;
        }
        finally {
            this.isRunning = false;
        }
    }
    /**
     * Simulate trading over historical data
     */
    async simulateTrading(historicalData) {
        const trades = [];
        const openPositions = new Map();
        let currentEquity = this.config.initialEquity;
        // Get all timestamps across all symbols
        const allTimestamps = new Set();
        for (const candles of Array.from(historicalData.values())) {
            candles.forEach(candle => allTimestamps.add(candle.timestamp));
        }
        const sortedTimestamps = Array.from(allTimestamps).sort((a, b) => a - b);
        console.log(`üîÑ Simulating trading across ${sortedTimestamps.length} time periods...`);
        for (let i = 0; i < sortedTimestamps.length; i++) {
            const timestamp = sortedTimestamps[i];
            // Check for exits first
            for (const [symbol, position] of Array.from(openPositions.entries())) {
                const candles = historicalData.get(symbol);
                if (!candles)
                    continue;
                const currentCandle = candles.find(c => c.timestamp === timestamp);
                if (!currentCandle)
                    continue;
                const exitResult = this.checkExit(position, currentCandle);
                if (exitResult.shouldExit) {
                    // Close position
                    position.exitTime = timestamp;
                    position.exitPrice = exitResult.exitPrice;
                    position.exitReason = exitResult.reason;
                    position.holdTime = position.exitTime - position.entryTime;
                    // Calculate PnL
                    const pnlMultiplier = position.direction === 'LONG'
                        ? (position.exitPrice - position.entryPrice) / position.entryPrice
                        : (position.entryPrice - position.exitPrice) / position.entryPrice;
                    position.pnl = position.quantity * position.entryPrice * pnlMultiplier * position.leverage;
                    position.pnlPercent = pnlMultiplier * position.leverage;
                    position.rValue = position.pnl / (Math.abs(position.entryPrice - position.signal.stopLoss) * position.quantity);
                    // Apply fees and slippage
                    const notionalValue = position.quantity * position.exitPrice;
                    position.fees += this.applyFees(notionalValue, 'IOC'); // Assume IOC for exits
                    const slippageResult = this.simulateTrade(position.signal, 'IOC', position.exitPrice);
                    position.slippage += slippageResult.slippage;
                    currentEquity += position.pnl - position.fees - position.slippage;
                    trades.push(position);
                    openPositions.delete(symbol);
                }
            }
            // Check for new entries
            if (openPositions.size < this.config.maxConcurrentPositions) {
                for (const symbol of this.config.symbols) {
                    if (openPositions.has(symbol))
                        continue;
                    const candles = historicalData.get(symbol);
                    if (!candles)
                        continue;
                    const currentCandle = candles.find(c => c.timestamp === timestamp);
                    if (!currentCandle)
                        continue;
                    // Generate signal (simplified - would need full market structure analysis)
                    const signal = await this.generateBacktestSignal(symbol, candles, i, currentEquity);
                    if (!signal)
                        continue;
                    // Simulate order execution
                    const orderType = 'POST_ONLY'; // Hunter uses Post-Only orders
                    const executionResult = this.simulateTrade(signal, orderType, currentCandle.close);
                    if (executionResult.filled) {
                        // Create new position
                        const position = {
                            id: `${symbol}_${timestamp}`,
                            symbol,
                            direction: signal.direction,
                            entryTime: timestamp,
                            exitTime: 0,
                            entryPrice: executionResult.fillPrice,
                            exitPrice: 0,
                            quantity: signal.positionSize,
                            leverage: signal.leverage,
                            pnl: 0,
                            pnlPercent: 0,
                            fees: this.applyFees(signal.positionSize * executionResult.fillPrice, orderType),
                            slippage: executionResult.slippage,
                            holdTime: 0,
                            exitReason: 'MANUAL',
                            signal,
                            rValue: 0
                        };
                        openPositions.set(symbol, position);
                    }
                }
            }
            // Progress logging
            if (i % 1000 === 0) {
                const progress = (i / sortedTimestamps.length * 100).toFixed(1);
                console.log(`üìä Progress: ${progress}% - Open positions: ${openPositions.size} - Completed trades: ${trades.length}`);
            }
        }
        // Close any remaining open positions
        for (const position of Array.from(openPositions.values())) {
            const lastCandle = historicalData.get(position.symbol)?.slice(-1)[0];
            if (lastCandle) {
                position.exitTime = lastCandle.timestamp;
                position.exitPrice = lastCandle.close;
                position.exitReason = 'MANUAL';
                position.holdTime = position.exitTime - position.entryTime;
                const pnlMultiplier = position.direction === 'LONG'
                    ? (position.exitPrice - position.entryPrice) / position.entryPrice
                    : (position.entryPrice - position.exitPrice) / position.entryPrice;
                position.pnl = position.quantity * position.entryPrice * pnlMultiplier * position.leverage;
                position.pnlPercent = pnlMultiplier * position.leverage;
                position.rValue = position.pnl / (Math.abs(position.entryPrice - position.signal.stopLoss) * position.quantity);
                trades.push(position);
            }
        }
        return trades;
    }
    /**
     * Generate simplified backtest signal
     */
    async generateBacktestSignal(symbol, candles, currentIndex, currentEquity) {
        // Simplified signal generation for backtesting
        // In a real implementation, this would use the full HologramEngine
        if (currentIndex < 50)
            return null; // Need enough history
        const currentCandle = candles[currentIndex];
        const recentCandles = candles.slice(Math.max(0, currentIndex - 50), currentIndex + 1);
        // Simple trend detection
        const sma20 = this.calculateSMA(recentCandles.slice(-20), 'close');
        const sma50 = this.calculateSMA(recentCandles.slice(-50), 'close');
        if (sma20 <= sma50)
            return null; // Only long signals in uptrend
        // Random signal generation for demo (replace with real logic)
        if (Math.random() < 0.05) { // 5% chance of signal
            const direction = 'LONG';
            const entryPrice = currentCandle.close;
            const stopLoss = entryPrice * 0.985; // 1.5% stop
            const takeProfit = entryPrice * 1.045; // 4.5% target
            const positionSize = (currentEquity * this.config.riskPerTrade) / (entryPrice - stopLoss);
            return {
                symbol,
                direction,
                hologramStatus: 'B',
                alignmentScore: 70,
                rsScore: 0.02,
                sessionType: 'LONDON',
                poiType: 'ORDER_BLOCK',
                cvdConfirmation: true,
                confidence: 75,
                entryPrice,
                stopLoss,
                takeProfit,
                positionSize,
                leverage: this.config.maxLeverage,
                timestamp: currentCandle.timestamp
            };
        }
        return null;
    }
    /**
     * Check if position should be exited
     */
    checkExit(position, currentCandle) {
        const signal = position.signal;
        // Check stop loss
        if (position.direction === 'LONG' && currentCandle.low <= signal.stopLoss) {
            return { shouldExit: true, exitPrice: signal.stopLoss, reason: 'STOP_LOSS' };
        }
        if (position.direction === 'SHORT' && currentCandle.high >= signal.stopLoss) {
            return { shouldExit: true, exitPrice: signal.stopLoss, reason: 'STOP_LOSS' };
        }
        // Check take profit
        if (position.direction === 'LONG' && currentCandle.high >= signal.takeProfit) {
            return { shouldExit: true, exitPrice: signal.takeProfit, reason: 'TAKE_PROFIT' };
        }
        if (position.direction === 'SHORT' && currentCandle.low <= signal.takeProfit) {
            return { shouldExit: true, exitPrice: signal.takeProfit, reason: 'TAKE_PROFIT' };
        }
        // Check timeout (72 hours max hold)
        const maxHoldTime = 72 * 60 * 60 * 1000; // 72 hours
        if (currentCandle.timestamp - position.entryTime > maxHoldTime) {
            return { shouldExit: true, exitPrice: currentCandle.close, reason: 'TIMEOUT' };
        }
        return { shouldExit: false, exitPrice: 0, reason: 'MANUAL' };
    }
    /**
     * Helper methods
     */
    getTimeframeMs(timeframe) {
        const timeframeMap = {
            '1m': 60 * 1000,
            '5m': 5 * 60 * 1000,
            '15m': 15 * 60 * 1000,
            '30m': 30 * 60 * 1000,
            '1h': 60 * 60 * 1000,
            '4h': 4 * 60 * 60 * 1000,
            '1d': 24 * 60 * 60 * 1000
        };
        return timeframeMap[timeframe] || 15 * 60 * 1000;
    }
    calculateSMA(candles, field) {
        const sum = candles.reduce((acc, candle) => acc + candle[field], 0);
        return sum / candles.length;
    }
    generateDrawdownCurve(equityCurve) {
        const drawdownCurve = [];
        let maxEquity = 0;
        let drawdownStart = 0;
        for (const point of equityCurve) {
            if (point.equity > maxEquity) {
                maxEquity = point.equity;
                drawdownStart = 0;
            }
            const drawdown = maxEquity > 0 ? (maxEquity - point.equity) / maxEquity : 0;
            if (drawdown > 0 && drawdownStart === 0) {
                drawdownStart = point.timestamp;
            }
            drawdownCurve.push({
                timestamp: point.timestamp,
                drawdown,
                duration: drawdownStart > 0 ? point.timestamp - drawdownStart : 0,
                peak: maxEquity,
                trough: point.equity
            });
        }
        return drawdownCurve;
    }
    analyzeMarketConditions(startTime, endTime, historicalData) {
        // Simplified market condition analysis
        // In a real implementation, this would be more sophisticated
        return {
            volatility: 0.02, // Placeholder
            trend: 'RANGE',
            session: 'LONDON',
            btcCorrelation: 0.8
        };
    }
    generateAdjustmentSuggestions(period) {
        const suggestions = [];
        if (period.marketConditions.volatility > 0.03) {
            suggestions.push('Reduce position sizes during high volatility periods');
        }
        if (period.marketConditions.btcCorrelation > 0.9) {
            suggestions.push('Avoid trading during high BTC correlation periods');
        }
        if (period.consecutiveLosses > 5) {
            suggestions.push('Implement circuit breaker after 3 consecutive losses');
        }
        return suggestions;
    }
    analyzeMarketConditionPerformance(trades, historicalData) {
        // Simplified analysis - would be more detailed in real implementation
        const defaultPerf = { winRate: 0.5, profitFactor: 1.0, trades: 0 };
        return {
            volatilityRegimes: {
                low: defaultPerf,
                medium: defaultPerf,
                high: defaultPerf
            },
            sessionPerformance: {
                ASIAN: defaultPerf,
                LONDON: defaultPerf,
                NY: defaultPerf,
                DEAD_ZONE: defaultPerf
            },
            trendPerformance: {
                BULL: defaultPerf,
                BEAR: defaultPerf,
                RANGE: defaultPerf
            },
            correlationImpact: {
                lowCorrelation: defaultPerf,
                highCorrelation: defaultPerf
            }
        };
    }
    getEmptyMetrics(config) {
        return {
            startDate: config.startDate,
            endDate: config.endDate,
            duration: config.endDate - config.startDate,
            initialEquity: config.initialEquity,
            finalEquity: config.initialEquity,
            totalReturn: 0,
            annualizedReturn: 0,
            maxDrawdown: 0,
            maxDrawdownDuration: 0,
            sharpeRatio: 0,
            sortinoRatio: 0,
            calmarRatio: 0,
            winRate: 0,
            profitFactor: 0,
            totalTrades: 0,
            averageWin: 0,
            averageLoss: 0,
            largestWin: 0,
            largestLoss: 0,
            consecutiveWins: 0,
            consecutiveLosses: 0,
            averageHoldTime: 0,
            totalFees: 0,
            totalSlippage: 0,
            maxConcurrentPositions: 0,
            averagePositionsOpen: 0
        };
    }
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('üìù BacktestEngine configuration updated');
    }
    /**
     * Get current configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Check if backtest is currently running
     */
    isBacktestRunning() {
        return this.isRunning;
    }
}
exports.BacktestEngine = BacktestEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2JhY2t0ZXN0L0JhY2t0ZXN0RW5naW5lLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFvQkgsOENBQTZDO0FBcUk3QyxNQUFhLGNBQWM7SUFDakIsV0FBVyxDQUFtQjtJQUM5QixjQUFjLENBQWlCO0lBQy9CLGVBQWUsQ0FBa0I7SUFDakMsa0JBQWtCLENBQXFCO0lBQ3ZDLFlBQVksQ0FBZTtJQUMzQixlQUFlLENBQWtCO0lBQ2pDLE1BQU0sQ0FBaUI7SUFDdkIsU0FBUyxHQUFHLEtBQUssQ0FBQztJQUUxQixZQUNFLFdBQTZCLEVBQzdCLGNBQThCLEVBQzlCLGVBQWdDLEVBQ2hDLGtCQUFzQyxFQUN0QyxZQUEwQixFQUMxQixlQUFnQztRQUVoQyxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztRQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztRQUN2QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7UUFDN0MsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFFdkMsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLGNBQWM7WUFDbEUsT0FBTyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDbkIsT0FBTyxFQUFFLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQztZQUMvQixhQUFhLEVBQUUsS0FBSztZQUNwQixZQUFZLEVBQUUsSUFBSTtZQUNsQixXQUFXLEVBQUUsQ0FBQztZQUNkLHNCQUFz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UyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxZQUFZLEdBQUcsU0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFOUYsTUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDLE1BQU07WUFDekUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNOLE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUN6QyxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxNQUFNO1lBQ3ZFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFTixNQUFNLFVBQVUsR0FBRyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUM7WUFDekMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzVDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDTixNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUM7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LGVBQWUsRUFBRSxDQUFDO1lBQ2xCLFNBQVMsRUFBRSxDQUFDO1lBQ1osYUFBYSxFQUFFLENBQUM7WUFDaEIsc0JBQXNCLEVBQUUsQ0FBQztZQUN6QixvQkFBb0IsRUFBRSxDQUFDO1NBQ3hCLENBQUM7SUFDSixDQUFDO0lBRU8sS0FBSyxDQUFDLEVBQVU7UUFDdEIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxZQUFZLENBQUMsU0FBa0M7UUFDcEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFNBQVMsRUFBRSxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxTQUFTO1FBQ2QsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRDs7T0FFRztJQUNJLGlCQUFpQjtRQUN0QixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztDQUNGO0FBcDVCRCx3Q0FvNUJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1waGFzZTItaHVudGVyL3NyYy9iYWNrdGVzdC9CYWNrdGVzdEVuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJhY2t0ZXN0IEVuZ2luZSBmb3IgVGl0YW4gUGhhc2UgMiAtIFRoZSBIdW50ZXJcbiAqIFxuICogVmFsaWRhdGVzIHRoZSBIb2xvZ3JhcGhpYyBNYXJrZXQgU3RydWN0dXJlIHN0cmF0ZWd5IG9uIGhpc3RvcmljYWwgZGF0YSB3aXRoIHJlYWxpc3RpY1xuICogZXhlY3V0aW9uIHNpbXVsYXRpb24gaW5jbHVkaW5nIHNsaXBwYWdlLCBmZWVzLCBhbmQgbWFya2V0IGNvbmRpdGlvbnMgYW5hbHlzaXMuXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMTcuMS0xNy43IChCYWNrdGVzdGluZyAmIEZvcndhcmQgVGVzdGluZylcbiAqL1xuXG5pbXBvcnQgeyBcbiAgT0hMQ1YsIFxuICBTaWduYWxEYXRhLCBcbiAgSG9sb2dyYW1TdGF0ZSwgXG4gIFNlc3Npb25UeXBlLCBcbiAgTWV0cmljcywgXG4gIFRpbWVSYW5nZSxcbiAgUG9zaXRpb24sXG4gIE9yZGVyUGFyYW1zLFxuICBPcmRlclJlc3VsdCxcbiAgT3JkZXJTdGF0dXNcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgQnliaXRQZXJwc0NsaWVudCB9IGZyb20gJy4uL2V4Y2hhbmdlcy9CeWJpdFBlcnBzQ2xpZW50JztcbmltcG9ydCB7IEhvbG9ncmFtRW5naW5lIH0gZnJvbSAnLi4vZW5naW5lL0hvbG9ncmFtRW5naW5lJztcbmltcG9ydCB7IFNlc3Npb25Qcm9maWxlciB9IGZyb20gJy4uL2VuZ2luZS9TZXNzaW9uUHJvZmlsZXInO1xuaW1wb3J0IHsgSW5lZmZpY2llbmN5TWFwcGVyIH0gZnJvbSAnLi4vZW5naW5lL0luZWZmaWNpZW5jeU1hcHBlcic7XG5pbXBvcnQgeyBDVkRWYWxpZGF0b3IgfSBmcm9tICcuLi9lbmdpbmUvQ1ZEVmFsaWRhdG9yJztcbmltcG9ydCB7IFNpZ25hbEdlbmVyYXRvciB9IGZyb20gJy4uL2V4ZWN1dGlvbi9TaWduYWxHZW5lcmF0b3InO1xuaW1wb3J0IHsgbG9nRXJyb3IgfSBmcm9tICcuLi9sb2dnaW5nL0xvZ2dlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFja3Rlc3RDb25maWcge1xuICBzdGFydERhdGU6IG51bWJlcjsgLy8gVW5peCB0aW1lc3RhbXBcbiAgZW5kRGF0ZTogbnVtYmVyOyAvLyBVbml4IHRpbWVzdGFtcFxuICBzeW1ib2xzOiBzdHJpbmdbXTsgLy8gU3ltYm9scyB0byBiYWNrdGVzdFxuICBpbml0aWFsRXF1aXR5OiBudW1iZXI7IC8vIFN0YXJ0aW5nIGNhcGl0YWxcbiAgcmlza1BlclRyYWRlOiBudW1iZXI7IC8vIFJpc2sgcGVyIHRyYWRlICgwLjAyID0gMiUpXG4gIG1heExldmVyYWdlOiBudW1iZXI7IC8vIE1heGltdW0gbGV2ZXJhZ2UgKDMtNXgpXG4gIG1heENvbmN1cnJlbnRQb3NpdGlvbnM6IG51bWJlcjsgLy8gTWF4IG9wZW4gcG9zaXRpb25zXG4gIHNsaXBwYWdlTW9kZWw6IFNsaXBwYWdlTW9kZWw7XG4gIGZlZU1vZGVsOiBGZWVNb2RlbDtcbiAgdGltZWZyYW1lOiBzdHJpbmc7IC8vIFByaW1hcnkgdGltZWZyYW1lIGZvciBzaWduYWxzICgnMTVtJylcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTbGlwcGFnZU1vZGVsIHtcbiAgcG9zdE9ubHlTbGlwcGFnZTogbnVtYmVyOyAvLyAwLjAwMSA9IDAuMSVcbiAgaW9jU2xpcHBhZ2U6IG51bWJlcjsgLy8gMC4wMDIgPSAwLjIlXG4gIG1hcmtldFNsaXBwYWdlOiBudW1iZXI7IC8vIDAuMDAzID0gMC4zJVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZlZU1vZGVsIHtcbiAgbWFrZXJGZWU6IG51bWJlcjsgLy8gLTAuMDAwMSA9IC0wLjAxJSAocmViYXRlKVxuICB0YWtlckZlZTogbnVtYmVyOyAvLyAwLjAwMDUgPSAwLjA1JVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJhY2t0ZXN0VHJhZGUge1xuICBpZDogc3RyaW5nO1xuICBzeW1ib2w6IHN0cmluZztcbiAgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnO1xuICBlbnRyeVRpbWU6IG51bWJlcjtcbiAgZXhpdFRpbWU6IG51bWJlcjtcbiAgZW50cnlQcmljZTogbnVtYmVyO1xuICBleGl0UHJpY2U6IG51bWJlcjtcbiAgcXVhbnRpdHk6IG51bWJlcjtcbiAgbGV2ZXJhZ2U6IG51bWJlcjtcbiAgcG5sOiBudW1iZXI7XG4gIHBubFBlcmNlbnQ6IG51bWJlcjtcbiAgZmVlczogbnVtYmVyO1xuICBzbGlwcGFnZTogbnVtYmVyO1xuICBob2xkVGltZTogbnVtYmVyOyAvLyBtaWxsaXNlY29uZHNcbiAgZXhpdFJlYXNvbjogJ1NUT1BfTE9TUycgfCAnVEFLRV9QUk9GSVQnIHwgJ1RJTUVPVVQnIHwgJ01BTlVBTCc7XG4gIHNpZ25hbDogU2lnbmFsRGF0YTtcbiAgclZhbHVlOiBudW1iZXI7IC8vIFIgbXVsdGlwbGUgKHByb2ZpdC9sb3NzIGluIFIgdW5pdHMpXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFja3Rlc3RSZXN1bHRzIHtcbiAgY29uZmlnOiBCYWNrdGVzdENvbmZpZztcbiAgdHJhZGVzOiBCYWNrdGVzdFRyYWRlW107XG4gIG1ldHJpY3M6IEJhY2t0ZXN0TWV0cmljcztcbiAgZXF1aXR5Q3VydmU6IEVxdWl0eVBvaW50W107XG4gIGRyYXdkb3duQ3VydmU6IERyYXdkb3duUG9pbnRbXTtcbiAgbG9zaW5nUGVyaW9kczogTG9zaW5nUGVyaW9kW107XG4gIG1hcmtldENvbmRpdGlvbkFuYWx5c2lzOiBNYXJrZXRDb25kaXRpb25BbmFseXNpcztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCYWNrdGVzdE1ldHJpY3MgZXh0ZW5kcyBNZXRyaWNzIHtcbiAgc3RhcnREYXRlOiBudW1iZXI7XG4gIGVuZERhdGU6IG51bWJlcjtcbiAgZHVyYXRpb246IG51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXG4gIGluaXRpYWxFcXVpdHk6IG51bWJlcjtcbiAgZmluYWxFcXVpdHk6IG51bWJlcjtcbiAgdG90YWxSZXR1cm46IG51bWJlcjtcbiAgYW5udWFsaXplZFJldHVybjogbnVtYmVyO1xuICBtYXhEcmF3ZG93bjogbnVtYmVyO1xuICBtYXhEcmF3ZG93bkR1cmF0aW9uOiBudW1iZXI7IC8vIG1pbGxpc2Vjb25kc1xuICBzaGFycGVSYXRpbzogbnVtYmVyO1xuICBzb3J0aW5vUmF0aW86IG51bWJlcjtcbiAgY2FsbWFyUmF0aW86IG51bWJlcjtcbiAgd2luUmF0ZTogbnVtYmVyO1xuICBwcm9maXRGYWN0b3I6IG51bWJlcjtcbiAgYXZlcmFnZVdpbjogbnVtYmVyO1xuICBhdmVyYWdlTG9zczogbnVtYmVyO1xuICBsYXJnZXN0V2luOiBudW1iZXI7XG4gIGxhcmdlc3RMb3NzOiBudW1iZXI7XG4gIGF2ZXJhZ2VIb2xkVGltZTogbnVtYmVyOyAvLyBtaWxsaXNlY29uZHNcbiAgdG90YWxGZWVzOiBudW1iZXI7XG4gIHRvdGFsU2xpcHBhZ2U6IG51bWJlcjtcbiAgbWF4Q29uY3VycmVudFBvc2l0aW9uczogbnVtYmVyO1xuICBhdmVyYWdlUG9zaXRpb25zT3BlbjogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVxdWl0eVBvaW50IHtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIGVxdWl0eTogbnVtYmVyO1xuICBkcmF3ZG93bjogbnVtYmVyO1xuICBvcGVuUG9zaXRpb25zOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJhd2Rvd25Qb2ludCB7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBkcmF3ZG93bjogbnVtYmVyO1xuICBkdXJhdGlvbjogbnVtYmVyOyAvLyBtaWxsaXNlY29uZHMgc2luY2UgZHJhd2Rvd24gc3RhcnRlZFxuICBwZWFrOiBudW1iZXI7XG4gIHRyb3VnaDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvc2luZ1BlcmlvZCB7XG4gIHN0YXJ0VGltZTogbnVtYmVyO1xuICBlbmRUaW1lOiBudW1iZXI7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIGNvbnNlY3V0aXZlTG9zc2VzOiBudW1iZXI7XG4gIHRvdGFsTG9zczogbnVtYmVyO1xuICBtYXhEcmF3ZG93bjogbnVtYmVyO1xuICBtYXJrZXRDb25kaXRpb25zOiB7XG4gICAgdm9sYXRpbGl0eTogbnVtYmVyO1xuICAgIHRyZW5kOiAnQlVMTCcgfCAnQkVBUicgfCAnUkFOR0UnO1xuICAgIHNlc3Npb246IFNlc3Npb25UeXBlO1xuICAgIGJ0Y0NvcnJlbGF0aW9uOiBudW1iZXI7XG4gIH07XG4gIHN1Z2dlc3RlZEFkanVzdG1lbnRzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNYXJrZXRDb25kaXRpb25BbmFseXNpcyB7XG4gIHZvbGF0aWxpdHlSZWdpbWVzOiB7XG4gICAgbG93OiB7IHdpblJhdGU6IG51bWJlcjsgcHJvZml0RmFjdG9yOiBudW1iZXI7IHRyYWRlczogbnVtYmVyIH07XG4gICAgbWVkaXVtOiB7IHdpblJhdGU6IG51bWJlcjsgcHJvZml0RmFjdG9yOiBudW1iZXI7IHRyYWRlczogbnVtYmVyIH07XG4gICAgaGlnaDogeyB3aW5SYXRlOiBudW1iZXI7IHByb2ZpdEZhY3RvcjogbnVtYmVyOyB0cmFkZXM6IG51bWJlciB9O1xuICB9O1xuICBzZXNzaW9uUGVyZm9ybWFuY2U6IHtcbiAgICBbSyBpbiBTZXNzaW9uVHlwZV06IHsgd2luUmF0ZTogbnVtYmVyOyBwcm9maXRGYWN0b3I6IG51bWJlcjsgdHJhZGVzOiBudW1iZXIgfTtcbiAgfTtcbiAgdHJlbmRQZXJmb3JtYW5jZToge1xuICAgIEJVTEw6IHsgd2luUmF0ZTogbnVtYmVyOyBwcm9maXRGYWN0b3I6IG51bWJlcjsgdHJhZGVzOiBudW1iZXIgfTtcbiAgICBCRUFSOiB7IHdpblJhdGU6IG51bWJlcjsgcHJvZml0RmFjdG9yOiBudW1iZXI7IHRyYWRlczogbnVtYmVyIH07XG4gICAgUkFOR0U6IHsgd2luUmF0ZTogbnVtYmVyOyBwcm9maXRGYWN0b3I6IG51bWJlcjsgdHJhZGVzOiBudW1iZXIgfTtcbiAgfTtcbiAgY29ycmVsYXRpb25JbXBhY3Q6IHtcbiAgICBsb3dDb3JyZWxhdGlvbjogeyB3aW5SYXRlOiBudW1iZXI7IHByb2ZpdEZhY3RvcjogbnVtYmVyOyB0cmFkZXM6IG51bWJlciB9O1xuICAgIGhpZ2hDb3JyZWxhdGlvbjogeyB3aW5SYXRlOiBudW1iZXI7IHByb2ZpdEZhY3RvcjogbnVtYmVyOyB0cmFkZXM6IG51bWJlciB9O1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQmFja3Rlc3RFbmdpbmUge1xuICBwcml2YXRlIGJ5Yml0Q2xpZW50OiBCeWJpdFBlcnBzQ2xpZW50O1xuICBwcml2YXRlIGhvbG9ncmFtRW5naW5lOiBIb2xvZ3JhbUVuZ2luZTtcbiAgcHJpdmF0ZSBzZXNzaW9uUHJvZmlsZXI6IFNlc3Npb25Qcm9maWxlcjtcbiAgcHJpdmF0ZSBpbmVmZmljaWVuY3lNYXBwZXI6IEluZWZmaWNpZW5jeU1hcHBlcjtcbiAgcHJpdmF0ZSBjdmRWYWxpZGF0b3I6IENWRFZhbGlkYXRvcjtcbiAgcHJpdmF0ZSBzaWduYWxHZW5lcmF0b3I6IFNpZ25hbEdlbmVyYXRvcjtcbiAgcHJpdmF0ZSBjb25maWc6IEJhY2t0ZXN0Q29uZmlnO1xuICBwcml2YXRlIGlzUnVubmluZyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGJ5Yml0Q2xpZW50OiBCeWJpdFBlcnBzQ2xpZW50LFxuICAgIGhvbG9ncmFtRW5naW5lOiBIb2xvZ3JhbUVuZ2luZSxcbiAgICBzZXNzaW9uUHJvZmlsZXI6IFNlc3Npb25Qcm9maWxlcixcbiAgICBpbmVmZmljaWVuY3lNYXBwZXI6IEluZWZmaWNpZW5jeU1hcHBlcixcbiAgICBjdmRWYWxpZGF0b3I6IENWRFZhbGlkYXRvcixcbiAgICBzaWduYWxHZW5lcmF0b3I6IFNpZ25hbEdlbmVyYXRvclxuICApIHtcbiAgICB0aGlzLmJ5Yml0Q2xpZW50ID0gYnliaXRDbGllbnQ7XG4gICAgdGhpcy5ob2xvZ3JhbUVuZ2luZSA9IGhvbG9ncmFtRW5naW5lO1xuICAgIHRoaXMuc2Vzc2lvblByb2ZpbGVyID0gc2Vzc2lvblByb2ZpbGVyO1xuICAgIHRoaXMuaW5lZmZpY2llbmN5TWFwcGVyID0gaW5lZmZpY2llbmN5TWFwcGVyO1xuICAgIHRoaXMuY3ZkVmFsaWRhdG9yID0gY3ZkVmFsaWRhdG9yO1xuICAgIHRoaXMuc2lnbmFsR2VuZXJhdG9yID0gc2lnbmFsR2VuZXJhdG9yO1xuXG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBzdGFydERhdGU6IERhdGUubm93KCkgLSAoMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSwgLy8gMzAgZGF5cyBhZ29cbiAgICAgIGVuZERhdGU6IERhdGUubm93KCksXG4gICAgICBzeW1ib2xzOiBbJ0JUQ1VTRFQnLCAnRVRIVVNEVCddLFxuICAgICAgaW5pdGlhbEVxdWl0eTogMTAwMDAsXG4gICAgICByaXNrUGVyVHJhZGU6IDAuMDIsXG4gICAgICBtYXhMZXZlcmFnZTogMyxcbiAgICAgIG1heENvbmN1cnJlbnRQb3NpdGlvbnM6IDMsXG4gICAgICBzbGlwcGFnZU1vZGVsOiB7XG4gICAgICAgIHBvc3RPbmx5U2xpcHBhZ2U6IDAuMDAxLCAvLyAwLjElXG4gICAgICAgIGlvY1NsaXBwYWdlOiAwLjAwMiwgLy8gMC4yJVxuICAgICAgICBtYXJrZXRTbGlwcGFnZTogMC4wMDMgLy8gMC4zJVxuICAgICAgfSxcbiAgICAgIGZlZU1vZGVsOiB7XG4gICAgICAgIG1ha2VyRmVlOiAtMC4wMDAxLCAvLyAtMC4wMSUgKHJlYmF0ZSlcbiAgICAgICAgdGFrZXJGZWU6IDAuMDAwNSAvLyAwLjA1JVxuICAgICAgfSxcbiAgICAgIHRpbWVmcmFtZTogJzE1bSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGhpc3RvcmljYWwgT0hMQ1YgZGF0YSBmb3Igc3BlY2lmaWVkIGRhdGUgcmFuZ2UgYW5kIHN5bWJvbHNcbiAgICogUmVxdWlyZW1lbnRzOiAxNy4xXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZmV0Y2hIaXN0b3JpY2FsRGF0YShcbiAgICBzeW1ib2xzOiBzdHJpbmdbXSxcbiAgICB0aW1lZnJhbWU6IHN0cmluZyxcbiAgICBzdGFydERhdGU6IG51bWJlcixcbiAgICBlbmREYXRlOiBudW1iZXJcbiAgKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBPSExDVltdPj4ge1xuICAgIGNvbnN0IGhpc3RvcmljYWxEYXRhID0gbmV3IE1hcDxzdHJpbmcsIE9ITENWW10+KCk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogRmV0Y2hpbmcgaGlzdG9yaWNhbCBkYXRhIGZvciAke3N5bWJvbHMubGVuZ3RofSBzeW1ib2xzIGZyb20gJHtuZXcgRGF0ZShzdGFydERhdGUpLnRvSVNPU3RyaW5nKCl9IHRvICR7bmV3IERhdGUoZW5kRGF0ZSkudG9JU09TdHJpbmcoKX1gKTtcblxuICAgICAgZm9yIChjb25zdCBzeW1ib2wgb2Ygc3ltYm9scykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIENhbGN1bGF0ZSByZXF1aXJlZCBudW1iZXIgb2YgY2FuZGxlc1xuICAgICAgICAgIGNvbnN0IHRpbWVmcmFtZU1zID0gdGhpcy5nZXRUaW1lZnJhbWVNcyh0aW1lZnJhbWUpO1xuICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kRGF0ZSAtIHN0YXJ0RGF0ZTtcbiAgICAgICAgICBjb25zdCByZXF1aXJlZENhbmRsZXMgPSBNYXRoLmNlaWwoZHVyYXRpb24gLyB0aW1lZnJhbWVNcykgKyAxMDA7IC8vIEFkZCBidWZmZXIgZm9yIGluZGljYXRvcnNcblxuICAgICAgICAgIC8vIEZldGNoIGRhdGEgaW4gY2h1bmtzIGlmIG5lZWRlZCAoQnliaXQgbGltaXQgaXMgMTAwMCBjYW5kbGVzIHBlciByZXF1ZXN0KVxuICAgICAgICAgIGNvbnN0IGFsbENhbmRsZXM6IE9ITENWW10gPSBbXTtcbiAgICAgICAgICBsZXQgY3VycmVudEVuZFRpbWUgPSBlbmREYXRlO1xuICAgICAgICAgIFxuICAgICAgICAgIHdoaWxlIChjdXJyZW50RW5kVGltZSA+IHN0YXJ0RGF0ZSAmJiBhbGxDYW5kbGVzLmxlbmd0aCA8IHJlcXVpcmVkQ2FuZGxlcykge1xuICAgICAgICAgICAgY29uc3QgY2h1bmtTaXplID0gTWF0aC5taW4oMTAwMCwgcmVxdWlyZWRDYW5kbGVzIC0gYWxsQ2FuZGxlcy5sZW5ndGgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBjYW5kbGVzID0gYXdhaXQgdGhpcy5ieWJpdENsaWVudC5mZXRjaE9ITENWKHN5bWJvbCwgdGltZWZyYW1lLCBjaHVua1NpemUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoY2FuZGxlcy5sZW5ndGggPT09IDApIGJyZWFrO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBGaWx0ZXIgY2FuZGxlcyB3aXRoaW4gZGF0ZSByYW5nZVxuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRDYW5kbGVzID0gY2FuZGxlcy5maWx0ZXIoXG4gICAgICAgICAgICAgIGNhbmRsZSA9PiBjYW5kbGUudGltZXN0YW1wID49IHN0YXJ0RGF0ZSAmJiBjYW5kbGUudGltZXN0YW1wIDw9IGVuZERhdGVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFsbENhbmRsZXMudW5zaGlmdCguLi5maWx0ZXJlZENhbmRsZXMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBVcGRhdGUgY3VycmVudEVuZFRpbWUgZm9yIG5leHQgY2h1bmtcbiAgICAgICAgICAgIGN1cnJlbnRFbmRUaW1lID0gY2FuZGxlc1swXS50aW1lc3RhbXAgLSB0aW1lZnJhbWVNcztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQWRkIGRlbGF5IHRvIHJlc3BlY3QgcmF0ZSBsaW1pdHNcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCBhbmQgcmVtb3ZlIGR1cGxpY2F0ZXNcbiAgICAgICAgICBjb25zdCB1bmlxdWVDYW5kbGVzID0gQXJyYXkuZnJvbShcbiAgICAgICAgICAgIG5ldyBNYXAoYWxsQ2FuZGxlcy5tYXAoY2FuZGxlID0+IFtjYW5kbGUudGltZXN0YW1wLCBjYW5kbGVdKSkudmFsdWVzKClcbiAgICAgICAgICApLnNvcnQoKGEsIGIpID0+IGEudGltZXN0YW1wIC0gYi50aW1lc3RhbXApO1xuXG4gICAgICAgICAgaGlzdG9yaWNhbERhdGEuc2V0KHN5bWJvbCwgdW5pcXVlQ2FuZGxlcyk7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBGZXRjaGVkICR7dW5pcXVlQ2FuZGxlcy5sZW5ndGh9IGNhbmRsZXMgZm9yICR7c3ltYm9sfWApO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBmZXRjaCBkYXRhIGZvciAke3N5bWJvbH06YCwgZXJyb3IpO1xuICAgICAgICAgIGxvZ0Vycm9yKCdFUlJPUicsIGBGYWlsZWQgdG8gZmV0Y2ggaGlzdG9yaWNhbCBkYXRhIGZvciAke3N5bWJvbH1gLCB7XG4gICAgICAgICAgICBzeW1ib2wsXG4gICAgICAgICAgICBjb21wb25lbnQ6ICdCYWNrdGVzdEVuZ2luZScsXG4gICAgICAgICAgICBmdW5jdGlvbjogJ2ZldGNoSGlzdG9yaWNhbERhdGEnLFxuICAgICAgICAgICAgc3RhY2s6IChlcnJvciBhcyBFcnJvcikuc3RhY2tcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEhpc3RvcmljYWwgZGF0YSBmZXRjaCBjb21wbGV0ZTogJHtoaXN0b3JpY2FsRGF0YS5zaXplfSBzeW1ib2xzYCk7XG4gICAgICByZXR1cm4gaGlzdG9yaWNhbERhdGE7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGhpc3RvcmljYWwgZGF0YTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBoaXN0b3JpY2FsIGRhdGE6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNpbXVsYXRlIHRyYWRlIGV4ZWN1dGlvbiB3aXRoIHJlYWxpc3RpYyBzbGlwcGFnZVxuICAgKiBSZXF1aXJlbWVudHM6IDE3LjJcbiAgICovXG4gIHB1YmxpYyBzaW11bGF0ZVRyYWRlKFxuICAgIHNpZ25hbDogU2lnbmFsRGF0YSxcbiAgICBvcmRlclR5cGU6ICdQT1NUX09OTFknIHwgJ0lPQycgfCAnTUFSS0VUJyxcbiAgICBjdXJyZW50UHJpY2U6IG51bWJlclxuICApOiB7IGZpbGxQcmljZTogbnVtYmVyOyBzbGlwcGFnZTogbnVtYmVyOyBmaWxsZWQ6IGJvb2xlYW4gfSB7XG4gICAgbGV0IHNsaXBwYWdlUGVyY2VudDogbnVtYmVyO1xuICAgIGxldCBmaWxsZWQgPSB0cnVlO1xuXG4gICAgLy8gQXBwbHkgc2xpcHBhZ2UgYmFzZWQgb24gb3JkZXIgdHlwZVxuICAgIHN3aXRjaCAob3JkZXJUeXBlKSB7XG4gICAgICBjYXNlICdQT1NUX09OTFknOlxuICAgICAgICBzbGlwcGFnZVBlcmNlbnQgPSB0aGlzLmNvbmZpZy5zbGlwcGFnZU1vZGVsLnBvc3RPbmx5U2xpcHBhZ2U7XG4gICAgICAgIC8vIFBvc3QtT25seSBvcmRlcnMgaGF2ZSBhIGNoYW5jZSBvZiBub3QgZmlsbGluZyBpZiBwcmljZSBtb3ZlcyBhd2F5XG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4xKSB7IC8vIDEwJSBjaGFuY2Ugb2Ygbm8gZmlsbFxuICAgICAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnSU9DJzpcbiAgICAgICAgc2xpcHBhZ2VQZXJjZW50ID0gdGhpcy5jb25maWcuc2xpcHBhZ2VNb2RlbC5pb2NTbGlwcGFnZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdNQVJLRVQnOlxuICAgICAgICBzbGlwcGFnZVBlcmNlbnQgPSB0aGlzLmNvbmZpZy5zbGlwcGFnZU1vZGVsLm1hcmtldFNsaXBwYWdlO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHNsaXBwYWdlUGVyY2VudCA9IHRoaXMuY29uZmlnLnNsaXBwYWdlTW9kZWwuaW9jU2xpcHBhZ2U7XG4gICAgfVxuXG4gICAgaWYgKCFmaWxsZWQpIHtcbiAgICAgIHJldHVybiB7IGZpbGxQcmljZTogMCwgc2xpcHBhZ2U6IDAsIGZpbGxlZDogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgc2xpcHBhZ2UgZGlyZWN0aW9uIGJhc2VkIG9uIHRyYWRlIGRpcmVjdGlvblxuICAgIGNvbnN0IHNsaXBwYWdlRGlyZWN0aW9uID0gc2lnbmFsLmRpcmVjdGlvbiA9PT0gJ0xPTkcnID8gMSA6IC0xO1xuICAgIGNvbnN0IHNsaXBwYWdlQW1vdW50ID0gY3VycmVudFByaWNlICogc2xpcHBhZ2VQZXJjZW50ICogc2xpcHBhZ2VEaXJlY3Rpb247XG4gICAgY29uc3QgZmlsbFByaWNlID0gY3VycmVudFByaWNlICsgc2xpcHBhZ2VBbW91bnQ7XG4gICAgY29uc3Qgc2xpcHBhZ2UgPSBNYXRoLmFicyhzbGlwcGFnZUFtb3VudCk7XG5cbiAgICByZXR1cm4geyBmaWxsUHJpY2UsIHNsaXBwYWdlLCBmaWxsZWQ6IHRydWUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBmZWUgbW9kZWwgdG8gdHJhZGVzXG4gICAqIFJlcXVpcmVtZW50czogMTcuM1xuICAgKi9cbiAgcHVibGljIGFwcGx5RmVlcyhcbiAgICBub3Rpb25hbFZhbHVlOiBudW1iZXIsXG4gICAgb3JkZXJUeXBlOiAnUE9TVF9PTkxZJyB8ICdJT0MnIHwgJ01BUktFVCdcbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgZmVlUmF0ZTogbnVtYmVyO1xuXG4gICAgLy8gQXBwbHkgZmVlcyBiYXNlZCBvbiBvcmRlciB0eXBlXG4gICAgc3dpdGNoIChvcmRlclR5cGUpIHtcbiAgICAgIGNhc2UgJ1BPU1RfT05MWSc6XG4gICAgICAgIGZlZVJhdGUgPSB0aGlzLmNvbmZpZy5mZWVNb2RlbC5tYWtlckZlZTsgLy8gTmVnYXRpdmUgPSByZWJhdGVcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdJT0MnOlxuICAgICAgY2FzZSAnTUFSS0VUJzpcbiAgICAgICAgZmVlUmF0ZSA9IHRoaXMuY29uZmlnLmZlZU1vZGVsLnRha2VyRmVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGZlZVJhdGUgPSB0aGlzLmNvbmZpZy5mZWVNb2RlbC50YWtlckZlZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm90aW9uYWxWYWx1ZSAqIGZlZVJhdGU7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGNvbXByZWhlbnNpdmUgYmFja3Rlc3QgcmVzdWx0c1xuICAgKiBSZXF1aXJlbWVudHM6IDE3LjRcbiAgICovXG4gIHB1YmxpYyBjYWxjQmFja3Rlc3RSZXN1bHRzKHRyYWRlczogQmFja3Rlc3RUcmFkZVtdLCBjb25maWc6IEJhY2t0ZXN0Q29uZmlnKTogQmFja3Rlc3RNZXRyaWNzIHtcbiAgICBpZiAodHJhZGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RW1wdHlNZXRyaWNzKGNvbmZpZyk7XG4gICAgfVxuXG4gICAgY29uc3QgZHVyYXRpb24gPSBjb25maWcuZW5kRGF0ZSAtIGNvbmZpZy5zdGFydERhdGU7XG4gICAgY29uc3QgZHVyYXRpb25ZZWFycyA9IGR1cmF0aW9uIC8gKDM2NS4yNSAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuXG4gICAgLy8gQmFzaWMgdHJhZGUgc3RhdGlzdGljc1xuICAgIGNvbnN0IHdpbm5pbmdUcmFkZXMgPSB0cmFkZXMuZmlsdGVyKHQgPT4gdC5wbmwgPiAwKTtcbiAgICBjb25zdCBsb3NpbmdUcmFkZXMgPSB0cmFkZXMuZmlsdGVyKHQgPT4gdC5wbmwgPCAwKTtcbiAgICBjb25zdCB0b3RhbFBubCA9IHRyYWRlcy5yZWR1Y2UoKHN1bSwgdCkgPT4gc3VtICsgdC5wbmwsIDApO1xuICAgIGNvbnN0IHRvdGFsRmVlcyA9IHRyYWRlcy5yZWR1Y2UoKHN1bSwgdCkgPT4gc3VtICsgdC5mZWVzLCAwKTtcbiAgICBjb25zdCB0b3RhbFNsaXBwYWdlID0gdHJhZGVzLnJlZHVjZSgoc3VtLCB0KSA9PiBzdW0gKyB0LnNsaXBwYWdlLCAwKTtcblxuICAgIC8vIENhbGN1bGF0ZSBlcXVpdHkgY3VydmUgZm9yIGRyYXdkb3duIGFuYWx5c2lzXG4gICAgbGV0IHJ1bm5pbmdFcXVpdHkgPSBjb25maWcuaW5pdGlhbEVxdWl0eTtcbiAgICBsZXQgbWF4RXF1aXR5ID0gY29uZmlnLmluaXRpYWxFcXVpdHk7XG4gICAgbGV0IG1heERyYXdkb3duID0gMDtcbiAgICBsZXQgY3VycmVudERyYXdkb3duU3RhcnQgPSAwO1xuICAgIGxldCBtYXhEcmF3ZG93bkR1cmF0aW9uID0gMDtcblxuICAgIGZvciAoY29uc3QgdHJhZGUgb2YgdHJhZGVzKSB7XG4gICAgICBydW5uaW5nRXF1aXR5ICs9IHRyYWRlLnBubDtcbiAgICAgIFxuICAgICAgaWYgKHJ1bm5pbmdFcXVpdHkgPiBtYXhFcXVpdHkpIHtcbiAgICAgICAgbWF4RXF1aXR5ID0gcnVubmluZ0VxdWl0eTtcbiAgICAgICAgY3VycmVudERyYXdkb3duU3RhcnQgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZHJhd2Rvd24gPSAobWF4RXF1aXR5IC0gcnVubmluZ0VxdWl0eSkgLyBtYXhFcXVpdHk7XG4gICAgICAgIGlmIChkcmF3ZG93biA+IG1heERyYXdkb3duKSB7XG4gICAgICAgICAgbWF4RHJhd2Rvd24gPSBkcmF3ZG93bjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGN1cnJlbnREcmF3ZG93blN0YXJ0ID09PSAwKSB7XG4gICAgICAgICAgY3VycmVudERyYXdkb3duU3RhcnQgPSB0cmFkZS5leGl0VGltZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBkcmF3ZG93bkR1cmF0aW9uID0gdHJhZGUuZXhpdFRpbWUgLSBjdXJyZW50RHJhd2Rvd25TdGFydDtcbiAgICAgICAgICBpZiAoZHJhd2Rvd25EdXJhdGlvbiA+IG1heERyYXdkb3duRHVyYXRpb24pIHtcbiAgICAgICAgICAgIG1heERyYXdkb3duRHVyYXRpb24gPSBkcmF3ZG93bkR1cmF0aW9uO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGZpbmFsRXF1aXR5ID0gY29uZmlnLmluaXRpYWxFcXVpdHkgKyB0b3RhbFBubDtcbiAgICBjb25zdCB0b3RhbFJldHVybiA9IChmaW5hbEVxdWl0eSAtIGNvbmZpZy5pbml0aWFsRXF1aXR5KSAvIGNvbmZpZy5pbml0aWFsRXF1aXR5O1xuICAgIGNvbnN0IGFubnVhbGl6ZWRSZXR1cm4gPSBNYXRoLnBvdygxICsgdG90YWxSZXR1cm4sIDEgLyBkdXJhdGlvblllYXJzKSAtIDE7XG5cbiAgICAvLyBSaXNrIG1ldHJpY3NcbiAgICBjb25zdCByZXR1cm5zID0gdHJhZGVzLm1hcCh0ID0+IHQucG5sUGVyY2VudCk7XG4gICAgY29uc3QgYXZnUmV0dXJuID0gcmV0dXJucy5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgciwgMCkgLyByZXR1cm5zLmxlbmd0aDtcbiAgICBjb25zdCByZXR1cm5TdGREZXYgPSBNYXRoLnNxcnQoXG4gICAgICByZXR1cm5zLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyBNYXRoLnBvdyhyIC0gYXZnUmV0dXJuLCAyKSwgMCkgLyByZXR1cm5zLmxlbmd0aFxuICAgICk7XG4gICAgXG4gICAgY29uc3Qgc2hhcnBlUmF0aW8gPSByZXR1cm5TdGREZXYgPiAwID8gKGF2Z1JldHVybiAvIHJldHVyblN0ZERldikgKiBNYXRoLnNxcnQoMjUyKSA6IDA7XG4gICAgXG4gICAgY29uc3QgbmVnYXRpdmVSZXR1cm5zID0gcmV0dXJucy5maWx0ZXIociA9PiByIDwgMCk7XG4gICAgY29uc3QgZG93bnNpZGVTdGREZXYgPSBuZWdhdGl2ZVJldHVybnMubGVuZ3RoID4gMCBcbiAgICAgID8gTWF0aC5zcXJ0KG5lZ2F0aXZlUmV0dXJucy5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgTWF0aC5wb3cociwgMiksIDApIC8gbmVnYXRpdmVSZXR1cm5zLmxlbmd0aClcbiAgICAgIDogMDtcbiAgICBjb25zdCBzb3J0aW5vUmF0aW8gPSBkb3duc2lkZVN0ZERldiA+IDAgPyAoYXZnUmV0dXJuIC8gZG93bnNpZGVTdGREZXYpICogTWF0aC5zcXJ0KDI1MikgOiAwO1xuICAgIFxuICAgIGNvbnN0IGNhbG1hclJhdGlvID0gbWF4RHJhd2Rvd24gPiAwID8gYW5udWFsaXplZFJldHVybiAvIG1heERyYXdkb3duIDogMDtcblxuICAgIC8vIFRyYWRlIHN0YXRpc3RpY3NcbiAgICBjb25zdCB3aW5SYXRlID0gd2lubmluZ1RyYWRlcy5sZW5ndGggLyB0cmFkZXMubGVuZ3RoO1xuICAgIGNvbnN0IGdyb3NzUHJvZml0ID0gd2lubmluZ1RyYWRlcy5yZWR1Y2UoKHN1bSwgdCkgPT4gc3VtICsgdC5wbmwsIDApO1xuICAgIGNvbnN0IGdyb3NzTG9zcyA9IE1hdGguYWJzKGxvc2luZ1RyYWRlcy5yZWR1Y2UoKHN1bSwgdCkgPT4gc3VtICsgdC5wbmwsIDApKTtcbiAgICBjb25zdCBwcm9maXRGYWN0b3IgPSBncm9zc0xvc3MgPiAwID8gZ3Jvc3NQcm9maXQgLyBncm9zc0xvc3MgOiBncm9zc1Byb2ZpdCA+IDAgPyBJbmZpbml0eSA6IDA7XG5cbiAgICBjb25zdCBhdmVyYWdlV2luID0gd2lubmluZ1RyYWRlcy5sZW5ndGggPiAwIFxuICAgICAgPyB3aW5uaW5nVHJhZGVzLnJlZHVjZSgoc3VtLCB0KSA9PiBzdW0gKyB0LnBubCwgMCkgLyB3aW5uaW5nVHJhZGVzLmxlbmd0aCBcbiAgICAgIDogMDtcbiAgICBjb25zdCBhdmVyYWdlTG9zcyA9IGxvc2luZ1RyYWRlcy5sZW5ndGggPiAwIFxuICAgICAgPyBsb3NpbmdUcmFkZXMucmVkdWNlKChzdW0sIHQpID0+IHN1bSArIHQucG5sLCAwKSAvIGxvc2luZ1RyYWRlcy5sZW5ndGggXG4gICAgICA6IDA7XG5cbiAgICBjb25zdCBsYXJnZXN0V2luID0gd2lubmluZ1RyYWRlcy5sZW5ndGggPiAwIFxuICAgICAgPyBNYXRoLm1heCguLi53aW5uaW5nVHJhZGVzLm1hcCh0ID0+IHQucG5sKSkgXG4gICAgICA6IDA7XG4gICAgY29uc3QgbGFyZ2VzdExvc3MgPSBsb3NpbmdUcmFkZXMubGVuZ3RoID4gMCBcbiAgICAgID8gTWF0aC5taW4oLi4ubG9zaW5nVHJhZGVzLm1hcCh0ID0+IHQucG5sKSkgXG4gICAgICA6IDA7XG5cbiAgICBjb25zdCBhdmVyYWdlSG9sZFRpbWUgPSB0cmFkZXMucmVkdWNlKChzdW0sIHQpID0+IHN1bSArIHQuaG9sZFRpbWUsIDApIC8gdHJhZGVzLmxlbmd0aDtcblxuICAgIC8vIENvbnNlY3V0aXZlIHdpbnMvbG9zc2VzXG4gICAgbGV0IG1heENvbnNlY3V0aXZlV2lucyA9IDA7XG4gICAgbGV0IG1heENvbnNlY3V0aXZlTG9zc2VzID0gMDtcbiAgICBsZXQgY3VycmVudFdpblN0cmVhayA9IDA7XG4gICAgbGV0IGN1cnJlbnRMb3NzU3RyZWFrID0gMDtcblxuICAgIGZvciAoY29uc3QgdHJhZGUgb2YgdHJhZGVzKSB7XG4gICAgICBpZiAodHJhZGUucG5sID4gMCkge1xuICAgICAgICBjdXJyZW50V2luU3RyZWFrKys7XG4gICAgICAgIGN1cnJlbnRMb3NzU3RyZWFrID0gMDtcbiAgICAgICAgbWF4Q29uc2VjdXRpdmVXaW5zID0gTWF0aC5tYXgobWF4Q29uc2VjdXRpdmVXaW5zLCBjdXJyZW50V2luU3RyZWFrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRMb3NzU3RyZWFrKys7XG4gICAgICAgIGN1cnJlbnRXaW5TdHJlYWsgPSAwO1xuICAgICAgICBtYXhDb25zZWN1dGl2ZUxvc3NlcyA9IE1hdGgubWF4KG1heENvbnNlY3V0aXZlTG9zc2VzLCBjdXJyZW50TG9zc1N0cmVhayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUG9zaXRpb24gc3RhdGlzdGljc1xuICAgIGNvbnN0IHBvc2l0aW9uQ291bnRzID0gdHJhZGVzLm1hcCh0ID0+IDEpOyAvLyBTaW1wbGlmaWVkIC0gd291bGQgbmVlZCBhY3R1YWwgY29uY3VycmVudCBwb3NpdGlvbiB0cmFja2luZ1xuICAgIGNvbnN0IG1heENvbmN1cnJlbnRQb3NpdGlvbnMgPSBNYXRoLm1heCguLi5wb3NpdGlvbkNvdW50cyk7XG4gICAgY29uc3QgYXZlcmFnZVBvc2l0aW9uc09wZW4gPSBwb3NpdGlvbkNvdW50cy5yZWR1Y2UoKHN1bSwgYykgPT4gc3VtICsgYywgMCkgLyBwb3NpdGlvbkNvdW50cy5sZW5ndGg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnREYXRlOiBjb25maWcuc3RhcnREYXRlLFxuICAgICAgZW5kRGF0ZTogY29uZmlnLmVuZERhdGUsXG4gICAgICBkdXJhdGlvbixcbiAgICAgIGluaXRpYWxFcXVpdHk6IGNvbmZpZy5pbml0aWFsRXF1aXR5LFxuICAgICAgZmluYWxFcXVpdHksXG4gICAgICB0b3RhbFJldHVybixcbiAgICAgIGFubnVhbGl6ZWRSZXR1cm4sXG4gICAgICBtYXhEcmF3ZG93bixcbiAgICAgIG1heERyYXdkb3duRHVyYXRpb24sXG4gICAgICBzaGFycGVSYXRpbyxcbiAgICAgIHNvcnRpbm9SYXRpbyxcbiAgICAgIGNhbG1hclJhdGlvLFxuICAgICAgd2luUmF0ZSxcbiAgICAgIHByb2ZpdEZhY3RvcixcbiAgICAgIHRvdGFsVHJhZGVzOiB0cmFkZXMubGVuZ3RoLFxuICAgICAgYXZlcmFnZVdpbixcbiAgICAgIGF2ZXJhZ2VMb3NzLFxuICAgICAgbGFyZ2VzdFdpbixcbiAgICAgIGxhcmdlc3RMb3NzLFxuICAgICAgY29uc2VjdXRpdmVXaW5zOiBtYXhDb25zZWN1dGl2ZVdpbnMsXG4gICAgICBjb25zZWN1dGl2ZUxvc3NlczogbWF4Q29uc2VjdXRpdmVMb3NzZXMsXG4gICAgICBhdmVyYWdlSG9sZFRpbWUsXG4gICAgICB0b3RhbEZlZXMsXG4gICAgICB0b3RhbFNsaXBwYWdlLFxuICAgICAgbWF4Q29uY3VycmVudFBvc2l0aW9ucyxcbiAgICAgIGF2ZXJhZ2VQb3NpdGlvbnNPcGVuXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBlcXVpdHkgY3VydmUgY2hhcnQgZGF0YVxuICAgKiBSZXF1aXJlbWVudHM6IDE3LjVcbiAgICovXG4gIHB1YmxpYyBnZW5lcmF0ZUVxdWl0eUN1cnZlKHRyYWRlczogQmFja3Rlc3RUcmFkZVtdLCBpbml0aWFsRXF1aXR5OiBudW1iZXIpOiBFcXVpdHlQb2ludFtdIHtcbiAgICBjb25zdCBlcXVpdHlDdXJ2ZTogRXF1aXR5UG9pbnRbXSA9IFtdO1xuICAgIGxldCBydW5uaW5nRXF1aXR5ID0gaW5pdGlhbEVxdWl0eTtcbiAgICBsZXQgbWF4RXF1aXR5ID0gaW5pdGlhbEVxdWl0eTtcbiAgICBsZXQgb3BlblBvc2l0aW9ucyA9IDA7XG5cbiAgICAvLyBBZGQgc3RhcnRpbmcgcG9pbnRcbiAgICBlcXVpdHlDdXJ2ZS5wdXNoKHtcbiAgICAgIHRpbWVzdGFtcDogdHJhZGVzLmxlbmd0aCA+IDAgPyB0cmFkZXNbMF0uZW50cnlUaW1lIDogRGF0ZS5ub3coKSxcbiAgICAgIGVxdWl0eTogaW5pdGlhbEVxdWl0eSxcbiAgICAgIGRyYXdkb3duOiAwLFxuICAgICAgb3BlblBvc2l0aW9uczogMFxuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCB0cmFkZSBvZiB0cmFkZXMpIHtcbiAgICAgIC8vIEVudHJ5IHBvaW50XG4gICAgICBvcGVuUG9zaXRpb25zKys7XG4gICAgICBlcXVpdHlDdXJ2ZS5wdXNoKHtcbiAgICAgICAgdGltZXN0YW1wOiB0cmFkZS5lbnRyeVRpbWUsXG4gICAgICAgIGVxdWl0eTogcnVubmluZ0VxdWl0eSxcbiAgICAgICAgZHJhd2Rvd246IG1heEVxdWl0eSA+IDAgPyAobWF4RXF1aXR5IC0gcnVubmluZ0VxdWl0eSkgLyBtYXhFcXVpdHkgOiAwLFxuICAgICAgICBvcGVuUG9zaXRpb25zXG4gICAgICB9KTtcblxuICAgICAgLy8gRXhpdCBwb2ludFxuICAgICAgcnVubmluZ0VxdWl0eSArPSB0cmFkZS5wbmw7XG4gICAgICBvcGVuUG9zaXRpb25zLS07XG4gICAgICBcbiAgICAgIGlmIChydW5uaW5nRXF1aXR5ID4gbWF4RXF1aXR5KSB7XG4gICAgICAgIG1heEVxdWl0eSA9IHJ1bm5pbmdFcXVpdHk7XG4gICAgICB9XG5cbiAgICAgIGVxdWl0eUN1cnZlLnB1c2goe1xuICAgICAgICB0aW1lc3RhbXA6IHRyYWRlLmV4aXRUaW1lLFxuICAgICAgICBlcXVpdHk6IHJ1bm5pbmdFcXVpdHksXG4gICAgICAgIGRyYXdkb3duOiBtYXhFcXVpdHkgPiAwID8gKG1heEVxdWl0eSAtIHJ1bm5pbmdFcXVpdHkpIC8gbWF4RXF1aXR5IDogMCxcbiAgICAgICAgb3BlblBvc2l0aW9uc1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVxdWl0eUN1cnZlO1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgbG9zaW5nIHBlcmlvZHMgYW5kIGNvcnJlbGF0ZSB3aXRoIG1hcmtldCBjb25kaXRpb25zXG4gICAqIFJlcXVpcmVtZW50czogMTcuNlxuICAgKi9cbiAgcHVibGljIGFuYWx5emVMb3NpbmdQZXJpb2RzKFxuICAgIHRyYWRlczogQmFja3Rlc3RUcmFkZVtdLFxuICAgIGhpc3RvcmljYWxEYXRhOiBNYXA8c3RyaW5nLCBPSExDVltdPlxuICApOiBMb3NpbmdQZXJpb2RbXSB7XG4gICAgY29uc3QgbG9zaW5nUGVyaW9kczogTG9zaW5nUGVyaW9kW10gPSBbXTtcbiAgICBsZXQgY3VycmVudFBlcmlvZDogUGFydGlhbDxMb3NpbmdQZXJpb2Q+IHwgbnVsbCA9IG51bGw7XG4gICAgbGV0IGNvbnNlY3V0aXZlTG9zc2VzID0gMDtcblxuICAgIGZvciAoY29uc3QgdHJhZGUgb2YgdHJhZGVzKSB7XG4gICAgICBpZiAodHJhZGUucG5sIDwgMCkge1xuICAgICAgICBjb25zZWN1dGl2ZUxvc3NlcysrO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFjdXJyZW50UGVyaW9kKSB7XG4gICAgICAgICAgLy8gU3RhcnQgbmV3IGxvc2luZyBwZXJpb2RcbiAgICAgICAgICBjdXJyZW50UGVyaW9kID0ge1xuICAgICAgICAgICAgc3RhcnRUaW1lOiB0cmFkZS5lbnRyeVRpbWUsXG4gICAgICAgICAgICBjb25zZWN1dGl2ZUxvc3NlczogMSxcbiAgICAgICAgICAgIHRvdGFsTG9zczogdHJhZGUucG5sLFxuICAgICAgICAgICAgbWF4RHJhd2Rvd246IE1hdGguYWJzKHRyYWRlLnBubClcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIENvbnRpbnVlIGxvc2luZyBwZXJpb2RcbiAgICAgICAgICBjdXJyZW50UGVyaW9kLmNvbnNlY3V0aXZlTG9zc2VzID0gY29uc2VjdXRpdmVMb3NzZXM7XG4gICAgICAgICAgY3VycmVudFBlcmlvZC50b3RhbExvc3MhICs9IHRyYWRlLnBubDtcbiAgICAgICAgICBjdXJyZW50UGVyaW9kLm1heERyYXdkb3duID0gTWF0aC5tYXgoXG4gICAgICAgICAgICBjdXJyZW50UGVyaW9kLm1heERyYXdkb3duISxcbiAgICAgICAgICAgIE1hdGguYWJzKGN1cnJlbnRQZXJpb2QudG90YWxMb3NzISlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFbmQgbG9zaW5nIHBlcmlvZCBpZiBpdCBleGlzdHNcbiAgICAgICAgaWYgKGN1cnJlbnRQZXJpb2QgJiYgY29uc2VjdXRpdmVMb3NzZXMgPj0gMykge1xuICAgICAgICAgIGN1cnJlbnRQZXJpb2QuZW5kVGltZSA9IHRyYWRlLmVudHJ5VGltZTtcbiAgICAgICAgICBjdXJyZW50UGVyaW9kLmR1cmF0aW9uID0gY3VycmVudFBlcmlvZC5lbmRUaW1lIC0gY3VycmVudFBlcmlvZC5zdGFydFRpbWUhO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFuYWx5emUgbWFya2V0IGNvbmRpdGlvbnMgZHVyaW5nIHRoaXMgcGVyaW9kXG4gICAgICAgICAgY3VycmVudFBlcmlvZC5tYXJrZXRDb25kaXRpb25zID0gdGhpcy5hbmFseXplTWFya2V0Q29uZGl0aW9ucyhcbiAgICAgICAgICAgIGN1cnJlbnRQZXJpb2Quc3RhcnRUaW1lISxcbiAgICAgICAgICAgIGN1cnJlbnRQZXJpb2QuZW5kVGltZSxcbiAgICAgICAgICAgIGhpc3RvcmljYWxEYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHZW5lcmF0ZSBzdWdnZXN0ZWQgYWRqdXN0bWVudHNcbiAgICAgICAgICBjdXJyZW50UGVyaW9kLnN1Z2dlc3RlZEFkanVzdG1lbnRzID0gdGhpcy5nZW5lcmF0ZUFkanVzdG1lbnRTdWdnZXN0aW9ucyhcbiAgICAgICAgICAgIGN1cnJlbnRQZXJpb2QgYXMgTG9zaW5nUGVyaW9kXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBsb3NpbmdQZXJpb2RzLnB1c2goY3VycmVudFBlcmlvZCBhcyBMb3NpbmdQZXJpb2QpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjdXJyZW50UGVyaW9kID0gbnVsbDtcbiAgICAgICAgY29uc2VjdXRpdmVMb3NzZXMgPSAwO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEhhbmRsZSBvbmdvaW5nIGxvc2luZyBwZXJpb2QgYXQgZW5kXG4gICAgaWYgKGN1cnJlbnRQZXJpb2QgJiYgY29uc2VjdXRpdmVMb3NzZXMgPj0gMykge1xuICAgICAgY29uc3QgbGFzdFRyYWRlID0gdHJhZGVzW3RyYWRlcy5sZW5ndGggLSAxXTtcbiAgICAgIGN1cnJlbnRQZXJpb2QuZW5kVGltZSA9IGxhc3RUcmFkZS5leGl0VGltZTtcbiAgICAgIGN1cnJlbnRQZXJpb2QuZHVyYXRpb24gPSBjdXJyZW50UGVyaW9kLmVuZFRpbWUgLSBjdXJyZW50UGVyaW9kLnN0YXJ0VGltZSE7XG4gICAgICBjdXJyZW50UGVyaW9kLm1hcmtldENvbmRpdGlvbnMgPSB0aGlzLmFuYWx5emVNYXJrZXRDb25kaXRpb25zKFxuICAgICAgICBjdXJyZW50UGVyaW9kLnN0YXJ0VGltZSEsXG4gICAgICAgIGN1cnJlbnRQZXJpb2QuZW5kVGltZSxcbiAgICAgICAgaGlzdG9yaWNhbERhdGFcbiAgICAgICk7XG4gICAgICBjdXJyZW50UGVyaW9kLnN1Z2dlc3RlZEFkanVzdG1lbnRzID0gdGhpcy5nZW5lcmF0ZUFkanVzdG1lbnRTdWdnZXN0aW9ucyhcbiAgICAgICAgY3VycmVudFBlcmlvZCBhcyBMb3NpbmdQZXJpb2RcbiAgICAgICk7XG4gICAgICBsb3NpbmdQZXJpb2RzLnB1c2goY3VycmVudFBlcmlvZCBhcyBMb3NpbmdQZXJpb2QpO1xuICAgIH1cblxuICAgIHJldHVybiBsb3NpbmdQZXJpb2RzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBjb21wbGV0ZSBiYWNrdGVzdFxuICAgKi9cbiAgcHVibGljIGFzeW5jIHJ1bkJhY2t0ZXN0KGNvbmZpZzogUGFydGlhbDxCYWNrdGVzdENvbmZpZz4gPSB7fSk6IFByb21pc2U8QmFja3Rlc3RSZXN1bHRzPiB7XG4gICAgaWYgKHRoaXMuaXNSdW5uaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhY2t0ZXN0IGlzIGFscmVhZHkgcnVubmluZycpO1xuICAgIH1cblxuICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4udGhpcy5jb25maWcsIC4uLmNvbmZpZyB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5qAIFN0YXJ0aW5nIGJhY2t0ZXN0Li4uJyk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+ThSBQZXJpb2Q6ICR7bmV3IERhdGUodGhpcy5jb25maWcuc3RhcnREYXRlKS50b0lTT1N0cmluZygpfSB0byAke25ldyBEYXRlKHRoaXMuY29uZmlnLmVuZERhdGUpLnRvSVNPU3RyaW5nKCl9YCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+SsCBJbml0aWFsIEVxdWl0eTogJCR7dGhpcy5jb25maWcuaW5pdGlhbEVxdWl0eS50b0xvY2FsZVN0cmluZygpfWApO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogU3ltYm9sczogJHt0aGlzLmNvbmZpZy5zeW1ib2xzLmpvaW4oJywgJyl9YCk7XG5cbiAgICAgIC8vIEZldGNoIGhpc3RvcmljYWwgZGF0YVxuICAgICAgY29uc3QgaGlzdG9yaWNhbERhdGEgPSBhd2FpdCB0aGlzLmZldGNoSGlzdG9yaWNhbERhdGEoXG4gICAgICAgIHRoaXMuY29uZmlnLnN5bWJvbHMsXG4gICAgICAgIHRoaXMuY29uZmlnLnRpbWVmcmFtZSxcbiAgICAgICAgdGhpcy5jb25maWcuc3RhcnREYXRlLFxuICAgICAgICB0aGlzLmNvbmZpZy5lbmREYXRlXG4gICAgICApO1xuXG4gICAgICAvLyBTaW11bGF0ZSB0cmFkaW5nXG4gICAgICBjb25zdCB0cmFkZXMgPSBhd2FpdCB0aGlzLnNpbXVsYXRlVHJhZGluZyhoaXN0b3JpY2FsRGF0YSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSByZXN1bHRzXG4gICAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5jYWxjQmFja3Rlc3RSZXN1bHRzKHRyYWRlcywgdGhpcy5jb25maWcpO1xuICAgICAgY29uc3QgZXF1aXR5Q3VydmUgPSB0aGlzLmdlbmVyYXRlRXF1aXR5Q3VydmUodHJhZGVzLCB0aGlzLmNvbmZpZy5pbml0aWFsRXF1aXR5KTtcbiAgICAgIGNvbnN0IGRyYXdkb3duQ3VydmUgPSB0aGlzLmdlbmVyYXRlRHJhd2Rvd25DdXJ2ZShlcXVpdHlDdXJ2ZSk7XG4gICAgICBjb25zdCBsb3NpbmdQZXJpb2RzID0gdGhpcy5hbmFseXplTG9zaW5nUGVyaW9kcyh0cmFkZXMsIGhpc3RvcmljYWxEYXRhKTtcbiAgICAgIGNvbnN0IG1hcmtldENvbmRpdGlvbkFuYWx5c2lzID0gdGhpcy5hbmFseXplTWFya2V0Q29uZGl0aW9uUGVyZm9ybWFuY2UodHJhZGVzLCBoaXN0b3JpY2FsRGF0YSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHM6IEJhY2t0ZXN0UmVzdWx0cyA9IHtcbiAgICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZyxcbiAgICAgICAgdHJhZGVzLFxuICAgICAgICBtZXRyaWNzLFxuICAgICAgICBlcXVpdHlDdXJ2ZSxcbiAgICAgICAgZHJhd2Rvd25DdXJ2ZSxcbiAgICAgICAgbG9zaW5nUGVyaW9kcyxcbiAgICAgICAgbWFya2V0Q29uZGl0aW9uQW5hbHlzaXNcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgQmFja3Rlc3QgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ggVG90YWwgUmV0dXJuOiAkeyhtZXRyaWNzLnRvdGFsUmV0dXJuICogMTAwKS50b0ZpeGVkKDIpfSVgKTtcbiAgICAgIGNvbnNvbGUubG9nKGDwn46vIFdpbiBSYXRlOiAkeyhtZXRyaWNzLndpblJhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWApO1xuICAgICAgY29uc29sZS5sb2coYPCfkrkgUHJvZml0IEZhY3RvcjogJHttZXRyaWNzLnByb2ZpdEZhY3Rvci50b0ZpeGVkKDIpfWApO1xuICAgICAgY29uc29sZS5sb2coYPCfk4kgTWF4IERyYXdkb3duOiAkeyhtZXRyaWNzLm1heERyYXdkb3duICogMTAwKS50b0ZpeGVkKDIpfSVgKTtcblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEJhY2t0ZXN0IGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGUgdHJhZGluZyBvdmVyIGhpc3RvcmljYWwgZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzaW11bGF0ZVRyYWRpbmcoaGlzdG9yaWNhbERhdGE6IE1hcDxzdHJpbmcsIE9ITENWW10+KTogUHJvbWlzZTxCYWNrdGVzdFRyYWRlW10+IHtcbiAgICBjb25zdCB0cmFkZXM6IEJhY2t0ZXN0VHJhZGVbXSA9IFtdO1xuICAgIGNvbnN0IG9wZW5Qb3NpdGlvbnMgPSBuZXcgTWFwPHN0cmluZywgQmFja3Rlc3RUcmFkZT4oKTtcbiAgICBsZXQgY3VycmVudEVxdWl0eSA9IHRoaXMuY29uZmlnLmluaXRpYWxFcXVpdHk7XG5cbiAgICAvLyBHZXQgYWxsIHRpbWVzdGFtcHMgYWNyb3NzIGFsbCBzeW1ib2xzXG4gICAgY29uc3QgYWxsVGltZXN0YW1wcyA9IG5ldyBTZXQ8bnVtYmVyPigpO1xuICAgIGZvciAoY29uc3QgY2FuZGxlcyBvZiBBcnJheS5mcm9tKGhpc3RvcmljYWxEYXRhLnZhbHVlcygpKSkge1xuICAgICAgY2FuZGxlcy5mb3JFYWNoKGNhbmRsZSA9PiBhbGxUaW1lc3RhbXBzLmFkZChjYW5kbGUudGltZXN0YW1wKSk7XG4gICAgfVxuICAgIGNvbnN0IHNvcnRlZFRpbWVzdGFtcHMgPSBBcnJheS5mcm9tKGFsbFRpbWVzdGFtcHMpLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5SEIFNpbXVsYXRpbmcgdHJhZGluZyBhY3Jvc3MgJHtzb3J0ZWRUaW1lc3RhbXBzLmxlbmd0aH0gdGltZSBwZXJpb2RzLi4uYCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZFRpbWVzdGFtcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IHNvcnRlZFRpbWVzdGFtcHNbaV07XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGZvciBleGl0cyBmaXJzdFxuICAgICAgZm9yIChjb25zdCBbc3ltYm9sLCBwb3NpdGlvbl0gb2YgQXJyYXkuZnJvbShvcGVuUG9zaXRpb25zLmVudHJpZXMoKSkpIHtcbiAgICAgICAgY29uc3QgY2FuZGxlcyA9IGhpc3RvcmljYWxEYXRhLmdldChzeW1ib2wpO1xuICAgICAgICBpZiAoIWNhbmRsZXMpIGNvbnRpbnVlO1xuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDYW5kbGUgPSBjYW5kbGVzLmZpbmQoYyA9PiBjLnRpbWVzdGFtcCA9PT0gdGltZXN0YW1wKTtcbiAgICAgICAgaWYgKCFjdXJyZW50Q2FuZGxlKSBjb250aW51ZTtcblxuICAgICAgICBjb25zdCBleGl0UmVzdWx0ID0gdGhpcy5jaGVja0V4aXQocG9zaXRpb24sIGN1cnJlbnRDYW5kbGUpO1xuICAgICAgICBpZiAoZXhpdFJlc3VsdC5zaG91bGRFeGl0KSB7XG4gICAgICAgICAgLy8gQ2xvc2UgcG9zaXRpb25cbiAgICAgICAgICBwb3NpdGlvbi5leGl0VGltZSA9IHRpbWVzdGFtcDtcbiAgICAgICAgICBwb3NpdGlvbi5leGl0UHJpY2UgPSBleGl0UmVzdWx0LmV4aXRQcmljZTtcbiAgICAgICAgICBwb3NpdGlvbi5leGl0UmVhc29uID0gZXhpdFJlc3VsdC5yZWFzb247XG4gICAgICAgICAgcG9zaXRpb24uaG9sZFRpbWUgPSBwb3NpdGlvbi5leGl0VGltZSAtIHBvc2l0aW9uLmVudHJ5VGltZTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDYWxjdWxhdGUgUG5MXG4gICAgICAgICAgY29uc3QgcG5sTXVsdGlwbGllciA9IHBvc2l0aW9uLmRpcmVjdGlvbiA9PT0gJ0xPTkcnIFxuICAgICAgICAgICAgPyAocG9zaXRpb24uZXhpdFByaWNlIC0gcG9zaXRpb24uZW50cnlQcmljZSkgLyBwb3NpdGlvbi5lbnRyeVByaWNlXG4gICAgICAgICAgICA6IChwb3NpdGlvbi5lbnRyeVByaWNlIC0gcG9zaXRpb24uZXhpdFByaWNlKSAvIHBvc2l0aW9uLmVudHJ5UHJpY2U7XG4gICAgICAgICAgXG4gICAgICAgICAgcG9zaXRpb24ucG5sID0gcG9zaXRpb24ucXVhbnRpdHkgKiBwb3NpdGlvbi5lbnRyeVByaWNlICogcG5sTXVsdGlwbGllciAqIHBvc2l0aW9uLmxldmVyYWdlO1xuICAgICAgICAgIHBvc2l0aW9uLnBubFBlcmNlbnQgPSBwbmxNdWx0aXBsaWVyICogcG9zaXRpb24ubGV2ZXJhZ2U7XG4gICAgICAgICAgcG9zaXRpb24uclZhbHVlID0gcG9zaXRpb24ucG5sIC8gKE1hdGguYWJzKHBvc2l0aW9uLmVudHJ5UHJpY2UgLSBwb3NpdGlvbi5zaWduYWwuc3RvcExvc3MpICogcG9zaXRpb24ucXVhbnRpdHkpO1xuXG4gICAgICAgICAgLy8gQXBwbHkgZmVlcyBhbmQgc2xpcHBhZ2VcbiAgICAgICAgICBjb25zdCBub3Rpb25hbFZhbHVlID0gcG9zaXRpb24ucXVhbnRpdHkgKiBwb3NpdGlvbi5leGl0UHJpY2U7XG4gICAgICAgICAgcG9zaXRpb24uZmVlcyArPSB0aGlzLmFwcGx5RmVlcyhub3Rpb25hbFZhbHVlLCAnSU9DJyk7IC8vIEFzc3VtZSBJT0MgZm9yIGV4aXRzXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3Qgc2xpcHBhZ2VSZXN1bHQgPSB0aGlzLnNpbXVsYXRlVHJhZGUocG9zaXRpb24uc2lnbmFsLCAnSU9DJywgcG9zaXRpb24uZXhpdFByaWNlKTtcbiAgICAgICAgICBwb3NpdGlvbi5zbGlwcGFnZSArPSBzbGlwcGFnZVJlc3VsdC5zbGlwcGFnZTtcblxuICAgICAgICAgIGN1cnJlbnRFcXVpdHkgKz0gcG9zaXRpb24ucG5sIC0gcG9zaXRpb24uZmVlcyAtIHBvc2l0aW9uLnNsaXBwYWdlO1xuICAgICAgICAgIHRyYWRlcy5wdXNoKHBvc2l0aW9uKTtcbiAgICAgICAgICBvcGVuUG9zaXRpb25zLmRlbGV0ZShzeW1ib2wpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciBuZXcgZW50cmllc1xuICAgICAgaWYgKG9wZW5Qb3NpdGlvbnMuc2l6ZSA8IHRoaXMuY29uZmlnLm1heENvbmN1cnJlbnRQb3NpdGlvbnMpIHtcbiAgICAgICAgZm9yIChjb25zdCBzeW1ib2wgb2YgdGhpcy5jb25maWcuc3ltYm9scykge1xuICAgICAgICAgIGlmIChvcGVuUG9zaXRpb25zLmhhcyhzeW1ib2wpKSBjb250aW51ZTtcblxuICAgICAgICAgIGNvbnN0IGNhbmRsZXMgPSBoaXN0b3JpY2FsRGF0YS5nZXQoc3ltYm9sKTtcbiAgICAgICAgICBpZiAoIWNhbmRsZXMpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgY29uc3QgY3VycmVudENhbmRsZSA9IGNhbmRsZXMuZmluZChjID0+IGMudGltZXN0YW1wID09PSB0aW1lc3RhbXApO1xuICAgICAgICAgIGlmICghY3VycmVudENhbmRsZSkgY29udGludWU7XG5cbiAgICAgICAgICAvLyBHZW5lcmF0ZSBzaWduYWwgKHNpbXBsaWZpZWQgLSB3b3VsZCBuZWVkIGZ1bGwgbWFya2V0IHN0cnVjdHVyZSBhbmFseXNpcylcbiAgICAgICAgICBjb25zdCBzaWduYWwgPSBhd2FpdCB0aGlzLmdlbmVyYXRlQmFja3Rlc3RTaWduYWwoc3ltYm9sLCBjYW5kbGVzLCBpLCBjdXJyZW50RXF1aXR5KTtcbiAgICAgICAgICBpZiAoIXNpZ25hbCkgY29udGludWU7XG5cbiAgICAgICAgICAvLyBTaW11bGF0ZSBvcmRlciBleGVjdXRpb25cbiAgICAgICAgICBjb25zdCBvcmRlclR5cGUgPSAnUE9TVF9PTkxZJzsgLy8gSHVudGVyIHVzZXMgUG9zdC1Pbmx5IG9yZGVyc1xuICAgICAgICAgIGNvbnN0IGV4ZWN1dGlvblJlc3VsdCA9IHRoaXMuc2ltdWxhdGVUcmFkZShzaWduYWwsIG9yZGVyVHlwZSwgY3VycmVudENhbmRsZS5jbG9zZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGV4ZWN1dGlvblJlc3VsdC5maWxsZWQpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBuZXcgcG9zaXRpb25cbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uOiBCYWNrdGVzdFRyYWRlID0ge1xuICAgICAgICAgICAgICBpZDogYCR7c3ltYm9sfV8ke3RpbWVzdGFtcH1gLFxuICAgICAgICAgICAgICBzeW1ib2wsXG4gICAgICAgICAgICAgIGRpcmVjdGlvbjogc2lnbmFsLmRpcmVjdGlvbixcbiAgICAgICAgICAgICAgZW50cnlUaW1lOiB0aW1lc3RhbXAsXG4gICAgICAgICAgICAgIGV4aXRUaW1lOiAwLFxuICAgICAgICAgICAgICBlbnRyeVByaWNlOiBleGVjdXRpb25SZXN1bHQuZmlsbFByaWNlLFxuICAgICAgICAgICAgICBleGl0UHJpY2U6IDAsXG4gICAgICAgICAgICAgIHF1YW50aXR5OiBzaWduYWwucG9zaXRpb25TaXplLFxuICAgICAgICAgICAgICBsZXZlcmFnZTogc2lnbmFsLmxldmVyYWdlLFxuICAgICAgICAgICAgICBwbmw6IDAsXG4gICAgICAgICAgICAgIHBubFBlcmNlbnQ6IDAsXG4gICAgICAgICAgICAgIGZlZXM6IHRoaXMuYXBwbHlGZWVzKHNpZ25hbC5wb3NpdGlvblNpemUgKiBleGVjdXRpb25SZXN1bHQuZmlsbFByaWNlLCBvcmRlclR5cGUpLFxuICAgICAgICAgICAgICBzbGlwcGFnZTogZXhlY3V0aW9uUmVzdWx0LnNsaXBwYWdlLFxuICAgICAgICAgICAgICBob2xkVGltZTogMCxcbiAgICAgICAgICAgICAgZXhpdFJlYXNvbjogJ01BTlVBTCcsXG4gICAgICAgICAgICAgIHNpZ25hbCxcbiAgICAgICAgICAgICAgclZhbHVlOiAwXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcGVuUG9zaXRpb25zLnNldChzeW1ib2wsIHBvc2l0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUHJvZ3Jlc3MgbG9nZ2luZ1xuICAgICAgaWYgKGkgJSAxMDAwID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHByb2dyZXNzID0gKGkgLyBzb3J0ZWRUaW1lc3RhbXBzLmxlbmd0aCAqIDEwMCkudG9GaXhlZCgxKTtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4ogUHJvZ3Jlc3M6ICR7cHJvZ3Jlc3N9JSAtIE9wZW4gcG9zaXRpb25zOiAke29wZW5Qb3NpdGlvbnMuc2l6ZX0gLSBDb21wbGV0ZWQgdHJhZGVzOiAke3RyYWRlcy5sZW5ndGh9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xvc2UgYW55IHJlbWFpbmluZyBvcGVuIHBvc2l0aW9uc1xuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgQXJyYXkuZnJvbShvcGVuUG9zaXRpb25zLnZhbHVlcygpKSkge1xuICAgICAgY29uc3QgbGFzdENhbmRsZSA9IGhpc3RvcmljYWxEYXRhLmdldChwb3NpdGlvbi5zeW1ib2wpPy5zbGljZSgtMSlbMF07XG4gICAgICBpZiAobGFzdENhbmRsZSkge1xuICAgICAgICBwb3NpdGlvbi5leGl0VGltZSA9IGxhc3RDYW5kbGUudGltZXN0YW1wO1xuICAgICAgICBwb3NpdGlvbi5leGl0UHJpY2UgPSBsYXN0Q2FuZGxlLmNsb3NlO1xuICAgICAgICBwb3NpdGlvbi5leGl0UmVhc29uID0gJ01BTlVBTCc7XG4gICAgICAgIHBvc2l0aW9uLmhvbGRUaW1lID0gcG9zaXRpb24uZXhpdFRpbWUgLSBwb3NpdGlvbi5lbnRyeVRpbWU7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwbmxNdWx0aXBsaWVyID0gcG9zaXRpb24uZGlyZWN0aW9uID09PSAnTE9ORycgXG4gICAgICAgICAgPyAocG9zaXRpb24uZXhpdFByaWNlIC0gcG9zaXRpb24uZW50cnlQcmljZSkgLyBwb3NpdGlvbi5lbnRyeVByaWNlXG4gICAgICAgICAgOiAocG9zaXRpb24uZW50cnlQcmljZSAtIHBvc2l0aW9uLmV4aXRQcmljZSkgLyBwb3NpdGlvbi5lbnRyeVByaWNlO1xuICAgICAgICBcbiAgICAgICAgcG9zaXRpb24ucG5sID0gcG9zaXRpb24ucXVhbnRpdHkgKiBwb3NpdGlvbi5lbnRyeVByaWNlICogcG5sTXVsdGlwbGllciAqIHBvc2l0aW9uLmxldmVyYWdlO1xuICAgICAgICBwb3NpdGlvbi5wbmxQZXJjZW50ID0gcG5sTXVsdGlwbGllciAqIHBvc2l0aW9uLmxldmVyYWdlO1xuICAgICAgICBwb3NpdGlvbi5yVmFsdWUgPSBwb3NpdGlvbi5wbmwgLyAoTWF0aC5hYnMocG9zaXRpb24uZW50cnlQcmljZSAtIHBvc2l0aW9uLnNpZ25hbC5zdG9wTG9zcykgKiBwb3NpdGlvbi5xdWFudGl0eSk7XG5cbiAgICAgICAgdHJhZGVzLnB1c2gocG9zaXRpb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cmFkZXM7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgc2ltcGxpZmllZCBiYWNrdGVzdCBzaWduYWxcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVCYWNrdGVzdFNpZ25hbChcbiAgICBzeW1ib2w6IHN0cmluZyxcbiAgICBjYW5kbGVzOiBPSExDVltdLFxuICAgIGN1cnJlbnRJbmRleDogbnVtYmVyLFxuICAgIGN1cnJlbnRFcXVpdHk6IG51bWJlclxuICApOiBQcm9taXNlPFNpZ25hbERhdGEgfCBudWxsPiB7XG4gICAgLy8gU2ltcGxpZmllZCBzaWduYWwgZ2VuZXJhdGlvbiBmb3IgYmFja3Rlc3RpbmdcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdXNlIHRoZSBmdWxsIEhvbG9ncmFtRW5naW5lXG4gICAgXG4gICAgaWYgKGN1cnJlbnRJbmRleCA8IDUwKSByZXR1cm4gbnVsbDsgLy8gTmVlZCBlbm91Z2ggaGlzdG9yeVxuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRDYW5kbGUgPSBjYW5kbGVzW2N1cnJlbnRJbmRleF07XG4gICAgY29uc3QgcmVjZW50Q2FuZGxlcyA9IGNhbmRsZXMuc2xpY2UoTWF0aC5tYXgoMCwgY3VycmVudEluZGV4IC0gNTApLCBjdXJyZW50SW5kZXggKyAxKTtcbiAgICBcbiAgICAvLyBTaW1wbGUgdHJlbmQgZGV0ZWN0aW9uXG4gICAgY29uc3Qgc21hMjAgPSB0aGlzLmNhbGN1bGF0ZVNNQShyZWNlbnRDYW5kbGVzLnNsaWNlKC0yMCksICdjbG9zZScpO1xuICAgIGNvbnN0IHNtYTUwID0gdGhpcy5jYWxjdWxhdGVTTUEocmVjZW50Q2FuZGxlcy5zbGljZSgtNTApLCAnY2xvc2UnKTtcbiAgICBcbiAgICBpZiAoc21hMjAgPD0gc21hNTApIHJldHVybiBudWxsOyAvLyBPbmx5IGxvbmcgc2lnbmFscyBpbiB1cHRyZW5kXG4gICAgXG4gICAgLy8gUmFuZG9tIHNpZ25hbCBnZW5lcmF0aW9uIGZvciBkZW1vIChyZXBsYWNlIHdpdGggcmVhbCBsb2dpYylcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDUpIHsgLy8gNSUgY2hhbmNlIG9mIHNpZ25hbFxuICAgICAgY29uc3QgZGlyZWN0aW9uID0gJ0xPTkcnO1xuICAgICAgY29uc3QgZW50cnlQcmljZSA9IGN1cnJlbnRDYW5kbGUuY2xvc2U7XG4gICAgICBjb25zdCBzdG9wTG9zcyA9IGVudHJ5UHJpY2UgKiAwLjk4NTsgLy8gMS41JSBzdG9wXG4gICAgICBjb25zdCB0YWtlUHJvZml0ID0gZW50cnlQcmljZSAqIDEuMDQ1OyAvLyA0LjUlIHRhcmdldFxuICAgICAgY29uc3QgcG9zaXRpb25TaXplID0gKGN1cnJlbnRFcXVpdHkgKiB0aGlzLmNvbmZpZy5yaXNrUGVyVHJhZGUpIC8gKGVudHJ5UHJpY2UgLSBzdG9wTG9zcyk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN5bWJvbCxcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICBob2xvZ3JhbVN0YXR1czogJ0InLFxuICAgICAgICBhbGlnbm1lbnRTY29yZTogNzAsXG4gICAgICAgIHJzU2NvcmU6IDAuMDIsXG4gICAgICAgIHNlc3Npb25UeXBlOiAnTE9ORE9OJyxcbiAgICAgICAgcG9pVHlwZTogJ09SREVSX0JMT0NLJyxcbiAgICAgICAgY3ZkQ29uZmlybWF0aW9uOiB0cnVlLFxuICAgICAgICBjb25maWRlbmNlOiA3NSxcbiAgICAgICAgZW50cnlQcmljZSxcbiAgICAgICAgc3RvcExvc3MsXG4gICAgICAgIHRha2VQcm9maXQsXG4gICAgICAgIHBvc2l0aW9uU2l6ZSxcbiAgICAgICAgbGV2ZXJhZ2U6IHRoaXMuY29uZmlnLm1heExldmVyYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IGN1cnJlbnRDYW5kbGUudGltZXN0YW1wXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBwb3NpdGlvbiBzaG91bGQgYmUgZXhpdGVkXG4gICAqL1xuICBwcml2YXRlIGNoZWNrRXhpdChcbiAgICBwb3NpdGlvbjogQmFja3Rlc3RUcmFkZSxcbiAgICBjdXJyZW50Q2FuZGxlOiBPSExDVlxuICApOiB7IHNob3VsZEV4aXQ6IGJvb2xlYW47IGV4aXRQcmljZTogbnVtYmVyOyByZWFzb246ICdTVE9QX0xPU1MnIHwgJ1RBS0VfUFJPRklUJyB8ICdUSU1FT1VUJyB8ICdNQU5VQUwnIH0ge1xuICAgIGNvbnN0IHNpZ25hbCA9IHBvc2l0aW9uLnNpZ25hbDtcbiAgICBcbiAgICAvLyBDaGVjayBzdG9wIGxvc3NcbiAgICBpZiAocG9zaXRpb24uZGlyZWN0aW9uID09PSAnTE9ORycgJiYgY3VycmVudENhbmRsZS5sb3cgPD0gc2lnbmFsLnN0b3BMb3NzKSB7XG4gICAgICByZXR1cm4geyBzaG91bGRFeGl0OiB0cnVlLCBleGl0UHJpY2U6IHNpZ25hbC5zdG9wTG9zcywgcmVhc29uOiAnU1RPUF9MT1NTJyB9O1xuICAgIH1cbiAgICBpZiAocG9zaXRpb24uZGlyZWN0aW9uID09PSAnU0hPUlQnICYmIGN1cnJlbnRDYW5kbGUuaGlnaCA+PSBzaWduYWwuc3RvcExvc3MpIHtcbiAgICAgIHJldHVybiB7IHNob3VsZEV4aXQ6IHRydWUsIGV4aXRQcmljZTogc2lnbmFsLnN0b3BMb3NzLCByZWFzb246ICdTVE9QX0xPU1MnIH07XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIHRha2UgcHJvZml0XG4gICAgaWYgKHBvc2l0aW9uLmRpcmVjdGlvbiA9PT0gJ0xPTkcnICYmIGN1cnJlbnRDYW5kbGUuaGlnaCA+PSBzaWduYWwudGFrZVByb2ZpdCkge1xuICAgICAgcmV0dXJuIHsgc2hvdWxkRXhpdDogdHJ1ZSwgZXhpdFByaWNlOiBzaWduYWwudGFrZVByb2ZpdCwgcmVhc29uOiAnVEFLRV9QUk9GSVQnIH07XG4gICAgfVxuICAgIGlmIChwb3NpdGlvbi5kaXJlY3Rpb24gPT09ICdTSE9SVCcgJiYgY3VycmVudENhbmRsZS5sb3cgPD0gc2lnbmFsLnRha2VQcm9maXQpIHtcbiAgICAgIHJldHVybiB7IHNob3VsZEV4aXQ6IHRydWUsIGV4aXRQcmljZTogc2lnbmFsLnRha2VQcm9maXQsIHJlYXNvbjogJ1RBS0VfUFJPRklUJyB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayB0aW1lb3V0ICg3MiBob3VycyBtYXggaG9sZClcbiAgICBjb25zdCBtYXhIb2xkVGltZSA9IDcyICogNjAgKiA2MCAqIDEwMDA7IC8vIDcyIGhvdXJzXG4gICAgaWYgKGN1cnJlbnRDYW5kbGUudGltZXN0YW1wIC0gcG9zaXRpb24uZW50cnlUaW1lID4gbWF4SG9sZFRpbWUpIHtcbiAgICAgIHJldHVybiB7IHNob3VsZEV4aXQ6IHRydWUsIGV4aXRQcmljZTogY3VycmVudENhbmRsZS5jbG9zZSwgcmVhc29uOiAnVElNRU9VVCcgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgc2hvdWxkRXhpdDogZmFsc2UsIGV4aXRQcmljZTogMCwgcmVhc29uOiAnTUFOVUFMJyB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2RzXG4gICAqL1xuICBwcml2YXRlIGdldFRpbWVmcmFtZU1zKHRpbWVmcmFtZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCB0aW1lZnJhbWVNYXA6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gPSB7XG4gICAgICAnMW0nOiA2MCAqIDEwMDAsXG4gICAgICAnNW0nOiA1ICogNjAgKiAxMDAwLFxuICAgICAgJzE1bSc6IDE1ICogNjAgKiAxMDAwLFxuICAgICAgJzMwbSc6IDMwICogNjAgKiAxMDAwLFxuICAgICAgJzFoJzogNjAgKiA2MCAqIDEwMDAsXG4gICAgICAnNGgnOiA0ICogNjAgKiA2MCAqIDEwMDAsXG4gICAgICAnMWQnOiAyNCAqIDYwICogNjAgKiAxMDAwXG4gICAgfTtcbiAgICByZXR1cm4gdGltZWZyYW1lTWFwW3RpbWVmcmFtZV0gfHwgMTUgKiA2MCAqIDEwMDA7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVNNQShjYW5kbGVzOiBPSExDVltdLCBmaWVsZDoga2V5b2YgT0hMQ1YpOiBudW1iZXIge1xuICAgIGNvbnN0IHN1bSA9IGNhbmRsZXMucmVkdWNlKChhY2MsIGNhbmRsZSkgPT4gYWNjICsgKGNhbmRsZVtmaWVsZF0gYXMgbnVtYmVyKSwgMCk7XG4gICAgcmV0dXJuIHN1bSAvIGNhbmRsZXMubGVuZ3RoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZURyYXdkb3duQ3VydmUoZXF1aXR5Q3VydmU6IEVxdWl0eVBvaW50W10pOiBEcmF3ZG93blBvaW50W10ge1xuICAgIGNvbnN0IGRyYXdkb3duQ3VydmU6IERyYXdkb3duUG9pbnRbXSA9IFtdO1xuICAgIGxldCBtYXhFcXVpdHkgPSAwO1xuICAgIGxldCBkcmF3ZG93blN0YXJ0ID0gMDtcblxuICAgIGZvciAoY29uc3QgcG9pbnQgb2YgZXF1aXR5Q3VydmUpIHtcbiAgICAgIGlmIChwb2ludC5lcXVpdHkgPiBtYXhFcXVpdHkpIHtcbiAgICAgICAgbWF4RXF1aXR5ID0gcG9pbnQuZXF1aXR5O1xuICAgICAgICBkcmF3ZG93blN0YXJ0ID0gMDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZHJhd2Rvd24gPSBtYXhFcXVpdHkgPiAwID8gKG1heEVxdWl0eSAtIHBvaW50LmVxdWl0eSkgLyBtYXhFcXVpdHkgOiAwO1xuICAgICAgXG4gICAgICBpZiAoZHJhd2Rvd24gPiAwICYmIGRyYXdkb3duU3RhcnQgPT09IDApIHtcbiAgICAgICAgZHJhd2Rvd25TdGFydCA9IHBvaW50LnRpbWVzdGFtcDtcbiAgICAgIH1cblxuICAgICAgZHJhd2Rvd25DdXJ2ZS5wdXNoKHtcbiAgICAgICAgdGltZXN0YW1wOiBwb2ludC50aW1lc3RhbXAsXG4gICAgICAgIGRyYXdkb3duLFxuICAgICAgICBkdXJhdGlvbjogZHJhd2Rvd25TdGFydCA+IDAgPyBwb2ludC50aW1lc3RhbXAgLSBkcmF3ZG93blN0YXJ0IDogMCxcbiAgICAgICAgcGVhazogbWF4RXF1aXR5LFxuICAgICAgICB0cm91Z2g6IHBvaW50LmVxdWl0eVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRyYXdkb3duQ3VydmU7XG4gIH1cblxuICBwcml2YXRlIGFuYWx5emVNYXJrZXRDb25kaXRpb25zKFxuICAgIHN0YXJ0VGltZTogbnVtYmVyLFxuICAgIGVuZFRpbWU6IG51bWJlcixcbiAgICBoaXN0b3JpY2FsRGF0YTogTWFwPHN0cmluZywgT0hMQ1ZbXT5cbiAgKTogTG9zaW5nUGVyaW9kWydtYXJrZXRDb25kaXRpb25zJ10ge1xuICAgIC8vIFNpbXBsaWZpZWQgbWFya2V0IGNvbmRpdGlvbiBhbmFseXNpc1xuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBiZSBtb3JlIHNvcGhpc3RpY2F0ZWRcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdm9sYXRpbGl0eTogMC4wMiwgLy8gUGxhY2Vob2xkZXJcbiAgICAgIHRyZW5kOiAnUkFOR0UnLFxuICAgICAgc2Vzc2lvbjogJ0xPTkRPTicsXG4gICAgICBidGNDb3JyZWxhdGlvbjogMC44XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVBZGp1c3RtZW50U3VnZ2VzdGlvbnMocGVyaW9kOiBMb3NpbmdQZXJpb2QpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgaWYgKHBlcmlvZC5tYXJrZXRDb25kaXRpb25zLnZvbGF0aWxpdHkgPiAwLjAzKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKCdSZWR1Y2UgcG9zaXRpb24gc2l6ZXMgZHVyaW5nIGhpZ2ggdm9sYXRpbGl0eSBwZXJpb2RzJyk7XG4gICAgfVxuICAgIFxuICAgIGlmIChwZXJpb2QubWFya2V0Q29uZGl0aW9ucy5idGNDb3JyZWxhdGlvbiA+IDAuOSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCgnQXZvaWQgdHJhZGluZyBkdXJpbmcgaGlnaCBCVEMgY29ycmVsYXRpb24gcGVyaW9kcycpO1xuICAgIH1cbiAgICBcbiAgICBpZiAocGVyaW9kLmNvbnNlY3V0aXZlTG9zc2VzID4gNSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCgnSW1wbGVtZW50IGNpcmN1aXQgYnJlYWtlciBhZnRlciAzIGNvbnNlY3V0aXZlIGxvc3NlcycpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc3VnZ2VzdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGFuYWx5emVNYXJrZXRDb25kaXRpb25QZXJmb3JtYW5jZShcbiAgICB0cmFkZXM6IEJhY2t0ZXN0VHJhZGVbXSxcbiAgICBoaXN0b3JpY2FsRGF0YTogTWFwPHN0cmluZywgT0hMQ1ZbXT5cbiAgKTogTWFya2V0Q29uZGl0aW9uQW5hbHlzaXMge1xuICAgIC8vIFNpbXBsaWZpZWQgYW5hbHlzaXMgLSB3b3VsZCBiZSBtb3JlIGRldGFpbGVkIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICBjb25zdCBkZWZhdWx0UGVyZiA9IHsgd2luUmF0ZTogMC41LCBwcm9maXRGYWN0b3I6IDEuMCwgdHJhZGVzOiAwIH07XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHZvbGF0aWxpdHlSZWdpbWVzOiB7XG4gICAgICAgIGxvdzogZGVmYXVsdFBlcmYsXG4gICAgICAgIG1lZGl1bTogZGVmYXVsdFBlcmYsXG4gICAgICAgIGhpZ2g6IGRlZmF1bHRQZXJmXG4gICAgICB9LFxuICAgICAgc2Vzc2lvblBlcmZvcm1hbmNlOiB7XG4gICAgICAgIEFTSUFOOiBkZWZhdWx0UGVyZixcbiAgICAgICAgTE9ORE9OOiBkZWZhdWx0UGVyZixcbiAgICAgICAgTlk6IGRlZmF1bHRQZXJmLFxuICAgICAgICBERUFEX1pPTkU6IGRlZmF1bHRQZXJmXG4gICAgICB9LFxuICAgICAgdHJlbmRQZXJmb3JtYW5jZToge1xuICAgICAgICBCVUxMOiBkZWZhdWx0UGVyZixcbiAgICAgICAgQkVBUjogZGVmYXVsdFBlcmYsXG4gICAgICAgIFJBTkdFOiBkZWZhdWx0UGVyZlxuICAgICAgfSxcbiAgICAgIGNvcnJlbGF0aW9uSW1wYWN0OiB7XG4gICAgICAgIGxvd0NvcnJlbGF0aW9uOiBkZWZhdWx0UGVyZixcbiAgICAgICAgaGlnaENvcnJlbGF0aW9uOiBkZWZhdWx0UGVyZlxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldEVtcHR5TWV0cmljcyhjb25maWc6IEJhY2t0ZXN0Q29uZmlnKTogQmFja3Rlc3RNZXRyaWNzIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhcnREYXRlOiBjb25maWcuc3RhcnREYXRlLFxuICAgICAgZW5kRGF0ZTogY29uZmlnLmVuZERhdGUsXG4gICAgICBkdXJhdGlvbjogY29uZmlnLmVuZERhdGUgLSBjb25maWcuc3RhcnREYXRlLFxuICAgICAgaW5pdGlhbEVxdWl0eTogY29uZmlnLmluaXRpYWxFcXVpdHksXG4gICAgICBmaW5hbEVxdWl0eTogY29uZmlnLmluaXRpYWxFcXVpdHksXG4gICAgICB0b3RhbFJldHVybjogMCxcbiAgICAgIGFubnVhbGl6ZWRSZXR1cm46IDAsXG4gICAgICBtYXhEcmF3ZG93bjogMCxcbiAgICAgIG1heERyYXdkb3duRHVyYXRpb246IDAsXG4gICAgICBzaGFycGVSYXRpbzogMCxcbiAgICAgIHNvcnRpbm9SYXRpbzogMCxcbiAgICAgIGNhbG1hclJhdGlvOiAwLFxuICAgICAgd2luUmF0ZTogMCxcbiAgICAgIHByb2ZpdEZhY3RvcjogMCxcbiAgICAgIHRvdGFsVHJhZGVzOiAwLFxuICAgICAgYXZlcmFnZVdpbjogMCxcbiAgICAgIGF2ZXJhZ2VMb3NzOiAwLFxuICAgICAgbGFyZ2VzdFdpbjogMCxcbiAgICAgIGxhcmdlc3RMb3NzOiAwLFxuICAgICAgY29uc2VjdXRpdmVXaW5zOiAwLFxuICAgICAgY29uc2VjdXRpdmVMb3NzZXM6IDAsXG4gICAgICBhdmVyYWdlSG9sZFRpbWU6IDAsXG4gICAgICB0b3RhbEZlZXM6IDAsXG4gICAgICB0b3RhbFNsaXBwYWdlOiAwLFxuICAgICAgbWF4Q29uY3VycmVudFBvc2l0aW9uczogMCxcbiAgICAgIGF2ZXJhZ2VQb3NpdGlvbnNPcGVuOiAwXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29uZmlndXJhdGlvblxuICAgKi9cbiAgcHVibGljIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8QmFja3Rlc3RDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcbiAgICBjb25zb2xlLmxvZygn8J+TnSBCYWNrdGVzdEVuZ2luZSBjb25maWd1cmF0aW9uIHVwZGF0ZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29uZmlnKCk6IEJhY2t0ZXN0Q29uZmlnIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmNvbmZpZyB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGJhY2t0ZXN0IGlzIGN1cnJlbnRseSBydW5uaW5nXG4gICAqL1xuICBwdWJsaWMgaXNCYWNrdGVzdFJ1bm5pbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNSdW5uaW5nO1xuICB9XG59Il0sInZlcnNpb24iOjN9