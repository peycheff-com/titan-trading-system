7ebeb435d52c9a089199f705802c6619
"use strict";
/**
 * Unit tests for PositionManager
 * Tests position management functionality including breakeven, partial profits, trailing stops
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock BybitPerpsClient
jest.mock('../../src/exchanges/BybitPerpsClient');
const PositionManager_1 = require("../../src/risk/PositionManager");
const BybitPerpsClient_1 = require("../../src/exchanges/BybitPerpsClient");
describe('PositionManager', () => {
    let positionManager;
    let mockBybitClient;
    let mockPosition;
    beforeEach(() => {
        // Create mock client
        mockBybitClient = new BybitPerpsClient_1.BybitPerpsClient('test-key', 'test-secret');
        // Mock client methods
        mockBybitClient.setStopLoss = jest.fn().mockResolvedValue(true);
        mockBybitClient.placeOrderWithRetry = jest.fn().mockResolvedValue({
            orderId: 'test-order-id',
            symbol: 'BTCUSDT',
            side: 'Sell',
            qty: 0.5,
            price: 52000,
            status: 'FILLED',
            timestamp: Date.now()
        });
        mockBybitClient.getCurrentPrice = jest.fn().mockResolvedValue(51000);
        // Create position manager with test config
        const config = {
            breakevenRLevel: 1.5,
            partialProfitRLevel: 2.0,
            partialProfitPercentage: 50,
            trailingStopDistance: 1.0,
            tightenAfterHours: 48,
            tightenedStopDistance: 0.5
        };
        positionManager = new PositionManager_1.PositionManager(mockBybitClient, config);
        // Create mock position
        mockPosition = {
            id: 'test-position-1',
            symbol: 'BTCUSDT',
            side: 'LONG',
            entryPrice: 50000,
            currentPrice: 51000,
            quantity: 1.0,
            leverage: 5,
            stopLoss: 49250, // 1.5% stop
            takeProfit: 52250, // 4.5% target (3:1 R:R)
            unrealizedPnL: 1000,
            realizedPnL: 0,
            entryTime: Date.now() - (24 * 60 * 60 * 1000), // 24 hours ago
            status: 'OPEN',
            rValue: 1.33, // (1000 / 750) = 1.33R
            atr: 500 // $500 ATR
        };
    });
    afterEach(() => {
        positionManager.destroy();
        jest.clearAllMocks();
    });
    describe('Position Management', () => {
        test('should add and retrieve positions', () => {
            positionManager.addPosition(mockPosition);
            const retrievedPosition = positionManager.getPosition(mockPosition.id);
            expect(retrievedPosition).toEqual(mockPosition);
            const allPositions = positionManager.getPositions();
            expect(allPositions).toHaveLength(1);
            expect(allPositions[0]).toEqual(mockPosition);
        });
        test('should remove positions', () => {
            positionManager.addPosition(mockPosition);
            expect(positionManager.getPositions()).toHaveLength(1);
            positionManager.removePosition(mockPosition.id);
            expect(positionManager.getPositions()).toHaveLength(0);
            expect(positionManager.getPosition(mockPosition.id)).toBeUndefined();
        });
        test('should update position data', () => {
            positionManager.addPosition(mockPosition);
            const update = {
                id: mockPosition.id,
                currentPrice: 52000,
                unrealizedPnL: 2000,
                timestamp: Date.now()
            };
            positionManager.updatePosition(update);
            const updatedPosition = positionManager.getPosition(mockPosition.id);
            expect(updatedPosition?.currentPrice).toBe(52000);
            expect(updatedPosition?.unrealizedPnL).toBe(2000);
            expect(updatedPosition?.rValue).toBeCloseTo(2.67, 1); // 2000 / 750 = 2.67R
        });
    });
    describe('Move Stop to Breakeven', () => {
        test('should move stop to breakeven at 1.5R profit', async () => {
            // Set position to 1.5R profit
            mockPosition.rValue = 1.5;
            mockPosition.unrealizedPnL = 1125; // 1.5 * 750 = 1125
            positionManager.addPosition(mockPosition);
            const result = await positionManager.moveStopToBreakeven(mockPosition);
            expect(result).toBe(true);
            expect(mockBybitClient.setStopLoss).toHaveBeenCalledWith('BTCUSDT', 50000);
            const updatedPosition = positionManager.getPosition(mockPosition.id);
            expect(updatedPosition?.stopLoss).toBe(50000); // Entry price
        });
        test('should not move stop to breakeven if not profitable enough', async () => {
            // Set position to 1.0R profit (below 1.5R threshold)
            mockPosition.rValue = 1.0;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.moveStopToBreakeven(mockPosition);
            expect(result).toBe(false);
            expect(mockBybitClient.setStopLoss).not.toHaveBeenCalled();
        });
        test('should not move stop if already at breakeven', async () => {
            // Set stop already at entry price
            mockPosition.stopLoss = mockPosition.entryPrice;
            mockPosition.rValue = 2.0;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.moveStopToBreakeven(mockPosition);
            expect(result).toBe(true);
            expect(mockBybitClient.setStopLoss).not.toHaveBeenCalled();
        });
    });
    describe('Take Partial Profit', () => {
        test('should take partial profit at 2R profit', async () => {
            // Set position to 2R profit
            mockPosition.rValue = 2.0;
            mockPosition.unrealizedPnL = 1500; // 2 * 750 = 1500
            positionManager.addPosition(mockPosition);
            const result = await positionManager.takePartialProfit(mockPosition);
            expect(result).toBe(true);
            expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith({
                phase: 'phase2',
                symbol: 'BTCUSDT',
                side: 'Sell',
                type: 'MARKET',
                qty: 0.5, // 50% of 1.0
                leverage: 5
            });
            const updatedPosition = positionManager.getPosition(mockPosition.id);
            expect(updatedPosition?.quantity).toBe(0.5); // Reduced by 50%
        });
        test('should not take partial profit if not profitable enough', async () => {
            // Set position to 1.5R profit (below 2R threshold)
            mockPosition.rValue = 1.5;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.takePartialProfit(mockPosition);
            expect(result).toBe(false);
            expect(mockBybitClient.placeOrderWithRetry).not.toHaveBeenCalled();
        });
    });
    describe('Trailing Stop', () => {
        test('should update trailing stop for profitable long position', async () => {
            // Set profitable long position
            mockPosition.rValue = 1.0;
            mockPosition.currentPrice = 51000;
            mockPosition.stopLoss = 49250; // Original stop
            mockPosition.atr = 500;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.updateTrailingStop(mockPosition);
            const expectedNewStop = 51000 - (500 * 1.0); // 50500
            expect(result).toBe(true);
            expect(mockBybitClient.setStopLoss).toHaveBeenCalledWith('BTCUSDT', expectedNewStop);
        });
        test('should update trailing stop for profitable short position', async () => {
            // Set profitable short position
            mockPosition.side = 'SHORT';
            mockPosition.rValue = 1.0;
            mockPosition.currentPrice = 49000;
            mockPosition.stopLoss = 50750; // Original stop
            mockPosition.atr = 500;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.updateTrailingStop(mockPosition);
            const expectedNewStop = 49000 + (500 * 1.0); // 49500
            expect(result).toBe(true);
            expect(mockBybitClient.setStopLoss).toHaveBeenCalledWith('BTCUSDT', expectedNewStop);
        });
        test('should not trail stop if not profitable', async () => {
            // Set unprofitable position
            mockPosition.rValue = -0.5;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.updateTrailingStop(mockPosition);
            expect(result).toBe(false);
            expect(mockBybitClient.setStopLoss).not.toHaveBeenCalled();
        });
        test('should not trail stop if new stop is worse than current', async () => {
            // Set position where trailing would make stop worse
            mockPosition.rValue = 1.0;
            mockPosition.currentPrice = 50500; // Close to entry
            mockPosition.stopLoss = 50000; // Better than what trailing would set (50500 - 500 = 50000)
            mockPosition.atr = 500;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.updateTrailingStop(mockPosition);
            expect(result).toBe(false);
            expect(mockBybitClient.setStopLoss).not.toHaveBeenCalled();
        });
    });
    describe('Tighten Stop After 48h', () => {
        test('should tighten stop after 48 hours', async () => {
            // Set position older than 48 hours
            mockPosition.entryTime = Date.now() - (50 * 60 * 60 * 1000); // 50 hours ago
            mockPosition.currentPrice = 51000;
            mockPosition.stopLoss = 49250; // Original stop
            mockPosition.atr = 500;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.tightenStopAfter48h(mockPosition);
            const expectedNewStop = 51000 - (500 * 0.5); // 50750 (0.5 ATR)
            expect(result).toBe(true);
            expect(mockBybitClient.setStopLoss).toHaveBeenCalledWith('BTCUSDT', expectedNewStop);
        });
        test('should not tighten stop if position is too young', async () => {
            // Set position younger than 48 hours
            mockPosition.entryTime = Date.now() - (24 * 60 * 60 * 1000); // 24 hours ago
            positionManager.addPosition(mockPosition);
            const result = await positionManager.tightenStopAfter48h(mockPosition);
            expect(result).toBe(false);
            expect(mockBybitClient.setStopLoss).not.toHaveBeenCalled();
        });
    });
    describe('Close Position', () => {
        test('should close position for stop hit', async () => {
            positionManager.addPosition(mockPosition);
            const result = await positionManager.closePosition(mockPosition, 'STOP_HIT');
            expect(result).toBe(true);
            expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith({
                phase: 'phase2',
                symbol: 'BTCUSDT',
                side: 'Sell',
                type: 'MARKET',
                qty: 1.0,
                leverage: 5
            });
            // Position should be removed from management
            expect(positionManager.getPosition(mockPosition.id)).toBeUndefined();
        });
        test('should close position for target hit', async () => {
            positionManager.addPosition(mockPosition);
            const result = await positionManager.closePosition(mockPosition, 'TARGET_HIT');
            expect(result).toBe(true);
            expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith({
                phase: 'phase2',
                symbol: 'BTCUSDT',
                side: 'Sell',
                type: 'MARKET',
                qty: 1.0,
                leverage: 5
            });
        });
        test('should close short position correctly', async () => {
            mockPosition.side = 'SHORT';
            positionManager.addPosition(mockPosition);
            const result = await positionManager.closePosition(mockPosition, 'MANUAL');
            expect(result).toBe(true);
            expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith({
                phase: 'phase2',
                symbol: 'BTCUSDT',
                side: 'Buy', // Opposite side for short
                type: 'MARKET',
                qty: 1.0,
                leverage: 5
            });
        });
    });
    describe('Statistics', () => {
        test('should calculate position statistics', () => {
            const position1 = { ...mockPosition, id: 'pos1', unrealizedPnL: 1000, realizedPnL: 500, rValue: 1.5 };
            const position2 = { ...mockPosition, id: 'pos2', unrealizedPnL: -500, realizedPnL: 200, rValue: -0.5 };
            positionManager.addPosition(position1);
            positionManager.addPosition(position2);
            const stats = positionManager.getStatistics();
            expect(stats.totalPositions).toBe(2);
            expect(stats.openPositions).toBe(2);
            expect(stats.totalUnrealizedPnL).toBe(500); // 1000 + (-500)
            expect(stats.totalRealizedPnL).toBe(700); // 500 + 200
            expect(stats.averageRValue).toBe(0.5); // (1.5 + (-0.5)) / 2
        });
    });
    describe('Emergency Close', () => {
        test('should emergency close all positions', async () => {
            const position1 = { ...mockPosition, id: 'pos1' };
            const position2 = { ...mockPosition, id: 'pos2' };
            positionManager.addPosition(position1);
            positionManager.addPosition(position2);
            const result = await positionManager.emergencyCloseAll();
            expect(result.success).toBe(2);
            expect(result.failed).toBe(0);
            expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledTimes(2);
            expect(positionManager.getPositions()).toHaveLength(0);
        });
    });
    describe('Configuration', () => {
        test('should update configuration', () => {
            const newConfig = {
                breakevenRLevel: 2.0,
                partialProfitRLevel: 3.0
            };
            positionManager.updateConfig(newConfig);
            // Test that new config is applied (indirectly through behavior)
            mockPosition.rValue = 1.8; // Between old (1.5) and new (2.0) breakeven level
            positionManager.addPosition(mockPosition);
            // Should not move to breakeven with new config
            expect(positionManager.moveStopToBreakeven(mockPosition)).resolves.toBe(false);
        });
    });
    describe('Error Handling', () => {
        test('should handle API errors gracefully', async () => {
            mockBybitClient.setStopLoss.mockRejectedValue(new Error('API Error'));
            mockPosition.rValue = 1.5;
            positionManager.addPosition(mockPosition);
            const result = await positionManager.moveStopToBreakeven(mockPosition);
            expect(result).toBe(false);
            // Position should still be in management
            expect(positionManager.getPosition(mockPosition.id)).toBeDefined();
        });
        test('should emit error events', (done) => {
            mockBybitClient.setStopLoss.mockRejectedValue(new Error('Test Error'));
            positionManager.on('position:error', (position, error) => {
                expect(position.id).toBe(mockPosition.id);
                expect(error.message).toBe('Test Error');
                done();
            });
            mockPosition.rValue = 1.5;
            positionManager.addPosition(mockPosition);
            positionManager.moveStopToBreakeven(mockPosition);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvdGVzdHMvdW5pdC9Qb3NpdGlvbk1hbmFnZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQU1ILHdCQUF3QjtBQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFMbEQsb0VBQXdGO0FBQ3hGLDJFQUF3RTtBQU14RSxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksZUFBZ0MsQ0FBQztJQUNyQyxJQUFJLGVBQThDLENBQUM7SUFDbkQsSUFBSSxZQUFzQixDQUFDO0lBRTNCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxxQkFBcUI7UUFDckIsZUFBZSxHQUFHLElBQUksbUNBQWdCLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBa0MsQ0FBQztRQUVuRyxzQkFBc0I7UUFDdEIsZUFBZSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEUsZUFBZSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztZQUNoRSxPQUFPLEVBQUUsZUFBZTtZQUN4QixNQUFNLEVBQUUsU0FBUztZQUNqQixJQUFJLEVBQUUsTUFBTTtZQUNaLEdBQUcsRUFBRSxHQUFHO1lBQ1IsS0FBSyxFQUFFLEtBQUs7WUFDWixNQUFNLEVBQUUsUUFBUTtZQUNoQixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtTQUN0QixDQUFDLENBQUM7UUFDSCxlQUFlLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVyRSwyQ0FBMkM7UUFDM0MsTUFBTSxNQUFNLEdBQW1DO1lBQzdDLGVBQWUsRUFBRSxHQUFHO1lBQ3BCLG1CQUFtQixFQUFFLEdBQUc7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Z0JBQWdCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQ3ZELE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDMUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3pDLElBQUksRUFBRSxDQUFDO1lBQ1QsQ0FBQyxDQUFDLENBQUM7WUFFSCxZQUFZLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztZQUMxQixlQUFlLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzFDLGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvdGVzdHMvdW5pdC9Qb3NpdGlvbk1hbmFnZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgdGVzdHMgZm9yIFBvc2l0aW9uTWFuYWdlclxuICogVGVzdHMgcG9zaXRpb24gbWFuYWdlbWVudCBmdW5jdGlvbmFsaXR5IGluY2x1ZGluZyBicmVha2V2ZW4sIHBhcnRpYWwgcHJvZml0cywgdHJhaWxpbmcgc3RvcHNcbiAqL1xuXG5pbXBvcnQgeyBQb3NpdGlvbk1hbmFnZXIsIFBvc2l0aW9uTWFuYWdlckNvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy9yaXNrL1Bvc2l0aW9uTWFuYWdlcic7XG5pbXBvcnQgeyBCeWJpdFBlcnBzQ2xpZW50IH0gZnJvbSAnLi4vLi4vc3JjL2V4Y2hhbmdlcy9CeWJpdFBlcnBzQ2xpZW50JztcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vc3JjL3R5cGVzJztcblxuLy8gTW9jayBCeWJpdFBlcnBzQ2xpZW50XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9leGNoYW5nZXMvQnliaXRQZXJwc0NsaWVudCcpO1xuXG5kZXNjcmliZSgnUG9zaXRpb25NYW5hZ2VyJywgKCkgPT4ge1xuICBsZXQgcG9zaXRpb25NYW5hZ2VyOiBQb3NpdGlvbk1hbmFnZXI7XG4gIGxldCBtb2NrQnliaXRDbGllbnQ6IGplc3QuTW9ja2VkPEJ5Yml0UGVycHNDbGllbnQ+O1xuICBsZXQgbW9ja1Bvc2l0aW9uOiBQb3NpdGlvbjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBDcmVhdGUgbW9jayBjbGllbnRcbiAgICBtb2NrQnliaXRDbGllbnQgPSBuZXcgQnliaXRQZXJwc0NsaWVudCgndGVzdC1rZXknLCAndGVzdC1zZWNyZXQnKSBhcyBqZXN0Lk1vY2tlZDxCeWJpdFBlcnBzQ2xpZW50PjtcbiAgICBcbiAgICAvLyBNb2NrIGNsaWVudCBtZXRob2RzXG4gICAgbW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgIG1vY2tCeWJpdENsaWVudC5wbGFjZU9yZGVyV2l0aFJldHJ5ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIG9yZGVySWQ6ICd0ZXN0LW9yZGVyLWlkJyxcbiAgICAgIHN5bWJvbDogJ0JUQ1VTRFQnLFxuICAgICAgc2lkZTogJ1NlbGwnLFxuICAgICAgcXR5OiAwLjUsXG4gICAgICBwcmljZTogNTIwMDAsXG4gICAgICBzdGF0dXM6ICdGSUxMRUQnLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgfSk7XG4gICAgbW9ja0J5Yml0Q2xpZW50LmdldEN1cnJlbnRQcmljZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSg1MTAwMCk7XG5cbiAgICAvLyBDcmVhdGUgcG9zaXRpb24gbWFuYWdlciB3aXRoIHRlc3QgY29uZmlnXG4gICAgY29uc3QgY29uZmlnOiBQYXJ0aWFsPFBvc2l0aW9uTWFuYWdlckNvbmZpZz4gPSB7XG4gICAgICBicmVha2V2ZW5STGV2ZWw6IDEuNSxcbiAgICAgIHBhcnRpYWxQcm9maXRSTGV2ZWw6IDIuMCxcbiAgICAgIHBhcnRpYWxQcm9maXRQZXJjZW50YWdlOiA1MCxcbiAgICAgIHRyYWlsaW5nU3RvcERpc3RhbmNlOiAxLjAsXG4gICAgICB0aWdodGVuQWZ0ZXJIb3VyczogNDgsXG4gICAgICB0aWdodGVuZWRTdG9wRGlzdGFuY2U6IDAuNVxuICAgIH07XG5cbiAgICBwb3NpdGlvbk1hbmFnZXIgPSBuZXcgUG9zaXRpb25NYW5hZ2VyKG1vY2tCeWJpdENsaWVudCwgY29uZmlnKTtcblxuICAgIC8vIENyZWF0ZSBtb2NrIHBvc2l0aW9uXG4gICAgbW9ja1Bvc2l0aW9uID0ge1xuICAgICAgaWQ6ICd0ZXN0LXBvc2l0aW9uLTEnLFxuICAgICAgc3ltYm9sOiAnQlRDVVNEVCcsXG4gICAgICBzaWRlOiAnTE9ORycsXG4gICAgICBlbnRyeVByaWNlOiA1MDAwMCxcbiAgICAgIGN1cnJlbnRQcmljZTogNTEwMDAsXG4gICAgICBxdWFudGl0eTogMS4wLFxuICAgICAgbGV2ZXJhZ2U6IDUsXG4gICAgICBzdG9wTG9zczogNDkyNTAsIC8vIDEuNSUgc3RvcFxuICAgICAgdGFrZVByb2ZpdDogNTIyNTAsIC8vIDQuNSUgdGFyZ2V0ICgzOjEgUjpSKVxuICAgICAgdW5yZWFsaXplZFBuTDogMTAwMCxcbiAgICAgIHJlYWxpemVkUG5MOiAwLFxuICAgICAgZW50cnlUaW1lOiBEYXRlLm5vdygpIC0gKDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAyNCBob3VycyBhZ29cbiAgICAgIHN0YXR1czogJ09QRU4nLFxuICAgICAgclZhbHVlOiAxLjMzLCAvLyAoMTAwMCAvIDc1MCkgPSAxLjMzUlxuICAgICAgYXRyOiA1MDAgLy8gJDUwMCBBVFJcbiAgICB9O1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHBvc2l0aW9uTWFuYWdlci5kZXN0cm95KCk7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQb3NpdGlvbiBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBhZGQgYW5kIHJldHJpZXZlIHBvc2l0aW9ucycsICgpID0+IHtcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXRyaWV2ZWRQb3NpdGlvbiA9IHBvc2l0aW9uTWFuYWdlci5nZXRQb3NpdGlvbihtb2NrUG9zaXRpb24uaWQpO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZFBvc2l0aW9uKS50b0VxdWFsKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IGFsbFBvc2l0aW9ucyA9IHBvc2l0aW9uTWFuYWdlci5nZXRQb3NpdGlvbnMoKTtcbiAgICAgIGV4cGVjdChhbGxQb3NpdGlvbnMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChhbGxQb3NpdGlvbnNbMF0pLnRvRXF1YWwobW9ja1Bvc2l0aW9uKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZW1vdmUgcG9zaXRpb25zJywgKCkgPT4ge1xuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBleHBlY3QocG9zaXRpb25NYW5hZ2VyLmdldFBvc2l0aW9ucygpKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5yZW1vdmVQb3NpdGlvbihtb2NrUG9zaXRpb24uaWQpO1xuICAgICAgZXhwZWN0KHBvc2l0aW9uTWFuYWdlci5nZXRQb3NpdGlvbnMoKSkudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHBvc2l0aW9uTWFuYWdlci5nZXRQb3NpdGlvbihtb2NrUG9zaXRpb24uaWQpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgdXBkYXRlIHBvc2l0aW9uIGRhdGEnLCAoKSA9PiB7XG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24obW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgY29uc3QgdXBkYXRlID0ge1xuICAgICAgICBpZDogbW9ja1Bvc2l0aW9uLmlkLFxuICAgICAgICBjdXJyZW50UHJpY2U6IDUyMDAwLFxuICAgICAgICB1bnJlYWxpemVkUG5MOiAyMDAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci51cGRhdGVQb3NpdGlvbih1cGRhdGUpO1xuICAgICAgXG4gICAgICBjb25zdCB1cGRhdGVkUG9zaXRpb24gPSBwb3NpdGlvbk1hbmFnZXIuZ2V0UG9zaXRpb24obW9ja1Bvc2l0aW9uLmlkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUG9zaXRpb24/LmN1cnJlbnRQcmljZSkudG9CZSg1MjAwMCk7XG4gICAgICBleHBlY3QodXBkYXRlZFBvc2l0aW9uPy51bnJlYWxpemVkUG5MKS50b0JlKDIwMDApO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRQb3NpdGlvbj8uclZhbHVlKS50b0JlQ2xvc2VUbygyLjY3LCAxKTsgLy8gMjAwMCAvIDc1MCA9IDIuNjdSXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNb3ZlIFN0b3AgdG8gQnJlYWtldmVuJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBtb3ZlIHN0b3AgdG8gYnJlYWtldmVuIGF0IDEuNVIgcHJvZml0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IHBvc2l0aW9uIHRvIDEuNVIgcHJvZml0XG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gMS41O1xuICAgICAgbW9ja1Bvc2l0aW9uLnVucmVhbGl6ZWRQbkwgPSAxMTI1OyAvLyAxLjUgKiA3NTAgPSAxMTI1XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIubW92ZVN0b3BUb0JyZWFrZXZlbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tCeWJpdENsaWVudC5zZXRTdG9wTG9zcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JUQ1VTRFQnLCA1MDAwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWRQb3NpdGlvbiA9IHBvc2l0aW9uTWFuYWdlci5nZXRQb3NpdGlvbihtb2NrUG9zaXRpb24uaWQpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRQb3NpdGlvbj8uc3RvcExvc3MpLnRvQmUoNTAwMDApOyAvLyBFbnRyeSBwcmljZVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCBtb3ZlIHN0b3AgdG8gYnJlYWtldmVuIGlmIG5vdCBwcm9maXRhYmxlIGVub3VnaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNldCBwb3NpdGlvbiB0byAxLjBSIHByb2ZpdCAoYmVsb3cgMS41UiB0aHJlc2hvbGQpXG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gMS4wO1xuICAgICAgXG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24obW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9zaXRpb25NYW5hZ2VyLm1vdmVTdG9wVG9CcmVha2V2ZW4obW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCBtb3ZlIHN0b3AgaWYgYWxyZWFkeSBhdCBicmVha2V2ZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgc3RvcCBhbHJlYWR5IGF0IGVudHJ5IHByaWNlXG4gICAgICBtb2NrUG9zaXRpb24uc3RvcExvc3MgPSBtb2NrUG9zaXRpb24uZW50cnlQcmljZTtcbiAgICAgIG1vY2tQb3NpdGlvbi5yVmFsdWUgPSAyLjA7XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIubW92ZVN0b3BUb0JyZWFrZXZlbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tCeWJpdENsaWVudC5zZXRTdG9wTG9zcykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Rha2UgUGFydGlhbCBQcm9maXQnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHRha2UgcGFydGlhbCBwcm9maXQgYXQgMlIgcHJvZml0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IHBvc2l0aW9uIHRvIDJSIHByb2ZpdFxuICAgICAgbW9ja1Bvc2l0aW9uLnJWYWx1ZSA9IDIuMDtcbiAgICAgIG1vY2tQb3NpdGlvbi51bnJlYWxpemVkUG5MID0gMTUwMDsgLy8gMiAqIDc1MCA9IDE1MDBcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvc2l0aW9uTWFuYWdlci50YWtlUGFydGlhbFByb2ZpdChtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tCeWJpdENsaWVudC5wbGFjZU9yZGVyV2l0aFJldHJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHBoYXNlOiAncGhhc2UyJyxcbiAgICAgICAgc3ltYm9sOiAnQlRDVVNEVCcsXG4gICAgICAgIHNpZGU6ICdTZWxsJyxcbiAgICAgICAgdHlwZTogJ01BUktFVCcsXG4gICAgICAgIHF0eTogMC41LCAvLyA1MCUgb2YgMS4wXG4gICAgICAgIGxldmVyYWdlOiA1XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgdXBkYXRlZFBvc2l0aW9uID0gcG9zaXRpb25NYW5hZ2VyLmdldFBvc2l0aW9uKG1vY2tQb3NpdGlvbi5pZCk7XG4gICAgICBleHBlY3QodXBkYXRlZFBvc2l0aW9uPy5xdWFudGl0eSkudG9CZSgwLjUpOyAvLyBSZWR1Y2VkIGJ5IDUwJVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCB0YWtlIHBhcnRpYWwgcHJvZml0IGlmIG5vdCBwcm9maXRhYmxlIGVub3VnaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNldCBwb3NpdGlvbiB0byAxLjVSIHByb2ZpdCAoYmVsb3cgMlIgdGhyZXNob2xkKVxuICAgICAgbW9ja1Bvc2l0aW9uLnJWYWx1ZSA9IDEuNTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvc2l0aW9uTWFuYWdlci50YWtlUGFydGlhbFByb2ZpdChtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtb2NrQnliaXRDbGllbnQucGxhY2VPcmRlcldpdGhSZXRyeSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RyYWlsaW5nIFN0b3AnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHVwZGF0ZSB0cmFpbGluZyBzdG9wIGZvciBwcm9maXRhYmxlIGxvbmcgcG9zaXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgcHJvZml0YWJsZSBsb25nIHBvc2l0aW9uXG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gMS4wO1xuICAgICAgbW9ja1Bvc2l0aW9uLmN1cnJlbnRQcmljZSA9IDUxMDAwO1xuICAgICAgbW9ja1Bvc2l0aW9uLnN0b3BMb3NzID0gNDkyNTA7IC8vIE9yaWdpbmFsIHN0b3BcbiAgICAgIG1vY2tQb3NpdGlvbi5hdHIgPSA1MDA7XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIudXBkYXRlVHJhaWxpbmdTdG9wKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4cGVjdGVkTmV3U3RvcCA9IDUxMDAwIC0gKDUwMCAqIDEuMCk7IC8vIDUwNTAwXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tCeWJpdENsaWVudC5zZXRTdG9wTG9zcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JUQ1VTRFQnLCBleHBlY3RlZE5ld1N0b3ApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHVwZGF0ZSB0cmFpbGluZyBzdG9wIGZvciBwcm9maXRhYmxlIHNob3J0IHBvc2l0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IHByb2ZpdGFibGUgc2hvcnQgcG9zaXRpb25cbiAgICAgIG1vY2tQb3NpdGlvbi5zaWRlID0gJ1NIT1JUJztcbiAgICAgIG1vY2tQb3NpdGlvbi5yVmFsdWUgPSAxLjA7XG4gICAgICBtb2NrUG9zaXRpb24uY3VycmVudFByaWNlID0gNDkwMDA7XG4gICAgICBtb2NrUG9zaXRpb24uc3RvcExvc3MgPSA1MDc1MDsgLy8gT3JpZ2luYWwgc3RvcFxuICAgICAgbW9ja1Bvc2l0aW9uLmF0ciA9IDUwMDtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvc2l0aW9uTWFuYWdlci51cGRhdGVUcmFpbGluZ1N0b3AobW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhwZWN0ZWROZXdTdG9wID0gNDkwMDAgKyAoNTAwICogMS4wKTsgLy8gNDk1MDBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQlRDVVNEVCcsIGV4cGVjdGVkTmV3U3RvcCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IHRyYWlsIHN0b3AgaWYgbm90IHByb2ZpdGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgdW5wcm9maXRhYmxlIHBvc2l0aW9uXG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gLTAuNTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvc2l0aW9uTWFuYWdlci51cGRhdGVUcmFpbGluZ1N0b3AobW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCB0cmFpbCBzdG9wIGlmIG5ldyBzdG9wIGlzIHdvcnNlIHRoYW4gY3VycmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNldCBwb3NpdGlvbiB3aGVyZSB0cmFpbGluZyB3b3VsZCBtYWtlIHN0b3Agd29yc2VcbiAgICAgIG1vY2tQb3NpdGlvbi5yVmFsdWUgPSAxLjA7XG4gICAgICBtb2NrUG9zaXRpb24uY3VycmVudFByaWNlID0gNTA1MDA7IC8vIENsb3NlIHRvIGVudHJ5XG4gICAgICBtb2NrUG9zaXRpb24uc3RvcExvc3MgPSA1MDAwMDsgLy8gQmV0dGVyIHRoYW4gd2hhdCB0cmFpbGluZyB3b3VsZCBzZXQgKDUwNTAwIC0gNTAwID0gNTAwMDApXG4gICAgICBtb2NrUG9zaXRpb24uYXRyID0gNTAwO1xuICAgICAgXG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24obW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9zaXRpb25NYW5hZ2VyLnVwZGF0ZVRyYWlsaW5nU3RvcChtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtb2NrQnliaXRDbGllbnQuc2V0U3RvcExvc3MpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUaWdodGVuIFN0b3AgQWZ0ZXIgNDhoJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCB0aWdodGVuIHN0b3AgYWZ0ZXIgNDggaG91cnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgcG9zaXRpb24gb2xkZXIgdGhhbiA0OCBob3Vyc1xuICAgICAgbW9ja1Bvc2l0aW9uLmVudHJ5VGltZSA9IERhdGUubm93KCkgLSAoNTAgKiA2MCAqIDYwICogMTAwMCk7IC8vIDUwIGhvdXJzIGFnb1xuICAgICAgbW9ja1Bvc2l0aW9uLmN1cnJlbnRQcmljZSA9IDUxMDAwO1xuICAgICAgbW9ja1Bvc2l0aW9uLnN0b3BMb3NzID0gNDkyNTA7IC8vIE9yaWdpbmFsIHN0b3BcbiAgICAgIG1vY2tQb3NpdGlvbi5hdHIgPSA1MDA7XG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIudGlnaHRlblN0b3BBZnRlcjQ4aChtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCBleHBlY3RlZE5ld1N0b3AgPSA1MTAwMCAtICg1MDAgKiAwLjUpOyAvLyA1MDc1MCAoMC41IEFUUilcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQlRDVVNEVCcsIGV4cGVjdGVkTmV3U3RvcCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IHRpZ2h0ZW4gc3RvcCBpZiBwb3NpdGlvbiBpcyB0b28geW91bmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgcG9zaXRpb24geW91bmdlciB0aGFuIDQ4IGhvdXJzXG4gICAgICBtb2NrUG9zaXRpb24uZW50cnlUaW1lID0gRGF0ZS5ub3coKSAtICgyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gMjQgaG91cnMgYWdvXG4gICAgICBcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIudGlnaHRlblN0b3BBZnRlcjQ4aChtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtb2NrQnliaXRDbGllbnQuc2V0U3RvcExvc3MpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDbG9zZSBQb3NpdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY2xvc2UgcG9zaXRpb24gZm9yIHN0b3AgaGl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvc2l0aW9uTWFuYWdlci5jbG9zZVBvc2l0aW9uKG1vY2tQb3NpdGlvbiwgJ1NUT1BfSElUJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnBsYWNlT3JkZXJXaXRoUmV0cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcGhhc2U6ICdwaGFzZTInLFxuICAgICAgICBzeW1ib2w6ICdCVENVU0RUJyxcbiAgICAgICAgc2lkZTogJ1NlbGwnLFxuICAgICAgICB0eXBlOiAnTUFSS0VUJyxcbiAgICAgICAgcXR5OiAxLjAsXG4gICAgICAgIGxldmVyYWdlOiA1XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gUG9zaXRpb24gc2hvdWxkIGJlIHJlbW92ZWQgZnJvbSBtYW5hZ2VtZW50XG4gICAgICBleHBlY3QocG9zaXRpb25NYW5hZ2VyLmdldFBvc2l0aW9uKG1vY2tQb3NpdGlvbi5pZCkpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBjbG9zZSBwb3NpdGlvbiBmb3IgdGFyZ2V0IGhpdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIuY2xvc2VQb3NpdGlvbihtb2NrUG9zaXRpb24sICdUQVJHRVRfSElUJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnBsYWNlT3JkZXJXaXRoUmV0cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcGhhc2U6ICdwaGFzZTInLFxuICAgICAgICBzeW1ib2w6ICdCVENVU0RUJyxcbiAgICAgICAgc2lkZTogJ1NlbGwnLFxuICAgICAgICB0eXBlOiAnTUFSS0VUJyxcbiAgICAgICAgcXR5OiAxLjAsXG4gICAgICAgIGxldmVyYWdlOiA1XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBjbG9zZSBzaG9ydCBwb3NpdGlvbiBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUG9zaXRpb24uc2lkZSA9ICdTSE9SVCc7XG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24obW9ja1Bvc2l0aW9uKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9zaXRpb25NYW5hZ2VyLmNsb3NlUG9zaXRpb24obW9ja1Bvc2l0aW9uLCAnTUFOVUFMJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0J5Yml0Q2xpZW50LnBsYWNlT3JkZXJXaXRoUmV0cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcGhhc2U6ICdwaGFzZTInLFxuICAgICAgICBzeW1ib2w6ICdCVENVU0RUJyxcbiAgICAgICAgc2lkZTogJ0J1eScsIC8vIE9wcG9zaXRlIHNpZGUgZm9yIHNob3J0XG4gICAgICAgIHR5cGU6ICdNQVJLRVQnLFxuICAgICAgICBxdHk6IDEuMCxcbiAgICAgICAgbGV2ZXJhZ2U6IDVcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3RhdGlzdGljcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIHBvc2l0aW9uIHN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwb3NpdGlvbjEgPSB7IC4uLm1vY2tQb3NpdGlvbiwgaWQ6ICdwb3MxJywgdW5yZWFsaXplZFBuTDogMTAwMCwgcmVhbGl6ZWRQbkw6IDUwMCwgclZhbHVlOiAxLjUgfTtcbiAgICAgIGNvbnN0IHBvc2l0aW9uMiA9IHsgLi4ubW9ja1Bvc2l0aW9uLCBpZDogJ3BvczInLCB1bnJlYWxpemVkUG5MOiAtNTAwLCByZWFsaXplZFBuTDogMjAwLCByVmFsdWU6IC0wLjUgfTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKHBvc2l0aW9uMSk7XG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24ocG9zaXRpb24yKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBwb3NpdGlvbk1hbmFnZXIuZ2V0U3RhdGlzdGljcygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxQb3NpdGlvbnMpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc3RhdHMub3BlblBvc2l0aW9ucykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFVucmVhbGl6ZWRQbkwpLnRvQmUoNTAwKTsgLy8gMTAwMCArICgtNTAwKVxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUmVhbGl6ZWRQbkwpLnRvQmUoNzAwKTsgLy8gNTAwICsgMjAwXG4gICAgICBleHBlY3Qoc3RhdHMuYXZlcmFnZVJWYWx1ZSkudG9CZSgwLjUpOyAvLyAoMS41ICsgKC0wLjUpKSAvIDJcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0VtZXJnZW5jeSBDbG9zZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZW1lcmdlbmN5IGNsb3NlIGFsbCBwb3NpdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwb3NpdGlvbjEgPSB7IC4uLm1vY2tQb3NpdGlvbiwgaWQ6ICdwb3MxJyB9O1xuICAgICAgY29uc3QgcG9zaXRpb24yID0geyAuLi5tb2NrUG9zaXRpb24sIGlkOiAncG9zMicgfTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKHBvc2l0aW9uMSk7XG4gICAgICBwb3NpdGlvbk1hbmFnZXIuYWRkUG9zaXRpb24ocG9zaXRpb24yKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcG9zaXRpb25NYW5hZ2VyLmVtZXJnZW5jeUNsb3NlQWxsKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFpbGVkKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1vY2tCeWJpdENsaWVudC5wbGFjZU9yZGVyV2l0aFJldHJ5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICBleHBlY3QocG9zaXRpb25NYW5hZ2VyLmdldFBvc2l0aW9ucygpKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IHtcbiAgICAgICAgYnJlYWtldmVuUkxldmVsOiAyLjAsXG4gICAgICAgIHBhcnRpYWxQcm9maXRSTGV2ZWw6IDMuMFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLnVwZGF0ZUNvbmZpZyhuZXdDb25maWcpO1xuICAgICAgXG4gICAgICAvLyBUZXN0IHRoYXQgbmV3IGNvbmZpZyBpcyBhcHBsaWVkIChpbmRpcmVjdGx5IHRocm91Z2ggYmVoYXZpb3IpXG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gMS44OyAvLyBCZXR3ZWVuIG9sZCAoMS41KSBhbmQgbmV3ICgyLjApIGJyZWFrZXZlbiBsZXZlbFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgbW92ZSB0byBicmVha2V2ZW4gd2l0aCBuZXcgY29uZmlnXG4gICAgICBleHBlY3QocG9zaXRpb25NYW5hZ2VyLm1vdmVTdG9wVG9CcmVha2V2ZW4obW9ja1Bvc2l0aW9uKSkucmVzb2x2ZXMudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIEFQSSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tCeWJpdENsaWVudC5zZXRTdG9wTG9zcy5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0FQSSBFcnJvcicpKTtcbiAgICAgIFxuICAgICAgbW9ja1Bvc2l0aW9uLnJWYWx1ZSA9IDEuNTtcbiAgICAgIHBvc2l0aW9uTWFuYWdlci5hZGRQb3NpdGlvbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwb3NpdGlvbk1hbmFnZXIubW92ZVN0b3BUb0JyZWFrZXZlbihtb2NrUG9zaXRpb24pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIC8vIFBvc2l0aW9uIHNob3VsZCBzdGlsbCBiZSBpbiBtYW5hZ2VtZW50XG4gICAgICBleHBlY3QocG9zaXRpb25NYW5hZ2VyLmdldFBvc2l0aW9uKG1vY2tQb3NpdGlvbi5pZCkpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZW1pdCBlcnJvciBldmVudHMnLCAoZG9uZSkgPT4ge1xuICAgICAgbW9ja0J5Yml0Q2xpZW50LnNldFN0b3BMb3NzLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBFcnJvcicpKTtcbiAgICAgIFxuICAgICAgcG9zaXRpb25NYW5hZ2VyLm9uKCdwb3NpdGlvbjplcnJvcicsIChwb3NpdGlvbiwgZXJyb3IpID0+IHtcbiAgICAgICAgZXhwZWN0KHBvc2l0aW9uLmlkKS50b0JlKG1vY2tQb3NpdGlvbi5pZCk7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdUZXN0IEVycm9yJyk7XG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBtb2NrUG9zaXRpb24uclZhbHVlID0gMS41O1xuICAgICAgcG9zaXRpb25NYW5hZ2VyLmFkZFBvc2l0aW9uKG1vY2tQb3NpdGlvbik7XG4gICAgICBwb3NpdGlvbk1hbmFnZXIubW92ZVN0b3BUb0JyZWFrZXZlbihtb2NrUG9zaXRpb24pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==