{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/backtest/BacktestEngine.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/backtest/BacktestEngine.ts"],"sourcesContent":["/**\n * Backtest Engine for Titan Phase 2 - The Hunter\n * \n * Validates the Holographic Market Structure strategy on historical data with realistic\n * execution simulation including slippage, fees, and market conditions analysis.\n * \n * Requirements: 17.1-17.7 (Backtesting & Forward Testing)\n */\n\nimport { \n  OHLCV, \n  SignalData, \n  HologramState, \n  SessionType, \n  Metrics, \n  TimeRange,\n  Position,\n  OrderParams,\n  OrderResult,\n  OrderStatus\n} from '../types';\nimport { BybitPerpsClient } from '../exchanges/BybitPerpsClient';\nimport { HologramEngine } from '../engine/HologramEngine';\nimport { SessionProfiler } from '../engine/SessionProfiler';\nimport { InefficiencyMapper } from '../engine/InefficiencyMapper';\nimport { CVDValidator } from '../engine/CVDValidator';\nimport { SignalGenerator } from '../execution/SignalGenerator';\nimport { logError } from '../logging/Logger';\n\nexport interface BacktestConfig {\n  startDate: number; // Unix timestamp\n  endDate: number; // Unix timestamp\n  symbols: string[]; // Symbols to backtest\n  initialEquity: number; // Starting capital\n  riskPerTrade: number; // Risk per trade (0.02 = 2%)\n  maxLeverage: number; // Maximum leverage (3-5x)\n  maxConcurrentPositions: number; // Max open positions\n  slippageModel: SlippageModel;\n  feeModel: FeeModel;\n  timeframe: string; // Primary timeframe for signals ('15m')\n}\n\nexport interface SlippageModel {\n  postOnlySlippage: number; // 0.001 = 0.1%\n  iocSlippage: number; // 0.002 = 0.2%\n  marketSlippage: number; // 0.003 = 0.3%\n}\n\nexport interface FeeModel {\n  makerFee: number; // -0.0001 = -0.01% (rebate)\n  takerFee: number; // 0.0005 = 0.05%\n}\n\nexport interface BacktestTrade {\n  id: string;\n  symbol: string;\n  direction: 'LONG' | 'SHORT';\n  entryTime: number;\n  exitTime: number;\n  entryPrice: number;\n  exitPrice: number;\n  quantity: number;\n  leverage: number;\n  pnl: number;\n  pnlPercent: number;\n  fees: number;\n  slippage: number;\n  holdTime: number; // milliseconds\n  exitReason: 'STOP_LOSS' | 'TAKE_PROFIT' | 'TIMEOUT' | 'MANUAL';\n  signal: SignalData;\n  rValue: number; // R multiple (profit/loss in R units)\n}\n\nexport interface BacktestResults {\n  config: BacktestConfig;\n  trades: BacktestTrade[];\n  metrics: BacktestMetrics;\n  equityCurve: EquityPoint[];\n  drawdownCurve: DrawdownPoint[];\n  losingPeriods: LosingPeriod[];\n  marketConditionAnalysis: MarketConditionAnalysis;\n}\n\nexport interface BacktestMetrics extends Metrics {\n  startDate: number;\n  endDate: number;\n  duration: number; // milliseconds\n  initialEquity: number;\n  finalEquity: number;\n  totalReturn: number;\n  annualizedReturn: number;\n  maxDrawdown: number;\n  maxDrawdownDuration: number; // milliseconds\n  sharpeRatio: number;\n  sortinoRatio: number;\n  calmarRatio: number;\n  winRate: number;\n  profitFactor: number;\n  averageWin: number;\n  averageLoss: number;\n  largestWin: number;\n  largestLoss: number;\n  averageHoldTime: number; // milliseconds\n  totalFees: number;\n  totalSlippage: number;\n  maxConcurrentPositions: number;\n  averagePositionsOpen: number;\n}\n\nexport interface EquityPoint {\n  timestamp: number;\n  equity: number;\n  drawdown: number;\n  openPositions: number;\n}\n\nexport interface DrawdownPoint {\n  timestamp: number;\n  drawdown: number;\n  duration: number; // milliseconds since drawdown started\n  peak: number;\n  trough: number;\n}\n\nexport interface LosingPeriod {\n  startTime: number;\n  endTime: number;\n  duration: number;\n  consecutiveLosses: number;\n  totalLoss: number;\n  maxDrawdown: number;\n  marketConditions: {\n    volatility: number;\n    trend: 'BULL' | 'BEAR' | 'RANGE';\n    session: SessionType;\n    btcCorrelation: number;\n  };\n  suggestedAdjustments: string[];\n}\n\nexport interface MarketConditionAnalysis {\n  volatilityRegimes: {\n    low: { winRate: number; profitFactor: number; trades: number };\n    medium: { winRate: number; profitFactor: number; trades: number };\n    high: { winRate: number; profitFactor: number; trades: number };\n  };\n  sessionPerformance: {\n    [K in SessionType]: { winRate: number; profitFactor: number; trades: number };\n  };\n  trendPerformance: {\n    BULL: { winRate: number; profitFactor: number; trades: number };\n    BEAR: { winRate: number; profitFactor: number; trades: number };\n    RANGE: { winRate: number; profitFactor: number; trades: number };\n  };\n  correlationImpact: {\n    lowCorrelation: { winRate: number; profitFactor: number; trades: number };\n    highCorrelation: { winRate: number; profitFactor: number; trades: number };\n  };\n}\n\nexport class BacktestEngine {\n  private bybitClient: BybitPerpsClient;\n  private hologramEngine: HologramEngine;\n  private sessionProfiler: SessionProfiler;\n  private inefficiencyMapper: InefficiencyMapper;\n  private cvdValidator: CVDValidator;\n  private signalGenerator: SignalGenerator;\n  private config: BacktestConfig;\n  private isRunning = false;\n\n  constructor(\n    bybitClient: BybitPerpsClient,\n    hologramEngine: HologramEngine,\n    sessionProfiler: SessionProfiler,\n    inefficiencyMapper: InefficiencyMapper,\n    cvdValidator: CVDValidator,\n    signalGenerator: SignalGenerator\n  ) {\n    this.bybitClient = bybitClient;\n    this.hologramEngine = hologramEngine;\n    this.sessionProfiler = sessionProfiler;\n    this.inefficiencyMapper = inefficiencyMapper;\n    this.cvdValidator = cvdValidator;\n    this.signalGenerator = signalGenerator;\n\n    // Default configuration\n    this.config = {\n      startDate: Date.now() - (30 * 24 * 60 * 60 * 1000), // 30 days ago\n      endDate: Date.now(),\n      symbols: ['BTCUSDT', 'ETHUSDT'],\n      initialEquity: 10000,\n      riskPerTrade: 0.02,\n      maxLeverage: 3,\n      maxConcurrentPositions: 3,\n      slippageModel: {\n        postOnlySlippage: 0.001, // 0.1%\n        iocSlippage: 0.002, // 0.2%\n        marketSlippage: 0.003 // 0.3%\n      },\n      feeModel: {\n        makerFee: -0.0001, // -0.01% (rebate)\n        takerFee: 0.0005 // 0.05%\n      },\n      timeframe: '15m'\n    };\n  }\n\n  /**\n   * Fetch historical OHLCV data for specified date range and symbols\n   * Requirements: 17.1\n   */\n  public async fetchHistoricalData(\n    symbols: string[],\n    timeframe: string,\n    startDate: number,\n    endDate: number\n  ): Promise<Map<string, OHLCV[]>> {\n    const historicalData = new Map<string, OHLCV[]>();\n\n    try {\n      console.log(`üìä Fetching historical data for ${symbols.length} symbols from ${new Date(startDate).toISOString()} to ${new Date(endDate).toISOString()}`);\n\n      for (const symbol of symbols) {\n        try {\n          // Calculate required number of candles\n          const timeframeMs = this.getTimeframeMs(timeframe);\n          const duration = endDate - startDate;\n          const requiredCandles = Math.ceil(duration / timeframeMs) + 100; // Add buffer for indicators\n\n          // Fetch data in chunks if needed (Bybit limit is 1000 candles per request)\n          const allCandles: OHLCV[] = [];\n          let currentEndTime = endDate;\n          \n          while (currentEndTime > startDate && allCandles.length < requiredCandles) {\n            const chunkSize = Math.min(1000, requiredCandles - allCandles.length);\n            \n            const candles = await this.bybitClient.fetchOHLCV(symbol, timeframe, chunkSize);\n            \n            if (candles.length === 0) break;\n            \n            // Filter candles within date range\n            const filteredCandles = candles.filter(\n              candle => candle.timestamp >= startDate && candle.timestamp <= endDate\n            );\n            \n            allCandles.unshift(...filteredCandles);\n            \n            // Update currentEndTime for next chunk\n            currentEndTime = candles[0].timestamp - timeframeMs;\n            \n            // Add delay to respect rate limits\n            await this.sleep(100);\n          }\n\n          // Sort by timestamp and remove duplicates\n          const uniqueCandles = Array.from(\n            new Map(allCandles.map(candle => [candle.timestamp, candle])).values()\n          ).sort((a, b) => a.timestamp - b.timestamp);\n\n          historicalData.set(symbol, uniqueCandles);\n          console.log(`‚úÖ Fetched ${uniqueCandles.length} candles for ${symbol}`);\n\n        } catch (error) {\n          console.error(`‚ùå Failed to fetch data for ${symbol}:`, error);\n          logError('ERROR', `Failed to fetch historical data for ${symbol}`, {\n            symbol,\n            component: 'BacktestEngine',\n            function: 'fetchHistoricalData',\n            stack: (error as Error).stack\n          });\n        }\n      }\n\n      console.log(`‚úÖ Historical data fetch complete: ${historicalData.size} symbols`);\n      return historicalData;\n\n    } catch (error) {\n      console.error('‚ùå Error fetching historical data:', error);\n      throw new Error(`Failed to fetch historical data: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Simulate trade execution with realistic slippage\n   * Requirements: 17.2\n   */\n  public simulateTrade(\n    signal: SignalData,\n    orderType: 'POST_ONLY' | 'IOC' | 'MARKET',\n    currentPrice: number\n  ): { fillPrice: number; slippage: number; filled: boolean } {\n    let slippagePercent: number;\n    let filled = true;\n\n    // Apply slippage based on order type\n    switch (orderType) {\n      case 'POST_ONLY':\n        slippagePercent = this.config.slippageModel.postOnlySlippage;\n        // Post-Only orders have a chance of not filling if price moves away\n        if (Math.random() < 0.1) { // 10% chance of no fill\n          filled = false;\n        }\n        break;\n      case 'IOC':\n        slippagePercent = this.config.slippageModel.iocSlippage;\n        break;\n      case 'MARKET':\n        slippagePercent = this.config.slippageModel.marketSlippage;\n        break;\n      default:\n        slippagePercent = this.config.slippageModel.iocSlippage;\n    }\n\n    if (!filled) {\n      return { fillPrice: 0, slippage: 0, filled: false };\n    }\n\n    // Calculate slippage direction based on trade direction\n    const slippageDirection = signal.direction === 'LONG' ? 1 : -1;\n    const slippageAmount = currentPrice * slippagePercent * slippageDirection;\n    const fillPrice = currentPrice + slippageAmount;\n    const slippage = Math.abs(slippageAmount);\n\n    return { fillPrice, slippage, filled: true };\n  }\n\n  /**\n   * Apply fee model to trades\n   * Requirements: 17.3\n   */\n  public applyFees(\n    notionalValue: number,\n    orderType: 'POST_ONLY' | 'IOC' | 'MARKET'\n  ): number {\n    let feeRate: number;\n\n    // Apply fees based on order type\n    switch (orderType) {\n      case 'POST_ONLY':\n        feeRate = this.config.feeModel.makerFee; // Negative = rebate\n        break;\n      case 'IOC':\n      case 'MARKET':\n        feeRate = this.config.feeModel.takerFee;\n        break;\n      default:\n        feeRate = this.config.feeModel.takerFee;\n    }\n\n    return notionalValue * feeRate;\n  }\n\n  /**\n   * Calculate comprehensive backtest results\n   * Requirements: 17.4\n   */\n  public calcBacktestResults(trades: BacktestTrade[], config: BacktestConfig): BacktestMetrics {\n    if (trades.length === 0) {\n      return this.getEmptyMetrics(config);\n    }\n\n    const duration = config.endDate - config.startDate;\n    const durationYears = duration / (365.25 * 24 * 60 * 60 * 1000);\n\n    // Basic trade statistics\n    const winningTrades = trades.filter(t => t.pnl > 0);\n    const losingTrades = trades.filter(t => t.pnl < 0);\n    const totalPnl = trades.reduce((sum, t) => sum + t.pnl, 0);\n    const totalFees = trades.reduce((sum, t) => sum + t.fees, 0);\n    const totalSlippage = trades.reduce((sum, t) => sum + t.slippage, 0);\n\n    // Calculate equity curve for drawdown analysis\n    let runningEquity = config.initialEquity;\n    let maxEquity = config.initialEquity;\n    let maxDrawdown = 0;\n    let currentDrawdownStart = 0;\n    let maxDrawdownDuration = 0;\n\n    for (const trade of trades) {\n      runningEquity += trade.pnl;\n      \n      if (runningEquity > maxEquity) {\n        maxEquity = runningEquity;\n        currentDrawdownStart = 0;\n      } else {\n        const drawdown = (maxEquity - runningEquity) / maxEquity;\n        if (drawdown > maxDrawdown) {\n          maxDrawdown = drawdown;\n        }\n        \n        if (currentDrawdownStart === 0) {\n          currentDrawdownStart = trade.exitTime;\n        } else {\n          const drawdownDuration = trade.exitTime - currentDrawdownStart;\n          if (drawdownDuration > maxDrawdownDuration) {\n            maxDrawdownDuration = drawdownDuration;\n          }\n        }\n      }\n    }\n\n    const finalEquity = config.initialEquity + totalPnl;\n    const totalReturn = (finalEquity - config.initialEquity) / config.initialEquity;\n    const annualizedReturn = Math.pow(1 + totalReturn, 1 / durationYears) - 1;\n\n    // Risk metrics\n    const returns = trades.map(t => t.pnlPercent);\n    const avgReturn = returns.reduce((sum, r) => sum + r, 0) / returns.length;\n    const returnStdDev = Math.sqrt(\n      returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length\n    );\n    \n    const sharpeRatio = returnStdDev > 0 ? (avgReturn / returnStdDev) * Math.sqrt(252) : 0;\n    \n    const negativeReturns = returns.filter(r => r < 0);\n    const downsideStdDev = negativeReturns.length > 0 \n      ? Math.sqrt(negativeReturns.reduce((sum, r) => sum + Math.pow(r, 2), 0) / negativeReturns.length)\n      : 0;\n    const sortinoRatio = downsideStdDev > 0 ? (avgReturn / downsideStdDev) * Math.sqrt(252) : 0;\n    \n    const calmarRatio = maxDrawdown > 0 ? annualizedReturn / maxDrawdown : 0;\n\n    // Trade statistics\n    const winRate = winningTrades.length / trades.length;\n    const grossProfit = winningTrades.reduce((sum, t) => sum + t.pnl, 0);\n    const grossLoss = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));\n    const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? Infinity : 0;\n\n    const averageWin = winningTrades.length > 0 \n      ? winningTrades.reduce((sum, t) => sum + t.pnl, 0) / winningTrades.length \n      : 0;\n    const averageLoss = losingTrades.length > 0 \n      ? losingTrades.reduce((sum, t) => sum + t.pnl, 0) / losingTrades.length \n      : 0;\n\n    const largestWin = winningTrades.length > 0 \n      ? Math.max(...winningTrades.map(t => t.pnl)) \n      : 0;\n    const largestLoss = losingTrades.length > 0 \n      ? Math.min(...losingTrades.map(t => t.pnl)) \n      : 0;\n\n    const averageHoldTime = trades.reduce((sum, t) => sum + t.holdTime, 0) / trades.length;\n\n    // Consecutive wins/losses\n    let maxConsecutiveWins = 0;\n    let maxConsecutiveLosses = 0;\n    let currentWinStreak = 0;\n    let currentLossStreak = 0;\n\n    for (const trade of trades) {\n      if (trade.pnl > 0) {\n        currentWinStreak++;\n        currentLossStreak = 0;\n        maxConsecutiveWins = Math.max(maxConsecutiveWins, currentWinStreak);\n      } else {\n        currentLossStreak++;\n        currentWinStreak = 0;\n        maxConsecutiveLosses = Math.max(maxConsecutiveLosses, currentLossStreak);\n      }\n    }\n\n    // Position statistics\n    const positionCounts = trades.map(t => 1); // Simplified - would need actual concurrent position tracking\n    const maxConcurrentPositions = Math.max(...positionCounts);\n    const averagePositionsOpen = positionCounts.reduce((sum, c) => sum + c, 0) / positionCounts.length;\n\n    return {\n      startDate: config.startDate,\n      endDate: config.endDate,\n      duration,\n      initialEquity: config.initialEquity,\n      finalEquity,\n      totalReturn,\n      annualizedReturn,\n      maxDrawdown,\n      maxDrawdownDuration,\n      sharpeRatio,\n      sortinoRatio,\n      calmarRatio,\n      winRate,\n      profitFactor,\n      totalTrades: trades.length,\n      averageWin,\n      averageLoss,\n      largestWin,\n      largestLoss,\n      consecutiveWins: maxConsecutiveWins,\n      consecutiveLosses: maxConsecutiveLosses,\n      averageHoldTime,\n      totalFees,\n      totalSlippage,\n      maxConcurrentPositions,\n      averagePositionsOpen\n    };\n  }\n\n  /**\n   * Generate equity curve chart data\n   * Requirements: 17.5\n   */\n  public generateEquityCurve(trades: BacktestTrade[], initialEquity: number): EquityPoint[] {\n    const equityCurve: EquityPoint[] = [];\n    let runningEquity = initialEquity;\n    let maxEquity = initialEquity;\n    let openPositions = 0;\n\n    // Add starting point\n    equityCurve.push({\n      timestamp: trades.length > 0 ? trades[0].entryTime : Date.now(),\n      equity: initialEquity,\n      drawdown: 0,\n      openPositions: 0\n    });\n\n    for (const trade of trades) {\n      // Entry point\n      openPositions++;\n      equityCurve.push({\n        timestamp: trade.entryTime,\n        equity: runningEquity,\n        drawdown: maxEquity > 0 ? (maxEquity - runningEquity) / maxEquity : 0,\n        openPositions\n      });\n\n      // Exit point\n      runningEquity += trade.pnl;\n      openPositions--;\n      \n      if (runningEquity > maxEquity) {\n        maxEquity = runningEquity;\n      }\n\n      equityCurve.push({\n        timestamp: trade.exitTime,\n        equity: runningEquity,\n        drawdown: maxEquity > 0 ? (maxEquity - runningEquity) / maxEquity : 0,\n        openPositions\n      });\n    }\n\n    return equityCurve;\n  }\n\n  /**\n   * Analyze losing periods and correlate with market conditions\n   * Requirements: 17.6\n   */\n  public analyzeLosingPeriods(\n    trades: BacktestTrade[],\n    historicalData: Map<string, OHLCV[]>\n  ): LosingPeriod[] {\n    const losingPeriods: LosingPeriod[] = [];\n    let currentPeriod: Partial<LosingPeriod> | null = null;\n    let consecutiveLosses = 0;\n\n    for (const trade of trades) {\n      if (trade.pnl < 0) {\n        consecutiveLosses++;\n        \n        if (!currentPeriod) {\n          // Start new losing period\n          currentPeriod = {\n            startTime: trade.entryTime,\n            consecutiveLosses: 1,\n            totalLoss: trade.pnl,\n            maxDrawdown: Math.abs(trade.pnl)\n          };\n        } else {\n          // Continue losing period\n          currentPeriod.consecutiveLosses = consecutiveLosses;\n          currentPeriod.totalLoss! += trade.pnl;\n          currentPeriod.maxDrawdown = Math.max(\n            currentPeriod.maxDrawdown!,\n            Math.abs(currentPeriod.totalLoss!)\n          );\n        }\n      } else {\n        // End losing period if it exists\n        if (currentPeriod && consecutiveLosses >= 3) {\n          currentPeriod.endTime = trade.entryTime;\n          currentPeriod.duration = currentPeriod.endTime - currentPeriod.startTime!;\n          \n          // Analyze market conditions during this period\n          currentPeriod.marketConditions = this.analyzeMarketConditions(\n            currentPeriod.startTime!,\n            currentPeriod.endTime,\n            historicalData\n          );\n          \n          // Generate suggested adjustments\n          currentPeriod.suggestedAdjustments = this.generateAdjustmentSuggestions(\n            currentPeriod as LosingPeriod\n          );\n          \n          losingPeriods.push(currentPeriod as LosingPeriod);\n        }\n        \n        currentPeriod = null;\n        consecutiveLosses = 0;\n      }\n    }\n\n    // Handle ongoing losing period at end\n    if (currentPeriod && consecutiveLosses >= 3) {\n      const lastTrade = trades[trades.length - 1];\n      currentPeriod.endTime = lastTrade.exitTime;\n      currentPeriod.duration = currentPeriod.endTime - currentPeriod.startTime!;\n      currentPeriod.marketConditions = this.analyzeMarketConditions(\n        currentPeriod.startTime!,\n        currentPeriod.endTime,\n        historicalData\n      );\n      currentPeriod.suggestedAdjustments = this.generateAdjustmentSuggestions(\n        currentPeriod as LosingPeriod\n      );\n      losingPeriods.push(currentPeriod as LosingPeriod);\n    }\n\n    return losingPeriods;\n  }\n\n  /**\n   * Run complete backtest\n   */\n  public async runBacktest(config: Partial<BacktestConfig> = {}): Promise<BacktestResults> {\n    if (this.isRunning) {\n      throw new Error('Backtest is already running');\n    }\n\n    this.isRunning = true;\n    this.config = { ...this.config, ...config };\n\n    try {\n      console.log('üöÄ Starting backtest...');\n      console.log(`üìÖ Period: ${new Date(this.config.startDate).toISOString()} to ${new Date(this.config.endDate).toISOString()}`);\n      console.log(`üí∞ Initial Equity: $${this.config.initialEquity.toLocaleString()}`);\n      console.log(`üìä Symbols: ${this.config.symbols.join(', ')}`);\n\n      // Fetch historical data\n      const historicalData = await this.fetchHistoricalData(\n        this.config.symbols,\n        this.config.timeframe,\n        this.config.startDate,\n        this.config.endDate\n      );\n\n      // Simulate trading\n      const trades = await this.simulateTrading(historicalData);\n\n      // Calculate results\n      const metrics = this.calcBacktestResults(trades, this.config);\n      const equityCurve = this.generateEquityCurve(trades, this.config.initialEquity);\n      const drawdownCurve = this.generateDrawdownCurve(equityCurve);\n      const losingPeriods = this.analyzeLosingPeriods(trades, historicalData);\n      const marketConditionAnalysis = this.analyzeMarketConditionPerformance(trades, historicalData);\n\n      const results: BacktestResults = {\n        config: this.config,\n        trades,\n        metrics,\n        equityCurve,\n        drawdownCurve,\n        losingPeriods,\n        marketConditionAnalysis\n      };\n\n      console.log('‚úÖ Backtest completed successfully');\n      console.log(`üìà Total Return: ${(metrics.totalReturn * 100).toFixed(2)}%`);\n      console.log(`üéØ Win Rate: ${(metrics.winRate * 100).toFixed(1)}%`);\n      console.log(`üíπ Profit Factor: ${metrics.profitFactor.toFixed(2)}`);\n      console.log(`üìâ Max Drawdown: ${(metrics.maxDrawdown * 100).toFixed(2)}%`);\n\n      return results;\n\n    } catch (error) {\n      console.error('‚ùå Backtest failed:', error);\n      throw error;\n    } finally {\n      this.isRunning = false;\n    }\n  }\n\n  /**\n   * Simulate trading over historical data\n   */\n  private async simulateTrading(historicalData: Map<string, OHLCV[]>): Promise<BacktestTrade[]> {\n    const trades: BacktestTrade[] = [];\n    const openPositions = new Map<string, BacktestTrade>();\n    let currentEquity = this.config.initialEquity;\n\n    // Get all timestamps across all symbols\n    const allTimestamps = new Set<number>();\n    for (const candles of historicalData.values()) {\n      candles.forEach(candle => allTimestamps.add(candle.timestamp));\n    }\n    const sortedTimestamps = Array.from(allTimestamps).sort((a, b) => a - b);\n\n    console.log(`üîÑ Simulating trading across ${sortedTimestamps.length} time periods...`);\n\n    for (let i = 0; i < sortedTimestamps.length; i++) {\n      const timestamp = sortedTimestamps[i];\n      \n      // Check for exits first\n      for (const [symbol, position] of openPositions.entries()) {\n        const candles = historicalData.get(symbol);\n        if (!candles) continue;\n\n        const currentCandle = candles.find(c => c.timestamp === timestamp);\n        if (!currentCandle) continue;\n\n        const exitResult = this.checkExit(position, currentCandle);\n        if (exitResult.shouldExit) {\n          // Close position\n          position.exitTime = timestamp;\n          position.exitPrice = exitResult.exitPrice;\n          position.exitReason = exitResult.reason;\n          position.holdTime = position.exitTime - position.entryTime;\n          \n          // Calculate PnL\n          const pnlMultiplier = position.direction === 'LONG' \n            ? (position.exitPrice - position.entryPrice) / position.entryPrice\n            : (position.entryPrice - position.exitPrice) / position.entryPrice;\n          \n          position.pnl = position.quantity * position.entryPrice * pnlMultiplier * position.leverage;\n          position.pnlPercent = pnlMultiplier * position.leverage;\n          position.rValue = position.pnl / (Math.abs(position.entryPrice - position.signal.stopLoss) * position.quantity);\n\n          // Apply fees and slippage\n          const notionalValue = position.quantity * position.exitPrice;\n          position.fees += this.applyFees(notionalValue, 'IOC'); // Assume IOC for exits\n          \n          const slippageResult = this.simulateTrade(position.signal, 'IOC', position.exitPrice);\n          position.slippage += slippageResult.slippage;\n\n          currentEquity += position.pnl - position.fees - position.slippage;\n          trades.push(position);\n          openPositions.delete(symbol);\n        }\n      }\n\n      // Check for new entries\n      if (openPositions.size < this.config.maxConcurrentPositions) {\n        for (const symbol of this.config.symbols) {\n          if (openPositions.has(symbol)) continue;\n\n          const candles = historicalData.get(symbol);\n          if (!candles) continue;\n\n          const currentCandle = candles.find(c => c.timestamp === timestamp);\n          if (!currentCandle) continue;\n\n          // Generate signal (simplified - would need full market structure analysis)\n          const signal = await this.generateBacktestSignal(symbol, candles, i, currentEquity);\n          if (!signal) continue;\n\n          // Simulate order execution\n          const orderType = 'POST_ONLY'; // Hunter uses Post-Only orders\n          const executionResult = this.simulateTrade(signal, orderType, currentCandle.close);\n          \n          if (executionResult.filled) {\n            // Create new position\n            const position: BacktestTrade = {\n              id: `${symbol}_${timestamp}`,\n              symbol,\n              direction: signal.direction,\n              entryTime: timestamp,\n              exitTime: 0,\n              entryPrice: executionResult.fillPrice,\n              exitPrice: 0,\n              quantity: signal.positionSize,\n              leverage: signal.leverage,\n              pnl: 0,\n              pnlPercent: 0,\n              fees: this.applyFees(signal.positionSize * executionResult.fillPrice, orderType),\n              slippage: executionResult.slippage,\n              holdTime: 0,\n              exitReason: 'MANUAL',\n              signal,\n              rValue: 0\n            };\n\n            openPositions.set(symbol, position);\n          }\n        }\n      }\n\n      // Progress logging\n      if (i % 1000 === 0) {\n        const progress = (i / sortedTimestamps.length * 100).toFixed(1);\n        console.log(`üìä Progress: ${progress}% - Open positions: ${openPositions.size} - Completed trades: ${trades.length}`);\n      }\n    }\n\n    // Close any remaining open positions\n    for (const position of openPositions.values()) {\n      const lastCandle = historicalData.get(position.symbol)?.slice(-1)[0];\n      if (lastCandle) {\n        position.exitTime = lastCandle.timestamp;\n        position.exitPrice = lastCandle.close;\n        position.exitReason = 'MANUAL';\n        position.holdTime = position.exitTime - position.entryTime;\n        \n        const pnlMultiplier = position.direction === 'LONG' \n          ? (position.exitPrice - position.entryPrice) / position.entryPrice\n          : (position.entryPrice - position.exitPrice) / position.entryPrice;\n        \n        position.pnl = position.quantity * position.entryPrice * pnlMultiplier * position.leverage;\n        position.pnlPercent = pnlMultiplier * position.leverage;\n        position.rValue = position.pnl / (Math.abs(position.entryPrice - position.signal.stopLoss) * position.quantity);\n\n        trades.push(position);\n      }\n    }\n\n    return trades;\n  }\n\n  /**\n   * Generate simplified backtest signal\n   */\n  private async generateBacktestSignal(\n    symbol: string,\n    candles: OHLCV[],\n    currentIndex: number,\n    currentEquity: number\n  ): Promise<SignalData | null> {\n    // Simplified signal generation for backtesting\n    // In a real implementation, this would use the full HologramEngine\n    \n    if (currentIndex < 50) return null; // Need enough history\n    \n    const currentCandle = candles[currentIndex];\n    const recentCandles = candles.slice(Math.max(0, currentIndex - 50), currentIndex + 1);\n    \n    // Simple trend detection\n    const sma20 = this.calculateSMA(recentCandles.slice(-20), 'close');\n    const sma50 = this.calculateSMA(recentCandles.slice(-50), 'close');\n    \n    if (sma20 <= sma50) return null; // Only long signals in uptrend\n    \n    // Random signal generation for demo (replace with real logic)\n    if (Math.random() < 0.05) { // 5% chance of signal\n      const direction = 'LONG';\n      const entryPrice = currentCandle.close;\n      const stopLoss = entryPrice * 0.985; // 1.5% stop\n      const takeProfit = entryPrice * 1.045; // 4.5% target\n      const positionSize = (currentEquity * this.config.riskPerTrade) / (entryPrice - stopLoss);\n      \n      return {\n        symbol,\n        direction,\n        hologramStatus: 'B',\n        alignmentScore: 70,\n        rsScore: 0.02,\n        sessionType: 'LONDON',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 75,\n        entryPrice,\n        stopLoss,\n        takeProfit,\n        positionSize,\n        leverage: this.config.maxLeverage,\n        timestamp: currentCandle.timestamp\n      };\n    }\n    \n    return null;\n  }\n\n  /**\n   * Check if position should be exited\n   */\n  private checkExit(\n    position: BacktestTrade,\n    currentCandle: OHLCV\n  ): { shouldExit: boolean; exitPrice: number; reason: 'STOP_LOSS' | 'TAKE_PROFIT' | 'TIMEOUT' | 'MANUAL' } {\n    const signal = position.signal;\n    \n    // Check stop loss\n    if (position.direction === 'LONG' && currentCandle.low <= signal.stopLoss) {\n      return { shouldExit: true, exitPrice: signal.stopLoss, reason: 'STOP_LOSS' };\n    }\n    if (position.direction === 'SHORT' && currentCandle.high >= signal.stopLoss) {\n      return { shouldExit: true, exitPrice: signal.stopLoss, reason: 'STOP_LOSS' };\n    }\n    \n    // Check take profit\n    if (position.direction === 'LONG' && currentCandle.high >= signal.takeProfit) {\n      return { shouldExit: true, exitPrice: signal.takeProfit, reason: 'TAKE_PROFIT' };\n    }\n    if (position.direction === 'SHORT' && currentCandle.low <= signal.takeProfit) {\n      return { shouldExit: true, exitPrice: signal.takeProfit, reason: 'TAKE_PROFIT' };\n    }\n    \n    // Check timeout (72 hours max hold)\n    const maxHoldTime = 72 * 60 * 60 * 1000; // 72 hours\n    if (currentCandle.timestamp - position.entryTime > maxHoldTime) {\n      return { shouldExit: true, exitPrice: currentCandle.close, reason: 'TIMEOUT' };\n    }\n    \n    return { shouldExit: false, exitPrice: 0, reason: 'MANUAL' };\n  }\n\n  /**\n   * Helper methods\n   */\n  private getTimeframeMs(timeframe: string): number {\n    const timeframeMap: { [key: string]: number } = {\n      '1m': 60 * 1000,\n      '5m': 5 * 60 * 1000,\n      '15m': 15 * 60 * 1000,\n      '30m': 30 * 60 * 1000,\n      '1h': 60 * 60 * 1000,\n      '4h': 4 * 60 * 60 * 1000,\n      '1d': 24 * 60 * 60 * 1000\n    };\n    return timeframeMap[timeframe] || 15 * 60 * 1000;\n  }\n\n  private calculateSMA(candles: OHLCV[], field: keyof OHLCV): number {\n    const sum = candles.reduce((acc, candle) => acc + (candle[field] as number), 0);\n    return sum / candles.length;\n  }\n\n  private generateDrawdownCurve(equityCurve: EquityPoint[]): DrawdownPoint[] {\n    const drawdownCurve: DrawdownPoint[] = [];\n    let maxEquity = 0;\n    let drawdownStart = 0;\n\n    for (const point of equityCurve) {\n      if (point.equity > maxEquity) {\n        maxEquity = point.equity;\n        drawdownStart = 0;\n      }\n\n      const drawdown = maxEquity > 0 ? (maxEquity - point.equity) / maxEquity : 0;\n      \n      if (drawdown > 0 && drawdownStart === 0) {\n        drawdownStart = point.timestamp;\n      }\n\n      drawdownCurve.push({\n        timestamp: point.timestamp,\n        drawdown,\n        duration: drawdownStart > 0 ? point.timestamp - drawdownStart : 0,\n        peak: maxEquity,\n        trough: point.equity\n      });\n    }\n\n    return drawdownCurve;\n  }\n\n  private analyzeMarketConditions(\n    startTime: number,\n    endTime: number,\n    historicalData: Map<string, OHLCV[]>\n  ): LosingPeriod['marketConditions'] {\n    // Simplified market condition analysis\n    // In a real implementation, this would be more sophisticated\n    \n    return {\n      volatility: 0.02, // Placeholder\n      trend: 'RANGE',\n      session: 'LONDON',\n      btcCorrelation: 0.8\n    };\n  }\n\n  private generateAdjustmentSuggestions(period: LosingPeriod): string[] {\n    const suggestions: string[] = [];\n    \n    if (period.marketConditions.volatility > 0.03) {\n      suggestions.push('Reduce position sizes during high volatility periods');\n    }\n    \n    if (period.marketConditions.btcCorrelation > 0.9) {\n      suggestions.push('Avoid trading during high BTC correlation periods');\n    }\n    \n    if (period.consecutiveLosses > 5) {\n      suggestions.push('Implement circuit breaker after 3 consecutive losses');\n    }\n    \n    return suggestions;\n  }\n\n  private analyzeMarketConditionPerformance(\n    trades: BacktestTrade[],\n    historicalData: Map<string, OHLCV[]>\n  ): MarketConditionAnalysis {\n    // Simplified analysis - would be more detailed in real implementation\n    const defaultPerf = { winRate: 0.5, profitFactor: 1.0, trades: 0 };\n    \n    return {\n      volatilityRegimes: {\n        low: defaultPerf,\n        medium: defaultPerf,\n        high: defaultPerf\n      },\n      sessionPerformance: {\n        ASIAN: defaultPerf,\n        LONDON: defaultPerf,\n        NY: defaultPerf,\n        DEAD_ZONE: defaultPerf\n      },\n      trendPerformance: {\n        BULL: defaultPerf,\n        BEAR: defaultPerf,\n        RANGE: defaultPerf\n      },\n      correlationImpact: {\n        lowCorrelation: defaultPerf,\n        highCorrelation: defaultPerf\n      }\n    };\n  }\n\n  private getEmptyMetrics(config: BacktestConfig): BacktestMetrics {\n    return {\n      startDate: config.startDate,\n      endDate: config.endDate,\n      duration: config.endDate - config.startDate,\n      initialEquity: config.initialEquity,\n      finalEquity: config.initialEquity,\n      totalReturn: 0,\n      annualizedReturn: 0,\n      maxDrawdown: 0,\n      maxDrawdownDuration: 0,\n      sharpeRatio: 0,\n      sortinoRatio: 0,\n      calmarRatio: 0,\n      winRate: 0,\n      profitFactor: 0,\n      totalTrades: 0,\n      averageWin: 0,\n      averageLoss: 0,\n      largestWin: 0,\n      largestLoss: 0,\n      consecutiveWins: 0,\n      consecutiveLosses: 0,\n      averageHoldTime: 0,\n      totalFees: 0,\n      totalSlippage: 0,\n      maxConcurrentPositions: 0,\n      averagePositionsOpen: 0\n    };\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Update configuration\n   */\n  public updateConfig(newConfig: Partial<BacktestConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    console.log('üìù BacktestEngine configuration updated');\n  }\n\n  /**\n   * Get current configuration\n   */\n  public getConfig(): BacktestConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Check if backtest is currently running\n   */\n  public isBacktestRunning(): boolean {\n    return this.isRunning;\n  }\n}"],"version":3}