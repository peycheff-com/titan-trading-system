{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/CVDValidator.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/CVDValidator.test.ts"],"sourcesContent":["/**\n * Unit Tests for CVDValidator\n * \n * Tests all CVD calculation, absorption detection, and distribution detection functions\n * using known trade patterns and edge cases.\n */\n\nimport { CVDValidator, CVDTrade } from '../../src/engine/CVDValidator';\nimport { Absorption, Distribution, POI, FVG, OrderBlock, LiquidityPool } from '../../src/types';\n\ndescribe('CVDValidator', () => {\n  let cvdValidator: CVDValidator;\n\n  beforeEach(() => {\n    cvdValidator = new CVDValidator();\n  });\n\n  // Helper function to create test CVD trade data\n  const createTrade = (\n    symbol: string,\n    price: number,\n    qty: number,\n    time: number,\n    isBuyerMaker: boolean\n  ): CVDTrade => ({\n    symbol,\n    price,\n    qty,\n    time,\n    isBuyerMaker\n  });\n\n  describe('calcCVD', () => {\n    it('should calculate positive CVD for net buying pressure', () => {\n      const trades: CVDTrade[] = [\n        createTrade('BTCUSDT', 50000, 0.1, Date.now() - 60000, false), // Buy: +5000\n        createTrade('BTCUSDT', 50100, 0.05, Date.now() - 30000, false), // Buy: +2505\n        createTrade('BTCUSDT', 49900, 0.02, Date.now() - 10000, true)   // Sell: -998\n      ];\n\n      const cvd = cvdValidator.calcCVD(trades);\n      expect(cvd).toBeCloseTo(6507, 0); // 5000 + 2505 - 998\n    });\n\n    it('should calculate negative CVD for net selling pressure', () => {\n      const trades: CVDTrade[] = [\n        createTrade('BTCUSDT', 50000, 0.1, Date.now() - 60000, true),  // Sell: -5000\n        createTrade('BTCUSDT', 49900, 0.05, Date.now() - 30000, true), // Sell: -2495\n        createTrade('BTCUSDT', 50100, 0.02, Date.now() - 10000, false) // Buy: +1002\n      ];\n\n      const cvd = cvdValidator.calcCVD(trades);\n      expect(cvd).toBeCloseTo(-6493, 0); // -5000 - 2495 + 1002\n    });\n\n    it('should filter trades by time window', () => {\n      const now = Date.now();\n      const trades: CVDTrade[] = [\n        createTrade('BTCUSDT', 50000, 0.1, now - 600000, false), // 10 min ago (excluded)\n        createTrade('BTCUSDT', 50100, 0.05, now - 240000, false), // 4 min ago (included)\n        createTrade('BTCUSDT', 49900, 0.02, now - 60000, true)    // 1 min ago (included)\n      ];\n\n      const cvd = cvdValidator.calcCVD(trades, 300000); // 5 minute window\n      expect(cvd).toBeCloseTo(1507, 0); // 2505 - 998 (first trade excluded)\n    });\n\n    it('should return zero CVD for empty trades', () => {\n      const cvd = cvdValidator.calcCVD([]);\n      expect(cvd).toBe(0);\n    });\n\n    it('should handle equal buy and sell volumes', () => {\n      const trades: CVDTrade[] = [\n        createTrade('BTCUSDT', 50000, 0.1, Date.now() - 60000, false), // Buy: +5000\n        createTrade('BTCUSDT', 50000, 0.1, Date.now() - 30000, true)   // Sell: -5000\n      ];\n\n      const cvd = cvdValidator.calcCVD(trades);\n      expect(cvd).toBe(0);\n    });\n  });\n\n  describe('detectAbsorption', () => {\n    it('should detect absorption pattern (price LL, CVD HL)', () => {\n      const prices = [100, 95, 90];      // Lower Low pattern\n      const cvdValues = [-1000, -1500, -1200]; // Higher Low pattern\n\n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n\n      expect(absorption).not.toBeNull();\n      expect(absorption!.price).toBe(90);\n      expect(absorption!.cvdValue).toBe(-1200);\n      expect(absorption!.confidence).toBeGreaterThan(0);\n      expect(absorption!.timestamp).toBeCloseTo(Date.now(), -2);\n    });\n\n    it('should not detect absorption when price pattern is wrong', () => {\n      const prices = [90, 95, 100];      // Higher High pattern (wrong)\n      const cvdValues = [-1000, -1500, -1200]; // Higher Low pattern\n\n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).toBeNull();\n    });\n\n    it('should not detect absorption when CVD pattern is wrong', () => {\n      const prices = [100, 95, 90];      // Lower Low pattern\n      const cvdValues = [-1000, -1200, -1500]; // Lower Low pattern (wrong)\n\n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).toBeNull();\n    });\n\n    it('should return null for insufficient data points', () => {\n      const prices = [100, 95];\n      const cvdValues = [-1000, -1200];\n\n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).toBeNull();\n    });\n\n    it('should calculate absorption strength correctly', () => {\n      const prices = [100, 95, 85];      // 15% price drop\n      const cvdValues = [-1000, -1500, -1000]; // 33% CVD rise\n\n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n\n      expect(absorption).not.toBeNull();\n      expect(absorption!.confidence).toBeGreaterThan(20); // Should reflect significant divergence\n      expect(absorption!.confidence).toBeLessThanOrEqual(100);\n    });\n  });\n\n  describe('detectDistribution', () => {\n    it('should detect distribution pattern (price HH, CVD LH)', () => {\n      const prices = [90, 95, 100];      // Higher High pattern\n      const cvdValues = [1000, 1500, 1200]; // Lower High pattern\n\n      const distribution = cvdValidator.detectDistribution(prices, cvdValues);\n\n      expect(distribution).not.toBeNull();\n      expect(distribution!.price).toBe(100);\n      expect(distribution!.cvdValue).toBe(1200);\n      expect(distribution!.confidence).toBeGreaterThan(0);\n      expect(distribution!.timestamp).toBeCloseTo(Date.now(), -2);\n    });\n\n    it('should not detect distribution when price pattern is wrong', () => {\n      const prices = [100, 95, 90];      // Lower Low pattern (wrong)\n      const cvdValues = [1000, 1500, 1200]; // Lower High pattern\n\n      const distribution = cvdValidator.detectDistribution(prices, cvdValues);\n      expect(distribution).toBeNull();\n    });\n\n    it('should not detect distribution when CVD pattern is wrong', () => {\n      const prices = [90, 95, 100];      // Higher High pattern\n      const cvdValues = [1000, 1200, 1500]; // Higher High pattern (wrong)\n\n      const distribution = cvdValidator.detectDistribution(prices, cvdValues);\n      expect(distribution).toBeNull();\n    });\n\n    it('should return null for insufficient data points', () => {\n      const prices = [90, 95];\n      const cvdValues = [1000, 1200];\n\n      const distribution = cvdValidator.detectDistribution(prices, cvdValues);\n      expect(distribution).toBeNull();\n    });\n\n    it('should calculate distribution strength correctly', () => {\n      const prices = [85, 95, 100];      // 17.6% price rise\n      const cvdValues = [1500, 2000, 1500]; // 25% CVD drop\n\n      const distribution = cvdValidator.detectDistribution(prices, cvdValues);\n\n      expect(distribution).not.toBeNull();\n      expect(distribution!.confidence).toBeGreaterThan(20); // Should reflect significant divergence\n      expect(distribution!.confidence).toBeLessThanOrEqual(100);\n    });\n  });\n\n  describe('validateWithCVD', () => {\n    it('should increase confidence for bullish POI with absorption', () => {\n      const bullishFVG: FVG = {\n        type: 'BULLISH',\n        top: 105,\n        bottom: 95,\n        midpoint: 100,\n        barIndex: 5,\n        timestamp: Date.now(),\n        mitigated: false,\n        fillPercent: 0\n      };\n\n      const absorption: Absorption = {\n        price: 98,\n        cvdValue: -1200,\n        timestamp: Date.now(),\n        confidence: 80\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(bullishFVG, absorption);\n      expect(confidenceAdjustment).toBe(30);\n    });\n\n    it('should decrease confidence for bullish POI with distribution', () => {\n      const bullishOB: OrderBlock = {\n        type: 'BULLISH',\n        high: 105,\n        low: 95,\n        barIndex: 5,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      const distribution: Distribution = {\n        price: 102,\n        cvdValue: 1200,\n        timestamp: Date.now(),\n        confidence: 75\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(bullishOB, null, distribution);\n      expect(confidenceAdjustment).toBe(-20);\n    });\n\n    it('should increase confidence for bearish POI with distribution', () => {\n      const bearishFVG: FVG = {\n        type: 'BEARISH',\n        top: 105,\n        bottom: 95,\n        midpoint: 100,\n        barIndex: 5,\n        timestamp: Date.now(),\n        mitigated: false,\n        fillPercent: 0\n      };\n\n      const distribution: Distribution = {\n        price: 102,\n        cvdValue: 1200,\n        timestamp: Date.now(),\n        confidence: 85\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(bearishFVG, null, distribution);\n      expect(confidenceAdjustment).toBe(30);\n    });\n\n    it('should decrease confidence for bearish POI with absorption', () => {\n      const bearishOB: OrderBlock = {\n        type: 'BEARISH',\n        high: 105,\n        low: 95,\n        barIndex: 5,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 85\n      };\n\n      const absorption: Absorption = {\n        price: 98,\n        cvdValue: -1200,\n        timestamp: Date.now(),\n        confidence: 80\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(bearishOB, absorption);\n      expect(confidenceAdjustment).toBe(-20);\n    });\n\n    it('should add confidence for liquidity pool with any CVD divergence', () => {\n      const liquidityPool: LiquidityPool = {\n        type: 'HIGH',\n        price: 105,\n        strength: 75,\n        barIndex: 5,\n        timestamp: Date.now(),\n        swept: false\n      };\n\n      const absorption: Absorption = {\n        price: 98,\n        cvdValue: -1200,\n        timestamp: Date.now(),\n        confidence: 80\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(liquidityPool, absorption);\n      expect(confidenceAdjustment).toBe(15);\n    });\n\n    it('should return zero adjustment when no CVD signals provided', () => {\n      const bullishFVG: FVG = {\n        type: 'BULLISH',\n        top: 105,\n        bottom: 95,\n        midpoint: 100,\n        barIndex: 5,\n        timestamp: Date.now(),\n        mitigated: false,\n        fillPercent: 0\n      };\n\n      const confidenceAdjustment = cvdValidator.validateWithCVD(bullishFVG);\n      expect(confidenceAdjustment).toBe(0);\n    });\n  });\n\n  describe('recordTrade', () => {\n    it('should record trade and maintain history', () => {\n      const trade = createTrade('BTCUSDT', 50000, 0.1, Date.now(), false);\n      \n      cvdValidator.recordTrade(trade);\n      \n      const history = cvdValidator.getTradeHistory('BTCUSDT');\n      expect(history).toHaveLength(1);\n      expect(history[0]).toEqual(trade);\n    });\n\n    it('should maintain separate history for different symbols', () => {\n      const btcTrade = createTrade('BTCUSDT', 50000, 0.1, Date.now(), false);\n      const ethTrade = createTrade('ETHUSDT', 3000, 1.0, Date.now(), true);\n      \n      cvdValidator.recordTrade(btcTrade);\n      cvdValidator.recordTrade(ethTrade);\n      \n      const btcHistory = cvdValidator.getTradeHistory('BTCUSDT');\n      const ethHistory = cvdValidator.getTradeHistory('ETHUSDT');\n      \n      expect(btcHistory).toHaveLength(1);\n      expect(ethHistory).toHaveLength(1);\n      expect(btcHistory[0].symbol).toBe('BTCUSDT');\n      expect(ethHistory[0].symbol).toBe('ETHUSDT');\n    });\n\n    it('should filter old trades from history', () => {\n      const now = Date.now();\n      const oldTrade = createTrade('BTCUSDT', 50000, 0.1, now - 700000, false); // 11+ min ago\n      const recentTrade = createTrade('BTCUSDT', 50100, 0.05, now - 60000, true); // 1 min ago\n      \n      cvdValidator.recordTrade(oldTrade);\n      cvdValidator.recordTrade(recentTrade);\n      \n      const history = cvdValidator.getTradeHistory('BTCUSDT');\n      expect(history).toHaveLength(1);\n      expect(history[0]).toEqual(recentTrade);\n    });\n\n    it('should accumulate multiple trades for same symbol', () => {\n      const trade1 = createTrade('BTCUSDT', 50000, 0.1, Date.now() - 60000, false);\n      const trade2 = createTrade('BTCUSDT', 50100, 0.05, Date.now() - 30000, true);\n      const trade3 = createTrade('BTCUSDT', 49900, 0.02, Date.now() - 10000, false);\n      \n      cvdValidator.recordTrade(trade1);\n      cvdValidator.recordTrade(trade2);\n      cvdValidator.recordTrade(trade3);\n      \n      const history = cvdValidator.getTradeHistory('BTCUSDT');\n      expect(history).toHaveLength(3);\n    });\n  });\n\n  describe('getCurrentCVD', () => {\n    it('should return current CVD for symbol', () => {\n      const trades = [\n        createTrade('BTCUSDT', 50000, 0.1, Date.now() - 60000, false), // Buy: +5000\n        createTrade('BTCUSDT', 50100, 0.05, Date.now() - 30000, true)  // Sell: -2505\n      ];\n      \n      trades.forEach(trade => cvdValidator.recordTrade(trade));\n      \n      const cvd = cvdValidator.getCurrentCVD('BTCUSDT');\n      expect(cvd).toBeCloseTo(2495, 0); // 5000 - 2505\n    });\n\n    it('should return zero for symbol with no trades', () => {\n      const cvd = cvdValidator.getCurrentCVD('NONEXISTENT');\n      expect(cvd).toBe(0);\n    });\n\n    it('should respect custom time window', () => {\n      const now = Date.now();\n      const trades = [\n        createTrade('BTCUSDT', 50000, 0.1, now - 600000, false), // 10 min ago\n        createTrade('BTCUSDT', 50100, 0.05, now - 60000, true)   // 1 min ago\n      ];\n      \n      trades.forEach(trade => cvdValidator.recordTrade(trade));\n      \n      const cvd5min = cvdValidator.getCurrentCVD('BTCUSDT', 300000); // 5 min window\n      const cvd15min = cvdValidator.getCurrentCVD('BTCUSDT', 900000); // 15 min window\n      \n      expect(cvd5min).toBeCloseTo(-2505, 0); // Only recent trade\n      expect(cvd15min).toBeCloseTo(2495, 0); // Both trades\n    });\n  });\n\n  describe('utility methods', () => {\n    it('should clear history for specific symbol', () => {\n      const btcTrade = createTrade('BTCUSDT', 50000, 0.1, Date.now(), false);\n      const ethTrade = createTrade('ETHUSDT', 3000, 1.0, Date.now(), true);\n      \n      cvdValidator.recordTrade(btcTrade);\n      cvdValidator.recordTrade(ethTrade);\n      \n      cvdValidator.clearHistory('BTCUSDT');\n      \n      expect(cvdValidator.getTradeHistory('BTCUSDT')).toHaveLength(0);\n      expect(cvdValidator.getTradeHistory('ETHUSDT')).toHaveLength(1);\n    });\n\n    it('should provide history statistics', () => {\n      const trades = [\n        createTrade('BTCUSDT', 50000, 0.1, Date.now(), false),\n        createTrade('BTCUSDT', 50100, 0.05, Date.now(), true),\n        createTrade('ETHUSDT', 3000, 1.0, Date.now(), false)\n      ];\n      \n      trades.forEach(trade => cvdValidator.recordTrade(trade));\n      \n      const stats = cvdValidator.getHistoryStats();\n      expect(stats.totalSymbols).toBe(2);\n      expect(stats.totalTrades).toBe(3);\n      expect(stats.memoryUsage).toContain('KB');\n    });\n\n    it('should handle empty history gracefully', () => {\n      const stats = cvdValidator.getHistoryStats();\n      expect(stats.totalSymbols).toBe(0);\n      expect(stats.totalTrades).toBe(0);\n      expect(stats.memoryUsage).toBe('0.0 KB');\n    });\n  });\n\n  describe('edge cases', () => {\n    it('should handle zero quantity trades', () => {\n      const trade = createTrade('BTCUSDT', 50000, 0, Date.now(), false);\n      cvdValidator.recordTrade(trade);\n      \n      const cvd = cvdValidator.getCurrentCVD('BTCUSDT');\n      expect(cvd).toBe(0);\n    });\n\n    it('should handle very small CVD values in divergence detection', () => {\n      const prices = [100, 95, 90];\n      const cvdValues = [0.001, 0.0005, 0.0008]; // Very small values\n      \n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).not.toBeNull(); // Should still detect pattern\n      expect(absorption!.confidence).toBeGreaterThan(0);\n    });\n\n    it('should handle identical price values', () => {\n      const prices = [100, 100, 100];\n      const cvdValues = [-1000, -1500, -1200];\n      \n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).toBeNull(); // No price movement = no pattern\n    });\n\n    it('should handle identical CVD values', () => {\n      const prices = [100, 95, 90];\n      const cvdValues = [-1000, -1000, -1000];\n      \n      const absorption = cvdValidator.detectAbsorption(prices, cvdValues);\n      expect(absorption).toBeNull(); // No CVD movement = no pattern\n    });\n  });\n});"],"version":3}