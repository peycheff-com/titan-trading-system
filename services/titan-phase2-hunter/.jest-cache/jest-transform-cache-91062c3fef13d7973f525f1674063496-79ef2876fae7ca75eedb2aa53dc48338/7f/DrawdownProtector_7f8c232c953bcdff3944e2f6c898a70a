d4ccdb377085b1cadaba198e3b70fd7b
"use strict";
/**
 * Drawdown Protector for Titan Phase 2 - The Hunter
 *
 * Provides automatic drawdown protection to preserve capital during adverse conditions:
 * - Daily drawdown thresholds: 3%, 5%, 7%
 * - Weekly drawdown threshold: 10%
 * - Consecutive loss protection: 3 trades
 * - Win rate monitoring: 40% threshold over 20 trades
 * - Emergency flatten at 7% drawdown
 *
 * Requirements: 15.1-15.7 (Drawdown Protection)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DrawdownProtector = void 0;
const events_1 = require("events");
class DrawdownProtector extends events_1.EventEmitter {
    config;
    bybitClient;
    state;
    monitoringInterval = null;
    MONITORING_FREQUENCY = 30000; // 30 seconds
    constructor(bybitClient, config) {
        super();
        this.bybitClient = bybitClient;
        this.config = {
            dailyDrawdownThresholds: {
                level1: 0.03, // 3%
                level2: 0.05, // 5%
                level3: 0.07 // 7%
            },
            weeklyDrawdownThreshold: 0.10, // 10%
            consecutiveLossThreshold: 3,
            consecutiveLossReduction: 0.30, // 30% reduction
            winRateThreshold: 0.40, // 40%
            winRateTradeCount: 20,
            emergencyPauseDuration: 24 * 60 * 60 * 1000, // 24 hours
            leverageReduction: {
                from: 5,
                to: 3
            },
            ...config
        };
        // Initialize state
        this.state = {
            currentEquity: 0,
            startOfDayEquity: 0,
            startOfWeekEquity: 0,
            dailyDrawdown: 0,
            weeklyDrawdown: 0,
            maxDailyDrawdown: 0,
            maxWeeklyDrawdown: 0,
            consecutiveLosses: 0,
            recentTrades: [],
            winRate: 0,
            isEmergencyPaused: false,
            emergencyPauseUntil: 0,
            positionSizeReduction: 1.0, // No reduction initially
            maxLeverageReduction: false,
            lastUpdate: Date.now()
        };
        this.startMonitoring();
    }
    /**
     * Check daily drawdown and apply protection measures
     * @param currentEquity - Current account equity
     * @returns Protection action taken
     */
    async checkDailyDrawdown(currentEquity) {
        try {
            // Update current equity
            this.state.currentEquity = currentEquity;
            // Reset daily tracking if new day
            const now = new Date();
            const lastUpdate = new Date(this.state.lastUpdate);
            if (now.getDate() !== lastUpdate.getDate() ||
                now.getMonth() !== lastUpdate.getMonth() ||
                now.getFullYear() !== lastUpdate.getFullYear()) {
                this.state.startOfDayEquity = this.state.currentEquity; // Use current equity, not the parameter
                this.state.dailyDrawdown = 0;
                console.log(`üìÖ New day detected. Reset daily equity baseline: ${this.state.currentEquity.toFixed(2)} USDT`);
            }
            // Calculate daily drawdown
            if (this.state.startOfDayEquity > 0) {
                this.state.dailyDrawdown = (this.state.startOfDayEquity - currentEquity) / this.state.startOfDayEquity;
                this.state.maxDailyDrawdown = Math.max(this.state.maxDailyDrawdown, this.state.dailyDrawdown);
            }
            const drawdownPercent = this.state.dailyDrawdown * 100;
            // Check thresholds (in order of severity)
            if (this.state.dailyDrawdown >= this.config.dailyDrawdownThresholds.level3) {
                // Level 3: 7% - Emergency flatten and pause
                if (!this.state.isEmergencyPaused) {
                    console.log(`üö® CRITICAL: Daily drawdown ${drawdownPercent.toFixed(2)}% >= 7%. Emergency flatten triggered!`);
                    this.state.isEmergencyPaused = true;
                    this.state.emergencyPauseUntil = Date.now() + this.config.emergencyPauseDuration;
                    this.emit('drawdown:level3', this.state);
                    this.emit('emergency:paused', this.state, this.config.emergencyPauseDuration);
                    this.logProtectionEvent('EMERGENCY_FLATTEN', drawdownPercent);
                    return 'EMERGENCY_FLATTEN';
                }
            }
            else if (this.state.dailyDrawdown >= this.config.dailyDrawdownThresholds.level2) {
                // Level 2: 5% - Halt new entries
                console.log(`‚ö†Ô∏è WARNING: Daily drawdown ${drawdownPercent.toFixed(2)}% >= 5%. Halting new entries.`);
                this.emit('drawdown:level2', this.state);
                this.logProtectionEvent('HALT_NEW_ENTRIES', drawdownPercent);
                return 'HALT_NEW_ENTRIES';
            }
            else if (this.state.dailyDrawdown >= this.config.dailyDrawdownThresholds.level1) {
                // Level 1: 3% - Reduce position sizes by 50%
                if (this.state.positionSizeReduction === 1.0) {
                    console.log(`‚ö†Ô∏è WARNING: Daily drawdown ${drawdownPercent.toFixed(2)}% >= 3%. Reducing position sizes by 50%.`);
                    this.state.positionSizeReduction = 0.5;
                    this.emit('drawdown:level1', this.state);
                    this.logProtectionEvent('REDUCE_POSITION_SIZES', drawdownPercent);
                    return 'REDUCE_POSITION_SIZES';
                }
            }
            else {
                // Reset position size reduction if drawdown improves
                if (this.state.positionSizeReduction < 1.0) {
                    this.state.positionSizeReduction = 1.0;
                    console.log(`‚úÖ Daily drawdown improved to ${drawdownPercent.toFixed(2)}%. Position size reduction lifted.`);
                }
            }
            return null;
        }
        catch (error) {
            console.error(`‚ùå Error checking daily drawdown:`, error);
            return null;
        }
    }
    /**
     * Check weekly drawdown and apply leverage reduction
     * @param currentEquity - Current account equity
     * @returns Protection action taken
     */
    async checkWeeklyDrawdown(currentEquity) {
        try {
            // Update current equity
            this.state.currentEquity = currentEquity;
            // Reset weekly tracking if new week
            const now = new Date();
            const lastUpdate = new Date(this.state.lastUpdate);
            const nowWeek = this.getWeekNumber(now);
            const lastWeek = this.getWeekNumber(lastUpdate);
            if (nowWeek !== lastWeek) {
                this.state.startOfWeekEquity = this.state.currentEquity; // Use current equity, not the parameter
                this.state.weeklyDrawdown = 0;
                this.state.maxLeverageReduction = false;
                console.log(`üìÖ New week detected. Reset weekly equity baseline: ${this.state.currentEquity.toFixed(2)} USDT`);
            }
            // Calculate weekly drawdown
            if (this.state.startOfWeekEquity > 0) {
                this.state.weeklyDrawdown = (this.state.startOfWeekEquity - currentEquity) / this.state.startOfWeekEquity;
                this.state.maxWeeklyDrawdown = Math.max(this.state.maxWeeklyDrawdown, this.state.weeklyDrawdown);
            }
            const drawdownPercent = this.state.weeklyDrawdown * 100;
            // Check weekly threshold
            if (this.state.weeklyDrawdown >= this.config.weeklyDrawdownThreshold && !this.state.maxLeverageReduction) {
                console.log(`‚ö†Ô∏è WARNING: Weekly drawdown ${drawdownPercent.toFixed(2)}% >= 10%. Reducing max leverage from ${this.config.leverageReduction.from}x to ${this.config.leverageReduction.to}x.`);
                this.state.maxLeverageReduction = true;
                this.emit('drawdown:weekly', this.state);
                this.logProtectionEvent('REDUCE_MAX_LEVERAGE', drawdownPercent);
                return 'REDUCE_MAX_LEVERAGE';
            }
            return null;
        }
        catch (error) {
            console.error(`‚ùå Error checking weekly drawdown:`, error);
            return null;
        }
    }
    /**
     * Check for consecutive losses and apply position size reduction
     * @param trades - Recent trade records
     * @returns Protection action taken
     */
    checkConsecutiveLosses(trades) {
        try {
            // Sort trades by timestamp (most recent first)
            const sortedTrades = trades.sort((a, b) => b.timestamp - a.timestamp);
            // Count consecutive losses from most recent trades
            let consecutiveLosses = 0;
            for (const trade of sortedTrades) {
                if (!trade.isWin) {
                    consecutiveLosses++;
                }
                else {
                    break; // Stop at first win
                }
            }
            this.state.consecutiveLosses = consecutiveLosses;
            // Check threshold
            if (consecutiveLosses >= this.config.consecutiveLossThreshold) {
                console.log(`‚ö†Ô∏è WARNING: ${consecutiveLosses} consecutive losses detected. Reducing position sizes by ${this.config.consecutiveLossReduction * 100}% for next 3 trades.`);
                // Apply additional reduction for consecutive losses
                const reductionMultiplier = 1 - this.config.consecutiveLossReduction;
                this.state.positionSizeReduction = Math.min(this.state.positionSizeReduction, reductionMultiplier);
                this.emit('consecutive:losses', this.state, consecutiveLosses);
                this.logProtectionEvent('CONSECUTIVE_LOSSES', consecutiveLosses);
                return 'CONSECUTIVE_LOSSES';
            }
            return null;
        }
        catch (error) {
            console.error(`‚ùå Error checking consecutive losses:`, error);
            return null;
        }
    }
    /**
     * Check win rate over last 20 trades and emit warning if below 40%
     * @param trades - Recent trade records
     * @returns Protection action taken
     */
    checkWinRate(trades) {
        try {
            // Get last N trades for win rate calculation
            const recentTrades = trades
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, this.config.winRateTradeCount);
            if (recentTrades.length < this.config.winRateTradeCount) {
                // Not enough trades for meaningful win rate calculation
                return null;
            }
            // Calculate win rate
            const wins = recentTrades.filter(trade => trade.isWin).length;
            const winRate = wins / recentTrades.length;
            this.state.winRate = winRate;
            // Check threshold
            if (winRate < this.config.winRateThreshold) {
                console.log(`‚ö†Ô∏è STRATEGY DEGRADATION: Win rate ${(winRate * 100).toFixed(1)}% < ${this.config.winRateThreshold * 100}% over last ${recentTrades.length} trades. Parameter review suggested.`);
                this.emit('strategy:degradation', this.state, winRate);
                this.logProtectionEvent('STRATEGY_DEGRADATION', winRate * 100);
                return 'STRATEGY_DEGRADATION';
            }
            return null;
        }
        catch (error) {
            console.error(`‚ùå Error checking win rate:`, error);
            return null;
        }
    }
    /**
     * Emergency flatten all positions and pause trading
     * @param positions - All open positions
     * @returns Promise with success status
     */
    async emergencyFlatten(positions) {
        try {
            console.log(`üö® EMERGENCY FLATTEN: Closing ${positions.length} positions`);
            let successCount = 0;
            let failCount = 0;
            // Close all positions with market orders
            for (const position of positions) {
                try {
                    const orderParams = {
                        phase: 'phase2',
                        symbol: position.symbol,
                        side: position.side === 'LONG' ? 'Sell' : 'Buy',
                        type: 'MARKET',
                        qty: position.quantity,
                        leverage: position.leverage
                    };
                    const result = await this.bybitClient.placeOrderWithRetry(orderParams);
                    if (result.status === 'FILLED') {
                        successCount++;
                        console.log(`‚úÖ Emergency closed: ${position.symbol} at ${result.price}`);
                    }
                    else {
                        failCount++;
                        console.error(`‚ùå Failed to emergency close: ${position.symbol}`);
                    }
                }
                catch (error) {
                    failCount++;
                    console.error(`‚ùå Error closing position ${position.symbol}:`, error);
                }
            }
            // Set emergency pause
            this.state.isEmergencyPaused = true;
            this.state.emergencyPauseUntil = Date.now() + this.config.emergencyPauseDuration;
            console.log(`üö® Emergency flatten complete: ${successCount} success, ${failCount} failed`);
            console.log(`‚è∏Ô∏è Trading paused for ${this.config.emergencyPauseDuration / (1000 * 60 * 60)} hours`);
            this.logProtectionEvent('EMERGENCY_FLATTEN_COMPLETE', successCount);
            return failCount === 0;
        }
        catch (error) {
            console.error(`‚ùå Error in emergency flatten:`, error);
            return false;
        }
    }
    /**
     * Add a completed trade to the tracking system
     * @param trade - Trade record to add
     */
    addTrade(trade) {
        this.state.recentTrades.push(trade);
        // Keep only last 100 trades for memory efficiency
        if (this.state.recentTrades.length > 100) {
            this.state.recentTrades = this.state.recentTrades.slice(-100);
        }
        console.log(`üìä Trade recorded: ${trade.symbol} ${trade.side} ${trade.isWin ? 'WIN' : 'LOSS'} P&L: ${trade.pnl.toFixed(2)}`);
        // Check consecutive losses and win rate after each trade
        this.checkConsecutiveLosses(this.state.recentTrades);
        this.checkWinRate(this.state.recentTrades);
    }
    /**
     * Set the start of day equity (for testing purposes)
     * @param equity - Starting equity for the day
     */
    setStartOfDayEquity(equity) {
        this.state.startOfDayEquity = equity;
    }
    /**
     * Set the start of week equity (for testing purposes)
     * @param equity - Starting equity for the week
     */
    setStartOfWeekEquity(equity) {
        this.state.startOfWeekEquity = equity;
    }
    /**
     * Get current drawdown state
     * @returns Current drawdown state
     */
    getState() {
        return { ...this.state };
    }
    /**
     * Check if trading is currently paused due to emergency
     * @returns True if trading is paused
     */
    isEmergencyPaused() {
        if (this.state.isEmergencyPaused && Date.now() > this.state.emergencyPauseUntil) {
            // Emergency pause period has ended
            this.state.isEmergencyPaused = false;
            this.state.emergencyPauseUntil = 0;
            console.log(`‚úÖ Emergency pause lifted. Trading resumed.`);
            this.emit('emergency:resumed', this.state);
        }
        return this.state.isEmergencyPaused;
    }
    /**
     * Get current position size multiplier based on drawdown protection
     * @returns Position size multiplier (0.5 = 50% reduction)
     */
    getPositionSizeMultiplier() {
        return this.state.positionSizeReduction;
    }
    /**
     * Get current maximum leverage based on weekly drawdown
     * @returns Maximum leverage allowed
     */
    getMaxLeverage() {
        return this.state.maxLeverageReduction
            ? this.config.leverageReduction.to
            : this.config.leverageReduction.from;
    }
    /**
     * Check if new entries are allowed
     * @returns True if new entries are allowed
     */
    canOpenNewPositions() {
        // Block new entries if:
        // 1. Emergency paused
        // 2. Daily drawdown >= 5%
        return !this.isEmergencyPaused() &&
            this.state.dailyDrawdown < this.config.dailyDrawdownThresholds.level2;
    }
    /**
     * Start monitoring drawdown protection
     */
    startMonitoring() {
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
        }
        this.monitoringInterval = setInterval(async () => {
            await this.updateDrawdownState();
        }, this.MONITORING_FREQUENCY);
        console.log(`üõ°Ô∏è Drawdown Protector: Started monitoring (${this.MONITORING_FREQUENCY / 1000}s interval)`);
    }
    /**
     * Stop monitoring drawdown protection
     */
    stopMonitoring() {
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
        }
        console.log(`üõ°Ô∏è Drawdown Protector: Stopped monitoring`);
    }
    /**
     * Update drawdown state with current equity
     */
    async updateDrawdownState() {
        try {
            const currentEquity = await this.bybitClient.getEquity();
            // Initialize baselines if not set
            if (this.state.startOfDayEquity === 0) {
                this.state.startOfDayEquity = currentEquity;
            }
            if (this.state.startOfWeekEquity === 0) {
                this.state.startOfWeekEquity = currentEquity;
            }
            // Check all protection measures
            await this.checkDailyDrawdown(currentEquity);
            await this.checkWeeklyDrawdown(currentEquity);
            this.state.lastUpdate = Date.now();
        }
        catch (error) {
            console.error(`‚ùå Error updating drawdown state:`, error);
        }
    }
    /**
     * Get week number for date
     * @param date - Date to get week number for
     * @returns Week number
     */
    getWeekNumber(date) {
        const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
        const pastDaysOfYear = (date.getTime() - firstDayOfYear.getTime()) / 86400000;
        return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
    }
    /**
     * Log drawdown protection event
     * @param action - Action taken
     * @param value - Associated value (percentage, count, etc.)
     */
    logProtectionEvent(action, value) {
        const event = {
            timestamp: Date.now(),
            type: 'DRAWDOWN_PROTECTION',
            action,
            value,
            currentEquity: this.state.currentEquity,
            dailyDrawdown: this.state.dailyDrawdown * 100,
            weeklyDrawdown: this.state.weeklyDrawdown * 100,
            consecutiveLosses: this.state.consecutiveLosses,
            winRate: this.state.winRate * 100
        };
        console.log(`üõ°Ô∏è DRAWDOWN_PROTECTION:`, JSON.stringify(event));
        this.emit('protection:activated', this.state, action);
    }
    /**
     * Update configuration
     * @param newConfig - New configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log(`üõ°Ô∏è Drawdown Protector: Configuration updated`);
    }
    /**
     * Reset drawdown state (for testing or manual reset)
     */
    resetState() {
        this.state = {
            currentEquity: 0,
            startOfDayEquity: 0,
            startOfWeekEquity: 0,
            dailyDrawdown: 0,
            weeklyDrawdown: 0,
            maxDailyDrawdown: 0,
            maxWeeklyDrawdown: 0,
            consecutiveLosses: 0,
            recentTrades: [],
            winRate: 0,
            isEmergencyPaused: false,
            emergencyPauseUntil: 0,
            positionSizeReduction: 1.0,
            maxLeverageReduction: false,
            lastUpdate: Date.now()
        };
        console.log(`üõ°Ô∏è Drawdown Protector: State reset`);
    }
    /**
     * Get statistics for monitoring
     * @returns Drawdown statistics
     */
    getStatistics() {
        return {
            dailyDrawdown: this.state.dailyDrawdown * 100,
            weeklyDrawdown: this.state.weeklyDrawdown * 100,
            maxDailyDrawdown: this.state.maxDailyDrawdown * 100,
            maxWeeklyDrawdown: this.state.maxWeeklyDrawdown * 100,
            consecutiveLosses: this.state.consecutiveLosses,
            winRate: this.state.winRate * 100,
            totalTrades: this.state.recentTrades.length,
            isEmergencyPaused: this.state.isEmergencyPaused,
            positionSizeReduction: this.state.positionSizeReduction,
            maxLeverageReduction: this.state.maxLeverageReduction
        };
    }
    /**
     * Cleanup resources
     */
    destroy() {
        this.stopMonitoring();
        this.removeAllListeners();
        console.log(`üõ°Ô∏è Drawdown Protector: Destroyed`);
    }
}
exports.DrawdownProtector = DrawdownProtector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL3Jpc2svRHJhd2Rvd25Qcm90ZWN0b3IudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7QUFFSCxtQ0FBc0M7QUFnRXRDLE1BQWEsaUJBQWtCLFNBQVEscUJBQVk7SUFDekMsTUFBTSxDQUEwQjtJQUNoQyxXQUFXLENBQW1CO0lBQzlCLEtBQUssQ0FBZ0I7SUFDckIsa0JBQWtCLEdBQTBCLElBQUksQ0FBQztJQUN4QyxvQkFBb0IsR0FBRyxLQUFLLENBQUMsQ0FBQyxhQUFhO0lBRTVELFlBQVksV0FBNkIsRUFBRSxNQUF5QztRQUNsRixLQUFLLEVBQUUsQ0FBQztRQUVSLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWix1QkFBdUIsRUFBRTtnQkFDdkIsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUs7Z0JBQ25CLE1BQU0sRUFBRSxJQUFJLENBQUUsS0FBSzthQUNwQjtZQUNELHVCQUF1QixFQUFFLElBQUksRUFBRSxNQUFNO1lBQ3JDLHdCQUF3QixFQUFFLENBQUM7WUFDM0Isd0JBQXdCLEVBQUUsSUFBSSxFQUFFLGdCQUFnQjtZQUNoRCxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTTtZQUM5QixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLHNCQUFzQixFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRSxXQUFXO1lBQ3hELGlCQUFpQixFQUFFO2dCQUNqQixJQUFJLEVBQUUsQ0FBQztnQkFDUCxFQUFFLEVBQUUsQ0FBQzthQUNOO1lBQ0QsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVGLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1gsYUFBYSxFQUFFLENBQUM7WUFDaEIsZ0JBQWdCLEVBQUUs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QyxPQUFPLEdBQUcsR0FBRztZQUNqQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTTtZQUMzQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQjtZQUMvQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQjtZQUN2RCxvQkFBb0IsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQjtTQUN0RCxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksT0FBTztRQUNaLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDbkQsQ0FBQztDQUNGO0FBampCRCw4Q0FpakJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1waGFzZTItaHVudGVyL3NyYy9yaXNrL0RyYXdkb3duUHJvdGVjdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRHJhd2Rvd24gUHJvdGVjdG9yIGZvciBUaXRhbiBQaGFzZSAyIC0gVGhlIEh1bnRlclxuICogXG4gKiBQcm92aWRlcyBhdXRvbWF0aWMgZHJhd2Rvd24gcHJvdGVjdGlvbiB0byBwcmVzZXJ2ZSBjYXBpdGFsIGR1cmluZyBhZHZlcnNlIGNvbmRpdGlvbnM6XG4gKiAtIERhaWx5IGRyYXdkb3duIHRocmVzaG9sZHM6IDMlLCA1JSwgNyVcbiAqIC0gV2Vla2x5IGRyYXdkb3duIHRocmVzaG9sZDogMTAlXG4gKiAtIENvbnNlY3V0aXZlIGxvc3MgcHJvdGVjdGlvbjogMyB0cmFkZXNcbiAqIC0gV2luIHJhdGUgbW9uaXRvcmluZzogNDAlIHRocmVzaG9sZCBvdmVyIDIwIHRyYWRlc1xuICogLSBFbWVyZ2VuY3kgZmxhdHRlbiBhdCA3JSBkcmF3ZG93blxuICogXG4gKiBSZXF1aXJlbWVudHM6IDE1LjEtMTUuNyAoRHJhd2Rvd24gUHJvdGVjdGlvbilcbiAqL1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgQnliaXRQZXJwc0NsaWVudCB9IGZyb20gJy4uL2V4Y2hhbmdlcy9CeWJpdFBlcnBzQ2xpZW50JztcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERyYXdkb3duUHJvdGVjdG9yQ29uZmlnIHtcbiAgZGFpbHlEcmF3ZG93blRocmVzaG9sZHM6IHtcbiAgICBsZXZlbDE6IG51bWJlcjsgLy8gMyUgLSByZWR1Y2UgcG9zaXRpb24gc2l6ZXMgYnkgNTAlXG4gICAgbGV2ZWwyOiBudW1iZXI7IC8vIDUlIC0gaGFsdCBuZXcgZW50cmllc1xuICAgIGxldmVsMzogbnVtYmVyOyAvLyA3JSAtIGVtZXJnZW5jeSBmbGF0dGVuXG4gIH07XG4gIHdlZWtseURyYXdkb3duVGhyZXNob2xkOiBudW1iZXI7IC8vIDEwJSAtIHJlZHVjZSBtYXggbGV2ZXJhZ2VcbiAgY29uc2VjdXRpdmVMb3NzVGhyZXNob2xkOiBudW1iZXI7IC8vIDMgdHJhZGVzXG4gIGNvbnNlY3V0aXZlTG9zc1JlZHVjdGlvbjogbnVtYmVyOyAvLyAzMCUgcG9zaXRpb24gc2l6ZSByZWR1Y3Rpb25cbiAgd2luUmF0ZVRocmVzaG9sZDogbnVtYmVyOyAvLyA0MCUgb3ZlciAyMCB0cmFkZXNcbiAgd2luUmF0ZVRyYWRlQ291bnQ6IG51bWJlcjsgLy8gMjAgdHJhZGVzIGZvciB3aW4gcmF0ZSBjYWxjdWxhdGlvblxuICBlbWVyZ2VuY3lQYXVzZUR1cmF0aW9uOiBudW1iZXI7IC8vIDI0IGhvdXJzIGluIG1pbGxpc2Vjb25kc1xuICBsZXZlcmFnZVJlZHVjdGlvbjoge1xuICAgIGZyb206IG51bWJlcjsgLy8gNXhcbiAgICB0bzogbnVtYmVyOyAvLyAzeFxuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyYWRlUmVjb3JkIHtcbiAgaWQ6IHN0cmluZztcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIHNpZGU6ICdMT05HJyB8ICdTSE9SVCc7XG4gIGVudHJ5UHJpY2U6IG51bWJlcjtcbiAgZXhpdFByaWNlOiBudW1iZXI7XG4gIHF1YW50aXR5OiBudW1iZXI7XG4gIHBubDogbnVtYmVyO1xuICBpc1dpbjogYm9vbGVhbjtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJhd2Rvd25TdGF0ZSB7XG4gIGN1cnJlbnRFcXVpdHk6IG51bWJlcjtcbiAgc3RhcnRPZkRheUVxdWl0eTogbnVtYmVyO1xuICBzdGFydE9mV2Vla0VxdWl0eTogbnVtYmVyO1xuICBkYWlseURyYXdkb3duOiBudW1iZXI7IC8vIFBlcmNlbnRhZ2VcbiAgd2Vla2x5RHJhd2Rvd246IG51bWJlcjsgLy8gUGVyY2VudGFnZVxuICBtYXhEYWlseURyYXdkb3duOiBudW1iZXI7XG4gIG1heFdlZWtseURyYXdkb3duOiBudW1iZXI7XG4gIGNvbnNlY3V0aXZlTG9zc2VzOiBudW1iZXI7XG4gIHJlY2VudFRyYWRlczogVHJhZGVSZWNvcmRbXTtcbiAgd2luUmF0ZTogbnVtYmVyO1xuICBpc0VtZXJnZW5jeVBhdXNlZDogYm9vbGVhbjtcbiAgZW1lcmdlbmN5UGF1c2VVbnRpbDogbnVtYmVyO1xuICBwb3NpdGlvblNpemVSZWR1Y3Rpb246IG51bWJlcjsgLy8gTXVsdGlwbGllciAoMC41ID0gNTAlIHJlZHVjdGlvbilcbiAgbWF4TGV2ZXJhZ2VSZWR1Y3Rpb246IGJvb2xlYW47XG4gIGxhc3RVcGRhdGU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEcmF3ZG93blByb3RlY3RvckV2ZW50cyB7XG4gICdkcmF3ZG93bjpsZXZlbDEnOiAoc3RhdGU6IERyYXdkb3duU3RhdGUpID0+IHZvaWQ7IC8vIDMlIC0gcmVkdWNlIHBvc2l0aW9uIHNpemVzXG4gICdkcmF3ZG93bjpsZXZlbDInOiAoc3RhdGU6IERyYXdkb3duU3RhdGUpID0+IHZvaWQ7IC8vIDUlIC0gaGFsdCBuZXcgZW50cmllc1xuICAnZHJhd2Rvd246bGV2ZWwzJzogKHN0YXRlOiBEcmF3ZG93blN0YXRlKSA9PiB2b2lkOyAvLyA3JSAtIGVtZXJnZW5jeSBmbGF0dGVuXG4gICdkcmF3ZG93bjp3ZWVrbHknOiAoc3RhdGU6IERyYXdkb3duU3RhdGUpID0+IHZvaWQ7IC8vIDEwJSAtIHJlZHVjZSBsZXZlcmFnZVxuICAnY29uc2VjdXRpdmU6bG9zc2VzJzogKHN0YXRlOiBEcmF3ZG93blN0YXRlLCBjb3VudDogbnVtYmVyKSA9PiB2b2lkO1xuICAnc3RyYXRlZ3k6ZGVncmFkYXRpb24nOiAoc3RhdGU6IERyYXdkb3duU3RhdGUsIHdpblJhdGU6IG51bWJlcikgPT4gdm9pZDtcbiAgJ2VtZXJnZW5jeTpwYXVzZWQnOiAoc3RhdGU6IERyYXdkb3duU3RhdGUsIGR1cmF0aW9uOiBudW1iZXIpID0+IHZvaWQ7XG4gICdlbWVyZ2VuY3k6cmVzdW1lZCc6IChzdGF0ZTogRHJhd2Rvd25TdGF0ZSkgPT4gdm9pZDtcbiAgJ3Byb3RlY3Rpb246YWN0aXZhdGVkJzogKHN0YXRlOiBEcmF3ZG93blN0YXRlLCBhY3Rpb246IHN0cmluZykgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIERyYXdkb3duUHJvdGVjdG9yIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcHJpdmF0ZSBjb25maWc6IERyYXdkb3duUHJvdGVjdG9yQ29uZmlnO1xuICBwcml2YXRlIGJ5Yml0Q2xpZW50OiBCeWJpdFBlcnBzQ2xpZW50O1xuICBwcml2YXRlIHN0YXRlOiBEcmF3ZG93blN0YXRlO1xuICBwcml2YXRlIG1vbml0b3JpbmdJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBNT05JVE9SSU5HX0ZSRVFVRU5DWSA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzXG5cbiAgY29uc3RydWN0b3IoYnliaXRDbGllbnQ6IEJ5Yml0UGVycHNDbGllbnQsIGNvbmZpZz86IFBhcnRpYWw8RHJhd2Rvd25Qcm90ZWN0b3JDb25maWc+KSB7XG4gICAgc3VwZXIoKTtcbiAgICBcbiAgICB0aGlzLmJ5Yml0Q2xpZW50ID0gYnliaXRDbGllbnQ7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBkYWlseURyYXdkb3duVGhyZXNob2xkczoge1xuICAgICAgICBsZXZlbDE6IDAuMDMsIC8vIDMlXG4gICAgICAgIGxldmVsMjogMC4wNSwgLy8gNSVcbiAgICAgICAgbGV2ZWwzOiAwLjA3ICAvLyA3JVxuICAgICAgfSxcbiAgICAgIHdlZWtseURyYXdkb3duVGhyZXNob2xkOiAwLjEwLCAvLyAxMCVcbiAgICAgIGNvbnNlY3V0aXZlTG9zc1RocmVzaG9sZDogMyxcbiAgICAgIGNvbnNlY3V0aXZlTG9zc1JlZHVjdGlvbjogMC4zMCwgLy8gMzAlIHJlZHVjdGlvblxuICAgICAgd2luUmF0ZVRocmVzaG9sZDogMC40MCwgLy8gNDAlXG4gICAgICB3aW5SYXRlVHJhZGVDb3VudDogMjAsXG4gICAgICBlbWVyZ2VuY3lQYXVzZUR1cmF0aW9uOiAyNCAqIDYwICogNjAgKiAxMDAwLCAvLyAyNCBob3Vyc1xuICAgICAgbGV2ZXJhZ2VSZWR1Y3Rpb246IHtcbiAgICAgICAgZnJvbTogNSxcbiAgICAgICAgdG86IDNcbiAgICAgIH0sXG4gICAgICAuLi5jb25maWdcbiAgICB9O1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBzdGF0ZVxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBjdXJyZW50RXF1aXR5OiAwLFxuICAgICAgc3RhcnRPZkRheUVxdWl0eTogMCxcbiAgICAgIHN0YXJ0T2ZXZWVrRXF1aXR5OiAwLFxuICAgICAgZGFpbHlEcmF3ZG93bjogMCxcbiAgICAgIHdlZWtseURyYXdkb3duOiAwLFxuICAgICAgbWF4RGFpbHlEcmF3ZG93bjogMCxcbiAgICAgIG1heFdlZWtseURyYXdkb3duOiAwLFxuICAgICAgY29uc2VjdXRpdmVMb3NzZXM6IDAsXG4gICAgICByZWNlbnRUcmFkZXM6IFtdLFxuICAgICAgd2luUmF0ZTogMCxcbiAgICAgIGlzRW1lcmdlbmN5UGF1c2VkOiBmYWxzZSxcbiAgICAgIGVtZXJnZW5jeVBhdXNlVW50aWw6IDAsXG4gICAgICBwb3NpdGlvblNpemVSZWR1Y3Rpb246IDEuMCwgLy8gTm8gcmVkdWN0aW9uIGluaXRpYWxseVxuICAgICAgbWF4TGV2ZXJhZ2VSZWR1Y3Rpb246IGZhbHNlLFxuICAgICAgbGFzdFVwZGF0ZTogRGF0ZS5ub3coKVxuICAgIH07XG5cbiAgICB0aGlzLnN0YXJ0TW9uaXRvcmluZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGRhaWx5IGRyYXdkb3duIGFuZCBhcHBseSBwcm90ZWN0aW9uIG1lYXN1cmVzXG4gICAqIEBwYXJhbSBjdXJyZW50RXF1aXR5IC0gQ3VycmVudCBhY2NvdW50IGVxdWl0eVxuICAgKiBAcmV0dXJucyBQcm90ZWN0aW9uIGFjdGlvbiB0YWtlblxuICAgKi9cbiAgcHVibGljIGFzeW5jIGNoZWNrRGFpbHlEcmF3ZG93bihjdXJyZW50RXF1aXR5OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXBkYXRlIGN1cnJlbnQgZXF1aXR5XG4gICAgICB0aGlzLnN0YXRlLmN1cnJlbnRFcXVpdHkgPSBjdXJyZW50RXF1aXR5O1xuXG4gICAgICAvLyBSZXNldCBkYWlseSB0cmFja2luZyBpZiBuZXcgZGF5XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgbGFzdFVwZGF0ZSA9IG5ldyBEYXRlKHRoaXMuc3RhdGUubGFzdFVwZGF0ZSk7XG4gICAgICBcbiAgICAgIGlmIChub3cuZ2V0RGF0ZSgpICE9PSBsYXN0VXBkYXRlLmdldERhdGUoKSB8fCBcbiAgICAgICAgICBub3cuZ2V0TW9udGgoKSAhPT0gbGFzdFVwZGF0ZS5nZXRNb250aCgpIHx8IFxuICAgICAgICAgIG5vdy5nZXRGdWxsWWVhcigpICE9PSBsYXN0VXBkYXRlLmdldEZ1bGxZZWFyKCkpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdGFydE9mRGF5RXF1aXR5ID0gdGhpcy5zdGF0ZS5jdXJyZW50RXF1aXR5OyAvLyBVc2UgY3VycmVudCBlcXVpdHksIG5vdCB0aGUgcGFyYW1ldGVyXG4gICAgICAgIHRoaXMuc3RhdGUuZGFpbHlEcmF3ZG93biA9IDA7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OFIE5ldyBkYXkgZGV0ZWN0ZWQuIFJlc2V0IGRhaWx5IGVxdWl0eSBiYXNlbGluZTogJHt0aGlzLnN0YXRlLmN1cnJlbnRFcXVpdHkudG9GaXhlZCgyKX0gVVNEVGApO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgZGFpbHkgZHJhd2Rvd25cbiAgICAgIGlmICh0aGlzLnN0YXRlLnN0YXJ0T2ZEYXlFcXVpdHkgPiAwKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuZGFpbHlEcmF3ZG93biA9ICh0aGlzLnN0YXRlLnN0YXJ0T2ZEYXlFcXVpdHkgLSBjdXJyZW50RXF1aXR5KSAvIHRoaXMuc3RhdGUuc3RhcnRPZkRheUVxdWl0eTtcbiAgICAgICAgdGhpcy5zdGF0ZS5tYXhEYWlseURyYXdkb3duID0gTWF0aC5tYXgodGhpcy5zdGF0ZS5tYXhEYWlseURyYXdkb3duLCB0aGlzLnN0YXRlLmRhaWx5RHJhd2Rvd24pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkcmF3ZG93blBlcmNlbnQgPSB0aGlzLnN0YXRlLmRhaWx5RHJhd2Rvd24gKiAxMDA7XG5cbiAgICAgIC8vIENoZWNrIHRocmVzaG9sZHMgKGluIG9yZGVyIG9mIHNldmVyaXR5KVxuICAgICAgaWYgKHRoaXMuc3RhdGUuZGFpbHlEcmF3ZG93biA+PSB0aGlzLmNvbmZpZy5kYWlseURyYXdkb3duVGhyZXNob2xkcy5sZXZlbDMpIHtcbiAgICAgICAgLy8gTGV2ZWwgMzogNyUgLSBFbWVyZ2VuY3kgZmxhdHRlbiBhbmQgcGF1c2VcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmlzRW1lcmdlbmN5UGF1c2VkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfmqggQ1JJVElDQUw6IERhaWx5IGRyYXdkb3duICR7ZHJhd2Rvd25QZXJjZW50LnRvRml4ZWQoMil9JSA+PSA3JS4gRW1lcmdlbmN5IGZsYXR0ZW4gdHJpZ2dlcmVkIWApO1xuICAgICAgICAgIFxuICAgICAgICAgIHRoaXMuc3RhdGUuaXNFbWVyZ2VuY3lQYXVzZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc3RhdGUuZW1lcmdlbmN5UGF1c2VVbnRpbCA9IERhdGUubm93KCkgKyB0aGlzLmNvbmZpZy5lbWVyZ2VuY3lQYXVzZUR1cmF0aW9uO1xuICAgICAgICAgIFxuICAgICAgICAgIHRoaXMuZW1pdCgnZHJhd2Rvd246bGV2ZWwzJywgdGhpcy5zdGF0ZSk7XG4gICAgICAgICAgdGhpcy5lbWl0KCdlbWVyZ2VuY3k6cGF1c2VkJywgdGhpcy5zdGF0ZSwgdGhpcy5jb25maWcuZW1lcmdlbmN5UGF1c2VEdXJhdGlvbik7XG4gICAgICAgICAgdGhpcy5sb2dQcm90ZWN0aW9uRXZlbnQoJ0VNRVJHRU5DWV9GTEFUVEVOJywgZHJhd2Rvd25QZXJjZW50KTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4gJ0VNRVJHRU5DWV9GTEFUVEVOJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmRhaWx5RHJhd2Rvd24gPj0gdGhpcy5jb25maWcuZGFpbHlEcmF3ZG93blRocmVzaG9sZHMubGV2ZWwyKSB7XG4gICAgICAgIC8vIExldmVsIDI6IDUlIC0gSGFsdCBuZXcgZW50cmllc1xuICAgICAgICBjb25zb2xlLmxvZyhg4pqg77iPIFdBUk5JTkc6IERhaWx5IGRyYXdkb3duICR7ZHJhd2Rvd25QZXJjZW50LnRvRml4ZWQoMil9JSA+PSA1JS4gSGFsdGluZyBuZXcgZW50cmllcy5gKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZW1pdCgnZHJhd2Rvd246bGV2ZWwyJywgdGhpcy5zdGF0ZSk7XG4gICAgICAgIHRoaXMubG9nUHJvdGVjdGlvbkV2ZW50KCdIQUxUX05FV19FTlRSSUVTJywgZHJhd2Rvd25QZXJjZW50KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAnSEFMVF9ORVdfRU5UUklFUyc7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUuZGFpbHlEcmF3ZG93biA+PSB0aGlzLmNvbmZpZy5kYWlseURyYXdkb3duVGhyZXNob2xkcy5sZXZlbDEpIHtcbiAgICAgICAgLy8gTGV2ZWwgMTogMyUgLSBSZWR1Y2UgcG9zaXRpb24gc2l6ZXMgYnkgNTAlXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnBvc2l0aW9uU2l6ZVJlZHVjdGlvbiA9PT0gMS4wKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKaoO+4jyBXQVJOSU5HOiBEYWlseSBkcmF3ZG93biAke2RyYXdkb3duUGVyY2VudC50b0ZpeGVkKDIpfSUgPj0gMyUuIFJlZHVjaW5nIHBvc2l0aW9uIHNpemVzIGJ5IDUwJS5gKTtcbiAgICAgICAgICBcbiAgICAgICAgICB0aGlzLnN0YXRlLnBvc2l0aW9uU2l6ZVJlZHVjdGlvbiA9IDAuNTtcbiAgICAgICAgICB0aGlzLmVtaXQoJ2RyYXdkb3duOmxldmVsMScsIHRoaXMuc3RhdGUpO1xuICAgICAgICAgIHRoaXMubG9nUHJvdGVjdGlvbkV2ZW50KCdSRURVQ0VfUE9TSVRJT05fU0laRVMnLCBkcmF3ZG93blBlcmNlbnQpO1xuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiAnUkVEVUNFX1BPU0lUSU9OX1NJWkVTJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVzZXQgcG9zaXRpb24gc2l6ZSByZWR1Y3Rpb24gaWYgZHJhd2Rvd24gaW1wcm92ZXNcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUucG9zaXRpb25TaXplUmVkdWN0aW9uIDwgMS4wKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wb3NpdGlvblNpemVSZWR1Y3Rpb24gPSAxLjA7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBEYWlseSBkcmF3ZG93biBpbXByb3ZlZCB0byAke2RyYXdkb3duUGVyY2VudC50b0ZpeGVkKDIpfSUuIFBvc2l0aW9uIHNpemUgcmVkdWN0aW9uIGxpZnRlZC5gKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIGNoZWNraW5nIGRhaWx5IGRyYXdkb3duOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3ZWVrbHkgZHJhd2Rvd24gYW5kIGFwcGx5IGxldmVyYWdlIHJlZHVjdGlvblxuICAgKiBAcGFyYW0gY3VycmVudEVxdWl0eSAtIEN1cnJlbnQgYWNjb3VudCBlcXVpdHlcbiAgICogQHJldHVybnMgUHJvdGVjdGlvbiBhY3Rpb24gdGFrZW5cbiAgICovXG4gIHB1YmxpYyBhc3luYyBjaGVja1dlZWtseURyYXdkb3duKGN1cnJlbnRFcXVpdHk6IG51bWJlcik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVcGRhdGUgY3VycmVudCBlcXVpdHlcbiAgICAgIHRoaXMuc3RhdGUuY3VycmVudEVxdWl0eSA9IGN1cnJlbnRFcXVpdHk7XG5cbiAgICAgIC8vIFJlc2V0IHdlZWtseSB0cmFja2luZyBpZiBuZXcgd2Vla1xuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IGxhc3RVcGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnN0YXRlLmxhc3RVcGRhdGUpO1xuICAgICAgY29uc3Qgbm93V2VlayA9IHRoaXMuZ2V0V2Vla051bWJlcihub3cpO1xuICAgICAgY29uc3QgbGFzdFdlZWsgPSB0aGlzLmdldFdlZWtOdW1iZXIobGFzdFVwZGF0ZSk7XG4gICAgICBcbiAgICAgIGlmIChub3dXZWVrICE9PSBsYXN0V2Vlaykge1xuICAgICAgICB0aGlzLnN0YXRlLnN0YXJ0T2ZXZWVrRXF1aXR5ID0gdGhpcy5zdGF0ZS5jdXJyZW50RXF1aXR5OyAvLyBVc2UgY3VycmVudCBlcXVpdHksIG5vdCB0aGUgcGFyYW1ldGVyXG4gICAgICAgIHRoaXMuc3RhdGUud2Vla2x5RHJhd2Rvd24gPSAwO1xuICAgICAgICB0aGlzLnN0YXRlLm1heExldmVyYWdlUmVkdWN0aW9uID0gZmFsc2U7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OFIE5ldyB3ZWVrIGRldGVjdGVkLiBSZXNldCB3ZWVrbHkgZXF1aXR5IGJhc2VsaW5lOiAke3RoaXMuc3RhdGUuY3VycmVudEVxdWl0eS50b0ZpeGVkKDIpfSBVU0RUYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB3ZWVrbHkgZHJhd2Rvd25cbiAgICAgIGlmICh0aGlzLnN0YXRlLnN0YXJ0T2ZXZWVrRXF1aXR5ID4gMCkge1xuICAgICAgICB0aGlzLnN0YXRlLndlZWtseURyYXdkb3duID0gKHRoaXMuc3RhdGUuc3RhcnRPZldlZWtFcXVpdHkgLSBjdXJyZW50RXF1aXR5KSAvIHRoaXMuc3RhdGUuc3RhcnRPZldlZWtFcXVpdHk7XG4gICAgICAgIHRoaXMuc3RhdGUubWF4V2Vla2x5RHJhd2Rvd24gPSBNYXRoLm1heCh0aGlzLnN0YXRlLm1heFdlZWtseURyYXdkb3duLCB0aGlzLnN0YXRlLndlZWtseURyYXdkb3duKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZHJhd2Rvd25QZXJjZW50ID0gdGhpcy5zdGF0ZS53ZWVrbHlEcmF3ZG93biAqIDEwMDtcblxuICAgICAgLy8gQ2hlY2sgd2Vla2x5IHRocmVzaG9sZFxuICAgICAgaWYgKHRoaXMuc3RhdGUud2Vla2x5RHJhd2Rvd24gPj0gdGhpcy5jb25maWcud2Vla2x5RHJhd2Rvd25UaHJlc2hvbGQgJiYgIXRoaXMuc3RhdGUubWF4TGV2ZXJhZ2VSZWR1Y3Rpb24pIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKaoO+4jyBXQVJOSU5HOiBXZWVrbHkgZHJhd2Rvd24gJHtkcmF3ZG93blBlcmNlbnQudG9GaXhlZCgyKX0lID49IDEwJS4gUmVkdWNpbmcgbWF4IGxldmVyYWdlIGZyb20gJHt0aGlzLmNvbmZpZy5sZXZlcmFnZVJlZHVjdGlvbi5mcm9tfXggdG8gJHt0aGlzLmNvbmZpZy5sZXZlcmFnZVJlZHVjdGlvbi50b314LmApO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zdGF0ZS5tYXhMZXZlcmFnZVJlZHVjdGlvbiA9IHRydWU7XG4gICAgICAgIHRoaXMuZW1pdCgnZHJhd2Rvd246d2Vla2x5JywgdGhpcy5zdGF0ZSk7XG4gICAgICAgIHRoaXMubG9nUHJvdGVjdGlvbkV2ZW50KCdSRURVQ0VfTUFYX0xFVkVSQUdFJywgZHJhd2Rvd25QZXJjZW50KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAnUkVEVUNFX01BWF9MRVZFUkFHRSc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRXJyb3IgY2hlY2tpbmcgd2Vla2x5IGRyYXdkb3duOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBmb3IgY29uc2VjdXRpdmUgbG9zc2VzIGFuZCBhcHBseSBwb3NpdGlvbiBzaXplIHJlZHVjdGlvblxuICAgKiBAcGFyYW0gdHJhZGVzIC0gUmVjZW50IHRyYWRlIHJlY29yZHNcbiAgICogQHJldHVybnMgUHJvdGVjdGlvbiBhY3Rpb24gdGFrZW5cbiAgICovXG4gIHB1YmxpYyBjaGVja0NvbnNlY3V0aXZlTG9zc2VzKHRyYWRlczogVHJhZGVSZWNvcmRbXSk6IHN0cmluZyB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICAvLyBTb3J0IHRyYWRlcyBieSB0aW1lc3RhbXAgKG1vc3QgcmVjZW50IGZpcnN0KVxuICAgICAgY29uc3Qgc29ydGVkVHJhZGVzID0gdHJhZGVzLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wIC0gYS50aW1lc3RhbXApO1xuICAgICAgXG4gICAgICAvLyBDb3VudCBjb25zZWN1dGl2ZSBsb3NzZXMgZnJvbSBtb3N0IHJlY2VudCB0cmFkZXNcbiAgICAgIGxldCBjb25zZWN1dGl2ZUxvc3NlcyA9IDA7XG4gICAgICBmb3IgKGNvbnN0IHRyYWRlIG9mIHNvcnRlZFRyYWRlcykge1xuICAgICAgICBpZiAoIXRyYWRlLmlzV2luKSB7XG4gICAgICAgICAgY29uc2VjdXRpdmVMb3NzZXMrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBicmVhazsgLy8gU3RvcCBhdCBmaXJzdCB3aW5cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnN0YXRlLmNvbnNlY3V0aXZlTG9zc2VzID0gY29uc2VjdXRpdmVMb3NzZXM7XG5cbiAgICAgIC8vIENoZWNrIHRocmVzaG9sZFxuICAgICAgaWYgKGNvbnNlY3V0aXZlTG9zc2VzID49IHRoaXMuY29uZmlnLmNvbnNlY3V0aXZlTG9zc1RocmVzaG9sZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhg4pqg77iPIFdBUk5JTkc6ICR7Y29uc2VjdXRpdmVMb3NzZXN9IGNvbnNlY3V0aXZlIGxvc3NlcyBkZXRlY3RlZC4gUmVkdWNpbmcgcG9zaXRpb24gc2l6ZXMgYnkgJHt0aGlzLmNvbmZpZy5jb25zZWN1dGl2ZUxvc3NSZWR1Y3Rpb24gKiAxMDB9JSBmb3IgbmV4dCAzIHRyYWRlcy5gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFwcGx5IGFkZGl0aW9uYWwgcmVkdWN0aW9uIGZvciBjb25zZWN1dGl2ZSBsb3NzZXNcbiAgICAgICAgY29uc3QgcmVkdWN0aW9uTXVsdGlwbGllciA9IDEgLSB0aGlzLmNvbmZpZy5jb25zZWN1dGl2ZUxvc3NSZWR1Y3Rpb247XG4gICAgICAgIHRoaXMuc3RhdGUucG9zaXRpb25TaXplUmVkdWN0aW9uID0gTWF0aC5taW4odGhpcy5zdGF0ZS5wb3NpdGlvblNpemVSZWR1Y3Rpb24sIHJlZHVjdGlvbk11bHRpcGxpZXIpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5lbWl0KCdjb25zZWN1dGl2ZTpsb3NzZXMnLCB0aGlzLnN0YXRlLCBjb25zZWN1dGl2ZUxvc3Nlcyk7XG4gICAgICAgIHRoaXMubG9nUHJvdGVjdGlvbkV2ZW50KCdDT05TRUNVVElWRV9MT1NTRVMnLCBjb25zZWN1dGl2ZUxvc3Nlcyk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gJ0NPTlNFQ1VUSVZFX0xPU1NFUyc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRXJyb3IgY2hlY2tpbmcgY29uc2VjdXRpdmUgbG9zc2VzOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aW4gcmF0ZSBvdmVyIGxhc3QgMjAgdHJhZGVzIGFuZCBlbWl0IHdhcm5pbmcgaWYgYmVsb3cgNDAlXG4gICAqIEBwYXJhbSB0cmFkZXMgLSBSZWNlbnQgdHJhZGUgcmVjb3Jkc1xuICAgKiBAcmV0dXJucyBQcm90ZWN0aW9uIGFjdGlvbiB0YWtlblxuICAgKi9cbiAgcHVibGljIGNoZWNrV2luUmF0ZSh0cmFkZXM6IFRyYWRlUmVjb3JkW10pOiBzdHJpbmcgfCBudWxsIHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGxhc3QgTiB0cmFkZXMgZm9yIHdpbiByYXRlIGNhbGN1bGF0aW9uXG4gICAgICBjb25zdCByZWNlbnRUcmFkZXMgPSB0cmFkZXNcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wIC0gYS50aW1lc3RhbXApXG4gICAgICAgIC5zbGljZSgwLCB0aGlzLmNvbmZpZy53aW5SYXRlVHJhZGVDb3VudCk7XG5cbiAgICAgIGlmIChyZWNlbnRUcmFkZXMubGVuZ3RoIDwgdGhpcy5jb25maWcud2luUmF0ZVRyYWRlQ291bnQpIHtcbiAgICAgICAgLy8gTm90IGVub3VnaCB0cmFkZXMgZm9yIG1lYW5pbmdmdWwgd2luIHJhdGUgY2FsY3VsYXRpb25cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB3aW4gcmF0ZVxuICAgICAgY29uc3Qgd2lucyA9IHJlY2VudFRyYWRlcy5maWx0ZXIodHJhZGUgPT4gdHJhZGUuaXNXaW4pLmxlbmd0aDtcbiAgICAgIGNvbnN0IHdpblJhdGUgPSB3aW5zIC8gcmVjZW50VHJhZGVzLmxlbmd0aDtcbiAgICAgIHRoaXMuc3RhdGUud2luUmF0ZSA9IHdpblJhdGU7XG5cbiAgICAgIC8vIENoZWNrIHRocmVzaG9sZFxuICAgICAgaWYgKHdpblJhdGUgPCB0aGlzLmNvbmZpZy53aW5SYXRlVGhyZXNob2xkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDimqDvuI8gU1RSQVRFR1kgREVHUkFEQVRJT046IFdpbiByYXRlICR7KHdpblJhdGUgKiAxMDApLnRvRml4ZWQoMSl9JSA8ICR7dGhpcy5jb25maWcud2luUmF0ZVRocmVzaG9sZCAqIDEwMH0lIG92ZXIgbGFzdCAke3JlY2VudFRyYWRlcy5sZW5ndGh9IHRyYWRlcy4gUGFyYW1ldGVyIHJldmlldyBzdWdnZXN0ZWQuYCk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmVtaXQoJ3N0cmF0ZWd5OmRlZ3JhZGF0aW9uJywgdGhpcy5zdGF0ZSwgd2luUmF0ZSk7XG4gICAgICAgIHRoaXMubG9nUHJvdGVjdGlvbkV2ZW50KCdTVFJBVEVHWV9ERUdSQURBVElPTicsIHdpblJhdGUgKiAxMDApO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuICdTVFJBVEVHWV9ERUdSQURBVElPTic7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRXJyb3IgY2hlY2tpbmcgd2luIHJhdGU6YCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVtZXJnZW5jeSBmbGF0dGVuIGFsbCBwb3NpdGlvbnMgYW5kIHBhdXNlIHRyYWRpbmdcbiAgICogQHBhcmFtIHBvc2l0aW9ucyAtIEFsbCBvcGVuIHBvc2l0aW9uc1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBlbWVyZ2VuY3lGbGF0dGVuKHBvc2l0aW9uczogUG9zaXRpb25bXSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+aqCBFTUVSR0VOQ1kgRkxBVFRFTjogQ2xvc2luZyAke3Bvc2l0aW9ucy5sZW5ndGh9IHBvc2l0aW9uc2ApO1xuICAgICAgXG4gICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMDtcbiAgICAgIGxldCBmYWlsQ291bnQgPSAwO1xuXG4gICAgICAvLyBDbG9zZSBhbGwgcG9zaXRpb25zIHdpdGggbWFya2V0IG9yZGVyc1xuICAgICAgZm9yIChjb25zdCBwb3NpdGlvbiBvZiBwb3NpdGlvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBvcmRlclBhcmFtcyA9IHtcbiAgICAgICAgICAgIHBoYXNlOiAncGhhc2UyJyBhcyBjb25zdCxcbiAgICAgICAgICAgIHN5bWJvbDogcG9zaXRpb24uc3ltYm9sLFxuICAgICAgICAgICAgc2lkZTogcG9zaXRpb24uc2lkZSA9PT0gJ0xPTkcnID8gJ1NlbGwnIGFzIGNvbnN0IDogJ0J1eScgYXMgY29uc3QsXG4gICAgICAgICAgICB0eXBlOiAnTUFSS0VUJyBhcyBjb25zdCxcbiAgICAgICAgICAgIHF0eTogcG9zaXRpb24ucXVhbnRpdHksXG4gICAgICAgICAgICBsZXZlcmFnZTogcG9zaXRpb24ubGV2ZXJhZ2VcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5ieWJpdENsaWVudC5wbGFjZU9yZGVyV2l0aFJldHJ5KG9yZGVyUGFyYW1zKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gJ0ZJTExFRCcpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3NDb3VudCsrO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYOKchSBFbWVyZ2VuY3kgY2xvc2VkOiAke3Bvc2l0aW9uLnN5bWJvbH0gYXQgJHtyZXN1bHQucHJpY2V9YCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZhaWxDb3VudCsrO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBlbWVyZ2VuY3kgY2xvc2U6ICR7cG9zaXRpb24uc3ltYm9sfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBmYWlsQ291bnQrKztcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGDinYwgRXJyb3IgY2xvc2luZyBwb3NpdGlvbiAke3Bvc2l0aW9uLnN5bWJvbH06YCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBlbWVyZ2VuY3kgcGF1c2VcbiAgICAgIHRoaXMuc3RhdGUuaXNFbWVyZ2VuY3lQYXVzZWQgPSB0cnVlO1xuICAgICAgdGhpcy5zdGF0ZS5lbWVyZ2VuY3lQYXVzZVVudGlsID0gRGF0ZS5ub3coKSArIHRoaXMuY29uZmlnLmVtZXJnZW5jeVBhdXNlRHVyYXRpb247XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn5qoIEVtZXJnZW5jeSBmbGF0dGVuIGNvbXBsZXRlOiAke3N1Y2Nlc3NDb3VudH0gc3VjY2VzcywgJHtmYWlsQ291bnR9IGZhaWxlZGApO1xuICAgICAgY29uc29sZS5sb2coYOKPuO+4jyBUcmFkaW5nIHBhdXNlZCBmb3IgJHt0aGlzLmNvbmZpZy5lbWVyZ2VuY3lQYXVzZUR1cmF0aW9uIC8gKDEwMDAgKiA2MCAqIDYwKX0gaG91cnNgKTtcblxuICAgICAgdGhpcy5sb2dQcm90ZWN0aW9uRXZlbnQoJ0VNRVJHRU5DWV9GTEFUVEVOX0NPTVBMRVRFJywgc3VjY2Vzc0NvdW50KTtcblxuICAgICAgcmV0dXJuIGZhaWxDb3VudCA9PT0gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIGluIGVtZXJnZW5jeSBmbGF0dGVuOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgY29tcGxldGVkIHRyYWRlIHRvIHRoZSB0cmFja2luZyBzeXN0ZW1cbiAgICogQHBhcmFtIHRyYWRlIC0gVHJhZGUgcmVjb3JkIHRvIGFkZFxuICAgKi9cbiAgcHVibGljIGFkZFRyYWRlKHRyYWRlOiBUcmFkZVJlY29yZCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUucmVjZW50VHJhZGVzLnB1c2godHJhZGUpO1xuICAgIFxuICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMCB0cmFkZXMgZm9yIG1lbW9yeSBlZmZpY2llbmN5XG4gICAgaWYgKHRoaXMuc3RhdGUucmVjZW50VHJhZGVzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5zdGF0ZS5yZWNlbnRUcmFkZXMgPSB0aGlzLnN0YXRlLnJlY2VudFRyYWRlcy5zbGljZSgtMTAwKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+TiiBUcmFkZSByZWNvcmRlZDogJHt0cmFkZS5zeW1ib2x9ICR7dHJhZGUuc2lkZX0gJHt0cmFkZS5pc1dpbiA/ICdXSU4nIDogJ0xPU1MnfSBQJkw6ICR7dHJhZGUucG5sLnRvRml4ZWQoMil9YCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgY29uc2VjdXRpdmUgbG9zc2VzIGFuZCB3aW4gcmF0ZSBhZnRlciBlYWNoIHRyYWRlXG4gICAgdGhpcy5jaGVja0NvbnNlY3V0aXZlTG9zc2VzKHRoaXMuc3RhdGUucmVjZW50VHJhZGVzKTtcbiAgICB0aGlzLmNoZWNrV2luUmF0ZSh0aGlzLnN0YXRlLnJlY2VudFRyYWRlcyk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdGFydCBvZiBkYXkgZXF1aXR5IChmb3IgdGVzdGluZyBwdXJwb3NlcylcbiAgICogQHBhcmFtIGVxdWl0eSAtIFN0YXJ0aW5nIGVxdWl0eSBmb3IgdGhlIGRheVxuICAgKi9cbiAgcHVibGljIHNldFN0YXJ0T2ZEYXlFcXVpdHkoZXF1aXR5OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlLnN0YXJ0T2ZEYXlFcXVpdHkgPSBlcXVpdHk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdGFydCBvZiB3ZWVrIGVxdWl0eSAoZm9yIHRlc3RpbmcgcHVycG9zZXMpXG4gICAqIEBwYXJhbSBlcXVpdHkgLSBTdGFydGluZyBlcXVpdHkgZm9yIHRoZSB3ZWVrXG4gICAqL1xuICBwdWJsaWMgc2V0U3RhcnRPZldlZWtFcXVpdHkoZXF1aXR5OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlLnN0YXJ0T2ZXZWVrRXF1aXR5ID0gZXF1aXR5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGRyYXdkb3duIHN0YXRlXG4gICAqIEByZXR1cm5zIEN1cnJlbnQgZHJhd2Rvd24gc3RhdGVcbiAgICovXG4gIHB1YmxpYyBnZXRTdGF0ZSgpOiBEcmF3ZG93blN0YXRlIHtcbiAgICByZXR1cm4geyAuLi50aGlzLnN0YXRlIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdHJhZGluZyBpcyBjdXJyZW50bHkgcGF1c2VkIGR1ZSB0byBlbWVyZ2VuY3lcbiAgICogQHJldHVybnMgVHJ1ZSBpZiB0cmFkaW5nIGlzIHBhdXNlZFxuICAgKi9cbiAgcHVibGljIGlzRW1lcmdlbmN5UGF1c2VkKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLnN0YXRlLmlzRW1lcmdlbmN5UGF1c2VkICYmIERhdGUubm93KCkgPiB0aGlzLnN0YXRlLmVtZXJnZW5jeVBhdXNlVW50aWwpIHtcbiAgICAgIC8vIEVtZXJnZW5jeSBwYXVzZSBwZXJpb2QgaGFzIGVuZGVkXG4gICAgICB0aGlzLnN0YXRlLmlzRW1lcmdlbmN5UGF1c2VkID0gZmFsc2U7XG4gICAgICB0aGlzLnN0YXRlLmVtZXJnZW5jeVBhdXNlVW50aWwgPSAwO1xuICAgICAgY29uc29sZS5sb2coYOKchSBFbWVyZ2VuY3kgcGF1c2UgbGlmdGVkLiBUcmFkaW5nIHJlc3VtZWQuYCk7XG4gICAgICB0aGlzLmVtaXQoJ2VtZXJnZW5jeTpyZXN1bWVkJywgdGhpcy5zdGF0ZSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLnN0YXRlLmlzRW1lcmdlbmN5UGF1c2VkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHBvc2l0aW9uIHNpemUgbXVsdGlwbGllciBiYXNlZCBvbiBkcmF3ZG93biBwcm90ZWN0aW9uXG4gICAqIEByZXR1cm5zIFBvc2l0aW9uIHNpemUgbXVsdGlwbGllciAoMC41ID0gNTAlIHJlZHVjdGlvbilcbiAgICovXG4gIHB1YmxpYyBnZXRQb3NpdGlvblNpemVNdWx0aXBsaWVyKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUucG9zaXRpb25TaXplUmVkdWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IG1heGltdW0gbGV2ZXJhZ2UgYmFzZWQgb24gd2Vla2x5IGRyYXdkb3duXG4gICAqIEByZXR1cm5zIE1heGltdW0gbGV2ZXJhZ2UgYWxsb3dlZFxuICAgKi9cbiAgcHVibGljIGdldE1heExldmVyYWdlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUubWF4TGV2ZXJhZ2VSZWR1Y3Rpb24gXG4gICAgICA/IHRoaXMuY29uZmlnLmxldmVyYWdlUmVkdWN0aW9uLnRvIFxuICAgICAgOiB0aGlzLmNvbmZpZy5sZXZlcmFnZVJlZHVjdGlvbi5mcm9tO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIG5ldyBlbnRyaWVzIGFyZSBhbGxvd2VkXG4gICAqIEByZXR1cm5zIFRydWUgaWYgbmV3IGVudHJpZXMgYXJlIGFsbG93ZWRcbiAgICovXG4gIHB1YmxpYyBjYW5PcGVuTmV3UG9zaXRpb25zKCk6IGJvb2xlYW4ge1xuICAgIC8vIEJsb2NrIG5ldyBlbnRyaWVzIGlmOlxuICAgIC8vIDEuIEVtZXJnZW5jeSBwYXVzZWRcbiAgICAvLyAyLiBEYWlseSBkcmF3ZG93biA+PSA1JVxuICAgIHJldHVybiAhdGhpcy5pc0VtZXJnZW5jeVBhdXNlZCgpICYmIFxuICAgICAgICAgICB0aGlzLnN0YXRlLmRhaWx5RHJhd2Rvd24gPCB0aGlzLmNvbmZpZy5kYWlseURyYXdkb3duVGhyZXNob2xkcy5sZXZlbDI7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgbW9uaXRvcmluZyBkcmF3ZG93biBwcm90ZWN0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0TW9uaXRvcmluZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpO1xuICAgIH1cblxuICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVEcmF3ZG93blN0YXRlKCk7XG4gICAgfSwgdGhpcy5NT05JVE9SSU5HX0ZSRVFVRU5DWSk7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+boe+4jyBEcmF3ZG93biBQcm90ZWN0b3I6IFN0YXJ0ZWQgbW9uaXRvcmluZyAoJHt0aGlzLk1PTklUT1JJTkdfRlJFUVVFTkNZIC8gMTAwMH1zIGludGVydmFsKWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgbW9uaXRvcmluZyBkcmF3ZG93biBwcm90ZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgc3RvcE1vbml0b3JpbmcoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubW9uaXRvcmluZ0ludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMubW9uaXRvcmluZ0ludGVydmFsKTtcbiAgICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgY29uc29sZS5sb2coYPCfm6HvuI8gRHJhd2Rvd24gUHJvdGVjdG9yOiBTdG9wcGVkIG1vbml0b3JpbmdgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZHJhd2Rvd24gc3RhdGUgd2l0aCBjdXJyZW50IGVxdWl0eVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVEcmF3ZG93blN0YXRlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50RXF1aXR5ID0gYXdhaXQgdGhpcy5ieWJpdENsaWVudC5nZXRFcXVpdHkoKTtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSBiYXNlbGluZXMgaWYgbm90IHNldFxuICAgICAgaWYgKHRoaXMuc3RhdGUuc3RhcnRPZkRheUVxdWl0eSA9PT0gMCkge1xuICAgICAgICB0aGlzLnN0YXRlLnN0YXJ0T2ZEYXlFcXVpdHkgPSBjdXJyZW50RXF1aXR5O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc3RhdGUuc3RhcnRPZldlZWtFcXVpdHkgPT09IDApIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdGFydE9mV2Vla0VxdWl0eSA9IGN1cnJlbnRFcXVpdHk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGFsbCBwcm90ZWN0aW9uIG1lYXN1cmVzXG4gICAgICBhd2FpdCB0aGlzLmNoZWNrRGFpbHlEcmF3ZG93bihjdXJyZW50RXF1aXR5KTtcbiAgICAgIGF3YWl0IHRoaXMuY2hlY2tXZWVrbHlEcmF3ZG93bihjdXJyZW50RXF1aXR5KTtcbiAgICAgIFxuICAgICAgdGhpcy5zdGF0ZS5sYXN0VXBkYXRlID0gRGF0ZS5ub3coKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIHVwZGF0aW5nIGRyYXdkb3duIHN0YXRlOmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdlZWsgbnVtYmVyIGZvciBkYXRlXG4gICAqIEBwYXJhbSBkYXRlIC0gRGF0ZSB0byBnZXQgd2VlayBudW1iZXIgZm9yXG4gICAqIEByZXR1cm5zIFdlZWsgbnVtYmVyXG4gICAqL1xuICBwcml2YXRlIGdldFdlZWtOdW1iZXIoZGF0ZTogRGF0ZSk6IG51bWJlciB7XG4gICAgY29uc3QgZmlyc3REYXlPZlllYXIgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICAgIGNvbnN0IHBhc3REYXlzT2ZZZWFyID0gKGRhdGUuZ2V0VGltZSgpIC0gZmlyc3REYXlPZlllYXIuZ2V0VGltZSgpKSAvIDg2NDAwMDAwO1xuICAgIHJldHVybiBNYXRoLmNlaWwoKHBhc3REYXlzT2ZZZWFyICsgZmlyc3REYXlPZlllYXIuZ2V0RGF5KCkgKyAxKSAvIDcpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBkcmF3ZG93biBwcm90ZWN0aW9uIGV2ZW50XG4gICAqIEBwYXJhbSBhY3Rpb24gLSBBY3Rpb24gdGFrZW5cbiAgICogQHBhcmFtIHZhbHVlIC0gQXNzb2NpYXRlZCB2YWx1ZSAocGVyY2VudGFnZSwgY291bnQsIGV0Yy4pXG4gICAqL1xuICBwcml2YXRlIGxvZ1Byb3RlY3Rpb25FdmVudChhY3Rpb246IHN0cmluZywgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IGV2ZW50ID0ge1xuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdHlwZTogJ0RSQVdET1dOX1BST1RFQ1RJT04nLFxuICAgICAgYWN0aW9uLFxuICAgICAgdmFsdWUsXG4gICAgICBjdXJyZW50RXF1aXR5OiB0aGlzLnN0YXRlLmN1cnJlbnRFcXVpdHksXG4gICAgICBkYWlseURyYXdkb3duOiB0aGlzLnN0YXRlLmRhaWx5RHJhd2Rvd24gKiAxMDAsXG4gICAgICB3ZWVrbHlEcmF3ZG93bjogdGhpcy5zdGF0ZS53ZWVrbHlEcmF3ZG93biAqIDEwMCxcbiAgICAgIGNvbnNlY3V0aXZlTG9zc2VzOiB0aGlzLnN0YXRlLmNvbnNlY3V0aXZlTG9zc2VzLFxuICAgICAgd2luUmF0ZTogdGhpcy5zdGF0ZS53aW5SYXRlICogMTAwXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5uh77iPIERSQVdET1dOX1BST1RFQ1RJT046YCwgSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTtcbiAgICB0aGlzLmVtaXQoJ3Byb3RlY3Rpb246YWN0aXZhdGVkJywgdGhpcy5zdGF0ZSwgYWN0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0gbmV3Q29uZmlnIC0gTmV3IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPERyYXdkb3duUHJvdGVjdG9yQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4ubmV3Q29uZmlnIH07XG4gICAgY29uc29sZS5sb2coYPCfm6HvuI8gRHJhd2Rvd24gUHJvdGVjdG9yOiBDb25maWd1cmF0aW9uIHVwZGF0ZWRgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBkcmF3ZG93biBzdGF0ZSAoZm9yIHRlc3Rpbmcgb3IgbWFudWFsIHJlc2V0KVxuICAgKi9cbiAgcHVibGljIHJlc2V0U3RhdGUoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGN1cnJlbnRFcXVpdHk6IDAsXG4gICAgICBzdGFydE9mRGF5RXF1aXR5OiAwLFxuICAgICAgc3RhcnRPZldlZWtFcXVpdHk6IDAsXG4gICAgICBkYWlseURyYXdkb3duOiAwLFxuICAgICAgd2Vla2x5RHJhd2Rvd246IDAsXG4gICAgICBtYXhEYWlseURyYXdkb3duOiAwLFxuICAgICAgbWF4V2Vla2x5RHJhd2Rvd246IDAsXG4gICAgICBjb25zZWN1dGl2ZUxvc3NlczogMCxcbiAgICAgIHJlY2VudFRyYWRlczogW10sXG4gICAgICB3aW5SYXRlOiAwLFxuICAgICAgaXNFbWVyZ2VuY3lQYXVzZWQ6IGZhbHNlLFxuICAgICAgZW1lcmdlbmN5UGF1c2VVbnRpbDogMCxcbiAgICAgIHBvc2l0aW9uU2l6ZVJlZHVjdGlvbjogMS4wLFxuICAgICAgbWF4TGV2ZXJhZ2VSZWR1Y3Rpb246IGZhbHNlLFxuICAgICAgbGFzdFVwZGF0ZTogRGF0ZS5ub3coKVxuICAgIH07XG4gICAgY29uc29sZS5sb2coYPCfm6HvuI8gRHJhd2Rvd24gUHJvdGVjdG9yOiBTdGF0ZSByZXNldGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzdGF0aXN0aWNzIGZvciBtb25pdG9yaW5nXG4gICAqIEByZXR1cm5zIERyYXdkb3duIHN0YXRpc3RpY3NcbiAgICovXG4gIHB1YmxpYyBnZXRTdGF0aXN0aWNzKCk6IHtcbiAgICBkYWlseURyYXdkb3duOiBudW1iZXI7XG4gICAgd2Vla2x5RHJhd2Rvd246IG51bWJlcjtcbiAgICBtYXhEYWlseURyYXdkb3duOiBudW1iZXI7XG4gICAgbWF4V2Vla2x5RHJhd2Rvd246IG51bWJlcjtcbiAgICBjb25zZWN1dGl2ZUxvc3NlczogbnVtYmVyO1xuICAgIHdpblJhdGU6IG51bWJlcjtcbiAgICB0b3RhbFRyYWRlczogbnVtYmVyO1xuICAgIGlzRW1lcmdlbmN5UGF1c2VkOiBib29sZWFuO1xuICAgIHBvc2l0aW9uU2l6ZVJlZHVjdGlvbjogbnVtYmVyO1xuICAgIG1heExldmVyYWdlUmVkdWN0aW9uOiBib29sZWFuO1xuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgZGFpbHlEcmF3ZG93bjogdGhpcy5zdGF0ZS5kYWlseURyYXdkb3duICogMTAwLFxuICAgICAgd2Vla2x5RHJhd2Rvd246IHRoaXMuc3RhdGUud2Vla2x5RHJhd2Rvd24gKiAxMDAsXG4gICAgICBtYXhEYWlseURyYXdkb3duOiB0aGlzLnN0YXRlLm1heERhaWx5RHJhd2Rvd24gKiAxMDAsXG4gICAgICBtYXhXZWVrbHlEcmF3ZG93bjogdGhpcy5zdGF0ZS5tYXhXZWVrbHlEcmF3ZG93biAqIDEwMCxcbiAgICAgIGNvbnNlY3V0aXZlTG9zc2VzOiB0aGlzLnN0YXRlLmNvbnNlY3V0aXZlTG9zc2VzLFxuICAgICAgd2luUmF0ZTogdGhpcy5zdGF0ZS53aW5SYXRlICogMTAwLFxuICAgICAgdG90YWxUcmFkZXM6IHRoaXMuc3RhdGUucmVjZW50VHJhZGVzLmxlbmd0aCxcbiAgICAgIGlzRW1lcmdlbmN5UGF1c2VkOiB0aGlzLnN0YXRlLmlzRW1lcmdlbmN5UGF1c2VkLFxuICAgICAgcG9zaXRpb25TaXplUmVkdWN0aW9uOiB0aGlzLnN0YXRlLnBvc2l0aW9uU2l6ZVJlZHVjdGlvbixcbiAgICAgIG1heExldmVyYWdlUmVkdWN0aW9uOiB0aGlzLnN0YXRlLm1heExldmVyYWdlUmVkdWN0aW9uXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIHJlc291cmNlc1xuICAgKi9cbiAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wTW9uaXRvcmluZygpO1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgY29uc29sZS5sb2coYPCfm6HvuI8gRHJhd2Rvd24gUHJvdGVjdG9yOiBEZXN0cm95ZWRgKTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgZXZlbnQgaW50ZXJmYWNlIGZvciBUeXBlU2NyaXB0XG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgRHJhd2Rvd25Qcm90ZWN0b3Ige1xuICBvbjxVIGV4dGVuZHMga2V5b2YgRHJhd2Rvd25Qcm90ZWN0b3JFdmVudHM+KGV2ZW50OiBVLCBsaXN0ZW5lcjogRHJhd2Rvd25Qcm90ZWN0b3JFdmVudHNbVV0pOiB0aGlzO1xuICBlbWl0PFUgZXh0ZW5kcyBrZXlvZiBEcmF3ZG93blByb3RlY3RvckV2ZW50cz4oZXZlbnQ6IFUsIC4uLmFyZ3M6IFBhcmFtZXRlcnM8RHJhd2Rvd25Qcm90ZWN0b3JFdmVudHNbVV0+KTogYm9vbGVhbjtcbn0iXSwidmVyc2lvbiI6M30=