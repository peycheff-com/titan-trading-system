5e114975eb8867da72e4a70e84f91e6f
"use strict";
/**
 * Jest setup file for Titan Phase 2 Hunter tests
 * Runs after the test framework is set up but before each test file
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock crypto for HMAC signatures in tests
jest.mock('crypto', () => ({
    createHmac: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnThis(),
        digest: jest.fn().mockReturnValue('mocked-signature'),
    }),
    randomBytes: jest.fn().mockReturnValue(Buffer.from('mocked-random-16-bytes')),
    pbkdf2Sync: jest.fn().mockReturnValue(Buffer.from('mocked-derived-key-32-bytes-long')),
    createCipheriv: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnValue(Buffer.from('encrypted-data')),
        final: jest.fn().mockReturnValue(Buffer.from('final-encrypted')),
    }),
    createDecipheriv: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnValue(Buffer.from('decrypted-data')),
        final: jest.fn().mockReturnValue(Buffer.from('final-decrypted')),
    }),
}));
// Extend Jest matchers for better assertions
require("jest-extended");
// Configure Ink testing library for terminal UI components
const ink_testing_library_1 = require("ink-testing-library");
(0, ink_testing_library_1.configure)({
    // Increase timeout for complex UI rendering
    timeout: 5000
});
// Mock console methods to reduce noise in tests (but keep errors for debugging)
const originalConsole = global.console;
global.console = {
    ...console,
    // Keep error and warn for debugging critical issues
    error: process.env.DEBUG_TESTS ? originalConsole.error : jest.fn(),
    warn: process.env.DEBUG_TESTS ? originalConsole.warn : jest.fn(),
    log: jest.fn(),
    debug: jest.fn(),
    info: jest.fn(),
};
// Mock WebSocket for tests
global.WebSocket = jest.fn().mockImplementation(() => ({
    send: jest.fn(),
    close: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    readyState: 1, // OPEN
}));
// Mock fetch for API calls
global.fetch = jest.fn();
// Set default test timeout for property-based tests
jest.setTimeout(10000);
// Mock environment variables
process.env.NODE_ENV = 'test';
process.env.BINANCE_API_KEY = 'test-binance-key';
process.env.BINANCE_API_SECRET = 'test-binance-secret';
process.env.BYBIT_API_KEY = 'test-bybit-key';
process.env.BYBIT_API_SECRET = 'test-bybit-secret';
// Custom matchers for trading system tests
expect.extend({
    toBeWithinRange(received, floor, ceiling) {
        const pass = received >= floor && received <= ceiling;
        if (pass) {
            return {
                message: () => `expected ${received} not to be within range ${floor} - ${ceiling}`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be within range ${floor} - ${ceiling}`,
                pass: false,
            };
        }
    },
    toBeValidHologramState(received) {
        const requiredFields = ['dailyBias', 'fourHourLocation', 'fifteenMinTrigger', 'alignmentScore'];
        const hasAllFields = requiredFields.every(field => received.hasOwnProperty(field));
        const validScore = received.alignmentScore >= 0 && received.alignmentScore <= 100;
        const pass = hasAllFields && validScore;
        if (pass) {
            return {
                message: () => `expected ${JSON.stringify(received)} not to be a valid hologram state`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${JSON.stringify(received)} to be a valid hologram state`,
                pass: false,
            };
        }
    },
    toBeValidSignal(received) {
        const requiredFields = ['symbol', 'side', 'confidence', 'entry', 'stopLoss', 'takeProfit'];
        const hasAllFields = requiredFields.every(field => received.hasOwnProperty(field));
        const validSide = ['Buy', 'Sell'].includes(received.side);
        const validConfidence = received.confidence >= 0 && received.confidence <= 100;
        const pass = hasAllFields && validSide && validConfidence;
        if (pass) {
            return {
                message: () => `expected ${JSON.stringify(received)} not to be a valid signal`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${JSON.stringify(received)} to be a valid signal`,
                pass: false,
            };
        }
    },
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvdGVzdHMvc2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUF3Q0gsMkNBQTJDO0FBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDcEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7UUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUM7S0FDdEQsQ0FBQztJQUNGLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUM3RSxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFDdEYsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDeEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hFLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztLQUNqRSxDQUFDO0lBQ0YsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztRQUMxQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixD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RCxNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsVUFBVSxJQUFJLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQztRQUUvRSxNQUFNLElBQUksR0FBRyxZQUFZLElBQUksU0FBUyxJQUFJLGVBQWUsQ0FBQztRQUMxRCxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQywyQkFBMkI7Z0JBQzlFLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztRQUNKLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTztnQkFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyx1QkFBdUI7Z0JBQzFFLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1waGFzZTItaHVudGVyL3Rlc3RzL3NldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSmVzdCBzZXR1cCBmaWxlIGZvciBUaXRhbiBQaGFzZSAyIEh1bnRlciB0ZXN0c1xuICogUnVucyBhZnRlciB0aGUgdGVzdCBmcmFtZXdvcmsgaXMgc2V0IHVwIGJ1dCBiZWZvcmUgZWFjaCB0ZXN0IGZpbGVcbiAqL1xuXG4vLyBFeHRlbmQgSmVzdCBtYXRjaGVycyBmb3IgYmV0dGVyIGFzc2VydGlvbnNcbmltcG9ydCAnamVzdC1leHRlbmRlZCc7XG5cbi8vIENvbmZpZ3VyZSBJbmsgdGVzdGluZyBsaWJyYXJ5IGZvciB0ZXJtaW5hbCBVSSBjb21wb25lbnRzXG5pbXBvcnQgeyBjb25maWd1cmUgfSBmcm9tICdpbmstdGVzdGluZy1saWJyYXJ5JztcblxuY29uZmlndXJlKHtcbiAgLy8gSW5jcmVhc2UgdGltZW91dCBmb3IgY29tcGxleCBVSSByZW5kZXJpbmdcbiAgdGltZW91dDogNTAwMFxufSk7XG5cbi8vIE1vY2sgY29uc29sZSBtZXRob2RzIHRvIHJlZHVjZSBub2lzZSBpbiB0ZXN0cyAoYnV0IGtlZXAgZXJyb3JzIGZvciBkZWJ1Z2dpbmcpXG5jb25zdCBvcmlnaW5hbENvbnNvbGUgPSBnbG9iYWwuY29uc29sZTtcbmdsb2JhbC5jb25zb2xlID0ge1xuICAuLi5jb25zb2xlLFxuICAvLyBLZWVwIGVycm9yIGFuZCB3YXJuIGZvciBkZWJ1Z2dpbmcgY3JpdGljYWwgaXNzdWVzXG4gIGVycm9yOiBwcm9jZXNzLmVudi5ERUJVR19URVNUUyA/IG9yaWdpbmFsQ29uc29sZS5lcnJvciA6IGplc3QuZm4oKSxcbiAgd2FybjogcHJvY2Vzcy5lbnYuREVCVUdfVEVTVFMgPyBvcmlnaW5hbENvbnNvbGUud2FybiA6IGplc3QuZm4oKSxcbiAgbG9nOiBqZXN0LmZuKCksXG4gIGRlYnVnOiBqZXN0LmZuKCksXG4gIGluZm86IGplc3QuZm4oKSxcbn07XG5cbi8vIE1vY2sgV2ViU29ja2V0IGZvciB0ZXN0c1xuZ2xvYmFsLldlYlNvY2tldCA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgc2VuZDogamVzdC5mbigpLFxuICBjbG9zZTogamVzdC5mbigpLFxuICBhZGRFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgcmVhZHlTdGF0ZTogMSwgLy8gT1BFTlxufSkpO1xuXG4vLyBNb2NrIGZldGNoIGZvciBBUEkgY2FsbHNcbmdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKTtcblxuLy8gU2V0IGRlZmF1bHQgdGVzdCB0aW1lb3V0IGZvciBwcm9wZXJ0eS1iYXNlZCB0ZXN0c1xuamVzdC5zZXRUaW1lb3V0KDEwMDAwKTtcblxuLy8gTW9jayBjcnlwdG8gZm9yIEhNQUMgc2lnbmF0dXJlcyBpbiB0ZXN0c1xuamVzdC5tb2NrKCdjcnlwdG8nLCAoKSA9PiAoe1xuICBjcmVhdGVIbWFjOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIGRpZ2VzdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnbW9ja2VkLXNpZ25hdHVyZScpLFxuICB9KSxcbiAgcmFuZG9tQnl0ZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoQnVmZmVyLmZyb20oJ21vY2tlZC1yYW5kb20tMTYtYnl0ZXMnKSksXG4gIHBia2RmMlN5bmM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoQnVmZmVyLmZyb20oJ21vY2tlZC1kZXJpdmVkLWtleS0zMi1ieXRlcy1sb25nJykpLFxuICBjcmVhdGVDaXBoZXJpdjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKEJ1ZmZlci5mcm9tKCdlbmNyeXB0ZWQtZGF0YScpKSxcbiAgICBmaW5hbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShCdWZmZXIuZnJvbSgnZmluYWwtZW5jcnlwdGVkJykpLFxuICB9KSxcbiAgY3JlYXRlRGVjaXBoZXJpdjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKEJ1ZmZlci5mcm9tKCdkZWNyeXB0ZWQtZGF0YScpKSxcbiAgICBmaW5hbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShCdWZmZXIuZnJvbSgnZmluYWwtZGVjcnlwdGVkJykpLFxuICB9KSxcbn0pKTtcblxuLy8gTW9jayBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xucHJvY2Vzcy5lbnYuQklOQU5DRV9BUElfS0VZID0gJ3Rlc3QtYmluYW5jZS1rZXknO1xucHJvY2Vzcy5lbnYuQklOQU5DRV9BUElfU0VDUkVUID0gJ3Rlc3QtYmluYW5jZS1zZWNyZXQnO1xucHJvY2Vzcy5lbnYuQllCSVRfQVBJX0tFWSA9ICd0ZXN0LWJ5Yml0LWtleSc7XG5wcm9jZXNzLmVudi5CWUJJVF9BUElfU0VDUkVUID0gJ3Rlc3QtYnliaXQtc2VjcmV0JztcblxuLy8gR2xvYmFsIHRlc3QgdXRpbGl0aWVzXG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBqZXN0IHtcbiAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xuICAgICAgdG9CZVdpdGhpblJhbmdlKGZsb29yOiBudW1iZXIsIGNlaWxpbmc6IG51bWJlcik6IFI7XG4gICAgICB0b0JlVmFsaWRIb2xvZ3JhbVN0YXRlKCk6IFI7XG4gICAgICB0b0JlVmFsaWRTaWduYWwoKTogUjtcbiAgICB9XG4gIH1cbn1cblxuLy8gQ3VzdG9tIG1hdGNoZXJzIGZvciB0cmFkaW5nIHN5c3RlbSB0ZXN0c1xuZXhwZWN0LmV4dGVuZCh7XG4gIHRvQmVXaXRoaW5SYW5nZShyZWNlaXZlZDogbnVtYmVyLCBmbG9vcjogbnVtYmVyLCBjZWlsaW5nOiBudW1iZXIpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgPj0gZmxvb3IgJiYgcmVjZWl2ZWQgPD0gY2VpbGluZztcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7cmVjZWl2ZWR9IG5vdCB0byBiZSB3aXRoaW4gcmFuZ2UgJHtmbG9vcn0gLSAke2NlaWxpbmd9YCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSB3aXRoaW4gcmFuZ2UgJHtmbG9vcn0gLSAke2NlaWxpbmd9YCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcblxuICB0b0JlVmFsaWRIb2xvZ3JhbVN0YXRlKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCByZXF1aXJlZEZpZWxkcyA9IFsnZGFpbHlCaWFzJywgJ2ZvdXJIb3VyTG9jYXRpb24nLCAnZmlmdGVlbk1pblRyaWdnZXInLCAnYWxpZ25tZW50U2NvcmUnXTtcbiAgICBjb25zdCBoYXNBbGxGaWVsZHMgPSByZXF1aXJlZEZpZWxkcy5ldmVyeShmaWVsZCA9PiByZWNlaXZlZC5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpO1xuICAgIGNvbnN0IHZhbGlkU2NvcmUgPSByZWNlaXZlZC5hbGlnbm1lbnRTY29yZSA+PSAwICYmIHJlY2VpdmVkLmFsaWdubWVudFNjb3JlIDw9IDEwMDtcbiAgICBcbiAgICBjb25zdCBwYXNzID0gaGFzQWxsRmllbGRzICYmIHZhbGlkU2NvcmU7XG4gICAgaWYgKHBhc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke0pTT04uc3RyaW5naWZ5KHJlY2VpdmVkKX0gbm90IHRvIGJlIGEgdmFsaWQgaG9sb2dyYW0gc3RhdGVgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7SlNPTi5zdHJpbmdpZnkocmVjZWl2ZWQpfSB0byBiZSBhIHZhbGlkIGhvbG9ncmFtIHN0YXRlYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcblxuICB0b0JlVmFsaWRTaWduYWwocmVjZWl2ZWQ6IGFueSkge1xuICAgIGNvbnN0IHJlcXVpcmVkRmllbGRzID0gWydzeW1ib2wnLCAnc2lkZScsICdjb25maWRlbmNlJywgJ2VudHJ5JywgJ3N0b3BMb3NzJywgJ3Rha2VQcm9maXQnXTtcbiAgICBjb25zdCBoYXNBbGxGaWVsZHMgPSByZXF1aXJlZEZpZWxkcy5ldmVyeShmaWVsZCA9PiByZWNlaXZlZC5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpO1xuICAgIGNvbnN0IHZhbGlkU2lkZSA9IFsnQnV5JywgJ1NlbGwnXS5pbmNsdWRlcyhyZWNlaXZlZC5zaWRlKTtcbiAgICBjb25zdCB2YWxpZENvbmZpZGVuY2UgPSByZWNlaXZlZC5jb25maWRlbmNlID49IDAgJiYgcmVjZWl2ZWQuY29uZmlkZW5jZSA8PSAxMDA7XG4gICAgXG4gICAgY29uc3QgcGFzcyA9IGhhc0FsbEZpZWxkcyAmJiB2YWxpZFNpZGUgJiYgdmFsaWRDb25maWRlbmNlO1xuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtKU09OLnN0cmluZ2lmeShyZWNlaXZlZCl9IG5vdCB0byBiZSBhIHZhbGlkIHNpZ25hbGAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtKU09OLnN0cmluZ2lmeShyZWNlaXZlZCl9IHRvIGJlIGEgdmFsaWQgc2lnbmFsYCxcbiAgICAgICAgcGFzczogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfSxcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==