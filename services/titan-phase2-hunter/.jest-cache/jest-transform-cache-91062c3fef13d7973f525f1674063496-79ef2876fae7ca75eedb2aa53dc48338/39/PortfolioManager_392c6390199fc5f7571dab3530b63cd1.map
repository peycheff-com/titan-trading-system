{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/risk/PortfolioManager.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/risk/PortfolioManager.ts"],"sourcesContent":["/**\n * Portfolio Manager for Titan Phase 2 - The Hunter\n * \n * Manages multiple positions simultaneously with proper risk allocation:\n * - Calculate total exposure capped at 200% equity (5x max leverage)\n * - Enforce max 5 concurrent trades limit\n * - Allocate risk per trade with dynamic allocation\n * - Rank signals by alignment score and RS score\n * - Check portfolio heat capped at 15%\n * - Adjust for directional bias with 20% reduction\n * \n * Requirements: 16.1-16.7 (Multi-Symbol Portfolio Management)\n */\n\nimport { EventEmitter } from 'events';\nimport { \n  Position, \n  SignalData, \n  HologramState,\n  PhaseConfig\n} from '../types';\n\nexport interface PortfolioState {\n  totalEquity: number;\n  totalExposure: number;\n  exposurePercentage: number; // Total exposure as % of equity\n  openPositions: Position[];\n  portfolioHeat: number; // Total risk as % of equity\n  directionalBias: 'LONG' | 'SHORT' | 'NEUTRAL';\n  biasPercentage: number; // % of positions in dominant direction\n  totalUnrealizedPnL: number;\n  totalRealizedPnL: number;\n  totalPnLPercentage: number;\n}\n\nexport interface RankedSignal {\n  signal: SignalData;\n  hologramState: HologramState;\n  compositeScore: number; // Combined alignment + RS score\n  rank: number;\n}\n\nexport interface RiskAllocation {\n  baseRiskPerTrade: number; // Base risk per trade as % of equity\n  adjustedRiskPerTrade: number; // Adjusted for open positions\n  maxPositionSize: number; // Max position size in base currency\n  recommendedLeverage: number; // Recommended leverage for new positions\n}\n\nexport interface PortfolioManagerConfig {\n  maxTotalExposure: number; // 2.0 = 200% of equity (5x max leverage)\n  maxConcurrentPositions: number; // 5 concurrent trades max\n  baseRiskPercent: number; // 0.02 = 2% base risk per trade\n  maxPortfolioHeat: number; // 0.15 = 15% max portfolio heat\n  directionalBiasThreshold: number; // 0.6 = 60% positions in same direction\n  directionalBiasReduction: number; // 0.2 = 20% position size reduction\n  alignmentScoreWeight: number; // 0.7 = 70% weight for alignment score\n  rsScoreWeight: number; // 0.3 = 30% weight for RS score\n  maxSignalsToRank: number; // 10 = max signals to consider simultaneously\n}\n\nexport interface PortfolioManagerEvents {\n  'portfolio:updated': (state: PortfolioState) => void;\n  'portfolio:exposure_limit': (current: number, max: number) => void;\n  'portfolio:position_limit': (current: number, max: number) => void;\n  'portfolio:heat_limit': (current: number, max: number) => void;\n  'portfolio:directional_bias': (bias: 'LONG' | 'SHORT', percentage: number) => void;\n  'portfolio:signal_ranked': (rankedSignals: RankedSignal[]) => void;\n  'portfolio:signal_rejected': (signal: SignalData, reason: string) => void;\n  'portfolio:risk_allocated': (allocation: RiskAllocation) => void;\n}\n\nexport class PortfolioManager extends EventEmitter {\n  private config: PortfolioManagerConfig;\n  private portfolioState: PortfolioState;\n  private positions: Map<string, Position> = new Map();\n\n  constructor(config?: Partial<PortfolioManagerConfig>) {\n    super();\n    \n    this.config = {\n      maxTotalExposure: 2.0, // 200% of equity\n      maxConcurrentPositions: 5,\n      baseRiskPercent: 0.02, // 2%\n      maxPortfolioHeat: 0.15, // 15%\n      directionalBiasThreshold: 0.6, // 60%\n      directionalBiasReduction: 0.2, // 20%\n      alignmentScoreWeight: 0.7, // 70%\n      rsScoreWeight: 0.3, // 30%\n      maxSignalsToRank: 10,\n      ...config\n    };\n\n    // Initialize portfolio state\n    this.portfolioState = {\n      totalEquity: 0,\n      totalExposure: 0,\n      exposurePercentage: 0,\n      openPositions: [],\n      portfolioHeat: 0,\n      directionalBias: 'NEUTRAL',\n      biasPercentage: 0,\n      totalUnrealizedPnL: 0,\n      totalRealizedPnL: 0,\n      totalPnLPercentage: 0\n    };\n  }\n\n  /**\n   * Calculate total exposure capped at 200% equity (5x max leverage)\n   * @param positions - Open positions\n   * @param totalEquity - Total account equity\n   * @returns Total exposure as percentage of equity\n   */\n  public calcTotalExposure(positions: Position[], totalEquity: number): number {\n    if (totalEquity <= 0) return 0;\n\n    // Sum notional value of all open positions\n    const totalNotional = positions.reduce((sum, position) => {\n      const notional = position.quantity * position.currentPrice * position.leverage;\n      return sum + notional;\n    }, 0);\n\n    const exposurePercentage = totalNotional / totalEquity;\n    const maxExposure = this.config.maxTotalExposure;\n\n    if (exposurePercentage > maxExposure) {\n      this.emit('portfolio:exposure_limit', exposurePercentage, maxExposure);\n      console.warn(`âš ï¸ Total exposure ${(exposurePercentage * 100).toFixed(1)}% exceeds limit ${(maxExposure * 100).toFixed(1)}%`);\n    }\n\n    return Math.min(exposurePercentage, maxExposure);\n  }\n\n  /**\n   * Enforce max 5 concurrent trades limit\n   * @param currentPositions - Current open positions\n   * @returns True if new position can be opened\n   */\n  public enforceMaxPositions(currentPositions: Position[]): boolean {\n    const openPositions = currentPositions.filter(p => p.status === 'OPEN');\n    const maxPositions = this.config.maxConcurrentPositions;\n\n    if (openPositions.length >= maxPositions) {\n      this.emit('portfolio:position_limit', openPositions.length, maxPositions);\n      console.warn(`âš ï¸ Position limit reached: ${openPositions.length}/${maxPositions} positions open`);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Allocate risk per trade with dynamic allocation\n   * @param totalEquity - Total account equity\n   * @param openPositions - Current open positions\n   * @returns Risk allocation details\n   */\n  public allocateRiskPerTrade(totalEquity: number, openPositions: Position[]): RiskAllocation {\n    const numOpenPositions = openPositions.filter(p => p.status === 'OPEN').length;\n    const baseRisk = this.config.baseRiskPercent;\n\n    // Dynamic allocation: divide base risk by number of open positions + 1 (for new position)\n    const adjustedRiskPerTrade = baseRisk / Math.max(1, numOpenPositions + 1);\n    \n    // Calculate max position size (risk amount / typical stop distance)\n    const typicalStopDistance = 0.015; // 1.5% typical stop distance\n    const riskAmount = totalEquity * adjustedRiskPerTrade;\n    const maxPositionSize = riskAmount / typicalStopDistance;\n\n    // Recommend leverage based on position size and equity\n    const recommendedLeverage = Math.min(5, Math.max(1, maxPositionSize / (totalEquity * 0.2)));\n\n    const allocation: RiskAllocation = {\n      baseRiskPerTrade: baseRisk,\n      adjustedRiskPerTrade,\n      maxPositionSize,\n      recommendedLeverage\n    };\n\n    this.emit('portfolio:risk_allocated', allocation);\n    \n    console.log(`ðŸ’° Risk allocation: ${(adjustedRiskPerTrade * 100).toFixed(2)}% per trade, max size ${maxPositionSize.toFixed(0)}, leverage ${recommendedLeverage.toFixed(1)}x`);\n    \n    return allocation;\n  }\n\n  /**\n   * Rank signals by alignment score and RS score, select top 3\n   * @param signals - Array of signals with hologram states\n   * @returns Ranked signals (top 3)\n   */\n  public rankSignals(signals: Array<{ signal: SignalData; hologramState: HologramState }>): RankedSignal[] {\n    if (signals.length === 0) return [];\n\n    // Calculate composite score for each signal\n    const scoredSignals = signals.map(({ signal, hologramState }) => {\n      // Normalize alignment score (0-100 â†’ 0-1)\n      const normalizedAlignment = hologramState.alignmentScore / 100;\n      \n      // Normalize RS score (typically -0.1 to +0.1 â†’ 0-1)\n      const normalizedRS = Math.max(0, Math.min(1, (Math.abs(hologramState.rsScore) + 0.1) / 0.2));\n      \n      // Calculate composite score\n      const compositeScore = \n        (normalizedAlignment * this.config.alignmentScoreWeight) + \n        (normalizedRS * this.config.rsScoreWeight);\n\n      return {\n        signal,\n        hologramState,\n        compositeScore,\n        rank: 0 // Will be set after sorting\n      };\n    });\n\n    // Sort by composite score (highest first)\n    scoredSignals.sort((a, b) => b.compositeScore - a.compositeScore);\n\n    // Assign ranks and take top signals\n    const maxSignals = Math.min(this.config.maxSignalsToRank, scoredSignals.length);\n    const rankedSignals = scoredSignals.slice(0, maxSignals).map((signal, index) => ({\n      ...signal,\n      rank: index + 1\n    }));\n\n    // Select top 3 for execution\n    const top3 = rankedSignals.slice(0, 3);\n\n    this.emit('portfolio:signal_ranked', top3);\n    \n    console.log(`ðŸ“Š Ranked ${signals.length} signals, selected top ${top3.length}:`);\n    top3.forEach(rs => {\n      console.log(`  ${rs.rank}. ${rs.signal.symbol} (${rs.signal.direction}): Score ${rs.compositeScore.toFixed(3)} (A:${rs.hologramState.alignmentScore}, RS:${rs.hologramState.rsScore.toFixed(3)})`);\n    });\n\n    return top3;\n  }\n\n  /**\n   * Check portfolio heat capped at 15%\n   * @param positions - Open positions\n   * @param totalEquity - Total account equity\n   * @returns True if portfolio heat is within limits\n   */\n  public checkPortfolioHeat(positions: Position[], totalEquity: number): boolean {\n    if (totalEquity <= 0) return false;\n\n    // Calculate total risk (distance to stop loss for all positions)\n    const totalRisk = positions\n      .filter(p => p.status === 'OPEN')\n      .reduce((sum, position) => {\n        const riskPerUnit = Math.abs(position.entryPrice - position.stopLoss);\n        const totalPositionRisk = riskPerUnit * position.quantity;\n        return sum + totalPositionRisk;\n      }, 0);\n\n    const portfolioHeat = totalRisk / totalEquity;\n    const maxHeat = this.config.maxPortfolioHeat;\n\n    if (portfolioHeat > maxHeat) {\n      this.emit('portfolio:heat_limit', portfolioHeat, maxHeat);\n      console.warn(`ðŸ”¥ Portfolio heat ${(portfolioHeat * 100).toFixed(1)}% exceeds limit ${(maxHeat * 100).toFixed(1)}%`);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Adjust for directional bias with 20% reduction\n   * @param positions - Open positions\n   * @param proposedDirection - Direction of new signal\n   * @param basePositionSize - Base position size\n   * @returns Adjusted position size\n   */\n  public adjustForDirectionalBias(\n    positions: Position[], \n    proposedDirection: 'LONG' | 'SHORT', \n    basePositionSize: number\n  ): number {\n    const openPositions = positions.filter(p => p.status === 'OPEN');\n    \n    if (openPositions.length === 0) {\n      return basePositionSize; // No bias with no positions\n    }\n\n    // Count positions by direction\n    const longPositions = openPositions.filter(p => p.side === 'LONG').length;\n    const shortPositions = openPositions.filter(p => p.side === 'SHORT').length;\n    const totalPositions = openPositions.length;\n\n    // Calculate directional bias\n    const longPercentage = longPositions / totalPositions;\n    const shortPercentage = shortPositions / totalPositions;\n    \n    let directionalBias: 'LONG' | 'SHORT' | 'NEUTRAL' = 'NEUTRAL';\n    let biasPercentage = 0;\n\n    if (longPercentage >= this.config.directionalBiasThreshold) {\n      directionalBias = 'LONG';\n      biasPercentage = longPercentage;\n    } else if (shortPercentage >= this.config.directionalBiasThreshold) {\n      directionalBias = 'SHORT';\n      biasPercentage = shortPercentage;\n    }\n\n    // Apply reduction if new position adds to existing bias\n    let adjustedSize = basePositionSize;\n    \n    if (directionalBias !== 'NEUTRAL' && \n        ((directionalBias === 'LONG' && proposedDirection === 'LONG') ||\n         (directionalBias === 'SHORT' && proposedDirection === 'SHORT'))) {\n      \n      adjustedSize = basePositionSize * (1 - this.config.directionalBiasReduction);\n      \n      this.emit('portfolio:directional_bias', directionalBias, biasPercentage);\n      console.log(`âš–ï¸ Directional bias detected: ${directionalBias} ${(biasPercentage * 100).toFixed(1)}%, reducing ${proposedDirection} position by ${(this.config.directionalBiasReduction * 100).toFixed(0)}%`);\n    }\n\n    return adjustedSize;\n  }\n\n  /**\n   * Update portfolio state with current positions and equity\n   * @param positions - Current positions\n   * @param totalEquity - Total account equity\n   */\n  public updatePortfolioState(positions: Position[], totalEquity: number): void {\n    const openPositions = positions.filter(p => p.status === 'OPEN');\n    \n    // Calculate total exposure\n    const totalExposure = openPositions.reduce((sum, pos) => {\n      return sum + (pos.quantity * pos.currentPrice * pos.leverage);\n    }, 0);\n\n    // Calculate portfolio heat\n    const totalRisk = openPositions.reduce((sum, pos) => {\n      const riskPerUnit = Math.abs(pos.entryPrice - pos.stopLoss);\n      return sum + (riskPerUnit * pos.quantity);\n    }, 0);\n\n    // Calculate directional bias\n    const longPositions = openPositions.filter(p => p.side === 'LONG').length;\n    const shortPositions = openPositions.filter(p => p.side === 'SHORT').length;\n    const totalOpenPositions = openPositions.length;\n\n    let directionalBias: 'LONG' | 'SHORT' | 'NEUTRAL' = 'NEUTRAL';\n    let biasPercentage = 0;\n\n    if (totalOpenPositions > 0) {\n      const longPercentage = longPositions / totalOpenPositions;\n      const shortPercentage = shortPositions / totalOpenPositions;\n\n      if (longPercentage >= this.config.directionalBiasThreshold) {\n        directionalBias = 'LONG';\n        biasPercentage = longPercentage;\n      } else if (shortPercentage >= this.config.directionalBiasThreshold) {\n        directionalBias = 'SHORT';\n        biasPercentage = shortPercentage;\n      }\n    }\n\n    // Calculate P&L\n    const totalUnrealizedPnL = openPositions.reduce((sum, pos) => sum + pos.unrealizedPnL, 0);\n    const totalRealizedPnL = positions.reduce((sum, pos) => sum + pos.realizedPnL, 0);\n    const totalPnL = totalUnrealizedPnL + totalRealizedPnL;\n\n    // Update portfolio state\n    this.portfolioState = {\n      totalEquity,\n      totalExposure,\n      exposurePercentage: totalEquity > 0 ? totalExposure / totalEquity : 0,\n      openPositions,\n      portfolioHeat: totalEquity > 0 ? totalRisk / totalEquity : 0,\n      directionalBias,\n      biasPercentage,\n      totalUnrealizedPnL,\n      totalRealizedPnL,\n      totalPnLPercentage: totalEquity > 0 ? totalPnL / totalEquity : 0\n    };\n\n    // Update positions map\n    this.positions.clear();\n    positions.forEach(pos => this.positions.set(pos.id, pos));\n\n    this.emit('portfolio:updated', this.portfolioState);\n  }\n\n  /**\n   * Check if new signal can be accepted based on portfolio limits\n   * @param signal - Signal to check\n   * @param hologramState - Hologram state for the signal\n   * @param totalEquity - Total account equity\n   * @returns True if signal can be accepted\n   */\n  public canAcceptSignal(signal: SignalData, hologramState: HologramState, totalEquity: number): boolean {\n    const openPositions = Array.from(this.positions.values()).filter(p => p.status === 'OPEN');\n\n    // Check position limit\n    if (!this.enforceMaxPositions(openPositions)) {\n      this.emit('portfolio:signal_rejected', signal, 'POSITION_LIMIT_EXCEEDED');\n      return false;\n    }\n\n    // Check portfolio heat\n    if (!this.checkPortfolioHeat(openPositions, totalEquity)) {\n      this.emit('portfolio:signal_rejected', signal, 'PORTFOLIO_HEAT_EXCEEDED');\n      return false;\n    }\n\n    // Check total exposure (would need position size calculation)\n    const currentExposure = this.calcTotalExposure(openPositions, totalEquity);\n    if (currentExposure >= this.config.maxTotalExposure) {\n      this.emit('portfolio:signal_rejected', signal, 'EXPOSURE_LIMIT_EXCEEDED');\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get current portfolio state\n   * @returns Current portfolio state\n   */\n  public getPortfolioState(): PortfolioState {\n    return { ...this.portfolioState };\n  }\n\n  /**\n   * Get portfolio statistics for display\n   * @returns Portfolio statistics\n   */\n  public getPortfolioStatistics(): {\n    totalPositions: number;\n    openPositions: number;\n    exposureUtilization: number; // % of max exposure used\n    heatUtilization: number; // % of max heat used\n    positionUtilization: number; // % of max positions used\n    avgPositionSize: number;\n    largestPosition: number;\n    directionalBias: string;\n    totalPnL: number;\n    totalPnLPercentage: number;\n  } {\n    const openPositions = this.portfolioState.openPositions;\n    const positionSizes = openPositions.map(p => p.quantity * p.currentPrice);\n    \n    return {\n      totalPositions: Array.from(this.positions.values()).length,\n      openPositions: openPositions.length,\n      exposureUtilization: this.portfolioState.exposurePercentage / this.config.maxTotalExposure,\n      heatUtilization: this.portfolioState.portfolioHeat / this.config.maxPortfolioHeat,\n      positionUtilization: openPositions.length / this.config.maxConcurrentPositions,\n      avgPositionSize: positionSizes.length > 0 ? positionSizes.reduce((a, b) => a + b, 0) / positionSizes.length : 0,\n      largestPosition: positionSizes.length > 0 ? Math.max(...positionSizes) : 0,\n      directionalBias: `${this.portfolioState.directionalBias} (${(this.portfolioState.biasPercentage * 100).toFixed(1)}%)`,\n      totalPnL: this.portfolioState.totalUnrealizedPnL + this.portfolioState.totalRealizedPnL,\n      totalPnLPercentage: this.portfolioState.totalPnLPercentage\n    };\n  }\n\n  /**\n   * Update configuration\n   * @param newConfig - New configuration\n   */\n  public updateConfig(newConfig: Partial<PortfolioManagerConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    console.log(`ðŸ“Š Portfolio Manager: Configuration updated`);\n  }\n\n  /**\n   * Add position to portfolio\n   * @param position - Position to add\n   */\n  public addPosition(position: Position): void {\n    this.positions.set(position.id, position);\n    console.log(`ðŸ“Š Portfolio Manager: Added position ${position.id} (${position.symbol} ${position.side})`);\n  }\n\n  /**\n   * Remove position from portfolio\n   * @param positionId - Position ID to remove\n   */\n  public removePosition(positionId: string): void {\n    if (this.positions.delete(positionId)) {\n      console.log(`ðŸ“Š Portfolio Manager: Removed position ${positionId}`);\n    }\n  }\n\n  /**\n   * Update position in portfolio\n   * @param position - Updated position\n   */\n  public updatePosition(position: Position): void {\n    if (this.positions.has(position.id)) {\n      this.positions.set(position.id, position);\n    }\n  }\n\n  /**\n   * Get all positions\n   * @returns Array of all positions\n   */\n  public getAllPositions(): Position[] {\n    return Array.from(this.positions.values());\n  }\n\n  /**\n   * Get open positions only\n   * @returns Array of open positions\n   */\n  public getOpenPositions(): Position[] {\n    return Array.from(this.positions.values()).filter(p => p.status === 'OPEN');\n  }\n\n  /**\n   * Emergency close all positions (for risk management)\n   * @returns Position IDs that need to be closed\n   */\n  public getPositionsToClose(): string[] {\n    return this.getOpenPositions().map(p => p.id);\n  }\n\n  /**\n   * Clear all positions (for testing/reset)\n   */\n  public clearPositions(): void {\n    this.positions.clear();\n    this.portfolioState.openPositions = [];\n    console.log(`ðŸ“Š Portfolio Manager: All positions cleared`);\n  }\n\n  /**\n   * Cleanup resources\n   */\n  public destroy(): void {\n    this.positions.clear();\n    this.removeAllListeners();\n    console.log(`ðŸ“Š Portfolio Manager: Destroyed`);\n  }\n}\n\n// Export event interface for TypeScript\nexport declare interface PortfolioManager {\n  on<U extends keyof PortfolioManagerEvents>(event: U, listener: PortfolioManagerEvents[U]): this;\n  emit<U extends keyof PortfolioManagerEvents>(event: U, ...args: Parameters<PortfolioManagerEvents[U]>): boolean;\n}"],"version":3}