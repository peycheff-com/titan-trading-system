bae75a31824bf3f84695aac90f04861c
"use strict";
/**
 * Jest setup file for Titan Phase 2 Hunter tests
 * Runs after the test framework is set up but before each test file
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock crypto for HMAC signatures in tests
jest.mock('crypto', () => ({
    createHmac: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnThis(),
        digest: jest.fn().mockReturnValue('mocked-signature'),
    }),
    randomBytes: jest.fn().mockReturnValue(Buffer.from('mocked-random-16-bytes')),
    pbkdf2Sync: jest.fn().mockReturnValue(Buffer.from('mocked-derived-key-32-bytes-long')),
    createCipheriv: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnValue(Buffer.from('encrypted-data')),
        final: jest.fn().mockReturnValue(Buffer.from('final-encrypted')),
    }),
    createDecipheriv: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnValue(Buffer.from('decrypted-data')),
        final: jest.fn().mockReturnValue(Buffer.from('final-decrypted')),
    }),
}));
// Extend Jest matchers for better assertions
require("jest-extended");
// Mock console methods to reduce noise in tests (but keep errors for debugging)
const originalConsole = global.console;
global.console = {
    ...console,
    // Keep error and warn for debugging critical issues
    error: process.env.DEBUG_TESTS ? originalConsole.error : jest.fn(),
    warn: process.env.DEBUG_TESTS ? originalConsole.warn : jest.fn(),
    log: jest.fn(),
    debug: jest.fn(),
    info: jest.fn(),
};
// Mock WebSocket for tests
global.WebSocket = jest.fn().mockImplementation(() => ({
    send: jest.fn(),
    close: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    readyState: 1, // OPEN
}));
// Mock fetch for API calls
global.fetch = jest.fn();
// Set default test timeout for property-based tests
jest.setTimeout(10000);
// Mock environment variables
process.env.NODE_ENV = 'test';
process.env.BINANCE_API_KEY = 'test-binance-key';
process.env.BINANCE_API_SECRET = 'test-binance-secret';
process.env.BYBIT_API_KEY = 'test-bybit-key';
process.env.BYBIT_API_SECRET = 'test-bybit-secret';
// Custom matchers for trading system tests
expect.extend({
    toBeWithinRange(received, floor, ceiling) {
        const pass = received >= floor && received <= ceiling;
        if (pass) {
            return {
                message: () => `expected ${received} not to be within range ${floor} - ${ceiling}`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${received} to be within range ${floor} - ${ceiling}`,
                pass: false,
            };
        }
    },
    toBeValidHologramState(received) {
        const requiredFields = ['dailyBias', 'fourHourLocation', 'fifteenMinTrigger', 'alignmentScore'];
        const hasAllFields = requiredFields.every(field => received.hasOwnProperty(field));
        const validScore = received.alignmentScore >= 0 && received.alignmentScore <= 100;
        const pass = hasAllFields && validScore;
        if (pass) {
            return {
                message: () => `expected ${JSON.stringify(received)} not to be a valid hologram state`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${JSON.stringify(received)} to be a valid hologram state`,
                pass: false,
            };
        }
    },
    toBeValidSignal(received) {
        const requiredFields = ['symbol', 'side', 'confidence', 'entry', 'stopLoss', 'takeProfit'];
        const hasAllFields = requiredFields.every(field => received.hasOwnProperty(field));
        const validSide = ['Buy', 'Sell'].includes(received.side);
        const validConfidence = received.confidence >= 0 && received.confidence <= 100;
        const pass = hasAllFields && validSide && validConfidence;
        if (pass) {
            return {
                message: () => `expected ${JSON.stringify(received)} not to be a valid signal`,
                pass: true,
            };
        }
        else {
            return {
                message: () => `expected ${JSON.stringify(received)} to be a valid signal`,
                pass: false,
            };
        }
    },
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvdGVzdHMvc2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFnQ0gsMkNBQTJDO0FBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDcEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7UUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUM7S0FDdEQsQ0FBQztJQUNGLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUM3RSxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFDdEYsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDeEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hFLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztLQUNqRSxDQUFDO0lBQ0YsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztRQUMxQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixD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QUcsWUFBWSxJQUFJLFNBQVMsSUFBSSxlQUFlLENBQUM7UUFDMUQsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNULE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsMkJBQTJCO2dCQUM5RSxJQUFJLEVBQUUsSUFBSTthQUNYLENBQUM7UUFDSixDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsdUJBQXVCO2dCQUMxRSxJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tcGhhc2UyLWh1bnRlci90ZXN0cy9zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEplc3Qgc2V0dXAgZmlsZSBmb3IgVGl0YW4gUGhhc2UgMiBIdW50ZXIgdGVzdHNcbiAqIFJ1bnMgYWZ0ZXIgdGhlIHRlc3QgZnJhbWV3b3JrIGlzIHNldCB1cCBidXQgYmVmb3JlIGVhY2ggdGVzdCBmaWxlXG4gKi9cblxuLy8gRXh0ZW5kIEplc3QgbWF0Y2hlcnMgZm9yIGJldHRlciBhc3NlcnRpb25zXG5pbXBvcnQgJ2plc3QtZXh0ZW5kZWQnO1xuXG4vLyBNb2NrIGNvbnNvbGUgbWV0aG9kcyB0byByZWR1Y2Ugbm9pc2UgaW4gdGVzdHMgKGJ1dCBrZWVwIGVycm9ycyBmb3IgZGVidWdnaW5nKVxuY29uc3Qgb3JpZ2luYWxDb25zb2xlID0gZ2xvYmFsLmNvbnNvbGU7XG5nbG9iYWwuY29uc29sZSA9IHtcbiAgLi4uY29uc29sZSxcbiAgLy8gS2VlcCBlcnJvciBhbmQgd2FybiBmb3IgZGVidWdnaW5nIGNyaXRpY2FsIGlzc3Vlc1xuICBlcnJvcjogcHJvY2Vzcy5lbnYuREVCVUdfVEVTVFMgPyBvcmlnaW5hbENvbnNvbGUuZXJyb3IgOiBqZXN0LmZuKCksXG4gIHdhcm46IHByb2Nlc3MuZW52LkRFQlVHX1RFU1RTID8gb3JpZ2luYWxDb25zb2xlLndhcm4gOiBqZXN0LmZuKCksXG4gIGxvZzogamVzdC5mbigpLFxuICBkZWJ1ZzogamVzdC5mbigpLFxuICBpbmZvOiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIFdlYlNvY2tldCBmb3IgdGVzdHNcbmdsb2JhbC5XZWJTb2NrZXQgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gIHNlbmQ6IGplc3QuZm4oKSxcbiAgY2xvc2U6IGplc3QuZm4oKSxcbiAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gIHJlYWR5U3RhdGU6IDEsIC8vIE9QRU5cbn0pKTtcblxuLy8gTW9jayBmZXRjaCBmb3IgQVBJIGNhbGxzXG5nbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCk7XG5cbi8vIFNldCBkZWZhdWx0IHRlc3QgdGltZW91dCBmb3IgcHJvcGVydHktYmFzZWQgdGVzdHNcbmplc3Quc2V0VGltZW91dCgxMDAwMCk7XG5cbi8vIE1vY2sgY3J5cHRvIGZvciBITUFDIHNpZ25hdHVyZXMgaW4gdGVzdHNcbmplc3QubW9jaygnY3J5cHRvJywgKCkgPT4gKHtcbiAgY3JlYXRlSG1hYzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBkaWdlc3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ21vY2tlZC1zaWduYXR1cmUnKSxcbiAgfSksXG4gIHJhbmRvbUJ5dGVzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKEJ1ZmZlci5mcm9tKCdtb2NrZWQtcmFuZG9tLTE2LWJ5dGVzJykpLFxuICBwYmtkZjJTeW5jOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKEJ1ZmZlci5mcm9tKCdtb2NrZWQtZGVyaXZlZC1rZXktMzItYnl0ZXMtbG9uZycpKSxcbiAgY3JlYXRlQ2lwaGVyaXY6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShCdWZmZXIuZnJvbSgnZW5jcnlwdGVkLWRhdGEnKSksXG4gICAgZmluYWw6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoQnVmZmVyLmZyb20oJ2ZpbmFsLWVuY3J5cHRlZCcpKSxcbiAgfSksXG4gIGNyZWF0ZURlY2lwaGVyaXY6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShCdWZmZXIuZnJvbSgnZGVjcnlwdGVkLWRhdGEnKSksXG4gICAgZmluYWw6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoQnVmZmVyLmZyb20oJ2ZpbmFsLWRlY3J5cHRlZCcpKSxcbiAgfSksXG59KSk7XG5cbi8vIE1vY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbnByb2Nlc3MuZW52LkJJTkFOQ0VfQVBJX0tFWSA9ICd0ZXN0LWJpbmFuY2Uta2V5JztcbnByb2Nlc3MuZW52LkJJTkFOQ0VfQVBJX1NFQ1JFVCA9ICd0ZXN0LWJpbmFuY2Utc2VjcmV0JztcbnByb2Nlc3MuZW52LkJZQklUX0FQSV9LRVkgPSAndGVzdC1ieWJpdC1rZXknO1xucHJvY2Vzcy5lbnYuQllCSVRfQVBJX1NFQ1JFVCA9ICd0ZXN0LWJ5Yml0LXNlY3JldCc7XG5cbi8vIEdsb2JhbCB0ZXN0IHV0aWxpdGllc1xuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgamVzdCB7XG4gICAgaW50ZXJmYWNlIE1hdGNoZXJzPFI+IHtcbiAgICAgIHRvQmVXaXRoaW5SYW5nZShmbG9vcjogbnVtYmVyLCBjZWlsaW5nOiBudW1iZXIpOiBSO1xuICAgICAgdG9CZVZhbGlkSG9sb2dyYW1TdGF0ZSgpOiBSO1xuICAgICAgdG9CZVZhbGlkU2lnbmFsKCk6IFI7XG4gICAgfVxuICB9XG59XG5cbi8vIEN1c3RvbSBtYXRjaGVycyBmb3IgdHJhZGluZyBzeXN0ZW0gdGVzdHNcbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlV2l0aGluUmFuZ2UocmVjZWl2ZWQ6IG51bWJlciwgZmxvb3I6IG51bWJlciwgY2VpbGluZzogbnVtYmVyKSB7XG4gICAgY29uc3QgcGFzcyA9IHJlY2VpdmVkID49IGZsb29yICYmIHJlY2VpdmVkIDw9IGNlaWxpbmc7XG4gICAgaWYgKHBhc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgd2l0aGluIHJhbmdlICR7Zmxvb3J9IC0gJHtjZWlsaW5nfWAsXG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgd2l0aGluIHJhbmdlICR7Zmxvb3J9IC0gJHtjZWlsaW5nfWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgdG9CZVZhbGlkSG9sb2dyYW1TdGF0ZShyZWNlaXZlZDogYW55KSB7XG4gICAgY29uc3QgcmVxdWlyZWRGaWVsZHMgPSBbJ2RhaWx5QmlhcycsICdmb3VySG91ckxvY2F0aW9uJywgJ2ZpZnRlZW5NaW5UcmlnZ2VyJywgJ2FsaWdubWVudFNjb3JlJ107XG4gICAgY29uc3QgaGFzQWxsRmllbGRzID0gcmVxdWlyZWRGaWVsZHMuZXZlcnkoZmllbGQgPT4gcmVjZWl2ZWQuaGFzT3duUHJvcGVydHkoZmllbGQpKTtcbiAgICBjb25zdCB2YWxpZFNjb3JlID0gcmVjZWl2ZWQuYWxpZ25tZW50U2NvcmUgPj0gMCAmJiByZWNlaXZlZC5hbGlnbm1lbnRTY29yZSA8PSAxMDA7XG4gICAgXG4gICAgY29uc3QgcGFzcyA9IGhhc0FsbEZpZWxkcyAmJiB2YWxpZFNjb3JlO1xuICAgIGlmIChwYXNzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiAoKSA9PiBgZXhwZWN0ZWQgJHtKU09OLnN0cmluZ2lmeShyZWNlaXZlZCl9IG5vdCB0byBiZSBhIHZhbGlkIGhvbG9ncmFtIHN0YXRlYCxcbiAgICAgICAgcGFzczogdHJ1ZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICgpID0+IGBleHBlY3RlZCAke0pTT04uc3RyaW5naWZ5KHJlY2VpdmVkKX0gdG8gYmUgYSB2YWxpZCBob2xvZ3JhbSBzdGF0ZWAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgdG9CZVZhbGlkU2lnbmFsKHJlY2VpdmVkOiBhbnkpIHtcbiAgICBjb25zdCByZXF1aXJlZEZpZWxkcyA9IFsnc3ltYm9sJywgJ3NpZGUnLCAnY29uZmlkZW5jZScsICdlbnRyeScsICdzdG9wTG9zcycsICd0YWtlUHJvZml0J107XG4gICAgY29uc3QgaGFzQWxsRmllbGRzID0gcmVxdWlyZWRGaWVsZHMuZXZlcnkoZmllbGQgPT4gcmVjZWl2ZWQuaGFzT3duUHJvcGVydHkoZmllbGQpKTtcbiAgICBjb25zdCB2YWxpZFNpZGUgPSBbJ0J1eScsICdTZWxsJ10uaW5jbHVkZXMocmVjZWl2ZWQuc2lkZSk7XG4gICAgY29uc3QgdmFsaWRDb25maWRlbmNlID0gcmVjZWl2ZWQuY29uZmlkZW5jZSA+PSAwICYmIHJlY2VpdmVkLmNvbmZpZGVuY2UgPD0gMTAwO1xuICAgIFxuICAgIGNvbnN0IHBhc3MgPSBoYXNBbGxGaWVsZHMgJiYgdmFsaWRTaWRlICYmIHZhbGlkQ29uZmlkZW5jZTtcbiAgICBpZiAocGFzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7SlNPTi5zdHJpbmdpZnkocmVjZWl2ZWQpfSBub3QgdG8gYmUgYSB2YWxpZCBzaWduYWxgLFxuICAgICAgICBwYXNzOiB0cnVlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogKCkgPT4gYGV4cGVjdGVkICR7SlNPTi5zdHJpbmdpZnkocmVjZWl2ZWQpfSB0byBiZSBhIHZhbGlkIHNpZ25hbGAsXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgfTtcbiAgICB9XG4gIH0sXG59KTsiXSwidmVyc2lvbiI6M30=