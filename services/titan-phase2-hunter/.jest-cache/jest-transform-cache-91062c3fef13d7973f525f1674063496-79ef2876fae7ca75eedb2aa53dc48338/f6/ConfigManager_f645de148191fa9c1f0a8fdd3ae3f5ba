433181fd1152542b672c0affdf7f9b9f
"use strict";
/**
 * Configuration Manager for Titan Phase 2 - The Hunter
 *
 * Provides runtime configuration management with hot-reload support,
 * default values, and validation for Phase 2 specific settings.
 *
 * Requirements: 18.1-18.8 (Runtime Configuration)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigManager = void 0;
const events_1 = require("events");
const fs_1 = require("fs");
const path_1 = require("path");
/**
 * Default configuration values
 */
const DEFAULT_CONFIG = {
    alignmentWeights: {
        daily: 50, // 50%
        h4: 30, // 30%
        m15: 20, // 20%
    },
    rsConfig: {
        threshold: 2, // 2%
        lookbackPeriod: 4, // 4 hours
    },
    riskConfig: {
        maxLeverage: 5, // 5x
        stopLossPercent: 1.5, // 1.5%
        targetPercent: 4.5, // 4.5% (3:1 R:R)
    },
    portfolioConfig: {
        maxConcurrentPositions: 5, // 5 positions
        maxPortfolioHeat: 15, // 15%
        correlationThreshold: 0.7, // 0.7
    },
    version: 1,
    lastModified: Date.now(),
};
/**
 * Configuration Manager for Phase 2
 */
class ConfigManager extends events_1.EventEmitter {
    config;
    configPath;
    isWatching = false;
    constructor(configDirectory = "./config") {
        super();
        this.configPath = (0, path_1.join)(configDirectory, "phase2.config.json");
        this.config = this.loadConfig();
    }
    /**
     * Load configuration from file with defaults
     * Requirement 18.8: Load default configuration if file is corrupted
     */
    loadConfig() {
        try {
            if (!(0, fs_1.existsSync)(this.configPath)) {
                console.log("üìã No config file found, creating default configuration");
                this.saveConfig(DEFAULT_CONFIG);
                return { ...DEFAULT_CONFIG };
            }
            const fileContent = (0, fs_1.readFileSync)(this.configPath, "utf8");
            const loadedConfig = JSON.parse(fileContent);
            // Validate loaded configuration
            const validation = this.validateConfig(loadedConfig);
            if (!validation.isValid) {
                console.error("‚ùå CONFIG_CORRUPTED: Invalid configuration file");
                console.error("Errors:", validation.errors);
                console.log("üìã Loading default configuration");
                // Backup corrupted config
                const backupPath = `${this.configPath}.corrupted.${Date.now()}`;
                (0, fs_1.writeFileSync)(backupPath, fileContent);
                console.log(`üíæ Corrupted config backed up to: ${backupPath}`);
                // Load defaults
                this.saveConfig(DEFAULT_CONFIG);
                return { ...DEFAULT_CONFIG };
            }
            // Merge with defaults to ensure all fields are present
            const mergedConfig = this.mergeWithDefaults(loadedConfig);
            console.log("‚úÖ Configuration loaded successfully");
            if (validation.warnings.length > 0) {
                console.warn("‚ö†Ô∏è Configuration warnings:", validation.warnings);
            }
            return mergedConfig;
        }
        catch (error) {
            console.error("‚ùå CONFIG_CORRUPTED: Failed to load configuration:", error);
            console.log("üìã Loading default configuration");
            // Save defaults
            this.saveConfig(DEFAULT_CONFIG);
            return { ...DEFAULT_CONFIG };
        }
    }
    /**
     * Save configuration to file with immediate write
     * Requirement 18.6: Write configuration to config.json file and apply changes immediately
     */
    saveConfig(config) {
        try {
            // Update version and timestamp
            config.version = (config.version || 0) + 1;
            config.lastModified = Date.now();
            // Validate before saving
            const validation = this.validateConfig(config);
            if (!validation.isValid) {
                throw new Error(`Invalid configuration: ${validation.errors.join(", ")}`);
            }
            // Ensure directory exists
            const configDir = (0, path_1.dirname)(this.configPath);
            if (!(0, fs_1.existsSync)(configDir)) {
                (0, fs_1.mkdirSync)(configDir, { recursive: true });
            }
            // Write to file immediately
            (0, fs_1.writeFileSync)(this.configPath, JSON.stringify(config, null, 2), "utf8");
            // Update internal config
            const oldConfig = { ...this.config };
            this.config = { ...config };
            // Emit change event
            this.emit("configChanged", {
                section: "all",
                oldValue: oldConfig,
                newValue: config,
                timestamp: Date.now(),
            });
            console.log("üíæ Configuration saved successfully");
        }
        catch (error) {
            console.error("‚ùå Failed to save configuration:", error);
            throw error;
        }
    }
    /**
     * Get current configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Update alignment weights
     * Requirement 18.2: Allow adjustment of Daily weight (30-60%), 4H weight (20-40%), 15m weight (10-30%)
     */
    updateAlignmentWeights(weights) {
        const newWeights = { ...this.config.alignmentWeights, ...weights };
        // Validate individual weight ranges first
        if (newWeights.daily < 30 || newWeights.daily > 60) {
            throw new Error(`Daily weight must be 30-60%, got ${newWeights.daily}%`);
        }
        if (newWeights.h4 < 20 || newWeights.h4 > 40) {
            throw new Error(`4H weight must be 20-40%, got ${newWeights.h4}%`);
        }
        if (newWeights.m15 < 10 || newWeights.m15 > 30) {
            throw new Error(`15m weight must be 10-30%, got ${newWeights.m15}%`);
        }
        // Validate weights sum to 100%
        const total = newWeights.daily + newWeights.h4 + newWeights.m15;
        if (Math.abs(total - 100) > 0.1) {
            throw new Error(`Alignment weights must sum to 100%, got ${total}%`);
        }
        const newConfig = {
            ...this.config,
            alignmentWeights: newWeights,
        };
        this.saveConfig(newConfig);
    }
    /**
     * Update RS configuration
     * Requirement 18.3: Allow adjustment of RS threshold (0-5%) and lookback period (2-8 hours)
     */
    updateRSConfig(rsConfig) {
        const newRSConfig = { ...this.config.rsConfig, ...rsConfig };
        const newConfig = {
            ...this.config,
            rsConfig: newRSConfig,
        };
        this.saveConfig(newConfig);
    }
    /**
     * Update risk configuration
     * Requirement 18.4: Allow adjustment of max leverage (3-5x), stop loss (1-3%), target (3-6%)
     */
    updateRiskConfig(riskConfig) {
        const newRiskConfig = { ...this.config.riskConfig, ...riskConfig };
        const newConfig = {
            ...this.config,
            riskConfig: newRiskConfig,
        };
        this.saveConfig(newConfig);
    }
    /**
     * Update portfolio configuration
     * Requirement 18.5: Allow adjustment of max positions (3-8), max heat (10-20%), correlation (0.6-0.9)
     */
    updatePortfolioConfig(portfolioConfig) {
        const newPortfolioConfig = {
            ...this.config.portfolioConfig,
            ...portfolioConfig,
        };
        const newConfig = {
            ...this.config,
            portfolioConfig: newPortfolioConfig,
        };
        this.saveConfig(newConfig);
    }
    /**
     * Start watching configuration file for changes (hot-reload)
     * Support hot-reload without restart
     */
    startWatching() {
        if (this.isWatching) {
            return;
        }
        this.isWatching = true;
        (0, fs_1.watchFile)(this.configPath, { interval: 1000 }, (curr, prev) => {
            if (curr.mtime !== prev.mtime) {
                console.log("üîÑ Configuration file changed, reloading...");
                try {
                    const newConfig = this.loadConfig();
                    const oldConfig = { ...this.config };
                    this.config = newConfig;
                    this.emit("configReloaded", {
                        section: "all",
                        oldValue: oldConfig,
                        newValue: newConfig,
                        timestamp: Date.now(),
                    });
                    console.log("‚úÖ Configuration reloaded successfully");
                }
                catch (error) {
                    console.error("‚ùå Failed to reload configuration:", error);
                }
            }
        });
        console.log("üëÅÔ∏è Started watching configuration file for changes");
    }
    /**
     * Stop watching configuration file
     */
    stopWatching() {
        if (!this.isWatching) {
            return;
        }
        (0, fs_1.unwatchFile)(this.configPath);
        this.isWatching = false;
        console.log("üëÅÔ∏è Stopped watching configuration file");
    }
    /**
     * Validate configuration against requirements
     */
    validateConfig(config) {
        const errors = [];
        const warnings = [];
        // Validate alignment weights
        if (!config.alignmentWeights) {
            errors.push("Missing alignmentWeights");
        }
        else {
            const { daily, h4, m15 } = config.alignmentWeights;
            if (daily < 30 || daily > 60) {
                errors.push(`Daily weight must be 30-60%, got ${daily}%`);
            }
            if (h4 < 20 || h4 > 40) {
                errors.push(`4H weight must be 20-40%, got ${h4}%`);
            }
            if (m15 < 10 || m15 > 30) {
                errors.push(`15m weight must be 10-30%, got ${m15}%`);
            }
            const total = daily + h4 + m15;
            if (Math.abs(total - 100) > 0.1) {
                errors.push(`Alignment weights must sum to 100%, got ${total}%`);
            }
        }
        // Validate RS config
        if (!config.rsConfig) {
            errors.push("Missing rsConfig");
        }
        else {
            const { threshold, lookbackPeriod } = config.rsConfig;
            if (threshold < 0 || threshold > 5) {
                errors.push(`RS threshold must be 0-5%, got ${threshold}%`);
            }
            if (lookbackPeriod < 2 || lookbackPeriod > 8) {
                errors.push(`RS lookback period must be 2-8 hours, got ${lookbackPeriod} hours`);
            }
        }
        // Validate risk config
        if (!config.riskConfig) {
            errors.push("Missing riskConfig");
        }
        else {
            const { maxLeverage, stopLossPercent, targetPercent } = config.riskConfig;
            if (maxLeverage < 3 || maxLeverage > 5) {
                errors.push(`Max leverage must be 3-5x, got ${maxLeverage}x`);
            }
            if (stopLossPercent < 1 || stopLossPercent > 3) {
                errors.push(`Stop loss must be 1-3%, got ${stopLossPercent}%`);
            }
            if (targetPercent < 3 || targetPercent > 6) {
                errors.push(`Target must be 3-6%, got ${targetPercent}%`);
            }
            // Check R:R ratio
            const rrRatio = targetPercent / stopLossPercent;
            if (rrRatio < 2.5) {
                warnings.push(`R:R ratio is ${rrRatio.toFixed(1)}:1, consider increasing target or decreasing stop`);
            }
        }
        // Validate portfolio config
        if (!config.portfolioConfig) {
            errors.push("Missing portfolioConfig");
        }
        else {
            const { maxConcurrentPositions, maxPortfolioHeat, correlationThreshold } = config.portfolioConfig;
            if (maxConcurrentPositions < 3 || maxConcurrentPositions > 8) {
                errors.push(`Max concurrent positions must be 3-8, got ${maxConcurrentPositions}`);
            }
            if (maxPortfolioHeat < 10 || maxPortfolioHeat > 20) {
                errors.push(`Max portfolio heat must be 10-20%, got ${maxPortfolioHeat}%`);
            }
            if (correlationThreshold < 0.6 || correlationThreshold > 0.9) {
                errors.push(`Correlation threshold must be 0.6-0.9, got ${correlationThreshold}`);
            }
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
        };
    }
    /**
     * Merge loaded config with defaults to ensure all fields are present
     */
    mergeWithDefaults(loadedConfig) {
        return {
            alignmentWeights: {
                ...DEFAULT_CONFIG.alignmentWeights,
                ...loadedConfig.alignmentWeights,
            },
            rsConfig: {
                ...DEFAULT_CONFIG.rsConfig,
                ...loadedConfig.rsConfig,
            },
            riskConfig: {
                ...DEFAULT_CONFIG.riskConfig,
                ...loadedConfig.riskConfig,
            },
            portfolioConfig: {
                ...DEFAULT_CONFIG.portfolioConfig,
                ...loadedConfig.portfolioConfig,
            },
            version: loadedConfig.version || DEFAULT_CONFIG.version,
            lastModified: loadedConfig.lastModified || Date.now(),
        };
    }
    /**
     * Reset configuration to defaults
     */
    resetToDefaults() {
        console.log("üîÑ Resetting configuration to defaults");
        this.saveConfig({ ...DEFAULT_CONFIG });
    }
    /**
     * Get configuration summary for display
     */
    getConfigSummary() {
        const config = this.config;
        return [
            `üìä Alignment: Daily ${config.alignmentWeights.daily}%, 4H ${config.alignmentWeights.h4}%, 15m ${config.alignmentWeights.m15}%`,
            `üìà RS: Threshold ${config.rsConfig.threshold}%, Lookback ${config.rsConfig.lookbackPeriod}h`,
            `‚ö° Risk: Leverage ${config.riskConfig.maxLeverage}x, Stop ${config.riskConfig.stopLossPercent}%, Target ${config.riskConfig.targetPercent}%`,
            `üíº Portfolio: Max ${config.portfolioConfig.maxConcurrentPositions} positions, Heat ${config.portfolioConfig.maxPortfolioHeat}%, Correlation ${config.portfolioConfig.correlationThreshold}`,
        ].join("\n");
    }
    /**
     * Cleanup resources
     */
    destroy() {
        this.stopWatching();
        this.removeAllListeners();
    }
}
exports.ConfigManager = ConfigManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2NvbmZpZy9Db25maWdNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFFSCxtQ0FBc0M7QUFDdEMsMkJBT1k7QUFDWiwrQkFBcUM7QUFvRXJDOztHQUVHO0FBQ0gsTUFBTSxjQUFjLEdBQWlCO0lBQ25DLGdCQUFnQixFQUFFO1FBQ2hCLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTTtRQUNqQixFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU07UUFDZCxHQUFHLEVBQUUsRUFBRSxFQUFFLE1BQU07S0FDaEI7SUFDRCxRQUFRLEVBQUU7UUFDUixTQUFTLEVBQUUsQ0FBQyxFQUFFLEtBQUs7UUFDbkIsY0FBYyxFQUFFLENBQUMsRUFBRSxVQUFVO0tBQzlCO0lBQ0QsVUFBVSxFQUFFO1FBQ1YsV0FBVyxFQUFFLENBQUMsRUFBRSxLQUFLO1FBQ3JCLGVBQWUsRUFBRSxHQUFHLEVBQUUsT0FBTztRQUM3QixhQUFhLEVBQUUsR0FBRyxFQUFFLGlCQUFpQjtLQUN0QztJQUNELGVBQWUsRUFBRTtRQUNmLHNCQUFzQixFQUFFLENBQUMsRUFBRSxjQUFjO1FBQ3pDLGdCQUFnQixFQUFFLEVBQUUsRUFBRSxNQUFNO1FBQzVCLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxNQUFNO0tBQ2xDO0lBQ0QsT0FBTyxFQUFFLENBQUM7SUFDVixZQUFZLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtDQUN6QixDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFhLGFBQWMsU0FBUSxxQkFBWTtJQUNyQyxNQUFNLENBQWU7SUFDckIsVUFBVSxDQUFTO0lBQ25CLFVBQVUsR0FBWSxLQUFLLENBQUM7SUFFcEMsWUFBWSxrQkFBMEIsVUFBVTtRQUM5QyxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBQSxXQUFJLEVBQUMsZUFBZSxFQUFFLG9CQUFvQixDQUFDLENB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QyxTQUFTLGVBQWUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEdBQUc7WUFDN0Ysb0JBQW9CLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxXQUFXLE1BQU0sQ0FBQyxVQUFVLENBQUMsZUFBZSxhQUFhLE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBYSxHQUFHO1lBQzVJLHFCQUFxQixNQUFNLENBQUMsZUFBZSxDQUFDLHNCQUFzQixvQkFBb0IsTUFBTSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0Isa0JBQWtCLE1BQU0sQ0FBQyxlQUFlLENBQUMsb0JBQW9CLEVBQUU7U0FDN0wsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDZixDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7Q0FDRjtBQXBaRCxzQ0FvWkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2NvbmZpZy9Db25maWdNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29uZmlndXJhdGlvbiBNYW5hZ2VyIGZvciBUaXRhbiBQaGFzZSAyIC0gVGhlIEh1bnRlclxuICpcbiAqIFByb3ZpZGVzIHJ1bnRpbWUgY29uZmlndXJhdGlvbiBtYW5hZ2VtZW50IHdpdGggaG90LXJlbG9hZCBzdXBwb3J0LFxuICogZGVmYXVsdCB2YWx1ZXMsIGFuZCB2YWxpZGF0aW9uIGZvciBQaGFzZSAyIHNwZWNpZmljIHNldHRpbmdzLlxuICpcbiAqIFJlcXVpcmVtZW50czogMTguMS0xOC44IChSdW50aW1lIENvbmZpZ3VyYXRpb24pXG4gKi9cblxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xuaW1wb3J0IHtcbiAgZXhpc3RzU3luYyxcbiAgbWtkaXJTeW5jLFxuICByZWFkRmlsZVN5bmMsXG4gIHVud2F0Y2hGaWxlLFxuICB3YXRjaEZpbGUsXG4gIHdyaXRlRmlsZVN5bmMsXG59IGZyb20gXCJmc1wiO1xuaW1wb3J0IHsgZGlybmFtZSwgam9pbiB9IGZyb20gXCJwYXRoXCI7XG5cbi8qKlxuICogQWxpZ25tZW50IHdlaWdodCBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWxpZ25tZW50V2VpZ2h0cyB7XG4gIGRhaWx5OiBudW1iZXI7IC8vIDMwLTYwJVxuICBoNDogbnVtYmVyOyAvLyAyMC00MCVcbiAgbTE1OiBudW1iZXI7IC8vIDEwLTMwJVxufVxuXG4vKipcbiAqIFJlbGF0aXZlIFN0cmVuZ3RoIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSU0NvbmZpZyB7XG4gIHRocmVzaG9sZDogbnVtYmVyOyAvLyAwLTUlXG4gIGxvb2tiYWNrUGVyaW9kOiBudW1iZXI7IC8vIDItOCBob3Vyc1xufVxuXG4vKipcbiAqIFJpc2sgbWFuYWdlbWVudCBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmlza0NvbmZpZyB7XG4gIG1heExldmVyYWdlOiBudW1iZXI7IC8vIDMtNXhcbiAgc3RvcExvc3NQZXJjZW50OiBudW1iZXI7IC8vIDEtMyVcbiAgdGFyZ2V0UGVyY2VudDogbnVtYmVyOyAvLyAzLTYlXG59XG5cbi8qKlxuICogUG9ydGZvbGlvIG1hbmFnZW1lbnQgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBvcnRmb2xpb0NvbmZpZyB7XG4gIG1heENvbmN1cnJlbnRQb3NpdGlvbnM6IG51bWJlcjsgLy8gMy04XG4gIG1heFBvcnRmb2xpb0hlYXQ6IG51bWJlcjsgLy8gMTAtMjAlXG4gIGNvcnJlbGF0aW9uVGhyZXNob2xkOiBudW1iZXI7IC8vIDAuNi0wLjlcbn1cblxuLyoqXG4gKiBDb21wbGV0ZSBQaGFzZSAyIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQaGFzZTJDb25maWcge1xuICBhbGlnbm1lbnRXZWlnaHRzOiBBbGlnbm1lbnRXZWlnaHRzO1xuICByc0NvbmZpZzogUlNDb25maWc7XG4gIHJpc2tDb25maWc6IFJpc2tDb25maWc7XG4gIHBvcnRmb2xpb0NvbmZpZzogUG9ydGZvbGlvQ29uZmlnO1xuICB2ZXJzaW9uOiBudW1iZXI7XG4gIGxhc3RNb2RpZmllZDogbnVtYmVyO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgaXNWYWxpZDogYm9vbGVhbjtcbiAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgd2FybmluZ3M6IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gY2hhbmdlIGV2ZW50XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmlnQ2hhbmdlRXZlbnQge1xuICBzZWN0aW9uOiBrZXlvZiBQaGFzZTJDb25maWc7XG4gIG9sZFZhbHVlOiBhbnk7XG4gIG5ld1ZhbHVlOiBhbnk7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG4vKipcbiAqIERlZmF1bHQgY29uZmlndXJhdGlvbiB2YWx1ZXNcbiAqL1xuY29uc3QgREVGQVVMVF9DT05GSUc6IFBoYXNlMkNvbmZpZyA9IHtcbiAgYWxpZ25tZW50V2VpZ2h0czoge1xuICAgIGRhaWx5OiA1MCwgLy8gNTAlXG4gICAgaDQ6IDMwLCAvLyAzMCVcbiAgICBtMTU6IDIwLCAvLyAyMCVcbiAgfSxcbiAgcnNDb25maWc6IHtcbiAgICB0aHJlc2hvbGQ6IDIsIC8vIDIlXG4gICAgbG9va2JhY2tQZXJpb2Q6IDQsIC8vIDQgaG91cnNcbiAgfSxcbiAgcmlza0NvbmZpZzoge1xuICAgIG1heExldmVyYWdlOiA1LCAvLyA1eFxuICAgIHN0b3BMb3NzUGVyY2VudDogMS41LCAvLyAxLjUlXG4gICAgdGFyZ2V0UGVyY2VudDogNC41LCAvLyA0LjUlICgzOjEgUjpSKVxuICB9LFxuICBwb3J0Zm9saW9Db25maWc6IHtcbiAgICBtYXhDb25jdXJyZW50UG9zaXRpb25zOiA1LCAvLyA1IHBvc2l0aW9uc1xuICAgIG1heFBvcnRmb2xpb0hlYXQ6IDE1LCAvLyAxNSVcbiAgICBjb3JyZWxhdGlvblRocmVzaG9sZDogMC43LCAvLyAwLjdcbiAgfSxcbiAgdmVyc2lvbjogMSxcbiAgbGFzdE1vZGlmaWVkOiBEYXRlLm5vdygpLFxufTtcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIE1hbmFnZXIgZm9yIFBoYXNlIDJcbiAqL1xuZXhwb3J0IGNsYXNzIENvbmZpZ01hbmFnZXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIGNvbmZpZzogUGhhc2UyQ29uZmlnO1xuICBwcml2YXRlIGNvbmZpZ1BhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBpc1dhdGNoaW5nOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnRGlyZWN0b3J5OiBzdHJpbmcgPSBcIi4vY29uZmlnXCIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuY29uZmlnUGF0aCA9IGpvaW4oY29uZmlnRGlyZWN0b3J5LCBcInBoYXNlMi5jb25maWcuanNvblwiKTtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMubG9hZENvbmZpZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgY29uZmlndXJhdGlvbiBmcm9tIGZpbGUgd2l0aCBkZWZhdWx0c1xuICAgKiBSZXF1aXJlbWVudCAxOC44OiBMb2FkIGRlZmF1bHQgY29uZmlndXJhdGlvbiBpZiBmaWxlIGlzIGNvcnJ1cHRlZFxuICAgKi9cbiAgbG9hZENvbmZpZygpOiBQaGFzZTJDb25maWcge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIWV4aXN0c1N5bmModGhpcy5jb25maWdQYXRoKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfk4sgTm8gY29uZmlnIGZpbGUgZm91bmQsIGNyZWF0aW5nIGRlZmF1bHQgY29uZmlndXJhdGlvblwiKTtcbiAgICAgICAgdGhpcy5zYXZlQ29uZmlnKERFRkFVTFRfQ09ORklHKTtcbiAgICAgICAgcmV0dXJuIHsgLi4uREVGQVVMVF9DT05GSUcgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSByZWFkRmlsZVN5bmModGhpcy5jb25maWdQYXRoLCBcInV0ZjhcIik7XG4gICAgICBjb25zdCBsb2FkZWRDb25maWcgPSBKU09OLnBhcnNlKGZpbGVDb250ZW50KSBhcyBQaGFzZTJDb25maWc7XG5cbiAgICAgIC8vIFZhbGlkYXRlIGxvYWRlZCBjb25maWd1cmF0aW9uXG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZUNvbmZpZyhsb2FkZWRDb25maWcpO1xuICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBDT05GSUdfQ09SUlVQVEVEOiBJbnZhbGlkIGNvbmZpZ3VyYXRpb24gZmlsZVwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yczpcIiwgdmFsaWRhdGlvbi5lcnJvcnMpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfk4sgTG9hZGluZyBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cIik7XG5cbiAgICAgICAgLy8gQmFja3VwIGNvcnJ1cHRlZCBjb25maWdcbiAgICAgICAgY29uc3QgYmFja3VwUGF0aCA9IGAke3RoaXMuY29uZmlnUGF0aH0uY29ycnVwdGVkLiR7RGF0ZS5ub3coKX1gO1xuICAgICAgICB3cml0ZUZpbGVTeW5jKGJhY2t1cFBhdGgsIGZpbGVDb250ZW50KTtcbiAgICAgICAgY29uc29sZS5sb2coYPCfkr4gQ29ycnVwdGVkIGNvbmZpZyBiYWNrZWQgdXAgdG86ICR7YmFja3VwUGF0aH1gKTtcblxuICAgICAgICAvLyBMb2FkIGRlZmF1bHRzXG4gICAgICAgIHRoaXMuc2F2ZUNvbmZpZyhERUZBVUxUX0NPTkZJRyk7XG4gICAgICAgIHJldHVybiB7IC4uLkRFRkFVTFRfQ09ORklHIH07XG4gICAgICB9XG5cbiAgICAgIC8vIE1lcmdlIHdpdGggZGVmYXVsdHMgdG8gZW5zdXJlIGFsbCBmaWVsZHMgYXJlIHByZXNlbnRcbiAgICAgIGNvbnN0IG1lcmdlZENvbmZpZyA9IHRoaXMubWVyZ2VXaXRoRGVmYXVsdHMobG9hZGVkQ29uZmlnKTtcblxuICAgICAgY29uc29sZS5sb2coXCLinIUgQ29uZmlndXJhdGlvbiBsb2FkZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgaWYgKHZhbGlkYXRpb24ud2FybmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQ29uZmlndXJhdGlvbiB3YXJuaW5nczpcIiwgdmFsaWRhdGlvbi53YXJuaW5ncyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtZXJnZWRDb25maWc7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwi4p2MIENPTkZJR19DT1JSVVBURUQ6IEZhaWxlZCB0byBsb2FkIGNvbmZpZ3VyYXRpb246XCIsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+TiyBMb2FkaW5nIGRlZmF1bHQgY29uZmlndXJhdGlvblwiKTtcblxuICAgICAgLy8gU2F2ZSBkZWZhdWx0c1xuICAgICAgdGhpcy5zYXZlQ29uZmlnKERFRkFVTFRfQ09ORklHKTtcbiAgICAgIHJldHVybiB7IC4uLkRFRkFVTFRfQ09ORklHIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNhdmUgY29uZmlndXJhdGlvbiB0byBmaWxlIHdpdGggaW1tZWRpYXRlIHdyaXRlXG4gICAqIFJlcXVpcmVtZW50IDE4LjY6IFdyaXRlIGNvbmZpZ3VyYXRpb24gdG8gY29uZmlnLmpzb24gZmlsZSBhbmQgYXBwbHkgY2hhbmdlcyBpbW1lZGlhdGVseVxuICAgKi9cbiAgc2F2ZUNvbmZpZyhjb25maWc6IFBoYXNlMkNvbmZpZyk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICAvLyBVcGRhdGUgdmVyc2lvbiBhbmQgdGltZXN0YW1wXG4gICAgICBjb25maWcudmVyc2lvbiA9IChjb25maWcudmVyc2lvbiB8fCAwKSArIDE7XG4gICAgICBjb25maWcubGFzdE1vZGlmaWVkID0gRGF0ZS5ub3coKTtcblxuICAgICAgLy8gVmFsaWRhdGUgYmVmb3JlIHNhdmluZ1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVDb25maWcoY29uZmlnKTtcbiAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgSW52YWxpZCBjb25maWd1cmF0aW9uOiAke3ZhbGlkYXRpb24uZXJyb3JzLmpvaW4oXCIsIFwiKX1gLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgY29uc3QgY29uZmlnRGlyID0gZGlybmFtZSh0aGlzLmNvbmZpZ1BhdGgpO1xuICAgICAgaWYgKCFleGlzdHNTeW5jKGNvbmZpZ0RpcikpIHtcbiAgICAgICAgbWtkaXJTeW5jKGNvbmZpZ0RpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFdyaXRlIHRvIGZpbGUgaW1tZWRpYXRlbHlcbiAgICAgIHdyaXRlRmlsZVN5bmModGhpcy5jb25maWdQYXRoLCBKU09OLnN0cmluZ2lmeShjb25maWcsIG51bGwsIDIpLCBcInV0ZjhcIik7XG5cbiAgICAgIC8vIFVwZGF0ZSBpbnRlcm5hbCBjb25maWdcbiAgICAgIGNvbnN0IG9sZENvbmZpZyA9IHsgLi4udGhpcy5jb25maWcgfTtcbiAgICAgIHRoaXMuY29uZmlnID0geyAuLi5jb25maWcgfTtcblxuICAgICAgLy8gRW1pdCBjaGFuZ2UgZXZlbnRcbiAgICAgIHRoaXMuZW1pdChcImNvbmZpZ0NoYW5nZWRcIiwge1xuICAgICAgICBzZWN0aW9uOiBcImFsbFwiLFxuICAgICAgICBvbGRWYWx1ZTogb2xkQ29uZmlnLFxuICAgICAgICBuZXdWYWx1ZTogY29uZmlnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9IGFzIHVua25vd24gYXMgQ29uZmlnQ2hhbmdlRXZlbnQpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIvCfkr4gQ29uZmlndXJhdGlvbiBzYXZlZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIHNhdmUgY29uZmlndXJhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBQaGFzZTJDb25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGFsaWdubWVudCB3ZWlnaHRzXG4gICAqIFJlcXVpcmVtZW50IDE4LjI6IEFsbG93IGFkanVzdG1lbnQgb2YgRGFpbHkgd2VpZ2h0ICgzMC02MCUpLCA0SCB3ZWlnaHQgKDIwLTQwJSksIDE1bSB3ZWlnaHQgKDEwLTMwJSlcbiAgICovXG4gIHVwZGF0ZUFsaWdubWVudFdlaWdodHMod2VpZ2h0czogUGFydGlhbDxBbGlnbm1lbnRXZWlnaHRzPik6IHZvaWQge1xuICAgIGNvbnN0IG5ld1dlaWdodHMgPSB7IC4uLnRoaXMuY29uZmlnLmFsaWdubWVudFdlaWdodHMsIC4uLndlaWdodHMgfTtcblxuICAgIC8vIFZhbGlkYXRlIGluZGl2aWR1YWwgd2VpZ2h0IHJhbmdlcyBmaXJzdFxuICAgIGlmIChuZXdXZWlnaHRzLmRhaWx5IDwgMzAgfHwgbmV3V2VpZ2h0cy5kYWlseSA+IDYwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERhaWx5IHdlaWdodCBtdXN0IGJlIDMwLTYwJSwgZ290ICR7bmV3V2VpZ2h0cy5kYWlseX0lYCk7XG4gICAgfVxuICAgIGlmIChuZXdXZWlnaHRzLmg0IDwgMjAgfHwgbmV3V2VpZ2h0cy5oNCA+IDQwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYDRIIHdlaWdodCBtdXN0IGJlIDIwLTQwJSwgZ290ICR7bmV3V2VpZ2h0cy5oNH0lYCk7XG4gICAgfVxuICAgIGlmIChuZXdXZWlnaHRzLm0xNSA8IDEwIHx8IG5ld1dlaWdodHMubTE1ID4gMzApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgMTVtIHdlaWdodCBtdXN0IGJlIDEwLTMwJSwgZ290ICR7bmV3V2VpZ2h0cy5tMTV9JWApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHdlaWdodHMgc3VtIHRvIDEwMCVcbiAgICBjb25zdCB0b3RhbCA9IG5ld1dlaWdodHMuZGFpbHkgKyBuZXdXZWlnaHRzLmg0ICsgbmV3V2VpZ2h0cy5tMTU7XG4gICAgaWYgKE1hdGguYWJzKHRvdGFsIC0gMTAwKSA+IDAuMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbGlnbm1lbnQgd2VpZ2h0cyBtdXN0IHN1bSB0byAxMDAlLCBnb3QgJHt0b3RhbH0lYCk7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3Q29uZmlnID0ge1xuICAgICAgLi4udGhpcy5jb25maWcsXG4gICAgICBhbGlnbm1lbnRXZWlnaHRzOiBuZXdXZWlnaHRzLFxuICAgIH07XG5cbiAgICB0aGlzLnNhdmVDb25maWcobmV3Q29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgUlMgY29uZmlndXJhdGlvblxuICAgKiBSZXF1aXJlbWVudCAxOC4zOiBBbGxvdyBhZGp1c3RtZW50IG9mIFJTIHRocmVzaG9sZCAoMC01JSkgYW5kIGxvb2tiYWNrIHBlcmlvZCAoMi04IGhvdXJzKVxuICAgKi9cbiAgdXBkYXRlUlNDb25maWcocnNDb25maWc6IFBhcnRpYWw8UlNDb25maWc+KTogdm9pZCB7XG4gICAgY29uc3QgbmV3UlNDb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLnJzQ29uZmlnLCAuLi5yc0NvbmZpZyB9O1xuXG4gICAgY29uc3QgbmV3Q29uZmlnID0ge1xuICAgICAgLi4udGhpcy5jb25maWcsXG4gICAgICByc0NvbmZpZzogbmV3UlNDb25maWcsXG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZUNvbmZpZyhuZXdDb25maWcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSByaXNrIGNvbmZpZ3VyYXRpb25cbiAgICogUmVxdWlyZW1lbnQgMTguNDogQWxsb3cgYWRqdXN0bWVudCBvZiBtYXggbGV2ZXJhZ2UgKDMtNXgpLCBzdG9wIGxvc3MgKDEtMyUpLCB0YXJnZXQgKDMtNiUpXG4gICAqL1xuICB1cGRhdGVSaXNrQ29uZmlnKHJpc2tDb25maWc6IFBhcnRpYWw8Umlza0NvbmZpZz4pOiB2b2lkIHtcbiAgICBjb25zdCBuZXdSaXNrQ29uZmlnID0geyAuLi50aGlzLmNvbmZpZy5yaXNrQ29uZmlnLCAuLi5yaXNrQ29uZmlnIH07XG5cbiAgICBjb25zdCBuZXdDb25maWcgPSB7XG4gICAgICAuLi50aGlzLmNvbmZpZyxcbiAgICAgIHJpc2tDb25maWc6IG5ld1Jpc2tDb25maWcsXG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZUNvbmZpZyhuZXdDb25maWcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBwb3J0Zm9saW8gY29uZmlndXJhdGlvblxuICAgKiBSZXF1aXJlbWVudCAxOC41OiBBbGxvdyBhZGp1c3RtZW50IG9mIG1heCBwb3NpdGlvbnMgKDMtOCksIG1heCBoZWF0ICgxMC0yMCUpLCBjb3JyZWxhdGlvbiAoMC42LTAuOSlcbiAgICovXG4gIHVwZGF0ZVBvcnRmb2xpb0NvbmZpZyhwb3J0Zm9saW9Db25maWc6IFBhcnRpYWw8UG9ydGZvbGlvQ29uZmlnPik6IHZvaWQge1xuICAgIGNvbnN0IG5ld1BvcnRmb2xpb0NvbmZpZyA9IHtcbiAgICAgIC4uLnRoaXMuY29uZmlnLnBvcnRmb2xpb0NvbmZpZyxcbiAgICAgIC4uLnBvcnRmb2xpb0NvbmZpZyxcbiAgICB9O1xuXG4gICAgY29uc3QgbmV3Q29uZmlnID0ge1xuICAgICAgLi4udGhpcy5jb25maWcsXG4gICAgICBwb3J0Zm9saW9Db25maWc6IG5ld1BvcnRmb2xpb0NvbmZpZyxcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlQ29uZmlnKG5ld0NvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgd2F0Y2hpbmcgY29uZmlndXJhdGlvbiBmaWxlIGZvciBjaGFuZ2VzIChob3QtcmVsb2FkKVxuICAgKiBTdXBwb3J0IGhvdC1yZWxvYWQgd2l0aG91dCByZXN0YXJ0XG4gICAqL1xuICBzdGFydFdhdGNoaW5nKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzV2F0Y2hpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzV2F0Y2hpbmcgPSB0cnVlO1xuXG4gICAgd2F0Y2hGaWxlKHRoaXMuY29uZmlnUGF0aCwgeyBpbnRlcnZhbDogMTAwMCB9LCAoY3VyciwgcHJldikgPT4ge1xuICAgICAgaWYgKGN1cnIubXRpbWUgIT09IHByZXYubXRpbWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLwn5SEIENvbmZpZ3VyYXRpb24gZmlsZSBjaGFuZ2VkLCByZWxvYWRpbmcuLi5cIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbmV3Q29uZmlnID0gdGhpcy5sb2FkQ29uZmlnKCk7XG4gICAgICAgICAgY29uc3Qgb2xkQ29uZmlnID0geyAuLi50aGlzLmNvbmZpZyB9O1xuICAgICAgICAgIHRoaXMuY29uZmlnID0gbmV3Q29uZmlnO1xuXG4gICAgICAgICAgdGhpcy5lbWl0KFwiY29uZmlnUmVsb2FkZWRcIiwge1xuICAgICAgICAgICAgc2VjdGlvbjogXCJhbGxcIixcbiAgICAgICAgICAgIG9sZFZhbHVlOiBvbGRDb25maWcsXG4gICAgICAgICAgICBuZXdWYWx1ZTogbmV3Q29uZmlnLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIH0gYXMgdW5rbm93biBhcyBDb25maWdDaGFuZ2VFdmVudCk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBDb25maWd1cmF0aW9uIHJlbG9hZGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEZhaWxlZCB0byByZWxvYWQgY29uZmlndXJhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcIvCfkYHvuI8gU3RhcnRlZCB3YXRjaGluZyBjb25maWd1cmF0aW9uIGZpbGUgZm9yIGNoYW5nZXNcIik7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCB3YXRjaGluZyBjb25maWd1cmF0aW9uIGZpbGVcbiAgICovXG4gIHN0b3BXYXRjaGluZygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNXYXRjaGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHVud2F0Y2hGaWxlKHRoaXMuY29uZmlnUGF0aCk7XG4gICAgdGhpcy5pc1dhdGNoaW5nID0gZmFsc2U7XG4gICAgY29uc29sZS5sb2coXCLwn5GB77iPIFN0b3BwZWQgd2F0Y2hpbmcgY29uZmlndXJhdGlvbiBmaWxlXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGNvbmZpZ3VyYXRpb24gYWdhaW5zdCByZXF1aXJlbWVudHNcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVDb25maWcoY29uZmlnOiBQaGFzZTJDb25maWcpOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBWYWxpZGF0ZSBhbGlnbm1lbnQgd2VpZ2h0c1xuICAgIGlmICghY29uZmlnLmFsaWdubWVudFdlaWdodHMpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiTWlzc2luZyBhbGlnbm1lbnRXZWlnaHRzXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IGRhaWx5LCBoNCwgbTE1IH0gPSBjb25maWcuYWxpZ25tZW50V2VpZ2h0cztcblxuICAgICAgaWYgKGRhaWx5IDwgMzAgfHwgZGFpbHkgPiA2MCkge1xuICAgICAgICBlcnJvcnMucHVzaChgRGFpbHkgd2VpZ2h0IG11c3QgYmUgMzAtNjAlLCBnb3QgJHtkYWlseX0lYCk7XG4gICAgICB9XG4gICAgICBpZiAoaDQgPCAyMCB8fCBoNCA+IDQwKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGA0SCB3ZWlnaHQgbXVzdCBiZSAyMC00MCUsIGdvdCAke2g0fSVgKTtcbiAgICAgIH1cbiAgICAgIGlmIChtMTUgPCAxMCB8fCBtMTUgPiAzMCkge1xuICAgICAgICBlcnJvcnMucHVzaChgMTVtIHdlaWdodCBtdXN0IGJlIDEwLTMwJSwgZ290ICR7bTE1fSVgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG90YWwgPSBkYWlseSArIGg0ICsgbTE1O1xuICAgICAgaWYgKE1hdGguYWJzKHRvdGFsIC0gMTAwKSA+IDAuMSkge1xuICAgICAgICBlcnJvcnMucHVzaChgQWxpZ25tZW50IHdlaWdodHMgbXVzdCBzdW0gdG8gMTAwJSwgZ290ICR7dG90YWx9JWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIFJTIGNvbmZpZ1xuICAgIGlmICghY29uZmlnLnJzQ29uZmlnKSB7XG4gICAgICBlcnJvcnMucHVzaChcIk1pc3NpbmcgcnNDb25maWdcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHsgdGhyZXNob2xkLCBsb29rYmFja1BlcmlvZCB9ID0gY29uZmlnLnJzQ29uZmlnO1xuXG4gICAgICBpZiAodGhyZXNob2xkIDwgMCB8fCB0aHJlc2hvbGQgPiA1KSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBSUyB0aHJlc2hvbGQgbXVzdCBiZSAwLTUlLCBnb3QgJHt0aHJlc2hvbGR9JWApO1xuICAgICAgfVxuICAgICAgaWYgKGxvb2tiYWNrUGVyaW9kIDwgMiB8fCBsb29rYmFja1BlcmlvZCA+IDgpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgYFJTIGxvb2tiYWNrIHBlcmlvZCBtdXN0IGJlIDItOCBob3VycywgZ290ICR7bG9va2JhY2tQZXJpb2R9IGhvdXJzYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByaXNrIGNvbmZpZ1xuICAgIGlmICghY29uZmlnLnJpc2tDb25maWcpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiTWlzc2luZyByaXNrQ29uZmlnXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IG1heExldmVyYWdlLCBzdG9wTG9zc1BlcmNlbnQsIHRhcmdldFBlcmNlbnQgfSA9IGNvbmZpZy5yaXNrQ29uZmlnO1xuXG4gICAgICBpZiAobWF4TGV2ZXJhZ2UgPCAzIHx8IG1heExldmVyYWdlID4gNSkge1xuICAgICAgICBlcnJvcnMucHVzaChgTWF4IGxldmVyYWdlIG11c3QgYmUgMy01eCwgZ290ICR7bWF4TGV2ZXJhZ2V9eGApO1xuICAgICAgfVxuICAgICAgaWYgKHN0b3BMb3NzUGVyY2VudCA8IDEgfHwgc3RvcExvc3NQZXJjZW50ID4gMykge1xuICAgICAgICBlcnJvcnMucHVzaChgU3RvcCBsb3NzIG11c3QgYmUgMS0zJSwgZ290ICR7c3RvcExvc3NQZXJjZW50fSVgKTtcbiAgICAgIH1cbiAgICAgIGlmICh0YXJnZXRQZXJjZW50IDwgMyB8fCB0YXJnZXRQZXJjZW50ID4gNikge1xuICAgICAgICBlcnJvcnMucHVzaChgVGFyZ2V0IG11c3QgYmUgMy02JSwgZ290ICR7dGFyZ2V0UGVyY2VudH0lYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIFI6UiByYXRpb1xuICAgICAgY29uc3QgcnJSYXRpbyA9IHRhcmdldFBlcmNlbnQgLyBzdG9wTG9zc1BlcmNlbnQ7XG4gICAgICBpZiAocnJSYXRpbyA8IDIuNSkge1xuICAgICAgICB3YXJuaW5ncy5wdXNoKFxuICAgICAgICAgIGBSOlIgcmF0aW8gaXMgJHtcbiAgICAgICAgICAgIHJyUmF0aW8udG9GaXhlZCgxKVxuICAgICAgICAgIH06MSwgY29uc2lkZXIgaW5jcmVhc2luZyB0YXJnZXQgb3IgZGVjcmVhc2luZyBzdG9wYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBwb3J0Zm9saW8gY29uZmlnXG4gICAgaWYgKCFjb25maWcucG9ydGZvbGlvQ29uZmlnKSB7XG4gICAgICBlcnJvcnMucHVzaChcIk1pc3NpbmcgcG9ydGZvbGlvQ29uZmlnXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IG1heENvbmN1cnJlbnRQb3NpdGlvbnMsIG1heFBvcnRmb2xpb0hlYXQsIGNvcnJlbGF0aW9uVGhyZXNob2xkIH0gPVxuICAgICAgICBjb25maWcucG9ydGZvbGlvQ29uZmlnO1xuXG4gICAgICBpZiAobWF4Q29uY3VycmVudFBvc2l0aW9ucyA8IDMgfHwgbWF4Q29uY3VycmVudFBvc2l0aW9ucyA+IDgpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgYE1heCBjb25jdXJyZW50IHBvc2l0aW9ucyBtdXN0IGJlIDMtOCwgZ290ICR7bWF4Q29uY3VycmVudFBvc2l0aW9uc31gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKG1heFBvcnRmb2xpb0hlYXQgPCAxMCB8fCBtYXhQb3J0Zm9saW9IZWF0ID4gMjApIHtcbiAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgYE1heCBwb3J0Zm9saW8gaGVhdCBtdXN0IGJlIDEwLTIwJSwgZ290ICR7bWF4UG9ydGZvbGlvSGVhdH0lYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb3JyZWxhdGlvblRocmVzaG9sZCA8IDAuNiB8fCBjb3JyZWxhdGlvblRocmVzaG9sZCA+IDAuOSkge1xuICAgICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgICBgQ29ycmVsYXRpb24gdGhyZXNob2xkIG11c3QgYmUgMC42LTAuOSwgZ290ICR7Y29ycmVsYXRpb25UaHJlc2hvbGR9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTWVyZ2UgbG9hZGVkIGNvbmZpZyB3aXRoIGRlZmF1bHRzIHRvIGVuc3VyZSBhbGwgZmllbGRzIGFyZSBwcmVzZW50XG4gICAqL1xuICBwcml2YXRlIG1lcmdlV2l0aERlZmF1bHRzKGxvYWRlZENvbmZpZzogUGFydGlhbDxQaGFzZTJDb25maWc+KTogUGhhc2UyQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxpZ25tZW50V2VpZ2h0czoge1xuICAgICAgICAuLi5ERUZBVUxUX0NPTkZJRy5hbGlnbm1lbnRXZWlnaHRzLFxuICAgICAgICAuLi5sb2FkZWRDb25maWcuYWxpZ25tZW50V2VpZ2h0cyxcbiAgICAgIH0sXG4gICAgICByc0NvbmZpZzoge1xuICAgICAgICAuLi5ERUZBVUxUX0NPTkZJRy5yc0NvbmZpZyxcbiAgICAgICAgLi4ubG9hZGVkQ29uZmlnLnJzQ29uZmlnLFxuICAgICAgfSxcbiAgICAgIHJpc2tDb25maWc6IHtcbiAgICAgICAgLi4uREVGQVVMVF9DT05GSUcucmlza0NvbmZpZyxcbiAgICAgICAgLi4ubG9hZGVkQ29uZmlnLnJpc2tDb25maWcsXG4gICAgICB9LFxuICAgICAgcG9ydGZvbGlvQ29uZmlnOiB7XG4gICAgICAgIC4uLkRFRkFVTFRfQ09ORklHLnBvcnRmb2xpb0NvbmZpZyxcbiAgICAgICAgLi4ubG9hZGVkQ29uZmlnLnBvcnRmb2xpb0NvbmZpZyxcbiAgICAgIH0sXG4gICAgICB2ZXJzaW9uOiBsb2FkZWRDb25maWcudmVyc2lvbiB8fCBERUZBVUxUX0NPTkZJRy52ZXJzaW9uLFxuICAgICAgbGFzdE1vZGlmaWVkOiBsb2FkZWRDb25maWcubGFzdE1vZGlmaWVkIHx8IERhdGUubm93KCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBjb25maWd1cmF0aW9uIHRvIGRlZmF1bHRzXG4gICAqL1xuICByZXNldFRvRGVmYXVsdHMoKTogdm9pZCB7XG4gICAgY29uc29sZS5sb2coXCLwn5SEIFJlc2V0dGluZyBjb25maWd1cmF0aW9uIHRvIGRlZmF1bHRzXCIpO1xuICAgIHRoaXMuc2F2ZUNvbmZpZyh7IC4uLkRFRkFVTFRfQ09ORklHIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb25maWd1cmF0aW9uIHN1bW1hcnkgZm9yIGRpc3BsYXlcbiAgICovXG4gIGdldENvbmZpZ1N1bW1hcnkoKTogc3RyaW5nIHtcbiAgICBjb25zdCBjb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICByZXR1cm4gW1xuICAgICAgYPCfk4ogQWxpZ25tZW50OiBEYWlseSAke2NvbmZpZy5hbGlnbm1lbnRXZWlnaHRzLmRhaWx5fSUsIDRIICR7Y29uZmlnLmFsaWdubWVudFdlaWdodHMuaDR9JSwgMTVtICR7Y29uZmlnLmFsaWdubWVudFdlaWdodHMubTE1fSVgLFxuICAgICAgYPCfk4ggUlM6IFRocmVzaG9sZCAke2NvbmZpZy5yc0NvbmZpZy50aHJlc2hvbGR9JSwgTG9va2JhY2sgJHtjb25maWcucnNDb25maWcubG9va2JhY2tQZXJpb2R9aGAsXG4gICAgICBg4pqhIFJpc2s6IExldmVyYWdlICR7Y29uZmlnLnJpc2tDb25maWcubWF4TGV2ZXJhZ2V9eCwgU3RvcCAke2NvbmZpZy5yaXNrQ29uZmlnLnN0b3BMb3NzUGVyY2VudH0lLCBUYXJnZXQgJHtjb25maWcucmlza0NvbmZpZy50YXJnZXRQZXJjZW50fSVgLFxuICAgICAgYPCfkrwgUG9ydGZvbGlvOiBNYXggJHtjb25maWcucG9ydGZvbGlvQ29uZmlnLm1heENvbmN1cnJlbnRQb3NpdGlvbnN9IHBvc2l0aW9ucywgSGVhdCAke2NvbmZpZy5wb3J0Zm9saW9Db25maWcubWF4UG9ydGZvbGlvSGVhdH0lLCBDb3JyZWxhdGlvbiAke2NvbmZpZy5wb3J0Zm9saW9Db25maWcuY29ycmVsYXRpb25UaHJlc2hvbGR9YCxcbiAgICBdLmpvaW4oXCJcXG5cIik7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW51cCByZXNvdXJjZXNcbiAgICovXG4gIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdG9wV2F0Y2hpbmcoKTtcbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=