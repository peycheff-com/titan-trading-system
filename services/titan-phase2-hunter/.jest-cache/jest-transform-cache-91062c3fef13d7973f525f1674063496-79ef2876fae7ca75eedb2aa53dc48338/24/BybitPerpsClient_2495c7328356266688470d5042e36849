13e5e0bdad0aaf6efea0613482e632b5
"use strict";
/**
 * Bybit Perpetuals Client for Execution Target
 *
 * Provides REST API methods for order execution, data fetching, and account management.
 * Includes HMAC signature generation, caching, and retry logic.
 *
 * Requirements: 7.1-7.7 (Execution), 11.1-11.7 (Multi-Timeframe Data)
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BybitPerpsClient = void 0;
const crypto_1 = require("crypto");
// Import fetch with proper typing for Jest compatibility
const node_fetch_1 = __importDefault(require("node-fetch"));
class BybitPerpsClient {
    baseUrl = 'https://api.bybit.com';
    apiKey;
    apiSecret;
    cache = new Map();
    CACHE_TTL = 5 * 60 * 1000; // 5 minutes
    REQUEST_TIMEOUT = 10000; // 10 seconds
    RETRY_ATTEMPTS = 3;
    RETRY_DELAY = 1000; // 1 second
    constructor(apiKey, apiSecret) {
        this.apiKey = apiKey;
        this.apiSecret = apiSecret;
    }
    /**
     * Fetch top symbols by 24h volume (top 100)
     * @returns Promise with array of symbol names
     */
    async fetchTopSymbols() {
        const cacheKey = 'top_symbols';
        const cached = this.getFromCache(cacheKey);
        if (cached)
            return cached;
        try {
            const response = await this.makeRequest('GET', '/v5/market/tickers', {
                category: 'linear'
            });
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            // Sort by 24h volume and take top 100
            const tickers = response.result.list;
            const sortedSymbols = tickers
                .filter(ticker => ticker.symbol.endsWith('USDT'))
                .sort((a, b) => parseFloat(b.turnover24h) - parseFloat(a.turnover24h))
                .slice(0, 100)
                .map(ticker => ticker.symbol);
            this.setCache(cacheKey, sortedSymbols, this.CACHE_TTL);
            return sortedSymbols;
        }
        catch (error) {
            throw new Error(`Failed to fetch top symbols: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Fetch OHLCV data with caching (5-minute TTL)
     * @param symbol - Trading symbol (e.g., 'BTCUSDT')
     * @param interval - Timeframe ('1', '5', '15', '30', '60', '240', '1440')
     * @param limit - Number of candles (max 1000)
     * @returns Promise with OHLCV array
     */
    async fetchOHLCV(symbol, interval, limit = 200) {
        const cacheKey = `ohlcv_${symbol}_${interval}_${limit}`;
        const cached = this.getFromCache(cacheKey);
        if (cached)
            return cached;
        try {
            // Convert interval to Bybit format
            const bybitInterval = this.convertInterval(interval);
            const response = await this.makeRequest('GET', '/v5/market/kline', {
                category: 'linear',
                symbol: symbol.toUpperCase(),
                interval: bybitInterval,
                limit: Math.min(limit, 1000).toString()
            });
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const klineData = response.result;
            const ohlcv = klineData.list.map(candle => ({
                timestamp: parseInt(candle[0]),
                open: parseFloat(candle[1]),
                high: parseFloat(candle[2]),
                low: parseFloat(candle[3]),
                close: parseFloat(candle[4]),
                volume: parseFloat(candle[5])
            }));
            // Sort by timestamp (oldest first)
            ohlcv.sort((a, b) => a.timestamp - b.timestamp);
            this.setCache(cacheKey, ohlcv, this.CACHE_TTL);
            return ohlcv;
        }
        catch (error) {
            throw new Error(`Failed to fetch OHLCV for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Get current price for a symbol
     * @param symbol - Trading symbol (e.g., 'BTCUSDT')
     * @returns Promise with current price
     */
    async getCurrentPrice(symbol) {
        try {
            const response = await this.makeRequest('GET', '/v5/market/tickers', {
                category: 'linear',
                symbol: symbol.toUpperCase()
            });
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const ticker = response.result.list[0];
            if (!ticker) {
                throw new Error(`No ticker data found for ${symbol}`);
            }
            return parseFloat(ticker.lastPrice);
        }
        catch (error) {
            throw new Error(`Failed to get current price for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Get account equity
     * @returns Promise with total equity in USDT
     */
    async getEquity() {
        try {
            const response = await this.makeRequest('GET', '/v5/account/wallet-balance', {
                accountType: 'UNIFIED'
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const account = response.result.list[0];
            if (!account) {
                throw new Error('No account data found');
            }
            return parseFloat(account.totalEquity);
        }
        catch (error) {
            throw new Error(`Failed to get equity: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Place order with HMAC signature and Post-Only support
     * @param params - Order parameters
     * @returns Promise with order result
     */
    async placeOrder(params) {
        try {
            const orderParams = {
                category: 'linear',
                symbol: params.symbol.toUpperCase(),
                side: params.side,
                orderType: params.type === 'POST_ONLY' ? 'Limit' : params.type === 'LIMIT' ? 'Limit' : 'Market',
                qty: params.qty.toString(),
                timeInForce: params.type === 'POST_ONLY' ? 'PostOnly' : 'GTC'
            };
            // Add price for limit orders
            if (params.type === 'LIMIT' || params.type === 'POST_ONLY') {
                if (!params.price) {
                    throw new Error('Price is required for limit orders');
                }
                orderParams.price = params.price.toString();
            }
            // Add stop loss and take profit if provided
            if (params.stopLoss) {
                orderParams.stopLoss = params.stopLoss.toString();
            }
            if (params.takeProfit) {
                orderParams.takeProfit = params.takeProfit.toString();
            }
            const response = await this.makeRequest('POST', '/v5/order/create', orderParams, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const orderData = response.result;
            return {
                orderId: orderData.orderId,
                symbol: orderData.symbol,
                side: orderData.side,
                qty: parseFloat(orderData.qty),
                price: parseFloat(orderData.price || orderData.avgPrice || '0'),
                status: this.mapOrderStatus(orderData.orderStatus),
                timestamp: parseInt(orderData.createTime)
            };
        }
        catch (error) {
            throw new Error(`Failed to place order: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Place order with retry logic (2-second timeout)
     * @param params - Order parameters
     * @param maxRetries - Maximum retry attempts (default: 2)
     * @returns Promise with order result
     */
    async placeOrderWithRetry(params, maxRetries = 2) {
        let lastError;
        for (let attempt = 0; attempt <= maxRetries; attempt++) {
            try {
                // Set timeout for each attempt
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Order timeout after 2 seconds')), 2000);
                });
                const orderPromise = this.placeOrder(params);
                const result = await Promise.race([orderPromise, timeoutPromise]);
                return result;
            }
            catch (error) {
                lastError = error instanceof Error ? error : new Error('Unknown error');
                if (attempt < maxRetries) {
                    console.warn(`⚠️ Order attempt ${attempt + 1} failed, retrying: ${lastError.message}`);
                    await this.sleep(this.RETRY_DELAY);
                }
            }
        }
        throw new Error(`Order failed after ${maxRetries + 1} attempts: ${lastError.message}`);
    }
    /**
     * Set leverage for a symbol
     * @param symbol - Trading symbol
     * @param leverage - Leverage value (1-100)
     * @returns Promise with success status
     */
    async setLeverage(symbol, leverage) {
        try {
            const response = await this.makeRequest('POST', '/v5/position/set-leverage', {
                category: 'linear',
                symbol: symbol.toUpperCase(),
                buyLeverage: leverage.toString(),
                sellLeverage: leverage.toString()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            return true;
        }
        catch (error) {
            throw new Error(`Failed to set leverage for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Set stop loss for a position
     * @param symbol - Trading symbol
     * @param stopLoss - Stop loss price
     * @param positionIdx - Position index (0 for one-way mode)
     * @returns Promise with success status
     */
    async setStopLoss(symbol, stopLoss, positionIdx = 0) {
        try {
            const response = await this.makeRequest('POST', '/v5/position/trading-stop', {
                category: 'linear',
                symbol: symbol.toUpperCase(),
                stopLoss: stopLoss.toString(),
                positionIdx: positionIdx.toString()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            return true;
        }
        catch (error) {
            throw new Error(`Failed to set stop loss for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Set take profit for a position
     * @param symbol - Trading symbol
     * @param takeProfit - Take profit price
     * @param positionIdx - Position index (0 for one-way mode)
     * @returns Promise with success status
     */
    async setTakeProfit(symbol, takeProfit, positionIdx = 0) {
        try {
            const response = await this.makeRequest('POST', '/v5/position/trading-stop', {
                category: 'linear',
                symbol: symbol.toUpperCase(),
                takeProfit: takeProfit.toString(),
                positionIdx: positionIdx.toString()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            return true;
        }
        catch (error) {
            throw new Error(`Failed to set take profit for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Get order status
     * @param orderId - Order ID
     * @param symbol - Trading symbol
     * @returns Promise with order status
     */
    async getOrderStatus(orderId, symbol) {
        try {
            const response = await this.makeRequest('GET', '/v5/order/realtime', {
                category: 'linear',
                orderId: orderId,
                symbol: symbol.toUpperCase()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const orders = response.result.list;
            if (orders.length === 0) {
                throw new Error(`Order ${orderId} not found`);
            }
            return this.mapOrderStatus(orders[0].orderStatus);
        }
        catch (error) {
            throw new Error(`Failed to get order status: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Cancel order
     * @param orderId - Order ID
     * @param symbol - Trading symbol
     * @returns Promise with success status
     */
    async cancelOrder(orderId, symbol) {
        try {
            const response = await this.makeRequest('POST', '/v5/order/cancel', {
                category: 'linear',
                orderId: orderId,
                symbol: symbol.toUpperCase()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            return true;
        }
        catch (error) {
            throw new Error(`Failed to cancel order: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Get position info
     * @param symbol - Trading symbol
     * @returns Promise with position info
     */
    async getPositionInfo(symbol) {
        try {
            const response = await this.makeRequest('GET', '/v5/position/list', {
                category: 'linear',
                symbol: symbol.toUpperCase()
            }, true);
            if (response.retCode !== 0) {
                throw new Error(`Bybit API error: ${response.retMsg}`);
            }
            const positions = response.result.list;
            return positions.length > 0 ? positions[0] : null;
        }
        catch (error) {
            throw new Error(`Failed to get position info: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Make authenticated or public API request
     * @param method - HTTP method
     * @param endpoint - API endpoint
     * @param params - Request parameters
     * @param signed - Whether to sign the request
     * @returns Promise with API response
     */
    async makeRequest(method, endpoint, params = {}, signed = false) {
        const timestamp = Date.now().toString();
        let url = `${this.baseUrl}${endpoint}`;
        let body = '';
        // Prepare headers
        const headers = {
            'Content-Type': 'application/json',
            'X-BAPI-TIMESTAMP': timestamp,
            'X-BAPI-RECV-WINDOW': '5000'
        };
        if (signed) {
            headers['X-BAPI-API-KEY'] = this.apiKey;
        }
        // Prepare request data
        if (method === 'GET') {
            const queryString = new URLSearchParams(params).toString();
            if (queryString) {
                url += `?${queryString}`;
            }
        }
        else {
            body = JSON.stringify(params);
        }
        // Generate signature for authenticated requests
        if (signed) {
            const signaturePayload = timestamp + this.apiKey + '5000' + (method === 'GET' ? new URLSearchParams(params).toString() : body);
            headers['X-BAPI-SIGN'] = (0, crypto_1.createHmac)('sha256', this.apiSecret).update(signaturePayload).digest('hex');
        }
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), this.REQUEST_TIMEOUT);
            const response = await (0, node_fetch_1.default)(url, {
                method,
                headers,
                body: method === 'POST' ? body : undefined,
                signal: controller.signal
            });
            clearTimeout(timeoutId);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return await response.json();
        }
        catch (error) {
            if (error instanceof Error && error.name === 'AbortError') {
                throw new Error('Request timeout');
            }
            throw new Error(`Request failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Convert interval to Bybit format
     * @param interval - Standard interval
     * @returns Bybit interval format
     */
    convertInterval(interval) {
        const intervalMap = {
            '1m': '1',
            '5m': '5',
            '15m': '15',
            '30m': '30',
            '1h': '60',
            '4h': '240',
            '1d': 'D',
            '1D': 'D',
            '1w': 'W',
            '1W': 'W'
        };
        return intervalMap[interval] || interval;
    }
    /**
     * Map Bybit order status to standard format
     * @param bybitStatus - Bybit order status
     * @returns Standard order status
     */
    mapOrderStatus(bybitStatus) {
        const statusMap = {
            'New': 'NEW',
            'PartiallyFilled': 'PARTIALLY_FILLED',
            'Filled': 'FILLED',
            'Cancelled': 'CANCELLED',
            'Rejected': 'REJECTED',
            'PartiallyFilledCanceled': 'CANCELLED',
            'Deactivated': 'CANCELLED'
        };
        return statusMap[bybitStatus] || 'NEW';
    }
    /**
     * Get data from cache if valid
     * @param key - Cache key
     * @returns Cached data or null
     */
    getFromCache(key) {
        const entry = this.cache.get(key);
        if (!entry)
            return null;
        const now = Date.now();
        if (now - entry.timestamp > entry.ttl) {
            this.cache.delete(key);
            return null;
        }
        return entry.data;
    }
    /**
     * Set data in cache
     * @param key - Cache key
     * @param data - Data to cache
     * @param ttl - Time to live in milliseconds
     */
    setCache(key, data, ttl) {
        this.cache.set(key, {
            data,
            timestamp: Date.now(),
            ttl
        });
    }
    /**
     * Sleep for specified milliseconds
     * @param ms - Milliseconds to sleep
     * @returns Promise that resolves after delay
     */
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * Clear cache
     */
    clearCache() {
        this.cache.clear();
    }
    /**
     * Get cache size
     * @returns Number of cached entries
     */
    getCacheSize() {
        return this.cache.size;
    }
}
exports.BybitPerpsClient = BybitPerpsClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2V4Y2hhbmdlcy9CeWJpdFBlcnBzQ2xpZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7Ozs7QUFFSCxtQ0FBb0M7QUFHcEMseURBQXlEO0FBQ3pELDREQUErQjtBQXdIL0IsTUFBYSxnQkFBZ0I7SUFDbkIsT0FBTyxHQUFHLHVCQUF1QixDQUFDO0lBQ2xDLE1BQU0sQ0FBUztJQUNmLFNBQVMsQ0FBUztJQUNsQixLQUFLLEdBQUcsSUFBSSxHQUFHLEVBQTJCLENBQUM7SUFDbEMsU0FBUyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsWUFBWTtJQUN2QyxlQUFlLEdBQUcsS0FBSyxDQUFDLENBQUMsYUFBYTtJQUN0QyxjQUFjLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLFdBQVcsR0FBRyxJQUFJLENBQUMsQ0FBQyxXQUFXO0lBRWhELFlBQVksTUFBYyxFQUFFLFNBQWlCO1FBQzNDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQzdCLENBQUM7SUFFRDs7O09BR0c7SUFDSSxLQUFLLENBQUMsZUFBZTtRQUMxQixNQUFNLFFBQVEsR0FBRyxhQUFhLENBQUM7UUFDL0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBVyxRQUFRLENBQUMsQ0FBQztRQUNyRCxJQUFJLE1BQU07WUFBRSxPQUFPLE1BQU0sQ0FBQztRQUUxQixJQUFJLENBQUM7WUFDSCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLG9CQUFvQixFQUFFO2dCQUNuRSxRQUFRLEVBQUUsUUFBUTthQUNuQixDQUFDLENBQUM7WUFFSCxJQUFJLFFBQVEsQ0FBQyxPQUFPLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzNCLE1BQU0sSUFBSSxLQUFLLENB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dmljZXMvdGl0YW4tcGhhc2UyLWh1bnRlci9zcmMvZXhjaGFuZ2VzL0J5Yml0UGVycHNDbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCeWJpdCBQZXJwZXR1YWxzIENsaWVudCBmb3IgRXhlY3V0aW9uIFRhcmdldFxuICogXG4gKiBQcm92aWRlcyBSRVNUIEFQSSBtZXRob2RzIGZvciBvcmRlciBleGVjdXRpb24sIGRhdGEgZmV0Y2hpbmcsIGFuZCBhY2NvdW50IG1hbmFnZW1lbnQuXG4gKiBJbmNsdWRlcyBITUFDIHNpZ25hdHVyZSBnZW5lcmF0aW9uLCBjYWNoaW5nLCBhbmQgcmV0cnkgbG9naWMuXG4gKiBcbiAqIFJlcXVpcmVtZW50czogNy4xLTcuNyAoRXhlY3V0aW9uKSwgMTEuMS0xMS43IChNdWx0aS1UaW1lZnJhbWUgRGF0YSlcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVIbWFjIH0gZnJvbSAnY3J5cHRvJztcbmltcG9ydCB7IE9ITENWLCBPcmRlclBhcmFtcywgT3JkZXJSZXN1bHQsIE9yZGVyU3RhdHVzIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vLyBJbXBvcnQgZmV0Y2ggd2l0aCBwcm9wZXIgdHlwaW5nIGZvciBKZXN0IGNvbXBhdGliaWxpdHlcbmltcG9ydCBmZXRjaCBmcm9tICdub2RlLWZldGNoJztcblxuZXhwb3J0IGludGVyZmFjZSBCeWJpdFN5bWJvbEluZm8ge1xuICBzeW1ib2w6IHN0cmluZztcbiAgYmFzZUNvaW46IHN0cmluZztcbiAgcXVvdGVDb2luOiBzdHJpbmc7XG4gIHN0YXR1czogc3RyaW5nO1xuICBtYXJnaW5UcmFkaW5nOiBzdHJpbmc7XG4gIGxvdFNpemVGaWx0ZXI6IHtcbiAgICBiYXNlUHJlY2lzaW9uOiBzdHJpbmc7XG4gICAgcXVvdGVQcmVjaXNpb246IHN0cmluZztcbiAgICBtaW5PcmRlclF0eTogc3RyaW5nO1xuICAgIG1heE9yZGVyUXR5OiBzdHJpbmc7XG4gICAgbWluT3JkZXJBbXQ6IHN0cmluZztcbiAgICBtYXhPcmRlckFtdDogc3RyaW5nO1xuICB9O1xuICBwcmljZUZpbHRlcjoge1xuICAgIG1pblByaWNlOiBzdHJpbmc7XG4gICAgbWF4UHJpY2U6IHN0cmluZztcbiAgICB0aWNrU2l6ZTogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ5Yml0VGlja2VySW5mbyB7XG4gIHN5bWJvbDogc3RyaW5nO1xuICBiaWQxUHJpY2U6IHN0cmluZztcbiAgYmlkMVNpemU6IHN0cmluZztcbiAgYXNrMVByaWNlOiBzdHJpbmc7XG4gIGFzazFTaXplOiBzdHJpbmc7XG4gIGxhc3RQcmljZTogc3RyaW5nO1xuICBwcmV2UHJpY2UyNGg6IHN0cmluZztcbiAgcHJpY2UyNGhQY250OiBzdHJpbmc7XG4gIGhpZ2hQcmljZTI0aDogc3RyaW5nO1xuICBsb3dQcmljZTI0aDogc3RyaW5nO1xuICB0dXJub3ZlcjI0aDogc3RyaW5nO1xuICB2b2x1bWUyNGg6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCeWJpdEtsaW5lRGF0YSB7XG4gIHN5bWJvbDogc3RyaW5nO1xuICBjYXRlZ29yeTogc3RyaW5nO1xuICBsaXN0OiBzdHJpbmdbXVtdOyAvLyBbc3RhcnRUaW1lLCBvcGVuUHJpY2UsIGhpZ2hQcmljZSwgbG93UHJpY2UsIGNsb3NlUHJpY2UsIHZvbHVtZSwgdHVybm92ZXJdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnliaXRPcmRlclJlc3BvbnNlIHtcbiAgb3JkZXJJZDogc3RyaW5nO1xuICBvcmRlckxpbmtJZDogc3RyaW5nO1xuICBzeW1ib2w6IHN0cmluZztcbiAgY3JlYXRlVGltZTogc3RyaW5nO1xuICB1cGRhdGVUaW1lOiBzdHJpbmc7XG4gIHNpZGU6IHN0cmluZztcbiAgb3JkZXJUeXBlOiBzdHJpbmc7XG4gIHF0eTogc3RyaW5nO1xuICBwcmljZTogc3RyaW5nO1xuICBvcmRlclN0YXR1czogc3RyaW5nO1xuICB0aW1lSW5Gb3JjZTogc3RyaW5nO1xuICBhdmdQcmljZTogc3RyaW5nO1xuICBsZWF2ZXNRdHk6IHN0cmluZztcbiAgbGVhdmVzVmFsdWU6IHN0cmluZztcbiAgY3VtRXhlY1F0eTogc3RyaW5nO1xuICBjdW1FeGVjVmFsdWU6IHN0cmluZztcbiAgY3VtRXhlY0ZlZTogc3RyaW5nO1xuICByZWplY3RSZWFzb246IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCeWJpdEFjY291bnRJbmZvIHtcbiAgdG90YWxFcXVpdHk6IHN0cmluZztcbiAgdG90YWxXYWxsZXRCYWxhbmNlOiBzdHJpbmc7XG4gIHRvdGFsTWFyZ2luQmFsYW5jZTogc3RyaW5nO1xuICB0b3RhbEF2YWlsYWJsZUJhbGFuY2U6IHN0cmluZztcbiAgdG90YWxQZXJwVVBMOiBzdHJpbmc7XG4gIHRvdGFsSW5pdGlhbE1hcmdpbjogc3RyaW5nO1xuICB0b3RhbE1haW50ZW5hbmNlTWFyZ2luOiBzdHJpbmc7XG4gIGNvaW46IEFycmF5PHtcbiAgICBjb2luOiBzdHJpbmc7XG4gICAgZXF1aXR5OiBzdHJpbmc7XG4gICAgdXNkVmFsdWU6IHN0cmluZztcbiAgICB3YWxsZXRCYWxhbmNlOiBzdHJpbmc7XG4gICAgYXZhaWxhYmxlVG9XaXRoZHJhdzogc3RyaW5nO1xuICAgIGF2YWlsYWJsZVRvQm9ycm93OiBzdHJpbmc7XG4gICAgYm9ycm93QW1vdW50OiBzdHJpbmc7XG4gICAgYWNjcnVlZEludGVyZXN0OiBzdHJpbmc7XG4gICAgdG90YWxPcmRlcklNOiBzdHJpbmc7XG4gICAgdG90YWxQb3NpdGlvbklNOiBzdHJpbmc7XG4gICAgdG90YWxQb3NpdGlvbk1NOiBzdHJpbmc7XG4gICAgdW5yZWFsaXNlZFBubDogc3RyaW5nO1xuICAgIGN1bVJlYWxpc2VkUG5sOiBzdHJpbmc7XG4gIH0+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ5Yml0UG9zaXRpb25JbmZvIHtcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIGxldmVyYWdlOiBzdHJpbmc7XG4gIGF2Z1ByaWNlOiBzdHJpbmc7XG4gIGxpcVByaWNlOiBzdHJpbmc7XG4gIHJpc2tMaW1pdFZhbHVlOiBzdHJpbmc7XG4gIHRha2VQcm9maXQ6IHN0cmluZztcbiAgc3RvcExvc3M6IHN0cmluZztcbiAgdHJhaWxpbmdTdG9wOiBzdHJpbmc7XG4gIHVucmVhbGlzZWRQbmw6IHN0cmluZztcbiAgY3VtUmVhbGlzZWRQbmw6IHN0cmluZztcbiAgcG9zaXRpb25NTTogc3RyaW5nO1xuICBwb3NpdGlvbklNOiBzdHJpbmc7XG4gIHBvc2l0aW9uVmFsdWU6IHN0cmluZztcbiAgcG9zaXRpb25CYWxhbmNlOiBzdHJpbmc7XG4gIHNpemU6IHN0cmluZztcbiAgc2lkZTogc3RyaW5nO1xuICBwb3NpdGlvblN0YXR1czogc3RyaW5nO1xuICBtYXJrUHJpY2U6IHN0cmluZztcbiAgYnVzdFByaWNlOiBzdHJpbmc7XG4gIHBvc2l0aW9uSWR4OiBudW1iZXI7XG4gIHRyYWRlTW9kZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgQ2FjaGVFbnRyeTxUPiB7XG4gIGRhdGE6IFQ7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICB0dGw6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIEJ5Yml0UGVycHNDbGllbnQge1xuICBwcml2YXRlIGJhc2VVcmwgPSAnaHR0cHM6Ly9hcGkuYnliaXQuY29tJztcbiAgcHJpdmF0ZSBhcGlLZXk6IHN0cmluZztcbiAgcHJpdmF0ZSBhcGlTZWNyZXQ6IHN0cmluZztcbiAgcHJpdmF0ZSBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBDYWNoZUVudHJ5PGFueT4+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgQ0FDSEVfVFRMID0gNSAqIDYwICogMTAwMDsgLy8gNSBtaW51dGVzXG4gIHByaXZhdGUgcmVhZG9ubHkgUkVRVUVTVF9USU1FT1VUID0gMTAwMDA7IC8vIDEwIHNlY29uZHNcbiAgcHJpdmF0ZSByZWFkb25seSBSRVRSWV9BVFRFTVBUUyA9IDM7XG4gIHByaXZhdGUgcmVhZG9ubHkgUkVUUllfREVMQVkgPSAxMDAwOyAvLyAxIHNlY29uZFxuXG4gIGNvbnN0cnVjdG9yKGFwaUtleTogc3RyaW5nLCBhcGlTZWNyZXQ6IHN0cmluZykge1xuICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xuICAgIHRoaXMuYXBpU2VjcmV0ID0gYXBpU2VjcmV0O1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHRvcCBzeW1ib2xzIGJ5IDI0aCB2b2x1bWUgKHRvcCAxMDApXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCBhcnJheSBvZiBzeW1ib2wgbmFtZXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBmZXRjaFRvcFN5bWJvbHMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gJ3RvcF9zeW1ib2xzJztcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldEZyb21DYWNoZTxzdHJpbmdbXT4oY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHJldHVybiBjYWNoZWQ7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdHRVQnLCAnL3Y1L21hcmtldC90aWNrZXJzJywge1xuICAgICAgICBjYXRlZ29yeTogJ2xpbmVhcidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2UucmV0Q29kZSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ5Yml0IEFQSSBlcnJvcjogJHtyZXNwb25zZS5yZXRNc2d9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNvcnQgYnkgMjRoIHZvbHVtZSBhbmQgdGFrZSB0b3AgMTAwXG4gICAgICBjb25zdCB0aWNrZXJzID0gcmVzcG9uc2UucmVzdWx0Lmxpc3QgYXMgQnliaXRUaWNrZXJJbmZvW107XG4gICAgICBjb25zdCBzb3J0ZWRTeW1ib2xzID0gdGlja2Vyc1xuICAgICAgICAuZmlsdGVyKHRpY2tlciA9PiB0aWNrZXIuc3ltYm9sLmVuZHNXaXRoKCdVU0RUJykpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBwYXJzZUZsb2F0KGIudHVybm92ZXIyNGgpIC0gcGFyc2VGbG9hdChhLnR1cm5vdmVyMjRoKSlcbiAgICAgICAgLnNsaWNlKDAsIDEwMClcbiAgICAgICAgLm1hcCh0aWNrZXIgPT4gdGlja2VyLnN5bWJvbCk7XG5cbiAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHNvcnRlZFN5bWJvbHMsIHRoaXMuQ0FDSEVfVFRMKTtcbiAgICAgIHJldHVybiBzb3J0ZWRTeW1ib2xzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCB0b3Agc3ltYm9sczogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggT0hMQ1YgZGF0YSB3aXRoIGNhY2hpbmcgKDUtbWludXRlIFRUTClcbiAgICogQHBhcmFtIHN5bWJvbCAtIFRyYWRpbmcgc3ltYm9sIChlLmcuLCAnQlRDVVNEVCcpXG4gICAqIEBwYXJhbSBpbnRlcnZhbCAtIFRpbWVmcmFtZSAoJzEnLCAnNScsICcxNScsICczMCcsICc2MCcsICcyNDAnLCAnMTQ0MCcpXG4gICAqIEBwYXJhbSBsaW1pdCAtIE51bWJlciBvZiBjYW5kbGVzIChtYXggMTAwMClcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIE9ITENWIGFycmF5XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZmV0Y2hPSExDVihzeW1ib2w6IHN0cmluZywgaW50ZXJ2YWw6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDIwMCk6IFByb21pc2U8T0hMQ1ZbXT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYG9obGN2XyR7c3ltYm9sfV8ke2ludGVydmFsfV8ke2xpbWl0fWA7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRGcm9tQ2FjaGU8T0hMQ1ZbXT4oY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHJldHVybiBjYWNoZWQ7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ29udmVydCBpbnRlcnZhbCB0byBCeWJpdCBmb3JtYXRcbiAgICAgIGNvbnN0IGJ5Yml0SW50ZXJ2YWwgPSB0aGlzLmNvbnZlcnRJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnR0VUJywgJy92NS9tYXJrZXQva2xpbmUnLCB7XG4gICAgICAgIGNhdGVnb3J5OiAnbGluZWFyJyxcbiAgICAgICAgc3ltYm9sOiBzeW1ib2wudG9VcHBlckNhc2UoKSxcbiAgICAgICAgaW50ZXJ2YWw6IGJ5Yml0SW50ZXJ2YWwsXG4gICAgICAgIGxpbWl0OiBNYXRoLm1pbihsaW1pdCwgMTAwMCkudG9TdHJpbmcoKVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qga2xpbmVEYXRhID0gcmVzcG9uc2UucmVzdWx0IGFzIEJ5Yml0S2xpbmVEYXRhO1xuICAgICAgY29uc3Qgb2hsY3Y6IE9ITENWW10gPSBrbGluZURhdGEubGlzdC5tYXAoY2FuZGxlID0+ICh7XG4gICAgICAgIHRpbWVzdGFtcDogcGFyc2VJbnQoY2FuZGxlWzBdKSxcbiAgICAgICAgb3BlbjogcGFyc2VGbG9hdChjYW5kbGVbMV0pLFxuICAgICAgICBoaWdoOiBwYXJzZUZsb2F0KGNhbmRsZVsyXSksXG4gICAgICAgIGxvdzogcGFyc2VGbG9hdChjYW5kbGVbM10pLFxuICAgICAgICBjbG9zZTogcGFyc2VGbG9hdChjYW5kbGVbNF0pLFxuICAgICAgICB2b2x1bWU6IHBhcnNlRmxvYXQoY2FuZGxlWzVdKVxuICAgICAgfSkpO1xuXG4gICAgICAvLyBTb3J0IGJ5IHRpbWVzdGFtcCAob2xkZXN0IGZpcnN0KVxuICAgICAgb2hsY3Yuc29ydCgoYSwgYikgPT4gYS50aW1lc3RhbXAgLSBiLnRpbWVzdGFtcCk7XG5cbiAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIG9obGN2LCB0aGlzLkNBQ0hFX1RUTCk7XG4gICAgICByZXR1cm4gb2hsY3Y7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIE9ITENWIGZvciAke3N5bWJvbH06ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHByaWNlIGZvciBhIHN5bWJvbFxuICAgKiBAcGFyYW0gc3ltYm9sIC0gVHJhZGluZyBzeW1ib2wgKGUuZy4sICdCVENVU0RUJylcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIGN1cnJlbnQgcHJpY2VcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRDdXJyZW50UHJpY2Uoc3ltYm9sOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsICcvdjUvbWFya2V0L3RpY2tlcnMnLCB7XG4gICAgICAgIGNhdGVnb3J5OiAnbGluZWFyJyxcbiAgICAgICAgc3ltYm9sOiBzeW1ib2wudG9VcHBlckNhc2UoKVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGlja2VyID0gcmVzcG9uc2UucmVzdWx0Lmxpc3RbMF0gYXMgQnliaXRUaWNrZXJJbmZvO1xuICAgICAgaWYgKCF0aWNrZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyB0aWNrZXIgZGF0YSBmb3VuZCBmb3IgJHtzeW1ib2x9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRpY2tlci5sYXN0UHJpY2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgY3VycmVudCBwcmljZSBmb3IgJHtzeW1ib2x9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWNjb3VudCBlcXVpdHlcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHRvdGFsIGVxdWl0eSBpbiBVU0RUXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0RXF1aXR5KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnR0VUJywgJy92NS9hY2NvdW50L3dhbGxldC1iYWxhbmNlJywge1xuICAgICAgICBhY2NvdW50VHlwZTogJ1VOSUZJRUQnXG4gICAgICB9LCB0cnVlKTtcblxuICAgICAgaWYgKHJlc3BvbnNlLnJldENvZGUgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCeWJpdCBBUEkgZXJyb3I6ICR7cmVzcG9uc2UucmV0TXNnfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhY2NvdW50ID0gcmVzcG9uc2UucmVzdWx0Lmxpc3RbMF0gYXMgQnliaXRBY2NvdW50SW5mbztcbiAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGFjY291bnQgZGF0YSBmb3VuZCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGFyc2VGbG9hdChhY2NvdW50LnRvdGFsRXF1aXR5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IGVxdWl0eTogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGxhY2Ugb3JkZXIgd2l0aCBITUFDIHNpZ25hdHVyZSBhbmQgUG9zdC1Pbmx5IHN1cHBvcnRcbiAgICogQHBhcmFtIHBhcmFtcyAtIE9yZGVyIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIG9yZGVyIHJlc3VsdFxuICAgKi9cbiAgcHVibGljIGFzeW5jIHBsYWNlT3JkZXIocGFyYW1zOiBPcmRlclBhcmFtcyk6IFByb21pc2U8T3JkZXJSZXN1bHQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3JkZXJQYXJhbXM6IGFueSA9IHtcbiAgICAgICAgY2F0ZWdvcnk6ICdsaW5lYXInLFxuICAgICAgICBzeW1ib2w6IHBhcmFtcy5zeW1ib2wudG9VcHBlckNhc2UoKSxcbiAgICAgICAgc2lkZTogcGFyYW1zLnNpZGUsXG4gICAgICAgIG9yZGVyVHlwZTogcGFyYW1zLnR5cGUgPT09ICdQT1NUX09OTFknID8gJ0xpbWl0JyA6IHBhcmFtcy50eXBlID09PSAnTElNSVQnID8gJ0xpbWl0JyA6ICdNYXJrZXQnLFxuICAgICAgICBxdHk6IHBhcmFtcy5xdHkudG9TdHJpbmcoKSxcbiAgICAgICAgdGltZUluRm9yY2U6IHBhcmFtcy50eXBlID09PSAnUE9TVF9PTkxZJyA/ICdQb3N0T25seScgOiAnR1RDJ1xuICAgICAgfTtcblxuICAgICAgLy8gQWRkIHByaWNlIGZvciBsaW1pdCBvcmRlcnNcbiAgICAgIGlmIChwYXJhbXMudHlwZSA9PT0gJ0xJTUlUJyB8fCBwYXJhbXMudHlwZSA9PT0gJ1BPU1RfT05MWScpIHtcbiAgICAgICAgaWYgKCFwYXJhbXMucHJpY2UpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByaWNlIGlzIHJlcXVpcmVkIGZvciBsaW1pdCBvcmRlcnMnKTtcbiAgICAgICAgfVxuICAgICAgICBvcmRlclBhcmFtcy5wcmljZSA9IHBhcmFtcy5wcmljZS50b1N0cmluZygpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgc3RvcCBsb3NzIGFuZCB0YWtlIHByb2ZpdCBpZiBwcm92aWRlZFxuICAgICAgaWYgKHBhcmFtcy5zdG9wTG9zcykge1xuICAgICAgICBvcmRlclBhcmFtcy5zdG9wTG9zcyA9IHBhcmFtcy5zdG9wTG9zcy50b1N0cmluZygpO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmFtcy50YWtlUHJvZml0KSB7XG4gICAgICAgIG9yZGVyUGFyYW1zLnRha2VQcm9maXQgPSBwYXJhbXMudGFrZVByb2ZpdC50b1N0cmluZygpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ1BPU1QnLCAnL3Y1L29yZGVyL2NyZWF0ZScsIG9yZGVyUGFyYW1zLCB0cnVlKTtcblxuICAgICAgaWYgKHJlc3BvbnNlLnJldENvZGUgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCeWJpdCBBUEkgZXJyb3I6ICR7cmVzcG9uc2UucmV0TXNnfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmRlckRhdGEgPSByZXNwb25zZS5yZXN1bHQgYXMgQnliaXRPcmRlclJlc3BvbnNlO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcmRlcklkOiBvcmRlckRhdGEub3JkZXJJZCxcbiAgICAgICAgc3ltYm9sOiBvcmRlckRhdGEuc3ltYm9sLFxuICAgICAgICBzaWRlOiBvcmRlckRhdGEuc2lkZSBhcyAnQnV5JyB8ICdTZWxsJyxcbiAgICAgICAgcXR5OiBwYXJzZUZsb2F0KG9yZGVyRGF0YS5xdHkpLFxuICAgICAgICBwcmljZTogcGFyc2VGbG9hdChvcmRlckRhdGEucHJpY2UgfHwgb3JkZXJEYXRhLmF2Z1ByaWNlIHx8ICcwJyksXG4gICAgICAgIHN0YXR1czogdGhpcy5tYXBPcmRlclN0YXR1cyhvcmRlckRhdGEub3JkZXJTdGF0dXMpLFxuICAgICAgICB0aW1lc3RhbXA6IHBhcnNlSW50KG9yZGVyRGF0YS5jcmVhdGVUaW1lKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcGxhY2Ugb3JkZXI6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBsYWNlIG9yZGVyIHdpdGggcmV0cnkgbG9naWMgKDItc2Vjb25kIHRpbWVvdXQpXG4gICAqIEBwYXJhbSBwYXJhbXMgLSBPcmRlciBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSBtYXhSZXRyaWVzIC0gTWF4aW11bSByZXRyeSBhdHRlbXB0cyAoZGVmYXVsdDogMilcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIG9yZGVyIHJlc3VsdFxuICAgKi9cbiAgcHVibGljIGFzeW5jIHBsYWNlT3JkZXJXaXRoUmV0cnkocGFyYW1zOiBPcmRlclBhcmFtcywgbWF4UmV0cmllczogbnVtYmVyID0gMik6IFByb21pc2U8T3JkZXJSZXN1bHQ+IHtcbiAgICBsZXQgbGFzdEVycm9yOiBFcnJvcjtcblxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAwOyBhdHRlbXB0IDw9IG1heFJldHJpZXM7IGF0dGVtcHQrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gU2V0IHRpbWVvdXQgZm9yIGVhY2ggYXR0ZW1wdFxuICAgICAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPG5ldmVyPigoXywgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKCdPcmRlciB0aW1lb3V0IGFmdGVyIDIgc2Vjb25kcycpKSwgMjAwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG9yZGVyUHJvbWlzZSA9IHRoaXMucGxhY2VPcmRlcihwYXJhbXMpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9taXNlLnJhY2UoW29yZGVyUHJvbWlzZSwgdGltZW91dFByb21pc2VdKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsYXN0RXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChhdHRlbXB0IDwgbWF4UmV0cmllcykge1xuICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIE9yZGVyIGF0dGVtcHQgJHthdHRlbXB0ICsgMX0gZmFpbGVkLCByZXRyeWluZzogJHtsYXN0RXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnNsZWVwKHRoaXMuUkVUUllfREVMQVkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBPcmRlciBmYWlsZWQgYWZ0ZXIgJHttYXhSZXRyaWVzICsgMX0gYXR0ZW1wdHM6ICR7bGFzdEVycm9yIS5tZXNzYWdlfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBsZXZlcmFnZSBmb3IgYSBzeW1ib2xcbiAgICogQHBhcmFtIHN5bWJvbCAtIFRyYWRpbmcgc3ltYm9sXG4gICAqIEBwYXJhbSBsZXZlcmFnZSAtIExldmVyYWdlIHZhbHVlICgxLTEwMClcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHN1Y2Nlc3Mgc3RhdHVzXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0TGV2ZXJhZ2Uoc3ltYm9sOiBzdHJpbmcsIGxldmVyYWdlOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgJy92NS9wb3NpdGlvbi9zZXQtbGV2ZXJhZ2UnLCB7XG4gICAgICAgIGNhdGVnb3J5OiAnbGluZWFyJyxcbiAgICAgICAgc3ltYm9sOiBzeW1ib2wudG9VcHBlckNhc2UoKSxcbiAgICAgICAgYnV5TGV2ZXJhZ2U6IGxldmVyYWdlLnRvU3RyaW5nKCksXG4gICAgICAgIHNlbGxMZXZlcmFnZTogbGV2ZXJhZ2UudG9TdHJpbmcoKVxuICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCBsZXZlcmFnZSBmb3IgJHtzeW1ib2x9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc3RvcCBsb3NzIGZvciBhIHBvc2l0aW9uXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBUcmFkaW5nIHN5bWJvbFxuICAgKiBAcGFyYW0gc3RvcExvc3MgLSBTdG9wIGxvc3MgcHJpY2VcbiAgICogQHBhcmFtIHBvc2l0aW9uSWR4IC0gUG9zaXRpb24gaW5kZXggKDAgZm9yIG9uZS13YXkgbW9kZSlcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHN1Y2Nlc3Mgc3RhdHVzXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2V0U3RvcExvc3Moc3ltYm9sOiBzdHJpbmcsIHN0b3BMb3NzOiBudW1iZXIsIHBvc2l0aW9uSWR4OiBudW1iZXIgPSAwKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnUE9TVCcsICcvdjUvcG9zaXRpb24vdHJhZGluZy1zdG9wJywge1xuICAgICAgICBjYXRlZ29yeTogJ2xpbmVhcicsXG4gICAgICAgIHN5bWJvbDogc3ltYm9sLnRvVXBwZXJDYXNlKCksXG4gICAgICAgIHN0b3BMb3NzOiBzdG9wTG9zcy50b1N0cmluZygpLFxuICAgICAgICBwb3NpdGlvbklkeDogcG9zaXRpb25JZHgudG9TdHJpbmcoKVxuICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCBzdG9wIGxvc3MgZm9yICR7c3ltYm9sfTogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRha2UgcHJvZml0IGZvciBhIHBvc2l0aW9uXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBUcmFkaW5nIHN5bWJvbFxuICAgKiBAcGFyYW0gdGFrZVByb2ZpdCAtIFRha2UgcHJvZml0IHByaWNlXG4gICAqIEBwYXJhbSBwb3NpdGlvbklkeCAtIFBvc2l0aW9uIGluZGV4ICgwIGZvciBvbmUtd2F5IG1vZGUpXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCBzdWNjZXNzIHN0YXR1c1xuICAgKi9cbiAgcHVibGljIGFzeW5jIHNldFRha2VQcm9maXQoc3ltYm9sOiBzdHJpbmcsIHRha2VQcm9maXQ6IG51bWJlciwgcG9zaXRpb25JZHg6IG51bWJlciA9IDApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCdQT1NUJywgJy92NS9wb3NpdGlvbi90cmFkaW5nLXN0b3AnLCB7XG4gICAgICAgIGNhdGVnb3J5OiAnbGluZWFyJyxcbiAgICAgICAgc3ltYm9sOiBzeW1ib2wudG9VcHBlckNhc2UoKSxcbiAgICAgICAgdGFrZVByb2ZpdDogdGFrZVByb2ZpdC50b1N0cmluZygpLFxuICAgICAgICBwb3NpdGlvbklkeDogcG9zaXRpb25JZHgudG9TdHJpbmcoKVxuICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCB0YWtlIHByb2ZpdCBmb3IgJHtzeW1ib2x9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgb3JkZXIgc3RhdHVzXG4gICAqIEBwYXJhbSBvcmRlcklkIC0gT3JkZXIgSURcbiAgICogQHBhcmFtIHN5bWJvbCAtIFRyYWRpbmcgc3ltYm9sXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCBvcmRlciBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRPcmRlclN0YXR1cyhvcmRlcklkOiBzdHJpbmcsIHN5bWJvbDogc3RyaW5nKTogUHJvbWlzZTxPcmRlclN0YXR1cz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJ0dFVCcsICcvdjUvb3JkZXIvcmVhbHRpbWUnLCB7XG4gICAgICAgIGNhdGVnb3J5OiAnbGluZWFyJyxcbiAgICAgICAgb3JkZXJJZDogb3JkZXJJZCxcbiAgICAgICAgc3ltYm9sOiBzeW1ib2wudG9VcHBlckNhc2UoKVxuICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5yZXRDb2RlICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQnliaXQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnJldE1zZ31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3JkZXJzID0gcmVzcG9uc2UucmVzdWx0Lmxpc3QgYXMgQnliaXRPcmRlclJlc3BvbnNlW107XG4gICAgICBpZiAob3JkZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE9yZGVyICR7b3JkZXJJZH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLm1hcE9yZGVyU3RhdHVzKG9yZGVyc1swXS5vcmRlclN0YXR1cyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBvcmRlciBzdGF0dXM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbCBvcmRlclxuICAgKiBAcGFyYW0gb3JkZXJJZCAtIE9yZGVyIElEXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBUcmFkaW5nIHN5bWJvbFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggc3VjY2VzcyBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjYW5jZWxPcmRlcihvcmRlcklkOiBzdHJpbmcsIHN5bWJvbDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnUE9TVCcsICcvdjUvb3JkZXIvY2FuY2VsJywge1xuICAgICAgICBjYXRlZ29yeTogJ2xpbmVhcicsXG4gICAgICAgIG9yZGVySWQ6IG9yZGVySWQsXG4gICAgICAgIHN5bWJvbDogc3ltYm9sLnRvVXBwZXJDYXNlKClcbiAgICAgIH0sIHRydWUpO1xuXG4gICAgICBpZiAocmVzcG9uc2UucmV0Q29kZSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ5Yml0IEFQSSBlcnJvcjogJHtyZXNwb25zZS5yZXRNc2d9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjYW5jZWwgb3JkZXI6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwb3NpdGlvbiBpbmZvXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBUcmFkaW5nIHN5bWJvbFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggcG9zaXRpb24gaW5mb1xuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldFBvc2l0aW9uSW5mbyhzeW1ib2w6IHN0cmluZyk6IFByb21pc2U8QnliaXRQb3NpdGlvbkluZm8gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnR0VUJywgJy92NS9wb3NpdGlvbi9saXN0Jywge1xuICAgICAgICBjYXRlZ29yeTogJ2xpbmVhcicsXG4gICAgICAgIHN5bWJvbDogc3ltYm9sLnRvVXBwZXJDYXNlKClcbiAgICAgIH0sIHRydWUpO1xuXG4gICAgICBpZiAocmVzcG9uc2UucmV0Q29kZSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ5Yml0IEFQSSBlcnJvcjogJHtyZXNwb25zZS5yZXRNc2d9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IHJlc3BvbnNlLnJlc3VsdC5saXN0IGFzIEJ5Yml0UG9zaXRpb25JbmZvW107XG4gICAgICByZXR1cm4gcG9zaXRpb25zLmxlbmd0aCA+IDAgPyBwb3NpdGlvbnNbMF0gOiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgcG9zaXRpb24gaW5mbzogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFrZSBhdXRoZW50aWNhdGVkIG9yIHB1YmxpYyBBUEkgcmVxdWVzdFxuICAgKiBAcGFyYW0gbWV0aG9kIC0gSFRUUCBtZXRob2RcbiAgICogQHBhcmFtIGVuZHBvaW50IC0gQVBJIGVuZHBvaW50XG4gICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1ZXN0IHBhcmFtZXRlcnNcbiAgICogQHBhcmFtIHNpZ25lZCAtIFdoZXRoZXIgdG8gc2lnbiB0aGUgcmVxdWVzdFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggQVBJIHJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIG1ha2VSZXF1ZXN0KG1ldGhvZDogJ0dFVCcgfCAnUE9TVCcsIGVuZHBvaW50OiBzdHJpbmcsIHBhcmFtczogYW55ID0ge30sIHNpZ25lZDogYm9vbGVhbiA9IGZhbHNlKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpLnRvU3RyaW5nKCk7XG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0ke2VuZHBvaW50fWA7XG4gICAgbGV0IGJvZHkgPSAnJztcblxuICAgIC8vIFByZXBhcmUgaGVhZGVyc1xuICAgIGNvbnN0IGhlYWRlcnM6IGFueSA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAnWC1CQVBJLVRJTUVTVEFNUCc6IHRpbWVzdGFtcCxcbiAgICAgICdYLUJBUEktUkVDVi1XSU5ET1cnOiAnNTAwMCdcbiAgICB9O1xuXG4gICAgaWYgKHNpZ25lZCkge1xuICAgICAgaGVhZGVyc1snWC1CQVBJLUFQSS1LRVknXSA9IHRoaXMuYXBpS2V5O1xuICAgIH1cblxuICAgIC8vIFByZXBhcmUgcmVxdWVzdCBkYXRhXG4gICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXJhbXMpLnRvU3RyaW5nKCk7XG4gICAgICBpZiAocXVlcnlTdHJpbmcpIHtcbiAgICAgICAgdXJsICs9IGA/JHtxdWVyeVN0cmluZ31gO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBzaWduYXR1cmUgZm9yIGF1dGhlbnRpY2F0ZWQgcmVxdWVzdHNcbiAgICBpZiAoc2lnbmVkKSB7XG4gICAgICBjb25zdCBzaWduYXR1cmVQYXlsb2FkID0gdGltZXN0YW1wICsgdGhpcy5hcGlLZXkgKyAnNTAwMCcgKyAobWV0aG9kID09PSAnR0VUJyA/IG5ldyBVUkxTZWFyY2hQYXJhbXMocGFyYW1zKS50b1N0cmluZygpIDogYm9keSk7XG4gICAgICBoZWFkZXJzWydYLUJBUEktU0lHTiddID0gY3JlYXRlSG1hYygnc2hhMjU2JywgdGhpcy5hcGlTZWNyZXQpLnVwZGF0ZShzaWduYXR1cmVQYXlsb2FkKS5kaWdlc3QoJ2hleCcpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHRoaXMuUkVRVUVTVF9USU1FT1VUKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgbWV0aG9kLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBtZXRob2QgPT09ICdQT1NUJyA/IGJvZHkgOiB1bmRlZmluZWQsXG4gICAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWxcbiAgICAgIH0pO1xuXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3QgdGltZW91dCcpO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXF1ZXN0IGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCBpbnRlcnZhbCB0byBCeWJpdCBmb3JtYXRcbiAgICogQHBhcmFtIGludGVydmFsIC0gU3RhbmRhcmQgaW50ZXJ2YWxcbiAgICogQHJldHVybnMgQnliaXQgaW50ZXJ2YWwgZm9ybWF0XG4gICAqL1xuICBwcml2YXRlIGNvbnZlcnRJbnRlcnZhbChpbnRlcnZhbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBpbnRlcnZhbE1hcDogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICAgICcxbSc6ICcxJyxcbiAgICAgICc1bSc6ICc1JyxcbiAgICAgICcxNW0nOiAnMTUnLFxuICAgICAgJzMwbSc6ICczMCcsXG4gICAgICAnMWgnOiAnNjAnLFxuICAgICAgJzRoJzogJzI0MCcsXG4gICAgICAnMWQnOiAnRCcsXG4gICAgICAnMUQnOiAnRCcsXG4gICAgICAnMXcnOiAnVycsXG4gICAgICAnMVcnOiAnVydcbiAgICB9O1xuXG4gICAgcmV0dXJuIGludGVydmFsTWFwW2ludGVydmFsXSB8fCBpbnRlcnZhbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXAgQnliaXQgb3JkZXIgc3RhdHVzIHRvIHN0YW5kYXJkIGZvcm1hdFxuICAgKiBAcGFyYW0gYnliaXRTdGF0dXMgLSBCeWJpdCBvcmRlciBzdGF0dXNcbiAgICogQHJldHVybnMgU3RhbmRhcmQgb3JkZXIgc3RhdHVzXG4gICAqL1xuICBwcml2YXRlIG1hcE9yZGVyU3RhdHVzKGJ5Yml0U3RhdHVzOiBzdHJpbmcpOiBPcmRlclN0YXR1cyB7XG4gICAgY29uc3Qgc3RhdHVzTWFwOiB7IFtrZXk6IHN0cmluZ106IE9yZGVyU3RhdHVzIH0gPSB7XG4gICAgICAnTmV3JzogJ05FVycsXG4gICAgICAnUGFydGlhbGx5RmlsbGVkJzogJ1BBUlRJQUxMWV9GSUxMRUQnLFxuICAgICAgJ0ZpbGxlZCc6ICdGSUxMRUQnLFxuICAgICAgJ0NhbmNlbGxlZCc6ICdDQU5DRUxMRUQnLFxuICAgICAgJ1JlamVjdGVkJzogJ1JFSkVDVEVEJyxcbiAgICAgICdQYXJ0aWFsbHlGaWxsZWRDYW5jZWxlZCc6ICdDQU5DRUxMRUQnLFxuICAgICAgJ0RlYWN0aXZhdGVkJzogJ0NBTkNFTExFRCdcbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0YXR1c01hcFtieWJpdFN0YXR1c10gfHwgJ05FVyc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGRhdGEgZnJvbSBjYWNoZSBpZiB2YWxpZFxuICAgKiBAcGFyYW0ga2V5IC0gQ2FjaGUga2V5XG4gICAqIEByZXR1cm5zIENhY2hlZCBkYXRhIG9yIG51bGxcbiAgICovXG4gIHByaXZhdGUgZ2V0RnJvbUNhY2hlPFQ+KGtleTogc3RyaW5nKTogVCB8IG51bGwge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICBpZiAoIWVudHJ5KSByZXR1cm4gbnVsbDtcblxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgaWYgKG5vdyAtIGVudHJ5LnRpbWVzdGFtcCA+IGVudHJ5LnR0bCkge1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBlbnRyeS5kYXRhIGFzIFQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGRhdGEgaW4gY2FjaGVcbiAgICogQHBhcmFtIGtleSAtIENhY2hlIGtleVxuICAgKiBAcGFyYW0gZGF0YSAtIERhdGEgdG8gY2FjaGVcbiAgICogQHBhcmFtIHR0bCAtIFRpbWUgdG8gbGl2ZSBpbiBtaWxsaXNlY29uZHNcbiAgICovXG4gIHByaXZhdGUgc2V0Q2FjaGU8VD4oa2V5OiBzdHJpbmcsIGRhdGE6IFQsIHR0bDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB7XG4gICAgICBkYXRhLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdHRsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2xlZXAgZm9yIHNwZWNpZmllZCBtaWxsaXNlY29uZHNcbiAgICogQHBhcmFtIG1zIC0gTWlsbGlzZWNvbmRzIHRvIHNsZWVwXG4gICAqIEByZXR1cm5zIFByb21pc2UgdGhhdCByZXNvbHZlcyBhZnRlciBkZWxheVxuICAgKi9cbiAgcHJpdmF0ZSBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGNhY2hlXG4gICAqL1xuICBwdWJsaWMgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIHNpemVcbiAgICogQHJldHVybnMgTnVtYmVyIG9mIGNhY2hlZCBlbnRyaWVzXG4gICAqL1xuICBwdWJsaWMgZ2V0Q2FjaGVTaXplKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2FjaGUuc2l6ZTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==