746308af4e450d7809f7e79e227cd658
"use strict";
/**
 * Signal Generator for Titan Phase 2 - The Hunter
 *
 * Generates trading signals by combining all validation layers:
 * - Hologram alignment (A+ or B status)
 * - Session timing (Killzone requirement)
 * - Relative Strength filtering
 * - POI proximity validation
 * - CVD absorption confirmation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SignalGenerator = void 0;
class SignalGenerator {
    config;
    hologramEngine;
    sessionProfiler;
    inefficiencyMapper;
    cvdValidator;
    constructor(hologramEngine, sessionProfiler, inefficiencyMapper, cvdValidator, config = {}) {
        this.hologramEngine = hologramEngine;
        this.sessionProfiler = sessionProfiler;
        this.inefficiencyMapper = inefficiencyMapper;
        this.cvdValidator = cvdValidator;
        // Set default configuration
        this.config = {
            minAlignmentScore: 60,
            rsThreshold: 0.01,
            poiProximityPercent: 0.5,
            minCVDConfidence: 70,
            requireCVDConfirmation: true,
            ...config
        };
    }
    /**
     * Check if hologram status meets requirements for signal generation
     * Requirements: A+ or B alignment status
     */
    checkHologramStatus(hologram) {
        // Check if status is A+ or B
        if (hologram.status !== 'A+' && hologram.status !== 'B') {
            return false;
        }
        // Additional check: alignment score must meet minimum threshold
        if (hologram.status === 'B' && hologram.alignmentScore < this.config.minAlignmentScore) {
            return false;
        }
        // Check that veto logic hasn't blocked the signal
        if (hologram.veto.vetoed) {
            return false;
        }
        return true;
    }
    /**
     * Check if current session meets Killzone requirements
     * Requirements: Must be London (07:00-10:00 UTC) or NY (13:00-16:00 UTC) session
     */
    checkSession(session) {
        return this.sessionProfiler.isKillzone();
    }
    /**
     * Check if RS score meets directional filter requirements
     * Requirements: Long signals need RS > threshold, Short signals need RS < -threshold
     */
    checkRSScore(rsScore, direction) {
        if (direction === 'LONG') {
            return rsScore > this.config.rsThreshold;
        }
        else {
            return rsScore < -this.config.rsThreshold;
        }
    }
    /**
     * Check if current price is within proximity of relevant POIs
     * Requirements: Price must be within 0.5% of Order Block or FVG
     */
    checkPOIProximity(currentPrice, pois, direction) {
        const proximityThreshold = this.config.poiProximityPercent / 100;
        for (const poi of pois) {
            // Skip mitigated POIs
            if ('mitigated' in poi && poi.mitigated)
                continue;
            if ('swept' in poi && poi.swept)
                continue;
            let targetPrice;
            let poiValid = false;
            // Check POI type and direction compatibility
            if ('midpoint' in poi) {
                // FVG
                const fvg = poi;
                if (direction === 'LONG' && fvg.type === 'BULLISH') {
                    targetPrice = fvg.midpoint;
                    poiValid = true;
                }
                else if (direction === 'SHORT' && fvg.type === 'BEARISH') {
                    targetPrice = fvg.midpoint;
                    poiValid = true;
                }
            }
            else if ('high' in poi && 'low' in poi && !('strength' in poi)) {
                // Order Block
                const ob = poi;
                if (direction === 'LONG' && ob.type === 'BULLISH') {
                    targetPrice = ob.low; // Enter at bottom of bullish OB
                    poiValid = true;
                }
                else if (direction === 'SHORT' && ob.type === 'BEARISH') {
                    targetPrice = ob.high; // Enter at top of bearish OB
                    poiValid = true;
                }
            }
            else if ('strength' in poi) {
                // Liquidity Pool - less precise, use for confluence only
                const pool = poi;
                if (direction === 'LONG' && pool.type === 'LOW') {
                    targetPrice = pool.price;
                    poiValid = true;
                }
                else if (direction === 'SHORT' && pool.type === 'HIGH') {
                    targetPrice = pool.price;
                    poiValid = true;
                }
            }
            if (poiValid) {
                const distance = Math.abs(currentPrice - targetPrice) / currentPrice;
                if (distance <= proximityThreshold) {
                    return { valid: true, poi };
                }
            }
        }
        return { valid: false, poi: null };
    }
    /**
     * Check if CVD absorption provides required confirmation
     * Requirements: Must have absorption signal with sufficient confidence
     */
    checkCVDAbsorption(absorption, direction) {
        if (!this.config.requireCVDConfirmation) {
            return true; // CVD confirmation not required
        }
        if (!absorption) {
            return false; // No absorption detected
        }
        // Check confidence level
        if (absorption.confidence < this.config.minCVDConfidence) {
            return false;
        }
        // For LONG signals, we need absorption (buying pressure at lows)
        // For SHORT signals, we need distribution (selling pressure at highs)
        // Note: The current absorption interface only handles absorption
        // Distribution would need to be handled separately or the interface extended
        if (direction === 'LONG') {
            return true; // Absorption supports long entry
        }
        else {
            // For short signals, we would need distribution detection
            // For now, we'll accept absorption as general flow confirmation
            return true;
        }
    }
    /**
     * Validate all signal conditions
     */
    validateSignal(context, direction) {
        const hologramValid = this.checkHologramStatus(context.hologram);
        const sessionValid = this.checkSession(context.session);
        const rsValid = this.checkRSScore(context.hologram.rsScore, direction);
        const poiResult = this.checkPOIProximity(context.currentPrice, context.nearbyPOIs, direction);
        const cvdValid = this.checkCVDAbsorption(context.absorption, direction);
        const valid = hologramValid && sessionValid && rsValid && poiResult.valid && cvdValid;
        let reason = '';
        if (!hologramValid)
            reason += 'Hologram status invalid. ';
        if (!sessionValid)
            reason += 'Not in Killzone. ';
        if (!rsValid)
            reason += 'RS score insufficient. ';
        if (!poiResult.valid)
            reason += 'No POI proximity. ';
        if (!cvdValid)
            reason += 'CVD confirmation missing. ';
        if (valid) {
            reason = 'All conditions met';
        }
        return {
            valid,
            reason: reason.trim(),
            hologramValid,
            sessionValid,
            rsValid,
            poiValid: poiResult.valid,
            cvdValid
        };
    }
    /**
     * Calculate position size using Volatility-Adjusted Sizing
     * Formula: Risk_Dollars / (ATR * Stop_Distance_Multiplier)
     */
    calculatePositionSize(equity, riskPerTrade, atr, stopDistancePercent, currentPrice, leverage) {
        const riskDollars = equity * riskPerTrade;
        const stopDistance = currentPrice * (stopDistancePercent / 100);
        const positionSize = riskDollars / stopDistance;
        // Apply leverage constraint
        const maxPositionValue = equity * leverage;
        const maxPositionSize = maxPositionValue / currentPrice;
        return Math.min(positionSize, maxPositionSize);
    }
    /**
     * Generate trading signal with all validations
     */
    async generateSignal(symbol, direction, equity, riskPerTrade = 0.02, leverage = 3) {
        try {
            // Get hologram state
            const hologram = await this.hologramEngine.analyze(symbol);
            // Get session state
            const session = this.sessionProfiler.getSessionState();
            // Get current price from hologram
            const currentPrice = hologram.m15.currentPrice;
            // Get nearby POIs
            const nearbyPOIs = await this.getNearbyPOIs(symbol, currentPrice);
            // Get CVD absorption
            const absorption = await this.getCVDAbsorption(symbol);
            // Get ATR for position sizing (using 15m timeframe)
            const atr = await this.calculateATR(symbol, '15m');
            // Create signal context
            const context = {
                hologram,
                session,
                currentPrice,
                nearbyPOIs,
                absorption,
                atr
            };
            // Validate signal
            const validation = this.validateSignal(context, direction);
            if (!validation.valid) {
                console.log(`‚ùå Signal validation failed for ${symbol} ${direction}: ${validation.reason}`);
                return null;
            }
            // Calculate entry, stop, and target prices
            const { entryPrice, stopLoss, takeProfit } = this.calculatePrices(currentPrice, direction, context.nearbyPOIs, atr);
            // Calculate position size
            const stopDistancePercent = Math.abs(entryPrice - stopLoss) / entryPrice * 100;
            const positionSize = this.calculatePositionSize(equity, riskPerTrade, atr, stopDistancePercent, entryPrice, leverage);
            // Calculate confidence score
            const confidence = this.calculateConfidence(hologram, validation, absorption);
            // Create signal data
            const signal = {
                symbol,
                direction,
                hologramStatus: hologram.status,
                alignmentScore: hologram.alignmentScore,
                rsScore: hologram.rsScore,
                sessionType: session.type,
                poiType: this.getPOIType(context.nearbyPOIs[0]),
                cvdConfirmation: validation.cvdValid,
                confidence,
                entryPrice,
                stopLoss,
                takeProfit,
                positionSize,
                leverage,
                timestamp: Date.now()
            };
            console.log(`‚úÖ Signal generated for ${symbol} ${direction}: ${hologram.status} alignment, ${confidence}% confidence`);
            return signal;
        }
        catch (error) {
            console.error(`‚ùå Error generating signal for ${symbol}:`, error);
            return null;
        }
    }
    /**
     * Get nearby POIs for the symbol
     */
    async getNearbyPOIs(symbol, currentPrice) {
        // This would typically fetch from a POI cache or calculate on demand
        // For now, we'll return an empty array as a placeholder
        // In a real implementation, this would integrate with InefficiencyMapper
        return [];
    }
    /**
     * Get CVD absorption data for the symbol
     */
    async getCVDAbsorption(symbol) {
        // This would typically fetch recent CVD data and check for absorption
        // For now, we'll return null as a placeholder
        // In a real implementation, this would integrate with CVDValidator
        return null;
    }
    /**
     * Calculate ATR for position sizing
     */
    async calculateATR(symbol, timeframe, period = 14) {
        // This would typically fetch OHLCV data and calculate ATR
        // For now, we'll return a placeholder value
        // In a real implementation, this would fetch data and calculate true ATR
        return 0.02; // 2% placeholder ATR
    }
    /**
     * Calculate entry, stop loss, and take profit prices
     */
    calculatePrices(currentPrice, direction, pois, atr) {
        // Default to current price if no POI
        let entryPrice = currentPrice;
        // Use POI price if available
        if (pois.length > 0) {
            const poi = pois[0];
            if ('midpoint' in poi) {
                entryPrice = poi.midpoint;
            }
            else if ('high' in poi && 'low' in poi && !('strength' in poi)) {
                const ob = poi;
                entryPrice = direction === 'LONG' ? ob.low : ob.high;
            }
            else if ('price' in poi) {
                entryPrice = poi.price;
            }
        }
        // Calculate stop loss and take profit (3:1 R:R)
        const stopDistance = entryPrice * 0.015; // 1.5% stop
        const targetDistance = stopDistance * 3; // 3:1 R:R
        let stopLoss;
        let takeProfit;
        if (direction === 'LONG') {
            stopLoss = entryPrice - stopDistance;
            takeProfit = entryPrice + targetDistance;
        }
        else {
            stopLoss = entryPrice + stopDistance;
            takeProfit = entryPrice - targetDistance;
        }
        return { entryPrice, stopLoss, takeProfit };
    }
    /**
     * Calculate overall signal confidence
     */
    calculateConfidence(hologram, validation, absorption) {
        let confidence = hologram.alignmentScore; // Base confidence from alignment
        // Bonus for A+ status
        if (hologram.status === 'A+') {
            confidence += 10;
        }
        // Bonus for strong RS
        if (Math.abs(hologram.rsScore) > 0.05) {
            confidence += 5;
        }
        // Bonus for CVD confirmation
        if (absorption && absorption.confidence > 80) {
            confidence += 10;
        }
        return Math.min(100, confidence);
    }
    /**
     * Get POI type for logging
     */
    getPOIType(poi) {
        if (!poi)
            return 'ORDER_BLOCK'; // Default
        if ('midpoint' in poi)
            return 'FVG';
        if ('high' in poi && 'low' in poi && !('strength' in poi))
            return 'ORDER_BLOCK';
        return 'LIQUIDITY_POOL';
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('üìù SignalGenerator configuration updated');
    }
    /**
     * Get current configuration
     */
    getConfig() {
        return { ...this.config };
    }
}
exports.SignalGenerator = SignalGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2V4ZWN1dGlvbi9TaWduYWxHZW5lcmF0b3IudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7R0FTRzs7O0FBK0NILE1BQWEsZUFBZTtJQUNsQixNQUFNLENBQXdCO0lBQzlCLGNBQWMsQ0FBaUI7SUFDL0IsZUFBZSxDQUFrQjtJQUNqQyxrQkFBa0IsQ0FBcUI7SUFDdkMsWUFBWSxDQUFlO0lBRW5DLFlBQ0UsY0FBOEIsRUFDOUIsZUFBZ0MsRUFDaEMsa0JBQXNDLEVBQ3RDLFlBQTBCLEVBQzFCLFNBQXlDLEVBQUU7UUFFM0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDckMsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFDdkMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGtCQUFrQixDQUFDO1FBQzdDLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBRWpDLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1osaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixXQUFXLEVBQUUsSUFBSTtZQUNqQixtQkFBbUIsRUFBRSxHQUFHO1lBQ3hCLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsc0JBQXNCLEVBQUUsSUFBSTtZQUM1QixHQUFHLE1BQU07U0FDVixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNILG1CQUFtQixDQUFDLFFBQXVCO1FBQ3pDLDZCQUE2QjtRQUM3QixJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssSUFBSSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDeEQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsZ0VBQWdFO1FBQ2hFLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixF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LFVBQVUsQ0FBQyxVQUFVLEdBQUcsRUFBRSxFQUFFLENBQUM7WUFDN0MsVUFBVSxJQUFJLEVBQUUsQ0FBQztRQUNuQixDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSyxVQUFVLENBQUMsR0FBb0I7UUFDckMsSUFBSSxDQUFDLEdBQUc7WUFBRSxPQUFPLGFBQWEsQ0FBQyxDQUFDLFVBQVU7UUFFMUMsSUFBSSxVQUFVLElBQUksR0FBRztZQUFFLE9BQU8sS0FBSyxDQUFDO1FBQ3BDLElBQUksTUFBTSxJQUFJLEdBQUcsSUFBSSxLQUFLLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxVQUFVLElBQUksR0FBRyxDQUFDO1lBQUUsT0FBTyxhQUFhLENBQUM7UUFDaEYsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZLENBQUMsU0FBeUM7UUFDcEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFNBQVMsRUFBRSxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTO1FBQ1AsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7Q0FDRjtBQTViRCwwQ0E0YkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2V4ZWN1dGlvbi9TaWduYWxHZW5lcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTaWduYWwgR2VuZXJhdG9yIGZvciBUaXRhbiBQaGFzZSAyIC0gVGhlIEh1bnRlclxuICogXG4gKiBHZW5lcmF0ZXMgdHJhZGluZyBzaWduYWxzIGJ5IGNvbWJpbmluZyBhbGwgdmFsaWRhdGlvbiBsYXllcnM6XG4gKiAtIEhvbG9ncmFtIGFsaWdubWVudCAoQSsgb3IgQiBzdGF0dXMpXG4gKiAtIFNlc3Npb24gdGltaW5nIChLaWxsem9uZSByZXF1aXJlbWVudClcbiAqIC0gUmVsYXRpdmUgU3RyZW5ndGggZmlsdGVyaW5nXG4gKiAtIFBPSSBwcm94aW1pdHkgdmFsaWRhdGlvblxuICogLSBDVkQgYWJzb3JwdGlvbiBjb25maXJtYXRpb25cbiAqL1xuXG5pbXBvcnQgeyBcbiAgSG9sb2dyYW1TdGF0ZSwgXG4gIEhvbG9ncmFtU3RhdHVzLCBcbiAgU2Vzc2lvblN0YXRlLCBcbiAgU2Vzc2lvblR5cGUsIFxuICBQT0ksIFxuICBGVkcsIFxuICBPcmRlckJsb2NrLCBcbiAgTGlxdWlkaXR5UG9vbCxcbiAgQWJzb3JwdGlvbixcbiAgU2lnbmFsRGF0YSxcbiAgVHJlbmRTdGF0ZVxufSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBIb2xvZ3JhbUVuZ2luZSB9IGZyb20gJy4uL2VuZ2luZS9Ib2xvZ3JhbUVuZ2luZSc7XG5pbXBvcnQgeyBTZXNzaW9uUHJvZmlsZXIgfSBmcm9tICcuLi9lbmdpbmUvU2Vzc2lvblByb2ZpbGVyJztcbmltcG9ydCB7IEluZWZmaWNpZW5jeU1hcHBlciB9IGZyb20gJy4uL2VuZ2luZS9JbmVmZmljaWVuY3lNYXBwZXInO1xuaW1wb3J0IHsgQ1ZEVmFsaWRhdG9yIH0gZnJvbSAnLi4vZW5naW5lL0NWRFZhbGlkYXRvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmFsR2VuZXJhdG9yQ29uZmlnIHtcbiAgbWluQWxpZ25tZW50U2NvcmU6IG51bWJlcjsgLy8gTWluaW11bSBhbGlnbm1lbnQgc2NvcmUgZm9yIEIgc2lnbmFscyAoZGVmYXVsdDogNjApXG4gIHJzVGhyZXNob2xkOiBudW1iZXI7IC8vIE1pbmltdW0gUlMgc2NvcmUgbWFnbml0dWRlIChkZWZhdWx0OiAwLjAxKVxuICBwb2lQcm94aW1pdHlQZXJjZW50OiBudW1iZXI7IC8vIE1heCBkaXN0YW5jZSBmcm9tIFBPSSAoZGVmYXVsdDogMC41JSlcbiAgbWluQ1ZEQ29uZmlkZW5jZTogbnVtYmVyOyAvLyBNaW5pbXVtIENWRCBhYnNvcnB0aW9uIGNvbmZpZGVuY2UgKGRlZmF1bHQ6IDcwKVxuICByZXF1aXJlQ1ZEQ29uZmlybWF0aW9uOiBib29sZWFuOyAvLyBXaGV0aGVyIENWRCBjb25maXJtYXRpb24gaXMgbWFuZGF0b3J5IChkZWZhdWx0OiB0cnVlKVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpZ25hbFZhbGlkYXRpb25SZXN1bHQge1xuICB2YWxpZDogYm9vbGVhbjtcbiAgcmVhc29uOiBzdHJpbmc7XG4gIGhvbG9ncmFtVmFsaWQ6IGJvb2xlYW47XG4gIHNlc3Npb25WYWxpZDogYm9vbGVhbjtcbiAgcnNWYWxpZDogYm9vbGVhbjtcbiAgcG9pVmFsaWQ6IGJvb2xlYW47XG4gIGN2ZFZhbGlkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpZ25hbENvbnRleHQge1xuICBob2xvZ3JhbTogSG9sb2dyYW1TdGF0ZTtcbiAgc2Vzc2lvbjogU2Vzc2lvblN0YXRlO1xuICBjdXJyZW50UHJpY2U6IG51bWJlcjtcbiAgbmVhcmJ5UE9JczogUE9JW107XG4gIGFic29ycHRpb246IEFic29ycHRpb24gfCBudWxsO1xuICBhdHI6IG51bWJlcjsgLy8gRm9yIHBvc2l0aW9uIHNpemluZyBhbmQgc3RvcCBjYWxjdWxhdGlvblxufVxuXG5leHBvcnQgY2xhc3MgU2lnbmFsR2VuZXJhdG9yIHtcbiAgcHJpdmF0ZSBjb25maWc6IFNpZ25hbEdlbmVyYXRvckNvbmZpZztcbiAgcHJpdmF0ZSBob2xvZ3JhbUVuZ2luZTogSG9sb2dyYW1FbmdpbmU7XG4gIHByaXZhdGUgc2Vzc2lvblByb2ZpbGVyOiBTZXNzaW9uUHJvZmlsZXI7XG4gIHByaXZhdGUgaW5lZmZpY2llbmN5TWFwcGVyOiBJbmVmZmljaWVuY3lNYXBwZXI7XG4gIHByaXZhdGUgY3ZkVmFsaWRhdG9yOiBDVkRWYWxpZGF0b3I7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgaG9sb2dyYW1FbmdpbmU6IEhvbG9ncmFtRW5naW5lLFxuICAgIHNlc3Npb25Qcm9maWxlcjogU2Vzc2lvblByb2ZpbGVyLFxuICAgIGluZWZmaWNpZW5jeU1hcHBlcjogSW5lZmZpY2llbmN5TWFwcGVyLFxuICAgIGN2ZFZhbGlkYXRvcjogQ1ZEVmFsaWRhdG9yLFxuICAgIGNvbmZpZzogUGFydGlhbDxTaWduYWxHZW5lcmF0b3JDb25maWc+ID0ge31cbiAgKSB7XG4gICAgdGhpcy5ob2xvZ3JhbUVuZ2luZSA9IGhvbG9ncmFtRW5naW5lO1xuICAgIHRoaXMuc2Vzc2lvblByb2ZpbGVyID0gc2Vzc2lvblByb2ZpbGVyO1xuICAgIHRoaXMuaW5lZmZpY2llbmN5TWFwcGVyID0gaW5lZmZpY2llbmN5TWFwcGVyO1xuICAgIHRoaXMuY3ZkVmFsaWRhdG9yID0gY3ZkVmFsaWRhdG9yO1xuICAgIFxuICAgIC8vIFNldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIG1pbkFsaWdubWVudFNjb3JlOiA2MCxcbiAgICAgIHJzVGhyZXNob2xkOiAwLjAxLFxuICAgICAgcG9pUHJveGltaXR5UGVyY2VudDogMC41LFxuICAgICAgbWluQ1ZEQ29uZmlkZW5jZTogNzAsXG4gICAgICByZXF1aXJlQ1ZEQ29uZmlybWF0aW9uOiB0cnVlLFxuICAgICAgLi4uY29uZmlnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBob2xvZ3JhbSBzdGF0dXMgbWVldHMgcmVxdWlyZW1lbnRzIGZvciBzaWduYWwgZ2VuZXJhdGlvblxuICAgKiBSZXF1aXJlbWVudHM6IEErIG9yIEIgYWxpZ25tZW50IHN0YXR1c1xuICAgKi9cbiAgY2hlY2tIb2xvZ3JhbVN0YXR1cyhob2xvZ3JhbTogSG9sb2dyYW1TdGF0ZSk6IGJvb2xlYW4ge1xuICAgIC8vIENoZWNrIGlmIHN0YXR1cyBpcyBBKyBvciBCXG4gICAgaWYgKGhvbG9ncmFtLnN0YXR1cyAhPT0gJ0ErJyAmJiBob2xvZ3JhbS5zdGF0dXMgIT09ICdCJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFkZGl0aW9uYWwgY2hlY2s6IGFsaWdubWVudCBzY29yZSBtdXN0IG1lZXQgbWluaW11bSB0aHJlc2hvbGRcbiAgICBpZiAoaG9sb2dyYW0uc3RhdHVzID09PSAnQicgJiYgaG9sb2dyYW0uYWxpZ25tZW50U2NvcmUgPCB0aGlzLmNvbmZpZy5taW5BbGlnbm1lbnRTY29yZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHRoYXQgdmV0byBsb2dpYyBoYXNuJ3QgYmxvY2tlZCB0aGUgc2lnbmFsXG4gICAgaWYgKGhvbG9ncmFtLnZldG8udmV0b2VkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgY3VycmVudCBzZXNzaW9uIG1lZXRzIEtpbGx6b25lIHJlcXVpcmVtZW50c1xuICAgKiBSZXF1aXJlbWVudHM6IE11c3QgYmUgTG9uZG9uICgwNzowMC0xMDowMCBVVEMpIG9yIE5ZICgxMzowMC0xNjowMCBVVEMpIHNlc3Npb25cbiAgICovXG4gIGNoZWNrU2Vzc2lvbihzZXNzaW9uOiBTZXNzaW9uU3RhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zZXNzaW9uUHJvZmlsZXIuaXNLaWxsem9uZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIFJTIHNjb3JlIG1lZXRzIGRpcmVjdGlvbmFsIGZpbHRlciByZXF1aXJlbWVudHNcbiAgICogUmVxdWlyZW1lbnRzOiBMb25nIHNpZ25hbHMgbmVlZCBSUyA+IHRocmVzaG9sZCwgU2hvcnQgc2lnbmFscyBuZWVkIFJTIDwgLXRocmVzaG9sZFxuICAgKi9cbiAgY2hlY2tSU1Njb3JlKHJzU2NvcmU6IG51bWJlciwgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnKTogYm9vbGVhbiB7XG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnKSB7XG4gICAgICByZXR1cm4gcnNTY29yZSA+IHRoaXMuY29uZmlnLnJzVGhyZXNob2xkO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcnNTY29yZSA8IC10aGlzLmNvbmZpZy5yc1RocmVzaG9sZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgY3VycmVudCBwcmljZSBpcyB3aXRoaW4gcHJveGltaXR5IG9mIHJlbGV2YW50IFBPSXNcbiAgICogUmVxdWlyZW1lbnRzOiBQcmljZSBtdXN0IGJlIHdpdGhpbiAwLjUlIG9mIE9yZGVyIEJsb2NrIG9yIEZWR1xuICAgKi9cbiAgY2hlY2tQT0lQcm94aW1pdHkoY3VycmVudFByaWNlOiBudW1iZXIsIHBvaXM6IFBPSVtdLCBkaXJlY3Rpb246ICdMT05HJyB8ICdTSE9SVCcpOiB7IHZhbGlkOiBib29sZWFuOyBwb2k6IFBPSSB8IG51bGwgfSB7XG4gICAgY29uc3QgcHJveGltaXR5VGhyZXNob2xkID0gdGhpcy5jb25maWcucG9pUHJveGltaXR5UGVyY2VudCAvIDEwMDtcblxuICAgIGZvciAoY29uc3QgcG9pIG9mIHBvaXMpIHtcbiAgICAgIC8vIFNraXAgbWl0aWdhdGVkIFBPSXNcbiAgICAgIGlmICgnbWl0aWdhdGVkJyBpbiBwb2kgJiYgcG9pLm1pdGlnYXRlZCkgY29udGludWU7XG4gICAgICBpZiAoJ3N3ZXB0JyBpbiBwb2kgJiYgcG9pLnN3ZXB0KSBjb250aW51ZTtcblxuICAgICAgbGV0IHRhcmdldFByaWNlOiBudW1iZXI7XG4gICAgICBsZXQgcG9pVmFsaWQgPSBmYWxzZTtcblxuICAgICAgLy8gQ2hlY2sgUE9JIHR5cGUgYW5kIGRpcmVjdGlvbiBjb21wYXRpYmlsaXR5XG4gICAgICBpZiAoJ21pZHBvaW50JyBpbiBwb2kpIHtcbiAgICAgICAgLy8gRlZHXG4gICAgICAgIGNvbnN0IGZ2ZyA9IHBvaSBhcyBGVkc7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdMT05HJyAmJiBmdmcudHlwZSA9PT0gJ0JVTExJU0gnKSB7XG4gICAgICAgICAgdGFyZ2V0UHJpY2UgPSBmdmcubWlkcG9pbnQ7XG4gICAgICAgICAgcG9pVmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ1NIT1JUJyAmJiBmdmcudHlwZSA9PT0gJ0JFQVJJU0gnKSB7XG4gICAgICAgICAgdGFyZ2V0UHJpY2UgPSBmdmcubWlkcG9pbnQ7XG4gICAgICAgICAgcG9pVmFsaWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCdoaWdoJyBpbiBwb2kgJiYgJ2xvdycgaW4gcG9pICYmICEoJ3N0cmVuZ3RoJyBpbiBwb2kpKSB7XG4gICAgICAgIC8vIE9yZGVyIEJsb2NrXG4gICAgICAgIGNvbnN0IG9iID0gcG9pIGFzIE9yZGVyQmxvY2s7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdMT05HJyAmJiBvYi50eXBlID09PSAnQlVMTElTSCcpIHtcbiAgICAgICAgICB0YXJnZXRQcmljZSA9IG9iLmxvdzsgLy8gRW50ZXIgYXQgYm90dG9tIG9mIGJ1bGxpc2ggT0JcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnU0hPUlQnICYmIG9iLnR5cGUgPT09ICdCRUFSSVNIJykge1xuICAgICAgICAgIHRhcmdldFByaWNlID0gb2IuaGlnaDsgLy8gRW50ZXIgYXQgdG9wIG9mIGJlYXJpc2ggT0JcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoJ3N0cmVuZ3RoJyBpbiBwb2kpIHtcbiAgICAgICAgLy8gTGlxdWlkaXR5IFBvb2wgLSBsZXNzIHByZWNpc2UsIHVzZSBmb3IgY29uZmx1ZW5jZSBvbmx5XG4gICAgICAgIGNvbnN0IHBvb2wgPSBwb2kgYXMgTGlxdWlkaXR5UG9vbDtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnICYmIHBvb2wudHlwZSA9PT0gJ0xPVycpIHtcbiAgICAgICAgICB0YXJnZXRQcmljZSA9IHBvb2wucHJpY2U7XG4gICAgICAgICAgcG9pVmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ1NIT1JUJyAmJiBwb29sLnR5cGUgPT09ICdISUdIJykge1xuICAgICAgICAgIHRhcmdldFByaWNlID0gcG9vbC5wcmljZTtcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHBvaVZhbGlkKSB7XG4gICAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5hYnMoY3VycmVudFByaWNlIC0gdGFyZ2V0UHJpY2UhKSAvIGN1cnJlbnRQcmljZTtcbiAgICAgICAgaWYgKGRpc3RhbmNlIDw9IHByb3hpbWl0eVRocmVzaG9sZCkge1xuICAgICAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCBwb2kgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgcG9pOiBudWxsIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgQ1ZEIGFic29ycHRpb24gcHJvdmlkZXMgcmVxdWlyZWQgY29uZmlybWF0aW9uXG4gICAqIFJlcXVpcmVtZW50czogTXVzdCBoYXZlIGFic29ycHRpb24gc2lnbmFsIHdpdGggc3VmZmljaWVudCBjb25maWRlbmNlXG4gICAqL1xuICBjaGVja0NWREFic29ycHRpb24oYWJzb3JwdGlvbjogQWJzb3JwdGlvbiB8IG51bGwsIGRpcmVjdGlvbjogJ0xPTkcnIHwgJ1NIT1JUJyk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5jb25maWcucmVxdWlyZUNWRENvbmZpcm1hdGlvbikge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIENWRCBjb25maXJtYXRpb24gbm90IHJlcXVpcmVkXG4gICAgfVxuXG4gICAgaWYgKCFhYnNvcnB0aW9uKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIE5vIGFic29ycHRpb24gZGV0ZWN0ZWRcbiAgICB9XG5cbiAgICAvLyBDaGVjayBjb25maWRlbmNlIGxldmVsXG4gICAgaWYgKGFic29ycHRpb24uY29uZmlkZW5jZSA8IHRoaXMuY29uZmlnLm1pbkNWRENvbmZpZGVuY2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGb3IgTE9ORyBzaWduYWxzLCB3ZSBuZWVkIGFic29ycHRpb24gKGJ1eWluZyBwcmVzc3VyZSBhdCBsb3dzKVxuICAgIC8vIEZvciBTSE9SVCBzaWduYWxzLCB3ZSBuZWVkIGRpc3RyaWJ1dGlvbiAoc2VsbGluZyBwcmVzc3VyZSBhdCBoaWdocylcbiAgICAvLyBOb3RlOiBUaGUgY3VycmVudCBhYnNvcnB0aW9uIGludGVyZmFjZSBvbmx5IGhhbmRsZXMgYWJzb3JwdGlvblxuICAgIC8vIERpc3RyaWJ1dGlvbiB3b3VsZCBuZWVkIHRvIGJlIGhhbmRsZWQgc2VwYXJhdGVseSBvciB0aGUgaW50ZXJmYWNlIGV4dGVuZGVkXG4gICAgXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnKSB7XG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gQWJzb3JwdGlvbiBzdXBwb3J0cyBsb25nIGVudHJ5XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBzaG9ydCBzaWduYWxzLCB3ZSB3b3VsZCBuZWVkIGRpc3RyaWJ1dGlvbiBkZXRlY3Rpb25cbiAgICAgIC8vIEZvciBub3csIHdlJ2xsIGFjY2VwdCBhYnNvcnB0aW9uIGFzIGdlbmVyYWwgZmxvdyBjb25maXJtYXRpb25cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbGwgc2lnbmFsIGNvbmRpdGlvbnNcbiAgICovXG4gIHZhbGlkYXRlU2lnbmFsKGNvbnRleHQ6IFNpZ25hbENvbnRleHQsIGRpcmVjdGlvbjogJ0xPTkcnIHwgJ1NIT1JUJyk6IFNpZ25hbFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IGhvbG9ncmFtVmFsaWQgPSB0aGlzLmNoZWNrSG9sb2dyYW1TdGF0dXMoY29udGV4dC5ob2xvZ3JhbSk7XG4gICAgY29uc3Qgc2Vzc2lvblZhbGlkID0gdGhpcy5jaGVja1Nlc3Npb24oY29udGV4dC5zZXNzaW9uKTtcbiAgICBjb25zdCByc1ZhbGlkID0gdGhpcy5jaGVja1JTU2NvcmUoY29udGV4dC5ob2xvZ3JhbS5yc1Njb3JlLCBkaXJlY3Rpb24pO1xuICAgIGNvbnN0IHBvaVJlc3VsdCA9IHRoaXMuY2hlY2tQT0lQcm94aW1pdHkoY29udGV4dC5jdXJyZW50UHJpY2UsIGNvbnRleHQubmVhcmJ5UE9JcywgZGlyZWN0aW9uKTtcbiAgICBjb25zdCBjdmRWYWxpZCA9IHRoaXMuY2hlY2tDVkRBYnNvcnB0aW9uKGNvbnRleHQuYWJzb3JwdGlvbiwgZGlyZWN0aW9uKTtcblxuICAgIGNvbnN0IHZhbGlkID0gaG9sb2dyYW1WYWxpZCAmJiBzZXNzaW9uVmFsaWQgJiYgcnNWYWxpZCAmJiBwb2lSZXN1bHQudmFsaWQgJiYgY3ZkVmFsaWQ7XG5cbiAgICBsZXQgcmVhc29uID0gJyc7XG4gICAgaWYgKCFob2xvZ3JhbVZhbGlkKSByZWFzb24gKz0gJ0hvbG9ncmFtIHN0YXR1cyBpbnZhbGlkLiAnO1xuICAgIGlmICghc2Vzc2lvblZhbGlkKSByZWFzb24gKz0gJ05vdCBpbiBLaWxsem9uZS4gJztcbiAgICBpZiAoIXJzVmFsaWQpIHJlYXNvbiArPSAnUlMgc2NvcmUgaW5zdWZmaWNpZW50LiAnO1xuICAgIGlmICghcG9pUmVzdWx0LnZhbGlkKSByZWFzb24gKz0gJ05vIFBPSSBwcm94aW1pdHkuICc7XG4gICAgaWYgKCFjdmRWYWxpZCkgcmVhc29uICs9ICdDVkQgY29uZmlybWF0aW9uIG1pc3NpbmcuICc7XG5cbiAgICBpZiAodmFsaWQpIHtcbiAgICAgIHJlYXNvbiA9ICdBbGwgY29uZGl0aW9ucyBtZXQnO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2YWxpZCxcbiAgICAgIHJlYXNvbjogcmVhc29uLnRyaW0oKSxcbiAgICAgIGhvbG9ncmFtVmFsaWQsXG4gICAgICBzZXNzaW9uVmFsaWQsXG4gICAgICByc1ZhbGlkLFxuICAgICAgcG9pVmFsaWQ6IHBvaVJlc3VsdC52YWxpZCxcbiAgICAgIGN2ZFZhbGlkXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcG9zaXRpb24gc2l6ZSB1c2luZyBWb2xhdGlsaXR5LUFkanVzdGVkIFNpemluZ1xuICAgKiBGb3JtdWxhOiBSaXNrX0RvbGxhcnMgLyAoQVRSICogU3RvcF9EaXN0YW5jZV9NdWx0aXBsaWVyKVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVQb3NpdGlvblNpemUoXG4gICAgZXF1aXR5OiBudW1iZXIsXG4gICAgcmlza1BlclRyYWRlOiBudW1iZXIsXG4gICAgYXRyOiBudW1iZXIsXG4gICAgc3RvcERpc3RhbmNlUGVyY2VudDogbnVtYmVyLFxuICAgIGN1cnJlbnRQcmljZTogbnVtYmVyLFxuICAgIGxldmVyYWdlOiBudW1iZXJcbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCByaXNrRG9sbGFycyA9IGVxdWl0eSAqIHJpc2tQZXJUcmFkZTtcbiAgICBjb25zdCBzdG9wRGlzdGFuY2UgPSBjdXJyZW50UHJpY2UgKiAoc3RvcERpc3RhbmNlUGVyY2VudCAvIDEwMCk7XG4gICAgY29uc3QgcG9zaXRpb25TaXplID0gcmlza0RvbGxhcnMgLyBzdG9wRGlzdGFuY2U7XG4gICAgXG4gICAgLy8gQXBwbHkgbGV2ZXJhZ2UgY29uc3RyYWludFxuICAgIGNvbnN0IG1heFBvc2l0aW9uVmFsdWUgPSBlcXVpdHkgKiBsZXZlcmFnZTtcbiAgICBjb25zdCBtYXhQb3NpdGlvblNpemUgPSBtYXhQb3NpdGlvblZhbHVlIC8gY3VycmVudFByaWNlO1xuICAgIFxuICAgIHJldHVybiBNYXRoLm1pbihwb3NpdGlvblNpemUsIG1heFBvc2l0aW9uU2l6ZSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdHJhZGluZyBzaWduYWwgd2l0aCBhbGwgdmFsaWRhdGlvbnNcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlU2lnbmFsKFxuICAgIHN5bWJvbDogc3RyaW5nLFxuICAgIGRpcmVjdGlvbjogJ0xPTkcnIHwgJ1NIT1JUJyxcbiAgICBlcXVpdHk6IG51bWJlcixcbiAgICByaXNrUGVyVHJhZGU6IG51bWJlciA9IDAuMDIsXG4gICAgbGV2ZXJhZ2U6IG51bWJlciA9IDNcbiAgKTogUHJvbWlzZTxTaWduYWxEYXRhIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgaG9sb2dyYW0gc3RhdGVcbiAgICAgIGNvbnN0IGhvbG9ncmFtID0gYXdhaXQgdGhpcy5ob2xvZ3JhbUVuZ2luZS5hbmFseXplKHN5bWJvbCk7XG4gICAgICBcbiAgICAgIC8vIEdldCBzZXNzaW9uIHN0YXRlXG4gICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9uUHJvZmlsZXIuZ2V0U2Vzc2lvblN0YXRlKCk7XG4gICAgICBcbiAgICAgIC8vIEdldCBjdXJyZW50IHByaWNlIGZyb20gaG9sb2dyYW1cbiAgICAgIGNvbnN0IGN1cnJlbnRQcmljZSA9IGhvbG9ncmFtLm0xNS5jdXJyZW50UHJpY2U7XG4gICAgICBcbiAgICAgIC8vIEdldCBuZWFyYnkgUE9Jc1xuICAgICAgY29uc3QgbmVhcmJ5UE9JcyA9IGF3YWl0IHRoaXMuZ2V0TmVhcmJ5UE9JcyhzeW1ib2wsIGN1cnJlbnRQcmljZSk7XG4gICAgICBcbiAgICAgIC8vIEdldCBDVkQgYWJzb3JwdGlvblxuICAgICAgY29uc3QgYWJzb3JwdGlvbiA9IGF3YWl0IHRoaXMuZ2V0Q1ZEQWJzb3JwdGlvbihzeW1ib2wpO1xuICAgICAgXG4gICAgICAvLyBHZXQgQVRSIGZvciBwb3NpdGlvbiBzaXppbmcgKHVzaW5nIDE1bSB0aW1lZnJhbWUpXG4gICAgICBjb25zdCBhdHIgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZUFUUihzeW1ib2wsICcxNW0nKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHNpZ25hbCBjb250ZXh0XG4gICAgICBjb25zdCBjb250ZXh0OiBTaWduYWxDb250ZXh0ID0ge1xuICAgICAgICBob2xvZ3JhbSxcbiAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgY3VycmVudFByaWNlLFxuICAgICAgICBuZWFyYnlQT0lzLFxuICAgICAgICBhYnNvcnB0aW9uLFxuICAgICAgICBhdHJcbiAgICAgIH07XG5cbiAgICAgIC8vIFZhbGlkYXRlIHNpZ25hbFxuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVTaWduYWwoY29udGV4dCwgZGlyZWN0aW9uKTtcbiAgICAgIFxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgU2lnbmFsIHZhbGlkYXRpb24gZmFpbGVkIGZvciAke3N5bWJvbH0gJHtkaXJlY3Rpb259OiAke3ZhbGlkYXRpb24ucmVhc29ufWApO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsY3VsYXRlIGVudHJ5LCBzdG9wLCBhbmQgdGFyZ2V0IHByaWNlc1xuICAgICAgY29uc3QgeyBlbnRyeVByaWNlLCBzdG9wTG9zcywgdGFrZVByb2ZpdCB9ID0gdGhpcy5jYWxjdWxhdGVQcmljZXMoXG4gICAgICAgIGN1cnJlbnRQcmljZSxcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICBjb250ZXh0Lm5lYXJieVBPSXMsXG4gICAgICAgIGF0clxuICAgICAgKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIHNpemVcbiAgICAgIGNvbnN0IHN0b3BEaXN0YW5jZVBlcmNlbnQgPSBNYXRoLmFicyhlbnRyeVByaWNlIC0gc3RvcExvc3MpIC8gZW50cnlQcmljZSAqIDEwMDtcbiAgICAgIGNvbnN0IHBvc2l0aW9uU2l6ZSA9IHRoaXMuY2FsY3VsYXRlUG9zaXRpb25TaXplKFxuICAgICAgICBlcXVpdHksXG4gICAgICAgIHJpc2tQZXJUcmFkZSxcbiAgICAgICAgYXRyLFxuICAgICAgICBzdG9wRGlzdGFuY2VQZXJjZW50LFxuICAgICAgICBlbnRyeVByaWNlLFxuICAgICAgICBsZXZlcmFnZVxuICAgICAgKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGNvbmZpZGVuY2Ugc2NvcmVcbiAgICAgIGNvbnN0IGNvbmZpZGVuY2UgPSB0aGlzLmNhbGN1bGF0ZUNvbmZpZGVuY2UoaG9sb2dyYW0sIHZhbGlkYXRpb24sIGFic29ycHRpb24pO1xuXG4gICAgICAvLyBDcmVhdGUgc2lnbmFsIGRhdGFcbiAgICAgIGNvbnN0IHNpZ25hbDogU2lnbmFsRGF0YSA9IHtcbiAgICAgICAgc3ltYm9sLFxuICAgICAgICBkaXJlY3Rpb24sXG4gICAgICAgIGhvbG9ncmFtU3RhdHVzOiBob2xvZ3JhbS5zdGF0dXMsXG4gICAgICAgIGFsaWdubWVudFNjb3JlOiBob2xvZ3JhbS5hbGlnbm1lbnRTY29yZSxcbiAgICAgICAgcnNTY29yZTogaG9sb2dyYW0ucnNTY29yZSxcbiAgICAgICAgc2Vzc2lvblR5cGU6IHNlc3Npb24udHlwZSxcbiAgICAgICAgcG9pVHlwZTogdGhpcy5nZXRQT0lUeXBlKGNvbnRleHQubmVhcmJ5UE9Jc1swXSksXG4gICAgICAgIGN2ZENvbmZpcm1hdGlvbjogdmFsaWRhdGlvbi5jdmRWYWxpZCxcbiAgICAgICAgY29uZmlkZW5jZSxcbiAgICAgICAgZW50cnlQcmljZSxcbiAgICAgICAgc3RvcExvc3MsXG4gICAgICAgIHRha2VQcm9maXQsXG4gICAgICAgIHBvc2l0aW9uU2l6ZSxcbiAgICAgICAgbGV2ZXJhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcblxuICAgICAgY29uc29sZS5sb2coYOKchSBTaWduYWwgZ2VuZXJhdGVkIGZvciAke3N5bWJvbH0gJHtkaXJlY3Rpb259OiAke2hvbG9ncmFtLnN0YXR1c30gYWxpZ25tZW50LCAke2NvbmZpZGVuY2V9JSBjb25maWRlbmNlYCk7XG4gICAgICByZXR1cm4gc2lnbmFsO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBnZW5lcmF0aW5nIHNpZ25hbCBmb3IgJHtzeW1ib2x9OmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbmVhcmJ5IFBPSXMgZm9yIHRoZSBzeW1ib2xcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0TmVhcmJ5UE9JcyhzeW1ib2w6IHN0cmluZywgY3VycmVudFByaWNlOiBudW1iZXIpOiBQcm9taXNlPFBPSVtdPiB7XG4gICAgLy8gVGhpcyB3b3VsZCB0eXBpY2FsbHkgZmV0Y2ggZnJvbSBhIFBPSSBjYWNoZSBvciBjYWxjdWxhdGUgb24gZGVtYW5kXG4gICAgLy8gRm9yIG5vdywgd2UnbGwgcmV0dXJuIGFuIGVtcHR5IGFycmF5IGFzIGEgcGxhY2Vob2xkZXJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgaW50ZWdyYXRlIHdpdGggSW5lZmZpY2llbmN5TWFwcGVyXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBDVkQgYWJzb3JwdGlvbiBkYXRhIGZvciB0aGUgc3ltYm9sXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldENWREFic29ycHRpb24oc3ltYm9sOiBzdHJpbmcpOiBQcm9taXNlPEFic29ycHRpb24gfCBudWxsPiB7XG4gICAgLy8gVGhpcyB3b3VsZCB0eXBpY2FsbHkgZmV0Y2ggcmVjZW50IENWRCBkYXRhIGFuZCBjaGVjayBmb3IgYWJzb3JwdGlvblxuICAgIC8vIEZvciBub3csIHdlJ2xsIHJldHVybiBudWxsIGFzIGEgcGxhY2Vob2xkZXJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgaW50ZWdyYXRlIHdpdGggQ1ZEVmFsaWRhdG9yXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIEFUUiBmb3IgcG9zaXRpb24gc2l6aW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZUFUUihzeW1ib2w6IHN0cmluZywgdGltZWZyYW1lOiBzdHJpbmcsIHBlcmlvZDogbnVtYmVyID0gMTQpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IGZldGNoIE9ITENWIGRhdGEgYW5kIGNhbGN1bGF0ZSBBVFJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCByZXR1cm4gYSBwbGFjZWhvbGRlciB2YWx1ZVxuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBmZXRjaCBkYXRhIGFuZCBjYWxjdWxhdGUgdHJ1ZSBBVFJcbiAgICByZXR1cm4gMC4wMjsgLy8gMiUgcGxhY2Vob2xkZXIgQVRSXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGVudHJ5LCBzdG9wIGxvc3MsIGFuZCB0YWtlIHByb2ZpdCBwcmljZXNcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlUHJpY2VzKFxuICAgIGN1cnJlbnRQcmljZTogbnVtYmVyLFxuICAgIGRpcmVjdGlvbjogJ0xPTkcnIHwgJ1NIT1JUJyxcbiAgICBwb2lzOiBQT0lbXSxcbiAgICBhdHI6IG51bWJlclxuICApOiB7IGVudHJ5UHJpY2U6IG51bWJlcjsgc3RvcExvc3M6IG51bWJlcjsgdGFrZVByb2ZpdDogbnVtYmVyIH0ge1xuICAgIC8vIERlZmF1bHQgdG8gY3VycmVudCBwcmljZSBpZiBubyBQT0lcbiAgICBsZXQgZW50cnlQcmljZSA9IGN1cnJlbnRQcmljZTtcbiAgICBcbiAgICAvLyBVc2UgUE9JIHByaWNlIGlmIGF2YWlsYWJsZVxuICAgIGlmIChwb2lzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHBvaSA9IHBvaXNbMF07XG4gICAgICBpZiAoJ21pZHBvaW50JyBpbiBwb2kpIHtcbiAgICAgICAgZW50cnlQcmljZSA9IChwb2kgYXMgRlZHKS5taWRwb2ludDtcbiAgICAgIH0gZWxzZSBpZiAoJ2hpZ2gnIGluIHBvaSAmJiAnbG93JyBpbiBwb2kgJiYgISgnc3RyZW5ndGgnIGluIHBvaSkpIHtcbiAgICAgICAgY29uc3Qgb2IgPSBwb2kgYXMgT3JkZXJCbG9jaztcbiAgICAgICAgZW50cnlQcmljZSA9IGRpcmVjdGlvbiA9PT0gJ0xPTkcnID8gb2IubG93IDogb2IuaGlnaDtcbiAgICAgIH0gZWxzZSBpZiAoJ3ByaWNlJyBpbiBwb2kpIHtcbiAgICAgICAgZW50cnlQcmljZSA9IChwb2kgYXMgTGlxdWlkaXR5UG9vbCkucHJpY2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHN0b3AgbG9zcyBhbmQgdGFrZSBwcm9maXQgKDM6MSBSOlIpXG4gICAgY29uc3Qgc3RvcERpc3RhbmNlID0gZW50cnlQcmljZSAqIDAuMDE1OyAvLyAxLjUlIHN0b3BcbiAgICBjb25zdCB0YXJnZXREaXN0YW5jZSA9IHN0b3BEaXN0YW5jZSAqIDM7IC8vIDM6MSBSOlJcblxuICAgIGxldCBzdG9wTG9zczogbnVtYmVyO1xuICAgIGxldCB0YWtlUHJvZml0OiBudW1iZXI7XG5cbiAgICBpZiAoZGlyZWN0aW9uID09PSAnTE9ORycpIHtcbiAgICAgIHN0b3BMb3NzID0gZW50cnlQcmljZSAtIHN0b3BEaXN0YW5jZTtcbiAgICAgIHRha2VQcm9maXQgPSBlbnRyeVByaWNlICsgdGFyZ2V0RGlzdGFuY2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3BMb3NzID0gZW50cnlQcmljZSArIHN0b3BEaXN0YW5jZTtcbiAgICAgIHRha2VQcm9maXQgPSBlbnRyeVByaWNlIC0gdGFyZ2V0RGlzdGFuY2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZW50cnlQcmljZSwgc3RvcExvc3MsIHRha2VQcm9maXQgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgb3ZlcmFsbCBzaWduYWwgY29uZmlkZW5jZVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDb25maWRlbmNlKFxuICAgIGhvbG9ncmFtOiBIb2xvZ3JhbVN0YXRlLFxuICAgIHZhbGlkYXRpb246IFNpZ25hbFZhbGlkYXRpb25SZXN1bHQsXG4gICAgYWJzb3JwdGlvbjogQWJzb3JwdGlvbiB8IG51bGxcbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgY29uZmlkZW5jZSA9IGhvbG9ncmFtLmFsaWdubWVudFNjb3JlOyAvLyBCYXNlIGNvbmZpZGVuY2UgZnJvbSBhbGlnbm1lbnRcblxuICAgIC8vIEJvbnVzIGZvciBBKyBzdGF0dXNcbiAgICBpZiAoaG9sb2dyYW0uc3RhdHVzID09PSAnQSsnKSB7XG4gICAgICBjb25maWRlbmNlICs9IDEwO1xuICAgIH1cblxuICAgIC8vIEJvbnVzIGZvciBzdHJvbmcgUlNcbiAgICBpZiAoTWF0aC5hYnMoaG9sb2dyYW0ucnNTY29yZSkgPiAwLjA1KSB7XG4gICAgICBjb25maWRlbmNlICs9IDU7XG4gICAgfVxuXG4gICAgLy8gQm9udXMgZm9yIENWRCBjb25maXJtYXRpb25cbiAgICBpZiAoYWJzb3JwdGlvbiAmJiBhYnNvcnB0aW9uLmNvbmZpZGVuY2UgPiA4MCkge1xuICAgICAgY29uZmlkZW5jZSArPSAxMDtcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5taW4oMTAwLCBjb25maWRlbmNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgUE9JIHR5cGUgZm9yIGxvZ2dpbmdcbiAgICovXG4gIHByaXZhdGUgZ2V0UE9JVHlwZShwb2k6IFBPSSB8IHVuZGVmaW5lZCk6ICdGVkcnIHwgJ09SREVSX0JMT0NLJyB8ICdMSVFVSURJVFlfUE9PTCcge1xuICAgIGlmICghcG9pKSByZXR1cm4gJ09SREVSX0JMT0NLJzsgLy8gRGVmYXVsdFxuXG4gICAgaWYgKCdtaWRwb2ludCcgaW4gcG9pKSByZXR1cm4gJ0ZWRyc7XG4gICAgaWYgKCdoaWdoJyBpbiBwb2kgJiYgJ2xvdycgaW4gcG9pICYmICEoJ3N0cmVuZ3RoJyBpbiBwb2kpKSByZXR1cm4gJ09SREVSX0JMT0NLJztcbiAgICByZXR1cm4gJ0xJUVVJRElUWV9QT09MJztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29uZmlndXJhdGlvblxuICAgKi9cbiAgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZzogUGFydGlhbDxTaWduYWxHZW5lcmF0b3JDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcbiAgICBjb25zb2xlLmxvZygn8J+TnSBTaWduYWxHZW5lcmF0b3IgY29uZmlndXJhdGlvbiB1cGRhdGVkJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgY29uZmlndXJhdGlvblxuICAgKi9cbiAgZ2V0Q29uZmlnKCk6IFNpZ25hbEdlbmVyYXRvckNvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==