{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/InefficiencyMapper.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/InefficiencyMapper.ts"],"sourcesContent":["/**\n * InefficiencyMapper - POI Detection Engine\n * \n * Identifies Fair Value Gaps, Order Blocks, and Liquidity Pools\n * as high-probability entry zones for institutional rebalancing.\n * \n * Requirements: 3.1-3.7 (Inefficiency Mapper), 10.1-10.7 (Liquidity Pool Detection)\n */\n\nimport { OHLCV, FVG, OrderBlock, LiquidityPool, POI, BOS, Fractal } from '../types';\n\nexport class InefficiencyMapper {\n  /**\n   * Detect Fair Value Gaps (3-candle imbalance)\n   * \n   * A Fair Value Gap occurs when there's a price gap between candles,\n   * leaving unfilled orders that act as price magnets.\n   * \n   * @param candles OHLCV data array\n   * @returns Array of detected FVGs\n   */\n  detectFVG(candles: OHLCV[]): FVG[] {\n    const fvgs: FVG[] = [];\n    \n    // Need at least 3 candles for FVG detection\n    if (candles.length < 3) return fvgs;\n    \n    for (let i = 0; i < candles.length - 2; i++) {\n      const candle1 = candles[i];\n      const candle2 = candles[i + 1];\n      const candle3 = candles[i + 2];\n      \n      // Bullish FVG: Candle 1 high < Candle 3 low (gap up)\n      if (candle1.high < candle3.low) {\n        const top = candle3.low;\n        const bottom = candle1.high;\n        const midpoint = (top + bottom) / 2;\n        \n        fvgs.push({\n          type: 'BULLISH',\n          top,\n          bottom,\n          midpoint,\n          barIndex: i + 2,\n          timestamp: candle3.timestamp,\n          mitigated: false,\n          fillPercent: 0\n        });\n      }\n      \n      // Bearish FVG: Candle 1 low > Candle 3 high (gap down)\n      if (candle1.low > candle3.high) {\n        const top = candle1.low;\n        const bottom = candle3.high;\n        const midpoint = (top + bottom) / 2;\n        \n        fvgs.push({\n          type: 'BEARISH',\n          top,\n          bottom,\n          midpoint,\n          barIndex: i + 2,\n          timestamp: candle3.timestamp,\n          mitigated: false,\n          fillPercent: 0\n        });\n      }\n    }\n    \n    return fvgs;\n  }\n\n  /**\n   * Detect Order Blocks (last opposite candle before BOS)\n   * \n   * Order Blocks represent institutional accumulation/distribution zones\n   * where large orders were placed before a Break of Structure.\n   * \n   * @param candles OHLCV data array\n   * @param bos Array of Break of Structure events\n   * @returns Array of detected Order Blocks\n   */\n  detectOrderBlock(candles: OHLCV[], bos: BOS[]): OrderBlock[] {\n    const orderBlocks: OrderBlock[] = [];\n    \n    for (const bosEvent of bos) {\n      // Find the candle just before BOS\n      const bosBarIndex = bosEvent.barIndex;\n      \n      if (bosBarIndex < 1) continue;\n      \n      // For Bullish BOS, find last down-candle (red candle)\n      if (bosEvent.direction === 'BULLISH') {\n        for (let i = bosBarIndex - 1; i >= 0; i--) {\n          const candle = candles[i];\n          const isDownCandle = candle.close < candle.open;\n          \n          if (isDownCandle) {\n            // Calculate initial confidence based on candle size and volume\n            const candleSize = Math.abs(candle.close - candle.open);\n            const avgVolume = this.calculateAverageVolume(candles, i, 20);\n            const volumeRatio = candle.volume / avgVolume;\n            const baseConfidence = Math.min(90, 60 + (volumeRatio * 15));\n            \n            orderBlocks.push({\n              type: 'BULLISH',\n              high: candle.high,\n              low: candle.low,\n              barIndex: i,\n              timestamp: candle.timestamp,\n              mitigated: false,\n              confidence: baseConfidence\n            });\n            break; // Only take the last one\n          }\n        }\n      }\n      \n      // For Bearish BOS, find last up-candle (green candle)\n      if (bosEvent.direction === 'BEARISH') {\n        for (let i = bosBarIndex - 1; i >= 0; i--) {\n          const candle = candles[i];\n          const isUpCandle = candle.close > candle.open;\n          \n          if (isUpCandle) {\n            // Calculate initial confidence based on candle size and volume\n            const candleSize = Math.abs(candle.close - candle.open);\n            const avgVolume = this.calculateAverageVolume(candles, i, 20);\n            const volumeRatio = candle.volume / avgVolume;\n            const baseConfidence = Math.min(90, 60 + (volumeRatio * 15));\n            \n            orderBlocks.push({\n              type: 'BEARISH',\n              high: candle.high,\n              low: candle.low,\n              barIndex: i,\n              timestamp: candle.timestamp,\n              mitigated: false,\n              confidence: baseConfidence\n            });\n            break; // Only take the last one\n          }\n        }\n      }\n    }\n    \n    return orderBlocks;\n  }\n\n  /**\n   * Detect Liquidity Pools using volume profile at fractals\n   * \n   * Liquidity Pools are estimated clusters of stop losses at old swing points,\n   * calculated using volume profile and time decay.\n   * \n   * @param candles OHLCV data array\n   * @param fractals Array of fractal swing points\n   * @returns Array of detected Liquidity Pools\n   */\n  detectLiquidityPools(candles: OHLCV[], fractals: Fractal[]): LiquidityPool[] {\n    const pools: LiquidityPool[] = [];\n    \n    for (const fractal of fractals) {\n      // Get the candle at fractal bar index\n      const candle = candles[fractal.barIndex];\n      if (!candle) continue;\n      \n      // Calculate pool strength based on volume and age\n      const age = Date.now() - fractal.timestamp;\n      const ageHours = age / (1000 * 60 * 60);\n      \n      // Age factor: Decay over 72 hours (3 days)\n      const ageFactor = Math.max(0, 100 - (ageHours / 72) * 50);\n      \n      // Volume factor: Compare to average volume\n      const avgVolume = this.calculateAverageVolume(candles, fractal.barIndex, 50);\n      const volumeFactor = Math.min(100, (candle.volume / avgVolume) * 50);\n      \n      // Combine factors with weights: age 60%, volume 40%\n      const strength = (ageFactor * 0.6) + (volumeFactor * 0.4);\n      \n      // Only create pools with meaningful strength (> 20)\n      if (strength > 20) {\n        pools.push({\n          type: fractal.type === 'HIGH' ? 'HIGH' : 'LOW',\n          price: fractal.price,\n          strength,\n          barIndex: fractal.barIndex,\n          timestamp: fractal.timestamp,\n          swept: false\n        });\n      }\n    }\n    \n    // Merge nearby pools (within 1% price range)\n    return this.mergeLiquidityPools(pools);\n  }\n\n  /**\n   * Validate POI (check if mitigated)\n   * \n   * Determines if a Point of Interest is still valid or has been mitigated\n   * by price action.\n   * \n   * @param poi Point of Interest to validate\n   * @param currentPrice Current market price\n   * @returns true if POI is still valid, false if mitigated\n   */\n  validatePOI(poi: POI, currentPrice: number): boolean {\n    // Check if already marked as mitigated/swept\n    if ('mitigated' in poi && poi.mitigated) return false;\n    if ('swept' in poi && poi.swept) return false;\n    \n    // FVG validation\n    if ('midpoint' in poi) {\n      const fvg = poi as FVG;\n      \n      // Bullish FVG is mitigated if price fills the gap (goes below bottom)\n      if (fvg.type === 'BULLISH' && currentPrice <= fvg.bottom) {\n        return false;\n      }\n      \n      // Bearish FVG is mitigated if price fills the gap (goes above top)\n      if (fvg.type === 'BEARISH' && currentPrice >= fvg.top) {\n        return false;\n      }\n      \n      // Update fill percentage for partial mitigation\n      if (fvg.type === 'BULLISH') {\n        const fillPercent = Math.max(0, Math.min(100, \n          ((fvg.top - currentPrice) / (fvg.top - fvg.bottom)) * 100\n        ));\n        (fvg as any).fillPercent = fillPercent;\n      } else {\n        const fillPercent = Math.max(0, Math.min(100, \n          ((currentPrice - fvg.bottom) / (fvg.top - fvg.bottom)) * 100\n        ));\n        (fvg as any).fillPercent = fillPercent;\n      }\n    }\n    \n    // Order Block validation\n    if ('high' in poi && 'low' in poi && !('midpoint' in poi)) {\n      const ob = poi as OrderBlock;\n      \n      // Bullish OB is mitigated if price closes below the low\n      if (ob.type === 'BULLISH' && currentPrice < ob.low) {\n        return false;\n      }\n      \n      // Bearish OB is mitigated if price closes above the high\n      if (ob.type === 'BEARISH' && currentPrice > ob.high) {\n        return false;\n      }\n      \n      // Apply age decay to confidence\n      const age = Date.now() - ob.timestamp;\n      const ageHours = age / (1000 * 60 * 60);\n      const decayFactor = Math.max(0.3, 1 - (ageHours / 168)); // Decay over 1 week\n      (ob as any).confidence = ob.confidence * decayFactor;\n    }\n    \n    // Liquidity Pool validation\n    if ('strength' in poi && 'price' in poi && !('high' in poi)) {\n      const pool = poi as LiquidityPool;\n      \n      // Pool is swept if price moves through it significantly\n      const sweepThreshold = 0.001; // 0.1% threshold\n      \n      if (pool.type === 'HIGH' && currentPrice > pool.price * (1 + sweepThreshold)) {\n        return false;\n      }\n      \n      if (pool.type === 'LOW' && currentPrice < pool.price * (1 - sweepThreshold)) {\n        return false;\n      }\n      \n      // Apply age decay to strength\n      const age = Date.now() - pool.timestamp;\n      const ageHours = age / (1000 * 60 * 60);\n      const decayFactor = Math.max(0.2, 1 - (ageHours / 72)); // Decay over 3 days\n      (pool as any).strength = pool.strength * decayFactor;\n    }\n    \n    return true;\n  }\n\n  /**\n   * Calculate average volume over a specified period\n   * \n   * @param candles OHLCV data array\n   * @param index Current index\n   * @param period Number of periods to average\n   * @returns Average volume\n   */\n  private calculateAverageVolume(candles: OHLCV[], index: number, period: number): number {\n    const start = Math.max(0, index - period + 1);\n    const end = Math.min(candles.length, index + 1);\n    \n    let totalVolume = 0;\n    let count = 0;\n    \n    for (let i = start; i < end; i++) {\n      totalVolume += candles[i].volume;\n      count++;\n    }\n    \n    return count > 0 ? totalVolume / count : 1;\n  }\n\n  /**\n   * Merge nearby liquidity pools to avoid clustering\n   * \n   * @param pools Array of liquidity pools\n   * @returns Merged array of liquidity pools\n   */\n  private mergeLiquidityPools(pools: LiquidityPool[]): LiquidityPool[] {\n    if (pools.length <= 1) return pools;\n    \n    const merged: LiquidityPool[] = [];\n    const processed = new Set<number>();\n    \n    for (let i = 0; i < pools.length; i++) {\n      if (processed.has(i)) continue;\n      \n      const pool = pools[i];\n      const nearbyPools: LiquidityPool[] = [pool];\n      processed.add(i);\n      \n      // Find nearby pools (within 1% price range)\n      for (let j = i + 1; j < pools.length; j++) {\n        if (processed.has(j)) continue;\n        \n        const otherPool = pools[j];\n        const priceDiff = Math.abs(pool.price - otherPool.price) / pool.price;\n        \n        if (priceDiff <= 0.01 && pool.type === otherPool.type) {\n          nearbyPools.push(otherPool);\n          processed.add(j);\n        }\n      }\n      \n      // Merge nearby pools\n      if (nearbyPools.length > 1) {\n        const totalStrength = nearbyPools.reduce((sum, p) => sum + p.strength, 0);\n        const avgPrice = nearbyPools.reduce((sum, p) => sum + p.price, 0) / nearbyPools.length;\n        const oldestTimestamp = Math.min(...nearbyPools.map(p => p.timestamp));\n        const oldestBarIndex = nearbyPools.find(p => p.timestamp === oldestTimestamp)?.barIndex || pool.barIndex;\n        \n        merged.push({\n          type: pool.type,\n          price: avgPrice,\n          strength: totalStrength,\n          barIndex: oldestBarIndex,\n          timestamp: oldestTimestamp,\n          swept: false\n        });\n      } else {\n        merged.push(pool);\n      }\n    }\n    \n    return merged;\n  }\n\n  /**\n   * Get all POIs for a symbol with confidence scoring\n   * \n   * @param candles OHLCV data array\n   * @param bos Array of Break of Structure events\n   * @param fractals Array of fractal swing points\n   * @param currentPrice Current market price\n   * @returns Object containing all POI types\n   */\n  getAllPOIs(candles: OHLCV[], bos: BOS[], fractals: Fractal[], currentPrice: number): {\n    fvgs: FVG[];\n    orderBlocks: OrderBlock[];\n    liquidityPools: LiquidityPool[];\n    validPOIs: POI[];\n  } {\n    // Detect all POI types\n    const fvgs = this.detectFVG(candles);\n    const orderBlocks = this.detectOrderBlock(candles, bos);\n    const liquidityPools = this.detectLiquidityPools(candles, fractals);\n    \n    // Combine all POIs\n    const allPOIs: POI[] = [...fvgs, ...orderBlocks, ...liquidityPools];\n    \n    // Filter for valid POIs only\n    const validPOIs = allPOIs.filter(poi => this.validatePOI(poi, currentPrice));\n    \n    return {\n      fvgs: fvgs.filter(fvg => this.validatePOI(fvg, currentPrice)),\n      orderBlocks: orderBlocks.filter(ob => this.validatePOI(ob, currentPrice)),\n      liquidityPools: liquidityPools.filter(pool => this.validatePOI(pool, currentPrice)),\n      validPOIs\n    };\n  }\n\n  /**\n   * Check if multiple POIs align within proximity threshold\n   * \n   * @param pois Array of POIs to check\n   * @param proximityThreshold Proximity threshold (default 0.5%)\n   * @returns Array of aligned POI groups\n   */\n  findAlignedPOIs(pois: POI[], proximityThreshold: number = 0.005): POI[][] {\n    const alignedGroups: POI[][] = [];\n    const processed = new Set<POI>();\n    \n    for (const poi of pois) {\n      if (processed.has(poi)) continue;\n      \n      const group: POI[] = [poi];\n      processed.add(poi);\n      \n      const poiPrice = this.getPOIPrice(poi);\n      \n      // Find other POIs within proximity\n      for (const otherPOI of pois) {\n        if (processed.has(otherPOI)) continue;\n        \n        const otherPrice = this.getPOIPrice(otherPOI);\n        const priceDiff = Math.abs(poiPrice - otherPrice) / poiPrice;\n        \n        if (priceDiff <= proximityThreshold) {\n          group.push(otherPOI);\n          processed.add(otherPOI);\n        }\n      }\n      \n      // Only consider groups with multiple POIs as \"aligned\"\n      if (group.length > 1) {\n        alignedGroups.push(group);\n      }\n    }\n    \n    return alignedGroups;\n  }\n\n  /**\n   * Get the representative price of a POI\n   * \n   * @param poi Point of Interest\n   * @returns Representative price\n   */\n  private getPOIPrice(poi: POI): number {\n    if ('midpoint' in poi) {\n      return poi.midpoint; // FVG\n    } else if ('high' in poi && 'low' in poi) {\n      return (poi.high + poi.low) / 2; // Order Block\n    } else {\n      return poi.price; // Liquidity Pool\n    }\n  }\n}"],"version":3}