{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/risk/CorrelationManager.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/risk/CorrelationManager.ts"],"sourcesContent":["/**\n * Correlation Manager for Titan Phase 2 - The Hunter\n * \n * Manages correlation-based position limits to avoid overexposure to correlated assets.\n * Implements 24-hour rolling correlation calculations and enforces correlation thresholds.\n * \n * Requirements: 14.1-14.7 (Correlation-Based Position Limits)\n */\n\nimport { EventEmitter } from 'events';\nimport { Position, OHLCV } from '../types';\nimport { BybitPerpsClient } from '../exchanges/BybitPerpsClient';\n\nexport interface CorrelationData {\n  symbol1: string;\n  symbol2: string;\n  correlation: number;\n  timestamp: number;\n}\n\nexport interface CorrelationMatrix {\n  symbols: string[];\n  matrix: number[][];\n  timestamp: number;\n}\n\nexport interface CorrelationResult {\n  allowed: boolean;\n  adjustedSize?: number;\n  reason?: string;\n  correlation?: number;\n}\n\nexport interface HighBetaState {\n  isHighBeta: boolean;\n  btcCorrelation: number;\n  affectedSymbols: string[];\n  timestamp: number;\n}\n\nexport interface CorrelationManagerConfig {\n  correlationThreshold: number; // 0.7 - reduce position size by 50%\n  rejectThreshold: number; // 0.85 - reject signal completely\n  groupCorrelationThreshold: number; // 0.5 - for calculating total correlated exposure\n  maxCorrelatedExposure: number; // 0.4 - 40% of equity max\n  highBetaThreshold: number; // 0.9 - BTC correlation threshold\n  highBetaReduction: number; // 0.3 - 30% position size reduction\n  rollingWindowHours: number; // 24 - hours for rolling correlation\n  updateIntervalMs: number; // 300000 - 5 minutes\n}\n\nexport interface CorrelationManagerEvents {\n  'correlation:updated': (matrix: CorrelationMatrix) => void;\n  'correlation:high_beta': (state: HighBetaState) => void;\n  'correlation:reject': (symbol: string, correlation: number, conflictSymbol: string) => void;\n  'correlation:reduce': (symbol: string, correlation: number, originalSize: number, adjustedSize: number) => void;\n  'correlation:exposure_limit': (totalExposure: number, maxExposure: number) => void;\n}\n\nexport class CorrelationManager extends EventEmitter {\n  private config: CorrelationManagerConfig;\n  private bybitClient: BybitPerpsClient;\n  private correlationCache: Map<string, CorrelationData[]> = new Map();\n  private priceHistory: Map<string, OHLCV[]> = new Map();\n  private updateInterval: NodeJS.Timeout | null = null;\n  private highBetaState: HighBetaState | null = null;\n\n  constructor(bybitClient: BybitPerpsClient, config?: Partial<CorrelationManagerConfig>) {\n    super();\n    \n    this.bybitClient = bybitClient;\n    this.config = {\n      correlationThreshold: 0.7,\n      rejectThreshold: 0.85,\n      groupCorrelationThreshold: 0.5,\n      maxCorrelatedExposure: 0.4,\n      highBetaThreshold: 0.9,\n      highBetaReduction: 0.3,\n      rollingWindowHours: 24,\n      updateIntervalMs: 300000, // 5 minutes\n      ...config\n    };\n\n    // Start correlation monitoring\n    this.startMonitoring();\n  }\n\n  /**\n   * Calculate 24-hour rolling correlation between two symbols\n   * @param symbol1 - First symbol\n   * @param symbol2 - Second symbol\n   * @returns Correlation coefficient (-1 to 1)\n   */\n  public async calcCorrelation(symbol1: string, symbol2: string): Promise<number> {\n    try {\n      // Get 24-hour price data for both symbols\n      const [data1, data2] = await Promise.all([\n        this.getPriceHistory(symbol1),\n        this.getPriceHistory(symbol2)\n      ]);\n\n      if (data1.length < 24 || data2.length < 24) {\n        console.warn(`‚ö†Ô∏è Insufficient data for correlation: ${symbol1} (${data1.length}), ${symbol2} (${data2.length})`);\n        return 0;\n      }\n\n      // Align data by timestamp and calculate returns\n      const alignedData = this.alignPriceData(data1, data2);\n      if (alignedData.length < 20) {\n        console.warn(`‚ö†Ô∏è Insufficient aligned data for correlation: ${alignedData.length} points`);\n        return 0;\n      }\n\n      // Calculate returns\n      const returns1 = this.calculateReturns(alignedData.map(d => d.price1));\n      const returns2 = this.calculateReturns(alignedData.map(d => d.price2));\n\n      // Calculate Pearson correlation coefficient\n      const correlation = this.pearsonCorrelation(returns1, returns2);\n\n      // Cache the result\n      this.cacheCorrelation(symbol1, symbol2, correlation);\n\n      return correlation;\n    } catch (error) {\n      console.error(`‚ùå Failed to calculate correlation between ${symbol1} and ${symbol2}:`, error);\n      return 0;\n    }\n  }\n\n  /**\n   * Check correlation limit and determine if position is allowed\n   * @param candidateSymbol - Symbol to check\n   * @param openPositions - Currently open positions\n   * @param proposedSize - Proposed position size\n   * @returns Correlation result with allowed status and adjusted size\n   */\n  public async checkCorrelationLimit(\n    candidateSymbol: string, \n    openPositions: Position[], \n    proposedSize: number\n  ): Promise<CorrelationResult> {\n    try {\n      let maxCorrelation = 0;\n      let conflictSymbol = '';\n\n      // Check correlation with all open positions\n      for (const position of openPositions) {\n        if (position.symbol === candidateSymbol) continue;\n\n        const correlation = Math.abs(await this.calcCorrelation(candidateSymbol, position.symbol));\n        \n        if (correlation > maxCorrelation) {\n          maxCorrelation = correlation;\n          conflictSymbol = position.symbol;\n        }\n      }\n\n      // Check rejection threshold (0.85)\n      if (maxCorrelation >= this.config.rejectThreshold) {\n        this.emit('correlation:reject', candidateSymbol, maxCorrelation, conflictSymbol);\n        console.log(`üö´ Signal rejected: ${candidateSymbol} correlation ${maxCorrelation.toFixed(3)} with ${conflictSymbol} exceeds ${this.config.rejectThreshold}`);\n        \n        return {\n          allowed: false,\n          reason: `CORRELATION_REJECT: ${maxCorrelation.toFixed(3)} with ${conflictSymbol}`,\n          correlation: maxCorrelation\n        };\n      }\n\n      // Check reduction threshold (0.7)\n      if (maxCorrelation >= this.config.correlationThreshold) {\n        const adjustedSize = proposedSize * 0.5; // Reduce by 50%\n        this.emit('correlation:reduce', candidateSymbol, maxCorrelation, proposedSize, adjustedSize);\n        console.log(`üìâ Position size reduced: ${candidateSymbol} ${proposedSize} ‚Üí ${adjustedSize} (correlation ${maxCorrelation.toFixed(3)} with ${conflictSymbol})`);\n        \n        return {\n          allowed: true,\n          adjustedSize,\n          reason: `CORRELATION_REDUCE: ${maxCorrelation.toFixed(3)} with ${conflictSymbol}`,\n          correlation: maxCorrelation\n        };\n      }\n\n      // No correlation issues\n      return {\n        allowed: true,\n        correlation: maxCorrelation\n      };\n    } catch (error) {\n      console.error(`‚ùå Failed to check correlation limit for ${candidateSymbol}:`, error);\n      return { allowed: true }; // Allow on error to avoid blocking trades\n    }\n  }\n\n  /**\n   * Calculate total correlated exposure capped at 40% equity\n   * @param openPositions - Currently open positions\n   * @param totalEquity - Total account equity\n   * @returns Total correlated exposure as percentage of equity\n   */\n  public async calcTotalCorrelatedExposure(openPositions: Position[], totalEquity: number): Promise<number> {\n    try {\n      if (openPositions.length < 2) return 0;\n\n      const correlationMatrix = await this.generateCorrelationMatrix(openPositions.map(p => p.symbol));\n      const symbols = correlationMatrix.symbols;\n      const matrix = correlationMatrix.matrix;\n\n      // Group highly correlated positions (correlation > 0.5)\n      const correlatedGroups: Position[][] = [];\n      const processed = new Set<string>();\n\n      for (let i = 0; i < symbols.length; i++) {\n        if (processed.has(symbols[i])) continue;\n\n        const group: Position[] = [];\n        const position1 = openPositions.find(p => p.symbol === symbols[i]);\n        if (position1) {\n          group.push(position1);\n          processed.add(symbols[i]);\n        }\n\n        // Find correlated positions\n        for (let j = i + 1; j < symbols.length; j++) {\n          if (processed.has(symbols[j])) continue;\n\n          const correlation = Math.abs(matrix[i][j]);\n          if (correlation >= this.config.groupCorrelationThreshold) {\n            const position2 = openPositions.find(p => p.symbol === symbols[j]);\n            if (position2) {\n              group.push(position2);\n              processed.add(symbols[j]);\n            }\n          }\n        }\n\n        if (group.length > 1) {\n          correlatedGroups.push(group);\n        }\n      }\n\n      // Calculate total correlated exposure\n      let totalCorrelatedExposure = 0;\n      for (const group of correlatedGroups) {\n        const groupExposure = group.reduce((sum, pos) => {\n          const notional = pos.quantity * pos.currentPrice * pos.leverage;\n          return sum + notional;\n        }, 0);\n        totalCorrelatedExposure += groupExposure;\n      }\n\n      const exposurePercentage = totalCorrelatedExposure / totalEquity;\n      const maxExposure = this.config.maxCorrelatedExposure;\n\n      if (exposurePercentage > maxExposure) {\n        this.emit('correlation:exposure_limit', exposurePercentage, maxExposure);\n        console.warn(`‚ö†Ô∏è Correlated exposure ${(exposurePercentage * 100).toFixed(1)}% exceeds limit ${(maxExposure * 100).toFixed(1)}%`);\n      }\n\n      return exposurePercentage;\n    } catch (error) {\n      console.error(`‚ùå Failed to calculate total correlated exposure:`, error);\n      return 0;\n    }\n  }\n\n  /**\n   * Detect high beta market conditions when BTC correlation > 0.9\n   * @param topSymbols - Top 10 symbols to check\n   * @returns High beta state\n   */\n  public async detectHighBeta(topSymbols: string[]): Promise<HighBetaState> {\n    try {\n      const btcSymbol = 'BTCUSDT';\n      const correlations: number[] = [];\n      const affectedSymbols: string[] = [];\n\n      // Calculate correlation with BTC for each symbol\n      for (const symbol of topSymbols.slice(0, 10)) {\n        if (symbol === btcSymbol) continue;\n\n        const correlation = Math.abs(await this.calcCorrelation(symbol, btcSymbol));\n        correlations.push(correlation);\n\n        if (correlation >= this.config.highBetaThreshold) {\n          affectedSymbols.push(symbol);\n        }\n      }\n\n      // Calculate average BTC correlation\n      const avgBtcCorrelation = correlations.length > 0 \n        ? correlations.reduce((sum, corr) => sum + corr, 0) / correlations.length \n        : 0;\n\n      const isHighBeta = avgBtcCorrelation >= this.config.highBetaThreshold;\n\n      const highBetaState: HighBetaState = {\n        isHighBeta,\n        btcCorrelation: avgBtcCorrelation,\n        affectedSymbols,\n        timestamp: Date.now()\n      };\n\n      // Update state and emit event if changed\n      if (!this.highBetaState || this.highBetaState.isHighBeta !== isHighBeta) {\n        this.highBetaState = highBetaState;\n        this.emit('correlation:high_beta', highBetaState);\n\n        if (isHighBeta) {\n          console.warn(`üî¥ HIGH BETA market detected: BTC correlation ${avgBtcCorrelation.toFixed(3)}, ${affectedSymbols.length} symbols affected`);\n        } else {\n          console.log(`üü¢ Normal market conditions: BTC correlation ${avgBtcCorrelation.toFixed(3)}`);\n        }\n      }\n\n      return highBetaState;\n    } catch (error) {\n      console.error(`‚ùå Failed to detect high beta conditions:`, error);\n      return {\n        isHighBeta: false,\n        btcCorrelation: 0,\n        affectedSymbols: [],\n        timestamp: Date.now()\n      };\n    }\n  }\n\n  /**\n   * Generate correlation matrix for UI display\n   * @param symbols - Symbols to include in matrix\n   * @returns Correlation matrix\n   */\n  public async generateCorrelationMatrix(symbols: string[]): Promise<CorrelationMatrix> {\n    try {\n      const n = symbols.length;\n      const matrix: number[][] = Array(n).fill(null).map(() => Array(n).fill(0));\n\n      // Calculate correlation for each pair\n      for (let i = 0; i < n; i++) {\n        for (let j = 0; j < n; j++) {\n          if (i === j) {\n            matrix[i][j] = 1.0; // Perfect correlation with self\n          } else if (i < j) {\n            // Calculate correlation for upper triangle\n            const correlation = await this.calcCorrelation(symbols[i], symbols[j]);\n            matrix[i][j] = correlation;\n            matrix[j][i] = correlation; // Mirror to lower triangle\n          }\n        }\n      }\n\n      const correlationMatrix: CorrelationMatrix = {\n        symbols,\n        matrix,\n        timestamp: Date.now()\n      };\n\n      this.emit('correlation:updated', correlationMatrix);\n      return correlationMatrix;\n    } catch (error) {\n      console.error(`‚ùå Failed to generate correlation matrix:`, error);\n      return {\n        symbols: [],\n        matrix: [],\n        timestamp: Date.now()\n      };\n    }\n  }\n\n  /**\n   * Get 24-hour price history for a symbol\n   * @param symbol - Symbol to get price history for\n   * @returns Array of OHLCV data\n   */\n  private async getPriceHistory(symbol: string): Promise<OHLCV[]> {\n    try {\n      // Check cache first\n      const cached = this.priceHistory.get(symbol);\n      if (cached && cached.length > 0) {\n        const latestTime = cached[cached.length - 1].timestamp;\n        const hoursSinceUpdate = (Date.now() - latestTime) / (1000 * 60 * 60);\n        \n        if (hoursSinceUpdate < 1) {\n          return cached; // Use cached data if less than 1 hour old\n        }\n      }\n\n      // Fetch fresh 24-hour data (hourly candles)\n      const data = await this.bybitClient.fetchOHLCV(symbol, '1h', 24);\n      this.priceHistory.set(symbol, data);\n      \n      return data;\n    } catch (error) {\n      console.error(`‚ùå Failed to get price history for ${symbol}:`, error);\n      return [];\n    }\n  }\n\n  /**\n   * Align price data by timestamp\n   * @param data1 - First symbol's price data\n   * @param data2 - Second symbol's price data\n   * @returns Aligned price data\n   */\n  private alignPriceData(data1: OHLCV[], data2: OHLCV[]): { timestamp: number; price1: number; price2: number }[] {\n    const aligned: { timestamp: number; price1: number; price2: number }[] = [];\n    \n    // Create maps for faster lookup\n    const map1 = new Map(data1.map(d => [d.timestamp, d.close]));\n    const map2 = new Map(data2.map(d => [d.timestamp, d.close]));\n\n    // Find common timestamps\n    const timestamps1 = new Set(data1.map(d => d.timestamp));\n    const timestamps2 = new Set(data2.map(d => d.timestamp));\n    const commonTimestamps = Array.from(timestamps1).filter(t => timestamps2.has(t));\n\n    // Align data\n    for (const timestamp of commonTimestamps.sort()) {\n      const price1 = map1.get(timestamp);\n      const price2 = map2.get(timestamp);\n      \n      if (price1 !== undefined && price2 !== undefined) {\n        aligned.push({ timestamp, price1, price2 });\n      }\n    }\n\n    return aligned;\n  }\n\n  /**\n   * Calculate returns from price series\n   * @param prices - Array of prices\n   * @returns Array of returns\n   */\n  private calculateReturns(prices: number[]): number[] {\n    const returns: number[] = [];\n    \n    for (let i = 1; i < prices.length; i++) {\n      const returnValue = (prices[i] - prices[i - 1]) / prices[i - 1];\n      returns.push(returnValue);\n    }\n    \n    return returns;\n  }\n\n  /**\n   * Calculate Pearson correlation coefficient\n   * @param x - First data series\n   * @param y - Second data series\n   * @returns Correlation coefficient (-1 to 1)\n   */\n  private pearsonCorrelation(x: number[], y: number[]): number {\n    if (x.length !== y.length || x.length === 0) {\n      return 0;\n    }\n\n    const n = x.length;\n    \n    // Calculate means\n    const meanX = x.reduce((sum, val) => sum + val, 0) / n;\n    const meanY = y.reduce((sum, val) => sum + val, 0) / n;\n\n    // Calculate numerator and denominators\n    let numerator = 0;\n    let sumXSquared = 0;\n    let sumYSquared = 0;\n\n    for (let i = 0; i < n; i++) {\n      const xDiff = x[i] - meanX;\n      const yDiff = y[i] - meanY;\n      \n      numerator += xDiff * yDiff;\n      sumXSquared += xDiff * xDiff;\n      sumYSquared += yDiff * yDiff;\n    }\n\n    const denominator = Math.sqrt(sumXSquared * sumYSquared);\n    \n    if (denominator === 0) {\n      return 0; // No correlation if no variance\n    }\n\n    return numerator / denominator;\n  }\n\n  /**\n   * Cache correlation result\n   * @param symbol1 - First symbol\n   * @param symbol2 - Second symbol\n   * @param correlation - Correlation value\n   */\n  private cacheCorrelation(symbol1: string, symbol2: string, correlation: number): void {\n    const key = [symbol1, symbol2].sort().join('-');\n    \n    if (!this.correlationCache.has(key)) {\n      this.correlationCache.set(key, []);\n    }\n\n    const cache = this.correlationCache.get(key)!;\n    cache.push({\n      symbol1,\n      symbol2,\n      correlation,\n      timestamp: Date.now()\n    });\n\n    // Keep only last 24 hours of data\n    const cutoff = Date.now() - (this.config.rollingWindowHours * 60 * 60 * 1000);\n    this.correlationCache.set(key, cache.filter(c => c.timestamp > cutoff));\n  }\n\n  /**\n   * Start correlation monitoring\n   */\n  private startMonitoring(): void {\n    if (this.updateInterval) {\n      clearInterval(this.updateInterval);\n    }\n\n    this.updateInterval = setInterval(async () => {\n      await this.updateCorrelations();\n    }, this.config.updateIntervalMs);\n\n    console.log(`üìä Correlation Manager: Started monitoring (${this.config.updateIntervalMs / 1000}s interval)`);\n  }\n\n  /**\n   * Stop correlation monitoring\n   */\n  public stopMonitoring(): void {\n    if (this.updateInterval) {\n      clearInterval(this.updateInterval);\n      this.updateInterval = null;\n    }\n    console.log(`üìä Correlation Manager: Stopped monitoring`);\n  }\n\n  /**\n   * Update correlations for all cached pairs\n   */\n  private async updateCorrelations(): Promise<void> {\n    try {\n      // Clean old cache entries\n      const cutoff = Date.now() - (this.config.rollingWindowHours * 60 * 60 * 1000);\n      \n      for (const [key, cache] of Array.from(this.correlationCache.entries())) {\n        const filtered = cache.filter(c => c.timestamp > cutoff);\n        if (filtered.length === 0) {\n          this.correlationCache.delete(key);\n        } else {\n          this.correlationCache.set(key, filtered);\n        }\n      }\n\n      // Clean old price history\n      for (const [symbol, history] of Array.from(this.priceHistory.entries())) {\n        const filtered = history.filter(h => h.timestamp > cutoff);\n        if (filtered.length === 0) {\n          this.priceHistory.delete(symbol);\n        } else {\n          this.priceHistory.set(symbol, filtered);\n        }\n      }\n\n      console.log(`üìä Correlation cache updated: ${this.correlationCache.size} pairs, ${this.priceHistory.size} symbols`);\n    } catch (error) {\n      console.error(`‚ùå Failed to update correlations:`, error);\n    }\n  }\n\n  /**\n   * Get current high beta state\n   * @returns Current high beta state or null\n   */\n  public getHighBetaState(): HighBetaState | null {\n    return this.highBetaState;\n  }\n\n  /**\n   * Get correlation statistics\n   * @returns Correlation statistics\n   */\n  public getStatistics(): {\n    cachedPairs: number;\n    cachedSymbols: number;\n    highBetaActive: boolean;\n    avgBtcCorrelation: number;\n  } {\n    return {\n      cachedPairs: this.correlationCache.size,\n      cachedSymbols: this.priceHistory.size,\n      highBetaActive: this.highBetaState?.isHighBeta || false,\n      avgBtcCorrelation: this.highBetaState?.btcCorrelation || 0\n    };\n  }\n\n  /**\n   * Update configuration\n   * @param newConfig - New configuration\n   */\n  public updateConfig(newConfig: Partial<CorrelationManagerConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    console.log(`üìä Correlation Manager: Configuration updated`);\n  }\n\n  /**\n   * Clear all cached data\n   */\n  public clearCache(): void {\n    this.correlationCache.clear();\n    this.priceHistory.clear();\n    this.highBetaState = null;\n    console.log(`üìä Correlation Manager: Cache cleared`);\n  }\n\n  /**\n   * Cleanup resources\n   */\n  public destroy(): void {\n    this.stopMonitoring();\n    this.clearCache();\n    this.removeAllListeners();\n    console.log(`üìä Correlation Manager: Destroyed`);\n  }\n}\n\n// Export event interface for TypeScript\nexport declare interface CorrelationManager {\n  on<U extends keyof CorrelationManagerEvents>(event: U, listener: CorrelationManagerEvents[U]): this;\n  emit<U extends keyof CorrelationManagerEvents>(event: U, ...args: Parameters<CorrelationManagerEvents[U]>): boolean;\n}"],"version":3}