83961dfff8a93599e0813b564285b9ae
"use strict";
/**
 * Logger for Titan Phase 2 - The Hunter
 *
 * Implements JSONL (JSON Lines) logging for signals, executions, and errors
 * with automatic log rotation and compression.
 *
 * Requirements: 16.1-16.7 (Signal Execution Logging)
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.logError = exports.logPositionClose = exports.logExecution = exports.logSignal = exports.logger = exports.Logger = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const zlib = __importStar(require("zlib"));
const util_1 = require("util");
const gzip = (0, util_1.promisify)(zlib.gzip);
const writeFile = (0, util_1.promisify)(fs.writeFile);
const stat = (0, util_1.promisify)(fs.stat);
const readdir = (0, util_1.promisify)(fs.readdir);
/**
 * JSONL Logger for Titan Phase 2
 *
 * Logs all signals, executions, and errors to trades.jsonl file
 * with automatic rotation and compression.
 */
class Logger {
    config;
    logFilePath;
    writeStream = null;
    constructor(config) {
        this.config = {
            logDir: path.join(process.cwd(), 'logs'),
            logFileName: 'trades.jsonl',
            maxFileSizeBytes: 10 * 1024 * 1024, // 10MB
            compressionAgeMs: 30 * 24 * 60 * 60 * 1000, // 30 days
            enableConsoleOutput: false,
            ...config
        };
        this.logFilePath = path.join(this.config.logDir, this.config.logFileName);
        this.ensureLogDirectory();
        this.initializeWriteStream();
    }
    /**
     * Ensure log directory exists
     */
    ensureLogDirectory() {
        if (!fs.existsSync(this.config.logDir)) {
            fs.mkdirSync(this.config.logDir, { recursive: true });
        }
    }
    /**
     * Initialize write stream for log file
     */
    initializeWriteStream() {
        this.writeStream = fs.createWriteStream(this.logFilePath, { flags: 'a' });
        this.writeStream.on('error', (error) => {
            console.error('Logger write stream error:', error);
        });
    }
    /**
     * Log a signal with comprehensive hologram state
     *
     * Requirement 16.2: Include timestamp, symbol, strategy type, confidence,
     * leverage, entry price, stop price, target price, alignment state,
     * RS score, session type, POI type, and CVD status
     */
    logSignal(signal, hologramState, sessionType, poiType, cvdConfirmation) {
        const logEntry = {
            timestamp: Date.now(),
            type: 'signal',
            symbol: signal.symbol,
            strategyType: 'holographic',
            confidence: signal.confidence,
            leverage: signal.leverage,
            entryPrice: signal.entryPrice,
            stopPrice: signal.stopLoss,
            targetPrice: signal.takeProfit,
            alignmentState: {
                status: hologramState.status,
                score: hologramState.alignmentScore,
                daily: `${hologramState.daily.trend}_${hologramState.daily.location}`,
                h4: `${hologramState.h4.trend}_${hologramState.h4.location}`,
                m15: `${hologramState.m15.trend}_${hologramState.m15.mss ? 'MSS' : 'NO_MSS'}`
            },
            rsScore: hologramState.rsScore,
            sessionType,
            poiType,
            cvdStatus: cvdConfirmation,
            direction: signal.direction,
            positionSize: signal.positionSize
        };
        this.writeLogEntry(logEntry);
        if (this.config.enableConsoleOutput) {
            console.log(`ðŸ“Š SIGNAL: ${signal.symbol} ${signal.direction} @ ${signal.entryPrice} (${hologramState.status}, RS:${hologramState.rsScore.toFixed(3)})`);
        }
    }
    /**
     * Log order execution with fill details
     *
     * Requirement 16.3: Include fill price, fill timestamp, order type, and slippage
     */
    logExecution(orderResult, slippage, signalId, fees) {
        const logEntry = {
            timestamp: Date.now(),
            type: 'execution',
            signalId,
            orderId: orderResult.orderId,
            symbol: orderResult.symbol,
            side: orderResult.side,
            qty: orderResult.qty,
            fillPrice: orderResult.price,
            fillTimestamp: orderResult.timestamp,
            orderType: 'LIMIT', // Phase 2 uses Post-Only Limit Orders
            slippage,
            fees
        };
        this.writeLogEntry(logEntry);
        if (this.config.enableConsoleOutput) {
            console.log(`âœ… FILL: ${orderResult.symbol} ${orderResult.side} ${orderResult.qty} @ ${orderResult.price} (slippage: ${(slippage * 100).toFixed(3)}%)`);
        }
    }
    /**
     * Log position close with P&L details
     *
     * Requirement 16.4: Include exit price, exit timestamp, profit percentage,
     * close reason, and hold time
     */
    logPositionClose(positionId, symbol, side, entryPrice, exitPrice, profitPercentage, closeReason, holdTime, rValue) {
        const logEntry = {
            timestamp: Date.now(),
            type: 'close',
            positionId,
            symbol,
            side,
            exitPrice,
            exitTimestamp: Date.now(),
            profitPercentage,
            closeReason,
            holdTime,
            entryPrice,
            rValue
        };
        this.writeLogEntry(logEntry);
        if (this.config.enableConsoleOutput) {
            const pnlColor = profitPercentage >= 0 ? '\x1b[32m' : '\x1b[31m';
            console.log(`${pnlColor}ðŸ’° CLOSE: ${symbol} ${side} ${profitPercentage.toFixed(2)}% (${rValue.toFixed(2)}R) - ${closeReason}\x1b[0m`);
        }
    }
    /**
     * Log error with context
     */
    logError(level, message, context = {}) {
        const logEntry = {
            timestamp: Date.now(),
            type: 'error',
            level,
            message,
            context: {
                ...context,
                phase: 'phase2'
            }
        };
        this.writeLogEntry(logEntry);
        if (this.config.enableConsoleOutput) {
            const levelColor = level === 'CRITICAL' ? '\x1b[31m' : level === 'ERROR' ? '\x1b[33m' : '\x1b[36m';
            console.log(`${levelColor}âŒ ${level}: ${message}\x1b[0m`);
        }
    }
    /**
     * Write log entry to JSONL file
     *
     * Requirement 16.1: Append signal data to trades.jsonl file as single JSON object per line
     */
    writeLogEntry(entry) {
        try {
            const jsonLine = JSON.stringify(entry) + '\n';
            if (this.writeStream) {
                this.writeStream.write(jsonLine);
            }
            else {
                // Fallback to synchronous write if stream is not available
                fs.appendFileSync(this.logFilePath, jsonLine);
            }
            // Check if log rotation is needed
            this.checkLogRotation();
        }
        catch (error) {
            console.error('Failed to write log entry:', error);
        }
    }
    /**
     * Check if log file needs rotation
     *
     * Requirement 16.5: Rotate log file when size exceeds 10MB
     */
    async checkLogRotation() {
        try {
            const stats = await stat(this.logFilePath);
            if (stats.size >= this.config.maxFileSizeBytes) {
                await this.rotateLogFile();
            }
        }
        catch (error) {
            // File might not exist yet, ignore
        }
    }
    /**
     * Rotate log file with timestamp suffix
     *
     * Requirement 16.5: Rotate log file with timestamp suffix
     */
    async rotateLogFile() {
        try {
            // Close current write stream
            if (this.writeStream) {
                this.writeStream.end();
                this.writeStream = null;
            }
            // Create rotated filename with timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const rotatedFileName = this.config.logFileName.replace('.jsonl', `-${timestamp}.jsonl`);
            const rotatedFilePath = path.join(this.config.logDir, rotatedFileName);
            // Rename current log file
            fs.renameSync(this.logFilePath, rotatedFilePath);
            // Create new write stream
            this.initializeWriteStream();
            console.log(`ðŸ“ Log rotated: ${rotatedFileName}`);
            // Schedule compression check
            this.scheduleCompressionCheck();
        }
        catch (error) {
            console.error('Failed to rotate log file:', error);
            // Reinitialize write stream on error
            this.initializeWriteStream();
        }
    }
    /**
     * Schedule compression check for old log files
     *
     * Requirement 16.6: Compress log files older than 30 days
     */
    scheduleCompressionCheck() {
        // Run compression check asynchronously
        setImmediate(() => {
            this.compressOldLogs().catch(error => {
                console.error('Failed to compress old logs:', error);
            });
        });
    }
    /**
     * Compress log files older than configured age
     *
     * Requirement 16.6: Compress log file to gzip format when age exceeds 30 days
     */
    async compressOldLogs() {
        try {
            const files = await readdir(this.config.logDir);
            const now = Date.now();
            for (const file of files) {
                // Skip current log file and already compressed files
                if (file === this.config.logFileName || file.endsWith('.gz')) {
                    continue;
                }
                // Only process .jsonl files
                if (!file.endsWith('.jsonl')) {
                    continue;
                }
                const filePath = path.join(this.config.logDir, file);
                const stats = await stat(filePath);
                const fileAge = now - stats.mtime.getTime();
                // Compress if older than configured age
                if (fileAge > this.config.compressionAgeMs) {
                    await this.compressLogFile(filePath);
                }
            }
        }
        catch (error) {
            console.error('Failed to check old logs for compression:', error);
        }
    }
    /**
     * Compress a single log file to gzip format
     */
    async compressLogFile(filePath) {
        try {
            const fileContent = fs.readFileSync(filePath);
            const compressed = await gzip(fileContent);
            const compressedPath = filePath + '.gz';
            await writeFile(compressedPath, compressed);
            fs.unlinkSync(filePath); // Remove original file
            console.log(`ðŸ—œï¸ Compressed: ${path.basename(filePath)} â†’ ${path.basename(compressedPath)}`);
        }
        catch (error) {
            console.error(`Failed to compress ${filePath}:`, error);
        }
    }
    /**
     * Get log file statistics
     */
    async getLogStats() {
        try {
            const files = await readdir(this.config.logDir);
            const logFiles = files.filter(f => f.endsWith('.jsonl') || f.endsWith('.jsonl.gz'));
            let currentSize = 0;
            let oldestFile = null;
            let newestFile = null;
            let oldestTime = Infinity;
            let newestTime = 0;
            // Get current log file size
            try {
                const currentStats = await stat(this.logFilePath);
                currentSize = currentStats.size;
            }
            catch {
                // File might not exist yet
            }
            // Find oldest and newest files
            for (const file of logFiles) {
                const filePath = path.join(this.config.logDir, file);
                const stats = await stat(filePath);
                if (stats.mtime.getTime() < oldestTime) {
                    oldestTime = stats.mtime.getTime();
                    oldestFile = file;
                }
                if (stats.mtime.getTime() > newestTime) {
                    newestTime = stats.mtime.getTime();
                    newestFile = file;
                }
            }
            return {
                currentSize,
                totalFiles: logFiles.length,
                compressedFiles: files.filter(f => f.endsWith('.gz')).length,
                oldestFile,
                newestFile
            };
        }
        catch (error) {
            console.error('Failed to get log stats:', error);
            return {
                currentSize: 0,
                totalFiles: 0,
                compressedFiles: 0,
                oldestFile: null,
                newestFile: null
            };
        }
    }
    /**
     * Flush and close logger
     */
    async close() {
        if (this.writeStream) {
            return new Promise((resolve) => {
                this.writeStream.end(() => {
                    this.writeStream = null;
                    resolve();
                });
            });
        }
    }
    /**
     * Update logger configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('ðŸ“Š Logger: Configuration updated');
    }
}
exports.Logger = Logger;
/**
 * Default logger instance for Phase 2
 */
exports.logger = new Logger({
    enableConsoleOutput: process.env.NODE_ENV !== 'production'
});
/**
 * Convenience functions for common logging operations
 */
const logSignal = (signal, hologramState, sessionType, poiType, cvdConfirmation) => exports.logger.logSignal(signal, hologramState, sessionType, poiType, cvdConfirmation);
exports.logSignal = logSignal;
const logExecution = (orderResult, slippage, signalId, fees) => exports.logger.logExecution(orderResult, slippage, signalId, fees);
exports.logExecution = logExecution;
const logPositionClose = (positionId, symbol, side, entryPrice, exitPrice, profitPercentage, closeReason, holdTime, rValue) => exports.logger.logPositionClose(positionId, symbol, side, entryPrice, exitPrice, profitPercentage, closeReason, holdTime, rValue);
exports.logPositionClose = logPositionClose;
const logError = (level, message, context) => exports.logger.logError(level, message, context);
exports.logError = logError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2xvZ2dpbmcvTG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBQzdCLDJDQUE2QjtBQUM3QiwrQkFBaUM7QUFTakMsTUFBTSxJQUFJLEdBQUcsSUFBQSxnQkFBUyxFQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNsQyxNQUFNLFNBQVMsR0FBRyxJQUFBLGdCQUFTLEVBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzFDLE1BQU0sSUFBSSxHQUFHLElBQUEsZ0JBQVMsRUFBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEMsTUFBTSxPQUFPLEdBQUcsSUFBQSxnQkFBUyxFQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQWlHdEM7Ozs7O0dBS0c7QUFDSCxNQUFhLE1BQU07SUFDVCxNQUFNLENBQWU7SUFDckIsV0FBVyxDQUFTO0lBQ3BCLFdBQVcsR0FBMEIsSUFBSSxDQUFDO0lBRWxELFlBQVksTUFBOEI7UUFDeEMsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUM7WUFDeEMsV0FBVyxFQUFFLGNBQWM7WUFDM0IsZ0JBQWdCLEVBQUUsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJLEVBQUUsT0FBTztZQUMzQyxnQkFBZ0IsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxFQUFFLFVBQVU7WUFDdEQsbUJBQW1CLEVBQUUsS0FBSztZQUMxQixHQUFHLE1BQU07U0FDVixDQUFDO1FBRUYsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElB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cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2xvZ2dpbmcvTG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTG9nZ2VyIGZvciBUaXRhbiBQaGFzZSAyIC0gVGhlIEh1bnRlclxuICogXG4gKiBJbXBsZW1lbnRzIEpTT05MIChKU09OIExpbmVzKSBsb2dnaW5nIGZvciBzaWduYWxzLCBleGVjdXRpb25zLCBhbmQgZXJyb3JzXG4gKiB3aXRoIGF1dG9tYXRpYyBsb2cgcm90YXRpb24gYW5kIGNvbXByZXNzaW9uLlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDE2LjEtMTYuNyAoU2lnbmFsIEV4ZWN1dGlvbiBMb2dnaW5nKVxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5pbXBvcnQgeyBcbiAgU2lnbmFsRGF0YSwgXG4gIEV4ZWN1dGlvbkRhdGEsIFxuICBIb2xvZ3JhbVN0YXRlLCBcbiAgU2Vzc2lvblR5cGUsIFxuICBPcmRlclJlc3VsdCBcbn0gZnJvbSAnLi4vdHlwZXMnO1xuXG5jb25zdCBnemlwID0gcHJvbWlzaWZ5KHpsaWIuZ3ppcCk7XG5jb25zdCB3cml0ZUZpbGUgPSBwcm9taXNpZnkoZnMud3JpdGVGaWxlKTtcbmNvbnN0IHN0YXQgPSBwcm9taXNpZnkoZnMuc3RhdCk7XG5jb25zdCByZWFkZGlyID0gcHJvbWlzaWZ5KGZzLnJlYWRkaXIpO1xuXG4vKipcbiAqIFNpZ25hbCBsb2cgZW50cnkgc3RydWN0dXJlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmFsTG9nRW50cnkge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgdHlwZTogJ3NpZ25hbCc7XG4gIHN5bWJvbDogc3RyaW5nO1xuICBzdHJhdGVneVR5cGU6ICdob2xvZ3JhcGhpYyc7XG4gIGNvbmZpZGVuY2U6IG51bWJlcjtcbiAgbGV2ZXJhZ2U6IG51bWJlcjtcbiAgZW50cnlQcmljZTogbnVtYmVyO1xuICBzdG9wUHJpY2U6IG51bWJlcjtcbiAgdGFyZ2V0UHJpY2U6IG51bWJlcjtcbiAgYWxpZ25tZW50U3RhdGU6IHtcbiAgICBzdGF0dXM6IHN0cmluZztcbiAgICBzY29yZTogbnVtYmVyO1xuICAgIGRhaWx5OiBzdHJpbmc7XG4gICAgaDQ6IHN0cmluZztcbiAgICBtMTU6IHN0cmluZztcbiAgfTtcbiAgcnNTY29yZTogbnVtYmVyO1xuICBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGU7XG4gIHBvaVR5cGU6ICdGVkcnIHwgJ09SREVSX0JMT0NLJyB8ICdMSVFVSURJVFlfUE9PTCc7XG4gIGN2ZFN0YXR1czogYm9vbGVhbjtcbiAgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnO1xuICBwb3NpdGlvblNpemU6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBFeGVjdXRpb24gbG9nIGVudHJ5IHN0cnVjdHVyZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4ZWN1dGlvbkxvZ0VudHJ5IHtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHR5cGU6ICdleGVjdXRpb24nO1xuICBzaWduYWxJZD86IHN0cmluZztcbiAgb3JkZXJJZDogc3RyaW5nO1xuICBzeW1ib2w6IHN0cmluZztcbiAgc2lkZTogJ0J1eScgfCAnU2VsbCc7XG4gIHF0eTogbnVtYmVyO1xuICBmaWxsUHJpY2U6IG51bWJlcjtcbiAgZmlsbFRpbWVzdGFtcDogbnVtYmVyO1xuICBvcmRlclR5cGU6ICdNQVJLRVQnIHwgJ0xJTUlUJyB8ICdQT1NUX09OTFknO1xuICBzbGlwcGFnZTogbnVtYmVyO1xuICBmZWVzPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIFBvc2l0aW9uIGNsb3NlIGxvZyBlbnRyeSBzdHJ1Y3R1cmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDbG9zZUxvZ0VudHJ5IHtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHR5cGU6ICdjbG9zZSc7XG4gIHBvc2l0aW9uSWQ6IHN0cmluZztcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIHNpZGU6ICdMT05HJyB8ICdTSE9SVCc7XG4gIGV4aXRQcmljZTogbnVtYmVyO1xuICBleGl0VGltZXN0YW1wOiBudW1iZXI7XG4gIHByb2ZpdFBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgY2xvc2VSZWFzb246ICdTVE9QX0xPU1MnIHwgJ1RBS0VfUFJPRklUJyB8ICdUUkFJTElOR19TVE9QJyB8ICdNQU5VQUwnIHwgJ0VNRVJHRU5DWSc7XG4gIGhvbGRUaW1lOiBudW1iZXI7IC8vIG1pbGxpc2Vjb25kc1xuICBlbnRyeVByaWNlOiBudW1iZXI7XG4gIHJWYWx1ZTogbnVtYmVyOyAvLyBSIG11bHRpcGxlXG59XG5cbi8qKlxuICogRXJyb3IgbG9nIGVudHJ5IHN0cnVjdHVyZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVycm9yTG9nRW50cnkge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgdHlwZTogJ2Vycm9yJztcbiAgbGV2ZWw6ICdXQVJOSU5HJyB8ICdFUlJPUicgfCAnQ1JJVElDQUwnO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNvbnRleHQ6IHtcbiAgICBzeW1ib2w/OiBzdHJpbmc7XG4gICAgcGhhc2U6ICdwaGFzZTInO1xuICAgIGNvbXBvbmVudD86IHN0cmluZztcbiAgICBmdW5jdGlvbj86IHN0cmluZztcbiAgICBzdGFjaz86IHN0cmluZztcbiAgICBkYXRhPzogYW55O1xuICB9O1xufVxuXG5leHBvcnQgdHlwZSBMb2dFbnRyeSA9IFNpZ25hbExvZ0VudHJ5IHwgRXhlY3V0aW9uTG9nRW50cnkgfCBDbG9zZUxvZ0VudHJ5IHwgRXJyb3JMb2dFbnRyeTtcblxuLyoqXG4gKiBMb2dnZXIgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIExvZ2dlckNvbmZpZyB7XG4gIGxvZ0Rpcjogc3RyaW5nO1xuICBsb2dGaWxlTmFtZTogc3RyaW5nO1xuICBtYXhGaWxlU2l6ZUJ5dGVzOiBudW1iZXI7IC8vIDEwTUIgZGVmYXVsdFxuICBjb21wcmVzc2lvbkFnZU1zOiBudW1iZXI7IC8vIDMwIGRheXMgZGVmYXVsdFxuICBlbmFibGVDb25zb2xlT3V0cHV0OiBib29sZWFuO1xufVxuXG4vKipcbiAqIEpTT05MIExvZ2dlciBmb3IgVGl0YW4gUGhhc2UgMlxuICogXG4gKiBMb2dzIGFsbCBzaWduYWxzLCBleGVjdXRpb25zLCBhbmQgZXJyb3JzIHRvIHRyYWRlcy5qc29ubCBmaWxlXG4gKiB3aXRoIGF1dG9tYXRpYyByb3RhdGlvbiBhbmQgY29tcHJlc3Npb24uXG4gKi9cbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xuICBwcml2YXRlIGNvbmZpZzogTG9nZ2VyQ29uZmlnO1xuICBwcml2YXRlIGxvZ0ZpbGVQYXRoOiBzdHJpbmc7XG4gIHByaXZhdGUgd3JpdGVTdHJlYW06IGZzLldyaXRlU3RyZWFtIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnPzogUGFydGlhbDxMb2dnZXJDb25maWc+KSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBsb2dEaXI6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnbG9ncycpLFxuICAgICAgbG9nRmlsZU5hbWU6ICd0cmFkZXMuanNvbmwnLFxuICAgICAgbWF4RmlsZVNpemVCeXRlczogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQlxuICAgICAgY29tcHJlc3Npb25BZ2VNczogMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwLCAvLyAzMCBkYXlzXG4gICAgICBlbmFibGVDb25zb2xlT3V0cHV0OiBmYWxzZSxcbiAgICAgIC4uLmNvbmZpZ1xuICAgIH07XG5cbiAgICB0aGlzLmxvZ0ZpbGVQYXRoID0gcGF0aC5qb2luKHRoaXMuY29uZmlnLmxvZ0RpciwgdGhpcy5jb25maWcubG9nRmlsZU5hbWUpO1xuICAgIHRoaXMuZW5zdXJlTG9nRGlyZWN0b3J5KCk7XG4gICAgdGhpcy5pbml0aWFsaXplV3JpdGVTdHJlYW0oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgbG9nIGRpcmVjdG9yeSBleGlzdHNcbiAgICovXG4gIHByaXZhdGUgZW5zdXJlTG9nRGlyZWN0b3J5KCk6IHZvaWQge1xuICAgIGlmICghZnMuZXhpc3RzU3luYyh0aGlzLmNvbmZpZy5sb2dEaXIpKSB7XG4gICAgICBmcy5ta2RpclN5bmModGhpcy5jb25maWcubG9nRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB3cml0ZSBzdHJlYW0gZm9yIGxvZyBmaWxlXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVXcml0ZVN0cmVhbSgpOiB2b2lkIHtcbiAgICB0aGlzLndyaXRlU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0odGhpcy5sb2dGaWxlUGF0aCwgeyBmbGFnczogJ2EnIH0pO1xuICAgIFxuICAgIHRoaXMud3JpdGVTdHJlYW0ub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCdMb2dnZXIgd3JpdGUgc3RyZWFtIGVycm9yOicsIGVycm9yKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgYSBzaWduYWwgd2l0aCBjb21wcmVoZW5zaXZlIGhvbG9ncmFtIHN0YXRlXG4gICAqIFxuICAgKiBSZXF1aXJlbWVudCAxNi4yOiBJbmNsdWRlIHRpbWVzdGFtcCwgc3ltYm9sLCBzdHJhdGVneSB0eXBlLCBjb25maWRlbmNlLCBcbiAgICogbGV2ZXJhZ2UsIGVudHJ5IHByaWNlLCBzdG9wIHByaWNlLCB0YXJnZXQgcHJpY2UsIGFsaWdubWVudCBzdGF0ZSwgXG4gICAqIFJTIHNjb3JlLCBzZXNzaW9uIHR5cGUsIFBPSSB0eXBlLCBhbmQgQ1ZEIHN0YXR1c1xuICAgKi9cbiAgcHVibGljIGxvZ1NpZ25hbChcbiAgICBzaWduYWw6IFNpZ25hbERhdGEsXG4gICAgaG9sb2dyYW1TdGF0ZTogSG9sb2dyYW1TdGF0ZSxcbiAgICBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGUsXG4gICAgcG9pVHlwZTogJ0ZWRycgfCAnT1JERVJfQkxPQ0snIHwgJ0xJUVVJRElUWV9QT09MJyxcbiAgICBjdmRDb25maXJtYXRpb246IGJvb2xlYW5cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbG9nRW50cnk6IFNpZ25hbExvZ0VudHJ5ID0ge1xuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdHlwZTogJ3NpZ25hbCcsXG4gICAgICBzeW1ib2w6IHNpZ25hbC5zeW1ib2wsXG4gICAgICBzdHJhdGVneVR5cGU6ICdob2xvZ3JhcGhpYycsXG4gICAgICBjb25maWRlbmNlOiBzaWduYWwuY29uZmlkZW5jZSxcbiAgICAgIGxldmVyYWdlOiBzaWduYWwubGV2ZXJhZ2UsXG4gICAgICBlbnRyeVByaWNlOiBzaWduYWwuZW50cnlQcmljZSxcbiAgICAgIHN0b3BQcmljZTogc2lnbmFsLnN0b3BMb3NzLFxuICAgICAgdGFyZ2V0UHJpY2U6IHNpZ25hbC50YWtlUHJvZml0LFxuICAgICAgYWxpZ25tZW50U3RhdGU6IHtcbiAgICAgICAgc3RhdHVzOiBob2xvZ3JhbVN0YXRlLnN0YXR1cyxcbiAgICAgICAgc2NvcmU6IGhvbG9ncmFtU3RhdGUuYWxpZ25tZW50U2NvcmUsXG4gICAgICAgIGRhaWx5OiBgJHtob2xvZ3JhbVN0YXRlLmRhaWx5LnRyZW5kfV8ke2hvbG9ncmFtU3RhdGUuZGFpbHkubG9jYXRpb259YCxcbiAgICAgICAgaDQ6IGAke2hvbG9ncmFtU3RhdGUuaDQudHJlbmR9XyR7aG9sb2dyYW1TdGF0ZS5oNC5sb2NhdGlvbn1gLFxuICAgICAgICBtMTU6IGAke2hvbG9ncmFtU3RhdGUubTE1LnRyZW5kfV8ke2hvbG9ncmFtU3RhdGUubTE1Lm1zcyA/ICdNU1MnIDogJ05PX01TUyd9YFxuICAgICAgfSxcbiAgICAgIHJzU2NvcmU6IGhvbG9ncmFtU3RhdGUucnNTY29yZSxcbiAgICAgIHNlc3Npb25UeXBlLFxuICAgICAgcG9pVHlwZSxcbiAgICAgIGN2ZFN0YXR1czogY3ZkQ29uZmlybWF0aW9uLFxuICAgICAgZGlyZWN0aW9uOiBzaWduYWwuZGlyZWN0aW9uLFxuICAgICAgcG9zaXRpb25TaXplOiBzaWduYWwucG9zaXRpb25TaXplXG4gICAgfTtcblxuICAgIHRoaXMud3JpdGVMb2dFbnRyeShsb2dFbnRyeSk7XG5cbiAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlQ29uc29sZU91dHB1dCkge1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogU0lHTkFMOiAke3NpZ25hbC5zeW1ib2x9ICR7c2lnbmFsLmRpcmVjdGlvbn0gQCAke3NpZ25hbC5lbnRyeVByaWNlfSAoJHtob2xvZ3JhbVN0YXRlLnN0YXR1c30sIFJTOiR7aG9sb2dyYW1TdGF0ZS5yc1Njb3JlLnRvRml4ZWQoMyl9KWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgb3JkZXIgZXhlY3V0aW9uIHdpdGggZmlsbCBkZXRhaWxzXG4gICAqIFxuICAgKiBSZXF1aXJlbWVudCAxNi4zOiBJbmNsdWRlIGZpbGwgcHJpY2UsIGZpbGwgdGltZXN0YW1wLCBvcmRlciB0eXBlLCBhbmQgc2xpcHBhZ2VcbiAgICovXG4gIHB1YmxpYyBsb2dFeGVjdXRpb24oXG4gICAgb3JkZXJSZXN1bHQ6IE9yZGVyUmVzdWx0LFxuICAgIHNsaXBwYWdlOiBudW1iZXIsXG4gICAgc2lnbmFsSWQ/OiBzdHJpbmcsXG4gICAgZmVlcz86IG51bWJlclxuICApOiB2b2lkIHtcbiAgICBjb25zdCBsb2dFbnRyeTogRXhlY3V0aW9uTG9nRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB0eXBlOiAnZXhlY3V0aW9uJyxcbiAgICAgIHNpZ25hbElkLFxuICAgICAgb3JkZXJJZDogb3JkZXJSZXN1bHQub3JkZXJJZCxcbiAgICAgIHN5bWJvbDogb3JkZXJSZXN1bHQuc3ltYm9sLFxuICAgICAgc2lkZTogb3JkZXJSZXN1bHQuc2lkZSxcbiAgICAgIHF0eTogb3JkZXJSZXN1bHQucXR5LFxuICAgICAgZmlsbFByaWNlOiBvcmRlclJlc3VsdC5wcmljZSxcbiAgICAgIGZpbGxUaW1lc3RhbXA6IG9yZGVyUmVzdWx0LnRpbWVzdGFtcCxcbiAgICAgIG9yZGVyVHlwZTogJ0xJTUlUJywgLy8gUGhhc2UgMiB1c2VzIFBvc3QtT25seSBMaW1pdCBPcmRlcnNcbiAgICAgIHNsaXBwYWdlLFxuICAgICAgZmVlc1xuICAgIH07XG5cbiAgICB0aGlzLndyaXRlTG9nRW50cnkobG9nRW50cnkpO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUNvbnNvbGVPdXRwdXQpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgRklMTDogJHtvcmRlclJlc3VsdC5zeW1ib2x9ICR7b3JkZXJSZXN1bHQuc2lkZX0gJHtvcmRlclJlc3VsdC5xdHl9IEAgJHtvcmRlclJlc3VsdC5wcmljZX0gKHNsaXBwYWdlOiAkeyhzbGlwcGFnZSAqIDEwMCkudG9GaXhlZCgzKX0lKWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgcG9zaXRpb24gY2xvc2Ugd2l0aCBQJkwgZGV0YWlsc1xuICAgKiBcbiAgICogUmVxdWlyZW1lbnQgMTYuNDogSW5jbHVkZSBleGl0IHByaWNlLCBleGl0IHRpbWVzdGFtcCwgcHJvZml0IHBlcmNlbnRhZ2UsIFxuICAgKiBjbG9zZSByZWFzb24sIGFuZCBob2xkIHRpbWVcbiAgICovXG4gIHB1YmxpYyBsb2dQb3NpdGlvbkNsb3NlKFxuICAgIHBvc2l0aW9uSWQ6IHN0cmluZyxcbiAgICBzeW1ib2w6IHN0cmluZyxcbiAgICBzaWRlOiAnTE9ORycgfCAnU0hPUlQnLFxuICAgIGVudHJ5UHJpY2U6IG51bWJlcixcbiAgICBleGl0UHJpY2U6IG51bWJlcixcbiAgICBwcm9maXRQZXJjZW50YWdlOiBudW1iZXIsXG4gICAgY2xvc2VSZWFzb246ICdTVE9QX0xPU1MnIHwgJ1RBS0VfUFJPRklUJyB8ICdUUkFJTElOR19TVE9QJyB8ICdNQU5VQUwnIHwgJ0VNRVJHRU5DWScsXG4gICAgaG9sZFRpbWU6IG51bWJlcixcbiAgICByVmFsdWU6IG51bWJlclxuICApOiB2b2lkIHtcbiAgICBjb25zdCBsb2dFbnRyeTogQ2xvc2VMb2dFbnRyeSA9IHtcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIHR5cGU6ICdjbG9zZScsXG4gICAgICBwb3NpdGlvbklkLFxuICAgICAgc3ltYm9sLFxuICAgICAgc2lkZSxcbiAgICAgIGV4aXRQcmljZSxcbiAgICAgIGV4aXRUaW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBwcm9maXRQZXJjZW50YWdlLFxuICAgICAgY2xvc2VSZWFzb24sXG4gICAgICBob2xkVGltZSxcbiAgICAgIGVudHJ5UHJpY2UsXG4gICAgICByVmFsdWVcbiAgICB9O1xuXG4gICAgdGhpcy53cml0ZUxvZ0VudHJ5KGxvZ0VudHJ5KTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVDb25zb2xlT3V0cHV0KSB7XG4gICAgICBjb25zdCBwbmxDb2xvciA9IHByb2ZpdFBlcmNlbnRhZ2UgPj0gMCA/ICdcXHgxYlszMm0nIDogJ1xceDFiWzMxbSc7XG4gICAgICBjb25zb2xlLmxvZyhgJHtwbmxDb2xvcn3wn5KwIENMT1NFOiAke3N5bWJvbH0gJHtzaWRlfSAke3Byb2ZpdFBlcmNlbnRhZ2UudG9GaXhlZCgyKX0lICgke3JWYWx1ZS50b0ZpeGVkKDIpfVIpIC0gJHtjbG9zZVJlYXNvbn1cXHgxYlswbWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgZXJyb3Igd2l0aCBjb250ZXh0XG4gICAqL1xuICBwdWJsaWMgbG9nRXJyb3IoXG4gICAgbGV2ZWw6ICdXQVJOSU5HJyB8ICdFUlJPUicgfCAnQ1JJVElDQUwnLFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBjb250ZXh0OiB7XG4gICAgICBzeW1ib2w/OiBzdHJpbmc7XG4gICAgICBjb21wb25lbnQ/OiBzdHJpbmc7XG4gICAgICBmdW5jdGlvbj86IHN0cmluZztcbiAgICAgIHN0YWNrPzogc3RyaW5nO1xuICAgICAgZGF0YT86IGFueTtcbiAgICB9ID0ge31cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbG9nRW50cnk6IEVycm9yTG9nRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgbGV2ZWwsXG4gICAgICBtZXNzYWdlLFxuICAgICAgY29udGV4dDoge1xuICAgICAgICAuLi5jb250ZXh0LFxuICAgICAgICBwaGFzZTogJ3BoYXNlMidcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy53cml0ZUxvZ0VudHJ5KGxvZ0VudHJ5KTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVDb25zb2xlT3V0cHV0KSB7XG4gICAgICBjb25zdCBsZXZlbENvbG9yID0gbGV2ZWwgPT09ICdDUklUSUNBTCcgPyAnXFx4MWJbMzFtJyA6IGxldmVsID09PSAnRVJST1InID8gJ1xceDFiWzMzbScgOiAnXFx4MWJbMzZtJztcbiAgICAgIGNvbnNvbGUubG9nKGAke2xldmVsQ29sb3J94p2MICR7bGV2ZWx9OiAke21lc3NhZ2V9XFx4MWJbMG1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgbG9nIGVudHJ5IHRvIEpTT05MIGZpbGVcbiAgICogXG4gICAqIFJlcXVpcmVtZW50IDE2LjE6IEFwcGVuZCBzaWduYWwgZGF0YSB0byB0cmFkZXMuanNvbmwgZmlsZSBhcyBzaW5nbGUgSlNPTiBvYmplY3QgcGVyIGxpbmVcbiAgICovXG4gIHByaXZhdGUgd3JpdGVMb2dFbnRyeShlbnRyeTogTG9nRW50cnkpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QganNvbkxpbmUgPSBKU09OLnN0cmluZ2lmeShlbnRyeSkgKyAnXFxuJztcbiAgICAgIFxuICAgICAgaWYgKHRoaXMud3JpdGVTdHJlYW0pIHtcbiAgICAgICAgdGhpcy53cml0ZVN0cmVhbS53cml0ZShqc29uTGluZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGYWxsYmFjayB0byBzeW5jaHJvbm91cyB3cml0ZSBpZiBzdHJlYW0gaXMgbm90IGF2YWlsYWJsZVxuICAgICAgICBmcy5hcHBlbmRGaWxlU3luYyh0aGlzLmxvZ0ZpbGVQYXRoLCBqc29uTGluZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGxvZyByb3RhdGlvbiBpcyBuZWVkZWRcbiAgICAgIHRoaXMuY2hlY2tMb2dSb3RhdGlvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gd3JpdGUgbG9nIGVudHJ5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgbG9nIGZpbGUgbmVlZHMgcm90YXRpb25cbiAgICogXG4gICAqIFJlcXVpcmVtZW50IDE2LjU6IFJvdGF0ZSBsb2cgZmlsZSB3aGVuIHNpemUgZXhjZWVkcyAxME1CXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrTG9nUm90YXRpb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc3RhdCh0aGlzLmxvZ0ZpbGVQYXRoKTtcbiAgICAgIFxuICAgICAgaWYgKHN0YXRzLnNpemUgPj0gdGhpcy5jb25maWcubWF4RmlsZVNpemVCeXRlcykge1xuICAgICAgICBhd2FpdCB0aGlzLnJvdGF0ZUxvZ0ZpbGUoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRmlsZSBtaWdodCBub3QgZXhpc3QgeWV0LCBpZ25vcmVcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUm90YXRlIGxvZyBmaWxlIHdpdGggdGltZXN0YW1wIHN1ZmZpeFxuICAgKiBcbiAgICogUmVxdWlyZW1lbnQgMTYuNTogUm90YXRlIGxvZyBmaWxlIHdpdGggdGltZXN0YW1wIHN1ZmZpeFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByb3RhdGVMb2dGaWxlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDbG9zZSBjdXJyZW50IHdyaXRlIHN0cmVhbVxuICAgICAgaWYgKHRoaXMud3JpdGVTdHJlYW0pIHtcbiAgICAgICAgdGhpcy53cml0ZVN0cmVhbS5lbmQoKTtcbiAgICAgICAgdGhpcy53cml0ZVN0cmVhbSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSByb3RhdGVkIGZpbGVuYW1lIHdpdGggdGltZXN0YW1wXG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvWzouXS9nLCAnLScpO1xuICAgICAgY29uc3Qgcm90YXRlZEZpbGVOYW1lID0gdGhpcy5jb25maWcubG9nRmlsZU5hbWUucmVwbGFjZSgnLmpzb25sJywgYC0ke3RpbWVzdGFtcH0uanNvbmxgKTtcbiAgICAgIGNvbnN0IHJvdGF0ZWRGaWxlUGF0aCA9IHBhdGguam9pbih0aGlzLmNvbmZpZy5sb2dEaXIsIHJvdGF0ZWRGaWxlTmFtZSk7XG5cbiAgICAgIC8vIFJlbmFtZSBjdXJyZW50IGxvZyBmaWxlXG4gICAgICBmcy5yZW5hbWVTeW5jKHRoaXMubG9nRmlsZVBhdGgsIHJvdGF0ZWRGaWxlUGF0aCk7XG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgd3JpdGUgc3RyZWFtXG4gICAgICB0aGlzLmluaXRpYWxpemVXcml0ZVN0cmVhbSgpO1xuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TgSBMb2cgcm90YXRlZDogJHtyb3RhdGVkRmlsZU5hbWV9YCk7XG5cbiAgICAgIC8vIFNjaGVkdWxlIGNvbXByZXNzaW9uIGNoZWNrXG4gICAgICB0aGlzLnNjaGVkdWxlQ29tcHJlc3Npb25DaGVjaygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcm90YXRlIGxvZyBmaWxlOicsIGVycm9yKTtcbiAgICAgIC8vIFJlaW5pdGlhbGl6ZSB3cml0ZSBzdHJlYW0gb24gZXJyb3JcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZVdyaXRlU3RyZWFtKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjaGVkdWxlIGNvbXByZXNzaW9uIGNoZWNrIGZvciBvbGQgbG9nIGZpbGVzXG4gICAqIFxuICAgKiBSZXF1aXJlbWVudCAxNi42OiBDb21wcmVzcyBsb2cgZmlsZXMgb2xkZXIgdGhhbiAzMCBkYXlzXG4gICAqL1xuICBwcml2YXRlIHNjaGVkdWxlQ29tcHJlc3Npb25DaGVjaygpOiB2b2lkIHtcbiAgICAvLyBSdW4gY29tcHJlc3Npb24gY2hlY2sgYXN5bmNocm9ub3VzbHlcbiAgICBzZXRJbW1lZGlhdGUoKCkgPT4ge1xuICAgICAgdGhpcy5jb21wcmVzc09sZExvZ3MoKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb21wcmVzcyBvbGQgbG9nczonLCBlcnJvcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBsb2cgZmlsZXMgb2xkZXIgdGhhbiBjb25maWd1cmVkIGFnZVxuICAgKiBcbiAgICogUmVxdWlyZW1lbnQgMTYuNjogQ29tcHJlc3MgbG9nIGZpbGUgdG8gZ3ppcCBmb3JtYXQgd2hlbiBhZ2UgZXhjZWVkcyAzMCBkYXlzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbXByZXNzT2xkTG9ncygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCByZWFkZGlyKHRoaXMuY29uZmlnLmxvZ0Rpcik7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgLy8gU2tpcCBjdXJyZW50IGxvZyBmaWxlIGFuZCBhbHJlYWR5IGNvbXByZXNzZWQgZmlsZXNcbiAgICAgICAgaWYgKGZpbGUgPT09IHRoaXMuY29uZmlnLmxvZ0ZpbGVOYW1lIHx8IGZpbGUuZW5kc1dpdGgoJy5neicpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPbmx5IHByb2Nlc3MgLmpzb25sIGZpbGVzXG4gICAgICAgIGlmICghZmlsZS5lbmRzV2l0aCgnLmpzb25sJykpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHRoaXMuY29uZmlnLmxvZ0RpciwgZmlsZSk7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc3RhdChmaWxlUGF0aCk7XG4gICAgICAgIGNvbnN0IGZpbGVBZ2UgPSBub3cgLSBzdGF0cy5tdGltZS5nZXRUaW1lKCk7XG5cbiAgICAgICAgLy8gQ29tcHJlc3MgaWYgb2xkZXIgdGhhbiBjb25maWd1cmVkIGFnZVxuICAgICAgICBpZiAoZmlsZUFnZSA+IHRoaXMuY29uZmlnLmNvbXByZXNzaW9uQWdlTXMpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNvbXByZXNzTG9nRmlsZShmaWxlUGF0aCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNoZWNrIG9sZCBsb2dzIGZvciBjb21wcmVzc2lvbjonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbXByZXNzIGEgc2luZ2xlIGxvZyBmaWxlIHRvIGd6aXAgZm9ybWF0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbXByZXNzTG9nRmlsZShmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoKTtcbiAgICAgIGNvbnN0IGNvbXByZXNzZWQgPSBhd2FpdCBnemlwKGZpbGVDb250ZW50KTtcbiAgICAgIGNvbnN0IGNvbXByZXNzZWRQYXRoID0gZmlsZVBhdGggKyAnLmd6JztcblxuICAgICAgYXdhaXQgd3JpdGVGaWxlKGNvbXByZXNzZWRQYXRoLCBjb21wcmVzc2VkKTtcbiAgICAgIGZzLnVubGlua1N5bmMoZmlsZVBhdGgpOyAvLyBSZW1vdmUgb3JpZ2luYWwgZmlsZVxuXG4gICAgICBjb25zb2xlLmxvZyhg8J+XnO+4jyBDb21wcmVzc2VkOiAke3BhdGguYmFzZW5hbWUoZmlsZVBhdGgpfSDihpIgJHtwYXRoLmJhc2VuYW1lKGNvbXByZXNzZWRQYXRoKX1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNvbXByZXNzICR7ZmlsZVBhdGh9OmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGxvZyBmaWxlIHN0YXRpc3RpY3NcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRMb2dTdGF0cygpOiBQcm9taXNlPHtcbiAgICBjdXJyZW50U2l6ZTogbnVtYmVyO1xuICAgIHRvdGFsRmlsZXM6IG51bWJlcjtcbiAgICBjb21wcmVzc2VkRmlsZXM6IG51bWJlcjtcbiAgICBvbGRlc3RGaWxlOiBzdHJpbmcgfCBudWxsO1xuICAgIG5ld2VzdEZpbGU6IHN0cmluZyB8IG51bGw7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCByZWFkZGlyKHRoaXMuY29uZmlnLmxvZ0Rpcik7XG4gICAgICBjb25zdCBsb2dGaWxlcyA9IGZpbGVzLmZpbHRlcihmID0+IGYuZW5kc1dpdGgoJy5qc29ubCcpIHx8IGYuZW5kc1dpdGgoJy5qc29ubC5neicpKTtcbiAgICAgIFxuICAgICAgbGV0IGN1cnJlbnRTaXplID0gMDtcbiAgICAgIGxldCBvbGRlc3RGaWxlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgIGxldCBuZXdlc3RGaWxlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgIGxldCBvbGRlc3RUaW1lID0gSW5maW5pdHk7XG4gICAgICBsZXQgbmV3ZXN0VGltZSA9IDA7XG5cbiAgICAgIC8vIEdldCBjdXJyZW50IGxvZyBmaWxlIHNpemVcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRTdGF0cyA9IGF3YWl0IHN0YXQodGhpcy5sb2dGaWxlUGF0aCk7XG4gICAgICAgIGN1cnJlbnRTaXplID0gY3VycmVudFN0YXRzLnNpemU7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gRmlsZSBtaWdodCBub3QgZXhpc3QgeWV0XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgb2xkZXN0IGFuZCBuZXdlc3QgZmlsZXNcbiAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBsb2dGaWxlcykge1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbih0aGlzLmNvbmZpZy5sb2dEaXIsIGZpbGUpO1xuICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHN0YXQoZmlsZVBhdGgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHN0YXRzLm10aW1lLmdldFRpbWUoKSA8IG9sZGVzdFRpbWUpIHtcbiAgICAgICAgICBvbGRlc3RUaW1lID0gc3RhdHMubXRpbWUuZ2V0VGltZSgpO1xuICAgICAgICAgIG9sZGVzdEZpbGUgPSBmaWxlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoc3RhdHMubXRpbWUuZ2V0VGltZSgpID4gbmV3ZXN0VGltZSkge1xuICAgICAgICAgIG5ld2VzdFRpbWUgPSBzdGF0cy5tdGltZS5nZXRUaW1lKCk7XG4gICAgICAgICAgbmV3ZXN0RmlsZSA9IGZpbGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY3VycmVudFNpemUsXG4gICAgICAgIHRvdGFsRmlsZXM6IGxvZ0ZpbGVzLmxlbmd0aCxcbiAgICAgICAgY29tcHJlc3NlZEZpbGVzOiBmaWxlcy5maWx0ZXIoZiA9PiBmLmVuZHNXaXRoKCcuZ3onKSkubGVuZ3RoLFxuICAgICAgICBvbGRlc3RGaWxlLFxuICAgICAgICBuZXdlc3RGaWxlXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGxvZyBzdGF0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJyZW50U2l6ZTogMCxcbiAgICAgICAgdG90YWxGaWxlczogMCxcbiAgICAgICAgY29tcHJlc3NlZEZpbGVzOiAwLFxuICAgICAgICBvbGRlc3RGaWxlOiBudWxsLFxuICAgICAgICBuZXdlc3RGaWxlOiBudWxsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGbHVzaCBhbmQgY2xvc2UgbG9nZ2VyXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgY2xvc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMud3JpdGVTdHJlYW0pIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICB0aGlzLndyaXRlU3RyZWFtIS5lbmQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMud3JpdGVTdHJlYW0gPSBudWxsO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGxvZ2dlciBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZzogUGFydGlhbDxMb2dnZXJDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBMb2dnZXI6IENvbmZpZ3VyYXRpb24gdXBkYXRlZCcpO1xuICB9XG59XG5cbi8qKlxuICogRGVmYXVsdCBsb2dnZXIgaW5zdGFuY2UgZm9yIFBoYXNlIDJcbiAqL1xuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoe1xuICBlbmFibGVDb25zb2xlT3V0cHV0OiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nXG59KTtcblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbnMgZm9yIGNvbW1vbiBsb2dnaW5nIG9wZXJhdGlvbnNcbiAqL1xuZXhwb3J0IGNvbnN0IGxvZ1NpZ25hbCA9IChcbiAgc2lnbmFsOiBTaWduYWxEYXRhLFxuICBob2xvZ3JhbVN0YXRlOiBIb2xvZ3JhbVN0YXRlLFxuICBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGUsXG4gIHBvaVR5cGU6ICdGVkcnIHwgJ09SREVSX0JMT0NLJyB8ICdMSVFVSURJVFlfUE9PTCcsXG4gIGN2ZENvbmZpcm1hdGlvbjogYm9vbGVhblxuKSA9PiBsb2dnZXIubG9nU2lnbmFsKHNpZ25hbCwgaG9sb2dyYW1TdGF0ZSwgc2Vzc2lvblR5cGUsIHBvaVR5cGUsIGN2ZENvbmZpcm1hdGlvbik7XG5cbmV4cG9ydCBjb25zdCBsb2dFeGVjdXRpb24gPSAoXG4gIG9yZGVyUmVzdWx0OiBPcmRlclJlc3VsdCxcbiAgc2xpcHBhZ2U6IG51bWJlcixcbiAgc2lnbmFsSWQ/OiBzdHJpbmcsXG4gIGZlZXM/OiBudW1iZXJcbikgPT4gbG9nZ2VyLmxvZ0V4ZWN1dGlvbihvcmRlclJlc3VsdCwgc2xpcHBhZ2UsIHNpZ25hbElkLCBmZWVzKTtcblxuZXhwb3J0IGNvbnN0IGxvZ1Bvc2l0aW9uQ2xvc2UgPSAoXG4gIHBvc2l0aW9uSWQ6IHN0cmluZyxcbiAgc3ltYm9sOiBzdHJpbmcsXG4gIHNpZGU6ICdMT05HJyB8ICdTSE9SVCcsXG4gIGVudHJ5UHJpY2U6IG51bWJlcixcbiAgZXhpdFByaWNlOiBudW1iZXIsXG4gIHByb2ZpdFBlcmNlbnRhZ2U6IG51bWJlcixcbiAgY2xvc2VSZWFzb246ICdTVE9QX0xPU1MnIHwgJ1RBS0VfUFJPRklUJyB8ICdUUkFJTElOR19TVE9QJyB8ICdNQU5VQUwnIHwgJ0VNRVJHRU5DWScsXG4gIGhvbGRUaW1lOiBudW1iZXIsXG4gIHJWYWx1ZTogbnVtYmVyXG4pID0+IGxvZ2dlci5sb2dQb3NpdGlvbkNsb3NlKHBvc2l0aW9uSWQsIHN5bWJvbCwgc2lkZSwgZW50cnlQcmljZSwgZXhpdFByaWNlLCBwcm9maXRQZXJjZW50YWdlLCBjbG9zZVJlYXNvbiwgaG9sZFRpbWUsIHJWYWx1ZSk7XG5cbmV4cG9ydCBjb25zdCBsb2dFcnJvciA9IChcbiAgbGV2ZWw6ICdXQVJOSU5HJyB8ICdFUlJPUicgfCAnQ1JJVElDQUwnLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIGNvbnRleHQ/OiB7XG4gICAgc3ltYm9sPzogc3RyaW5nO1xuICAgIGNvbXBvbmVudD86IHN0cmluZztcbiAgICBmdW5jdGlvbj86IHN0cmluZztcbiAgICBzdGFjaz86IHN0cmluZztcbiAgICBkYXRhPzogYW55O1xuICB9XG4pID0+IGxvZ2dlci5sb2dFcnJvcihsZXZlbCwgbWVzc2FnZSwgY29udGV4dCk7Il0sInZlcnNpb24iOjN9