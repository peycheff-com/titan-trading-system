67e2e4884b0d32bd3015ad7db6e4fe8e
"use strict";
/**
 * Signal Generator for Titan Phase 2 - The Hunter
 *
 * Generates trading signals by combining all validation layers:
 * - Hologram alignment (A+ or B status)
 * - Session timing (Killzone requirement)
 * - Relative Strength filtering
 * - POI proximity validation
 * - CVD absorption confirmation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SignalGenerator = void 0;
const Logger_1 = require("../logging/Logger");
class SignalGenerator {
    config;
    hologramEngine;
    sessionProfiler;
    inefficiencyMapper;
    cvdValidator;
    constructor(hologramEngine, sessionProfiler, inefficiencyMapper, cvdValidator, config = {}) {
        this.hologramEngine = hologramEngine;
        this.sessionProfiler = sessionProfiler;
        this.inefficiencyMapper = inefficiencyMapper;
        this.cvdValidator = cvdValidator;
        // Set default configuration
        this.config = {
            minAlignmentScore: 60,
            rsThreshold: 0.01,
            poiProximityPercent: 0.5,
            minCVDConfidence: 70,
            requireCVDConfirmation: true,
            ...config
        };
    }
    /**
     * Check if hologram status meets requirements for signal generation
     * Requirements: A+ or B alignment status
     */
    checkHologramStatus(hologram) {
        // Check if status is A+ or B
        if (hologram.status !== 'A+' && hologram.status !== 'B') {
            return false;
        }
        // Additional check: alignment score must meet minimum threshold
        if (hologram.status === 'B' && hologram.alignmentScore < this.config.minAlignmentScore) {
            return false;
        }
        // Check that veto logic hasn't blocked the signal
        if (hologram.veto.vetoed) {
            return false;
        }
        return true;
    }
    /**
     * Check if current session meets Killzone requirements
     * Requirements: Must be London (07:00-10:00 UTC) or NY (13:00-16:00 UTC) session
     */
    checkSession(session) {
        return this.sessionProfiler.isKillzone();
    }
    /**
     * Check if RS score meets directional filter requirements
     * Requirements: Long signals need RS > threshold, Short signals need RS < -threshold
     */
    checkRSScore(rsScore, direction) {
        if (direction === 'LONG') {
            return rsScore > this.config.rsThreshold;
        }
        else {
            return rsScore < -this.config.rsThreshold;
        }
    }
    /**
     * Check if current price is within proximity of relevant POIs
     * Requirements: Price must be within 0.5% of Order Block or FVG
     */
    checkPOIProximity(currentPrice, pois, direction) {
        const proximityThreshold = this.config.poiProximityPercent / 100;
        for (const poi of pois) {
            // Skip mitigated POIs
            if ('mitigated' in poi && poi.mitigated)
                continue;
            if ('swept' in poi && poi.swept)
                continue;
            let targetPrice;
            let poiValid = false;
            // Check POI type and direction compatibility
            if ('midpoint' in poi) {
                // FVG
                const fvg = poi;
                if (direction === 'LONG' && fvg.type === 'BULLISH') {
                    targetPrice = fvg.midpoint;
                    poiValid = true;
                }
                else if (direction === 'SHORT' && fvg.type === 'BEARISH') {
                    targetPrice = fvg.midpoint;
                    poiValid = true;
                }
            }
            else if ('high' in poi && 'low' in poi && !('strength' in poi)) {
                // Order Block
                const ob = poi;
                if (direction === 'LONG' && ob.type === 'BULLISH') {
                    targetPrice = ob.low; // Enter at bottom of bullish OB
                    poiValid = true;
                }
                else if (direction === 'SHORT' && ob.type === 'BEARISH') {
                    targetPrice = ob.high; // Enter at top of bearish OB
                    poiValid = true;
                }
            }
            else if ('strength' in poi) {
                // Liquidity Pool - less precise, use for confluence only
                const pool = poi;
                if (direction === 'LONG' && pool.type === 'LOW') {
                    targetPrice = pool.price;
                    poiValid = true;
                }
                else if (direction === 'SHORT' && pool.type === 'HIGH') {
                    targetPrice = pool.price;
                    poiValid = true;
                }
            }
            if (poiValid) {
                const distance = Math.abs(currentPrice - targetPrice) / currentPrice;
                if (distance <= proximityThreshold) {
                    return { valid: true, poi };
                }
            }
        }
        return { valid: false, poi: null };
    }
    /**
     * Check if CVD absorption provides required confirmation
     * Requirements: Must have absorption signal with sufficient confidence
     */
    checkCVDAbsorption(absorption, direction) {
        if (!this.config.requireCVDConfirmation) {
            return true; // CVD confirmation not required
        }
        if (!absorption) {
            return false; // No absorption detected
        }
        // Check confidence level
        if (absorption.confidence < this.config.minCVDConfidence) {
            return false;
        }
        // For LONG signals, we need absorption (buying pressure at lows)
        // For SHORT signals, we need distribution (selling pressure at highs)
        // Note: The current absorption interface only handles absorption
        // Distribution would need to be handled separately or the interface extended
        if (direction === 'LONG') {
            return true; // Absorption supports long entry
        }
        else {
            // For short signals, we would need distribution detection
            // For now, we'll accept absorption as general flow confirmation
            return true;
        }
    }
    /**
     * Validate all signal conditions
     */
    validateSignal(context, direction) {
        const hologramValid = this.checkHologramStatus(context.hologram);
        const sessionValid = this.checkSession(context.session);
        const rsValid = this.checkRSScore(context.hologram.rsScore, direction);
        const poiResult = this.checkPOIProximity(context.currentPrice, context.nearbyPOIs, direction);
        const cvdValid = this.checkCVDAbsorption(context.absorption, direction);
        const valid = hologramValid && sessionValid && rsValid && poiResult.valid && cvdValid;
        let reason = '';
        if (!hologramValid)
            reason += 'Hologram status invalid. ';
        if (!sessionValid)
            reason += 'Not in Killzone. ';
        if (!rsValid)
            reason += 'RS score insufficient. ';
        if (!poiResult.valid)
            reason += 'No POI proximity. ';
        if (!cvdValid)
            reason += 'CVD confirmation missing. ';
        if (valid) {
            reason = 'All conditions met';
        }
        return {
            valid,
            reason: reason.trim(),
            hologramValid,
            sessionValid,
            rsValid,
            poiValid: poiResult.valid,
            cvdValid
        };
    }
    /**
     * Calculate position size using Volatility-Adjusted Sizing
     * Formula: Risk_Dollars / (ATR * Stop_Distance_Multiplier)
     */
    calculatePositionSize(equity, riskPerTrade, atr, stopDistancePercent, currentPrice, leverage) {
        const riskDollars = equity * riskPerTrade;
        const stopDistance = currentPrice * (stopDistancePercent / 100);
        const positionSize = riskDollars / stopDistance;
        // Apply leverage constraint
        const maxPositionValue = equity * leverage;
        const maxPositionSize = maxPositionValue / currentPrice;
        return Math.min(positionSize, maxPositionSize);
    }
    /**
     * Generate trading signal with all validations
     */
    async generateSignal(symbol, direction, equity, riskPerTrade = 0.02, leverage = 3) {
        try {
            // Get hologram state
            const hologram = await this.hologramEngine.analyze(symbol);
            // Get session state
            const session = this.sessionProfiler.getSessionState();
            // Get current price from hologram
            const currentPrice = hologram.m15.currentPrice;
            // Get nearby POIs
            const nearbyPOIs = await this.getNearbyPOIs(symbol, currentPrice);
            // Get CVD absorption
            const absorption = await this.getCVDAbsorption(symbol);
            // Get ATR for position sizing (using 15m timeframe)
            const atr = await this.calculateATR(symbol, '15m');
            // Create signal context
            const context = {
                hologram,
                session,
                currentPrice,
                nearbyPOIs,
                absorption,
                atr
            };
            // Validate signal
            const validation = this.validateSignal(context, direction);
            if (!validation.valid) {
                console.log(`‚ùå Signal validation failed for ${symbol} ${direction}: ${validation.reason}`);
                return null;
            }
            // Calculate entry, stop, and target prices
            const { entryPrice, stopLoss, takeProfit } = this.calculatePrices(currentPrice, direction, context.nearbyPOIs, atr);
            // Calculate position size
            const stopDistancePercent = Math.abs(entryPrice - stopLoss) / entryPrice * 100;
            const positionSize = this.calculatePositionSize(equity, riskPerTrade, atr, stopDistancePercent, entryPrice, leverage);
            // Calculate confidence score
            const confidence = this.calculateConfidence(hologram, validation, absorption);
            // Create signal data
            const signal = {
                symbol,
                direction,
                hologramStatus: hologram.status,
                alignmentScore: hologram.alignmentScore,
                rsScore: hologram.rsScore,
                sessionType: session.type,
                poiType: this.getPOIType(context.nearbyPOIs[0]),
                cvdConfirmation: validation.cvdValid,
                confidence,
                entryPrice,
                stopLoss,
                takeProfit,
                positionSize,
                leverage,
                timestamp: Date.now()
            };
            console.log(`‚úÖ Signal generated for ${symbol} ${direction}: ${hologram.status} alignment, ${confidence}% confidence`);
            // Log signal to structured logger
            (0, Logger_1.logSignal)(signal, hologram, session.type, this.getPOIType(context.nearbyPOIs[0]), validation.cvdValid);
            return signal;
        }
        catch (error) {
            console.error(`‚ùå Error generating signal for ${symbol}:`, error);
            (0, Logger_1.logError)('ERROR', `Error generating signal for ${symbol}`, {
                symbol,
                component: 'SignalGenerator',
                function: 'generateSignal',
                stack: error.stack,
                data: { direction }
            });
            return null;
        }
    }
    /**
     * Get nearby POIs for the symbol
     */
    async getNearbyPOIs(symbol, currentPrice) {
        // This would typically fetch from a POI cache or calculate on demand
        // For now, we'll return an empty array as a placeholder
        // In a real implementation, this would integrate with InefficiencyMapper
        return [];
    }
    /**
     * Get CVD absorption data for the symbol
     */
    async getCVDAbsorption(symbol) {
        // This would typically fetch recent CVD data and check for absorption
        // For now, we'll return null as a placeholder
        // In a real implementation, this would integrate with CVDValidator
        return null;
    }
    /**
     * Calculate ATR for position sizing
     */
    async calculateATR(symbol, timeframe, period = 14) {
        // This would typically fetch OHLCV data and calculate ATR
        // For now, we'll return a placeholder value
        // In a real implementation, this would fetch data and calculate true ATR
        return 0.02; // 2% placeholder ATR
    }
    /**
     * Calculate entry, stop loss, and take profit prices
     */
    calculatePrices(currentPrice, direction, pois, atr) {
        // Default to current price if no POI
        let entryPrice = currentPrice;
        // Use POI price if available
        if (pois.length > 0) {
            const poi = pois[0];
            if ('midpoint' in poi) {
                entryPrice = poi.midpoint;
            }
            else if ('high' in poi && 'low' in poi && !('strength' in poi)) {
                const ob = poi;
                entryPrice = direction === 'LONG' ? ob.low : ob.high;
            }
            else if ('price' in poi) {
                entryPrice = poi.price;
            }
        }
        // Calculate stop loss and take profit (3:1 R:R)
        const stopDistance = entryPrice * 0.015; // 1.5% stop
        const targetDistance = stopDistance * 3; // 3:1 R:R
        let stopLoss;
        let takeProfit;
        if (direction === 'LONG') {
            stopLoss = entryPrice - stopDistance;
            takeProfit = entryPrice + targetDistance;
        }
        else {
            stopLoss = entryPrice + stopDistance;
            takeProfit = entryPrice - targetDistance;
        }
        return { entryPrice, stopLoss, takeProfit };
    }
    /**
     * Calculate overall signal confidence
     */
    calculateConfidence(hologram, validation, absorption) {
        let confidence = hologram.alignmentScore; // Base confidence from alignment
        // Bonus for A+ status
        if (hologram.status === 'A+') {
            confidence += 10;
        }
        // Bonus for strong RS
        if (Math.abs(hologram.rsScore) > 0.05) {
            confidence += 5;
        }
        // Bonus for CVD confirmation
        if (absorption && absorption.confidence > 80) {
            confidence += 10;
        }
        return Math.min(100, confidence);
    }
    /**
     * Get POI type for logging
     */
    getPOIType(poi) {
        if (!poi)
            return 'ORDER_BLOCK'; // Default
        if ('midpoint' in poi)
            return 'FVG';
        if ('high' in poi && 'low' in poi && !('strength' in poi))
            return 'ORDER_BLOCK';
        return 'LIQUIDITY_POOL';
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('üìù SignalGenerator configuration updated');
    }
    /**
     * Get current configuration
     */
    getConfig() {
        return { ...this.config };
    }
}
exports.SignalGenerator = SignalGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLXBoYXNlMi1odW50ZXIvc3JjL2V4ZWN1dGlvbi9TaWduYWxHZW5lcmF0b3IudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7R0FTRzs7O0FBbUJILDhDQUF3RDtBQTZCeEQsTUFBYSxlQUFlO0lBQ2xCLE1BQU0sQ0FBd0I7SUFDOUIsY0FBYyxDQUFpQjtJQUMvQixlQUFlLENBQWtCO0lBQ2pDLGtCQUFrQixDQUFxQjtJQUN2QyxZQUFZLENBQWU7SUFFbkMsWUFDRSxjQUE4QixFQUM5QixlQUFnQyxFQUNoQyxrQkFBc0MsRUFDdEMsWUFBMEIsRUFDMUIsU0FBeUMsRUFBRTtRQUUzQyxJQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztRQUNyQyxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztRQUN2QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7UUFDN0MsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFFakMsNEJBQTRCO1FBQzVCLElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLG1CQUFtQixFQUFFLEdBQUc7WUFDeEIsZ0JBQWdCLEVBQUUsRUFBRTtZQUNwQixzQkFBc0IsRUFBRSxJQUFJO1lBQzVCLEdBQUcsTUFBTTtTQUNWLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsbUJBQW1CLENBQUMsUUFBdUI7UUFDekMsNkJBQTZCO1FBQzdCLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUN4RCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxnRUFBZ0U7UUFDaEUsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFN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QUFDLDBDQUEwQyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUE3Y0QsMENBNmNDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1waGFzZTItaHVudGVyL3NyYy9leGVjdXRpb24vU2lnbmFsR2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2lnbmFsIEdlbmVyYXRvciBmb3IgVGl0YW4gUGhhc2UgMiAtIFRoZSBIdW50ZXJcbiAqIFxuICogR2VuZXJhdGVzIHRyYWRpbmcgc2lnbmFscyBieSBjb21iaW5pbmcgYWxsIHZhbGlkYXRpb24gbGF5ZXJzOlxuICogLSBIb2xvZ3JhbSBhbGlnbm1lbnQgKEErIG9yIEIgc3RhdHVzKVxuICogLSBTZXNzaW9uIHRpbWluZyAoS2lsbHpvbmUgcmVxdWlyZW1lbnQpXG4gKiAtIFJlbGF0aXZlIFN0cmVuZ3RoIGZpbHRlcmluZ1xuICogLSBQT0kgcHJveGltaXR5IHZhbGlkYXRpb25cbiAqIC0gQ1ZEIGFic29ycHRpb24gY29uZmlybWF0aW9uXG4gKi9cblxuaW1wb3J0IHsgXG4gIEhvbG9ncmFtU3RhdGUsIFxuICBIb2xvZ3JhbVN0YXR1cywgXG4gIFNlc3Npb25TdGF0ZSwgXG4gIFNlc3Npb25UeXBlLCBcbiAgUE9JLCBcbiAgRlZHLCBcbiAgT3JkZXJCbG9jaywgXG4gIExpcXVpZGl0eVBvb2wsXG4gIEFic29ycHRpb24sXG4gIFNpZ25hbERhdGEsXG4gIFRyZW5kU3RhdGVcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgSG9sb2dyYW1FbmdpbmUgfSBmcm9tICcuLi9lbmdpbmUvSG9sb2dyYW1FbmdpbmUnO1xuaW1wb3J0IHsgU2Vzc2lvblByb2ZpbGVyIH0gZnJvbSAnLi4vZW5naW5lL1Nlc3Npb25Qcm9maWxlcic7XG5pbXBvcnQgeyBJbmVmZmljaWVuY3lNYXBwZXIgfSBmcm9tICcuLi9lbmdpbmUvSW5lZmZpY2llbmN5TWFwcGVyJztcbmltcG9ydCB7IENWRFZhbGlkYXRvciB9IGZyb20gJy4uL2VuZ2luZS9DVkRWYWxpZGF0b3InO1xuaW1wb3J0IHsgbG9nU2lnbmFsLCBsb2dFcnJvciB9IGZyb20gJy4uL2xvZ2dpbmcvTG9nZ2VyJztcblxuZXhwb3J0IGludGVyZmFjZSBTaWduYWxHZW5lcmF0b3JDb25maWcge1xuICBtaW5BbGlnbm1lbnRTY29yZTogbnVtYmVyOyAvLyBNaW5pbXVtIGFsaWdubWVudCBzY29yZSBmb3IgQiBzaWduYWxzIChkZWZhdWx0OiA2MClcbiAgcnNUaHJlc2hvbGQ6IG51bWJlcjsgLy8gTWluaW11bSBSUyBzY29yZSBtYWduaXR1ZGUgKGRlZmF1bHQ6IDAuMDEpXG4gIHBvaVByb3hpbWl0eVBlcmNlbnQ6IG51bWJlcjsgLy8gTWF4IGRpc3RhbmNlIGZyb20gUE9JIChkZWZhdWx0OiAwLjUlKVxuICBtaW5DVkRDb25maWRlbmNlOiBudW1iZXI7IC8vIE1pbmltdW0gQ1ZEIGFic29ycHRpb24gY29uZmlkZW5jZSAoZGVmYXVsdDogNzApXG4gIHJlcXVpcmVDVkRDb25maXJtYXRpb246IGJvb2xlYW47IC8vIFdoZXRoZXIgQ1ZEIGNvbmZpcm1hdGlvbiBpcyBtYW5kYXRvcnkgKGRlZmF1bHQ6IHRydWUpXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmFsVmFsaWRhdGlvblJlc3VsdCB7XG4gIHZhbGlkOiBib29sZWFuO1xuICByZWFzb246IHN0cmluZztcbiAgaG9sb2dyYW1WYWxpZDogYm9vbGVhbjtcbiAgc2Vzc2lvblZhbGlkOiBib29sZWFuO1xuICByc1ZhbGlkOiBib29sZWFuO1xuICBwb2lWYWxpZDogYm9vbGVhbjtcbiAgY3ZkVmFsaWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmFsQ29udGV4dCB7XG4gIGhvbG9ncmFtOiBIb2xvZ3JhbVN0YXRlO1xuICBzZXNzaW9uOiBTZXNzaW9uU3RhdGU7XG4gIGN1cnJlbnRQcmljZTogbnVtYmVyO1xuICBuZWFyYnlQT0lzOiBQT0lbXTtcbiAgYWJzb3JwdGlvbjogQWJzb3JwdGlvbiB8IG51bGw7XG4gIGF0cjogbnVtYmVyOyAvLyBGb3IgcG9zaXRpb24gc2l6aW5nIGFuZCBzdG9wIGNhbGN1bGF0aW9uXG59XG5cbmV4cG9ydCBjbGFzcyBTaWduYWxHZW5lcmF0b3Ige1xuICBwcml2YXRlIGNvbmZpZzogU2lnbmFsR2VuZXJhdG9yQ29uZmlnO1xuICBwcml2YXRlIGhvbG9ncmFtRW5naW5lOiBIb2xvZ3JhbUVuZ2luZTtcbiAgcHJpdmF0ZSBzZXNzaW9uUHJvZmlsZXI6IFNlc3Npb25Qcm9maWxlcjtcbiAgcHJpdmF0ZSBpbmVmZmljaWVuY3lNYXBwZXI6IEluZWZmaWNpZW5jeU1hcHBlcjtcbiAgcHJpdmF0ZSBjdmRWYWxpZGF0b3I6IENWRFZhbGlkYXRvcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBob2xvZ3JhbUVuZ2luZTogSG9sb2dyYW1FbmdpbmUsXG4gICAgc2Vzc2lvblByb2ZpbGVyOiBTZXNzaW9uUHJvZmlsZXIsXG4gICAgaW5lZmZpY2llbmN5TWFwcGVyOiBJbmVmZmljaWVuY3lNYXBwZXIsXG4gICAgY3ZkVmFsaWRhdG9yOiBDVkRWYWxpZGF0b3IsXG4gICAgY29uZmlnOiBQYXJ0aWFsPFNpZ25hbEdlbmVyYXRvckNvbmZpZz4gPSB7fVxuICApIHtcbiAgICB0aGlzLmhvbG9ncmFtRW5naW5lID0gaG9sb2dyYW1FbmdpbmU7XG4gICAgdGhpcy5zZXNzaW9uUHJvZmlsZXIgPSBzZXNzaW9uUHJvZmlsZXI7XG4gICAgdGhpcy5pbmVmZmljaWVuY3lNYXBwZXIgPSBpbmVmZmljaWVuY3lNYXBwZXI7XG4gICAgdGhpcy5jdmRWYWxpZGF0b3IgPSBjdmRWYWxpZGF0b3I7XG4gICAgXG4gICAgLy8gU2V0IGRlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgbWluQWxpZ25tZW50U2NvcmU6IDYwLFxuICAgICAgcnNUaHJlc2hvbGQ6IDAuMDEsXG4gICAgICBwb2lQcm94aW1pdHlQZXJjZW50OiAwLjUsXG4gICAgICBtaW5DVkRDb25maWRlbmNlOiA3MCxcbiAgICAgIHJlcXVpcmVDVkRDb25maXJtYXRpb246IHRydWUsXG4gICAgICAuLi5jb25maWdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGhvbG9ncmFtIHN0YXR1cyBtZWV0cyByZXF1aXJlbWVudHMgZm9yIHNpZ25hbCBnZW5lcmF0aW9uXG4gICAqIFJlcXVpcmVtZW50czogQSsgb3IgQiBhbGlnbm1lbnQgc3RhdHVzXG4gICAqL1xuICBjaGVja0hvbG9ncmFtU3RhdHVzKGhvbG9ncmFtOiBIb2xvZ3JhbVN0YXRlKTogYm9vbGVhbiB7XG4gICAgLy8gQ2hlY2sgaWYgc3RhdHVzIGlzIEErIG9yIEJcbiAgICBpZiAoaG9sb2dyYW0uc3RhdHVzICE9PSAnQSsnICYmIGhvbG9ncmFtLnN0YXR1cyAhPT0gJ0InKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQWRkaXRpb25hbCBjaGVjazogYWxpZ25tZW50IHNjb3JlIG11c3QgbWVldCBtaW5pbXVtIHRocmVzaG9sZFxuICAgIGlmIChob2xvZ3JhbS5zdGF0dXMgPT09ICdCJyAmJiBob2xvZ3JhbS5hbGlnbm1lbnRTY29yZSA8IHRoaXMuY29uZmlnLm1pbkFsaWdubWVudFNjb3JlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgdGhhdCB2ZXRvIGxvZ2ljIGhhc24ndCBibG9ja2VkIHRoZSBzaWduYWxcbiAgICBpZiAoaG9sb2dyYW0udmV0by52ZXRvZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBjdXJyZW50IHNlc3Npb24gbWVldHMgS2lsbHpvbmUgcmVxdWlyZW1lbnRzXG4gICAqIFJlcXVpcmVtZW50czogTXVzdCBiZSBMb25kb24gKDA3OjAwLTEwOjAwIFVUQykgb3IgTlkgKDEzOjAwLTE2OjAwIFVUQykgc2Vzc2lvblxuICAgKi9cbiAgY2hlY2tTZXNzaW9uKHNlc3Npb246IFNlc3Npb25TdGF0ZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNlc3Npb25Qcm9maWxlci5pc0tpbGx6b25lKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgUlMgc2NvcmUgbWVldHMgZGlyZWN0aW9uYWwgZmlsdGVyIHJlcXVpcmVtZW50c1xuICAgKiBSZXF1aXJlbWVudHM6IExvbmcgc2lnbmFscyBuZWVkIFJTID4gdGhyZXNob2xkLCBTaG9ydCBzaWduYWxzIG5lZWQgUlMgPCAtdGhyZXNob2xkXG4gICAqL1xuICBjaGVja1JTU2NvcmUocnNTY29yZTogbnVtYmVyLCBkaXJlY3Rpb246ICdMT05HJyB8ICdTSE9SVCcpOiBib29sZWFuIHtcbiAgICBpZiAoZGlyZWN0aW9uID09PSAnTE9ORycpIHtcbiAgICAgIHJldHVybiByc1Njb3JlID4gdGhpcy5jb25maWcucnNUaHJlc2hvbGQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByc1Njb3JlIDwgLXRoaXMuY29uZmlnLnJzVGhyZXNob2xkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBjdXJyZW50IHByaWNlIGlzIHdpdGhpbiBwcm94aW1pdHkgb2YgcmVsZXZhbnQgUE9Jc1xuICAgKiBSZXF1aXJlbWVudHM6IFByaWNlIG11c3QgYmUgd2l0aGluIDAuNSUgb2YgT3JkZXIgQmxvY2sgb3IgRlZHXG4gICAqL1xuICBjaGVja1BPSVByb3hpbWl0eShjdXJyZW50UHJpY2U6IG51bWJlciwgcG9pczogUE9JW10sIGRpcmVjdGlvbjogJ0xPTkcnIHwgJ1NIT1JUJyk6IHsgdmFsaWQ6IGJvb2xlYW47IHBvaTogUE9JIHwgbnVsbCB9IHtcbiAgICBjb25zdCBwcm94aW1pdHlUaHJlc2hvbGQgPSB0aGlzLmNvbmZpZy5wb2lQcm94aW1pdHlQZXJjZW50IC8gMTAwO1xuXG4gICAgZm9yIChjb25zdCBwb2kgb2YgcG9pcykge1xuICAgICAgLy8gU2tpcCBtaXRpZ2F0ZWQgUE9Jc1xuICAgICAgaWYgKCdtaXRpZ2F0ZWQnIGluIHBvaSAmJiBwb2kubWl0aWdhdGVkKSBjb250aW51ZTtcbiAgICAgIGlmICgnc3dlcHQnIGluIHBvaSAmJiBwb2kuc3dlcHQpIGNvbnRpbnVlO1xuXG4gICAgICBsZXQgdGFyZ2V0UHJpY2U6IG51bWJlcjtcbiAgICAgIGxldCBwb2lWYWxpZCA9IGZhbHNlO1xuXG4gICAgICAvLyBDaGVjayBQT0kgdHlwZSBhbmQgZGlyZWN0aW9uIGNvbXBhdGliaWxpdHlcbiAgICAgIGlmICgnbWlkcG9pbnQnIGluIHBvaSkge1xuICAgICAgICAvLyBGVkdcbiAgICAgICAgY29uc3QgZnZnID0gcG9pIGFzIEZWRztcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnICYmIGZ2Zy50eXBlID09PSAnQlVMTElTSCcpIHtcbiAgICAgICAgICB0YXJnZXRQcmljZSA9IGZ2Zy5taWRwb2ludDtcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnU0hPUlQnICYmIGZ2Zy50eXBlID09PSAnQkVBUklTSCcpIHtcbiAgICAgICAgICB0YXJnZXRQcmljZSA9IGZ2Zy5taWRwb2ludDtcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoJ2hpZ2gnIGluIHBvaSAmJiAnbG93JyBpbiBwb2kgJiYgISgnc3RyZW5ndGgnIGluIHBvaSkpIHtcbiAgICAgICAgLy8gT3JkZXIgQmxvY2tcbiAgICAgICAgY29uc3Qgb2IgPSBwb2kgYXMgT3JkZXJCbG9jaztcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnICYmIG9iLnR5cGUgPT09ICdCVUxMSVNIJykge1xuICAgICAgICAgIHRhcmdldFByaWNlID0gb2IubG93OyAvLyBFbnRlciBhdCBib3R0b20gb2YgYnVsbGlzaCBPQlxuICAgICAgICAgIHBvaVZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdTSE9SVCcgJiYgb2IudHlwZSA9PT0gJ0JFQVJJU0gnKSB7XG4gICAgICAgICAgdGFyZ2V0UHJpY2UgPSBvYi5oaWdoOyAvLyBFbnRlciBhdCB0b3Agb2YgYmVhcmlzaCBPQlxuICAgICAgICAgIHBvaVZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgnc3RyZW5ndGgnIGluIHBvaSkge1xuICAgICAgICAvLyBMaXF1aWRpdHkgUG9vbCAtIGxlc3MgcHJlY2lzZSwgdXNlIGZvciBjb25mbHVlbmNlIG9ubHlcbiAgICAgICAgY29uc3QgcG9vbCA9IHBvaSBhcyBMaXF1aWRpdHlQb29sO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnTE9ORycgJiYgcG9vbC50eXBlID09PSAnTE9XJykge1xuICAgICAgICAgIHRhcmdldFByaWNlID0gcG9vbC5wcmljZTtcbiAgICAgICAgICBwb2lWYWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnU0hPUlQnICYmIHBvb2wudHlwZSA9PT0gJ0hJR0gnKSB7XG4gICAgICAgICAgdGFyZ2V0UHJpY2UgPSBwb29sLnByaWNlO1xuICAgICAgICAgIHBvaVZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocG9pVmFsaWQpIHtcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLmFicyhjdXJyZW50UHJpY2UgLSB0YXJnZXRQcmljZSEpIC8gY3VycmVudFByaWNlO1xuICAgICAgICBpZiAoZGlzdGFuY2UgPD0gcHJveGltaXR5VGhyZXNob2xkKSB7XG4gICAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIHBvaSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBwb2k6IG51bGwgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBDVkQgYWJzb3JwdGlvbiBwcm92aWRlcyByZXF1aXJlZCBjb25maXJtYXRpb25cbiAgICogUmVxdWlyZW1lbnRzOiBNdXN0IGhhdmUgYWJzb3JwdGlvbiBzaWduYWwgd2l0aCBzdWZmaWNpZW50IGNvbmZpZGVuY2VcbiAgICovXG4gIGNoZWNrQ1ZEQWJzb3JwdGlvbihhYnNvcnB0aW9uOiBBYnNvcnB0aW9uIHwgbnVsbCwgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXF1aXJlQ1ZEQ29uZmlybWF0aW9uKSB7XG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gQ1ZEIGNvbmZpcm1hdGlvbiBub3QgcmVxdWlyZWRcbiAgICB9XG5cbiAgICBpZiAoIWFic29ycHRpb24pIHtcbiAgICAgIHJldHVybiBmYWxzZTsgLy8gTm8gYWJzb3JwdGlvbiBkZXRlY3RlZFxuICAgIH1cblxuICAgIC8vIENoZWNrIGNvbmZpZGVuY2UgbGV2ZWxcbiAgICBpZiAoYWJzb3JwdGlvbi5jb25maWRlbmNlIDwgdGhpcy5jb25maWcubWluQ1ZEQ29uZmlkZW5jZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEZvciBMT05HIHNpZ25hbHMsIHdlIG5lZWQgYWJzb3JwdGlvbiAoYnV5aW5nIHByZXNzdXJlIGF0IGxvd3MpXG4gICAgLy8gRm9yIFNIT1JUIHNpZ25hbHMsIHdlIG5lZWQgZGlzdHJpYnV0aW9uIChzZWxsaW5nIHByZXNzdXJlIGF0IGhpZ2hzKVxuICAgIC8vIE5vdGU6IFRoZSBjdXJyZW50IGFic29ycHRpb24gaW50ZXJmYWNlIG9ubHkgaGFuZGxlcyBhYnNvcnB0aW9uXG4gICAgLy8gRGlzdHJpYnV0aW9uIHdvdWxkIG5lZWQgdG8gYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IG9yIHRoZSBpbnRlcmZhY2UgZXh0ZW5kZWRcbiAgICBcbiAgICBpZiAoZGlyZWN0aW9uID09PSAnTE9ORycpIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBBYnNvcnB0aW9uIHN1cHBvcnRzIGxvbmcgZW50cnlcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRm9yIHNob3J0IHNpZ25hbHMsIHdlIHdvdWxkIG5lZWQgZGlzdHJpYnV0aW9uIGRldGVjdGlvblxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwgYWNjZXB0IGFic29ycHRpb24gYXMgZ2VuZXJhbCBmbG93IGNvbmZpcm1hdGlvblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFsbCBzaWduYWwgY29uZGl0aW9uc1xuICAgKi9cbiAgdmFsaWRhdGVTaWduYWwoY29udGV4dDogU2lnbmFsQ29udGV4dCwgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnKTogU2lnbmFsVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgaG9sb2dyYW1WYWxpZCA9IHRoaXMuY2hlY2tIb2xvZ3JhbVN0YXR1cyhjb250ZXh0LmhvbG9ncmFtKTtcbiAgICBjb25zdCBzZXNzaW9uVmFsaWQgPSB0aGlzLmNoZWNrU2Vzc2lvbihjb250ZXh0LnNlc3Npb24pO1xuICAgIGNvbnN0IHJzVmFsaWQgPSB0aGlzLmNoZWNrUlNTY29yZShjb250ZXh0LmhvbG9ncmFtLnJzU2NvcmUsIGRpcmVjdGlvbik7XG4gICAgY29uc3QgcG9pUmVzdWx0ID0gdGhpcy5jaGVja1BPSVByb3hpbWl0eShjb250ZXh0LmN1cnJlbnRQcmljZSwgY29udGV4dC5uZWFyYnlQT0lzLCBkaXJlY3Rpb24pO1xuICAgIGNvbnN0IGN2ZFZhbGlkID0gdGhpcy5jaGVja0NWREFic29ycHRpb24oY29udGV4dC5hYnNvcnB0aW9uLCBkaXJlY3Rpb24pO1xuXG4gICAgY29uc3QgdmFsaWQgPSBob2xvZ3JhbVZhbGlkICYmIHNlc3Npb25WYWxpZCAmJiByc1ZhbGlkICYmIHBvaVJlc3VsdC52YWxpZCAmJiBjdmRWYWxpZDtcblxuICAgIGxldCByZWFzb24gPSAnJztcbiAgICBpZiAoIWhvbG9ncmFtVmFsaWQpIHJlYXNvbiArPSAnSG9sb2dyYW0gc3RhdHVzIGludmFsaWQuICc7XG4gICAgaWYgKCFzZXNzaW9uVmFsaWQpIHJlYXNvbiArPSAnTm90IGluIEtpbGx6b25lLiAnO1xuICAgIGlmICghcnNWYWxpZCkgcmVhc29uICs9ICdSUyBzY29yZSBpbnN1ZmZpY2llbnQuICc7XG4gICAgaWYgKCFwb2lSZXN1bHQudmFsaWQpIHJlYXNvbiArPSAnTm8gUE9JIHByb3hpbWl0eS4gJztcbiAgICBpZiAoIWN2ZFZhbGlkKSByZWFzb24gKz0gJ0NWRCBjb25maXJtYXRpb24gbWlzc2luZy4gJztcblxuICAgIGlmICh2YWxpZCkge1xuICAgICAgcmVhc29uID0gJ0FsbCBjb25kaXRpb25zIG1ldCc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkLFxuICAgICAgcmVhc29uOiByZWFzb24udHJpbSgpLFxuICAgICAgaG9sb2dyYW1WYWxpZCxcbiAgICAgIHNlc3Npb25WYWxpZCxcbiAgICAgIHJzVmFsaWQsXG4gICAgICBwb2lWYWxpZDogcG9pUmVzdWx0LnZhbGlkLFxuICAgICAgY3ZkVmFsaWRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBwb3NpdGlvbiBzaXplIHVzaW5nIFZvbGF0aWxpdHktQWRqdXN0ZWQgU2l6aW5nXG4gICAqIEZvcm11bGE6IFJpc2tfRG9sbGFycyAvIChBVFIgKiBTdG9wX0Rpc3RhbmNlX011bHRpcGxpZXIpXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVBvc2l0aW9uU2l6ZShcbiAgICBlcXVpdHk6IG51bWJlcixcbiAgICByaXNrUGVyVHJhZGU6IG51bWJlcixcbiAgICBhdHI6IG51bWJlcixcbiAgICBzdG9wRGlzdGFuY2VQZXJjZW50OiBudW1iZXIsXG4gICAgY3VycmVudFByaWNlOiBudW1iZXIsXG4gICAgbGV2ZXJhZ2U6IG51bWJlclxuICApOiBudW1iZXIge1xuICAgIGNvbnN0IHJpc2tEb2xsYXJzID0gZXF1aXR5ICogcmlza1BlclRyYWRlO1xuICAgIGNvbnN0IHN0b3BEaXN0YW5jZSA9IGN1cnJlbnRQcmljZSAqIChzdG9wRGlzdGFuY2VQZXJjZW50IC8gMTAwKTtcbiAgICBjb25zdCBwb3NpdGlvblNpemUgPSByaXNrRG9sbGFycyAvIHN0b3BEaXN0YW5jZTtcbiAgICBcbiAgICAvLyBBcHBseSBsZXZlcmFnZSBjb25zdHJhaW50XG4gICAgY29uc3QgbWF4UG9zaXRpb25WYWx1ZSA9IGVxdWl0eSAqIGxldmVyYWdlO1xuICAgIGNvbnN0IG1heFBvc2l0aW9uU2l6ZSA9IG1heFBvc2l0aW9uVmFsdWUgLyBjdXJyZW50UHJpY2U7XG4gICAgXG4gICAgcmV0dXJuIE1hdGgubWluKHBvc2l0aW9uU2l6ZSwgbWF4UG9zaXRpb25TaXplKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB0cmFkaW5nIHNpZ25hbCB3aXRoIGFsbCB2YWxpZGF0aW9uc1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVTaWduYWwoXG4gICAgc3ltYm9sOiBzdHJpbmcsXG4gICAgZGlyZWN0aW9uOiAnTE9ORycgfCAnU0hPUlQnLFxuICAgIGVxdWl0eTogbnVtYmVyLFxuICAgIHJpc2tQZXJUcmFkZTogbnVtYmVyID0gMC4wMixcbiAgICBsZXZlcmFnZTogbnVtYmVyID0gM1xuICApOiBQcm9taXNlPFNpZ25hbERhdGEgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBob2xvZ3JhbSBzdGF0ZVxuICAgICAgY29uc3QgaG9sb2dyYW0gPSBhd2FpdCB0aGlzLmhvbG9ncmFtRW5naW5lLmFuYWx5emUoc3ltYm9sKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IHNlc3Npb24gc3RhdGVcbiAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25Qcm9maWxlci5nZXRTZXNzaW9uU3RhdGUoKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IGN1cnJlbnQgcHJpY2UgZnJvbSBob2xvZ3JhbVxuICAgICAgY29uc3QgY3VycmVudFByaWNlID0gaG9sb2dyYW0ubTE1LmN1cnJlbnRQcmljZTtcbiAgICAgIFxuICAgICAgLy8gR2V0IG5lYXJieSBQT0lzXG4gICAgICBjb25zdCBuZWFyYnlQT0lzID0gYXdhaXQgdGhpcy5nZXROZWFyYnlQT0lzKHN5bWJvbCwgY3VycmVudFByaWNlKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IENWRCBhYnNvcnB0aW9uXG4gICAgICBjb25zdCBhYnNvcnB0aW9uID0gYXdhaXQgdGhpcy5nZXRDVkRBYnNvcnB0aW9uKHN5bWJvbCk7XG4gICAgICBcbiAgICAgIC8vIEdldCBBVFIgZm9yIHBvc2l0aW9uIHNpemluZyAodXNpbmcgMTVtIHRpbWVmcmFtZSlcbiAgICAgIGNvbnN0IGF0ciA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlQVRSKHN5bWJvbCwgJzE1bScpO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgc2lnbmFsIGNvbnRleHRcbiAgICAgIGNvbnN0IGNvbnRleHQ6IFNpZ25hbENvbnRleHQgPSB7XG4gICAgICAgIGhvbG9ncmFtLFxuICAgICAgICBzZXNzaW9uLFxuICAgICAgICBjdXJyZW50UHJpY2UsXG4gICAgICAgIG5lYXJieVBPSXMsXG4gICAgICAgIGFic29ycHRpb24sXG4gICAgICAgIGF0clxuICAgICAgfTtcblxuICAgICAgLy8gVmFsaWRhdGUgc2lnbmFsXG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZVNpZ25hbChjb250ZXh0LCBkaXJlY3Rpb24pO1xuICAgICAgXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBTaWduYWwgdmFsaWRhdGlvbiBmYWlsZWQgZm9yICR7c3ltYm9sfSAke2RpcmVjdGlvbn06ICR7dmFsaWRhdGlvbi5yZWFzb259YCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgZW50cnksIHN0b3AsIGFuZCB0YXJnZXQgcHJpY2VzXG4gICAgICBjb25zdCB7IGVudHJ5UHJpY2UsIHN0b3BMb3NzLCB0YWtlUHJvZml0IH0gPSB0aGlzLmNhbGN1bGF0ZVByaWNlcyhcbiAgICAgICAgY3VycmVudFByaWNlLFxuICAgICAgICBkaXJlY3Rpb24sXG4gICAgICAgIGNvbnRleHQubmVhcmJ5UE9JcyxcbiAgICAgICAgYXRyXG4gICAgICApO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb24gc2l6ZVxuICAgICAgY29uc3Qgc3RvcERpc3RhbmNlUGVyY2VudCA9IE1hdGguYWJzKGVudHJ5UHJpY2UgLSBzdG9wTG9zcykgLyBlbnRyeVByaWNlICogMTAwO1xuICAgICAgY29uc3QgcG9zaXRpb25TaXplID0gdGhpcy5jYWxjdWxhdGVQb3NpdGlvblNpemUoXG4gICAgICAgIGVxdWl0eSxcbiAgICAgICAgcmlza1BlclRyYWRlLFxuICAgICAgICBhdHIsXG4gICAgICAgIHN0b3BEaXN0YW5jZVBlcmNlbnQsXG4gICAgICAgIGVudHJ5UHJpY2UsXG4gICAgICAgIGxldmVyYWdlXG4gICAgICApO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgY29uZmlkZW5jZSBzY29yZVxuICAgICAgY29uc3QgY29uZmlkZW5jZSA9IHRoaXMuY2FsY3VsYXRlQ29uZmlkZW5jZShob2xvZ3JhbSwgdmFsaWRhdGlvbiwgYWJzb3JwdGlvbik7XG5cbiAgICAgIC8vIENyZWF0ZSBzaWduYWwgZGF0YVxuICAgICAgY29uc3Qgc2lnbmFsOiBTaWduYWxEYXRhID0ge1xuICAgICAgICBzeW1ib2wsXG4gICAgICAgIGRpcmVjdGlvbixcbiAgICAgICAgaG9sb2dyYW1TdGF0dXM6IGhvbG9ncmFtLnN0YXR1cyxcbiAgICAgICAgYWxpZ25tZW50U2NvcmU6IGhvbG9ncmFtLmFsaWdubWVudFNjb3JlLFxuICAgICAgICByc1Njb3JlOiBob2xvZ3JhbS5yc1Njb3JlLFxuICAgICAgICBzZXNzaW9uVHlwZTogc2Vzc2lvbi50eXBlLFxuICAgICAgICBwb2lUeXBlOiB0aGlzLmdldFBPSVR5cGUoY29udGV4dC5uZWFyYnlQT0lzWzBdKSxcbiAgICAgICAgY3ZkQ29uZmlybWF0aW9uOiB2YWxpZGF0aW9uLmN2ZFZhbGlkLFxuICAgICAgICBjb25maWRlbmNlLFxuICAgICAgICBlbnRyeVByaWNlLFxuICAgICAgICBzdG9wTG9zcyxcbiAgICAgICAgdGFrZVByb2ZpdCxcbiAgICAgICAgcG9zaXRpb25TaXplLFxuICAgICAgICBsZXZlcmFnZSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFNpZ25hbCBnZW5lcmF0ZWQgZm9yICR7c3ltYm9sfSAke2RpcmVjdGlvbn06ICR7aG9sb2dyYW0uc3RhdHVzfSBhbGlnbm1lbnQsICR7Y29uZmlkZW5jZX0lIGNvbmZpZGVuY2VgKTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHNpZ25hbCB0byBzdHJ1Y3R1cmVkIGxvZ2dlclxuICAgICAgbG9nU2lnbmFsKFxuICAgICAgICBzaWduYWwsXG4gICAgICAgIGhvbG9ncmFtLFxuICAgICAgICBzZXNzaW9uLnR5cGUsXG4gICAgICAgIHRoaXMuZ2V0UE9JVHlwZShjb250ZXh0Lm5lYXJieVBPSXNbMF0pLFxuICAgICAgICB2YWxpZGF0aW9uLmN2ZFZhbGlkXG4gICAgICApO1xuICAgICAgXG4gICAgICByZXR1cm4gc2lnbmFsO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBnZW5lcmF0aW5nIHNpZ25hbCBmb3IgJHtzeW1ib2x9OmAsIGVycm9yKTtcbiAgICAgIGxvZ0Vycm9yKCdFUlJPUicsIGBFcnJvciBnZW5lcmF0aW5nIHNpZ25hbCBmb3IgJHtzeW1ib2x9YCwge1xuICAgICAgICBzeW1ib2wsXG4gICAgICAgIGNvbXBvbmVudDogJ1NpZ25hbEdlbmVyYXRvcicsXG4gICAgICAgIGZ1bmN0aW9uOiAnZ2VuZXJhdGVTaWduYWwnLFxuICAgICAgICBzdGFjazogKGVycm9yIGFzIEVycm9yKS5zdGFjayxcbiAgICAgICAgZGF0YTogeyBkaXJlY3Rpb24gfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG5lYXJieSBQT0lzIGZvciB0aGUgc3ltYm9sXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldE5lYXJieVBPSXMoc3ltYm9sOiBzdHJpbmcsIGN1cnJlbnRQcmljZTogbnVtYmVyKTogUHJvbWlzZTxQT0lbXT4ge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IGZldGNoIGZyb20gYSBQT0kgY2FjaGUgb3IgY2FsY3VsYXRlIG9uIGRlbWFuZFxuICAgIC8vIEZvciBub3csIHdlJ2xsIHJldHVybiBhbiBlbXB0eSBhcnJheSBhcyBhIHBsYWNlaG9sZGVyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIEluZWZmaWNpZW5jeU1hcHBlclxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgQ1ZEIGFic29ycHRpb24gZGF0YSBmb3IgdGhlIHN5bWJvbFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRDVkRBYnNvcnB0aW9uKHN5bWJvbDogc3RyaW5nKTogUHJvbWlzZTxBYnNvcnB0aW9uIHwgbnVsbD4ge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IGZldGNoIHJlY2VudCBDVkQgZGF0YSBhbmQgY2hlY2sgZm9yIGFic29ycHRpb25cbiAgICAvLyBGb3Igbm93LCB3ZSdsbCByZXR1cm4gbnVsbCBhcyBhIHBsYWNlaG9sZGVyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIENWRFZhbGlkYXRvclxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBBVFIgZm9yIHBvc2l0aW9uIHNpemluZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVBVFIoc3ltYm9sOiBzdHJpbmcsIHRpbWVmcmFtZTogc3RyaW5nLCBwZXJpb2Q6IG51bWJlciA9IDE0KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSBmZXRjaCBPSExDViBkYXRhIGFuZCBjYWxjdWxhdGUgQVRSXG4gICAgLy8gRm9yIG5vdywgd2UnbGwgcmV0dXJuIGEgcGxhY2Vob2xkZXIgdmFsdWVcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgZmV0Y2ggZGF0YSBhbmQgY2FsY3VsYXRlIHRydWUgQVRSXG4gICAgcmV0dXJuIDAuMDI7IC8vIDIlIHBsYWNlaG9sZGVyIEFUUlxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBlbnRyeSwgc3RvcCBsb3NzLCBhbmQgdGFrZSBwcm9maXQgcHJpY2VzXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVByaWNlcyhcbiAgICBjdXJyZW50UHJpY2U6IG51bWJlcixcbiAgICBkaXJlY3Rpb246ICdMT05HJyB8ICdTSE9SVCcsXG4gICAgcG9pczogUE9JW10sXG4gICAgYXRyOiBudW1iZXJcbiAgKTogeyBlbnRyeVByaWNlOiBudW1iZXI7IHN0b3BMb3NzOiBudW1iZXI7IHRha2VQcm9maXQ6IG51bWJlciB9IHtcbiAgICAvLyBEZWZhdWx0IHRvIGN1cnJlbnQgcHJpY2UgaWYgbm8gUE9JXG4gICAgbGV0IGVudHJ5UHJpY2UgPSBjdXJyZW50UHJpY2U7XG4gICAgXG4gICAgLy8gVXNlIFBPSSBwcmljZSBpZiBhdmFpbGFibGVcbiAgICBpZiAocG9pcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBwb2kgPSBwb2lzWzBdO1xuICAgICAgaWYgKCdtaWRwb2ludCcgaW4gcG9pKSB7XG4gICAgICAgIGVudHJ5UHJpY2UgPSAocG9pIGFzIEZWRykubWlkcG9pbnQ7XG4gICAgICB9IGVsc2UgaWYgKCdoaWdoJyBpbiBwb2kgJiYgJ2xvdycgaW4gcG9pICYmICEoJ3N0cmVuZ3RoJyBpbiBwb2kpKSB7XG4gICAgICAgIGNvbnN0IG9iID0gcG9pIGFzIE9yZGVyQmxvY2s7XG4gICAgICAgIGVudHJ5UHJpY2UgPSBkaXJlY3Rpb24gPT09ICdMT05HJyA/IG9iLmxvdyA6IG9iLmhpZ2g7XG4gICAgICB9IGVsc2UgaWYgKCdwcmljZScgaW4gcG9pKSB7XG4gICAgICAgIGVudHJ5UHJpY2UgPSAocG9pIGFzIExpcXVpZGl0eVBvb2wpLnByaWNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBzdG9wIGxvc3MgYW5kIHRha2UgcHJvZml0ICgzOjEgUjpSKVxuICAgIGNvbnN0IHN0b3BEaXN0YW5jZSA9IGVudHJ5UHJpY2UgKiAwLjAxNTsgLy8gMS41JSBzdG9wXG4gICAgY29uc3QgdGFyZ2V0RGlzdGFuY2UgPSBzdG9wRGlzdGFuY2UgKiAzOyAvLyAzOjEgUjpSXG5cbiAgICBsZXQgc3RvcExvc3M6IG51bWJlcjtcbiAgICBsZXQgdGFrZVByb2ZpdDogbnVtYmVyO1xuXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ0xPTkcnKSB7XG4gICAgICBzdG9wTG9zcyA9IGVudHJ5UHJpY2UgLSBzdG9wRGlzdGFuY2U7XG4gICAgICB0YWtlUHJvZml0ID0gZW50cnlQcmljZSArIHRhcmdldERpc3RhbmNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wTG9zcyA9IGVudHJ5UHJpY2UgKyBzdG9wRGlzdGFuY2U7XG4gICAgICB0YWtlUHJvZml0ID0gZW50cnlQcmljZSAtIHRhcmdldERpc3RhbmNlO1xuICAgIH1cblxuICAgIHJldHVybiB7IGVudHJ5UHJpY2UsIHN0b3BMb3NzLCB0YWtlUHJvZml0IH07XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIG92ZXJhbGwgc2lnbmFsIGNvbmZpZGVuY2VcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29uZmlkZW5jZShcbiAgICBob2xvZ3JhbTogSG9sb2dyYW1TdGF0ZSxcbiAgICB2YWxpZGF0aW9uOiBTaWduYWxWYWxpZGF0aW9uUmVzdWx0LFxuICAgIGFic29ycHRpb246IEFic29ycHRpb24gfCBudWxsXG4gICk6IG51bWJlciB7XG4gICAgbGV0IGNvbmZpZGVuY2UgPSBob2xvZ3JhbS5hbGlnbm1lbnRTY29yZTsgLy8gQmFzZSBjb25maWRlbmNlIGZyb20gYWxpZ25tZW50XG5cbiAgICAvLyBCb251cyBmb3IgQSsgc3RhdHVzXG4gICAgaWYgKGhvbG9ncmFtLnN0YXR1cyA9PT0gJ0ErJykge1xuICAgICAgY29uZmlkZW5jZSArPSAxMDtcbiAgICB9XG5cbiAgICAvLyBCb251cyBmb3Igc3Ryb25nIFJTXG4gICAgaWYgKE1hdGguYWJzKGhvbG9ncmFtLnJzU2NvcmUpID4gMC4wNSkge1xuICAgICAgY29uZmlkZW5jZSArPSA1O1xuICAgIH1cblxuICAgIC8vIEJvbnVzIGZvciBDVkQgY29uZmlybWF0aW9uXG4gICAgaWYgKGFic29ycHRpb24gJiYgYWJzb3JwdGlvbi5jb25maWRlbmNlID4gODApIHtcbiAgICAgIGNvbmZpZGVuY2UgKz0gMTA7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWluKDEwMCwgY29uZmlkZW5jZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IFBPSSB0eXBlIGZvciBsb2dnaW5nXG4gICAqL1xuICBwcml2YXRlIGdldFBPSVR5cGUocG9pOiBQT0kgfCB1bmRlZmluZWQpOiAnRlZHJyB8ICdPUkRFUl9CTE9DSycgfCAnTElRVUlESVRZX1BPT0wnIHtcbiAgICBpZiAoIXBvaSkgcmV0dXJuICdPUkRFUl9CTE9DSyc7IC8vIERlZmF1bHRcblxuICAgIGlmICgnbWlkcG9pbnQnIGluIHBvaSkgcmV0dXJuICdGVkcnO1xuICAgIGlmICgnaGlnaCcgaW4gcG9pICYmICdsb3cnIGluIHBvaSAmJiAhKCdzdHJlbmd0aCcgaW4gcG9pKSkgcmV0dXJuICdPUkRFUl9CTE9DSyc7XG4gICAgcmV0dXJuICdMSVFVSURJVFlfUE9PTCc7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8U2lnbmFsR2VuZXJhdG9yQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0geyAuLi50aGlzLmNvbmZpZywgLi4ubmV3Q29uZmlnIH07XG4gICAgY29uc29sZS5sb2coJ/Cfk50gU2lnbmFsR2VuZXJhdG9yIGNvbmZpZ3VyYXRpb24gdXBkYXRlZCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBTaWduYWxHZW5lcmF0b3JDb25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=