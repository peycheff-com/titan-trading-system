{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/BacktestEngine.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/BacktestEngine.test.ts"],"sourcesContent":["/**\n * Unit Tests for BacktestEngine\n * \n * Tests the backtesting functionality including historical data fetching,\n * trade simulation, fee calculation, and results analysis.\n */\n\nimport { BacktestEngine, BacktestConfig, SlippageModel, FeeModel } from '../../src/backtest/BacktestEngine';\nimport { BybitPerpsClient } from '../../src/exchanges/BybitPerpsClient';\nimport { HologramEngine } from '../../src/engine/HologramEngine';\nimport { SessionProfiler } from '../../src/engine/SessionProfiler';\nimport { InefficiencyMapper } from '../../src/engine/InefficiencyMapper';\nimport { CVDValidator } from '../../src/engine/CVDValidator';\nimport { SignalGenerator } from '../../src/execution/SignalGenerator';\nimport { OHLCV, SignalData } from '../../src/types';\n\n// Mock dependencies\njest.mock('../../src/exchanges/BybitPerpsClient');\njest.mock('../../src/engine/HologramEngine');\njest.mock('../../src/engine/SessionProfiler');\njest.mock('../../src/engine/InefficiencyMapper');\njest.mock('../../src/engine/CVDValidator');\njest.mock('../../src/execution/SignalGenerator');\n\ndescribe('BacktestEngine', () => {\n  let backtestEngine: BacktestEngine;\n  let mockBybitClient: jest.Mocked<BybitPerpsClient>;\n  let mockHologramEngine: jest.Mocked<HologramEngine>;\n  let mockSessionProfiler: jest.Mocked<SessionProfiler>;\n  let mockInefficiencyMapper: jest.Mocked<InefficiencyMapper>;\n  let mockCVDValidator: jest.Mocked<CVDValidator>;\n  let mockSignalGenerator: jest.Mocked<SignalGenerator>;\n\n  beforeEach(() => {\n    // Create mocked instances\n    mockBybitClient = new BybitPerpsClient() as jest.Mocked<BybitPerpsClient>;\n    mockHologramEngine = new HologramEngine(mockBybitClient) as jest.Mocked<HologramEngine>;\n    mockSessionProfiler = new SessionProfiler() as jest.Mocked<SessionProfiler>;\n    mockInefficiencyMapper = new InefficiencyMapper() as jest.Mocked<InefficiencyMapper>;\n    mockCVDValidator = new CVDValidator() as jest.Mocked<CVDValidator>;\n    mockSignalGenerator = new SignalGenerator(\n      mockHologramEngine,\n      mockSessionProfiler,\n      mockInefficiencyMapper,\n      mockCVDValidator\n    ) as jest.Mocked<SignalGenerator>;\n\n    // Create BacktestEngine instance\n    backtestEngine = new BacktestEngine(\n      mockBybitClient,\n      mockHologramEngine,\n      mockSessionProfiler,\n      mockInefficiencyMapper,\n      mockCVDValidator,\n      mockSignalGenerator\n    );\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('fetchHistoricalData', () => {\n    it('should fetch historical data for multiple symbols', async () => {\n      // Arrange\n      const symbols = ['BTCUSDT', 'ETHUSDT'];\n      const timeframe = '15m';\n      const startDate = Date.now() - (7 * 24 * 60 * 60 * 1000); // 7 days ago\n      const endDate = Date.now();\n\n      const mockCandles: OHLCV[] = [\n        {\n          timestamp: startDate,\n          open: 50000,\n          high: 51000,\n          low: 49000,\n          close: 50500,\n          volume: 1000\n        },\n        {\n          timestamp: startDate + 15 * 60 * 1000,\n          open: 50500,\n          high: 51500,\n          low: 50000,\n          close: 51000,\n          volume: 1200\n        }\n      ];\n\n      mockBybitClient.fetchOHLCV.mockResolvedValue(mockCandles);\n\n      // Act\n      const result = await backtestEngine.fetchHistoricalData(symbols, timeframe, startDate, endDate);\n\n      // Assert\n      expect(result.size).toBe(2);\n      expect(result.has('BTCUSDT')).toBe(true);\n      expect(result.has('ETHUSDT')).toBe(true);\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledTimes(2);\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledWith('BTCUSDT', timeframe, expect.any(Number));\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledWith('ETHUSDT', timeframe, expect.any(Number));\n    });\n\n    it('should handle API errors gracefully', async () => {\n      // Arrange\n      const symbols = ['BTCUSDT'];\n      const timeframe = '15m';\n      const startDate = Date.now() - (24 * 60 * 60 * 1000);\n      const endDate = Date.now();\n\n      mockBybitClient.fetchOHLCV.mockRejectedValue(new Error('API Error'));\n\n      // Act\n      const result = await backtestEngine.fetchHistoricalData(symbols, timeframe, startDate, endDate);\n\n      // Assert\n      expect(result.size).toBe(0);\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledTimes(1);\n    });\n\n    it('should filter candles within date range', async () => {\n      // Arrange\n      const symbols = ['BTCUSDT'];\n      const timeframe = '15m';\n      const startDate = Date.now() - (2 * 24 * 60 * 60 * 1000); // 2 days ago\n      const endDate = Date.now() - (1 * 24 * 60 * 60 * 1000); // 1 day ago\n\n      const mockCandles: OHLCV[] = [\n        {\n          timestamp: startDate - 60 * 60 * 1000, // Before range\n          open: 50000,\n          high: 51000,\n          low: 49000,\n          close: 50500,\n          volume: 1000\n        },\n        {\n          timestamp: startDate + 60 * 60 * 1000, // Within range\n          open: 50500,\n          high: 51500,\n          low: 50000,\n          close: 51000,\n          volume: 1200\n        },\n        {\n          timestamp: endDate + 60 * 60 * 1000, // After range\n          open: 51000,\n          high: 52000,\n          low: 50500,\n          close: 51500,\n          volume: 1100\n        }\n      ];\n\n      mockBybitClient.fetchOHLCV.mockResolvedValue(mockCandles);\n\n      // Act\n      const result = await backtestEngine.fetchHistoricalData(symbols, timeframe, startDate, endDate);\n\n      // Assert\n      const btcCandles = result.get('BTCUSDT');\n      expect(btcCandles).toBeDefined();\n      expect(btcCandles!.length).toBe(1);\n      expect(btcCandles![0].timestamp).toBe(startDate + 60 * 60 * 1000);\n    });\n  });\n\n  describe('simulateTrade', () => {\n    it('should apply correct slippage for POST_ONLY orders', () => {\n      // Arrange\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'LONG',\n        hologramStatus: 'A+',\n        alignmentScore: 85,\n        rsScore: 0.03,\n        sessionType: 'LONDON',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 90,\n        entryPrice: 50000,\n        stopLoss: 49250,\n        takeProfit: 52250,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const currentPrice = 50000;\n\n      // Act\n      const result = backtestEngine.simulateTrade(signal, 'POST_ONLY', currentPrice);\n\n      // Assert\n      expect(result.filled).toBe(true);\n      expect(result.fillPrice).toBeGreaterThan(currentPrice); // Long order should have positive slippage\n      expect(result.slippage).toBeGreaterThan(0);\n      expect(result.slippage).toBe(currentPrice * 0.001); // 0.1% slippage\n    });\n\n    it('should apply correct slippage for IOC orders', () => {\n      // Arrange\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'SHORT',\n        hologramStatus: 'B',\n        alignmentScore: 70,\n        rsScore: -0.02,\n        sessionType: 'NY',\n        poiType: 'FVG',\n        cvdConfirmation: true,\n        confidence: 75,\n        entryPrice: 50000,\n        stopLoss: 50750,\n        takeProfit: 47750,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const currentPrice = 50000;\n\n      // Act\n      const result = backtestEngine.simulateTrade(signal, 'IOC', currentPrice);\n\n      // Assert\n      expect(result.filled).toBe(true);\n      expect(result.fillPrice).toBeLessThan(currentPrice); // Short order should have negative slippage\n      expect(result.slippage).toBeGreaterThan(0);\n      expect(result.slippage).toBe(currentPrice * 0.002); // 0.2% slippage\n    });\n\n    it('should apply correct slippage for MARKET orders', () => {\n      // Arrange\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'LONG',\n        hologramStatus: 'A+',\n        alignmentScore: 85,\n        rsScore: 0.03,\n        sessionType: 'LONDON',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 90,\n        entryPrice: 50000,\n        stopLoss: 49250,\n        takeProfit: 52250,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const currentPrice = 50000;\n\n      // Act\n      const result = backtestEngine.simulateTrade(signal, 'MARKET', currentPrice);\n\n      // Assert\n      expect(result.filled).toBe(true);\n      expect(result.fillPrice).toBeGreaterThan(currentPrice); // Long order should have positive slippage\n      expect(result.slippage).toBeGreaterThan(0);\n      expect(result.slippage).toBe(currentPrice * 0.003); // 0.3% slippage\n    });\n\n    it('should handle POST_ONLY orders that do not fill', () => {\n      // Arrange\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'LONG',\n        hologramStatus: 'A+',\n        alignmentScore: 85,\n        rsScore: 0.03,\n        sessionType: 'LONDON',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 90,\n        entryPrice: 50000,\n        stopLoss: 49250,\n        takeProfit: 52250,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const currentPrice = 50000;\n\n      // Mock Math.random to return a value that triggers no fill\n      const originalRandom = Math.random;\n      Math.random = jest.fn(() => 0.05); // 5% < 10% threshold\n\n      // Act\n      const result = backtestEngine.simulateTrade(signal, 'POST_ONLY', currentPrice);\n\n      // Assert\n      expect(result.filled).toBe(false);\n      expect(result.fillPrice).toBe(0);\n      expect(result.slippage).toBe(0);\n\n      // Restore Math.random\n      Math.random = originalRandom;\n    });\n  });\n\n  describe('applyFees', () => {\n    it('should apply maker rebate for POST_ONLY orders', () => {\n      // Arrange\n      const notionalValue = 10000; // $10,000 position\n      const orderType = 'POST_ONLY';\n\n      // Act\n      const fees = backtestEngine.applyFees(notionalValue, orderType);\n\n      // Assert\n      expect(fees).toBe(notionalValue * -0.0001); // -0.01% rebate\n      expect(fees).toBeLessThan(0); // Should be negative (rebate)\n    });\n\n    it('should apply taker fee for IOC orders', () => {\n      // Arrange\n      const notionalValue = 10000; // $10,000 position\n      const orderType = 'IOC';\n\n      // Act\n      const fees = backtestEngine.applyFees(notionalValue, orderType);\n\n      // Assert\n      expect(fees).toBe(notionalValue * 0.0005); // 0.05% fee\n      expect(fees).toBeGreaterThan(0); // Should be positive (fee)\n    });\n\n    it('should apply taker fee for MARKET orders', () => {\n      // Arrange\n      const notionalValue = 5000; // $5,000 position\n      const orderType = 'MARKET';\n\n      // Act\n      const fees = backtestEngine.applyFees(notionalValue, orderType);\n\n      // Assert\n      expect(fees).toBe(notionalValue * 0.0005); // 0.05% fee\n      expect(fees).toBeGreaterThan(0); // Should be positive (fee)\n    });\n  });\n\n  describe('calcBacktestResults', () => {\n    it('should calculate correct metrics for profitable trades', () => {\n      // Arrange\n      const config: BacktestConfig = {\n        startDate: Date.now() - (30 * 24 * 60 * 60 * 1000),\n        endDate: Date.now(),\n        symbols: ['BTCUSDT'],\n        initialEquity: 10000,\n        riskPerTrade: 0.02,\n        maxLeverage: 3,\n        maxConcurrentPositions: 3,\n        slippageModel: { postOnlySlippage: 0.001, iocSlippage: 0.002, marketSlippage: 0.003 },\n        feeModel: { makerFee: -0.0001, takerFee: 0.0005 },\n        timeframe: '15m'\n      };\n\n      const trades = [\n        {\n          id: 'trade1',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: Date.now() - 1000000,\n          exitTime: Date.now() - 500000,\n          entryPrice: 50000,\n          exitPrice: 52000,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: 600, // 4% gain * 3x leverage * $5000 position = $600\n          pnlPercent: 0.12, // 12%\n          fees: -1, // Maker rebate\n          slippage: 5,\n          holdTime: 500000,\n          exitReason: 'TAKE_PROFIT' as const,\n          signal: {} as SignalData,\n          rValue: 3\n        },\n        {\n          id: 'trade2',\n          symbol: 'BTCUSDT',\n          direction: 'SHORT' as const,\n          entryTime: Date.now() - 800000,\n          exitTime: Date.now() - 300000,\n          entryPrice: 51000,\n          exitPrice: 50000,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: 300, // 2% gain * 3x leverage * $5100 position = $306\n          pnlPercent: 0.06, // 6%\n          fees: 2.5, // Taker fee\n          slippage: 10,\n          holdTime: 500000,\n          exitReason: 'TAKE_PROFIT' as const,\n          signal: {} as SignalData,\n          rValue: 1.5\n        }\n      ];\n\n      // Act\n      const metrics = backtestEngine.calcBacktestResults(trades, config);\n\n      // Assert\n      expect(metrics.totalTrades).toBe(2);\n      expect(metrics.winRate).toBe(1.0); // 100% win rate\n      expect(metrics.totalReturn).toBeCloseTo(0.09); // 9% total return\n      expect(metrics.profitFactor).toBeGreaterThan(1);\n      expect(metrics.maxDrawdown).toBe(0); // No losing trades\n      expect(metrics.averageWin).toBeCloseTo(450); // Average of 600 and 300\n      expect(metrics.averageLoss).toBe(0); // No losing trades\n      expect(metrics.totalFees).toBeCloseTo(1.5); // -1 + 2.5\n      expect(metrics.totalSlippage).toBe(15); // 5 + 10\n    });\n\n    it('should calculate correct metrics for mixed trades', () => {\n      // Arrange\n      const config: BacktestConfig = {\n        startDate: Date.now() - (30 * 24 * 60 * 60 * 1000),\n        endDate: Date.now(),\n        symbols: ['BTCUSDT'],\n        initialEquity: 10000,\n        riskPerTrade: 0.02,\n        maxLeverage: 3,\n        maxConcurrentPositions: 3,\n        slippageModel: { postOnlySlippage: 0.001, iocSlippage: 0.002, marketSlippage: 0.003 },\n        feeModel: { makerFee: -0.0001, takerFee: 0.0005 },\n        timeframe: '15m'\n      };\n\n      const trades = [\n        {\n          id: 'trade1',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: Date.now() - 1000000,\n          exitTime: Date.now() - 500000,\n          entryPrice: 50000,\n          exitPrice: 52000,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: 600,\n          pnlPercent: 0.12,\n          fees: -1,\n          slippage: 5,\n          holdTime: 500000,\n          exitReason: 'TAKE_PROFIT' as const,\n          signal: {} as SignalData,\n          rValue: 3\n        },\n        {\n          id: 'trade2',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: Date.now() - 800000,\n          exitTime: Date.now() - 300000,\n          entryPrice: 51000,\n          exitPrice: 49500,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: -450, // Loss\n          pnlPercent: -0.09,\n          fees: 2.5,\n          slippage: 10,\n          holdTime: 500000,\n          exitReason: 'STOP_LOSS' as const,\n          signal: {} as SignalData,\n          rValue: -1.5\n        }\n      ];\n\n      // Act\n      const metrics = backtestEngine.calcBacktestResults(trades, config);\n\n      // Assert\n      expect(metrics.totalTrades).toBe(2);\n      expect(metrics.winRate).toBe(0.5); // 50% win rate\n      expect(metrics.totalReturn).toBeCloseTo(0.015); // 1.5% total return\n      expect(metrics.profitFactor).toBeCloseTo(600 / 450); // Gross profit / gross loss\n      expect(metrics.averageWin).toBe(600);\n      expect(metrics.averageLoss).toBe(-450);\n      expect(metrics.largestWin).toBe(600);\n      expect(metrics.largestLoss).toBe(-450);\n    });\n\n    it('should handle empty trade list', () => {\n      // Arrange\n      const config: BacktestConfig = {\n        startDate: Date.now() - (30 * 24 * 60 * 60 * 1000),\n        endDate: Date.now(),\n        symbols: ['BTCUSDT'],\n        initialEquity: 10000,\n        riskPerTrade: 0.02,\n        maxLeverage: 3,\n        maxConcurrentPositions: 3,\n        slippageModel: { postOnlySlippage: 0.001, iocSlippage: 0.002, marketSlippage: 0.003 },\n        feeModel: { makerFee: -0.0001, takerFee: 0.0005 },\n        timeframe: '15m'\n      };\n\n      const trades: any[] = [];\n\n      // Act\n      const metrics = backtestEngine.calcBacktestResults(trades, config);\n\n      // Assert\n      expect(metrics.totalTrades).toBe(0);\n      expect(metrics.winRate).toBe(0);\n      expect(metrics.totalReturn).toBe(0);\n      expect(metrics.profitFactor).toBe(0);\n      expect(metrics.maxDrawdown).toBe(0);\n      expect(metrics.finalEquity).toBe(config.initialEquity);\n    });\n  });\n\n  describe('generateEquityCurve', () => {\n    it('should generate correct equity curve points', () => {\n      // Arrange\n      const initialEquity = 10000;\n      const trades = [\n        {\n          id: 'trade1',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: 1000,\n          exitTime: 2000,\n          entryPrice: 50000,\n          exitPrice: 52000,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: 600,\n          pnlPercent: 0.12,\n          fees: -1,\n          slippage: 5,\n          holdTime: 1000,\n          exitReason: 'TAKE_PROFIT' as const,\n          signal: {} as SignalData,\n          rValue: 3\n        },\n        {\n          id: 'trade2',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: 3000,\n          exitTime: 4000,\n          entryPrice: 51000,\n          exitPrice: 49500,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: -300,\n          pnlPercent: -0.06,\n          fees: 2.5,\n          slippage: 10,\n          holdTime: 1000,\n          exitReason: 'STOP_LOSS' as const,\n          signal: {} as SignalData,\n          rValue: -1\n        }\n      ];\n\n      // Act\n      const equityCurve = backtestEngine.generateEquityCurve(trades, initialEquity);\n\n      // Assert\n      expect(equityCurve.length).toBe(5); // Start + 2 entries + 2 exits\n      expect(equityCurve[0].equity).toBe(initialEquity);\n      expect(equityCurve[0].openPositions).toBe(0);\n      expect(equityCurve[1].timestamp).toBe(1000); // First entry\n      expect(equityCurve[1].openPositions).toBe(1);\n      expect(equityCurve[2].timestamp).toBe(2000); // First exit\n      expect(equityCurve[2].equity).toBe(initialEquity + 600); // After first trade\n      expect(equityCurve[2].openPositions).toBe(0);\n      expect(equityCurve[4].equity).toBe(initialEquity + 600 - 300); // After second trade\n    });\n\n    it('should calculate drawdown correctly', () => {\n      // Arrange\n      const initialEquity = 10000;\n      const trades = [\n        {\n          id: 'trade1',\n          symbol: 'BTCUSDT',\n          direction: 'LONG' as const,\n          entryTime: 1000,\n          exitTime: 2000,\n          entryPrice: 50000,\n          exitPrice: 49000,\n          quantity: 0.1,\n          leverage: 3,\n          pnl: -600, // Loss\n          pnlPercent: -0.06,\n          fees: 2.5,\n          slippage: 10,\n          holdTime: 1000,\n          exitReason: 'STOP_LOSS' as const,\n          signal: {} as SignalData,\n          rValue: -2\n        }\n      ];\n\n      // Act\n      const equityCurve = backtestEngine.generateEquityCurve(trades, initialEquity);\n\n      // Assert\n      const finalPoint = equityCurve[equityCurve.length - 1];\n      expect(finalPoint.equity).toBe(initialEquity - 600);\n      expect(finalPoint.drawdown).toBeCloseTo(0.06); // 6% drawdown\n    });\n  });\n\n  describe('configuration management', () => {\n    it('should update configuration correctly', () => {\n      // Arrange\n      const newConfig = {\n        initialEquity: 20000,\n        maxLeverage: 5,\n        riskPerTrade: 0.03\n      };\n\n      // Act\n      backtestEngine.updateConfig(newConfig);\n      const updatedConfig = backtestEngine.getConfig();\n\n      // Assert\n      expect(updatedConfig.initialEquity).toBe(20000);\n      expect(updatedConfig.maxLeverage).toBe(5);\n      expect(updatedConfig.riskPerTrade).toBe(0.03);\n      expect(updatedConfig.symbols).toEqual(['BTCUSDT', 'ETHUSDT']); // Should preserve other values\n    });\n\n    it('should return current configuration', () => {\n      // Act\n      const config = backtestEngine.getConfig();\n\n      // Assert\n      expect(config).toBeDefined();\n      expect(config.initialEquity).toBe(10000);\n      expect(config.maxLeverage).toBe(3);\n      expect(config.riskPerTrade).toBe(0.02);\n      expect(config.symbols).toEqual(['BTCUSDT', 'ETHUSDT']);\n    });\n\n    it('should track running state correctly', () => {\n      // Act & Assert\n      expect(backtestEngine.isBacktestRunning()).toBe(false);\n      \n      // Note: Testing the running state during actual backtest execution\n      // would require more complex async testing setup\n    });\n  });\n});"],"version":3}