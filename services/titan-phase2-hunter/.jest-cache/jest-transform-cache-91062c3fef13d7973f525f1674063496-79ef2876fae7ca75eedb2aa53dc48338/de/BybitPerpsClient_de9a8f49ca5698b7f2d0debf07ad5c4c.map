{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/exchanges/BybitPerpsClient.ts","mappings":";AAAA;;;;;;;GAOG;;;AAEH,mCAAoC;AAyHpC,MAAa,gBAAgB;IACnB,OAAO,GAAG,uBAAuB,CAAC;IAClC,MAAM,CAAS;IACf,SAAS,CAAS;IAClB,KAAK,GAAG,IAAI,GAAG,EAA2B,CAAC;IAClC,SAAS,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,YAAY;IACvC,eAAe,GAAG,KAAK,CAAC,CAAC,aAAa;IACtC,cAAc,GAAG,CAAC,CAAC;IACnB,WAAW,GAAG,IAAI,CAAC,CAAC,WAAW;IAEhD,YAAY,MAAc,EAAE,SAAiB;QAC3C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;IAC7B,CAAC;IAED;;;OAGG;IACI,KAAK,CAAC,eAAe;QAC1B,MAAM,QAAQ,GAAG,aAAa,CAAC;QAC/B,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAW,QAAQ,CAAC,CAAC;QACrD,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,oBAAoB,EAAE;gBACnE,QAAQ,EAAE,QAAQ;aACnB,CAAC,CAAC;YAEH,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,sCAAsC;YACtC,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAyB,CAAC;YAC1D,MAAM,aAAa,GAAG,OAAO;iBAC1B,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;iBAChD,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,WAAW,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;iBACrE,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC;iBACb,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAEhC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YACvD,OAAO,aAAa,CAAC;QACvB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,gCAAgC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QAC9G,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,UAAU,CAAC,MAAc,EAAE,QAAgB,EAAE,QAAgB,GAAG;QAC3E,MAAM,QAAQ,GAAG,SAAS,MAAM,IAAI,QAAQ,IAAI,KAAK,EAAE,CAAC;QACxD,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAU,QAAQ,CAAC,CAAC;QACpD,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC;YACH,mCAAmC;YACnC,MAAM,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;YAErD,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,kBAAkB,EAAE;gBACjE,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;gBAC5B,QAAQ,EAAE,aAAa;gBACvB,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,QAAQ,EAAE;aACxC,CAAC,CAAC;YAEH,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,SAAS,GAAG,QAAQ,CAAC,MAAwB,CAAC;YACpD,MAAM,KAAK,GAAY,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBACnD,SAAS,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC9B,IAAI,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC3B,IAAI,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC3B,GAAG,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC1B,KAAK,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC5B,MAAM,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;aAC9B,CAAC,CAAC,CAAC;YAEJ,mCAAmC;YACnC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC;YAEhD,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAC/C,OAAO,KAAK,CAAC;QACf,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,6BAA6B,MAAM,KAAK,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACtH,CAAC;IACH,CAAC;IAED;;;;OAIG;IACI,KAAK,CAAC,eAAe,CAAC,MAAc;QACzC,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,oBAAoB,EAAE;gBACnE,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;aAC7B,CAAC,CAAC;YAEH,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAoB,CAAC;YAC1D,IAAI,CAAC,MAAM,EAAE,CAAC;gBACZ,MAAM,IAAI,KAAK,CAAC,4BAA4B,MAAM,EAAE,CAAC,CAAC;YACxD,CAAC;YAED,OAAO,UAAU,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QACtC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,mCAAmC,MAAM,KAAK,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QAC5H,CAAC;IACH,CAAC;IAED;;;OAGG;IACI,KAAK,CAAC,SAAS;QACpB,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,4BAA4B,EAAE;gBAC3E,WAAW,EAAE,SAAS;aACvB,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAqB,CAAC;YAC5D,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;YAC3C,CAAC;YAED,OAAO,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QACzC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,yBAAyB,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACvG,CAAC;IACH,CAAC;IAED;;;;OAIG;IACI,KAAK,CAAC,UAAU,CAAC,MAAmB;QACzC,IAAI,CAAC;YACH,MAAM,WAAW,GAAQ;gBACvB,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE;gBACnC,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,SAAS,EAAE,MAAM,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ;gBAC/F,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE;gBAC1B,WAAW,EAAE,MAAM,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK;aAC9D,CAAC;YAEF,6BAA6B;YAC7B,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,IAAI,MAAM,CAAC,IAAI,KAAK,WAAW,EAAE,CAAC;gBAC3D,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;oBAClB,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;gBACxD,CAAC;gBACD,WAAW,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC9C,CAAC;YAED,4CAA4C;YAC5C,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACpB,WAAW,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;YACpD,CAAC;YACD,IAAI,MAAM,CAAC,UAAU,EAAE,CAAC;gBACtB,WAAW,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;YACxD,CAAC;YAED,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,kBAAkB,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;YAEvF,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,SAAS,GAAG,QAAQ,CAAC,MAA4B,CAAC;YAExD,OAAO;gBACL,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,MAAM,EAAE,SAAS,CAAC,MAAM;gBACxB,IAAI,EAAE,SAAS,CAAC,IAAsB;gBACtC,GAAG,EAAE,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC;gBAC9B,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,KAAK,IAAI,SAAS,CAAC,QAAQ,IAAI,GAAG,CAAC;gBAC/D,MAAM,EAAE,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,WAAW,CAAC;gBAClD,SAAS,EAAE,QAAQ,CAAC,SAAS,CAAC,UAAU,CAAC;aAC1C,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,0BAA0B,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACxG,CAAC;IACH,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,mBAAmB,CAAC,MAAmB,EAAE,aAAqB,CAAC;QAC1E,IAAI,SAAgB,CAAC;QAErB,KAAK,IAAI,OAAO,GAAG,CAAC,EAAE,OAAO,IAAI,UAAU,EAAE,OAAO,EAAE,EAAE,CAAC;YACvD,IAAI,CAAC;gBACH,+BAA+B;gBAC/B,MAAM,cAAc,GAAG,IAAI,OAAO,CAAQ,CAAC,CAAC,EAAE,MAAM,EAAE,EAAE;oBACtD,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;gBAC7E,CAAC,CAAC,CAAC;gBAEH,MAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBAC7C,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,cAAc,CAAC,CAAC,CAAC;gBAElE,OAAO,MAAM,CAAC;YAChB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,SAAS,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;gBAExE,IAAI,OAAO,GAAG,UAAU,EAAE,CAAC;oBACzB,OAAO,CAAC,IAAI,CAAC,oBAAoB,OAAO,GAAG,CAAC,sBAAsB,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC;oBACvF,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;gBACrC,CAAC;YACH,CAAC;QACH,CAAC;QAED,MAAM,IAAI,KAAK,CAAC,sBAAsB,UAAU,GAAG,CAAC,cAAc,SAAU,CAAC,OAAO,EAAE,CAAC,CAAC;IAC1F,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,WAAW,CAAC,MAAc,EAAE,QAAgB;QACvD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,2BAA2B,EAAE;gBAC3E,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;gBAC5B,WAAW,EAAE,QAAQ,CAAC,QAAQ,EAAE;gBAChC,YAAY,EAAE,QAAQ,CAAC,QAAQ,EAAE;aAClC,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,8BAA8B,MAAM,KAAK,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACvH,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,WAAW,CAAC,MAAc,EAAE,QAAgB,EAAE,cAAsB,CAAC;QAChF,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,2BAA2B,EAAE;gBAC3E,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;gBAC5B,QAAQ,EAAE,QAAQ,CAAC,QAAQ,EAAE;gBAC7B,WAAW,EAAE,WAAW,CAAC,QAAQ,EAAE;aACpC,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,+BAA+B,MAAM,KAAK,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACxH,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,aAAa,CAAC,MAAc,EAAE,UAAkB,EAAE,cAAsB,CAAC;QACpF,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,2BAA2B,EAAE;gBAC3E,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;gBAC5B,UAAU,EAAE,UAAU,CAAC,QAAQ,EAAE;gBACjC,WAAW,EAAE,WAAW,CAAC,QAAQ,EAAE;aACpC,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,iCAAiC,MAAM,KAAK,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QAC1H,CAAC;IACH,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,cAAc,CAAC,OAAe,EAAE,MAAc;QACzD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,oBAAoB,EAAE;gBACnE,QAAQ,EAAE,QAAQ;gBAClB,OAAO,EAAE,OAAO;gBAChB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;aAC7B,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,IAA4B,CAAC;YAC5D,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBACxB,MAAM,IAAI,KAAK,CAAC,SAAS,OAAO,YAAY,CAAC,CAAC;YAChD,CAAC;YAED,OAAO,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;QACpD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,+BAA+B,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QAC7G,CAAC;IACH,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,WAAW,CAAC,OAAe,EAAE,MAAc;QACtD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,kBAAkB,EAAE;gBAClE,QAAQ,EAAE,QAAQ;gBAClB,OAAO,EAAE,OAAO;gBAChB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;aAC7B,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,2BAA2B,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACzG,CAAC;IACH,CAAC;IAED;;;;OAIG;IACI,KAAK,CAAC,eAAe,CAAC,MAAc;QACzC,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,mBAAmB,EAAE;gBAClE,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE;aAC7B,EAAE,IAAI,CAAC,CAAC;YAET,IAAI,QAAQ,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,oBAAoB,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;YACzD,CAAC;YAED,MAAM,SAAS,GAAG,QAAQ,CAAC,MAAM,CAAC,IAA2B,CAAC;YAC9D,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACpD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,gCAAgC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QAC9G,CAAC;IACH,CAAC;IAED;;;;;;;OAOG;IACK,KAAK,CAAC,WAAW,CAAC,MAAsB,EAAE,QAAgB,EAAE,SAAc,EAAE,EAAE,SAAkB,KAAK;QAC3G,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;QACxC,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC,OAAO,GAAG,QAAQ,EAAE,CAAC;QACvC,IAAI,IAAI,GAAG,EAAE,CAAC;QAEd,kBAAkB;QAClB,MAAM,OAAO,GAAQ;YACnB,cAAc,EAAE,kBAAkB;YAClC,kBAAkB,EAAE,SAAS;YAC7B,oBAAoB,EAAE,MAAM;SAC7B,CAAC;QAEF,IAAI,MAAM,EAAE,CAAC;YACX,OAAO,CAAC,gBAAgB,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1C,CAAC;QAED,uBAAuB;QACvB,IAAI,MAAM,KAAK,KAAK,EAAE,CAAC;YACrB,MAAM,WAAW,GAAG,IAAI,eAAe,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,CAAC;YAC3D,IAAI,WAAW,EAAE,CAAC;gBAChB,GAAG,IAAI,IAAI,WAAW,EAAE,CAAC;YAC3B,CAAC;QACH,CAAC;aAAM,CAAC;YACN,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC;QAED,gDAAgD;QAChD,IAAI,MAAM,EAAE,CAAC;YACX,MAAM,gBAAgB,GAAG,SAAS,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,MAAM,KAAK,KAAK,CAAC,CAAC,CAAC,IAAI,eAAe,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;YAC/H,OAAO,CAAC,aAAa,CAAC,GAAG,IAAA,mBAAU,EAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACvG,CAAC;QAED,IAAI,CAAC;YACH,MAAM,UAAU,GAAG,IAAI,eAAe,EAAE,CAAC;YACzC,MAAM,SAAS,GAAG,UAAU,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,KAAK,EAAE,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YAE7E,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAChC,MAAM;gBACN,OAAO;gBACP,IAAI,EAAE,MAAM,KAAK,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS;gBAC1C,MAAM,EAAE,UAAU,CAAC,MAAM;aAC1B,CAAC,CAAC;YAEH,YAAY,CAAC,SAAS,CAAC,CAAC;YAExB,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;gBACjB,MAAM,IAAI,KAAK,CAAC,QAAQ,QAAQ,CAAC,MAAM,KAAK,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC;YACrE,CAAC;YAED,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;QAC/B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;gBAC1D,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;YACrC,CAAC;YACD,MAAM,IAAI,KAAK,CAAC,mBAAmB,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACjG,CAAC;IACH,CAAC;IAED;;;;OAIG;IACK,eAAe,CAAC,QAAgB;QACtC,MAAM,WAAW,GAA8B;YAC7C,IAAI,EAAE,GAAG;YACT,IAAI,EAAE,GAAG;YACT,KAAK,EAAE,IAAI;YACX,KAAK,EAAE,IAAI;YACX,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,KAAK;YACX,IAAI,EAAE,GAAG;YACT,IAAI,EAAE,GAAG;YACT,IAAI,EAAE,GAAG;YACT,IAAI,EAAE,GAAG;SACV,CAAC;QAEF,OAAO,WAAW,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC;IAC3C,CAAC;IAED;;;;OAIG;IACK,cAAc,CAAC,WAAmB;QACxC,MAAM,SAAS,GAAmC;YAChD,KAAK,EAAE,KAAK;YACZ,iBAAiB,EAAE,kBAAkB;YACrC,QAAQ,EAAE,QAAQ;YAClB,WAAW,EAAE,WAAW;YACxB,UAAU,EAAE,UAAU;YACtB,yBAAyB,EAAE,WAAW;YACtC,aAAa,EAAE,WAAW;SAC3B,CAAC;QAEF,OAAO,SAAS,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC;IACzC,CAAC;IAED;;;;OAIG;IACK,YAAY,CAAI,GAAW;QACjC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAClC,IAAI,CAAC,KAAK;YAAE,OAAO,IAAI,CAAC;QAExB,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QACvB,IAAI,GAAG,GAAG,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC;YACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACvB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,KAAK,CAAC,IAAS,CAAC;IACzB,CAAC;IAED;;;;;OAKG;IACK,QAAQ,CAAI,GAAW,EAAE,IAAO,EAAE,GAAW;QACnD,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE;YAClB,IAAI;YACJ,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;YACrB,GAAG;SACJ,CAAC,CAAC;IACL,CAAC;IAED;;;;OAIG;IACK,KAAK,CAAC,EAAU;QACtB,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;IACzD,CAAC;IAED;;OAEG;IACI,UAAU;QACf,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC;IAED;;;OAGG;IACI,YAAY;QACjB,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;IACzB,CAAC;CACF;AAriBD,4CAqiBC","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/exchanges/BybitPerpsClient.ts"],"sourcesContent":["/**\n * Bybit Perpetuals Client for Execution Target\n * \n * Provides REST API methods for order execution, data fetching, and account management.\n * Includes HMAC signature generation, caching, and retry logic.\n * \n * Requirements: 7.1-7.7 (Execution), 11.1-11.7 (Multi-Timeframe Data)\n */\n\nimport { createHmac } from 'crypto';\nimport { OHLCV, OrderParams, OrderResult, OrderStatus } from '../types';\n\nexport interface BybitSymbolInfo {\n  symbol: string;\n  baseCoin: string;\n  quoteCoin: string;\n  status: string;\n  marginTrading: string;\n  lotSizeFilter: {\n    basePrecision: string;\n    quotePrecision: string;\n    minOrderQty: string;\n    maxOrderQty: string;\n    minOrderAmt: string;\n    maxOrderAmt: string;\n  };\n  priceFilter: {\n    minPrice: string;\n    maxPrice: string;\n    tickSize: string;\n  };\n}\n\nexport interface BybitTickerInfo {\n  symbol: string;\n  bid1Price: string;\n  bid1Size: string;\n  ask1Price: string;\n  ask1Size: string;\n  lastPrice: string;\n  prevPrice24h: string;\n  price24hPcnt: string;\n  highPrice24h: string;\n  lowPrice24h: string;\n  turnover24h: string;\n  volume24h: string;\n}\n\nexport interface BybitKlineData {\n  symbol: string;\n  category: string;\n  list: string[][]; // [startTime, openPrice, highPrice, lowPrice, closePrice, volume, turnover]\n}\n\nexport interface BybitOrderResponse {\n  orderId: string;\n  orderLinkId: string;\n  symbol: string;\n  createTime: string;\n  updateTime: string;\n  side: string;\n  orderType: string;\n  qty: string;\n  price: string;\n  orderStatus: string;\n  timeInForce: string;\n  avgPrice: string;\n  leavesQty: string;\n  leavesValue: string;\n  cumExecQty: string;\n  cumExecValue: string;\n  cumExecFee: string;\n  rejectReason: string;\n}\n\nexport interface BybitAccountInfo {\n  totalEquity: string;\n  totalWalletBalance: string;\n  totalMarginBalance: string;\n  totalAvailableBalance: string;\n  totalPerpUPL: string;\n  totalInitialMargin: string;\n  totalMaintenanceMargin: string;\n  coin: Array<{\n    coin: string;\n    equity: string;\n    usdValue: string;\n    walletBalance: string;\n    availableToWithdraw: string;\n    availableToBorrow: string;\n    borrowAmount: string;\n    accruedInterest: string;\n    totalOrderIM: string;\n    totalPositionIM: string;\n    totalPositionMM: string;\n    unrealisedPnl: string;\n    cumRealisedPnl: string;\n  }>;\n}\n\nexport interface BybitPositionInfo {\n  symbol: string;\n  leverage: string;\n  avgPrice: string;\n  liqPrice: string;\n  riskLimitValue: string;\n  takeProfit: string;\n  stopLoss: string;\n  trailingStop: string;\n  unrealisedPnl: string;\n  cumRealisedPnl: string;\n  positionMM: string;\n  positionIM: string;\n  positionValue: string;\n  positionBalance: string;\n  size: string;\n  side: string;\n  positionStatus: string;\n  markPrice: string;\n  bustPrice: string;\n  positionIdx: number;\n  tradeMode: number;\n}\n\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n  ttl: number;\n}\n\nexport class BybitPerpsClient {\n  private baseUrl = 'https://api.bybit.com';\n  private apiKey: string;\n  private apiSecret: string;\n  private cache = new Map<string, CacheEntry<any>>();\n  private readonly CACHE_TTL = 5 * 60 * 1000; // 5 minutes\n  private readonly REQUEST_TIMEOUT = 10000; // 10 seconds\n  private readonly RETRY_ATTEMPTS = 3;\n  private readonly RETRY_DELAY = 1000; // 1 second\n\n  constructor(apiKey: string, apiSecret: string) {\n    this.apiKey = apiKey;\n    this.apiSecret = apiSecret;\n  }\n\n  /**\n   * Fetch top symbols by 24h volume (top 100)\n   * @returns Promise with array of symbol names\n   */\n  public async fetchTopSymbols(): Promise<string[]> {\n    const cacheKey = 'top_symbols';\n    const cached = this.getFromCache<string[]>(cacheKey);\n    if (cached) return cached;\n\n    try {\n      const response = await this.makeRequest('GET', '/v5/market/tickers', {\n        category: 'linear'\n      });\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      // Sort by 24h volume and take top 100\n      const tickers = response.result.list as BybitTickerInfo[];\n      const sortedSymbols = tickers\n        .filter(ticker => ticker.symbol.endsWith('USDT'))\n        .sort((a, b) => parseFloat(b.turnover24h) - parseFloat(a.turnover24h))\n        .slice(0, 100)\n        .map(ticker => ticker.symbol);\n\n      this.setCache(cacheKey, sortedSymbols, this.CACHE_TTL);\n      return sortedSymbols;\n    } catch (error) {\n      throw new Error(`Failed to fetch top symbols: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Fetch OHLCV data with caching (5-minute TTL)\n   * @param symbol - Trading symbol (e.g., 'BTCUSDT')\n   * @param interval - Timeframe ('1', '5', '15', '30', '60', '240', '1440')\n   * @param limit - Number of candles (max 1000)\n   * @returns Promise with OHLCV array\n   */\n  public async fetchOHLCV(symbol: string, interval: string, limit: number = 200): Promise<OHLCV[]> {\n    const cacheKey = `ohlcv_${symbol}_${interval}_${limit}`;\n    const cached = this.getFromCache<OHLCV[]>(cacheKey);\n    if (cached) return cached;\n\n    try {\n      // Convert interval to Bybit format\n      const bybitInterval = this.convertInterval(interval);\n      \n      const response = await this.makeRequest('GET', '/v5/market/kline', {\n        category: 'linear',\n        symbol: symbol.toUpperCase(),\n        interval: bybitInterval,\n        limit: Math.min(limit, 1000).toString()\n      });\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const klineData = response.result as BybitKlineData;\n      const ohlcv: OHLCV[] = klineData.list.map(candle => ({\n        timestamp: parseInt(candle[0]),\n        open: parseFloat(candle[1]),\n        high: parseFloat(candle[2]),\n        low: parseFloat(candle[3]),\n        close: parseFloat(candle[4]),\n        volume: parseFloat(candle[5])\n      }));\n\n      // Sort by timestamp (oldest first)\n      ohlcv.sort((a, b) => a.timestamp - b.timestamp);\n\n      this.setCache(cacheKey, ohlcv, this.CACHE_TTL);\n      return ohlcv;\n    } catch (error) {\n      throw new Error(`Failed to fetch OHLCV for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get current price for a symbol\n   * @param symbol - Trading symbol (e.g., 'BTCUSDT')\n   * @returns Promise with current price\n   */\n  public async getCurrentPrice(symbol: string): Promise<number> {\n    try {\n      const response = await this.makeRequest('GET', '/v5/market/tickers', {\n        category: 'linear',\n        symbol: symbol.toUpperCase()\n      });\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const ticker = response.result.list[0] as BybitTickerInfo;\n      if (!ticker) {\n        throw new Error(`No ticker data found for ${symbol}`);\n      }\n\n      return parseFloat(ticker.lastPrice);\n    } catch (error) {\n      throw new Error(`Failed to get current price for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get account equity\n   * @returns Promise with total equity in USDT\n   */\n  public async getEquity(): Promise<number> {\n    try {\n      const response = await this.makeRequest('GET', '/v5/account/wallet-balance', {\n        accountType: 'UNIFIED'\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const account = response.result.list[0] as BybitAccountInfo;\n      if (!account) {\n        throw new Error('No account data found');\n      }\n\n      return parseFloat(account.totalEquity);\n    } catch (error) {\n      throw new Error(`Failed to get equity: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Place order with HMAC signature and Post-Only support\n   * @param params - Order parameters\n   * @returns Promise with order result\n   */\n  public async placeOrder(params: OrderParams): Promise<OrderResult> {\n    try {\n      const orderParams: any = {\n        category: 'linear',\n        symbol: params.symbol.toUpperCase(),\n        side: params.side,\n        orderType: params.type === 'POST_ONLY' ? 'Limit' : params.type === 'LIMIT' ? 'Limit' : 'Market',\n        qty: params.qty.toString(),\n        timeInForce: params.type === 'POST_ONLY' ? 'PostOnly' : 'GTC'\n      };\n\n      // Add price for limit orders\n      if (params.type === 'LIMIT' || params.type === 'POST_ONLY') {\n        if (!params.price) {\n          throw new Error('Price is required for limit orders');\n        }\n        orderParams.price = params.price.toString();\n      }\n\n      // Add stop loss and take profit if provided\n      if (params.stopLoss) {\n        orderParams.stopLoss = params.stopLoss.toString();\n      }\n      if (params.takeProfit) {\n        orderParams.takeProfit = params.takeProfit.toString();\n      }\n\n      const response = await this.makeRequest('POST', '/v5/order/create', orderParams, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const orderData = response.result as BybitOrderResponse;\n      \n      return {\n        orderId: orderData.orderId,\n        symbol: orderData.symbol,\n        side: orderData.side as 'Buy' | 'Sell',\n        qty: parseFloat(orderData.qty),\n        price: parseFloat(orderData.price || orderData.avgPrice || '0'),\n        status: this.mapOrderStatus(orderData.orderStatus),\n        timestamp: parseInt(orderData.createTime)\n      };\n    } catch (error) {\n      throw new Error(`Failed to place order: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Place order with retry logic (2-second timeout)\n   * @param params - Order parameters\n   * @param maxRetries - Maximum retry attempts (default: 2)\n   * @returns Promise with order result\n   */\n  public async placeOrderWithRetry(params: OrderParams, maxRetries: number = 2): Promise<OrderResult> {\n    let lastError: Error;\n\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        // Set timeout for each attempt\n        const timeoutPromise = new Promise<never>((_, reject) => {\n          setTimeout(() => reject(new Error('Order timeout after 2 seconds')), 2000);\n        });\n\n        const orderPromise = this.placeOrder(params);\n        const result = await Promise.race([orderPromise, timeoutPromise]);\n        \n        return result;\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error('Unknown error');\n        \n        if (attempt < maxRetries) {\n          console.warn(`⚠️ Order attempt ${attempt + 1} failed, retrying: ${lastError.message}`);\n          await this.sleep(this.RETRY_DELAY);\n        }\n      }\n    }\n\n    throw new Error(`Order failed after ${maxRetries + 1} attempts: ${lastError!.message}`);\n  }\n\n  /**\n   * Set leverage for a symbol\n   * @param symbol - Trading symbol\n   * @param leverage - Leverage value (1-100)\n   * @returns Promise with success status\n   */\n  public async setLeverage(symbol: string, leverage: number): Promise<boolean> {\n    try {\n      const response = await this.makeRequest('POST', '/v5/position/set-leverage', {\n        category: 'linear',\n        symbol: symbol.toUpperCase(),\n        buyLeverage: leverage.toString(),\n        sellLeverage: leverage.toString()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      return true;\n    } catch (error) {\n      throw new Error(`Failed to set leverage for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Set stop loss for a position\n   * @param symbol - Trading symbol\n   * @param stopLoss - Stop loss price\n   * @param positionIdx - Position index (0 for one-way mode)\n   * @returns Promise with success status\n   */\n  public async setStopLoss(symbol: string, stopLoss: number, positionIdx: number = 0): Promise<boolean> {\n    try {\n      const response = await this.makeRequest('POST', '/v5/position/trading-stop', {\n        category: 'linear',\n        symbol: symbol.toUpperCase(),\n        stopLoss: stopLoss.toString(),\n        positionIdx: positionIdx.toString()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      return true;\n    } catch (error) {\n      throw new Error(`Failed to set stop loss for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Set take profit for a position\n   * @param symbol - Trading symbol\n   * @param takeProfit - Take profit price\n   * @param positionIdx - Position index (0 for one-way mode)\n   * @returns Promise with success status\n   */\n  public async setTakeProfit(symbol: string, takeProfit: number, positionIdx: number = 0): Promise<boolean> {\n    try {\n      const response = await this.makeRequest('POST', '/v5/position/trading-stop', {\n        category: 'linear',\n        symbol: symbol.toUpperCase(),\n        takeProfit: takeProfit.toString(),\n        positionIdx: positionIdx.toString()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      return true;\n    } catch (error) {\n      throw new Error(`Failed to set take profit for ${symbol}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get order status\n   * @param orderId - Order ID\n   * @param symbol - Trading symbol\n   * @returns Promise with order status\n   */\n  public async getOrderStatus(orderId: string, symbol: string): Promise<OrderStatus> {\n    try {\n      const response = await this.makeRequest('GET', '/v5/order/realtime', {\n        category: 'linear',\n        orderId: orderId,\n        symbol: symbol.toUpperCase()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const orders = response.result.list as BybitOrderResponse[];\n      if (orders.length === 0) {\n        throw new Error(`Order ${orderId} not found`);\n      }\n\n      return this.mapOrderStatus(orders[0].orderStatus);\n    } catch (error) {\n      throw new Error(`Failed to get order status: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Cancel order\n   * @param orderId - Order ID\n   * @param symbol - Trading symbol\n   * @returns Promise with success status\n   */\n  public async cancelOrder(orderId: string, symbol: string): Promise<boolean> {\n    try {\n      const response = await this.makeRequest('POST', '/v5/order/cancel', {\n        category: 'linear',\n        orderId: orderId,\n        symbol: symbol.toUpperCase()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      return true;\n    } catch (error) {\n      throw new Error(`Failed to cancel order: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Get position info\n   * @param symbol - Trading symbol\n   * @returns Promise with position info\n   */\n  public async getPositionInfo(symbol: string): Promise<BybitPositionInfo | null> {\n    try {\n      const response = await this.makeRequest('GET', '/v5/position/list', {\n        category: 'linear',\n        symbol: symbol.toUpperCase()\n      }, true);\n\n      if (response.retCode !== 0) {\n        throw new Error(`Bybit API error: ${response.retMsg}`);\n      }\n\n      const positions = response.result.list as BybitPositionInfo[];\n      return positions.length > 0 ? positions[0] : null;\n    } catch (error) {\n      throw new Error(`Failed to get position info: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Make authenticated or public API request\n   * @param method - HTTP method\n   * @param endpoint - API endpoint\n   * @param params - Request parameters\n   * @param signed - Whether to sign the request\n   * @returns Promise with API response\n   */\n  private async makeRequest(method: 'GET' | 'POST', endpoint: string, params: any = {}, signed: boolean = false): Promise<any> {\n    const timestamp = Date.now().toString();\n    let url = `${this.baseUrl}${endpoint}`;\n    let body = '';\n\n    // Prepare headers\n    const headers: any = {\n      'Content-Type': 'application/json',\n      'X-BAPI-TIMESTAMP': timestamp,\n      'X-BAPI-RECV-WINDOW': '5000'\n    };\n\n    if (signed) {\n      headers['X-BAPI-API-KEY'] = this.apiKey;\n    }\n\n    // Prepare request data\n    if (method === 'GET') {\n      const queryString = new URLSearchParams(params).toString();\n      if (queryString) {\n        url += `?${queryString}`;\n      }\n    } else {\n      body = JSON.stringify(params);\n    }\n\n    // Generate signature for authenticated requests\n    if (signed) {\n      const signaturePayload = timestamp + this.apiKey + '5000' + (method === 'GET' ? new URLSearchParams(params).toString() : body);\n      headers['X-BAPI-SIGN'] = createHmac('sha256', this.apiSecret).update(signaturePayload).digest('hex');\n    }\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), this.REQUEST_TIMEOUT);\n\n      const response = await fetch(url, {\n        method,\n        headers,\n        body: method === 'POST' ? body : undefined,\n        signal: controller.signal\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      return await response.json();\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        throw new Error('Request timeout');\n      }\n      throw new Error(`Request failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Convert interval to Bybit format\n   * @param interval - Standard interval\n   * @returns Bybit interval format\n   */\n  private convertInterval(interval: string): string {\n    const intervalMap: { [key: string]: string } = {\n      '1m': '1',\n      '5m': '5',\n      '15m': '15',\n      '30m': '30',\n      '1h': '60',\n      '4h': '240',\n      '1d': 'D',\n      '1D': 'D',\n      '1w': 'W',\n      '1W': 'W'\n    };\n\n    return intervalMap[interval] || interval;\n  }\n\n  /**\n   * Map Bybit order status to standard format\n   * @param bybitStatus - Bybit order status\n   * @returns Standard order status\n   */\n  private mapOrderStatus(bybitStatus: string): OrderStatus {\n    const statusMap: { [key: string]: OrderStatus } = {\n      'New': 'NEW',\n      'PartiallyFilled': 'PARTIALLY_FILLED',\n      'Filled': 'FILLED',\n      'Cancelled': 'CANCELLED',\n      'Rejected': 'REJECTED',\n      'PartiallyFilledCanceled': 'CANCELLED',\n      'Deactivated': 'CANCELLED'\n    };\n\n    return statusMap[bybitStatus] || 'NEW';\n  }\n\n  /**\n   * Get data from cache if valid\n   * @param key - Cache key\n   * @returns Cached data or null\n   */\n  private getFromCache<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n\n    const now = Date.now();\n    if (now - entry.timestamp > entry.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.data as T;\n  }\n\n  /**\n   * Set data in cache\n   * @param key - Cache key\n   * @param data - Data to cache\n   * @param ttl - Time to live in milliseconds\n   */\n  private setCache<T>(key: string, data: T, ttl: number): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n      ttl\n    });\n  }\n\n  /**\n   * Sleep for specified milliseconds\n   * @param ms - Milliseconds to sleep\n   * @returns Promise that resolves after delay\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Clear cache\n   */\n  public clearCache(): void {\n    this.cache.clear();\n  }\n\n  /**\n   * Get cache size\n   * @returns Number of cached entries\n   */\n  public getCacheSize(): number {\n    return this.cache.size;\n  }\n}"],"version":3}