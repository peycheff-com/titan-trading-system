{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/FractalMath.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/FractalMath.test.ts"],"sourcesContent":["/**\n * Unit Tests for FractalMath Engine\n * \n * Tests all core fractal detection and market structure analysis functions\n * using known data patterns and edge cases.\n */\n\nimport { FractalMath } from '../../src/engine/FractalMath';\nimport { OHLCV, Fractal, BOS, TrendState } from '../../src/types';\n\ndescribe('FractalMath', () => {\n  // Helper function to create test OHLCV data\n  const createCandle = (timestamp: number, open: number, high: number, low: number, close: number, volume: number = 1000): OHLCV => ({\n    timestamp,\n    open,\n    high,\n    low,\n    close,\n    volume\n  });\n\n  describe('detectFractals', () => {\n    it('should detect swing high fractal', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),  // i=0\n        createCandle(2, 102, 108, 98, 106),  // i=1\n        createCandle(3, 106, 115, 104, 112), // i=2 - Swing High (115 > all neighbors)\n        createCandle(4, 112, 110, 105, 108), // i=3\n        createCandle(5, 108, 109, 103, 107)  // i=4\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      \n      expect(fractals).toHaveLength(1);\n      expect(fractals[0].type).toBe('HIGH');\n      expect(fractals[0].price).toBe(115);\n      expect(fractals[0].barIndex).toBe(2);\n      expect(fractals[0].confirmed).toBe(true);\n    });\n\n    it('should detect swing low fractal', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),  // i=0\n        createCandle(2, 102, 108, 98, 106),  // i=1\n        createCandle(3, 106, 110, 85, 88),   // i=2 - Swing Low (85 < all neighbors)\n        createCandle(4, 88, 95, 87, 92),     // i=3\n        createCandle(5, 92, 96, 90, 94)      // i=4\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      \n      // Should detect both high (110) and low (85) fractals at index 2\n      expect(fractals).toHaveLength(2);\n      const lowFractal = fractals.find(f => f.type === 'LOW');\n      expect(lowFractal).toBeDefined();\n      expect(lowFractal!.price).toBe(85);\n      expect(lowFractal!.barIndex).toBe(2);\n      expect(lowFractal!.confirmed).toBe(true);\n    });\n\n    it('should detect both high and low fractals', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),  // i=0\n        createCandle(2, 102, 108, 98, 106),  // i=1\n        createCandle(3, 106, 115, 104, 112), // i=2 - Swing High\n        createCandle(4, 112, 110, 105, 108), // i=3\n        createCandle(5, 108, 109, 103, 107), // i=4\n        createCandle(6, 107, 110, 102, 105), // i=5\n        createCandle(7, 105, 108, 85, 88),   // i=6 - Swing Low\n        createCandle(8, 88, 95, 87, 92),     // i=7\n        createCandle(9, 92, 96, 90, 94)      // i=8\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      \n      expect(fractals).toHaveLength(2);\n      expect(fractals[0].type).toBe('HIGH');\n      expect(fractals[0].price).toBe(115);\n      expect(fractals[1].type).toBe('LOW');\n      expect(fractals[1].price).toBe(85);\n    });\n\n    it('should return empty array for insufficient candles', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106)\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      expect(fractals).toHaveLength(0);\n    });\n\n    it('should not detect fractal when pattern is not met', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 110, 104, 108), // Not a fractal (110 not > 108)\n        createCandle(4, 108, 112, 105, 110),\n        createCandle(5, 110, 115, 108, 112)\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      expect(fractals).toHaveLength(0);\n    });\n  });\n\n  describe('detectBOS', () => {\n    it('should detect bullish BOS when close breaks above swing high', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 115, 104, 112), // Swing High at 115 (index 2)\n        createCandle(4, 112, 110, 105, 108),\n        createCandle(5, 108, 109, 103, 107),\n        createCandle(6, 107, 120, 105, 118)  // Close at 118 > 115 (BOS at index 5)\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      console.log('Detected fractals:', fractals);\n      \n      const bosEvents = FractalMath.detectBOS(candles, fractals);\n      console.log('BOS events:', bosEvents);\n      \n      expect(bosEvents).toHaveLength(1);\n      expect(bosEvents[0].direction).toBe('BULLISH');\n      expect(bosEvents[0].price).toBe(118);\n      expect(bosEvents[0].fractalsBreached).toHaveLength(1);\n      expect(bosEvents[0].fractalsBreached[0].price).toBe(115);\n    });\n\n    it('should detect bearish BOS when close breaks below swing low', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 110, 85, 88),   // Swing Low at 85\n        createCandle(4, 88, 95, 87, 92),\n        createCandle(5, 92, 96, 90, 94),\n        createCandle(6, 94, 90, 80, 82)      // Close at 82 < 85 (BOS)\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      const bosEvents = FractalMath.detectBOS(candles, fractals);\n      \n      expect(bosEvents).toHaveLength(1);\n      expect(bosEvents[0].direction).toBe('BEARISH');\n      expect(bosEvents[0].price).toBe(82);\n      expect(bosEvents[0].fractalsBreached).toHaveLength(1);\n      expect(bosEvents[0].fractalsBreached[0].price).toBe(85);\n    });\n\n    it('should return empty array when no fractals provided', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106)\n      ];\n\n      const bosEvents = FractalMath.detectBOS(candles, []);\n      expect(bosEvents).toHaveLength(0);\n    });\n  });\n\n  describe('detectMSS', () => {\n    it('should detect bearish MSS when bullish trend reverses', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 110, 85, 88),   // Swing Low\n        createCandle(4, 88, 95, 87, 92),\n        createCandle(5, 92, 96, 90, 94),\n        createCandle(6, 94, 90, 80, 82)      // Bearish BOS\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      const mss = FractalMath.detectMSS(candles, fractals, 'BULL');\n      \n      expect(mss).not.toBeNull();\n      expect(mss!.direction).toBe('BEARISH');\n      expect(mss!.price).toBe(82);\n      expect(mss!.significance).toBe(80);\n    });\n\n    it('should detect bullish MSS when bearish trend reverses', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 115, 104, 112), // Swing High\n        createCandle(4, 112, 110, 105, 108),\n        createCandle(5, 108, 109, 103, 107),\n        createCandle(6, 107, 120, 105, 118)  // Bullish BOS\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      const mss = FractalMath.detectMSS(candles, fractals, 'BEAR');\n      \n      expect(mss).not.toBeNull();\n      expect(mss!.direction).toBe('BULLISH');\n      expect(mss!.price).toBe(118);\n      expect(mss!.significance).toBe(80);\n    });\n\n    it('should return null when no MSS occurs', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 115, 104, 112), // Swing High\n        createCandle(4, 112, 110, 105, 108),\n        createCandle(5, 108, 109, 103, 107),\n        createCandle(6, 107, 120, 105, 118)  // Bullish BOS (same direction as trend)\n      ];\n\n      const fractals = FractalMath.detectFractals(candles);\n      const mss = FractalMath.detectMSS(candles, fractals, 'BULL'); // Same direction\n      \n      expect(mss).toBeNull();\n    });\n  });\n\n  describe('calcDealingRange', () => {\n    it('should calculate dealing range with premium/discount zones', () => {\n      const fractals: Fractal[] = [\n        {\n          type: 'HIGH',\n          price: 120,\n          barIndex: 2,\n          timestamp: 1000,\n          confirmed: true\n        },\n        {\n          type: 'LOW',\n          price: 80,\n          barIndex: 6,\n          timestamp: 2000,\n          confirmed: true\n        }\n      ];\n\n      const dealingRange = FractalMath.calcDealingRange(fractals);\n      \n      expect(dealingRange.high).toBe(120);\n      expect(dealingRange.low).toBe(80);\n      expect(dealingRange.range).toBe(40);\n      expect(dealingRange.midpoint).toBe(100); // 80 + (40 * 0.5)\n      expect(dealingRange.premiumThreshold).toBe(100);\n      expect(dealingRange.discountThreshold).toBe(100);\n    });\n\n    it('should throw error when insufficient fractals', () => {\n      expect(() => {\n        FractalMath.calcDealingRange([]);\n      }).toThrow('Insufficient fractals to calculate dealing range');\n    });\n\n    it('should handle multiple fractals and find highest/lowest', () => {\n      const fractals: Fractal[] = [\n        { type: 'HIGH', price: 110, barIndex: 1, timestamp: 1000, confirmed: true },\n        { type: 'HIGH', price: 125, barIndex: 3, timestamp: 2000, confirmed: true }, // Highest\n        { type: 'HIGH', price: 115, barIndex: 5, timestamp: 3000, confirmed: true },\n        { type: 'LOW', price: 85, barIndex: 2, timestamp: 1500, confirmed: true },\n        { type: 'LOW', price: 75, barIndex: 4, timestamp: 2500, confirmed: true },  // Lowest\n        { type: 'LOW', price: 90, barIndex: 6, timestamp: 3500, confirmed: true }\n      ];\n\n      const dealingRange = FractalMath.calcDealingRange(fractals);\n      \n      expect(dealingRange.high).toBe(125);\n      expect(dealingRange.low).toBe(75);\n      expect(dealingRange.range).toBe(50);\n      expect(dealingRange.midpoint).toBe(100); // 75 + (50 * 0.5)\n    });\n  });\n\n  describe('getTrendState', () => {\n    it('should return BULL for consistent bullish BOS', () => {\n      const bosEvents: BOS[] = [\n        {\n          direction: 'BULLISH',\n          price: 105,\n          barIndex: 3,\n          timestamp: 1000,\n          fractalsBreached: []\n        },\n        {\n          direction: 'BULLISH',\n          price: 110,\n          barIndex: 6,\n          timestamp: 2000,\n          fractalsBreached: []\n        },\n        {\n          direction: 'BULLISH',\n          price: 115,\n          barIndex: 9,\n          timestamp: 3000,\n          fractalsBreached: []\n        }\n      ];\n\n      const trendState = FractalMath.getTrendState(bosEvents);\n      expect(trendState).toBe('BULL');\n    });\n\n    it('should return BEAR for consistent bearish BOS', () => {\n      const bosEvents: BOS[] = [\n        {\n          direction: 'BEARISH',\n          price: 95,\n          barIndex: 3,\n          timestamp: 1000,\n          fractalsBreached: []\n        },\n        {\n          direction: 'BEARISH',\n          price: 90,\n          barIndex: 6,\n          timestamp: 2000,\n          fractalsBreached: []\n        },\n        {\n          direction: 'BEARISH',\n          price: 85,\n          barIndex: 9,\n          timestamp: 3000,\n          fractalsBreached: []\n        }\n      ];\n\n      const trendState = FractalMath.getTrendState(bosEvents);\n      expect(trendState).toBe('BEAR');\n    });\n\n    it('should return RANGE for mixed BOS', () => {\n      const bosEvents: BOS[] = [\n        {\n          direction: 'BULLISH',\n          price: 105,\n          barIndex: 3,\n          timestamp: 1000,\n          fractalsBreached: []\n        },\n        {\n          direction: 'BEARISH',\n          price: 95,\n          barIndex: 6,\n          timestamp: 2000,\n          fractalsBreached: []\n        }\n      ];\n\n      const trendState = FractalMath.getTrendState(bosEvents);\n      expect(trendState).toBe('RANGE');\n    });\n\n    it('should return RANGE for insufficient BOS events', () => {\n      const bosEvents: BOS[] = [\n        {\n          direction: 'BULLISH',\n          price: 105,\n          barIndex: 3,\n          timestamp: 1000,\n          fractalsBreached: []\n        }\n      ];\n\n      const trendState = FractalMath.getTrendState(bosEvents);\n      expect(trendState).toBe('RANGE');\n    });\n  });\n\n  describe('validateCandles', () => {\n    it('should validate correct OHLCV data', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102),\n        createCandle(2, 102, 108, 98, 106),\n        createCandle(3, 106, 115, 104, 112),\n        createCandle(4, 112, 118, 108, 115),\n        createCandle(5, 115, 120, 112, 118)\n      ];\n\n      expect(() => FractalMath.validateCandles(candles)).not.toThrow();\n    });\n\n    it('should throw error for insufficient candles', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 102)\n      ];\n\n      expect(() => FractalMath.validateCandles(candles, 5)).toThrow('Insufficient candles');\n    });\n\n    it('should throw error for invalid high-low relationship', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 95, 105, 102) // high < low\n      ];\n\n      expect(() => FractalMath.validateCandles(candles, 1)).toThrow('high (95) < low (105)');\n    });\n\n    it('should throw error for close outside high-low range', () => {\n      const candles: OHLCV[] = [\n        createCandle(1, 100, 105, 95, 110) // close > high\n      ];\n\n      expect(() => FractalMath.validateCandles(candles, 1)).toThrow('close (110) outside high-low range');\n    });\n  });\n\n  describe('helper methods', () => {\n    it('should get last fractal of specific type', () => {\n      const fractals: Fractal[] = [\n        { type: 'HIGH', price: 110, barIndex: 1, timestamp: 1000, confirmed: true },\n        { type: 'LOW', price: 85, barIndex: 2, timestamp: 1500, confirmed: true },\n        { type: 'HIGH', price: 125, barIndex: 3, timestamp: 2000, confirmed: true }\n      ];\n\n      const lastHigh = FractalMath.getLastFractal(fractals, 'HIGH');\n      const lastLow = FractalMath.getLastFractal(fractals, 'LOW');\n\n      expect(lastHigh?.price).toBe(125);\n      expect(lastLow?.price).toBe(85);\n    });\n\n    it('should determine price location in dealing range', () => {\n      const dealingRange = {\n        high: 120,\n        low: 80,\n        midpoint: 100,\n        premiumThreshold: 100,\n        discountThreshold: 100,\n        range: 40\n      };\n\n      expect(FractalMath.getPriceLocation(115, dealingRange)).toBe('PREMIUM');\n      expect(FractalMath.getPriceLocation(85, dealingRange)).toBe('DISCOUNT');\n      expect(FractalMath.getPriceLocation(100, dealingRange)).toBe('EQUILIBRIUM');\n    });\n  });\n});"],"version":3}