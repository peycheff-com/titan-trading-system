{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/SessionProfiler.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/SessionProfiler.ts"],"sourcesContent":["/**\n * SessionProfiler - Time & Price Dynamics Engine\n * \n * Exploits the \"Judas Swing\" (false moves) at London/NY opens to catch \n * manipulation-to-distribution transitions. Identifies session-based \n * trading opportunities and manages time-based logic.\n * \n * Requirements: 2.1-2.7 (Session Profiler)\n */\n\nimport { EventEmitter } from 'events';\nimport { \n  SessionType, \n  SessionState, \n  AsianRange, \n  JudasSwing,\n  OHLCV \n} from '../types';\n\nexport class SessionProfiler extends EventEmitter {\n  private asianRange: AsianRange | null = null;\n  private londonRange: { high: number; low: number; timestamp: number } | null = null;\n  private currentSession: SessionState | null = null;\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Get current session state based on UTC time\n   * Requirements: 2.1 (Session identification)\n   */\n  getSessionState(): SessionState {\n    const now = new Date();\n    const utcHour = now.getUTCHours();\n    const utcMinute = now.getUTCMinutes();\n    const currentTime = utcHour + utcMinute / 60;\n\n    let sessionType: SessionType;\n    let startTime: number;\n    let endTime: number;\n\n    // Asian session: 00:00 - 06:00 UTC (Accumulation phase)\n    if (currentTime >= 0 && currentTime < 6) {\n      sessionType = 'ASIAN';\n      startTime = 0;\n      endTime = 6;\n    }\n    // London session: 07:00 - 10:00 UTC (Manipulation phase)\n    else if (currentTime >= 7 && currentTime < 10) {\n      sessionType = 'LONDON';\n      startTime = 7;\n      endTime = 10;\n    }\n    // NY session: 13:00 - 16:00 UTC (Distribution phase)\n    else if (currentTime >= 13 && currentTime < 16) {\n      sessionType = 'NY';\n      startTime = 13;\n      endTime = 16;\n    }\n    // Dead Zone: 21:00 - 01:00 UTC (Low volume)\n    else {\n      sessionType = 'DEAD_ZONE';\n      startTime = 21;\n      endTime = 1; // Next day\n    }\n\n    // Calculate time remaining in current session\n    let timeRemaining: number;\n    if (sessionType === 'DEAD_ZONE') {\n      // Handle overnight session\n      if (currentTime >= 21) {\n        timeRemaining = (24 - currentTime) + 1; // Until 01:00 next day\n      } else {\n        timeRemaining = 1 - currentTime; // Until 01:00\n      }\n    } else {\n      timeRemaining = endTime - currentTime;\n    }\n\n    const sessionState: SessionState = {\n      type: sessionType,\n      startTime,\n      endTime,\n      timeRemaining: Math.max(0, timeRemaining)\n    };\n\n    // Check for session transition\n    if (!this.currentSession || this.currentSession.type !== sessionType) {\n      this.handleSessionTransition(sessionState);\n    }\n\n    this.currentSession = sessionState;\n    return sessionState;\n  }\n\n  /**\n   * Check if current time is within tradeable killzone\n   * Requirements: 2.6 (Killzone checking)\n   */\n  isKillzone(): boolean {\n    const sessionState = this.getSessionState();\n    \n    // Only London and NY sessions are killzones\n    return sessionState.type === 'LONDON' || sessionState.type === 'NY';\n  }\n\n  /**\n   * Store Asian range as reference levels for London manipulation\n   * Requirements: 2.2 (Asian range storage)\n   */\n  storeAsianRange(ohlcvData: OHLCV[]): void {\n    if (ohlcvData.length === 0) {\n      return;\n    }\n\n    // Find high and low during Asian session (00:00-06:00 UTC)\n    let high = -Infinity;\n    let low = Infinity;\n    let timestamp = 0;\n\n    for (const candle of ohlcvData) {\n      const candleDate = new Date(candle.timestamp);\n      const utcHour = candleDate.getUTCHours();\n      \n      // Check if candle is within Asian session\n      if (utcHour >= 0 && utcHour < 6) {\n        if (candle.high > high) {\n          high = candle.high;\n        }\n        if (candle.low < low) {\n          low = candle.low;\n        }\n        timestamp = Math.max(timestamp, candle.timestamp);\n      }\n    }\n\n    if (high !== -Infinity && low !== Infinity) {\n      this.asianRange = {\n        high,\n        low,\n        timestamp\n      };\n    }\n  }\n\n  /**\n   * Detect Judas Swing at session opens\n   * Requirements: 2.3, 2.4, 2.5 (Judas Swing detection)\n   */\n  detectJudasSwing(currentPrice: number, sessionType: SessionType): JudasSwing | null {\n    // London session: Hunt for Asian range sweep\n    if (sessionType === 'LONDON' && this.asianRange) {\n      // Check for sweep of Asian High\n      if (currentPrice > this.asianRange.high) {\n        return {\n          type: 'SWEEP_HIGH',\n          sweptPrice: this.asianRange.high,\n          reversalPrice: this.asianRange.low,\n          direction: 'SHORT', // Expect reversal down after sweep\n          confidence: 75\n        };\n      }\n      \n      // Check for sweep of Asian Low\n      if (currentPrice < this.asianRange.low) {\n        return {\n          type: 'SWEEP_LOW',\n          sweptPrice: this.asianRange.low,\n          reversalPrice: this.asianRange.high,\n          direction: 'LONG', // Expect reversal up after sweep\n          confidence: 75\n        };\n      }\n    }\n\n    // NY session: Hunt for London range sweep\n    if (sessionType === 'NY' && this.londonRange) {\n      // Check for sweep of London High\n      if (currentPrice > this.londonRange.high) {\n        return {\n          type: 'SWEEP_HIGH',\n          sweptPrice: this.londonRange.high,\n          reversalPrice: this.londonRange.low,\n          direction: 'SHORT',\n          confidence: 80 // Higher confidence for NY session\n        };\n      }\n      \n      // Check for sweep of London Low\n      if (currentPrice < this.londonRange.low) {\n        return {\n          type: 'SWEEP_LOW',\n          sweptPrice: this.londonRange.low,\n          reversalPrice: this.londonRange.high,\n          direction: 'LONG',\n          confidence: 80\n        };\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get stored Asian range\n   */\n  getAsianRange(): AsianRange | null {\n    return this.asianRange;\n  }\n\n  /**\n   * Get stored London range\n   */\n  getLondonRange(): { high: number; low: number; timestamp: number } | null {\n    return this.londonRange;\n  }\n\n  /**\n   * Update London range during London session\n   */\n  updateLondonRange(ohlcvData: OHLCV[]): void {\n    if (ohlcvData.length === 0) {\n      return;\n    }\n\n    // Find high and low during London session (07:00-10:00 UTC)\n    let high = -Infinity;\n    let low = Infinity;\n    let timestamp = 0;\n\n    for (const candle of ohlcvData) {\n      const candleDate = new Date(candle.timestamp);\n      const utcHour = candleDate.getUTCHours();\n      \n      // Check if candle is within London session\n      if (utcHour >= 7 && utcHour < 10) {\n        if (candle.high > high) {\n          high = candle.high;\n        }\n        if (candle.low < low) {\n          low = candle.low;\n        }\n        timestamp = Math.max(timestamp, candle.timestamp);\n      }\n    }\n\n    if (high !== -Infinity && low !== Infinity) {\n      this.londonRange = {\n        high,\n        low,\n        timestamp\n      };\n    }\n  }\n\n  /**\n   * Check if we should disable new entries (Dead Zone)\n   * Requirements: 2.6 (Dead zone restrictions)\n   */\n  shouldDisableNewEntries(): boolean {\n    const sessionState = this.getSessionState();\n    return sessionState.type === 'DEAD_ZONE';\n  }\n\n  /**\n   * Get session statistics for display\n   */\n  getSessionStats(): {\n    currentSession: SessionType;\n    timeRemaining: number;\n    asianRange: AsianRange | null;\n    londonRange: { high: number; low: number; timestamp: number } | null;\n    isKillzone: boolean;\n  } {\n    const sessionState = this.getSessionState();\n    \n    return {\n      currentSession: sessionState.type,\n      timeRemaining: sessionState.timeRemaining,\n      asianRange: this.asianRange,\n      londonRange: this.londonRange,\n      isKillzone: this.isKillzone()\n    };\n  }\n\n  /**\n   * Handle session transition and emit events\n   * Requirements: 2.7 (Session transition events)\n   */\n  private handleSessionTransition(newSession: SessionState): void {\n    const previousSession = this.currentSession?.type;\n    \n    // Emit session change event with reference levels\n    this.emit('SESSION_CHANGE', {\n      previousSession,\n      newSession: newSession.type,\n      asianRange: this.asianRange,\n      londonRange: this.londonRange,\n      timestamp: Date.now()\n    });\n  }\n}"],"version":3}