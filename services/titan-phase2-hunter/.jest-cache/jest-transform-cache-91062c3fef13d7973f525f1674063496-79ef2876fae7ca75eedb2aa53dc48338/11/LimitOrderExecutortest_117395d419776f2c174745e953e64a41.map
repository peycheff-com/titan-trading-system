{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/LimitOrderExecutor.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/tests/unit/LimitOrderExecutor.test.ts"],"sourcesContent":["/**\n * Unit Tests for LimitOrderExecutor\n * \n * Tests core functionality including:\n * - Position sizing calculation\n * - Stop and target calculation\n * - ATR calculation\n * - Order monitoring logic\n */\n\nimport { LimitOrderExecutor } from '../../src/execution/LimitOrderExecutor';\nimport { BybitPerpsClient } from '../../src/exchanges/BybitPerpsClient';\nimport { OHLCV, OrderBlock, SignalData } from '../../src/types';\n\n// Mock BybitPerpsClient\njest.mock('../../src/exchanges/BybitPerpsClient');\n\ndescribe('LimitOrderExecutor', () => {\n  let executor: LimitOrderExecutor;\n  let mockBybitClient: jest.Mocked<BybitPerpsClient>;\n\n  beforeEach(() => {\n    mockBybitClient = new BybitPerpsClient('test-key', 'test-secret') as jest.Mocked<BybitPerpsClient>;\n    executor = new LimitOrderExecutor(mockBybitClient);\n  });\n\n  afterEach(() => {\n    executor.destroy();\n  });\n\n  describe('setStopAndTarget', () => {\n    it('should calculate correct stop and target for LONG position', () => {\n      const entryPrice = 50000;\n      const direction = 'LONG';\n\n      const result = executor.setStopAndTarget(entryPrice, direction);\n\n      // 1.5% stop loss below entry\n      expect(result.stopLoss).toBe(50000 * (1 - 0.015)); // 49250\n      \n      // 4.5% take profit above entry\n      expect(result.takeProfit).toBe(50000 * (1 + 0.045)); // 52250\n      \n      // Verify 3:1 risk-reward ratio\n      const risk = entryPrice - result.stopLoss;\n      const reward = result.takeProfit - entryPrice;\n      const riskRewardRatio = reward / risk;\n      \n      expect(riskRewardRatio).toBeCloseTo(3, 1);\n    });\n\n    it('should calculate correct stop and target for SHORT position', () => {\n      const entryPrice = 50000;\n      const direction = 'SHORT';\n\n      const result = executor.setStopAndTarget(entryPrice, direction);\n\n      // 1.5% stop loss above entry\n      expect(result.stopLoss).toBe(50000 * (1 + 0.015)); // 50750\n      \n      // 4.5% take profit below entry\n      expect(result.takeProfit).toBe(50000 * (1 - 0.045)); // 47750\n      \n      // Verify 3:1 risk-reward ratio\n      const risk = result.stopLoss - entryPrice;\n      const reward = entryPrice - result.takeProfit;\n      const riskRewardRatio = reward / risk;\n      \n      expect(riskRewardRatio).toBeCloseTo(3, 1);\n    });\n  });\n\n  describe('calcPositionSize', () => {\n    beforeEach(() => {\n      // Mock OHLCV data for ATR calculation\n      const mockCandles: OHLCV[] = [];\n      for (let i = 0; i < 20; i++) {\n        mockCandles.push({\n          timestamp: Date.now() - (i * 3600000), // 1 hour intervals\n          open: 50000 + Math.random() * 1000,\n          high: 50500 + Math.random() * 1000,\n          low: 49500 + Math.random() * 1000,\n          close: 50000 + Math.random() * 1000,\n          volume: 1000000\n        });\n      }\n      \n      mockBybitClient.fetchOHLCV.mockResolvedValue(mockCandles);\n    });\n\n    it('should calculate position size based on volatility and risk', async () => {\n      const symbol = 'BTCUSDT';\n      const entryPrice = 50000;\n      const equity = 10000; // $10,000 equity\n      const leverage = 3;\n\n      const positionSize = await executor.calcPositionSize(symbol, entryPrice, equity, leverage);\n\n      expect(positionSize).toBeGreaterThan(0);\n      expect(positionSize).toBeGreaterThan(0.001); // Minimum position size\n      expect(mockBybitClient.fetchOHLCV).toHaveBeenCalledWith(symbol, '1h', 24);\n    });\n\n    it('should handle insufficient candle data', async () => {\n      const symbol = 'BTCUSDT';\n      const entryPrice = 50000;\n      const equity = 10000;\n      const leverage = 3;\n\n      // Mock insufficient data\n      mockBybitClient.fetchOHLCV.mockResolvedValue([]);\n\n      await expect(executor.calcPositionSize(symbol, entryPrice, equity, leverage))\n        .rejects.toThrow('Insufficient candle data for ATR calculation');\n    });\n  });\n\n  describe('cancelIfPriceMoves', () => {\n    it('should cancel order when price moves > 0.2%', async () => {\n      const orderId = 'test-order-123';\n      const symbol = 'BTCUSDT';\n      const entryPrice = 50000;\n      const orderBlock: OrderBlock = {\n        type: 'BULLISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      // Start monitoring the order\n      executor['startOrderMonitoring'](orderId, symbol, entryPrice, orderBlock);\n\n      // Mock successful cancellation\n      mockBybitClient.cancelOrder.mockResolvedValue(true);\n\n      // Price moves 0.3% away (should trigger cancellation)\n      const currentPrice = 50150; // 0.3% above entry\n      const result = await executor.cancelIfPriceMoves(orderId, currentPrice);\n\n      expect(result).toBe(true);\n      expect(mockBybitClient.cancelOrder).toHaveBeenCalledWith(orderId, symbol);\n    });\n\n    it('should not cancel order when price moves < 0.2%', async () => {\n      const orderId = 'test-order-123';\n      const symbol = 'BTCUSDT';\n      const entryPrice = 50000;\n      const orderBlock: OrderBlock = {\n        type: 'BULLISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      // Start monitoring the order\n      executor['startOrderMonitoring'](orderId, symbol, entryPrice, orderBlock);\n\n      // Price moves 0.1% away (should not trigger cancellation)\n      const currentPrice = 50050; // 0.1% above entry\n      const result = await executor.cancelIfPriceMoves(orderId, currentPrice);\n\n      expect(result).toBe(false);\n      expect(mockBybitClient.cancelOrder).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('cancelIfLevelFails', () => {\n    it('should cancel bullish order when price wicks below OB low > 0.5%', async () => {\n      const orderId = 'test-order-123';\n      const symbol = 'BTCUSDT';\n      const entryPrice = 49900;\n      const orderBlock: OrderBlock = {\n        type: 'BULLISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      // Start monitoring the order\n      executor['startOrderMonitoring'](orderId, symbol, entryPrice, orderBlock);\n\n      // Mock successful cancellation\n      mockBybitClient.cancelOrder.mockResolvedValue(true);\n\n      // Current candle wicks 0.6% below OB low\n      const currentCandle: OHLCV = {\n        timestamp: Date.now(),\n        open: 49900,\n        high: 50000,\n        low: 49600, // 0.6% below OB low (49900)\n        close: 49800,\n        volume: 1000000\n      };\n\n      const result = await executor.cancelIfLevelFails(orderId, currentCandle);\n\n      expect(result).toBe(true);\n      expect(mockBybitClient.cancelOrder).toHaveBeenCalledWith(orderId, symbol);\n    });\n\n    it('should cancel bearish order when price wicks above OB high > 0.5%', async () => {\n      const orderId = 'test-order-123';\n      const symbol = 'BTCUSDT';\n      const entryPrice = 50100;\n      const orderBlock: OrderBlock = {\n        type: 'BEARISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      // Start monitoring the order\n      executor['startOrderMonitoring'](orderId, symbol, entryPrice, orderBlock);\n\n      // Mock successful cancellation\n      mockBybitClient.cancelOrder.mockResolvedValue(true);\n\n      // Current candle wicks 0.6% above OB high\n      const currentCandle: OHLCV = {\n        timestamp: Date.now(),\n        open: 50100,\n        high: 50400, // 0.6% above OB high (50100)\n        low: 50000,\n        close: 50200,\n        volume: 1000000\n      };\n\n      const result = await executor.cancelIfLevelFails(orderId, currentCandle);\n\n      expect(result).toBe(true);\n      expect(mockBybitClient.cancelOrder).toHaveBeenCalledWith(orderId, symbol);\n    });\n\n    it('should not cancel order when wick is < 0.5%', async () => {\n      const orderId = 'test-order-123';\n      const symbol = 'BTCUSDT';\n      const entryPrice = 49900;\n      const orderBlock: OrderBlock = {\n        type: 'BULLISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      // Start monitoring the order\n      executor['startOrderMonitoring'](orderId, symbol, entryPrice, orderBlock);\n\n      // Current candle wicks 0.3% below OB low (should not cancel)\n      const currentCandle: OHLCV = {\n        timestamp: Date.now(),\n        open: 49900,\n        high: 50000,\n        low: 49750, // 0.3% below OB low\n        close: 49800,\n        volume: 1000000\n      };\n\n      const result = await executor.cancelIfLevelFails(orderId, currentCandle);\n\n      expect(result).toBe(false);\n      expect(mockBybitClient.cancelOrder).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('placePostOnlyOrder', () => {\n    it('should place Post-Only order at Order Block level', async () => {\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'LONG',\n        hologramStatus: 'A+',\n        alignmentScore: 85,\n        rsScore: 0.05,\n        sessionType: 'LONDON',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 90,\n        entryPrice: 49900,\n        stopLoss: 49250,\n        takeProfit: 52250,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const orderBlock: OrderBlock = {\n        type: 'BULLISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      const equity = 10000;\n\n      // Mock successful order placement\n      mockBybitClient.placeOrderWithRetry.mockResolvedValue({\n        orderId: 'test-order-123',\n        symbol: 'BTCUSDT',\n        side: 'Buy',\n        qty: 0.1,\n        price: 49900,\n        status: 'NEW',\n        timestamp: Date.now()\n      });\n\n      // Mock OHLCV data for position sizing\n      const mockCandles: OHLCV[] = [];\n      for (let i = 0; i < 20; i++) {\n        mockCandles.push({\n          timestamp: Date.now() - (i * 3600000),\n          open: 50000,\n          high: 50500,\n          low: 49500,\n          close: 50000,\n          volume: 1000000\n        });\n      }\n      mockBybitClient.fetchOHLCV.mockResolvedValue(mockCandles);\n\n      const result = await executor.placePostOnlyOrder(signal, orderBlock, equity);\n\n      expect(result.success).toBe(true);\n      expect(result.orderId).toBe('test-order-123');\n      expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          phase: 'phase2',\n          symbol: 'BTCUSDT',\n          side: 'Buy',\n          type: 'POST_ONLY',\n          price: 49900, // Order Block low for LONG\n          leverage: 3\n        }),\n        2 // maxRetries\n      );\n    });\n\n    it('should place SHORT order at Order Block high', async () => {\n      const signal: SignalData = {\n        symbol: 'BTCUSDT',\n        direction: 'SHORT',\n        hologramStatus: 'A+',\n        alignmentScore: 85,\n        rsScore: -0.05,\n        sessionType: 'NY',\n        poiType: 'ORDER_BLOCK',\n        cvdConfirmation: true,\n        confidence: 90,\n        entryPrice: 50100,\n        stopLoss: 50750,\n        takeProfit: 47750,\n        positionSize: 0.1,\n        leverage: 3,\n        timestamp: Date.now()\n      };\n\n      const orderBlock: OrderBlock = {\n        type: 'BEARISH',\n        high: 50100,\n        low: 49900,\n        barIndex: 100,\n        timestamp: Date.now(),\n        mitigated: false,\n        confidence: 90\n      };\n\n      const equity = 10000;\n\n      // Mock successful order placement\n      mockBybitClient.placeOrderWithRetry.mockResolvedValue({\n        orderId: 'test-order-456',\n        symbol: 'BTCUSDT',\n        side: 'Sell',\n        qty: 0.1,\n        price: 50100,\n        status: 'NEW',\n        timestamp: Date.now()\n      });\n\n      // Mock OHLCV data for position sizing\n      const mockCandles: OHLCV[] = [];\n      for (let i = 0; i < 20; i++) {\n        mockCandles.push({\n          timestamp: Date.now() - (i * 3600000),\n          open: 50000,\n          high: 50500,\n          low: 49500,\n          close: 50000,\n          volume: 1000000\n        });\n      }\n      mockBybitClient.fetchOHLCV.mockResolvedValue(mockCandles);\n\n      const result = await executor.placePostOnlyOrder(signal, orderBlock, equity);\n\n      expect(result.success).toBe(true);\n      expect(result.orderId).toBe('test-order-456');\n      expect(mockBybitClient.placeOrderWithRetry).toHaveBeenCalledWith(\n        expect.objectContaining({\n          phase: 'phase2',\n          symbol: 'BTCUSDT',\n          side: 'Sell',\n          type: 'POST_ONLY',\n          price: 50100, // Order Block high for SHORT\n          leverage: 3\n        }),\n        2 // maxRetries\n      );\n    });\n  });\n\n  describe('ATR calculation', () => {\n    it('should calculate ATR correctly', () => {\n      // Create test candles with known True Range values\n      const candles: OHLCV[] = [\n        { timestamp: 1, open: 100, high: 110, low: 95, close: 105, volume: 1000 },\n        { timestamp: 2, open: 105, high: 115, low: 100, close: 110, volume: 1000 }, // TR = max(15, 10, 5) = 15\n        { timestamp: 3, open: 110, high: 120, low: 105, close: 115, volume: 1000 }, // TR = max(15, 10, 5) = 15\n        { timestamp: 4, open: 115, high: 125, low: 110, close: 120, volume: 1000 }, // TR = max(15, 10, 5) = 15\n      ];\n\n      // Use private method via bracket notation\n      const atr = executor['calculateATR'](candles, 3);\n\n      // ATR should be average of last 3 True Ranges = (15 + 15 + 15) / 3 = 15\n      expect(atr).toBe(15);\n    });\n\n    it('should throw error for insufficient data', () => {\n      const candles: OHLCV[] = [\n        { timestamp: 1, open: 100, high: 110, low: 95, close: 105, volume: 1000 }\n      ];\n\n      expect(() => {\n        executor['calculateATR'](candles, 14);\n      }).toThrow('Insufficient data for ATR calculation');\n    });\n  });\n});"],"version":3}