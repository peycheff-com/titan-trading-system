{"file":"/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/CVDValidator.ts","mappings":";AAAA;;;;;;;;;;;;;GAaG;;;AAYH,MAAa,YAAY;IACf,YAAY,GAA4B,IAAI,GAAG,EAAE,CAAC;IACzC,iBAAiB,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,aAAa;IACjD,aAAa,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,gCAAgC;IAEhF;;;;;;;OAOG;IACH,OAAO,CAAC,MAAkB,EAAE,WAAmB,IAAI,CAAC,aAAa;QAC/D,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,CAAC;QACrC,MAAM,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,CAAC;QAEzD,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,KAAK,MAAM,KAAK,IAAI,YAAY,EAAE,CAAC;YACjC,MAAM,MAAM,GAAG,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,gBAAgB;YAExD,IAAI,KAAK,CAAC,YAAY,EAAE,CAAC;gBACvB,+DAA+D;gBAC/D,GAAG,IAAI,MAAM,CAAC;YAChB,CAAC;iBAAM,CAAC;gBACN,+DAA+D;gBAC/D,GAAG,IAAI,MAAM,CAAC;YAChB,CAAC;QACH,CAAC;QAED,OAAO,GAAG,CAAC;IACb,CAAC;IAED;;;;;;;;OAQG;IACH,gBAAgB,CAAC,MAAgB,EAAE,SAAmB;QACpD,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC9C,OAAO,IAAI,CAAC;QACd,CAAC;QAED,0CAA0C;QAC1C,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAErC,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE7C,oCAAoC;QACpC,MAAM,aAAa,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;QAEzC,mCAAmC;QACnC,MAAM,YAAY,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhD,IAAI,aAAa,IAAI,YAAY,EAAE,CAAC;YAClC,8DAA8D;YAC9D,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;YAC3C,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACtE,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,SAAS,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;YAE3D,OAAO,CAAC,GAAG,CAAC,wCAAwC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAElI,OAAO;gBACL,KAAK,EAAE,EAAE;gBACT,QAAQ,EAAE,IAAI;gBACd,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;gBACrB,UAAU,EAAE,QAAQ;aACrB,CAAC;QACJ,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;;;;;OAQG;IACH,kBAAkB,CAAC,MAAgB,EAAE,SAAmB;QACtD,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC9C,OAAO,IAAI,CAAC;QACd,CAAC;QAED,0CAA0C;QAC1C,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAErC,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE7C,sCAAsC;QACtC,MAAM,eAAe,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;QAE3C,mCAAmC;QACnC,MAAM,YAAY,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhD,IAAI,eAAe,IAAI,YAAY,EAAE,CAAC;YACpC,gEAAgE;YAChE,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;YAC3C,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACtE,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,SAAS,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;YAE3D,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAEpI,OAAO;gBACL,KAAK,EAAE,EAAE;gBACT,QAAQ,EAAE,IAAI;gBACd,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;gBACrB,UAAU,EAAE,QAAQ;aACrB,CAAC;QACJ,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;;;;;OAQG;IACH,eAAe,CAAC,GAAQ,EAAE,aAAgC,IAAI,EAAE,eAAoC,IAAI;QACtG,IAAI,oBAAoB,GAAG,CAAC,CAAC;QAE7B,uCAAuC;QACvC,IAAI,MAAM,IAAI,GAAG,EAAE,CAAC;YAClB,wCAAwC;YACxC,IAAI,GAAG,CAAC,IAAI,KAAK,SAAS,EAAE,CAAC;gBAC3B,IAAI,UAAU,EAAE,CAAC;oBACf,qDAAqD;oBACrD,oBAAoB,IAAI,EAAE,CAAC;oBAC3B,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;gBAC7D,CAAC;qBAAM,IAAI,YAAY,EAAE,CAAC;oBACxB,sDAAsD;oBACtD,oBAAoB,IAAI,EAAE,CAAC;oBAC3B,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAC;gBAClE,CAAC;YACH,CAAC;YAED,wCAAwC;YACxC,IAAI,GAAG,CAAC,IAAI,KAAK,SAAS,EAAE,CAAC;gBAC3B,IAAI,YAAY,EAAE,CAAC;oBACjB,uDAAuD;oBACvD,oBAAoB,IAAI,EAAE,CAAC;oBAC3B,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;gBAC7D,CAAC;qBAAM,IAAI,UAAU,EAAE,CAAC;oBACtB,oDAAoD;oBACpD,oBAAoB,IAAI,EAAE,CAAC;oBAC3B,OAAO,CAAC,GAAG,CAAC,kDAAkD,CAAC,CAAC;gBAClE,CAAC;YACH,CAAC;QACH,CAAC;QAED,0DAA0D;QAC1D,IAAI,UAAU,IAAI,GAAG,IAAI,CAAC,UAAU,IAAI,YAAY,CAAC,EAAE,CAAC;YACtD,oBAAoB,IAAI,EAAE,CAAC;YAC3B,OAAO,CAAC,GAAG,CAAC,+CAA+C,CAAC,CAAC;QAC/D,CAAC;QAED,OAAO,oBAAoB,CAAC;IAC9B,CAAC;IAED;;;;;OAKG;IACH,WAAW,CAAC,KAAe;QACzB,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC;YACzC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;QAC1C,CAAC;QAED,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAE,CAAC;QACrD,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEpB,0DAA0D;QAC1D,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,iBAAiB,CAAC;QACnD,MAAM,eAAe,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,CAAC;QAE7D,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;QAErD,2DAA2D;QAC3D,IAAI,eAAe,CAAC,MAAM,GAAG,IAAI,EAAE,CAAC;YAClC,OAAO,CAAC,IAAI,CAAC,8BAA8B,KAAK,CAAC,MAAM,KAAK,eAAe,CAAC,MAAM,SAAS,CAAC,CAAC;QAC/F,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACH,eAAe,CAAC,MAAc,EAAE,WAAmB,IAAI,CAAC,iBAAiB;QACvE,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QACpD,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,CAAC;QACrC,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,CAAC;IAC9C,CAAC;IAED;;;;;;OAMG;IACH,aAAa,CAAC,MAAc,EAAE,WAAmB,IAAI,CAAC,aAAa;QACjE,MAAM,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QACtD,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACxC,CAAC;IAED;;;;OAIG;IACH,YAAY,CAAC,MAAc;QACzB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IACnC,CAAC;IAED;;;;OAIG;IACH,eAAe;QACb,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC;YACjD,WAAW,IAAI,OAAO,CAAC,MAAM,CAAC;QAChC,CAAC;QAED,MAAM,WAAW,GAAG,GAAG,CAAC,WAAW,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,iBAAiB;QAEnF,OAAO;YACL,YAAY,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI;YACpC,WAAW;YACX,WAAW;SACZ,CAAC;IACJ,CAAC;CACF;AAlQD,oCAkQC","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-phase2-hunter/src/engine/CVDValidator.ts"],"sourcesContent":["/**\n * CVDValidator - Order Flow X-Ray (CVD Absorption Detection)\n * \n * Purpose: Confirm reversals by detecting limit order absorption\n * \n * Key Features:\n * - Calculate Cumulative Volume Delta from tick-level trades\n * - Detect CVD Absorption (price Lower Low, CVD Higher Low)\n * - Detect CVD Distribution (price Higher High, CVD Lower High)\n * - Validate POIs with CVD confirmation\n * - Maintain 10-minute trade history for analysis\n * \n * Requirements: 4.1-4.7 (Order Flow X-Ray)\n */\n\nimport { Trade, Absorption, Distribution, POI } from '../types';\n\nexport interface CVDTrade {\n  symbol: string;\n  price: number;\n  qty: number;\n  time: number;\n  isBuyerMaker: boolean; // true = sell order hit buy limit, false = buy order hit sell limit\n}\n\nexport class CVDValidator {\n  private tradeHistory: Map<string, CVDTrade[]> = new Map();\n  private readonly HISTORY_WINDOW_MS = 10 * 60 * 1000; // 10 minutes\n  private readonly CVD_WINDOW_MS = 5 * 60 * 1000; // 5 minutes for CVD calculation\n\n  /**\n   * Calculate Cumulative Volume Delta for a symbol\n   * CVD = Sum of (Buy Volume - Sell Volume) over time window\n   * \n   * @param trades - Array of trades for calculation\n   * @param windowMs - Time window in milliseconds (default: 5 minutes)\n   * @returns CVD value (positive = net buying, negative = net selling)\n   */\n  calcCVD(trades: CVDTrade[], windowMs: number = this.CVD_WINDOW_MS): number {\n    const cutoff = Date.now() - windowMs;\n    const recentTrades = trades.filter(t => t.time > cutoff);\n    \n    let cvd = 0;\n    for (const trade of recentTrades) {\n      const volume = trade.qty * trade.price; // Dollar volume\n      \n      if (trade.isBuyerMaker) {\n        // Buyer is maker = sell order hit buy limit = selling pressure\n        cvd -= volume;\n      } else {\n        // Seller is maker = buy order hit sell limit = buying pressure\n        cvd += volume;\n      }\n    }\n    \n    return cvd;\n  }\n\n  /**\n   * Detect CVD Absorption pattern\n   * Pattern: Price makes Lower Low but CVD makes Higher Low\n   * Indicates: Limit buy orders absorbing market sells (bullish reversal signal)\n   * \n   * @param prices - Array of recent prices (at least 3 values)\n   * @param cvdValues - Array of corresponding CVD values\n   * @returns Absorption object if pattern detected, null otherwise\n   */\n  detectAbsorption(prices: number[], cvdValues: number[]): Absorption | null {\n    if (prices.length < 3 || cvdValues.length < 3) {\n      return null;\n    }\n\n    // Get last 3 values for pattern detection\n    const p1 = prices[prices.length - 3];\n    const p2 = prices[prices.length - 2];\n    const p3 = prices[prices.length - 1];\n    \n    const cvd1 = cvdValues[cvdValues.length - 3];\n    const cvd2 = cvdValues[cvdValues.length - 2];\n    const cvd3 = cvdValues[cvdValues.length - 1];\n    \n    // Check for price Lower Low pattern\n    const priceLowerLow = p3 < p2 && p2 < p1;\n    \n    // Check for CVD Higher Low pattern\n    const cvdHigherLow = cvd3 > cvd2 && cvd2 < cvd1;\n    \n    if (priceLowerLow && cvdHigherLow) {\n      // Calculate absorption strength based on divergence magnitude\n      const priceDrop = Math.abs((p1 - p3) / p1);\n      const cvdRise = Math.abs((cvd3 - cvd2) / Math.max(Math.abs(cvd2), 1));\n      const strength = Math.min(100, (priceDrop + cvdRise) * 50);\n      \n      console.log(`ðŸ” CVD Absorption detected: Price LL ${p3.toFixed(2)}, CVD HL ${cvd3.toFixed(0)}, Strength: ${strength.toFixed(1)}`);\n      \n      return {\n        price: p3,\n        cvdValue: cvd3,\n        timestamp: Date.now(),\n        confidence: strength\n      };\n    }\n    \n    return null;\n  }\n\n  /**\n   * Detect CVD Distribution pattern\n   * Pattern: Price makes Higher High but CVD makes Lower High\n   * Indicates: Limit sell orders absorbing market buys (bearish reversal signal)\n   * \n   * @param prices - Array of recent prices (at least 3 values)\n   * @param cvdValues - Array of corresponding CVD values\n   * @returns Distribution object if pattern detected, null otherwise\n   */\n  detectDistribution(prices: number[], cvdValues: number[]): Distribution | null {\n    if (prices.length < 3 || cvdValues.length < 3) {\n      return null;\n    }\n\n    // Get last 3 values for pattern detection\n    const p1 = prices[prices.length - 3];\n    const p2 = prices[prices.length - 2];\n    const p3 = prices[prices.length - 1];\n    \n    const cvd1 = cvdValues[cvdValues.length - 3];\n    const cvd2 = cvdValues[cvdValues.length - 2];\n    const cvd3 = cvdValues[cvdValues.length - 1];\n    \n    // Check for price Higher High pattern\n    const priceHigherHigh = p3 > p2 && p2 > p1;\n    \n    // Check for CVD Lower High pattern\n    const cvdLowerHigh = cvd3 < cvd2 && cvd2 > cvd1;\n    \n    if (priceHigherHigh && cvdLowerHigh) {\n      // Calculate distribution strength based on divergence magnitude\n      const priceRise = Math.abs((p3 - p1) / p1);\n      const cvdDrop = Math.abs((cvd2 - cvd3) / Math.max(Math.abs(cvd2), 1));\n      const strength = Math.min(100, (priceRise + cvdDrop) * 50);\n      \n      console.log(`ðŸ” CVD Distribution detected: Price HH ${p3.toFixed(2)}, CVD LH ${cvd3.toFixed(0)}, Strength: ${strength.toFixed(1)}`);\n      \n      return {\n        price: p3,\n        cvdValue: cvd3,\n        timestamp: Date.now(),\n        confidence: strength\n      };\n    }\n    \n    return null;\n  }\n\n  /**\n   * Validate POI with CVD confirmation\n   * Adjusts POI confidence based on CVD absorption/distribution signals\n   * \n   * @param poi - Point of Interest to validate\n   * @param absorption - Absorption signal (if any)\n   * @param distribution - Distribution signal (if any)\n   * @returns Confidence adjustment (-30 to +30)\n   */\n  validateWithCVD(poi: POI, absorption: Absorption | null = null, distribution: Distribution | null = null): number {\n    let confidenceAdjustment = 0;\n\n    // Check if POI type matches CVD signal\n    if ('type' in poi) {\n      // For Bullish POIs (Order Blocks, FVGs)\n      if (poi.type === 'BULLISH') {\n        if (absorption) {\n          // Bullish POI + CVD Absorption = Strong confirmation\n          confidenceAdjustment += 30;\n          console.log(`âœ… CVD validates Bullish POI: +30 confidence`);\n        } else if (distribution) {\n          // Bullish POI + CVD Distribution = Conflicting signal\n          confidenceAdjustment -= 20;\n          console.log(`âŒ CVD conflicts with Bullish POI: -20 confidence`);\n        }\n      }\n      \n      // For Bearish POIs (Order Blocks, FVGs)\n      if (poi.type === 'BEARISH') {\n        if (distribution) {\n          // Bearish POI + CVD Distribution = Strong confirmation\n          confidenceAdjustment += 30;\n          console.log(`âœ… CVD validates Bearish POI: +30 confidence`);\n        } else if (absorption) {\n          // Bearish POI + CVD Absorption = Conflicting signal\n          confidenceAdjustment -= 20;\n          console.log(`âŒ CVD conflicts with Bearish POI: -20 confidence`);\n        }\n      }\n    }\n\n    // For Liquidity Pools, any CVD divergence adds confidence\n    if ('strength' in poi && (absorption || distribution)) {\n      confidenceAdjustment += 15;\n      console.log(`âœ… CVD confirms Liquidity Pool: +15 confidence`);\n    }\n\n    return confidenceAdjustment;\n  }\n\n  /**\n   * Record a trade for CVD calculation\n   * Maintains 10-minute rolling history per symbol\n   * \n   * @param trade - Trade data to record\n   */\n  recordTrade(trade: CVDTrade): void {\n    if (!this.tradeHistory.has(trade.symbol)) {\n      this.tradeHistory.set(trade.symbol, []);\n    }\n    \n    const history = this.tradeHistory.get(trade.symbol)!;\n    history.push(trade);\n    \n    // Keep only trades within the history window (10 minutes)\n    const cutoff = Date.now() - this.HISTORY_WINDOW_MS;\n    const filteredHistory = history.filter(t => t.time > cutoff);\n    \n    this.tradeHistory.set(trade.symbol, filteredHistory);\n    \n    // Log if history is getting large (performance monitoring)\n    if (filteredHistory.length > 1000) {\n      console.warn(`âš ï¸ Large trade history for ${trade.symbol}: ${filteredHistory.length} trades`);\n    }\n  }\n\n  /**\n   * Get trade history for a symbol\n   * \n   * @param symbol - Symbol to get history for\n   * @param windowMs - Time window (default: full history window)\n   * @returns Array of trades within the time window\n   */\n  getTradeHistory(symbol: string, windowMs: number = this.HISTORY_WINDOW_MS): CVDTrade[] {\n    const history = this.tradeHistory.get(symbol) || [];\n    const cutoff = Date.now() - windowMs;\n    return history.filter(t => t.time > cutoff);\n  }\n\n  /**\n   * Get current CVD value for a symbol\n   * \n   * @param symbol - Symbol to calculate CVD for\n   * @param windowMs - Time window for calculation (default: 5 minutes)\n   * @returns Current CVD value\n   */\n  getCurrentCVD(symbol: string, windowMs: number = this.CVD_WINDOW_MS): number {\n    const trades = this.getTradeHistory(symbol, windowMs);\n    return this.calcCVD(trades, windowMs);\n  }\n\n  /**\n   * Clear trade history for a symbol (cleanup)\n   * \n   * @param symbol - Symbol to clear history for\n   */\n  clearHistory(symbol: string): void {\n    this.tradeHistory.delete(symbol);\n  }\n\n  /**\n   * Get statistics about trade history\n   * \n   * @returns Object with history statistics\n   */\n  getHistoryStats(): { totalSymbols: number; totalTrades: number; memoryUsage: string } {\n    let totalTrades = 0;\n    for (const history of this.tradeHistory.values()) {\n      totalTrades += history.length;\n    }\n    \n    const memoryUsage = `${(totalTrades * 64 / 1024).toFixed(1)} KB`; // Rough estimate\n    \n    return {\n      totalSymbols: this.tradeHistory.size,\n      totalTrades,\n      memoryUsage\n    };\n  }\n}"],"version":3}