{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/monitoring/PrometheusMetrics.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/monitoring/PrometheusMetrics.ts"],"sourcesContent":["/**\n * PrometheusMetrics - Prometheus metrics exporter for Titan Brain\n * \n * Implements signal processing latency, decision approval rate,\n * database query time, and cache hit rate metrics.\n * \n * Requirements: 7.7\n */\n\nimport { PhaseId } from '../types/index.js';\n\n/**\n * Histogram bucket configuration for latency metrics\n */\nconst LATENCY_BUCKETS = [5, 10, 25, 50, 75, 100, 150, 200, 500, 1000];\n\n/**\n * Metric types\n */\nexport type MetricType = 'counter' | 'gauge' | 'histogram';\n\n/**\n * Histogram data structure\n */\nexport interface HistogramData {\n  buckets: Map<number, number>;\n  sum: number;\n  count: number;\n}\n\n/**\n * Metric definition\n */\nexport interface MetricDefinition {\n  name: string;\n  help: string;\n  type: MetricType;\n  labels?: string[];\n}\n\n/**\n * Metric value with labels\n */\nexport interface MetricValue {\n  value: number;\n  labels?: Record<string, string>;\n  timestamp?: number;\n}\n\n/**\n * PrometheusMetrics class for collecting and exporting metrics\n */\nexport class PrometheusMetrics {\n  private readonly prefix: string;\n  private readonly counters: Map<string, Map<string, number>> = new Map();\n  private readonly gauges: Map<string, Map<string, number>> = new Map();\n  private readonly histograms: Map<string, Map<string, HistogramData>> = new Map();\n  private readonly definitions: Map<string, MetricDefinition> = new Map();\n\n  constructor(prefix: string = 'titan_brain') {\n    this.prefix = prefix;\n    this.initializeMetrics();\n  }\n\n  /**\n   * Initialize all metric definitions\n   */\n  private initializeMetrics(): void {\n    // Signal processing latency histogram\n    this.defineHistogram(\n      'signal_processing_latency_ms',\n      'Signal processing latency in milliseconds',\n      ['phase_id', 'approved']\n    );\n\n    // Decision approval rate counter\n    this.defineCounter(\n      'decisions_total',\n      'Total number of decisions made',\n      ['phase_id', 'approved']\n    );\n\n    // Database query time histogram\n    this.defineHistogram(\n      'database_query_duration_ms',\n      'Database query duration in milliseconds',\n      ['operation', 'table']\n    );\n\n    // Cache hit rate counters\n    this.defineCounter(\n      'cache_requests_total',\n      'Total cache requests',\n      ['cache_name', 'result']\n    );\n\n    // Current equity gauge\n    this.defineGauge(\n      'current_equity',\n      'Current equity value',\n      []\n    );\n\n    // Allocation weights gauge\n    this.defineGauge(\n      'allocation_weight',\n      'Current allocation weight per phase',\n      ['phase_id']\n    );\n\n    // Circuit breaker status gauge\n    this.defineGauge(\n      'circuit_breaker_active',\n      'Circuit breaker active status (1=active, 0=inactive)',\n      []\n    );\n\n    // Open positions gauge\n    this.defineGauge(\n      'open_positions_count',\n      'Number of open positions',\n      ['phase_id']\n    );\n\n    // Signal queue size gauge\n    this.defineGauge(\n      'signal_queue_size',\n      'Current signal queue size',\n      []\n    );\n\n    // High watermark gauge\n    this.defineGauge(\n      'high_watermark',\n      'Current high watermark value',\n      []\n    );\n\n    // Daily drawdown gauge\n    this.defineGauge(\n      'daily_drawdown_percent',\n      'Current daily drawdown percentage',\n      []\n    );\n\n    // Leverage gauge\n    this.defineGauge(\n      'current_leverage',\n      'Current combined leverage',\n      []\n    );\n\n    // Performance modifier gauge\n    this.defineGauge(\n      'performance_modifier',\n      'Performance modifier per phase',\n      ['phase_id']\n    );\n\n    // Sharpe ratio gauge\n    this.defineGauge(\n      'sharpe_ratio',\n      'Rolling Sharpe ratio per phase',\n      ['phase_id']\n    );\n\n    // Sweep operations counter\n    this.defineCounter(\n      'sweep_operations_total',\n      'Total sweep operations',\n      ['status']\n    );\n\n    // Notification counter\n    this.defineCounter(\n      'notifications_sent_total',\n      'Total notifications sent',\n      ['channel', 'type']\n    );\n  }\n\n\n  /**\n   * Define a counter metric\n   */\n  private defineCounter(name: string, help: string, labels: string[]): void {\n    const fullName = `${this.prefix}_${name}`;\n    this.definitions.set(fullName, { name: fullName, help, type: 'counter', labels });\n    this.counters.set(fullName, new Map());\n  }\n\n  /**\n   * Define a gauge metric\n   */\n  private defineGauge(name: string, help: string, labels: string[]): void {\n    const fullName = `${this.prefix}_${name}`;\n    this.definitions.set(fullName, { name: fullName, help, type: 'gauge', labels });\n    this.gauges.set(fullName, new Map());\n  }\n\n  /**\n   * Define a histogram metric\n   */\n  private defineHistogram(name: string, help: string, labels: string[]): void {\n    const fullName = `${this.prefix}_${name}`;\n    this.definitions.set(fullName, { name: fullName, help, type: 'histogram', labels });\n    this.histograms.set(fullName, new Map());\n  }\n\n  /**\n   * Generate label key from label values\n   */\n  private getLabelKey(labels?: Record<string, string>): string {\n    if (!labels || Object.keys(labels).length === 0) return '';\n    return Object.entries(labels)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([k, v]) => `${k}=\"${v}\"`)\n      .join(',');\n  }\n\n  /**\n   * Increment a counter\n   */\n  incrementCounter(name: string, labels?: Record<string, string>, value: number = 1): void {\n    const fullName = `${this.prefix}_${name}`;\n    const counter = this.counters.get(fullName);\n    if (!counter) return;\n\n    const key = this.getLabelKey(labels);\n    const current = counter.get(key) || 0;\n    counter.set(key, current + value);\n  }\n\n  /**\n   * Set a gauge value\n   */\n  setGauge(name: string, value: number, labels?: Record<string, string>): void {\n    const fullName = `${this.prefix}_${name}`;\n    const gauge = this.gauges.get(fullName);\n    if (!gauge) return;\n\n    const key = this.getLabelKey(labels);\n    gauge.set(key, value);\n  }\n\n  /**\n   * Observe a histogram value\n   */\n  observeHistogram(name: string, value: number, labels?: Record<string, string>): void {\n    const fullName = `${this.prefix}_${name}`;\n    const histogram = this.histograms.get(fullName);\n    if (!histogram) return;\n\n    const key = this.getLabelKey(labels);\n    let data = histogram.get(key);\n    \n    if (!data) {\n      data = {\n        buckets: new Map(LATENCY_BUCKETS.map(b => [b, 0])),\n        sum: 0,\n        count: 0,\n      };\n      histogram.set(key, data);\n    }\n\n    // Update buckets\n    for (const bucket of LATENCY_BUCKETS) {\n      if (value <= bucket) {\n        data.buckets.set(bucket, (data.buckets.get(bucket) || 0) + 1);\n      }\n    }\n\n    data.sum += value;\n    data.count += 1;\n  }\n\n  // ============ Convenience Methods ============\n\n  /**\n   * Record signal processing latency\n   * Requirement 7.7: Signal processing latency metrics\n   */\n  recordSignalLatency(phaseId: PhaseId, latencyMs: number, approved: boolean): void {\n    this.observeHistogram('signal_processing_latency_ms', latencyMs, {\n      phase_id: phaseId,\n      approved: String(approved),\n    });\n    this.incrementCounter('decisions_total', {\n      phase_id: phaseId,\n      approved: String(approved),\n    });\n  }\n\n  /**\n   * Record database query time\n   * Requirement 7.7: Database query time metrics\n   */\n  recordDatabaseQuery(operation: string, table: string, durationMs: number): void {\n    this.observeHistogram('database_query_duration_ms', durationMs, {\n      operation,\n      table,\n    });\n  }\n\n  /**\n   * Record cache access\n   * Requirement 7.7: Cache hit rate metrics\n   */\n  recordCacheAccess(cacheName: string, hit: boolean): void {\n    this.incrementCounter('cache_requests_total', {\n      cache_name: cacheName,\n      result: hit ? 'hit' : 'miss',\n    });\n  }\n\n  /**\n   * Update equity gauge\n   */\n  updateEquity(equity: number): void {\n    this.setGauge('current_equity', equity);\n  }\n\n  /**\n   * Update allocation weights\n   */\n  updateAllocation(w1: number, w2: number, w3: number): void {\n    this.setGauge('allocation_weight', w1, { phase_id: 'phase1' });\n    this.setGauge('allocation_weight', w2, { phase_id: 'phase2' });\n    this.setGauge('allocation_weight', w3, { phase_id: 'phase3' });\n  }\n\n  /**\n   * Update circuit breaker status\n   */\n  updateCircuitBreakerStatus(active: boolean): void {\n    this.setGauge('circuit_breaker_active', active ? 1 : 0);\n  }\n\n  /**\n   * Update signal queue size\n   */\n  updateSignalQueueSize(size: number): void {\n    this.setGauge('signal_queue_size', size);\n  }\n\n  /**\n   * Update high watermark\n   */\n  updateHighWatermark(value: number): void {\n    this.setGauge('high_watermark', value);\n  }\n\n  /**\n   * Update daily drawdown\n   */\n  updateDailyDrawdown(percent: number): void {\n    this.setGauge('daily_drawdown_percent', percent);\n  }\n\n  /**\n   * Update leverage\n   */\n  updateLeverage(leverage: number): void {\n    this.setGauge('current_leverage', leverage);\n  }\n\n  /**\n   * Update performance metrics for a phase\n   */\n  updatePhasePerformance(phaseId: PhaseId, sharpeRatio: number, modifier: number): void {\n    this.setGauge('sharpe_ratio', sharpeRatio, { phase_id: phaseId });\n    this.setGauge('performance_modifier', modifier, { phase_id: phaseId });\n  }\n\n  /**\n   * Record sweep operation\n   */\n  recordSweepOperation(success: boolean): void {\n    this.incrementCounter('sweep_operations_total', {\n      status: success ? 'success' : 'failure',\n    });\n  }\n\n  /**\n   * Record notification sent\n   */\n  recordNotification(channel: string, type: string): void {\n    this.incrementCounter('notifications_sent_total', { channel, type });\n  }\n\n\n  // ============ Export Methods ============\n\n  /**\n   * Format labels for Prometheus output\n   */\n  private formatLabels(labelKey: string): string {\n    if (!labelKey) return '';\n    return `{${labelKey}}`;\n  }\n\n  /**\n   * Export metrics in Prometheus text format\n   */\n  export(): string {\n    const lines: string[] = [];\n\n    // Export counters\n    for (const [name, values] of this.counters) {\n      const def = this.definitions.get(name);\n      if (def) {\n        lines.push(`# HELP ${name} ${def.help}`);\n        lines.push(`# TYPE ${name} counter`);\n      }\n      for (const [labelKey, value] of values) {\n        lines.push(`${name}${this.formatLabels(labelKey)} ${value}`);\n      }\n    }\n\n    // Export gauges\n    for (const [name, values] of this.gauges) {\n      const def = this.definitions.get(name);\n      if (def) {\n        lines.push(`# HELP ${name} ${def.help}`);\n        lines.push(`# TYPE ${name} gauge`);\n      }\n      for (const [labelKey, value] of values) {\n        lines.push(`${name}${this.formatLabels(labelKey)} ${value}`);\n      }\n    }\n\n    // Export histograms\n    for (const [name, values] of this.histograms) {\n      const def = this.definitions.get(name);\n      if (def) {\n        lines.push(`# HELP ${name} ${def.help}`);\n        lines.push(`# TYPE ${name} histogram`);\n      }\n      for (const [labelKey, data] of values) {\n        const baseLabels = labelKey ? `${labelKey},` : '';\n        \n        // Export buckets\n        for (const [bucket, count] of data.buckets) {\n          lines.push(`${name}_bucket{${baseLabels}le=\"${bucket}\"} ${count}`);\n        }\n        lines.push(`${name}_bucket{${baseLabels}le=\"+Inf\"} ${data.count}`);\n        \n        // Export sum and count\n        const sumLabels = labelKey ? `{${labelKey}}` : '';\n        lines.push(`${name}_sum${sumLabels} ${data.sum}`);\n        lines.push(`${name}_count${sumLabels} ${data.count}`);\n      }\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Get metrics as JSON object\n   */\n  toJSON(): Record<string, unknown> {\n    const result: Record<string, unknown> = {};\n\n    // Counters\n    for (const [name, values] of this.counters) {\n      const shortName = name.replace(`${this.prefix}_`, '');\n      result[shortName] = Object.fromEntries(values);\n    }\n\n    // Gauges\n    for (const [name, values] of this.gauges) {\n      const shortName = name.replace(`${this.prefix}_`, '');\n      result[shortName] = Object.fromEntries(values);\n    }\n\n    // Histograms (simplified)\n    for (const [name, values] of this.histograms) {\n      const shortName = name.replace(`${this.prefix}_`, '');\n      const histData: Record<string, { sum: number; count: number; avg: number }> = {};\n      for (const [labelKey, data] of values) {\n        histData[labelKey || 'default'] = {\n          sum: data.sum,\n          count: data.count,\n          avg: data.count > 0 ? data.sum / data.count : 0,\n        };\n      }\n      result[shortName] = histData;\n    }\n\n    return result;\n  }\n\n  /**\n   * Reset all metrics\n   */\n  reset(): void {\n    for (const counter of this.counters.values()) {\n      counter.clear();\n    }\n    for (const gauge of this.gauges.values()) {\n      gauge.clear();\n    }\n    for (const histogram of this.histograms.values()) {\n      histogram.clear();\n    }\n  }\n\n  /**\n   * Get cache hit rate for a specific cache\n   */\n  getCacheHitRate(cacheName: string): number {\n    const fullName = `${this.prefix}_cache_requests_total`;\n    const counter = this.counters.get(fullName);\n    if (!counter) return 0;\n\n    const hitKey = this.getLabelKey({ cache_name: cacheName, result: 'hit' });\n    const missKey = this.getLabelKey({ cache_name: cacheName, result: 'miss' });\n    \n    const hits = counter.get(hitKey) || 0;\n    const misses = counter.get(missKey) || 0;\n    const total = hits + misses;\n\n    return total > 0 ? hits / total : 0;\n  }\n\n  /**\n   * Get average latency for signal processing\n   */\n  getAverageSignalLatency(phaseId?: PhaseId): number {\n    const fullName = `${this.prefix}_signal_processing_latency_ms`;\n    const histogram = this.histograms.get(fullName);\n    if (!histogram) return 0;\n\n    let totalSum = 0;\n    let totalCount = 0;\n\n    for (const [labelKey, data] of histogram) {\n      if (phaseId && !labelKey.includes(`phase_id=\"${phaseId}\"`)) continue;\n      totalSum += data.sum;\n      totalCount += data.count;\n    }\n\n    return totalCount > 0 ? totalSum / totalCount : 0;\n  }\n\n  /**\n   * Get decision approval rate\n   */\n  getApprovalRate(phaseId?: PhaseId): number {\n    const fullName = `${this.prefix}_decisions_total`;\n    const counter = this.counters.get(fullName);\n    if (!counter) return 0;\n\n    let approved = 0;\n    let total = 0;\n\n    for (const [labelKey, value] of counter) {\n      if (phaseId && !labelKey.includes(`phase_id=\"${phaseId}\"`)) continue;\n      \n      if (labelKey.includes('approved=\"true\"')) {\n        approved += value;\n      }\n      total += value;\n    }\n\n    return total > 0 ? approved / total : 0;\n  }\n}\n\n/**\n * Singleton instance for global metrics collection\n */\nlet metricsInstance: PrometheusMetrics | null = null;\n\n/**\n * Get or create the global metrics instance\n */\nexport function getMetrics(prefix?: string): PrometheusMetrics {\n  if (!metricsInstance) {\n    metricsInstance = new PrometheusMetrics(prefix);\n  }\n  return metricsInstance;\n}\n\n/**\n * Reset the global metrics instance (for testing)\n */\nexport function resetMetrics(): void {\n  if (metricsInstance) {\n    metricsInstance.reset();\n  }\n  metricsInstance = null;\n}\n"],"version":3}