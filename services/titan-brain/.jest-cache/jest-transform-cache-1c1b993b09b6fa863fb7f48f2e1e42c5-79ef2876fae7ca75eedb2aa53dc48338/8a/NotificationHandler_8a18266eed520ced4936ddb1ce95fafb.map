{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/server/NotificationHandler.ts","mappings":";AAAA;;;GAGG;;;AAYH;;GAEG;AACH,MAAa,wBAAwB;IAC3B,mBAAmB,CAAsB;IAEjD,YAAY,mBAAwC;QAClD,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;IACjD,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,yBAAyB,CAAC,MAAc,EAAE,MAAc;QAC5D,MAAM,IAAI,GAA+B;YACvC,MAAM;YACN,MAAM;YACN,QAAQ,EAAE,CAAC,EAAE,oCAAoC;YACjD,WAAW,EAAE,IAAI,CAAC,GAAG,EAAE;SACxB,CAAC;QAEF,MAAM,IAAI,CAAC,mBAAmB,CAAC,8BAA8B,CAAC,IAAI,CAAC,CAAC;IACtE,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,0BAA0B,CAC9B,gBAAwB,EACxB,SAAiB,EACjB,iBAA2B;QAE3B,MAAM,IAAI,GAAgC;YACxC,gBAAgB;YAChB,SAAS;YACT,iBAAiB;SAClB,CAAC;QAEF,MAAM,IAAI,CAAC,mBAAmB,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAC;IAClE,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,qBAAqB,CACzB,MAAc,EACd,UAAkB,EAClB,QAAgB,EAChB,MAAc,EACd,UAAkB;QAElB,MAAM,IAAI,GAAsB;YAC9B,MAAM;YACN,UAAU;YACV,QAAQ;YACR,MAAM;YACN,UAAU;SACX,CAAC;QAEF,MAAM,IAAI,CAAC,mBAAmB,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC;IAC7D,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,oBAAoB,CACxB,OAAgB,EAChB,QAAgB,EAChB,MAAc,EACd,MAAc,EACd,aAAqB;QAErB,MAAM,IAAI,GAAqB;YAC7B,OAAO;YACP,QAAQ;YACR,MAAM;YACN,MAAM;YACN,aAAa;SACd,CAAC;QAEF,MAAM,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;IAC5D,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,eAAe,CAAC,KAAa,EAAE,OAA6B;QAChE,MAAM,IAAI,CAAC,mBAAmB,CAAC,eAAe,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;IACjE,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,iBAAiB;QACrB,OAAO,MAAM,IAAI,CAAC,mBAAmB,CAAC,iBAAiB,EAAE,CAAC;IAC5D,CAAC;IAED;;OAEG;IACH,YAAY,CAAC,MAAW;QACtB,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAChD,CAAC;CACF;AAxGD,4DAwGC","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/server/NotificationHandler.ts"],"sourcesContent":["/**\n * Notification Handler Implementation\n * Bridges the CircuitBreaker NotificationHandler interface with the NotificationService\n */\n\nimport { NotificationHandler } from '../engine/CircuitBreaker.js';\nimport { \n  NotificationService, \n  CircuitBreakerNotification,\n  HighCorrelationNotification,\n  SweepNotification,\n  VetoNotification,\n} from './NotificationService.js';\nimport { PhaseId } from '../types/performance.js';\n\n/**\n * Concrete implementation of NotificationHandler that uses NotificationService\n */\nexport class TitanNotificationHandler implements NotificationHandler {\n  private notificationService: NotificationService;\n\n  constructor(notificationService: NotificationService) {\n    this.notificationService = notificationService;\n  }\n\n  /**\n   * Send emergency notification for circuit breaker\n   * Implementation of NotificationHandler interface\n   */\n  async sendEmergencyNotification(reason: string, equity: number): Promise<void> {\n    const data: CircuitBreakerNotification = {\n      reason,\n      equity,\n      drawdown: 0, // Will be calculated by the service\n      triggeredAt: Date.now(),\n    };\n\n    await this.notificationService.sendCircuitBreakerNotification(data);\n  }\n\n  /**\n   * Send high correlation warning\n   * Requirement 6.5: Display warning when correlation exceeds threshold\n   */\n  async sendHighCorrelationWarning(\n    correlationScore: number,\n    threshold: number,\n    affectedPositions: string[]\n  ): Promise<void> {\n    const data: HighCorrelationNotification = {\n      correlationScore,\n      threshold,\n      affectedPositions,\n    };\n\n    await this.notificationService.sendHighCorrelationWarning(data);\n  }\n\n  /**\n   * Send sweep notification\n   * Requirement 4.7: Log all sweep transactions\n   */\n  async sendSweepNotification(\n    amount: number,\n    fromWallet: string,\n    toWallet: string,\n    reason: string,\n    newBalance: number\n  ): Promise<void> {\n    const data: SweepNotification = {\n      amount,\n      fromWallet,\n      toWallet,\n      reason,\n      newBalance,\n    };\n\n    await this.notificationService.sendSweepNotification(data);\n  }\n\n  /**\n   * Send veto notification to phases\n   * Requirement 7.6: Notify originating phase when signal is vetoed\n   */\n  async sendVetoNotification(\n    phaseId: PhaseId,\n    signalId: string,\n    symbol: string,\n    reason: string,\n    requestedSize: number\n  ): Promise<void> {\n    const data: VetoNotification = {\n      phaseId,\n      signalId,\n      symbol,\n      reason,\n      requestedSize,\n    };\n\n    await this.notificationService.sendVetoNotification(data);\n  }\n\n  /**\n   * Send system error notification\n   */\n  async sendSystemError(error: string, context?: Record<string, any>): Promise<void> {\n    await this.notificationService.sendSystemError(error, context);\n  }\n\n  /**\n   * Test all notification channels\n   */\n  async testNotifications(): Promise<{ telegram: boolean; email: boolean }> {\n    return await this.notificationService.testNotifications();\n  }\n\n  /**\n   * Update notification configuration\n   */\n  updateConfig(config: any): void {\n    this.notificationService.updateConfig(config);\n  }\n}"],"version":3}