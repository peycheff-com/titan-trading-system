0e2523565f6fe7cd3af5af026095a37c
"use strict";
/**
 * Default Configuration for Titan Brain
 * Contains all default values for the system
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultConfig = void 0;
exports.loadConfigFromEnv = loadConfigFromEnv;
exports.mergeConfig = mergeConfig;
const index_js_1 = require("../types/index.js");
exports.defaultConfig = {
    brain: {
        signalTimeout: 100, // 100ms max latency
        metricUpdateInterval: 60000, // 1 minute
        dashboardCacheTTL: 5000, // 5 seconds
        maxQueueSize: 100,
    },
    allocationEngine: {
        transitionPoints: {
            startP2: 1500, // Phase 2 starts at $1,500
            fullP2: 5000, // Phase 2 full allocation at $5,000
            startP3: 25000, // Phase 3 starts at $25,000
        },
        leverageCaps: {
            [index_js_1.EquityTier.MICRO]: 20, // < $1,500: 20x max
            [index_js_1.EquityTier.SMALL]: 10, // $1,500 - $5,000: 10x max
            [index_js_1.EquityTier.MEDIUM]: 5, // $5,000 - $25,000: 5x max
            [index_js_1.EquityTier.LARGE]: 3, // $25,000 - $50,000: 3x max
            [index_js_1.EquityTier.INSTITUTIONAL]: 2, // > $50,000: 2x max
        },
    },
    performanceTracker: {
        windowDays: 7,
        minTradeCount: 10,
        malusMultiplier: 0.5,
        bonusMultiplier: 1.2,
        malusThreshold: 0,
        bonusThreshold: 2.0,
    },
    riskGuardian: {
        maxCorrelation: 0.8,
        correlationPenalty: 0.5, // 50% size reduction
        betaUpdateInterval: 300000, // 5 minutes
        correlationUpdateInterval: 300000, // 5 minutes
    },
    capitalFlow: {
        sweepThreshold: 1.2, // 20% excess triggers sweep
        reserveLimit: 200, // $200 minimum
        sweepSchedule: "0 0 * * *", // Daily at midnight UTC
        maxRetries: 3,
        retryBaseDelay: 1000, // 1 second
    },
    circuitBreaker: {
        maxDailyDrawdown: 0.15, // 15%
        minEquity: 150, // $150 (75% of $200 starting)
        consecutiveLossLimit: 3,
        consecutiveLossWindow: 3600000, // 1 hour
        cooldownMinutes: 30,
    },
    database: {
        host: "localhost",
        port: 5432,
        database: "titan_brain",
        user: "postgres",
        password: "postgres",
        maxConnections: 20,
        idleTimeout: 30000,
    },
    redis: {
        url: "redis://localhost:6379",
        maxRetries: 3,
        retryDelay: 1000,
    },
    server: {
        host: "0.0.0.0",
        port: 3100,
        corsOrigins: ["http://localhost:3000"],
    },
    notifications: {
        telegram: {
            enabled: false,
        },
        email: {
            enabled: false,
        },
    },
    services: {
        executionUrl: undefined,
    },
};
/**
 * Load configuration from environment variables
 */
function loadConfigFromEnv() {
    const config = {};
    // Database config from env
    if (process.env.DB_HOST) {
        config.database = {
            ...exports.defaultConfig.database,
            host: process.env.DB_HOST,
            port: parseInt(process.env.DB_PORT || "5432"),
            database: process.env.DB_NAME || "titan_brain",
            user: process.env.DB_USER || "postgres",
            password: process.env.DB_PASSWORD || "postgres",
        };
    }
    // Redis config from env
    if (process.env.REDIS_URL) {
        config.redis = {
            ...exports.defaultConfig.redis,
            url: process.env.REDIS_URL,
        };
    }
    // Server config from env
    if (process.env.SERVER_PORT) {
        config.server = {
            ...exports.defaultConfig.server,
            host: process.env.SERVER_HOST || "0.0.0.0",
            port: parseInt(process.env.PORT || process.env.SERVER_PORT || "3100"),
        };
    }
    // Telegram notifications from env
    if (process.env.TELEGRAM_BOT_TOKEN && process.env.TELEGRAM_CHAT_ID) {
        config.notifications = {
            ...exports.defaultConfig.notifications,
            telegram: {
                enabled: true,
                botToken: process.env.TELEGRAM_BOT_TOKEN,
                chatId: process.env.TELEGRAM_CHAT_ID,
            },
        };
    }
    return config;
}
/**
 * Merge configurations with defaults
 */
function mergeConfig(partial) {
    return {
        brain: { ...exports.defaultConfig.brain, ...partial.brain },
        allocationEngine: {
            ...exports.defaultConfig.allocationEngine,
            ...partial.allocationEngine,
        },
        performanceTracker: {
            ...exports.defaultConfig.performanceTracker,
            ...partial.performanceTracker,
        },
        riskGuardian: { ...exports.defaultConfig.riskGuardian, ...partial.riskGuardian },
        capitalFlow: { ...exports.defaultConfig.capitalFlow, ...partial.capitalFlow },
        circuitBreaker: {
            ...exports.defaultConfig.circuitBreaker,
            ...partial.circuitBreaker,
        },
        database: { ...exports.defaultConfig.database, ...partial.database },
        redis: { ...exports.defaultConfig.redis, ...partial.redis },
        server: { ...exports.defaultConfig.server, ...partial.server },
        notifications: {
            ...exports.defaultConfig.notifications,
            ...partial.notifications,
        },
        services: { ...exports.defaultConfig.services, ...partial.services },
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9jb25maWcvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBa0dILDhDQTZDQztBQUtELGtDQTRCQztBQTlLRCxnREFBaUU7QUFFcEQsUUFBQSxhQUFhLEdBQXFCO0lBQzdDLEtBQUssRUFBRTtRQUNMLGFBQWEsRUFBRSxHQUFHLEVBQUUsb0JBQW9CO1FBQ3hDLG9CQUFvQixFQUFFLEtBQUssRUFBRSxXQUFXO1FBQ3hDLGlCQUFpQixFQUFFLElBQUksRUFBRSxZQUFZO1FBQ3JDLFlBQVksRUFBRSxHQUFHO0tBQ2xCO0lBRUQsZ0JBQWdCLEVBQUU7UUFDaEIsZ0JBQWdCLEVBQUU7WUFDaEIsT0FBTyxFQUFFLElBQUksRUFBRSwyQkFBMkI7WUFDMUMsTUFBTSxFQUFFLElBQUksRUFBRSxvQ0FBb0M7WUFDbEQsT0FBTyxFQUFFLEtBQUssRUFBRSw0QkFBNEI7U0FDN0M7UUFDRCxZQUFZLEVBQUU7WUFDWixDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLG9CQUFvQjtZQUM1QyxDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLDJCQUEyQjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLDJCQUEyQjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLDRCQUE0QjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxFQUFFLG9CQUFvQjtTQUNwRDtLQUNGO0lBRUQsa0JBQWtCLEVBQUU7UUFDbEIsVUFBVSxFQUFFLENBQUM7UUFDYixhQUFhLEVBQUUsRUFBRTtRQUNqQixlQUFlLEVBQUUsR0FBRztRQUNwQixlQUFlLEVBQUUsR0FBRztRQUNwQixjQUFjLEVBQUUsQ0FBQztRQUNqQixjQUFjLEVBQUUsR0FBRztLQUNwQjtJQUVE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USxFQUFFLEVBQUUsR0FBRyxxQkFBYSxDQUFDLFFBQVEsRUFBRSxHQUFHLE9BQU8sQ0FBQyxRQUFRLEVBQUU7UUFDNUQsS0FBSyxFQUFFLEVBQUUsR0FBRyxxQkFBYSxDQUFDLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLEVBQUU7UUFDbkQsTUFBTSxFQUFFLEVBQUUsR0FBRyxxQkFBYSxDQUFDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUU7UUFDdEQsYUFBYSxFQUFFO1lBQ2IsR0FBRyxxQkFBYSxDQUFDLGFBQWE7WUFDOUIsR0FBRyxPQUFPLENBQUMsYUFBYTtTQUN6QjtRQUNELFFBQVEsRUFBRSxFQUFFLEdBQUcscUJBQWEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxPQUFPLENBQUMsUUFBUSxFQUFFO0tBQzdELENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi9zcmMvY29uZmlnL2RlZmF1bHRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGVmYXVsdCBDb25maWd1cmF0aW9uIGZvciBUaXRhbiBCcmFpblxuICogQ29udGFpbnMgYWxsIGRlZmF1bHQgdmFsdWVzIGZvciB0aGUgc3lzdGVtXG4gKi9cblxuaW1wb3J0IHsgRXF1aXR5VGllciwgVGl0YW5CcmFpbkNvbmZpZyB9IGZyb20gXCIuLi90eXBlcy9pbmRleC5qc1wiO1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbmZpZzogVGl0YW5CcmFpbkNvbmZpZyA9IHtcbiAgYnJhaW46IHtcbiAgICBzaWduYWxUaW1lb3V0OiAxMDAsIC8vIDEwMG1zIG1heCBsYXRlbmN5XG4gICAgbWV0cmljVXBkYXRlSW50ZXJ2YWw6IDYwMDAwLCAvLyAxIG1pbnV0ZVxuICAgIGRhc2hib2FyZENhY2hlVFRMOiA1MDAwLCAvLyA1IHNlY29uZHNcbiAgICBtYXhRdWV1ZVNpemU6IDEwMCxcbiAgfSxcblxuICBhbGxvY2F0aW9uRW5naW5lOiB7XG4gICAgdHJhbnNpdGlvblBvaW50czoge1xuICAgICAgc3RhcnRQMjogMTUwMCwgLy8gUGhhc2UgMiBzdGFydHMgYXQgJDEsNTAwXG4gICAgICBmdWxsUDI6IDUwMDAsIC8vIFBoYXNlIDIgZnVsbCBhbGxvY2F0aW9uIGF0ICQ1LDAwMFxuICAgICAgc3RhcnRQMzogMjUwMDAsIC8vIFBoYXNlIDMgc3RhcnRzIGF0ICQyNSwwMDBcbiAgICB9LFxuICAgIGxldmVyYWdlQ2Fwczoge1xuICAgICAgW0VxdWl0eVRpZXIuTUlDUk9dOiAyMCwgLy8gPCAkMSw1MDA6IDIweCBtYXhcbiAgICAgIFtFcXVpdHlUaWVyLlNNQUxMXTogMTAsIC8vICQxLDUwMCAtICQ1LDAwMDogMTB4IG1heFxuICAgICAgW0VxdWl0eVRpZXIuTUVESVVNXTogNSwgLy8gJDUsMDAwIC0gJDI1LDAwMDogNXggbWF4XG4gICAgICBbRXF1aXR5VGllci5MQVJHRV06IDMsIC8vICQyNSwwMDAgLSAkNTAsMDAwOiAzeCBtYXhcbiAgICAgIFtFcXVpdHlUaWVyLklOU1RJVFVUSU9OQUxdOiAyLCAvLyA+ICQ1MCwwMDA6IDJ4IG1heFxuICAgIH0sXG4gIH0sXG5cbiAgcGVyZm9ybWFuY2VUcmFja2VyOiB7XG4gICAgd2luZG93RGF5czogNyxcbiAgICBtaW5UcmFkZUNvdW50OiAxMCxcbiAgICBtYWx1c011bHRpcGxpZXI6IDAuNSxcbiAgICBib251c011bHRpcGxpZXI6IDEuMixcbiAgICBtYWx1c1RocmVzaG9sZDogMCxcbiAgICBib251c1RocmVzaG9sZDogMi4wLFxuICB9LFxuXG4gIHJpc2tHdWFyZGlhbjoge1xuICAgIG1heENvcnJlbGF0aW9uOiAwLjgsXG4gICAgY29ycmVsYXRpb25QZW5hbHR5OiAwLjUsIC8vIDUwJSBzaXplIHJlZHVjdGlvblxuICAgIGJldGFVcGRhdGVJbnRlcnZhbDogMzAwMDAwLCAvLyA1IG1pbnV0ZXNcbiAgICBjb3JyZWxhdGlvblVwZGF0ZUludGVydmFsOiAzMDAwMDAsIC8vIDUgbWludXRlc1xuICB9LFxuXG4gIGNhcGl0YWxGbG93OiB7XG4gICAgc3dlZXBUaHJlc2hvbGQ6IDEuMiwgLy8gMjAlIGV4Y2VzcyB0cmlnZ2VycyBzd2VlcFxuICAgIHJlc2VydmVMaW1pdDogMjAwLCAvLyAkMjAwIG1pbmltdW1cbiAgICBzd2VlcFNjaGVkdWxlOiBcIjAgMCAqICogKlwiLCAvLyBEYWlseSBhdCBtaWRuaWdodCBVVENcbiAgICBtYXhSZXRyaWVzOiAzLFxuICAgIHJldHJ5QmFzZURlbGF5OiAxMDAwLCAvLyAxIHNlY29uZFxuICB9LFxuXG4gIGNpcmN1aXRCcmVha2VyOiB7XG4gICAgbWF4RGFpbHlEcmF3ZG93bjogMC4xNSwgLy8gMTUlXG4gICAgbWluRXF1aXR5OiAxNTAsIC8vICQxNTAgKDc1JSBvZiAkMjAwIHN0YXJ0aW5nKVxuICAgIGNvbnNlY3V0aXZlTG9zc0xpbWl0OiAzLFxuICAgIGNvbnNlY3V0aXZlTG9zc1dpbmRvdzogMzYwMDAwMCwgLy8gMSBob3VyXG4gICAgY29vbGRvd25NaW51dGVzOiAzMCxcbiAgfSxcblxuICBkYXRhYmFzZToge1xuICAgIGhvc3Q6IFwibG9jYWxob3N0XCIsXG4gICAgcG9ydDogNTQzMixcbiAgICBkYXRhYmFzZTogXCJ0aXRhbl9icmFpblwiLFxuICAgIHVzZXI6IFwicG9zdGdyZXNcIixcbiAgICBwYXNzd29yZDogXCJwb3N0Z3Jlc1wiLFxuICAgIG1heENvbm5lY3Rpb25zOiAyMCxcbiAgICBpZGxlVGltZW91dDogMzAwMDAsXG4gIH0sXG5cbiAgcmVkaXM6IHtcbiAgICB1cmw6IFwicmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OVwiLFxuICAgIG1heFJldHJpZXM6IDMsXG4gICAgcmV0cnlEZWxheTogMTAwMCxcbiAgfSxcblxuICBzZXJ2ZXI6IHtcbiAgICBob3N0OiBcIjAuMC4wLjBcIixcbiAgICBwb3J0OiAzMTAwLFxuICAgIGNvcnNPcmlnaW5zOiBbXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIl0sXG4gIH0sXG5cbiAgbm90aWZpY2F0aW9uczoge1xuICAgIHRlbGVncmFtOiB7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LFxuICAgIGVtYWlsOiB7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LFxuICB9LFxuXG4gIHNlcnZpY2VzOiB7XG4gICAgZXhlY3V0aW9uVXJsOiB1bmRlZmluZWQsXG4gIH0sXG59O1xuXG4vKipcbiAqIExvYWQgY29uZmlndXJhdGlvbiBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZENvbmZpZ0Zyb21FbnYoKTogUGFydGlhbDxUaXRhbkJyYWluQ29uZmlnPiB7XG4gIGNvbnN0IGNvbmZpZzogUGFydGlhbDxUaXRhbkJyYWluQ29uZmlnPiA9IHt9O1xuXG4gIC8vIERhdGFiYXNlIGNvbmZpZyBmcm9tIGVudlxuICBpZiAocHJvY2Vzcy5lbnYuREJfSE9TVCkge1xuICAgIGNvbmZpZy5kYXRhYmFzZSA9IHtcbiAgICAgIC4uLmRlZmF1bHRDb25maWcuZGF0YWJhc2UsXG4gICAgICBob3N0OiBwcm9jZXNzLmVudi5EQl9IT1NULFxuICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREJfUE9SVCB8fCBcIjU0MzJcIiksXG4gICAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuREJfTkFNRSB8fCBcInRpdGFuX2JyYWluXCIsXG4gICAgICB1c2VyOiBwcm9jZXNzLmVudi5EQl9VU0VSIHx8IFwicG9zdGdyZXNcIixcbiAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5EQl9QQVNTV09SRCB8fCBcInBvc3RncmVzXCIsXG4gICAgfTtcbiAgfVxuXG4gIC8vIFJlZGlzIGNvbmZpZyBmcm9tIGVudlxuICBpZiAocHJvY2Vzcy5lbnYuUkVESVNfVVJMKSB7XG4gICAgY29uZmlnLnJlZGlzID0ge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5yZWRpcyxcbiAgICAgIHVybDogcHJvY2Vzcy5lbnYuUkVESVNfVVJMLFxuICAgIH07XG4gIH1cblxuICAvLyBTZXJ2ZXIgY29uZmlnIGZyb20gZW52XG4gIGlmIChwcm9jZXNzLmVudi5TRVJWRVJfUE9SVCkge1xuICAgIGNvbmZpZy5zZXJ2ZXIgPSB7XG4gICAgICAuLi5kZWZhdWx0Q29uZmlnLnNlcnZlcixcbiAgICAgIGhvc3Q6IHByb2Nlc3MuZW52LlNFUlZFUl9IT1NUIHx8IFwiMC4wLjAuMFwiLFxuICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuUE9SVCB8fCBwcm9jZXNzLmVudi5TRVJWRVJfUE9SVCB8fCBcIjMxMDBcIiksXG4gICAgfTtcbiAgfVxuXG4gIC8vIFRlbGVncmFtIG5vdGlmaWNhdGlvbnMgZnJvbSBlbnZcbiAgaWYgKHByb2Nlc3MuZW52LlRFTEVHUkFNX0JPVF9UT0tFTiAmJiBwcm9jZXNzLmVudi5URUxFR1JBTV9DSEFUX0lEKSB7XG4gICAgY29uZmlnLm5vdGlmaWNhdGlvbnMgPSB7XG4gICAgICAuLi5kZWZhdWx0Q29uZmlnLm5vdGlmaWNhdGlvbnMsXG4gICAgICB0ZWxlZ3JhbToge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBib3RUb2tlbjogcHJvY2Vzcy5lbnYuVEVMRUdSQU1fQk9UX1RPS0VOLFxuICAgICAgICBjaGF0SWQ6IHByb2Nlc3MuZW52LlRFTEVHUkFNX0NIQVRfSUQsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICByZXR1cm4gY29uZmlnO1xufVxuXG4vKipcbiAqIE1lcmdlIGNvbmZpZ3VyYXRpb25zIHdpdGggZGVmYXVsdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlQ29uZmlnKFxuICBwYXJ0aWFsOiBQYXJ0aWFsPFRpdGFuQnJhaW5Db25maWc+LFxuKTogVGl0YW5CcmFpbkNvbmZpZyB7XG4gIHJldHVybiB7XG4gICAgYnJhaW46IHsgLi4uZGVmYXVsdENvbmZpZy5icmFpbiwgLi4ucGFydGlhbC5icmFpbiB9LFxuICAgIGFsbG9jYXRpb25FbmdpbmU6IHtcbiAgICAgIC4uLmRlZmF1bHRDb25maWcuYWxsb2NhdGlvbkVuZ2luZSxcbiAgICAgIC4uLnBhcnRpYWwuYWxsb2NhdGlvbkVuZ2luZSxcbiAgICB9LFxuICAgIHBlcmZvcm1hbmNlVHJhY2tlcjoge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5wZXJmb3JtYW5jZVRyYWNrZXIsXG4gICAgICAuLi5wYXJ0aWFsLnBlcmZvcm1hbmNlVHJhY2tlcixcbiAgICB9LFxuICAgIHJpc2tHdWFyZGlhbjogeyAuLi5kZWZhdWx0Q29uZmlnLnJpc2tHdWFyZGlhbiwgLi4ucGFydGlhbC5yaXNrR3VhcmRpYW4gfSxcbiAgICBjYXBpdGFsRmxvdzogeyAuLi5kZWZhdWx0Q29uZmlnLmNhcGl0YWxGbG93LCAuLi5wYXJ0aWFsLmNhcGl0YWxGbG93IH0sXG4gICAgY2lyY3VpdEJyZWFrZXI6IHtcbiAgICAgIC4uLmRlZmF1bHRDb25maWcuY2lyY3VpdEJyZWFrZXIsXG4gICAgICAuLi5wYXJ0aWFsLmNpcmN1aXRCcmVha2VyLFxuICAgIH0sXG4gICAgZGF0YWJhc2U6IHsgLi4uZGVmYXVsdENvbmZpZy5kYXRhYmFzZSwgLi4ucGFydGlhbC5kYXRhYmFzZSB9LFxuICAgIHJlZGlzOiB7IC4uLmRlZmF1bHRDb25maWcucmVkaXMsIC4uLnBhcnRpYWwucmVkaXMgfSxcbiAgICBzZXJ2ZXI6IHsgLi4uZGVmYXVsdENvbmZpZy5zZXJ2ZXIsIC4uLnBhcnRpYWwuc2VydmVyIH0sXG4gICAgbm90aWZpY2F0aW9uczoge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5ub3RpZmljYXRpb25zLFxuICAgICAgLi4ucGFydGlhbC5ub3RpZmljYXRpb25zLFxuICAgIH0sXG4gICAgc2VydmljZXM6IHsgLi4uZGVmYXVsdENvbmZpZy5zZXJ2aWNlcywgLi4ucGFydGlhbC5zZXJ2aWNlcyB9LFxuICB9O1xufVxuIl0sInZlcnNpb24iOjN9