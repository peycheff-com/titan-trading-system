357f3b34d9894cfb2ba8d4411c63df8a
"use strict";
/**
 * DashboardService Unit Tests
 * Tests the dashboard data aggregation functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const DashboardService_js_1 = require("../../src/server/DashboardService.js");
// Mock implementations
const mockAllocationEngine = {
    getWeights: jest.fn(),
    getMaxLeverage: jest.fn(),
};
const mockPerformanceTracker = {
    getAllPhasePerformance: jest.fn(),
};
const mockRiskGuardian = {
    getRiskMetrics: jest.fn(),
};
const mockCapitalFlowManager = {
    getTreasuryStatus: jest.fn(),
    getNextSweepTriggerLevel: jest.fn(),
    getTotalSwept: jest.fn(),
    getHighWatermark: jest.fn(),
};
const mockCircuitBreaker = {
    getStatus: jest.fn(),
};
const mockBrain = {
    getEquity: jest.fn(),
    getPositions: jest.fn(),
    getAllPhasePerformance: jest.fn(),
    getAllApprovalRates: jest.fn(),
    getTreasuryStatus: jest.fn(),
    getNextSweepTriggerLevel: jest.fn(),
    getTotalSwept: jest.fn(),
    getHighWatermark: jest.fn(),
    getRecentDecisions: jest.fn(),
    getDashboardData: jest.fn(),
    getCircuitBreakerStatus: jest.fn(),
    getAllocation: jest.fn(),
};
describe('DashboardService', () => {
    let dashboardService;
    beforeEach(() => {
        jest.clearAllMocks();
        dashboardService = new DashboardService_js_1.DashboardService(mockBrain);
    });
    describe('calculateNAV', () => {
        it('should calculate NAV from wallet providers', async () => {
            // Mock wallet provider
            const mockWalletBalances = [
                {
                    exchange: 'bybit',
                    walletType: 'futures',
                    asset: 'USDT',
                    balance: 1000,
                    usdValue: 1000,
                },
                {
                    exchange: 'binance',
                    walletType: 'spot',
                    asset: 'USDT',
                    balance: 500,
                    usdValue: 500,
                },
            ];
            const mockProvider = jest.fn().mockResolvedValue(mockWalletBalances);
            dashboardService.registerWalletProvider('test', mockProvider);
            // Mock positions with unrealized PnL
            const mockPositions = [
                {
                    symbol: 'BTCUSDT',
                    side: 'LONG',
                    size: 100,
                    entryPrice: 50000,
                    unrealizedPnL: 50,
                    leverage: 10,
                    phaseId: 'phase1',
                },
            ];
            mockBrain.getPositions.mockReturnValue(mockPositions);
            const result = await dashboardService.calculateNAV();
            expect(result.totalNAV).toBe(1550); // 1000 + 500 + 50
            expect(result.walletBreakdown).toEqual(mockWalletBalances);
            expect(result.unrealizedPnL).toBe(50);
            expect(mockProvider).toHaveBeenCalled();
        });
        it('should handle wallet provider errors gracefully', async () => {
            const mockProvider = jest.fn().mockRejectedValue(new Error('API Error'));
            dashboardService.registerWalletProvider('test', mockProvider);
            mockBrain.getPositions.mockReturnValue([]);
            const result = await dashboardService.calculateNAV();
            expect(result.totalNAV).toBe(0);
            expect(result.walletBreakdown).toEqual([]);
            expect(result.unrealizedPnL).toBe(0);
        });
        it('should cache NAV calculation results', async () => {
            const mockProvider = jest.fn().mockResolvedValue([]);
            dashboardService.registerWalletProvider('test', mockProvider);
            mockBrain.getPositions.mockReturnValue([]);
            // First call
            await dashboardService.calculateNAV();
            expect(mockProvider).toHaveBeenCalledTimes(1);
            // Second call should use cache
            await dashboardService.calculateNAV();
            expect(mockProvider).toHaveBeenCalledTimes(1);
        });
    });
    describe('formatAllocation', () => {
        it('should format allocation vector correctly', () => {
            const allocation = {
                w1: 0.6,
                w2: 0.3,
                w3: 0.1,
                timestamp: Date.now(),
            };
            const equity = 1000;
            const result = dashboardService.formatAllocation(allocation, equity);
            expect(result.phaseEquity.phase1.weight).toBe(0.6);
            expect(result.phaseEquity.phase1.equity).toBe(600);
            expect(result.phaseEquity.phase1.percentage).toBe('60.00%');
            expect(result.phaseEquity.phase2.equity).toBe(300);
            expect(result.phaseEquity.phase3.equity).toBe(100);
            expect(result.totalEquity).toBe(1000);
        });
    });
    describe('calculatePhaseEquity', () => {
        it('should calculate phase equity correctly', () => {
            const allocation = {
                w1: 0.5,
                w2: 0.3,
                w3: 0.2,
                timestamp: Date.now(),
            };
            const equity = 2000;
            const result = dashboardService.calculatePhaseEquity(allocation, equity);
            expect(result.phase1).toBe(1000);
            expect(result.phase2).toBe(600);
            expect(result.phase3).toBe(400);
        });
    });
    describe('exportDashboardJSON', () => {
        it('should export dashboard data as JSON with metadata', async () => {
            // Mock dashboard data
            const mockDashboardData = {
                nav: 1000,
                allocation: { w1: 0.6, w2: 0.3, w3: 0.1, timestamp: Date.now() },
                version: '1.0.0',
                uptime: 60000,
            };
            // Mock the getDashboardData method
            jest.spyOn(dashboardService, 'getDashboardData').mockResolvedValue(mockDashboardData);
            const result = await dashboardService.exportDashboardJSON();
            const parsed = JSON.parse(result);
            expect(parsed.metadata).toBeDefined();
            expect(parsed.metadata.version).toBe('1.0.0');
            expect(parsed.metadata.source).toBe('titan-brain-dashboard-service');
            expect(parsed.data).toEqual(mockDashboardData);
        });
    });
    describe('cache management', () => {
        it('should clear cache correctly', () => {
            dashboardService.clearCache();
            const cacheStatus = dashboardService.getCacheStatus();
            expect(cacheStatus.dashboard.cached).toBe(false);
            expect(cacheStatus.nav.cached).toBe(false);
        });
        it('should report cache status correctly', async () => {
            // Trigger cache population
            const mockProvider = jest.fn().mockResolvedValue([]);
            dashboardService.registerWalletProvider('test', mockProvider);
            mockBrain.getPositions.mockReturnValue([]);
            await dashboardService.calculateNAV();
            const cacheStatus = dashboardService.getCacheStatus();
            expect(cacheStatus.nav.cached).toBe(true);
            expect(cacheStatus.nav.age).toBeGreaterThanOrEqual(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvRGFzaGJvYXJkU2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsOEVBQXVGO0FBaUJ2Rix1QkFBdUI7QUFDdkIsTUFBTSxvQkFBb0IsR0FBRztJQUMzQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNyQixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNLLENBQUM7QUFFakMsTUFBTSxzQkFBc0IsR0FBRztJQUM3QixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ0QsQ0FBQztBQUVuQyxNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ0MsQ0FBQztBQUU3QixNQUFNLHNCQUFzQixHQUFHO0lBQzdCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDNUIsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNuQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN4QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ0ssQ0FBQztBQUVuQyxNQUFNLGtCQUFrQixHQUFHO0lBQ3pCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ1EsQ0FBQztBQUUvQixNQUFNLFNBQVMsR0FBRztJQUNoQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNwQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN2QixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2pDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDOUIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUM1Qix3QkFBd0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ25DLGFB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QUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvRGFzaGJvYXJkU2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGFzaGJvYXJkU2VydmljZSBVbml0IFRlc3RzXG4gKiBUZXN0cyB0aGUgZGFzaGJvYXJkIGRhdGEgYWdncmVnYXRpb24gZnVuY3Rpb25hbGl0eVxuICovXG5cbmltcG9ydCB7IERhc2hib2FyZFNlcnZpY2UsIFdhbGxldEJhbGFuY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmVyL0Rhc2hib2FyZFNlcnZpY2UuanMnO1xuaW1wb3J0IHsgVGl0YW5CcmFpbiB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvVGl0YW5CcmFpbi5qcyc7XG5pbXBvcnQgeyBBbGxvY2F0aW9uRW5naW5lIH0gZnJvbSAnLi4vLi4vc3JjL2VuZ2luZS9BbGxvY2F0aW9uRW5naW5lLmpzJztcbmltcG9ydCB7IFBlcmZvcm1hbmNlVHJhY2tlciB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvUGVyZm9ybWFuY2VUcmFja2VyLmpzJztcbmltcG9ydCB7IFJpc2tHdWFyZGlhbiB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvUmlza0d1YXJkaWFuLmpzJztcbmltcG9ydCB7IENhcGl0YWxGbG93TWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvQ2FwaXRhbEZsb3dNYW5hZ2VyLmpzJztcbmltcG9ydCB7IENpcmN1aXRCcmVha2VyIH0gZnJvbSAnLi4vLi4vc3JjL2VuZ2luZS9DaXJjdWl0QnJlYWtlci5qcyc7XG5pbXBvcnQge1xuICBBbGxvY2F0aW9uVmVjdG9yLFxuICBQaGFzZVBlcmZvcm1hbmNlLFxuICBUcmVhc3VyeVN0YXR1cyxcbiAgQnJlYWtlclN0YXR1cyxcbiAgQnJhaW5EZWNpc2lvbixcbiAgUG9zaXRpb24sXG59IGZyb20gJy4uLy4uL3NyYy90eXBlcy9pbmRleC5qcyc7XG5cblxuLy8gTW9jayBpbXBsZW1lbnRhdGlvbnNcbmNvbnN0IG1vY2tBbGxvY2F0aW9uRW5naW5lID0ge1xuICBnZXRXZWlnaHRzOiBqZXN0LmZuKCksXG4gIGdldE1heExldmVyYWdlOiBqZXN0LmZuKCksXG59IGFzIHVua25vd24gYXMgQWxsb2NhdGlvbkVuZ2luZTtcblxuY29uc3QgbW9ja1BlcmZvcm1hbmNlVHJhY2tlciA9IHtcbiAgZ2V0QWxsUGhhc2VQZXJmb3JtYW5jZTogamVzdC5mbigpLFxufSBhcyB1bmtub3duIGFzIFBlcmZvcm1hbmNlVHJhY2tlcjtcblxuY29uc3QgbW9ja1Jpc2tHdWFyZGlhbiA9IHtcbiAgZ2V0Umlza01ldHJpY3M6IGplc3QuZm4oKSxcbn0gYXMgdW5rbm93biBhcyBSaXNrR3VhcmRpYW47XG5cbmNvbnN0IG1vY2tDYXBpdGFsRmxvd01hbmFnZXIgPSB7XG4gIGdldFRyZWFzdXJ5U3RhdHVzOiBqZXN0LmZuKCksXG4gIGdldE5leHRTd2VlcFRyaWdnZXJMZXZlbDogamVzdC5mbigpLFxuICBnZXRUb3RhbFN3ZXB0OiBqZXN0LmZuKCksXG4gIGdldEhpZ2hXYXRlcm1hcms6IGplc3QuZm4oKSxcbn0gYXMgdW5rbm93biBhcyBDYXBpdGFsRmxvd01hbmFnZXI7XG5cbmNvbnN0IG1vY2tDaXJjdWl0QnJlYWtlciA9IHtcbiAgZ2V0U3RhdHVzOiBqZXN0LmZuKCksXG59IGFzIHVua25vd24gYXMgQ2lyY3VpdEJyZWFrZXI7XG5cbmNvbnN0IG1vY2tCcmFpbiA9IHtcbiAgZ2V0RXF1aXR5OiBqZXN0LmZuKCksXG4gIGdldFBvc2l0aW9uczogamVzdC5mbigpLFxuICBnZXRBbGxQaGFzZVBlcmZvcm1hbmNlOiBqZXN0LmZuKCksXG4gIGdldEFsbEFwcHJvdmFsUmF0ZXM6IGplc3QuZm4oKSxcbiAgZ2V0VHJlYXN1cnlTdGF0dXM6IGplc3QuZm4oKSxcbiAgZ2V0TmV4dFN3ZWVwVHJpZ2dlckxldmVsOiBqZXN0LmZuKCksXG4gIGdldFRvdGFsU3dlcHQ6IGplc3QuZm4oKSxcbiAgZ2V0SGlnaFdhdGVybWFyazogamVzdC5mbigpLFxuICBnZXRSZWNlbnREZWNpc2lvbnM6IGplc3QuZm4oKSxcbiAgZ2V0RGFzaGJvYXJkRGF0YTogamVzdC5mbigpLFxuICBnZXRDaXJjdWl0QnJlYWtlclN0YXR1czogamVzdC5mbigpLFxuICBnZXRBbGxvY2F0aW9uOiBqZXN0LmZuKCksXG59IGFzIHVua25vd24gYXMgVGl0YW5CcmFpbjtcblxuZGVzY3JpYmUoJ0Rhc2hib2FyZFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBkYXNoYm9hcmRTZXJ2aWNlOiBEYXNoYm9hcmRTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGRhc2hib2FyZFNlcnZpY2UgPSBuZXcgRGFzaGJvYXJkU2VydmljZShtb2NrQnJhaW4pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FsY3VsYXRlTkFWJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIE5BViBmcm9tIHdhbGxldCBwcm92aWRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHdhbGxldCBwcm92aWRlclxuICAgICAgY29uc3QgbW9ja1dhbGxldEJhbGFuY2VzOiBXYWxsZXRCYWxhbmNlW10gPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBleGNoYW5nZTogJ2J5Yml0JyxcbiAgICAgICAgICB3YWxsZXRUeXBlOiAnZnV0dXJlcycsXG4gICAgICAgICAgYXNzZXQ6ICdVU0RUJyxcbiAgICAgICAgICBiYWxhbmNlOiAxMDAwLFxuICAgICAgICAgIHVzZFZhbHVlOiAxMDAwLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZXhjaGFuZ2U6ICdiaW5hbmNlJyxcbiAgICAgICAgICB3YWxsZXRUeXBlOiAnc3BvdCcsXG4gICAgICAgICAgYXNzZXQ6ICdVU0RUJyxcbiAgICAgICAgICBiYWxhbmNlOiA1MDAsXG4gICAgICAgICAgdXNkVmFsdWU6IDUwMCxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IG1vY2tQcm92aWRlciA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrV2FsbGV0QmFsYW5jZXMpO1xuICAgICAgZGFzaGJvYXJkU2VydmljZS5yZWdpc3RlcldhbGxldFByb3ZpZGVyKCd0ZXN0JywgbW9ja1Byb3ZpZGVyKTtcblxuICAgICAgLy8gTW9jayBwb3NpdGlvbnMgd2l0aCB1bnJlYWxpemVkIFBuTFxuICAgICAgY29uc3QgbW9ja1Bvc2l0aW9uczogUG9zaXRpb25bXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHN5bWJvbDogJ0JUQ1VTRFQnLFxuICAgICAgICAgIHNpZGU6ICdMT05HJyxcbiAgICAgICAgICBzaXplOiAxMDAsXG4gICAgICAgICAgZW50cnlQcmljZTogNTAwMDAsXG4gICAgICAgICAgdW5yZWFsaXplZFBuTDogNTAsXG4gICAgICAgICAgbGV2ZXJhZ2U6IDEwLFxuICAgICAgICAgIHBoYXNlSWQ6ICdwaGFzZTEnLFxuICAgICAgICB9LFxuICAgICAgXTtcbiAgICAgIChtb2NrQnJhaW4uZ2V0UG9zaXRpb25zIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tQb3NpdGlvbnMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZU5BVigpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsTkFWKS50b0JlKDE1NTApOyAvLyAxMDAwICsgNTAwICsgNTBcbiAgICAgIGV4cGVjdChyZXN1bHQud2FsbGV0QnJlYWtkb3duKS50b0VxdWFsKG1vY2tXYWxsZXRCYWxhbmNlcyk7XG4gICAgICBleHBlY3QocmVzdWx0LnVucmVhbGl6ZWRQbkwpLnRvQmUoNTApO1xuICAgICAgZXhwZWN0KG1vY2tQcm92aWRlcikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgd2FsbGV0IHByb3ZpZGVyIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Byb3ZpZGVyID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQVBJIEVycm9yJykpO1xuICAgICAgZGFzaGJvYXJkU2VydmljZS5yZWdpc3RlcldhbGxldFByb3ZpZGVyKCd0ZXN0JywgbW9ja1Byb3ZpZGVyKTtcblxuICAgICAgKG1vY2tCcmFpbi5nZXRQb3NpdGlvbnMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZU5BVigpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsTkFWKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC53YWxsZXRCcmVha2Rvd24pLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHJlc3VsdC51bnJlYWxpemVkUG5MKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWNoZSBOQVYgY2FsY3VsYXRpb24gcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm92aWRlciA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBkYXNoYm9hcmRTZXJ2aWNlLnJlZ2lzdGVyV2FsbGV0UHJvdmlkZXIoJ3Rlc3QnLCBtb2NrUHJvdmlkZXIpO1xuICAgICAgKG1vY2tCcmFpbi5nZXRQb3NpdGlvbnMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuXG4gICAgICAvLyBGaXJzdCBjYWxsXG4gICAgICBhd2FpdCBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZU5BVigpO1xuICAgICAgZXhwZWN0KG1vY2tQcm92aWRlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuXG4gICAgICAvLyBTZWNvbmQgY2FsbCBzaG91bGQgdXNlIGNhY2hlXG4gICAgICBhd2FpdCBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZU5BVigpO1xuICAgICAgZXhwZWN0KG1vY2tQcm92aWRlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybWF0QWxsb2NhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZvcm1hdCBhbGxvY2F0aW9uIHZlY3RvciBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxvY2F0aW9uOiBBbGxvY2F0aW9uVmVjdG9yID0ge1xuICAgICAgICB3MTogMC42LFxuICAgICAgICB3MjogMC4zLFxuICAgICAgICB3MzogMC4xLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgICAgY29uc3QgZXF1aXR5ID0gMTAwMDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZGFzaGJvYXJkU2VydmljZS5mb3JtYXRBbGxvY2F0aW9uKGFsbG9jYXRpb24sIGVxdWl0eSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucGhhc2VFcXVpdHkucGhhc2UxLndlaWdodCkudG9CZSgwLjYpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waGFzZUVxdWl0eS5waGFzZTEuZXF1aXR5KS50b0JlKDYwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnBoYXNlRXF1aXR5LnBoYXNlMS5wZXJjZW50YWdlKS50b0JlKCc2MC4wMCUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGhhc2VFcXVpdHkucGhhc2UyLmVxdWl0eSkudG9CZSgzMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waGFzZUVxdWl0eS5waGFzZTMuZXF1aXR5KS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsRXF1aXR5KS50b0JlKDEwMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FsY3VsYXRlUGhhc2VFcXVpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgcGhhc2UgZXF1aXR5IGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsbG9jYXRpb246IEFsbG9jYXRpb25WZWN0b3IgPSB7XG4gICAgICAgIHcxOiAwLjUsXG4gICAgICAgIHcyOiAwLjMsXG4gICAgICAgIHczOiAwLjIsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgICBjb25zdCBlcXVpdHkgPSAyMDAwO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZVBoYXNlRXF1aXR5KGFsbG9jYXRpb24sIGVxdWl0eSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucGhhc2UxKS50b0JlKDEwMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waGFzZTIpLnRvQmUoNjAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGhhc2UzKS50b0JlKDQwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdleHBvcnREYXNoYm9hcmRKU09OJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IGRhc2hib2FyZCBkYXRhIGFzIEpTT04gd2l0aCBtZXRhZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZGFzaGJvYXJkIGRhdGFcbiAgICAgIGNvbnN0IG1vY2tEYXNoYm9hcmREYXRhID0ge1xuICAgICAgICBuYXY6IDEwMDAsXG4gICAgICAgIGFsbG9jYXRpb246IHsgdzE6IDAuNiwgdzI6IDAuMywgdzM6IDAuMSwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0sXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCcsXG4gICAgICAgIHVwdGltZTogNjAwMDAsXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2NrIHRoZSBnZXREYXNoYm9hcmREYXRhIG1ldGhvZFxuICAgICAgamVzdC5zcHlPbihkYXNoYm9hcmRTZXJ2aWNlLCAnZ2V0RGFzaGJvYXJkRGF0YScpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXNoYm9hcmREYXRhIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhc2hib2FyZFNlcnZpY2UuZXhwb3J0RGFzaGJvYXJkSlNPTigpO1xuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyZXN1bHQpO1xuXG4gICAgICBleHBlY3QocGFyc2VkLm1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHBhcnNlZC5tZXRhZGF0YS52ZXJzaW9uKS50b0JlKCcxLjAuMCcpO1xuICAgICAgZXhwZWN0KHBhcnNlZC5tZXRhZGF0YS5zb3VyY2UpLnRvQmUoJ3RpdGFuLWJyYWluLWRhc2hib2FyZC1zZXJ2aWNlJyk7XG4gICAgICBleHBlY3QocGFyc2VkLmRhdGEpLnRvRXF1YWwobW9ja0Rhc2hib2FyZERhdGEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FjaGUgbWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNsZWFyIGNhY2hlIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGRhc2hib2FyZFNlcnZpY2UuY2xlYXJDYWNoZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBjYWNoZVN0YXR1cyA9IGRhc2hib2FyZFNlcnZpY2UuZ2V0Q2FjaGVTdGF0dXMoKTtcbiAgICAgIGV4cGVjdChjYWNoZVN0YXR1cy5kYXNoYm9hcmQuY2FjaGVkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChjYWNoZVN0YXR1cy5uYXYuY2FjaGVkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVwb3J0IGNhY2hlIHN0YXR1cyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUcmlnZ2VyIGNhY2hlIHBvcHVsYXRpb25cbiAgICAgIGNvbnN0IG1vY2tQcm92aWRlciA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBkYXNoYm9hcmRTZXJ2aWNlLnJlZ2lzdGVyV2FsbGV0UHJvdmlkZXIoJ3Rlc3QnLCBtb2NrUHJvdmlkZXIpO1xuICAgICAgKG1vY2tCcmFpbi5nZXRQb3NpdGlvbnMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXNoYm9hcmRTZXJ2aWNlLmNhbGN1bGF0ZU5BVigpO1xuICAgICAgXG4gICAgICBjb25zdCBjYWNoZVN0YXR1cyA9IGRhc2hib2FyZFNlcnZpY2UuZ2V0Q2FjaGVTdGF0dXMoKTtcbiAgICAgIGV4cGVjdChjYWNoZVN0YXR1cy5uYXYuY2FjaGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGNhY2hlU3RhdHVzLm5hdi5hZ2UpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9