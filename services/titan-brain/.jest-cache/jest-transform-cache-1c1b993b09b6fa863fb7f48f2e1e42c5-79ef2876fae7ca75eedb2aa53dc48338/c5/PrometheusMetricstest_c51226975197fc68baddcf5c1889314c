50246673d4301f02f5d3919a44bb861e
"use strict";
/**
 * PrometheusMetrics Tests
 *
 * Tests for Prometheus metrics collection and export functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const PrometheusMetrics_js_1 = require("../../src/monitoring/PrometheusMetrics.js");
describe('PrometheusMetrics', () => {
    let metrics;
    beforeEach(() => {
        (0, PrometheusMetrics_js_1.resetMetrics)();
        metrics = (0, PrometheusMetrics_js_1.getMetrics)('test_titan_brain');
    });
    afterEach(() => {
        (0, PrometheusMetrics_js_1.resetMetrics)();
    });
    describe('Signal Processing Metrics', () => {
        it('should record signal processing latency', () => {
            // Record some signal processing metrics
            metrics.recordSignalLatency('phase1', 50, true);
            metrics.recordSignalLatency('phase1', 75, false);
            metrics.recordSignalLatency('phase2', 25, true);
            const exported = metrics.export();
            // Check that metrics are exported
            expect(exported).toContain('test_titan_brain_signal_processing_latency_ms');
            expect(exported).toContain('test_titan_brain_decisions_total');
            expect(exported).toContain('phase_id="phase1"');
            expect(exported).toContain('phase_id="phase2"');
            expect(exported).toContain('approved="true"');
            expect(exported).toContain('approved="false"');
        });
        it('should calculate average signal latency correctly', () => {
            metrics.recordSignalLatency('phase1', 100, true);
            metrics.recordSignalLatency('phase1', 200, true);
            const avgLatency = metrics.getAverageSignalLatency('phase1');
            expect(avgLatency).toBe(150);
        });
        it('should calculate approval rate correctly', () => {
            // Record 3 approved and 2 rejected signals
            metrics.recordSignalLatency('phase1', 50, true);
            metrics.recordSignalLatency('phase1', 60, true);
            metrics.recordSignalLatency('phase1', 70, true);
            metrics.recordSignalLatency('phase1', 80, false);
            metrics.recordSignalLatency('phase1', 90, false);
            const approvalRate = metrics.getApprovalRate('phase1');
            expect(approvalRate).toBe(0.6); // 3/5 = 0.6
        });
    });
    describe('System Metrics', () => {
        it('should update equity and allocation metrics', () => {
            metrics.updateEquity(10000);
            metrics.updateAllocation(0.5, 0.3, 0.2);
            const exported = metrics.export();
            expect(exported).toContain('test_titan_brain_current_equity 10000');
            expect(exported).toContain('phase_id="phase1"} 0.5');
            expect(exported).toContain('phase_id="phase2"} 0.3');
            expect(exported).toContain('phase_id="phase3"} 0.2');
        });
        it('should update circuit breaker status', () => {
            metrics.updateCircuitBreakerStatus(true);
            const exported = metrics.export();
            expect(exported).toContain('test_titan_brain_circuit_breaker_active 1');
            metrics.updateCircuitBreakerStatus(false);
            const exported2 = metrics.export();
            expect(exported2).toContain('test_titan_brain_circuit_breaker_active 0');
        });
        it('should update performance metrics', () => {
            metrics.updatePhasePerformance('phase1', 1.5, 1.2);
            metrics.updatePhasePerformance('phase2', 0.8, 0.9);
            const exported = metrics.export();
            expect(exported).toContain('test_titan_brain_sharpe_ratio{phase_id="phase1"} 1.5');
            expect(exported).toContain('test_titan_brain_performance_modifier{phase_id="phase1"} 1.2');
            expect(exported).toContain('test_titan_brain_sharpe_ratio{phase_id="phase2"} 0.8');
            expect(exported).toContain('test_titan_brain_performance_modifier{phase_id="phase2"} 0.9');
        });
    });
    describe('Database Metrics', () => {
        it('should record database query metrics', () => {
            metrics.recordDatabaseQuery('SELECT', 'brain_decisions', 25);
            metrics.recordDatabaseQuery('INSERT', 'brain_decisions', 15);
            metrics.recordDatabaseQuery('UPDATE', 'allocation_history', 30);
            const exported = metrics.export();
            expect(exported).toContain('test_titan_brain_database_query_duration_ms');
            expect(exported).toContain('operation="SELECT"');
            expect(exported).toContain('operation="INSERT"');
            expect(exported).toContain('operation="UPDATE"');
            expect(exported).toContain('table="brain_decisions"');
            expect(exported).toContain('table="allocation_history"');
        });
    });
    describe('Cache Metrics', () => {
        it('should record cache access metrics', () => {
            // Record cache hits and misses
            metrics.recordCacheAccess('dashboard', true);
            metrics.recordCacheAccess('dashboard', true);
            metrics.recordCacheAccess('dashboard', false);
            metrics.recordCacheAccess('allocation', true);
            const exported = metrics.export();
            expect(exported).toContain('test_titan_brain_cache_requests_total');
            expect(exported).toContain('cache_name="dashboard"');
            expect(exported).toContain('cache_name="allocation"');
            expect(exported).toContain('result="hit"');
            expect(exported).toContain('result="miss"');
        });
        it('should calculate cache hit rate correctly', () => {
            // Record 3 hits and 1 miss for dashboard cache
            metrics.recordCacheAccess('dashboard', true);
            metrics.recordCacheAccess('dashboard', true);
            metrics.recordCacheAccess('dashboard', true);
            metrics.recordCacheAccess('dashboard', false);
            const hitRate = metrics.getCacheHitRate('dashboard');
            expect(hitRate).toBe(0.75); // 3/4 = 0.75
        });
    });
    describe('Export Functionality', () => {
        it('should export metrics in Prometheus format', () => {
            metrics.updateEquity(5000);
            metrics.recordSignalLatency('phase1', 100, true);
            const exported = metrics.export();
            // Check Prometheus format
            expect(exported).toContain('# HELP');
            expect(exported).toContain('# TYPE');
            expect(exported).toContain('test_titan_brain_');
            // Check that it's valid text format
            expect(typeof exported).toBe('string');
            expect(exported.length).toBeGreaterThan(0);
        });
        it('should export metrics as JSON', () => {
            metrics.updateEquity(5000);
            metrics.recordSignalLatency('phase1', 100, true);
            const json = metrics.toJSON();
            expect(typeof json).toBe('object');
            expect(json).toHaveProperty('current_equity');
            expect(json).toHaveProperty('signal_processing_latency_ms');
            expect(json).toHaveProperty('decisions_total');
        });
    });
    describe('Reset Functionality', () => {
        it('should reset all metrics', () => {
            metrics.updateEquity(5000);
            metrics.recordSignalLatency('phase1', 100, true);
            let exported = metrics.export();
            expect(exported).toContain('test_titan_brain_current_equity 5000');
            metrics.reset();
            exported = metrics.export();
            expect(exported).not.toContain('test_titan_brain_current_equity 5000');
        });
    });
    describe('Singleton Pattern', () => {
        it('should return the same instance', () => {
            const metrics1 = (0, PrometheusMetrics_js_1.getMetrics)();
            const metrics2 = (0, PrometheusMetrics_js_1.getMetrics)();
            expect(metrics1).toBe(metrics2);
        });
        it('should create new instance after reset', () => {
            const metrics1 = (0, PrometheusMetrics_js_1.getMetrics)();
            (0, PrometheusMetrics_js_1.resetMetrics)();
            const metrics2 = (0, PrometheusMetrics_js_1.getMetrics)();
            expect(metrics1).not.toBe(metrics2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvUHJvbWV0aGV1c01ldHJpY3MudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFFSCxvRkFBd0c7QUFFeEcsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLE9BQTBCLENBQUM7SUFFL0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUEsbUNBQVksR0FBRSxDQUFDO1FBQ2YsT0FBTyxHQUFHLElBQUEsaUNBQVUsRUFBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUEsbUNBQVksR0FBRSxDQUFDO0lBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUN6QyxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELHdDQUF3QztZQUN4QyxPQUFPLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRCxPQUFPLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqRCxPQUFPLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVoRCxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7WUFFbEMsa0NBQWtDO1lBQ2xDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTLENBQUMsK0NBQStDLENBQUMsQ0FBQztZQUM1RSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7WUFDL0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFD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QUMsU0FBUyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7WUFFbkUsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRWhCLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDNUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsc0NBQXNDLENBQUMsQ0FBQztRQUN6RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLE1BQU0sUUFBUSxHQUFHLElBQUEsaUNBQVUsR0FBRSxDQUFDO1lBQzlCLE1BQU0sUUFBUSxHQUFHLElBQUEsaUNBQVUsR0FBRSxDQUFDO1lBRTlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQ2hELE1BQU0sUUFBUSxHQUFHLElBQUEsaUNBQVUsR0FBRSxDQUFDO1lBQzlCLElBQUEsbUNBQVksR0FBRSxDQUFDO1lBQ2YsTUFBTSxRQUFRLEdBQUcsSUFBQSxpQ0FBVSxHQUFFLENBQUM7WUFFOUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy91bml0L1Byb21ldGhldXNNZXRyaWNzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9tZXRoZXVzTWV0cmljcyBUZXN0c1xuICogXG4gKiBUZXN0cyBmb3IgUHJvbWV0aGV1cyBtZXRyaWNzIGNvbGxlY3Rpb24gYW5kIGV4cG9ydCBmdW5jdGlvbmFsaXR5XG4gKi9cblxuaW1wb3J0IHsgUHJvbWV0aGV1c01ldHJpY3MsIGdldE1ldHJpY3MsIHJlc2V0TWV0cmljcyB9IGZyb20gJy4uLy4uL3NyYy9tb25pdG9yaW5nL1Byb21ldGhldXNNZXRyaWNzLmpzJztcblxuZGVzY3JpYmUoJ1Byb21ldGhldXNNZXRyaWNzJywgKCkgPT4ge1xuICBsZXQgbWV0cmljczogUHJvbWV0aGV1c01ldHJpY3M7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgcmVzZXRNZXRyaWNzKCk7XG4gICAgbWV0cmljcyA9IGdldE1ldHJpY3MoJ3Rlc3RfdGl0YW5fYnJhaW4nKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICByZXNldE1ldHJpY3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NpZ25hbCBQcm9jZXNzaW5nIE1ldHJpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWNvcmQgc2lnbmFsIHByb2Nlc3NpbmcgbGF0ZW5jeScsICgpID0+IHtcbiAgICAgIC8vIFJlY29yZCBzb21lIHNpZ25hbCBwcm9jZXNzaW5nIG1ldHJpY3NcbiAgICAgIG1ldHJpY3MucmVjb3JkU2lnbmFsTGF0ZW5jeSgncGhhc2UxJywgNTAsIHRydWUpO1xuICAgICAgbWV0cmljcy5yZWNvcmRTaWduYWxMYXRlbmN5KCdwaGFzZTEnLCA3NSwgZmFsc2UpO1xuICAgICAgbWV0cmljcy5yZWNvcmRTaWduYWxMYXRlbmN5KCdwaGFzZTInLCAyNSwgdHJ1ZSk7XG5cbiAgICAgIGNvbnN0IGV4cG9ydGVkID0gbWV0cmljcy5leHBvcnQoKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgdGhhdCBtZXRyaWNzIGFyZSBleHBvcnRlZFxuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Rlc3RfdGl0YW5fYnJhaW5fc2lnbmFsX3Byb2Nlc3NpbmdfbGF0ZW5jeV9tcycpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Rlc3RfdGl0YW5fYnJhaW5fZGVjaXNpb25zX3RvdGFsJyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigncGhhc2VfaWQ9XCJwaGFzZTFcIicpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3BoYXNlX2lkPVwicGhhc2UyXCInKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCdhcHByb3ZlZD1cInRydWVcIicpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ2FwcHJvdmVkPVwiZmFsc2VcIicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgYXZlcmFnZSBzaWduYWwgbGF0ZW5jeSBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDEwMCwgdHJ1ZSk7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDIwMCwgdHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGF2Z0xhdGVuY3kgPSBtZXRyaWNzLmdldEF2ZXJhZ2VTaWduYWxMYXRlbmN5KCdwaGFzZTEnKTtcbiAgICAgIGV4cGVjdChhdmdMYXRlbmN5KS50b0JlKDE1MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBhcHByb3ZhbCByYXRlIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIC8vIFJlY29yZCAzIGFwcHJvdmVkIGFuZCAyIHJlamVjdGVkIHNpZ25hbHNcbiAgICAgIG1ldHJpY3MucmVjb3JkU2lnbmFsTGF0ZW5jeSgncGhhc2UxJywgNTAsIHRydWUpO1xuICAgICAgbWV0cmljcy5yZWNvcmRTaWduYWxMYXRlbmN5KCdwaGFzZTEnLCA2MCwgdHJ1ZSk7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDcwLCB0cnVlKTtcbiAgICAgIG1ldHJpY3MucmVjb3JkU2lnbmFsTGF0ZW5jeSgncGhhc2UxJywgODAsIGZhbHNlKTtcbiAgICAgIG1ldHJpY3MucmVjb3JkU2lnbmFsTGF0ZW5jeSgncGhhc2UxJywgOTAsIGZhbHNlKTtcbiAgICAgIFxuICAgICAgY29uc3QgYXBwcm92YWxSYXRlID0gbWV0cmljcy5nZXRBcHByb3ZhbFJhdGUoJ3BoYXNlMScpO1xuICAgICAgZXhwZWN0KGFwcHJvdmFsUmF0ZSkudG9CZSgwLjYpOyAvLyAzLzUgPSAwLjZcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N5c3RlbSBNZXRyaWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIGVxdWl0eSBhbmQgYWxsb2NhdGlvbiBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgbWV0cmljcy51cGRhdGVFcXVpdHkoMTAwMDApO1xuICAgICAgbWV0cmljcy51cGRhdGVBbGxvY2F0aW9uKDAuNSwgMC4zLCAwLjIpO1xuICAgICAgXG4gICAgICBjb25zdCBleHBvcnRlZCA9IG1ldHJpY3MuZXhwb3J0KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCd0ZXN0X3RpdGFuX2JyYWluX2N1cnJlbnRfZXF1aXR5IDEwMDAwJyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigncGhhc2VfaWQ9XCJwaGFzZTFcIn0gMC41Jyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigncGhhc2VfaWQ9XCJwaGFzZTJcIn0gMC4zJyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigncGhhc2VfaWQ9XCJwaGFzZTNcIn0gMC4yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBjaXJjdWl0IGJyZWFrZXIgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgbWV0cmljcy51cGRhdGVDaXJjdWl0QnJlYWtlclN0YXR1cyh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhwb3J0ZWQgPSBtZXRyaWNzLmV4cG9ydCgpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Rlc3RfdGl0YW5fYnJhaW5fY2lyY3VpdF9icmVha2VyX2FjdGl2ZSAxJyk7XG4gICAgICBcbiAgICAgIG1ldHJpY3MudXBkYXRlQ2lyY3VpdEJyZWFrZXJTdGF0dXMoZmFsc2UpO1xuICAgICAgXG4gICAgICBjb25zdCBleHBvcnRlZDIgPSBtZXRyaWNzLmV4cG9ydCgpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkMikudG9Db250YWluKCd0ZXN0X3RpdGFuX2JyYWluX2NpcmN1aXRfYnJlYWtlcl9hY3RpdmUgMCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgcGVyZm9ybWFuY2UgbWV0cmljcycsICgpID0+IHtcbiAgICAgIG1ldHJpY3MudXBkYXRlUGhhc2VQZXJmb3JtYW5jZSgncGhhc2UxJywgMS41LCAxLjIpO1xuICAgICAgbWV0cmljcy51cGRhdGVQaGFzZVBlcmZvcm1hbmNlKCdwaGFzZTInLCAwLjgsIDAuOSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4cG9ydGVkID0gbWV0cmljcy5leHBvcnQoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Rlc3RfdGl0YW5fYnJhaW5fc2hhcnBlX3JhdGlve3BoYXNlX2lkPVwicGhhc2UxXCJ9IDEuNScpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Rlc3RfdGl0YW5fYnJhaW5fcGVyZm9ybWFuY2VfbW9kaWZpZXJ7cGhhc2VfaWQ9XCJwaGFzZTFcIn0gMS4yJyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigndGVzdF90aXRhbl9icmFpbl9zaGFycGVfcmF0aW97cGhhc2VfaWQ9XCJwaGFzZTJcIn0gMC44Jyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigndGVzdF90aXRhbl9icmFpbl9wZXJmb3JtYW5jZV9tb2RpZmllcntwaGFzZV9pZD1cInBoYXNlMlwifSAwLjknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGFiYXNlIE1ldHJpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWNvcmQgZGF0YWJhc2UgcXVlcnkgbWV0cmljcycsICgpID0+IHtcbiAgICAgIG1ldHJpY3MucmVjb3JkRGF0YWJhc2VRdWVyeSgnU0VMRUNUJywgJ2JyYWluX2RlY2lzaW9ucycsIDI1KTtcbiAgICAgIG1ldHJpY3MucmVjb3JkRGF0YWJhc2VRdWVyeSgnSU5TRVJUJywgJ2JyYWluX2RlY2lzaW9ucycsIDE1KTtcbiAgICAgIG1ldHJpY3MucmVjb3JkRGF0YWJhc2VRdWVyeSgnVVBEQVRFJywgJ2FsbG9jYXRpb25faGlzdG9yeScsIDMwKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhwb3J0ZWQgPSBtZXRyaWNzLmV4cG9ydCgpO1xuICAgICAgXG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigndGVzdF90aXRhbl9icmFpbl9kYXRhYmFzZV9xdWVyeV9kdXJhdGlvbl9tcycpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ29wZXJhdGlvbj1cIlNFTEVDVFwiJyk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbignb3BlcmF0aW9uPVwiSU5TRVJUXCInKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCdvcGVyYXRpb249XCJVUERBVEVcIicpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3RhYmxlPVwiYnJhaW5fZGVjaXNpb25zXCInKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCd0YWJsZT1cImFsbG9jYXRpb25faGlzdG9yeVwiJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDYWNoZSBNZXRyaWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVjb3JkIGNhY2hlIGFjY2VzcyBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgLy8gUmVjb3JkIGNhY2hlIGhpdHMgYW5kIG1pc3Nlc1xuICAgICAgbWV0cmljcy5yZWNvcmRDYWNoZUFjY2VzcygnZGFzaGJvYXJkJywgdHJ1ZSk7XG4gICAgICBtZXRyaWNzLnJlY29yZENhY2hlQWNjZXNzKCdkYXNoYm9hcmQnLCB0cnVlKTtcbiAgICAgIG1ldHJpY3MucmVjb3JkQ2FjaGVBY2Nlc3MoJ2Rhc2hib2FyZCcsIGZhbHNlKTtcbiAgICAgIG1ldHJpY3MucmVjb3JkQ2FjaGVBY2Nlc3MoJ2FsbG9jYXRpb24nLCB0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhwb3J0ZWQgPSBtZXRyaWNzLmV4cG9ydCgpO1xuICAgICAgXG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigndGVzdF90aXRhbl9icmFpbl9jYWNoZV9yZXF1ZXN0c190b3RhbCcpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ2NhY2hlX25hbWU9XCJkYXNoYm9hcmRcIicpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ2NhY2hlX25hbWU9XCJhbGxvY2F0aW9uXCInKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCdyZXN1bHQ9XCJoaXRcIicpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0NvbnRhaW4oJ3Jlc3VsdD1cIm1pc3NcIicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY2FjaGUgaGl0IHJhdGUgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgLy8gUmVjb3JkIDMgaGl0cyBhbmQgMSBtaXNzIGZvciBkYXNoYm9hcmQgY2FjaGVcbiAgICAgIG1ldHJpY3MucmVjb3JkQ2FjaGVBY2Nlc3MoJ2Rhc2hib2FyZCcsIHRydWUpO1xuICAgICAgbWV0cmljcy5yZWNvcmRDYWNoZUFjY2VzcygnZGFzaGJvYXJkJywgdHJ1ZSk7XG4gICAgICBtZXRyaWNzLnJlY29yZENhY2hlQWNjZXNzKCdkYXNoYm9hcmQnLCB0cnVlKTtcbiAgICAgIG1ldHJpY3MucmVjb3JkQ2FjaGVBY2Nlc3MoJ2Rhc2hib2FyZCcsIGZhbHNlKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGl0UmF0ZSA9IG1ldHJpY3MuZ2V0Q2FjaGVIaXRSYXRlKCdkYXNoYm9hcmQnKTtcbiAgICAgIGV4cGVjdChoaXRSYXRlKS50b0JlKDAuNzUpOyAvLyAzLzQgPSAwLjc1XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFeHBvcnQgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4cG9ydCBtZXRyaWNzIGluIFByb21ldGhldXMgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgbWV0cmljcy51cGRhdGVFcXVpdHkoNTAwMCk7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDEwMCwgdHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4cG9ydGVkID0gbWV0cmljcy5leHBvcnQoKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgUHJvbWV0aGV1cyBmb3JtYXRcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCcjIEhFTFAnKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCcjIFRZUEUnKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZCkudG9Db250YWluKCd0ZXN0X3RpdGFuX2JyYWluXycpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayB0aGF0IGl0J3MgdmFsaWQgdGV4dCBmb3JtYXRcbiAgICAgIGV4cGVjdCh0eXBlb2YgZXhwb3J0ZWQpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgbWV0cmljcyBhcyBKU09OJywgKCkgPT4ge1xuICAgICAgbWV0cmljcy51cGRhdGVFcXVpdHkoNTAwMCk7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDEwMCwgdHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGpzb24gPSBtZXRyaWNzLnRvSlNPTigpO1xuICAgICAgXG4gICAgICBleHBlY3QodHlwZW9mIGpzb24pLnRvQmUoJ29iamVjdCcpO1xuICAgICAgZXhwZWN0KGpzb24pLnRvSGF2ZVByb3BlcnR5KCdjdXJyZW50X2VxdWl0eScpO1xuICAgICAgZXhwZWN0KGpzb24pLnRvSGF2ZVByb3BlcnR5KCdzaWduYWxfcHJvY2Vzc2luZ19sYXRlbmN5X21zJyk7XG4gICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ2RlY2lzaW9uc190b3RhbCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzZXQgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2V0IGFsbCBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgbWV0cmljcy51cGRhdGVFcXVpdHkoNTAwMCk7XG4gICAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koJ3BoYXNlMScsIDEwMCwgdHJ1ZSk7XG4gICAgICBcbiAgICAgIGxldCBleHBvcnRlZCA9IG1ldHJpY3MuZXhwb3J0KCk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQpLnRvQ29udGFpbigndGVzdF90aXRhbl9icmFpbl9jdXJyZW50X2VxdWl0eSA1MDAwJyk7XG4gICAgICBcbiAgICAgIG1ldHJpY3MucmVzZXQoKTtcbiAgICAgIFxuICAgICAgZXhwb3J0ZWQgPSBtZXRyaWNzLmV4cG9ydCgpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkKS5ub3QudG9Db250YWluKCd0ZXN0X3RpdGFuX2JyYWluX2N1cnJlbnRfZXF1aXR5IDUwMDAnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NpbmdsZXRvbiBQYXR0ZXJuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBzYW1lIGluc3RhbmNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljczEgPSBnZXRNZXRyaWNzKCk7XG4gICAgICBjb25zdCBtZXRyaWNzMiA9IGdldE1ldHJpY3MoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1ldHJpY3MxKS50b0JlKG1ldHJpY3MyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5ldyBpbnN0YW5jZSBhZnRlciByZXNldCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1ldHJpY3MxID0gZ2V0TWV0cmljcygpO1xuICAgICAgcmVzZXRNZXRyaWNzKCk7XG4gICAgICBjb25zdCBtZXRyaWNzMiA9IGdldE1ldHJpY3MoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1ldHJpY3MxKS5ub3QudG9CZShtZXRyaWNzMik7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9