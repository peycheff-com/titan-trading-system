{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/security/HMACValidator.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/security/HMACValidator.test.ts"],"sourcesContent":["/**\n * Unit tests for HMACValidator\n */\n\nimport { HMACValidator, HMACDefaults, createHMACMiddleware } from '../../src/security/HMACValidator';\nimport * as crypto from 'crypto';\n\ndescribe('HMACValidator', () => {\n  let validator: HMACValidator;\n  const testSecret = 'test-secret-key-that-is-32-chars-long';\n\n  beforeEach(() => {\n    validator = new HMACValidator({\n      secret: testSecret,\n      algorithm: 'sha256',\n      maxAge: 300,\n      clockSkewTolerance: 60,\n      signatureHeader: 'x-signature',\n      timestampHeader: 'x-timestamp',\n      signaturePrefix: 'sha256='\n    });\n  });\n\n  describe('constructor', () => {\n    it('should initialize with correct configuration', () => {\n      const config = validator.getConfig();\n      expect(config.algorithm).toBe('sha256');\n      expect(config.maxAge).toBe(300);\n      expect(config.secretLength).toBe(testSecret.length);\n    });\n\n    it('should throw error for missing secret', () => {\n      expect(() => new HMACValidator({\n        secret: '',\n        algorithm: 'sha256',\n        maxAge: 300,\n        clockSkewTolerance: 60,\n        signatureHeader: 'x-signature',\n        timestampHeader: 'x-timestamp',\n        signaturePrefix: 'sha256='\n      })).toThrow('HMAC secret is required');\n    });\n  });\n\n  describe('generateSignature', () => {\n    it('should generate valid signature with timestamp', () => {\n      const body = 'test body';\n      const timestamp = Math.floor(Date.now() / 1000);\n      \n      const result = validator.generateSignature(body, timestamp);\n      \n      expect(result.signature).toMatch(/^sha256=[a-f0-9]{64}$/);\n      expect(result.timestamp).toBe(timestamp);\n      expect(result.headers['x-signature']).toBe(result.signature);\n      expect(result.headers['x-timestamp']).toBe(timestamp.toString());\n    });\n\n    it('should generate signature with current timestamp if not provided', () => {\n      const body = 'test body';\n      const beforeTime = Math.floor(Date.now() / 1000);\n      \n      const result = validator.generateSignature(body);\n      const afterTime = Math.floor(Date.now() / 1000);\n      \n      expect(result.timestamp).toBeGreaterThanOrEqual(beforeTime);\n      expect(result.timestamp).toBeLessThanOrEqual(afterTime);\n    });\n\n    it('should handle Buffer body', () => {\n      const body = Buffer.from('test body', 'utf8');\n      \n      const result = validator.generateSignature(body);\n      \n      expect(result.signature).toMatch(/^sha256=[a-f0-9]{64}$/);\n    });\n  });\n\n  describe('validateRequest', () => {\n    it('should validate correct signature', () => {\n      const body = 'test body';\n      const { signature, timestamp, headers } = validator.generateSignature(body);\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(true);\n      expect(result.computedSignature).toBe(signature);\n      expect(result.providedSignature).toBe(signature);\n      expect(result.timestamp).toBe(timestamp);\n    });\n\n    it('should reject missing signature header', () => {\n      const body = 'test body';\n      const headers = { 'x-timestamp': Math.floor(Date.now() / 1000).toString() };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Missing x-signature header');\n    });\n\n    it('should reject missing timestamp header', () => {\n      const body = 'test body';\n      const headers = { 'x-signature': 'sha256=abcd1234' };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Missing x-timestamp header');\n    });\n\n    it('should reject invalid timestamp format', () => {\n      const body = 'test body';\n      const headers = {\n        'x-signature': 'sha256=abcd1234',\n        'x-timestamp': 'invalid-timestamp'\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid timestamp format');\n    });\n\n    it('should reject old requests', () => {\n      const body = 'test body';\n      const oldTimestamp = Math.floor(Date.now() / 1000) - 400; // 400 seconds ago\n      const { signature } = validator.generateSignature(body, oldTimestamp);\n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': oldTimestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Request too old');\n    });\n\n    it('should reject future requests beyond tolerance', () => {\n      const body = 'test body';\n      const futureTimestamp = Math.floor(Date.now() / 1000) + 120; // 2 minutes in future\n      const { signature } = validator.generateSignature(body, futureTimestamp);\n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': futureTimestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Request from future');\n    });\n\n    it('should accept requests within clock skew tolerance', () => {\n      const body = 'test body';\n      const futureTimestamp = Math.floor(Date.now() / 1000) + 30; // 30 seconds in future (within tolerance)\n      const { signature } = validator.generateSignature(body, futureTimestamp);\n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': futureTimestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n\n    it('should reject invalid signature', () => {\n      const body = 'test body';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const headers = {\n        'x-signature': 'sha256=invalid-signature',\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid signature');\n    });\n\n    it('should handle signature without prefix', () => {\n      const body = 'test body';\n      const { signature, timestamp } = validator.generateSignature(body);\n      const signatureWithoutPrefix = signature.replace('sha256=', '');\n      const headers = {\n        'x-signature': signatureWithoutPrefix,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n\n    it('should be case-insensitive for headers', () => {\n      const body = 'test body';\n      const { signature, timestamp } = validator.generateSignature(body);\n      const headers = {\n        'X-Signature': signature,\n        'X-Timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n\n    it('should handle array header values', () => {\n      const body = 'test body';\n      const { signature, timestamp } = validator.generateSignature(body);\n      const headers = {\n        'x-signature': [signature, 'other-value'],\n        'x-timestamp': [timestamp.toString()]\n      };\n      \n      const result = validator.validateRequest(body, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n  });\n\n  describe('validateConfig', () => {\n    it('should validate and return complete configuration', () => {\n      const config = HMACValidator.validateConfig({\n        secret: testSecret,\n        algorithm: 'sha256'\n      });\n      \n      expect(config.secret).toBe(testSecret);\n      expect(config.algorithm).toBe('sha256');\n      expect(config.maxAge).toBe(300); // default\n      expect(config.clockSkewTolerance).toBe(60); // default\n    });\n\n    it('should throw error for missing secret', () => {\n      expect(() => HMACValidator.validateConfig({})).toThrow('HMAC secret is required');\n    });\n\n    it('should throw error for short secret', () => {\n      expect(() => HMACValidator.validateConfig({\n        secret: 'short'\n      })).toThrow('HMAC secret must be at least 32 characters long');\n    });\n  });\n\n  describe('fromEnvironment', () => {\n    const originalEnv = process.env;\n\n    beforeEach(() => {\n      process.env = { ...originalEnv };\n    });\n\n    afterEach(() => {\n      process.env = originalEnv;\n    });\n\n    it('should create validator from environment variables', () => {\n      process.env.HMAC_SECRET = testSecret;\n      process.env.HMAC_ALGORITHM = 'sha512';\n      process.env.HMAC_MAX_AGE = '600';\n      \n      const validator = HMACValidator.fromEnvironment();\n      const config = validator.getConfig();\n      \n      expect(config.algorithm).toBe('sha512');\n      expect(config.maxAge).toBe(600);\n    });\n\n    it('should use WEBHOOK_SECRET as fallback', () => {\n      process.env.WEBHOOK_SECRET = testSecret;\n      \n      const validator = HMACValidator.fromEnvironment();\n      \n      expect(validator).toBeDefined();\n    });\n\n    it('should throw error if no secret in environment', () => {\n      delete process.env.HMAC_SECRET;\n      delete process.env.WEBHOOK_SECRET;\n      \n      expect(() => HMACValidator.fromEnvironment()).toThrow('HMAC secret is required');\n    });\n  });\n\n  describe('timing attack protection', () => {\n    it('should use constant-time comparison', () => {\n      const body = 'test body';\n      const { signature, timestamp } = validator.generateSignature(body);\n      \n      // Test with correct signature\n      const validHeaders = {\n        'x-signature': signature,\n        'x-timestamp': timestamp.toString()\n      };\n      const validResult = validator.validateRequest(body, validHeaders);\n      expect(validResult.valid).toBe(true);\n      \n      // Test with incorrect signature of same length\n      const wrongSignature = signature.replace('a', 'b');\n      const invalidHeaders = {\n        'x-signature': wrongSignature,\n        'x-timestamp': timestamp.toString()\n      };\n      const invalidResult = validator.validateRequest(body, invalidHeaders);\n      expect(invalidResult.valid).toBe(false);\n    });\n  });\n});\n\ndescribe('createHMACMiddleware', () => {\n  let validator: HMACValidator;\n  let middleware: any;\n  let mockReq: any;\n  let mockRes: any;\n  let mockNext: jest.Mock;\n\n  beforeEach(() => {\n    validator = new HMACValidator({\n      secret: 'test-secret-key-that-is-32-chars-long',\n      algorithm: 'sha256',\n      maxAge: 300,\n      clockSkewTolerance: 60,\n      signatureHeader: 'x-signature',\n      timestampHeader: 'x-timestamp',\n      signaturePrefix: 'sha256='\n    });\n    \n    middleware = createHMACMiddleware(validator);\n    mockNext = jest.fn();\n    mockRes = {\n      status: jest.fn().mockReturnThis(),\n      json: jest.fn()\n    };\n  });\n\n  it('should skip validation for health endpoint', () => {\n    mockReq = { path: '/health' };\n    \n    middleware(mockReq, mockRes, mockNext);\n    \n    expect(mockNext).toHaveBeenCalled();\n    expect(mockRes.status).not.toHaveBeenCalled();\n  });\n\n  it('should skip validation for metrics endpoint', () => {\n    mockReq = { path: '/metrics' };\n    \n    middleware(mockReq, mockRes, mockNext);\n    \n    expect(mockNext).toHaveBeenCalled();\n    expect(mockRes.status).not.toHaveBeenCalled();\n  });\n\n  it('should validate HMAC for other endpoints', () => {\n    const body = 'test body';\n    const { signature, timestamp } = validator.generateSignature(body);\n    \n    mockReq = {\n      path: '/api/test',\n      rawBody: body,\n      headers: {\n        'x-signature': signature,\n        'x-timestamp': timestamp.toString()\n      }\n    };\n    \n    middleware(mockReq, mockRes, mockNext);\n    \n    expect(mockNext).toHaveBeenCalled();\n    expect(mockReq.hmacValidation).toBeDefined();\n    expect(mockReq.hmacValidation.valid).toBe(true);\n  });\n\n  it('should reject invalid HMAC', () => {\n    mockReq = {\n      path: '/api/test',\n      rawBody: 'test body',\n      headers: {\n        'x-signature': 'invalid-signature',\n        'x-timestamp': Math.floor(Date.now() / 1000).toString()\n      }\n    };\n    \n    middleware(mockReq, mockRes, mockNext);\n    \n    expect(mockRes.status).toHaveBeenCalledWith(401);\n    expect(mockRes.json).toHaveBeenCalledWith(\n      expect.objectContaining({\n        error: 'Unauthorized'\n      })\n    );\n    expect(mockNext).not.toHaveBeenCalled();\n  });\n});\n\ndescribe('HMACDefaults', () => {\n  it('should provide sensible default configuration', () => {\n    expect(HMACDefaults.algorithm).toBe('sha256');\n    expect(HMACDefaults.maxAge).toBe(300);\n    expect(HMACDefaults.clockSkewTolerance).toBe(60);\n    expect(HMACDefaults.signatureHeader).toBe('x-signature');\n    expect(HMACDefaults.timestampHeader).toBe('x-timestamp');\n    expect(HMACDefaults.signaturePrefix).toBe('sha256=');\n  });\n});"],"version":3}