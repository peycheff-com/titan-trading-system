13e671b2fe66ed7a89f397e7ce60dabf
"use strict";
/**
 * ConfigValidator - Environment variable validation for Railway deployment
 *
 * Validates all required and optional environment variables with proper
 * error messages and type checking for Railway deployment.
 *
 * Requirements: 1.3.1, 1.3.2, 1.3.3, 1.3.4, 1.3.5
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigValidator = void 0;
const Logger_js_1 = require("../logging/Logger.js");
/**
 * Configuration validator for environment variables
 */
class ConfigValidator {
    rules = new Map();
    logger;
    constructor(logger) {
        this.logger = logger ?? Logger_js_1.Logger.getInstance('config-validator');
        this.initializeDefaultRules();
    }
    /**
     * Initialize default validation rules for Titan Brain
     */
    initializeDefaultRules() {
        const defaultRules = [
            // Core application settings
            {
                name: 'NODE_ENV',
                required: true,
                type: 'enum',
                enumValues: ['development', 'production', 'test'],
                defaultValue: 'production',
                description: 'Node.js environment mode'
            },
            {
                name: 'PORT',
                required: true,
                type: 'port',
                defaultValue: 3000,
                description: 'HTTP server port'
            },
            {
                name: 'HOST',
                required: false,
                type: 'string',
                defaultValue: '0.0.0.0',
                description: 'HTTP server host'
            },
            // Database configuration
            {
                name: 'DATABASE_URL',
                required: true,
                type: 'url',
                description: 'PostgreSQL database connection URL'
            },
            {
                name: 'DATABASE_POOL_MIN',
                required: false,
                type: 'number',
                defaultValue: 2,
                minValue: 1,
                maxValue: 50,
                description: 'Minimum database connection pool size'
            },
            {
                name: 'DATABASE_POOL_MAX',
                required: false,
                type: 'number',
                defaultValue: 10,
                minValue: 1,
                maxValue: 100,
                description: 'Maximum database connection pool size'
            },
            // Redis configuration (optional)
            {
                name: 'REDIS_URL',
                required: false,
                type: 'url',
                description: 'Redis connection URL (optional, falls back to in-memory cache)'
            },
            // Security configuration
            {
                name: 'HMAC_SECRET',
                required: false,
                type: 'string',
                description: 'HMAC secret for webhook signature verification'
            },
            {
                name: 'HMAC_ALGORITHM',
                required: false,
                type: 'enum',
                enumValues: ['sha256', 'sha512'],
                defaultValue: 'sha256',
                description: 'HMAC algorithm for signature verification'
            },
            // Logging configuration
            {
                name: 'LOG_LEVEL',
                required: false,
                type: 'enum',
                enumValues: ['fatal', 'error', 'warn', 'info', 'debug', 'trace'],
                defaultValue: 'info',
                description: 'Logging level'
            },
            // Rate limiting configuration
            {
                name: 'RATE_LIMIT_WINDOW_MS',
                required: false,
                type: 'number',
                defaultValue: 60000,
                minValue: 1000,
                maxValue: 3600000,
                description: 'Rate limiting window in milliseconds'
            },
            {
                name: 'RATE_LIMIT_MAX_REQUESTS',
                required: false,
                type: 'number',
                defaultValue: 100,
                minValue: 1,
                maxValue: 10000,
                description: 'Maximum requests per rate limiting window'
            },
            // Health check configuration
            {
                name: 'HEALTH_CHECK_INTERVAL',
                required: false,
                type: 'number',
                defaultValue: 30000,
                minValue: 5000,
                maxValue: 300000,
                description: 'Health check interval in milliseconds'
            },
            // Service discovery configuration
            {
                name: 'PHASE1_SERVICE_URL',
                required: false,
                type: 'url',
                description: 'Phase 1 (Scavenger) service URL'
            },
            {
                name: 'PHASE2_SERVICE_URL',
                required: false,
                type: 'url',
                description: 'Phase 2 (Hunter) service URL'
            },
            {
                name: 'PHASE3_SERVICE_URL',
                required: false,
                type: 'url',
                description: 'Phase 3 (Sentinel) service URL'
            },
            // Railway-specific configuration
            {
                name: 'RAILWAY_ENVIRONMENT',
                required: false,
                type: 'string',
                description: 'Railway environment name'
            },
            {
                name: 'RAILWAY_SERVICE_NAME',
                required: false,
                type: 'string',
                description: 'Railway service name'
            },
            // CORS configuration
            {
                name: 'CORS_ORIGINS',
                required: false,
                type: 'string',
                defaultValue: '*',
                description: 'CORS allowed origins (comma-separated)'
            },
            // Startup configuration
            {
                name: 'STARTUP_TIMEOUT',
                required: false,
                type: 'number',
                defaultValue: 60000,
                minValue: 10000,
                maxValue: 300000,
                description: 'Maximum startup time in milliseconds'
            },
            {
                name: 'SHUTDOWN_TIMEOUT',
                required: false,
                type: 'number',
                defaultValue: 10000,
                minValue: 1000,
                maxValue: 60000,
                description: 'Graceful shutdown timeout in milliseconds'
            }
        ];
        for (const rule of defaultRules) {
            this.rules.set(rule.name, rule);
        }
    }
    /**
     * Add a custom validation rule
     */
    addRule(rule) {
        this.rules.set(rule.name, rule);
    }
    /**
     * Remove a validation rule
     */
    removeRule(name) {
        this.rules.delete(name);
    }
    /**
     * Validate all environment variables
     */
    validate() {
        const variables = [];
        const errors = [];
        const warnings = [];
        this.logger.info('Starting environment variable validation', undefined, {
            totalRules: this.rules.size
        });
        for (const rule of this.rules.values()) {
            const result = this.validateVariable(rule);
            variables.push(result);
            if (!result.valid && result.error) {
                errors.push(result.error);
            }
            if (result.warning) {
                warnings.push(result.warning);
            }
        }
        const summary = {
            total: variables.length,
            valid: variables.filter(v => v.valid).length,
            invalid: variables.filter(v => !v.valid).length,
            warnings: variables.filter(v => v.warning).length,
            usingDefaults: variables.filter(v => v.usingDefault).length
        };
        const validationResult = {
            valid: errors.length === 0,
            errors,
            warnings,
            variables,
            summary
        };
        this.logger.info('Environment variable validation completed', undefined, {
            valid: validationResult.valid,
            errors: errors.length,
            warnings: warnings.length,
            usingDefaults: summary.usingDefaults
        });
        return validationResult;
    }
    /**
     * Validate a single environment variable
     */
    validateVariable(rule) {
        const rawValue = process.env[rule.name];
        let value = rawValue;
        let valid = true;
        let error;
        let warning;
        let usingDefault = false;
        // Check if variable is missing
        if (rawValue === undefined || rawValue === '') {
            if (rule.required) {
                if (rule.defaultValue !== undefined) {
                    value = rule.defaultValue;
                    usingDefault = true;
                    warning = `Using default value for required variable ${rule.name}: ${rule.defaultValue}`;
                }
                else {
                    valid = false;
                    error = `Required environment variable ${rule.name} is not set`;
                    return { name: rule.name, value, valid, error, warning, usingDefault };
                }
            }
            else if (rule.defaultValue !== undefined) {
                value = rule.defaultValue;
                usingDefault = true;
            }
            else {
                // Optional variable with no default
                return { name: rule.name, value: undefined, valid: true, warning, usingDefault };
            }
        }
        // Type validation and conversion
        if (value !== undefined) {
            const typeValidation = this.validateType(rule, String(value));
            if (!typeValidation.valid) {
                valid = false;
                error = typeValidation.error;
            }
            else {
                value = typeValidation.value;
            }
        }
        return { name: rule.name, value, valid, error, warning, usingDefault };
    }
    /**
     * Validate and convert value based on type
     */
    validateType(rule, rawValue) {
        switch (rule.type) {
            case 'string':
                return this.validateString(rule, rawValue);
            case 'number':
                return this.validateNumber(rule, rawValue);
            case 'boolean':
                return this.validateBoolean(rule, rawValue);
            case 'url':
                return this.validateUrl(rule, rawValue);
            case 'port':
                return this.validatePort(rule, rawValue);
            case 'enum':
                return this.validateEnum(rule, rawValue);
            default:
                return {
                    valid: false,
                    value: rawValue,
                    error: `Unknown validation type: ${rule.type}`
                };
        }
    }
    /**
     * Validate string type
     */
    validateString(rule, value) {
        if (rule.pattern && !rule.pattern.test(value)) {
            return {
                valid: false,
                value,
                error: `${rule.name} does not match required pattern`
            };
        }
        return { valid: true, value };
    }
    /**
     * Validate number type
     */
    validateNumber(rule, value) {
        const numValue = Number(value);
        if (isNaN(numValue)) {
            return {
                valid: false,
                value: numValue,
                error: `${rule.name} must be a valid number, got: ${value}`
            };
        }
        if (rule.minValue !== undefined && numValue < rule.minValue) {
            return {
                valid: false,
                value: numValue,
                error: `${rule.name} must be >= ${rule.minValue}, got: ${numValue}`
            };
        }
        if (rule.maxValue !== undefined && numValue > rule.maxValue) {
            return {
                valid: false,
                value: numValue,
                error: `${rule.name} must be <= ${rule.maxValue}, got: ${numValue}`
            };
        }
        return { valid: true, value: numValue };
    }
    /**
     * Validate boolean type
     */
    validateBoolean(rule, value) {
        const lowerValue = value.toLowerCase();
        if (['true', '1', 'yes', 'on'].includes(lowerValue)) {
            return { valid: true, value: true };
        }
        if (['false', '0', 'no', 'off'].includes(lowerValue)) {
            return { valid: true, value: false };
        }
        return {
            valid: false,
            value: false,
            error: `${rule.name} must be a boolean value (true/false, 1/0, yes/no, on/off), got: ${value}`
        };
    }
    /**
     * Validate URL type
     */
    validateUrl(rule, value) {
        try {
            new URL(value);
            return { valid: true, value };
        }
        catch {
            return {
                valid: false,
                value,
                error: `${rule.name} must be a valid URL, got: ${value}`
            };
        }
    }
    /**
     * Validate port type
     */
    validatePort(rule, value) {
        const numValue = Number(value);
        if (isNaN(numValue)) {
            return {
                valid: false,
                value: numValue,
                error: `${rule.name} must be a valid port number, got: ${value}`
            };
        }
        if (numValue < 1 || numValue > 65535) {
            return {
                valid: false,
                value: numValue,
                error: `${rule.name} must be a valid port number (1-65535), got: ${numValue}`
            };
        }
        return { valid: true, value: numValue };
    }
    /**
     * Validate enum type
     */
    validateEnum(rule, value) {
        if (!rule.enumValues || !rule.enumValues.includes(value)) {
            return {
                valid: false,
                value,
                error: `${rule.name} must be one of: ${rule.enumValues?.join(', ')}, got: ${value}`
            };
        }
        return { valid: true, value };
    }
    /**
     * Get configuration summary with masked sensitive values
     */
    getConfigSummary() {
        const summary = {};
        const sensitivePatterns = [
            /secret/i,
            /password/i,
            /key/i,
            /token/i,
            /auth/i,
            /credential/i
        ];
        for (const rule of this.rules.values()) {
            const value = process.env[rule.name];
            const isSensitive = sensitivePatterns.some(pattern => pattern.test(rule.name));
            if (value === undefined) {
                summary[rule.name] = '[NOT SET]';
            }
            else if (isSensitive) {
                summary[rule.name] = '[CONFIGURED]';
            }
            else {
                summary[rule.name] = value;
            }
        }
        return summary;
    }
    /**
     * Get all validation rules
     */
    getRules() {
        return Array.from(this.rules.values());
    }
    /**
     * Get a specific validation rule
     */
    getRule(name) {
        return this.rules.get(name);
    }
}
exports.ConfigValidator = ConfigValidator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9jb25maWcvQ29uZmlnVmFsaWRhdG9yLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFFSCxvREFBOEM7QUE4QzlDOztHQUVHO0FBQ0gsTUFBYSxlQUFlO0lBQ2xCLEtBQUssR0FBZ0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUMvQyxNQUFNLENBQVM7SUFFdkIsWUFBWSxNQUFlO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLGtCQUFNLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssc0JBQXNCO1FBQzVCLE1BQU0sWUFBWSxHQUFxQjtZQUNyQyw0QkFBNEI7WUFDNUI7Z0JBQ0UsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLElBQUksRUFBRSxNQUFNO2dCQUNaLFVBQVUsRUFBRSxDQUFDLGFBQWEsRUFBRSxZQUFZLEVBQUUsTUFBTSxDQUFDO2dCQUNqRCxZQUFZLEVBQUUsWUFBWTtnQkFDMUIsV0FBVyxFQUFFLDBCQUEwQjthQUN4QztZQUNEO2dCQUNFLElBQUksRUFBRSxNQUFNO2dCQUNaLFFBQVEsRUFBRSxJQUFJO2dCQUNkLElBQUksRUFBRSxNQUFNO2dCQUNaLFlBQVksRUFBRSxJQUFJO2dCQUNsQixXQUFXLEVBQUUsa0JBQWtCO2FBQ2hDO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLE1BQU07Z0JBQ1osUUFBUSxFQUFFLEtBQUs7Z0JBQ2YsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsWUFBWSxFQUFFLFNBQVM7Z0JBQ3ZCLFdBQVcsRUFBRSxrQkFBa0I7YUFDaEM7WUFFRCx5QkFBeUI7WUFDekI7Z0JBQ0UsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLElBQUksRUFBRSxLQUFL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Q0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7Q0FDRjtBQW5oQkQsMENBbWhCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vc3JjL2NvbmZpZy9Db25maWdWYWxpZGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb25maWdWYWxpZGF0b3IgLSBFbnZpcm9ubWVudCB2YXJpYWJsZSB2YWxpZGF0aW9uIGZvciBSYWlsd2F5IGRlcGxveW1lbnRcbiAqIFxuICogVmFsaWRhdGVzIGFsbCByZXF1aXJlZCBhbmQgb3B0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHdpdGggcHJvcGVyXG4gKiBlcnJvciBtZXNzYWdlcyBhbmQgdHlwZSBjaGVja2luZyBmb3IgUmFpbHdheSBkZXBsb3ltZW50LlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDEuMy4xLCAxLjMuMiwgMS4zLjMsIDEuMy40LCAxLjMuNVxuICovXG5cbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2xvZ2dpbmcvTG9nZ2VyLmpzJztcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gcnVsZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25SdWxlIHtcbiAgbmFtZTogc3RyaW5nO1xuICByZXF1aXJlZDogYm9vbGVhbjtcbiAgdHlwZTogJ3N0cmluZycgfCAnbnVtYmVyJyB8ICdib29sZWFuJyB8ICd1cmwnIHwgJ3BvcnQnIHwgJ2VudW0nO1xuICBkZWZhdWx0VmFsdWU/OiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuO1xuICBlbnVtVmFsdWVzPzogc3RyaW5nW107XG4gIG1pblZhbHVlPzogbnVtYmVyO1xuICBtYXhWYWx1ZT86IG51bWJlcjtcbiAgcGF0dGVybj86IFJlZ0V4cDtcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbn1cblxuLyoqXG4gKiBWYWxpZGF0aW9uIHJlc3VsdCBmb3IgYSBzaW5nbGUgdmFyaWFibGVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWYXJpYWJsZVZhbGlkYXRpb25SZXN1bHQge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgdW5kZWZpbmVkO1xuICB2YWxpZDogYm9vbGVhbjtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIHdhcm5pbmc/OiBzdHJpbmc7XG4gIHVzaW5nRGVmYXVsdDogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBPdmVyYWxsIHZhbGlkYXRpb24gcmVzdWx0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmlnVmFsaWRhdGlvblJlc3VsdCB7XG4gIHZhbGlkOiBib29sZWFuO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICB3YXJuaW5nczogc3RyaW5nW107XG4gIHZhcmlhYmxlczogVmFyaWFibGVWYWxpZGF0aW9uUmVzdWx0W107XG4gIHN1bW1hcnk6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIHZhbGlkOiBudW1iZXI7XG4gICAgaW52YWxpZDogbnVtYmVyO1xuICAgIHdhcm5pbmdzOiBudW1iZXI7XG4gICAgdXNpbmdEZWZhdWx0czogbnVtYmVyO1xuICB9O1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gdmFsaWRhdG9yIGZvciBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAqL1xuZXhwb3J0IGNsYXNzIENvbmZpZ1ZhbGlkYXRvciB7XG4gIHByaXZhdGUgcnVsZXM6IE1hcDxzdHJpbmcsIFZhbGlkYXRpb25SdWxlPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBsb2dnZXI6IExvZ2dlcjtcblxuICBjb25zdHJ1Y3Rvcihsb2dnZXI/OiBMb2dnZXIpIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlciA/PyBMb2dnZXIuZ2V0SW5zdGFuY2UoJ2NvbmZpZy12YWxpZGF0b3InKTtcbiAgICB0aGlzLmluaXRpYWxpemVEZWZhdWx0UnVsZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGRlZmF1bHQgdmFsaWRhdGlvbiBydWxlcyBmb3IgVGl0YW4gQnJhaW5cbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZURlZmF1bHRSdWxlcygpOiB2b2lkIHtcbiAgICBjb25zdCBkZWZhdWx0UnVsZXM6IFZhbGlkYXRpb25SdWxlW10gPSBbXG4gICAgICAvLyBDb3JlIGFwcGxpY2F0aW9uIHNldHRpbmdzXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdOT0RFX0VOVicsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICB0eXBlOiAnZW51bScsXG4gICAgICAgIGVudW1WYWx1ZXM6IFsnZGV2ZWxvcG1lbnQnLCAncHJvZHVjdGlvbicsICd0ZXN0J10sXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogJ3Byb2R1Y3Rpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ05vZGUuanMgZW52aXJvbm1lbnQgbW9kZSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdQT1JUJyxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHR5cGU6ICdwb3J0JyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAzMDAwLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0hUVFAgc2VydmVyIHBvcnQnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnSE9TVCcsXG4gICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogJzAuMC4wLjAnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0hUVFAgc2VydmVyIGhvc3QnXG4gICAgICB9LFxuXG4gICAgICAvLyBEYXRhYmFzZSBjb25maWd1cmF0aW9uXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdEQVRBQkFTRV9VUkwnLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgdHlwZTogJ3VybCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUG9zdGdyZVNRTCBkYXRhYmFzZSBjb25uZWN0aW9uIFVSTCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdEQVRBQkFTRV9QT09MX01JTicsXG4gICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogMixcbiAgICAgICAgbWluVmFsdWU6IDEsXG4gICAgICAgIG1heFZhbHVlOiA1MCxcbiAgICAgICAgZGVzY3JpcHRpb246ICdNaW5pbXVtIGRhdGFiYXNlIGNvbm5lY3Rpb24gcG9vbCBzaXplJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0RBVEFCQVNFX1BPT0xfTUFYJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAxMCxcbiAgICAgICAgbWluVmFsdWU6IDEsXG4gICAgICAgIG1heFZhbHVlOiAxMDAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTWF4aW11bSBkYXRhYmFzZSBjb25uZWN0aW9uIHBvb2wgc2l6ZSdcbiAgICAgIH0sXG5cbiAgICAgIC8vIFJlZGlzIGNvbmZpZ3VyYXRpb24gKG9wdGlvbmFsKVxuICAgICAge1xuICAgICAgICBuYW1lOiAnUkVESVNfVVJMJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAndXJsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdSZWRpcyBjb25uZWN0aW9uIFVSTCAob3B0aW9uYWwsIGZhbGxzIGJhY2sgdG8gaW4tbWVtb3J5IGNhY2hlKSdcbiAgICAgIH0sXG5cbiAgICAgIC8vIFNlY3VyaXR5IGNvbmZpZ3VyYXRpb25cbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0hNQUNfU0VDUkVUJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdITUFDIHNlY3JldCBmb3Igd2ViaG9vayBzaWduYXR1cmUgdmVyaWZpY2F0aW9uJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0hNQUNfQUxHT1JJVEhNJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnZW51bScsXG4gICAgICAgIGVudW1WYWx1ZXM6IFsnc2hhMjU2JywgJ3NoYTUxMiddLFxuICAgICAgICBkZWZhdWx0VmFsdWU6ICdzaGEyNTYnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0hNQUMgYWxnb3JpdGhtIGZvciBzaWduYXR1cmUgdmVyaWZpY2F0aW9uJ1xuICAgICAgfSxcblxuICAgICAgLy8gTG9nZ2luZyBjb25maWd1cmF0aW9uXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdMT0dfTEVWRUwnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdlbnVtJyxcbiAgICAgICAgZW51bVZhbHVlczogWydmYXRhbCcsICdlcnJvcicsICd3YXJuJywgJ2luZm8nLCAnZGVidWcnLCAndHJhY2UnXSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAnaW5mbycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTG9nZ2luZyBsZXZlbCdcbiAgICAgIH0sXG5cbiAgICAgIC8vIFJhdGUgbGltaXRpbmcgY29uZmlndXJhdGlvblxuICAgICAge1xuICAgICAgICBuYW1lOiAnUkFURV9MSU1JVF9XSU5ET1dfTVMnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IDYwMDAwLFxuICAgICAgICBtaW5WYWx1ZTogMTAwMCxcbiAgICAgICAgbWF4VmFsdWU6IDM2MDAwMDAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmF0ZSBsaW1pdGluZyB3aW5kb3cgaW4gbWlsbGlzZWNvbmRzJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1JBVEVfTElNSVRfTUFYX1JFUVVFU1RTJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAxMDAsXG4gICAgICAgIG1pblZhbHVlOiAxLFxuICAgICAgICBtYXhWYWx1ZTogMTAwMDAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTWF4aW11bSByZXF1ZXN0cyBwZXIgcmF0ZSBsaW1pdGluZyB3aW5kb3cnXG4gICAgICB9LFxuXG4gICAgICAvLyBIZWFsdGggY2hlY2sgY29uZmlndXJhdGlvblxuICAgICAge1xuICAgICAgICBuYW1lOiAnSEVBTFRIX0NIRUNLX0lOVEVSVkFMJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAzMDAwMCxcbiAgICAgICAgbWluVmFsdWU6IDUwMDAsXG4gICAgICAgIG1heFZhbHVlOiAzMDAwMDAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnSGVhbHRoIGNoZWNrIGludGVydmFsIGluIG1pbGxpc2Vjb25kcydcbiAgICAgIH0sXG5cbiAgICAgIC8vIFNlcnZpY2UgZGlzY292ZXJ5IGNvbmZpZ3VyYXRpb25cbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1BIQVNFMV9TRVJWSUNFX1VSTCcsXG4gICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3VybCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUGhhc2UgMSAoU2NhdmVuZ2VyKSBzZXJ2aWNlIFVSTCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdQSEFTRTJfU0VSVklDRV9VUkwnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICd1cmwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1BoYXNlIDIgKEh1bnRlcikgc2VydmljZSBVUkwnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnUEhBU0UzX1NFUlZJQ0VfVVJMJyxcbiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB0eXBlOiAndXJsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdQaGFzZSAzIChTZW50aW5lbCkgc2VydmljZSBVUkwnXG4gICAgICB9LFxuXG4gICAgICAvLyBSYWlsd2F5LXNwZWNpZmljIGNvbmZpZ3VyYXRpb25cbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1JBSUxXQVlfRU5WSVJPTk1FTlQnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JhaWx3YXkgZW52aXJvbm1lbnQgbmFtZSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdSQUlMV0FZX1NFUlZJQ0VfTkFNRScsXG4gICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmFpbHdheSBzZXJ2aWNlIG5hbWUnXG4gICAgICB9LFxuXG4gICAgICAvLyBDT1JTIGNvbmZpZ3VyYXRpb25cbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0NPUlNfT1JJR0lOUycsXG4gICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogJyonLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0NPUlMgYWxsb3dlZCBvcmlnaW5zIChjb21tYS1zZXBhcmF0ZWQpJ1xuICAgICAgfSxcblxuICAgICAgLy8gU3RhcnR1cCBjb25maWd1cmF0aW9uXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdTVEFSVFVQX1RJTUVPVVQnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IDYwMDAwLFxuICAgICAgICBtaW5WYWx1ZTogMTAwMDAsXG4gICAgICAgIG1heFZhbHVlOiAzMDAwMDAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTWF4aW11bSBzdGFydHVwIHRpbWUgaW4gbWlsbGlzZWNvbmRzJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1NIVVRET1dOX1RJTUVPVVQnLFxuICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IDEwMDAwLFxuICAgICAgICBtaW5WYWx1ZTogMTAwMCxcbiAgICAgICAgbWF4VmFsdWU6IDYwMDAwLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0dyYWNlZnVsIHNodXRkb3duIHRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzJ1xuICAgICAgfVxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgZGVmYXVsdFJ1bGVzKSB7XG4gICAgICB0aGlzLnJ1bGVzLnNldChydWxlLm5hbWUsIHJ1bGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBjdXN0b20gdmFsaWRhdGlvbiBydWxlXG4gICAqL1xuICBhZGRSdWxlKHJ1bGU6IFZhbGlkYXRpb25SdWxlKTogdm9pZCB7XG4gICAgdGhpcy5ydWxlcy5zZXQocnVsZS5uYW1lLCBydWxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSB2YWxpZGF0aW9uIHJ1bGVcbiAgICovXG4gIHJlbW92ZVJ1bGUobmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5ydWxlcy5kZWxldGUobmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYWxsIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgKi9cbiAgdmFsaWRhdGUoKTogQ29uZmlnVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgdmFyaWFibGVzOiBWYXJpYWJsZVZhbGlkYXRpb25SZXN1bHRbXSA9IFtdO1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIGVudmlyb25tZW50IHZhcmlhYmxlIHZhbGlkYXRpb24nLCB1bmRlZmluZWQsIHtcbiAgICAgIHRvdGFsUnVsZXM6IHRoaXMucnVsZXMuc2l6ZVxuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBydWxlIG9mIHRoaXMucnVsZXMudmFsdWVzKCkpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMudmFsaWRhdGVWYXJpYWJsZShydWxlKTtcbiAgICAgIHZhcmlhYmxlcy5wdXNoKHJlc3VsdCk7XG5cbiAgICAgIGlmICghcmVzdWx0LnZhbGlkICYmIHJlc3VsdC5lcnJvcikge1xuICAgICAgICBlcnJvcnMucHVzaChyZXN1bHQuZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzdWx0Lndhcm5pbmcpIHtcbiAgICAgICAgd2FybmluZ3MucHVzaChyZXN1bHQud2FybmluZyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgc3VtbWFyeSA9IHtcbiAgICAgIHRvdGFsOiB2YXJpYWJsZXMubGVuZ3RoLFxuICAgICAgdmFsaWQ6IHZhcmlhYmxlcy5maWx0ZXIodiA9PiB2LnZhbGlkKS5sZW5ndGgsXG4gICAgICBpbnZhbGlkOiB2YXJpYWJsZXMuZmlsdGVyKHYgPT4gIXYudmFsaWQpLmxlbmd0aCxcbiAgICAgIHdhcm5pbmdzOiB2YXJpYWJsZXMuZmlsdGVyKHYgPT4gdi53YXJuaW5nKS5sZW5ndGgsXG4gICAgICB1c2luZ0RlZmF1bHRzOiB2YXJpYWJsZXMuZmlsdGVyKHYgPT4gdi51c2luZ0RlZmF1bHQpLmxlbmd0aFxuICAgIH07XG5cbiAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiBDb25maWdWYWxpZGF0aW9uUmVzdWx0ID0ge1xuICAgICAgdmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvcnMsXG4gICAgICB3YXJuaW5ncyxcbiAgICAgIHZhcmlhYmxlcyxcbiAgICAgIHN1bW1hcnlcbiAgICB9O1xuXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnRW52aXJvbm1lbnQgdmFyaWFibGUgdmFsaWRhdGlvbiBjb21wbGV0ZWQnLCB1bmRlZmluZWQsIHtcbiAgICAgIHZhbGlkOiB2YWxpZGF0aW9uUmVzdWx0LnZhbGlkLFxuICAgICAgZXJyb3JzOiBlcnJvcnMubGVuZ3RoLFxuICAgICAgd2FybmluZ3M6IHdhcm5pbmdzLmxlbmd0aCxcbiAgICAgIHVzaW5nRGVmYXVsdHM6IHN1bW1hcnkudXNpbmdEZWZhdWx0c1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHZhbGlkYXRpb25SZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYSBzaW5nbGUgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVWYXJpYWJsZShydWxlOiBWYWxpZGF0aW9uUnVsZSk6IFZhcmlhYmxlVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgcmF3VmFsdWUgPSBwcm9jZXNzLmVudltydWxlLm5hbWVdO1xuICAgIGxldCB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHVuZGVmaW5lZCA9IHJhd1ZhbHVlO1xuICAgIGxldCB2YWxpZCA9IHRydWU7XG4gICAgbGV0IGVycm9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IHdhcm5pbmc6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgdXNpbmdEZWZhdWx0ID0gZmFsc2U7XG5cbiAgICAvLyBDaGVjayBpZiB2YXJpYWJsZSBpcyBtaXNzaW5nXG4gICAgaWYgKHJhd1ZhbHVlID09PSB1bmRlZmluZWQgfHwgcmF3VmFsdWUgPT09ICcnKSB7XG4gICAgICBpZiAocnVsZS5yZXF1aXJlZCkge1xuICAgICAgICBpZiAocnVsZS5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhbHVlID0gcnVsZS5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgdXNpbmdEZWZhdWx0ID0gdHJ1ZTtcbiAgICAgICAgICB3YXJuaW5nID0gYFVzaW5nIGRlZmF1bHQgdmFsdWUgZm9yIHJlcXVpcmVkIHZhcmlhYmxlICR7cnVsZS5uYW1lfTogJHtydWxlLmRlZmF1bHRWYWx1ZX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgZXJyb3IgPSBgUmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGUgJHtydWxlLm5hbWV9IGlzIG5vdCBzZXRgO1xuICAgICAgICAgIHJldHVybiB7IG5hbWU6IHJ1bGUubmFtZSwgdmFsdWUsIHZhbGlkLCBlcnJvciwgd2FybmluZywgdXNpbmdEZWZhdWx0IH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocnVsZS5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YWx1ZSA9IHJ1bGUuZGVmYXVsdFZhbHVlO1xuICAgICAgICB1c2luZ0RlZmF1bHQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT3B0aW9uYWwgdmFyaWFibGUgd2l0aCBubyBkZWZhdWx0XG4gICAgICAgIHJldHVybiB7IG5hbWU6IHJ1bGUubmFtZSwgdmFsdWU6IHVuZGVmaW5lZCwgdmFsaWQ6IHRydWUsIHdhcm5pbmcsIHVzaW5nRGVmYXVsdCB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFR5cGUgdmFsaWRhdGlvbiBhbmQgY29udmVyc2lvblxuICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCB0eXBlVmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVUeXBlKHJ1bGUsIFN0cmluZyh2YWx1ZSkpO1xuICAgICAgaWYgKCF0eXBlVmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICBlcnJvciA9IHR5cGVWYWxpZGF0aW9uLmVycm9yO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSB0eXBlVmFsaWRhdGlvbi52YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyBuYW1lOiBydWxlLm5hbWUsIHZhbHVlLCB2YWxpZCwgZXJyb3IsIHdhcm5pbmcsIHVzaW5nRGVmYXVsdCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFuZCBjb252ZXJ0IHZhbHVlIGJhc2VkIG9uIHR5cGVcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVUeXBlKHJ1bGU6IFZhbGlkYXRpb25SdWxlLCByYXdWYWx1ZTogc3RyaW5nKToge1xuICAgIHZhbGlkOiBib29sZWFuO1xuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuO1xuICAgIGVycm9yPzogc3RyaW5nO1xuICB9IHtcbiAgICBzd2l0Y2ggKHJ1bGUudHlwZSkge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVTdHJpbmcocnVsZSwgcmF3VmFsdWUpO1xuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVOdW1iZXIocnVsZSwgcmF3VmFsdWUpO1xuICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQm9vbGVhbihydWxlLCByYXdWYWx1ZSk7XG4gICAgICBjYXNlICd1cmwnOlxuICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZVVybChydWxlLCByYXdWYWx1ZSk7XG4gICAgICBjYXNlICdwb3J0JzpcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVQb3J0KHJ1bGUsIHJhd1ZhbHVlKTtcbiAgICAgIGNhc2UgJ2VudW0nOlxuICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUVudW0ocnVsZSwgcmF3VmFsdWUpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgdmFsdWU6IHJhd1ZhbHVlLFxuICAgICAgICAgIGVycm9yOiBgVW5rbm93biB2YWxpZGF0aW9uIHR5cGU6ICR7cnVsZS50eXBlfWBcbiAgICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgc3RyaW5nIHR5cGVcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVTdHJpbmcocnVsZTogVmFsaWRhdGlvblJ1bGUsIHZhbHVlOiBzdHJpbmcpOiB7XG4gICAgdmFsaWQ6IGJvb2xlYW47XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBlcnJvcj86IHN0cmluZztcbiAgfSB7XG4gICAgaWYgKHJ1bGUucGF0dGVybiAmJiAhcnVsZS5wYXR0ZXJuLnRlc3QodmFsdWUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBlcnJvcjogYCR7cnVsZS5uYW1lfSBkb2VzIG5vdCBtYXRjaCByZXF1aXJlZCBwYXR0ZXJuYFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgdmFsdWUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBudW1iZXIgdHlwZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZU51bWJlcihydWxlOiBWYWxpZGF0aW9uUnVsZSwgdmFsdWU6IHN0cmluZyk6IHtcbiAgICB2YWxpZDogYm9vbGVhbjtcbiAgICB2YWx1ZTogbnVtYmVyO1xuICAgIGVycm9yPzogc3RyaW5nO1xuICB9IHtcbiAgICBjb25zdCBudW1WYWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cbiAgICBpZiAoaXNOYU4obnVtVmFsdWUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBudW1WYWx1ZSxcbiAgICAgICAgZXJyb3I6IGAke3J1bGUubmFtZX0gbXVzdCBiZSBhIHZhbGlkIG51bWJlciwgZ290OiAke3ZhbHVlfWBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHJ1bGUubWluVmFsdWUgIT09IHVuZGVmaW5lZCAmJiBudW1WYWx1ZSA8IHJ1bGUubWluVmFsdWUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG51bVZhbHVlLFxuICAgICAgICBlcnJvcjogYCR7cnVsZS5uYW1lfSBtdXN0IGJlID49ICR7cnVsZS5taW5WYWx1ZX0sIGdvdDogJHtudW1WYWx1ZX1gXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChydWxlLm1heFZhbHVlICE9PSB1bmRlZmluZWQgJiYgbnVtVmFsdWUgPiBydWxlLm1heFZhbHVlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBudW1WYWx1ZSxcbiAgICAgICAgZXJyb3I6IGAke3J1bGUubmFtZX0gbXVzdCBiZSA8PSAke3J1bGUubWF4VmFsdWV9LCBnb3Q6ICR7bnVtVmFsdWV9YFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgdmFsdWU6IG51bVZhbHVlIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYm9vbGVhbiB0eXBlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlQm9vbGVhbihydWxlOiBWYWxpZGF0aW9uUnVsZSwgdmFsdWU6IHN0cmluZyk6IHtcbiAgICB2YWxpZDogYm9vbGVhbjtcbiAgICB2YWx1ZTogYm9vbGVhbjtcbiAgICBlcnJvcj86IHN0cmluZztcbiAgfSB7XG4gICAgY29uc3QgbG93ZXJWYWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoWyd0cnVlJywgJzEnLCAneWVzJywgJ29uJ10uaW5jbHVkZXMobG93ZXJWYWx1ZSkpIHtcbiAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCB2YWx1ZTogdHJ1ZSB9O1xuICAgIH1cblxuICAgIGlmIChbJ2ZhbHNlJywgJzAnLCAnbm8nLCAnb2ZmJ10uaW5jbHVkZXMobG93ZXJWYWx1ZSkpIHtcbiAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCB2YWx1ZTogZmFsc2UgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgdmFsdWU6IGZhbHNlLFxuICAgICAgZXJyb3I6IGAke3J1bGUubmFtZX0gbXVzdCBiZSBhIGJvb2xlYW4gdmFsdWUgKHRydWUvZmFsc2UsIDEvMCwgeWVzL25vLCBvbi9vZmYpLCBnb3Q6ICR7dmFsdWV9YFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgVVJMIHR5cGVcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVVcmwocnVsZTogVmFsaWRhdGlvblJ1bGUsIHZhbHVlOiBzdHJpbmcpOiB7XG4gICAgdmFsaWQ6IGJvb2xlYW47XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBlcnJvcj86IHN0cmluZztcbiAgfSB7XG4gICAgdHJ5IHtcbiAgICAgIG5ldyBVUkwodmFsdWUpO1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIHZhbHVlIH07XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBlcnJvcjogYCR7cnVsZS5uYW1lfSBtdXN0IGJlIGEgdmFsaWQgVVJMLCBnb3Q6ICR7dmFsdWV9YFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgcG9ydCB0eXBlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlUG9ydChydWxlOiBWYWxpZGF0aW9uUnVsZSwgdmFsdWU6IHN0cmluZyk6IHtcbiAgICB2YWxpZDogYm9vbGVhbjtcbiAgICB2YWx1ZTogbnVtYmVyO1xuICAgIGVycm9yPzogc3RyaW5nO1xuICB9IHtcbiAgICBjb25zdCBudW1WYWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cbiAgICBpZiAoaXNOYU4obnVtVmFsdWUpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBudW1WYWx1ZSxcbiAgICAgICAgZXJyb3I6IGAke3J1bGUubmFtZX0gbXVzdCBiZSBhIHZhbGlkIHBvcnQgbnVtYmVyLCBnb3Q6ICR7dmFsdWV9YFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAobnVtVmFsdWUgPCAxIHx8IG51bVZhbHVlID4gNjU1MzUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG51bVZhbHVlLFxuICAgICAgICBlcnJvcjogYCR7cnVsZS5uYW1lfSBtdXN0IGJlIGEgdmFsaWQgcG9ydCBudW1iZXIgKDEtNjU1MzUpLCBnb3Q6ICR7bnVtVmFsdWV9YFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgdmFsdWU6IG51bVZhbHVlIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgZW51bSB0eXBlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlRW51bShydWxlOiBWYWxpZGF0aW9uUnVsZSwgdmFsdWU6IHN0cmluZyk6IHtcbiAgICB2YWxpZDogYm9vbGVhbjtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGVycm9yPzogc3RyaW5nO1xuICB9IHtcbiAgICBpZiAoIXJ1bGUuZW51bVZhbHVlcyB8fCAhcnVsZS5lbnVtVmFsdWVzLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgZXJyb3I6IGAke3J1bGUubmFtZX0gbXVzdCBiZSBvbmUgb2Y6ICR7cnVsZS5lbnVtVmFsdWVzPy5qb2luKCcsICcpfSwgZ290OiAke3ZhbHVlfWBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIHZhbHVlIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbmZpZ3VyYXRpb24gc3VtbWFyeSB3aXRoIG1hc2tlZCBzZW5zaXRpdmUgdmFsdWVzXG4gICAqL1xuICBnZXRDb25maWdTdW1tYXJ5KCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGNvbnN0IHN1bW1hcnk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICBjb25zdCBzZW5zaXRpdmVQYXR0ZXJucyA9IFtcbiAgICAgIC9zZWNyZXQvaSxcbiAgICAgIC9wYXNzd29yZC9pLFxuICAgICAgL2tleS9pLFxuICAgICAgL3Rva2VuL2ksXG4gICAgICAvYXV0aC9pLFxuICAgICAgL2NyZWRlbnRpYWwvaVxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgdGhpcy5ydWxlcy52YWx1ZXMoKSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBwcm9jZXNzLmVudltydWxlLm5hbWVdO1xuICAgICAgY29uc3QgaXNTZW5zaXRpdmUgPSBzZW5zaXRpdmVQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gcGF0dGVybi50ZXN0KHJ1bGUubmFtZSkpO1xuXG4gICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdW1tYXJ5W3J1bGUubmFtZV0gPSAnW05PVCBTRVRdJztcbiAgICAgIH0gZWxzZSBpZiAoaXNTZW5zaXRpdmUpIHtcbiAgICAgICAgc3VtbWFyeVtydWxlLm5hbWVdID0gJ1tDT05GSUdVUkVEXSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdW1tYXJ5W3J1bGUubmFtZV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3VtbWFyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHZhbGlkYXRpb24gcnVsZXNcbiAgICovXG4gIGdldFJ1bGVzKCk6IFZhbGlkYXRpb25SdWxlW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucnVsZXMudmFsdWVzKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNwZWNpZmljIHZhbGlkYXRpb24gcnVsZVxuICAgKi9cbiAgZ2V0UnVsZShuYW1lOiBzdHJpbmcpOiBWYWxpZGF0aW9uUnVsZSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMucnVsZXMuZ2V0KG5hbWUpO1xuICB9XG59Il0sInZlcnNpb24iOjN9