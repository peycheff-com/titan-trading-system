07533b182460881b0f33a19bc3276407
"use strict";
/**
 * Unit tests for HealthManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
const HealthManager_1 = require("../../src/health/HealthManager");
// Mock database manager
const mockDatabaseManager = {
    isHealthy: jest.fn(),
    getMetrics: jest.fn()
};
// Mock cache manager
const mockCacheManager = {
    isHealthy: jest.fn()
};
// Mock config
const mockConfig = {
    port: 3000,
    nodeEnv: 'test'
};
describe('HealthManager', () => {
    let healthManager;
    beforeEach(() => {
        jest.clearAllMocks();
        healthManager = new HealthManager_1.HealthManager();
    });
    afterEach(() => {
        healthManager.shutdown();
    });
    describe('component registration', () => {
        it('should register and unregister components', () => {
            const component = {
                name: 'test',
                check: jest.fn(),
                isRequired: true,
                timeout: 1000
            };
            const registerSpy = jest.fn();
            const unregisterSpy = jest.fn();
            healthManager.on('component:registered', registerSpy);
            healthManager.on('component:unregistered', unregisterSpy);
            healthManager.registerComponent(component);
            expect(registerSpy).toHaveBeenCalledWith({ name: 'test' });
            healthManager.unregisterComponent('test');
            expect(unregisterSpy).toHaveBeenCalledWith({ name: 'test' });
        });
    });
    describe('health checks', () => {
        it('should perform health check on all components', async () => {
            const mockComponent = {
                name: 'test',
                check: jest.fn().mockResolvedValue({
                    name: 'test',
                    status: HealthManager_1.HealthStatus.HEALTHY,
                    message: 'Test component healthy',
                    duration: 10,
                    timestamp: Date.now()
                }),
                isRequired: true,
                timeout: 1000
            };
            healthManager.registerComponent(mockComponent);
            const health = await healthManager.checkHealth();
            expect(health.status).toBe(HealthManager_1.HealthStatus.HEALTHY);
            expect(health.components).toHaveLength(1);
            expect(health.components[0].name).toBe('test');
            expect(health.version).toBeDefined();
            expect(health.uptime).toBeGreaterThanOrEqual(0);
        });
        it('should handle component timeout', async () => {
            const slowComponent = {
                name: 'slow',
                check: jest.fn().mockImplementation(() => new Promise(resolve => setTimeout(resolve, 2000))),
                isRequired: true,
                timeout: 100
            };
            healthManager.registerComponent(slowComponent);
            const health = await healthManager.checkHealth();
            expect(health.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
            expect(health.components[0].status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
            expect(health.components[0].message).toContain('timeout');
        });
        it('should determine overall status correctly', async () => {
            const healthyComponent = {
                name: 'healthy',
                check: jest.fn().mockResolvedValue({
                    name: 'healthy',
                    status: HealthManager_1.HealthStatus.HEALTHY,
                    message: 'OK',
                    duration: 10,
                    timestamp: Date.now()
                }),
                isRequired: true,
                timeout: 1000
            };
            const unhealthyComponent = {
                name: 'unhealthy',
                check: jest.fn().mockResolvedValue({
                    name: 'unhealthy',
                    status: HealthManager_1.HealthStatus.UNHEALTHY,
                    message: 'Failed',
                    duration: 10,
                    timestamp: Date.now()
                }),
                isRequired: true,
                timeout: 1000
            };
            healthManager.registerComponent(healthyComponent);
            healthManager.registerComponent(unhealthyComponent);
            const health = await healthManager.checkHealth();
            expect(health.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
        });
        it('should cache health results', async () => {
            const component = {
                name: 'test',
                check: jest.fn().mockResolvedValue({
                    name: 'test',
                    status: HealthManager_1.HealthStatus.HEALTHY,
                    message: 'OK',
                    duration: 10,
                    timestamp: Date.now()
                }),
                isRequired: true,
                timeout: 1000
            };
            healthManager.registerComponent(component);
            // First call
            const health1 = await healthManager.checkHealth();
            // Second call (should use cache)
            const health2 = await healthManager.checkHealth();
            expect(component.check).toHaveBeenCalledTimes(1);
            expect(health1.timestamp).toBe(health2.timestamp);
        });
    });
    describe('periodic checks', () => {
        it('should start and stop periodic checks', () => {
            const startSpy = jest.fn();
            const stopSpy = jest.fn();
            healthManager.on('periodic:started', startSpy);
            healthManager.on('periodic:stopped', stopSpy);
            healthManager.startPeriodicChecks();
            expect(startSpy).toHaveBeenCalled();
            healthManager.stopPeriodicChecks();
            expect(stopSpy).toHaveBeenCalled();
        });
    });
    describe('utility methods', () => {
        it('should return uptime', async () => {
            // Wait a small amount to ensure uptime > 0
            await new Promise(resolve => setTimeout(resolve, 1));
            const uptime = healthManager.getUptime();
            expect(uptime).toBeGreaterThanOrEqual(0);
        });
        it('should return last health check', async () => {
            expect(healthManager.getLastHealthCheck()).toBeNull();
            await healthManager.checkHealth();
            expect(healthManager.getLastHealthCheck()).not.toBeNull();
        });
        it('should check if system is healthy', async () => {
            const healthyComponent = {
                name: 'test',
                check: jest.fn().mockResolvedValue({
                    name: 'test',
                    status: HealthManager_1.HealthStatus.HEALTHY,
                    message: 'OK',
                    duration: 10,
                    timestamp: Date.now()
                }),
                isRequired: true,
                timeout: 1000
            };
            healthManager.registerComponent(healthyComponent);
            await healthManager.checkHealth();
            expect(healthManager.isHealthy()).toBe(true);
        });
    });
});
describe('DatabaseHealthComponent', () => {
    let component;
    beforeEach(() => {
        jest.clearAllMocks();
        component = new HealthManager_1.DatabaseHealthComponent(mockDatabaseManager);
    });
    it('should report healthy when database is healthy', async () => {
        mockDatabaseManager.isHealthy.mockReturnValue(true);
        mockDatabaseManager.getMetrics.mockReturnValue({
            totalConnections: 5,
            idleConnections: 3,
            successfulQueries: 100,
            failedQueries: 0
        });
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.HEALTHY);
        expect(result.name).toBe('database');
        expect(result.details).toEqual({
            totalConnections: 5,
            idleConnections: 3,
            successfulQueries: 100,
            failedQueries: 0
        });
    });
    it('should report unhealthy when database is unhealthy', async () => {
        mockDatabaseManager.isHealthy.mockReturnValue(false);
        mockDatabaseManager.getMetrics.mockReturnValue({
            connectionErrors: 5,
            lastHealthCheck: Date.now()
        });
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
        expect(result.message).toContain('unhealthy');
    });
    it('should report unhealthy when database manager is not initialized', async () => {
        const component = new HealthManager_1.DatabaseHealthComponent(null);
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
        expect(result.message).toContain('not initialized');
    });
});
describe('ConfigHealthComponent', () => {
    let component;
    beforeEach(() => {
        component = new HealthManager_1.ConfigHealthComponent(mockConfig);
    });
    it('should report healthy when configuration is valid', async () => {
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.HEALTHY);
        expect(result.name).toBe('configuration');
        expect(result.details).toEqual({
            nodeEnv: 'test',
            port: 3000
        });
    });
    it('should report unhealthy when required fields are missing', async () => {
        const invalidConfig = { nodeEnv: 'test' }; // missing port
        const component = new HealthManager_1.ConfigHealthComponent(invalidConfig);
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
        expect(result.message).toContain('Missing required configuration');
        expect(result.details?.missingFields).toContain('port');
    });
});
describe('MemoryHealthComponent', () => {
    let component;
    beforeEach(() => {
        component = new HealthManager_1.MemoryHealthComponent();
    });
    it('should report healthy when memory usage is normal', async () => {
        // Mock process.memoryUsage to return normal values
        const originalMemoryUsage = process.memoryUsage;
        process.memoryUsage = jest.fn().mockReturnValue({
            heapUsed: 50 * 1024 * 1024, // 50MB
            heapTotal: 100 * 1024 * 1024, // 100MB (50% usage)
            external: 10 * 1024 * 1024,
            rss: 80 * 1024 * 1024,
            arrayBuffers: 5 * 1024 * 1024
        });
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.HEALTHY);
        expect(result.name).toBe('memory');
        expect(result.details?.usagePercentage).toBe(50);
        process.memoryUsage = originalMemoryUsage;
    });
    it('should report degraded when memory usage is high', async () => {
        const originalMemoryUsage = process.memoryUsage;
        process.memoryUsage = jest.fn().mockReturnValue({
            heapUsed: 85 * 1024 * 1024, // 85MB
            heapTotal: 100 * 1024 * 1024, // 100MB (85% usage)
            external: 10 * 1024 * 1024,
            rss: 120 * 1024 * 1024,
            arrayBuffers: 5 * 1024 * 1024
        });
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.DEGRADED);
        expect(result.message).toContain('High memory usage');
        process.memoryUsage = originalMemoryUsage;
    });
    it('should report unhealthy when memory usage is critical', async () => {
        const originalMemoryUsage = process.memoryUsage;
        process.memoryUsage = jest.fn().mockReturnValue({
            heapUsed: 95 * 1024 * 1024, // 95MB
            heapTotal: 100 * 1024 * 1024, // 100MB (95% usage)
            external: 10 * 1024 * 1024,
            rss: 150 * 1024 * 1024,
            arrayBuffers: 5 * 1024 * 1024
        });
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.UNHEALTHY);
        expect(result.message).toContain('Critical memory usage');
        process.memoryUsage = originalMemoryUsage;
    });
});
describe('RedisHealthComponent', () => {
    let component;
    beforeEach(() => {
        jest.clearAllMocks();
        component = new HealthManager_1.RedisHealthComponent(mockCacheManager);
    });
    it('should report healthy when Redis is available', async () => {
        mockCacheManager.isHealthy.mockResolvedValue(true);
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.HEALTHY);
        expect(result.name).toBe('redis');
        expect(result.message).toContain('healthy');
    });
    it('should report degraded when Redis is unavailable', async () => {
        mockCacheManager.isHealthy.mockResolvedValue(false);
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.DEGRADED);
        expect(result.message).toContain('unavailable');
    });
    it('should report degraded when Redis is not configured', async () => {
        const component = new HealthManager_1.RedisHealthComponent();
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.DEGRADED);
        expect(result.message).toContain('not configured');
    });
    it('should report degraded when Redis check fails', async () => {
        mockCacheManager.isHealthy.mockRejectedValue(new Error('Connection failed'));
        const result = await component.check();
        expect(result.status).toBe(HealthManager_1.HealthStatus.DEGRADED);
        expect(result.message).toContain('check failed');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2hlYWx0aC9IZWFsdGhNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILGtFQVN3QztBQUV4Qyx3QkFBd0I7QUFDeEIsTUFBTSxtQkFBbUIsR0FBRztJQUMxQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNwQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN0QixDQUFDO0FBRUYscUJBQXFCO0FBQ3JCLE1BQU0sZ0JBQWdCLEdBQUc7SUFDdkIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDckIsQ0FBQztBQUVGLGNBQWM7QUFDZCxNQUFNLFVBQVUsR0FBRztJQUNqQixJQUFJLEVBQUUsSUFBSTtJQUNWLE9BQU8sRUFBRSxNQUFNO0NBQ2hCLENBQUM7QUFFRixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLGFBQTRCLENBQUM7SUFFakMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixhQUFhLEdBQUcsSUFBSSw2QkFBYSxFQUFFLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzNCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtRQUN0QyxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ25ELE1BQU0sU0FBUyxHQUFvQjtnQkFDakMsSUFBSSxFQUFFLE1BQU07Z0JBQ1osS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hCLFVBQVUsRUFBRSxJQUFJO2dCQUNoQixPQUFPLEVBQUUsSUFBSTthQUNkLENBQUM7WUFFRixNQUFNLFdBQVcsR0FBRyxJQUFJLENB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LENBQUMsS0FBSyxFQUFFLENBQUM7UUFFdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsNEJBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzdELGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7UUFFN0UsTUFBTSxNQUFNLEdBQUcsTUFBTSxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsNEJBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNuRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy9oZWFsdGgvSGVhbHRoTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCB0ZXN0cyBmb3IgSGVhbHRoTWFuYWdlclxuICovXG5cbmltcG9ydCB7XG4gIEhlYWx0aE1hbmFnZXIsXG4gIEhlYWx0aFN0YXR1cyxcbiAgSGVhbHRoQ29tcG9uZW50LFxuICBDb21wb25lbnRIZWFsdGgsXG4gIERhdGFiYXNlSGVhbHRoQ29tcG9uZW50LFxuICBDb25maWdIZWFsdGhDb21wb25lbnQsXG4gIE1lbW9yeUhlYWx0aENvbXBvbmVudCxcbiAgUmVkaXNIZWFsdGhDb21wb25lbnRcbn0gZnJvbSAnLi4vLi4vc3JjL2hlYWx0aC9IZWFsdGhNYW5hZ2VyJztcblxuLy8gTW9jayBkYXRhYmFzZSBtYW5hZ2VyXG5jb25zdCBtb2NrRGF0YWJhc2VNYW5hZ2VyID0ge1xuICBpc0hlYWx0aHk6IGplc3QuZm4oKSxcbiAgZ2V0TWV0cmljczogamVzdC5mbigpXG59O1xuXG4vLyBNb2NrIGNhY2hlIG1hbmFnZXJcbmNvbnN0IG1vY2tDYWNoZU1hbmFnZXIgPSB7XG4gIGlzSGVhbHRoeTogamVzdC5mbigpXG59O1xuXG4vLyBNb2NrIGNvbmZpZ1xuY29uc3QgbW9ja0NvbmZpZyA9IHtcbiAgcG9ydDogMzAwMCxcbiAgbm9kZUVudjogJ3Rlc3QnXG59O1xuXG5kZXNjcmliZSgnSGVhbHRoTWFuYWdlcicsICgpID0+IHtcbiAgbGV0IGhlYWx0aE1hbmFnZXI6IEhlYWx0aE1hbmFnZXI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgaGVhbHRoTWFuYWdlciA9IG5ldyBIZWFsdGhNYW5hZ2VyKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgaGVhbHRoTWFuYWdlci5zaHV0ZG93bigpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29tcG9uZW50IHJlZ2lzdHJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGFuZCB1bnJlZ2lzdGVyIGNvbXBvbmVudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wb25lbnQ6IEhlYWx0aENvbXBvbmVudCA9IHtcbiAgICAgICAgbmFtZTogJ3Rlc3QnLFxuICAgICAgICBjaGVjazogamVzdC5mbigpLFxuICAgICAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICAgICAgICB0aW1lb3V0OiAxMDAwXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZWdpc3RlclNweSA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IHVucmVnaXN0ZXJTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBcbiAgICAgIGhlYWx0aE1hbmFnZXIub24oJ2NvbXBvbmVudDpyZWdpc3RlcmVkJywgcmVnaXN0ZXJTcHkpO1xuICAgICAgaGVhbHRoTWFuYWdlci5vbignY29tcG9uZW50OnVucmVnaXN0ZXJlZCcsIHVucmVnaXN0ZXJTcHkpO1xuXG4gICAgICBoZWFsdGhNYW5hZ2VyLnJlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgICBleHBlY3QocmVnaXN0ZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgbmFtZTogJ3Rlc3QnIH0pO1xuXG4gICAgICBoZWFsdGhNYW5hZ2VyLnVucmVnaXN0ZXJDb21wb25lbnQoJ3Rlc3QnKTtcbiAgICAgIGV4cGVjdCh1bnJlZ2lzdGVyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IG5hbWU6ICd0ZXN0JyB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWx0aCBjaGVja3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwZXJmb3JtIGhlYWx0aCBjaGVjayBvbiBhbGwgY29tcG9uZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDb21wb25lbnQ6IEhlYWx0aENvbXBvbmVudCA9IHtcbiAgICAgICAgbmFtZTogJ3Rlc3QnLFxuICAgICAgICBjaGVjazogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBuYW1lOiAndGVzdCcsXG4gICAgICAgICAgc3RhdHVzOiBIZWFsdGhTdGF0dXMuSEVBTFRIWSxcbiAgICAgICAgICBtZXNzYWdlOiAnVGVzdCBjb21wb25lbnQgaGVhbHRoeScsXG4gICAgICAgICAgZHVyYXRpb246IDEwLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgICB9KSxcbiAgICAgICAgaXNSZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgdGltZW91dDogMTAwMFxuICAgICAgfTtcblxuICAgICAgaGVhbHRoTWFuYWdlci5yZWdpc3RlckNvbXBvbmVudChtb2NrQ29tcG9uZW50KTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhbHRoID0gYXdhaXQgaGVhbHRoTWFuYWdlci5jaGVja0hlYWx0aCgpO1xuICAgICAgXG4gICAgICBleHBlY3QoaGVhbHRoLnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuSEVBTFRIWSk7XG4gICAgICBleHBlY3QoaGVhbHRoLmNvbXBvbmVudHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChoZWFsdGguY29tcG9uZW50c1swXS5uYW1lKS50b0JlKCd0ZXN0Jyk7XG4gICAgICBleHBlY3QoaGVhbHRoLnZlcnNpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoaGVhbHRoLnVwdGltZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBvbmVudCB0aW1lb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2xvd0NvbXBvbmVudDogSGVhbHRoQ29tcG9uZW50ID0ge1xuICAgICAgICBuYW1lOiAnc2xvdycsXG4gICAgICAgIGNoZWNrOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFxuICAgICAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSlcbiAgICAgICAgKSxcbiAgICAgICAgaXNSZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgdGltZW91dDogMTAwXG4gICAgICB9O1xuXG4gICAgICBoZWFsdGhNYW5hZ2VyLnJlZ2lzdGVyQ29tcG9uZW50KHNsb3dDb21wb25lbnQpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGggPSBhd2FpdCBoZWFsdGhNYW5hZ2VyLmNoZWNrSGVhbHRoKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChoZWFsdGguc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5VTkhFQUxUSFkpO1xuICAgICAgZXhwZWN0KGhlYWx0aC5jb21wb25lbnRzWzBdLnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuVU5IRUFMVEhZKTtcbiAgICAgIGV4cGVjdChoZWFsdGguY29tcG9uZW50c1swXS5tZXNzYWdlKS50b0NvbnRhaW4oJ3RpbWVvdXQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZXJtaW5lIG92ZXJhbGwgc3RhdHVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGhlYWx0aHlDb21wb25lbnQ6IEhlYWx0aENvbXBvbmVudCA9IHtcbiAgICAgICAgbmFtZTogJ2hlYWx0aHknLFxuICAgICAgICBjaGVjazogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBuYW1lOiAnaGVhbHRoeScsXG4gICAgICAgICAgc3RhdHVzOiBIZWFsdGhTdGF0dXMuSEVBTFRIWSxcbiAgICAgICAgICBtZXNzYWdlOiAnT0snLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMCxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgICAgfSksXG4gICAgICAgIGlzUmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHRpbWVvdXQ6IDEwMDBcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVuaGVhbHRoeUNvbXBvbmVudDogSGVhbHRoQ29tcG9uZW50ID0ge1xuICAgICAgICBuYW1lOiAndW5oZWFsdGh5JyxcbiAgICAgICAgY2hlY2s6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgbmFtZTogJ3VuaGVhbHRoeScsXG4gICAgICAgICAgc3RhdHVzOiBIZWFsdGhTdGF0dXMuVU5IRUFMVEhZLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMCxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgICAgfSksXG4gICAgICAgIGlzUmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHRpbWVvdXQ6IDEwMDBcbiAgICAgIH07XG5cbiAgICAgIGhlYWx0aE1hbmFnZXIucmVnaXN0ZXJDb21wb25lbnQoaGVhbHRoeUNvbXBvbmVudCk7XG4gICAgICBoZWFsdGhNYW5hZ2VyLnJlZ2lzdGVyQ29tcG9uZW50KHVuaGVhbHRoeUNvbXBvbmVudCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGhlYWx0aCA9IGF3YWl0IGhlYWx0aE1hbmFnZXIuY2hlY2tIZWFsdGgoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aC5zdGF0dXMpLnRvQmUoSGVhbHRoU3RhdHVzLlVOSEVBTFRIWSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhY2hlIGhlYWx0aCByZXN1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcG9uZW50OiBIZWFsdGhDb21wb25lbnQgPSB7XG4gICAgICAgIG5hbWU6ICd0ZXN0JyxcbiAgICAgICAgY2hlY2s6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgbmFtZTogJ3Rlc3QnLFxuICAgICAgICAgIHN0YXR1czogSGVhbHRoU3RhdHVzLkhFQUxUSFksXG4gICAgICAgICAgbWVzc2FnZTogJ09LJyxcbiAgICAgICAgICBkdXJhdGlvbjogMTAsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICAgIH0pLFxuICAgICAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICAgICAgICB0aW1lb3V0OiAxMDAwXG4gICAgICB9O1xuXG4gICAgICBoZWFsdGhNYW5hZ2VyLnJlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgICBcbiAgICAgIC8vIEZpcnN0IGNhbGxcbiAgICAgIGNvbnN0IGhlYWx0aDEgPSBhd2FpdCBoZWFsdGhNYW5hZ2VyLmNoZWNrSGVhbHRoKCk7XG4gICAgICAvLyBTZWNvbmQgY2FsbCAoc2hvdWxkIHVzZSBjYWNoZSlcbiAgICAgIGNvbnN0IGhlYWx0aDIgPSBhd2FpdCBoZWFsdGhNYW5hZ2VyLmNoZWNrSGVhbHRoKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb21wb25lbnQuY2hlY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChoZWFsdGgxLnRpbWVzdGFtcCkudG9CZShoZWFsdGgyLnRpbWVzdGFtcCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwZXJpb2RpYyBjaGVja3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdGFydCBhbmQgc3RvcCBwZXJpb2RpYyBjaGVja3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IHN0b3BTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBcbiAgICAgIGhlYWx0aE1hbmFnZXIub24oJ3BlcmlvZGljOnN0YXJ0ZWQnLCBzdGFydFNweSk7XG4gICAgICBoZWFsdGhNYW5hZ2VyLm9uKCdwZXJpb2RpYzpzdG9wcGVkJywgc3RvcFNweSk7XG5cbiAgICAgIGhlYWx0aE1hbmFnZXIuc3RhcnRQZXJpb2RpY0NoZWNrcygpO1xuICAgICAgZXhwZWN0KHN0YXJ0U3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cbiAgICAgIGhlYWx0aE1hbmFnZXIuc3RvcFBlcmlvZGljQ2hlY2tzKCk7XG4gICAgICBleHBlY3Qoc3RvcFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXRpbGl0eSBtZXRob2RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVwdGltZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFdhaXQgYSBzbWFsbCBhbW91bnQgdG8gZW5zdXJlIHVwdGltZSA+IDBcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxKSk7XG4gICAgICBjb25zdCB1cHRpbWUgPSBoZWFsdGhNYW5hZ2VyLmdldFVwdGltZSgpO1xuICAgICAgZXhwZWN0KHVwdGltZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGxhc3QgaGVhbHRoIGNoZWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZXhwZWN0KGhlYWx0aE1hbmFnZXIuZ2V0TGFzdEhlYWx0aENoZWNrKCkpLnRvQmVOdWxsKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGhlYWx0aE1hbmFnZXIuY2hlY2tIZWFsdGgoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aE1hbmFnZXIuZ2V0TGFzdEhlYWx0aENoZWNrKCkpLm5vdC50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjaGVjayBpZiBzeXN0ZW0gaXMgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGhlYWx0aHlDb21wb25lbnQ6IEhlYWx0aENvbXBvbmVudCA9IHtcbiAgICAgICAgbmFtZTogJ3Rlc3QnLFxuICAgICAgICBjaGVjazogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBuYW1lOiAndGVzdCcsXG4gICAgICAgICAgc3RhdHVzOiBIZWFsdGhTdGF0dXMuSEVBTFRIWSxcbiAgICAgICAgICBtZXNzYWdlOiAnT0snLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMCxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgICAgfSksXG4gICAgICAgIGlzUmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHRpbWVvdXQ6IDEwMDBcbiAgICAgIH07XG5cbiAgICAgIGhlYWx0aE1hbmFnZXIucmVnaXN0ZXJDb21wb25lbnQoaGVhbHRoeUNvbXBvbmVudCk7XG4gICAgICBhd2FpdCBoZWFsdGhNYW5hZ2VyLmNoZWNrSGVhbHRoKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChoZWFsdGhNYW5hZ2VyLmlzSGVhbHRoeSgpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnRGF0YWJhc2VIZWFsdGhDb21wb25lbnQnLCAoKSA9PiB7XG4gIGxldCBjb21wb25lbnQ6IERhdGFiYXNlSGVhbHRoQ29tcG9uZW50O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGNvbXBvbmVudCA9IG5ldyBEYXRhYmFzZUhlYWx0aENvbXBvbmVudChtb2NrRGF0YWJhc2VNYW5hZ2VyKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXBvcnQgaGVhbHRoeSB3aGVuIGRhdGFiYXNlIGlzIGhlYWx0aHknLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja0RhdGFiYXNlTWFuYWdlci5pc0hlYWx0aHkubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgIG1vY2tEYXRhYmFzZU1hbmFnZXIuZ2V0TWV0cmljcy5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdG90YWxDb25uZWN0aW9uczogNSxcbiAgICAgIGlkbGVDb25uZWN0aW9uczogMyxcbiAgICAgIHN1Y2Nlc3NmdWxRdWVyaWVzOiAxMDAsXG4gICAgICBmYWlsZWRRdWVyaWVzOiAwXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUoJ2RhdGFiYXNlJyk7XG4gICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0VxdWFsKHtcbiAgICAgIHRvdGFsQ29ubmVjdGlvbnM6IDUsXG4gICAgICBpZGxlQ29ubmVjdGlvbnM6IDMsXG4gICAgICBzdWNjZXNzZnVsUXVlcmllczogMTAwLFxuICAgICAgZmFpbGVkUXVlcmllczogMFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCB1bmhlYWx0aHkgd2hlbiBkYXRhYmFzZSBpcyB1bmhlYWx0aHknLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja0RhdGFiYXNlTWFuYWdlci5pc0hlYWx0aHkubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcbiAgICBtb2NrRGF0YWJhc2VNYW5hZ2VyLmdldE1ldHJpY3MubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIGNvbm5lY3Rpb25FcnJvcnM6IDUsXG4gICAgICBsYXN0SGVhbHRoQ2hlY2s6IERhdGUubm93KClcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbXBvbmVudC5jaGVjaygpO1xuXG4gICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoSGVhbHRoU3RhdHVzLlVOSEVBTFRIWSk7XG4gICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ3VuaGVhbHRoeScpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCB1bmhlYWx0aHkgd2hlbiBkYXRhYmFzZSBtYW5hZ2VyIGlzIG5vdCBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnQgPSBuZXcgRGF0YWJhc2VIZWFsdGhDb21wb25lbnQobnVsbCk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tcG9uZW50LmNoZWNrKCk7XG5cbiAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuVU5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignbm90IGluaXRpYWxpemVkJyk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdDb25maWdIZWFsdGhDb21wb25lbnQnLCAoKSA9PiB7XG4gIGxldCBjb21wb25lbnQ6IENvbmZpZ0hlYWx0aENvbXBvbmVudDtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjb21wb25lbnQgPSBuZXcgQ29uZmlnSGVhbHRoQ29tcG9uZW50KG1vY2tDb25maWcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCBoZWFsdGh5IHdoZW4gY29uZmlndXJhdGlvbiBpcyB2YWxpZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUoJ2NvbmZpZ3VyYXRpb24nKTtcbiAgICBleHBlY3QocmVzdWx0LmRldGFpbHMpLnRvRXF1YWwoe1xuICAgICAgbm9kZUVudjogJ3Rlc3QnLFxuICAgICAgcG9ydDogMzAwMFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCB1bmhlYWx0aHkgd2hlbiByZXF1aXJlZCBmaWVsZHMgYXJlIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgaW52YWxpZENvbmZpZyA9IHsgbm9kZUVudjogJ3Rlc3QnIH07IC8vIG1pc3NpbmcgcG9ydFxuICAgIGNvbnN0IGNvbXBvbmVudCA9IG5ldyBDb25maWdIZWFsdGhDb21wb25lbnQoaW52YWxpZENvbmZpZyk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tcG9uZW50LmNoZWNrKCk7XG5cbiAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuVU5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignTWlzc2luZyByZXF1aXJlZCBjb25maWd1cmF0aW9uJyk7XG4gICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzPy5taXNzaW5nRmllbGRzKS50b0NvbnRhaW4oJ3BvcnQnKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ01lbW9yeUhlYWx0aENvbXBvbmVudCcsICgpID0+IHtcbiAgbGV0IGNvbXBvbmVudDogTWVtb3J5SGVhbHRoQ29tcG9uZW50O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGNvbXBvbmVudCA9IG5ldyBNZW1vcnlIZWFsdGhDb21wb25lbnQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXBvcnQgaGVhbHRoeSB3aGVuIG1lbW9yeSB1c2FnZSBpcyBub3JtYWwnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gTW9jayBwcm9jZXNzLm1lbW9yeVVzYWdlIHRvIHJldHVybiBub3JtYWwgdmFsdWVzXG4gICAgY29uc3Qgb3JpZ2luYWxNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2U7XG4gICAgKHByb2Nlc3MgYXMgYW55KS5tZW1vcnlVc2FnZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgaGVhcFVzZWQ6IDUwICogMTAyNCAqIDEwMjQsIC8vIDUwTUJcbiAgICAgIGhlYXBUb3RhbDogMTAwICogMTAyNCAqIDEwMjQsIC8vIDEwME1CICg1MCUgdXNhZ2UpXG4gICAgICBleHRlcm5hbDogMTAgKiAxMDI0ICogMTAyNCxcbiAgICAgIHJzczogODAgKiAxMDI0ICogMTAyNCxcbiAgICAgIGFycmF5QnVmZmVyczogNSAqIDEwMjQgKiAxMDI0XG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUoJ21lbW9yeScpO1xuICAgIGV4cGVjdChyZXN1bHQuZGV0YWlscz8udXNhZ2VQZXJjZW50YWdlKS50b0JlKDUwKTtcblxuICAgIHByb2Nlc3MubWVtb3J5VXNhZ2UgPSBvcmlnaW5hbE1lbW9yeVVzYWdlO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCBkZWdyYWRlZCB3aGVuIG1lbW9yeSB1c2FnZSBpcyBoaWdoJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG9yaWdpbmFsTWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlO1xuICAgIChwcm9jZXNzIGFzIGFueSkubWVtb3J5VXNhZ2UgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIGhlYXBVc2VkOiA4NSAqIDEwMjQgKiAxMDI0LCAvLyA4NU1CXG4gICAgICBoZWFwVG90YWw6IDEwMCAqIDEwMjQgKiAxMDI0LCAvLyAxMDBNQiAoODUlIHVzYWdlKVxuICAgICAgZXh0ZXJuYWw6IDEwICogMTAyNCAqIDEwMjQsXG4gICAgICByc3M6IDEyMCAqIDEwMjQgKiAxMDI0LFxuICAgICAgYXJyYXlCdWZmZXJzOiA1ICogMTAyNCAqIDEwMjRcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbXBvbmVudC5jaGVjaygpO1xuXG4gICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoSGVhbHRoU3RhdHVzLkRFR1JBREVEKTtcbiAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignSGlnaCBtZW1vcnkgdXNhZ2UnKTtcblxuICAgIHByb2Nlc3MubWVtb3J5VXNhZ2UgPSBvcmlnaW5hbE1lbW9yeVVzYWdlO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCB1bmhlYWx0aHkgd2hlbiBtZW1vcnkgdXNhZ2UgaXMgY3JpdGljYWwnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2U7XG4gICAgKHByb2Nlc3MgYXMgYW55KS5tZW1vcnlVc2FnZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgaGVhcFVzZWQ6IDk1ICogMTAyNCAqIDEwMjQsIC8vIDk1TUJcbiAgICAgIGhlYXBUb3RhbDogMTAwICogMTAyNCAqIDEwMjQsIC8vIDEwME1CICg5NSUgdXNhZ2UpXG4gICAgICBleHRlcm5hbDogMTAgKiAxMDI0ICogMTAyNCxcbiAgICAgIHJzczogMTUwICogMTAyNCAqIDEwMjQsXG4gICAgICBhcnJheUJ1ZmZlcnM6IDUgKiAxMDI0ICogMTAyNFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tcG9uZW50LmNoZWNrKCk7XG5cbiAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuVU5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignQ3JpdGljYWwgbWVtb3J5IHVzYWdlJyk7XG5cbiAgICBwcm9jZXNzLm1lbW9yeVVzYWdlID0gb3JpZ2luYWxNZW1vcnlVc2FnZTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1JlZGlzSGVhbHRoQ29tcG9uZW50JywgKCkgPT4ge1xuICBsZXQgY29tcG9uZW50OiBSZWRpc0hlYWx0aENvbXBvbmVudDtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBjb21wb25lbnQgPSBuZXcgUmVkaXNIZWFsdGhDb21wb25lbnQobW9ja0NhY2hlTWFuYWdlcik7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVwb3J0IGhlYWx0aHkgd2hlbiBSZWRpcyBpcyBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja0NhY2hlTWFuYWdlci5pc0hlYWx0aHkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5IRUFMVEhZKTtcbiAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUoJ3JlZGlzJyk7XG4gICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ2hlYWx0aHknKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXBvcnQgZGVncmFkZWQgd2hlbiBSZWRpcyBpcyB1bmF2YWlsYWJsZScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrQ2FjaGVNYW5hZ2VyLmlzSGVhbHRoeS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5ERUdSQURFRCk7XG4gICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ3VuYXZhaWxhYmxlJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVwb3J0IGRlZ3JhZGVkIHdoZW4gUmVkaXMgaXMgbm90IGNvbmZpZ3VyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50ID0gbmV3IFJlZGlzSGVhbHRoQ29tcG9uZW50KCk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29tcG9uZW50LmNoZWNrKCk7XG5cbiAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShIZWFsdGhTdGF0dXMuREVHUkFERUQpO1xuICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdub3QgY29uZmlndXJlZCcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlcG9ydCBkZWdyYWRlZCB3aGVuIFJlZGlzIGNoZWNrIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tDYWNoZU1hbmFnZXIuaXNIZWFsdGh5Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29ubmVjdGlvbiBmYWlsZWQnKSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb21wb25lbnQuY2hlY2soKTtcblxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKEhlYWx0aFN0YXR1cy5ERUdSQURFRCk7XG4gICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ2NoZWNrIGZhaWxlZCcpO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==