ef71412d7faaae61e70b67f5a44a3e8d
"use strict";
/**
 * Property-based tests for SecurityAuditLogger
 *
 * Property 9: Audit Trail Integrity
 * Validates: Requirements 6.5
 *
 * Tests that all security events are properly logged and audit trails maintain integrity
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fast_check_1 = __importDefault(require("fast-check"));
const SecurityAuditLogger_js_1 = require("../../src/security/SecurityAuditLogger.js");
const fs_1 = require("fs");
const path_1 = require("path");
describe('SecurityAuditLogger Property Tests', () => {
    const testLogDir = './test-logs/security';
    let auditLogger;
    let originalConsoleError;
    beforeEach(() => {
        // Mock console.error to suppress security alert spam during tests
        originalConsoleError = console.error;
        console.error = jest.fn();
        // Clean up test directory
        if ((0, fs_1.existsSync)(testLogDir)) {
            (0, fs_1.rmSync)(testLogDir, { recursive: true, force: true });
        }
        (0, fs_1.mkdirSync)(testLogDir, { recursive: true });
        // Create fresh audit logger for each test
        auditLogger = new SecurityAuditLogger_js_1.SecurityAuditLogger({
            logDirectory: testLogDir,
            maxLogFileSize: 1024 * 1024, // 1MB for testing
            retentionDays: 30,
            enableThreatDetection: false, // Disable for most tests to avoid complexity
            alertThresholds: {
                authFailuresPerMinute: 5,
                validationFailuresPerMinute: 20,
                suspiciousActivityPerHour: 10
            }
        });
    });
    afterEach(() => {
        // Restore console.error
        console.error = originalConsoleError;
        // Clean up test directory
        if ((0, fs_1.existsSync)(testLogDir)) {
            (0, fs_1.rmSync)(testLogDir, { recursive: true, force: true });
        }
    });
    /**
     * Property: All security events must be logged to audit trail
     *
     * For any valid security event, it must be written to the audit log file
     * and be retrievable with all original data intact.
     */
    test('Property: All security events are logged to audit trail', () => {
        fast_check_1.default.assert(fast_check_1.default.property(
        // Generate valid security event data
        fast_check_1.default.record({
            eventType: fast_check_1.default.constantFrom('AUTH_SUCCESS', 'AUTH_FAILURE', 'VALIDATION_FAILURE', 'HMAC_FAILURE', 'RATE_LIMIT_EXCEEDED', 'SUSPICIOUS_ACTIVITY', 'PRIVILEGE_ESCALATION', 'DATA_ACCESS', 'CONFIG_CHANGE', 'EMERGENCY_ACTION'),
            severity: fast_check_1.default.constantFrom('INFO', 'WARNING', 'CRITICAL'),
            clientIp: fast_check_1.default.ipV4(),
            userAgent: fast_check_1.default.option(fast_check_1.default.string({ minLength: 1, maxLength: 200 }), { nil: undefined }),
            operatorId: fast_check_1.default.option(fast_check_1.default.string({ minLength: 1, maxLength: 50 }), { nil: undefined }),
            endpoint: fast_check_1.default.option(fast_check_1.default.webPath(), { nil: undefined }),
            method: fast_check_1.default.option(fast_check_1.default.constantFrom('GET', 'POST', 'PUT', 'DELETE'), { nil: undefined }),
            details: fast_check_1.default.record({
                action: fast_check_1.default.string({ minLength: 1, maxLength: 100 }),
                additionalData: fast_check_1.default.option(fast_check_1.default.string({ maxLength: 500 }), { nil: undefined })
            }),
            correlationId: fast_check_1.default.option(fast_check_1.default.uuid(), { nil: undefined })
        }), (eventData) => {
            // Log the security event
            auditLogger.logSecurityEvent(eventData);
            // Get today's log file
            const today = new Date().toISOString().split('T')[0];
            const logFile = (0, path_1.join)(testLogDir, `security-audit-${today}.jsonl`);
            // Verify log file exists
            expect((0, fs_1.existsSync)(logFile)).toBe(true);
            // Read and parse log file
            const logContent = (0, fs_1.readFileSync)(logFile, 'utf8');
            const logLines = logContent.trim().split('\n');
            // Should have at least one log entry
            expect(logLines.length).toBeGreaterThan(0);
            // Parse the last log entry (most recent)
            const lastLogEntry = JSON.parse(logLines[logLines.length - 1]);
            // Verify all required fields are present
            expect(lastLogEntry).toHaveProperty('timestamp');
            expect(lastLogEntry).toHaveProperty('eventType');
            expect(lastLogEntry).toHaveProperty('severity');
            expect(lastLogEntry).toHaveProperty('clientIp');
            expect(lastLogEntry).toHaveProperty('details');
            // Verify data integrity
            expect(lastLogEntry.eventType).toBe(eventData.eventType);
            expect(lastLogEntry.severity).toBe(eventData.severity);
            expect(lastLogEntry.clientIp).toBe(eventData.clientIp);
            expect(lastLogEntry.details).toEqual(eventData.details);
            // Verify optional fields if present
            if (eventData.userAgent) {
                expect(lastLogEntry.userAgent).toBe(eventData.userAgent);
            }
            if (eventData.operatorId) {
                expect(lastLogEntry.operatorId).toBe(eventData.operatorId);
            }
            if (eventData.endpoint) {
                expect(lastLogEntry.endpoint).toBe(eventData.endpoint);
            }
            if (eventData.method) {
                expect(lastLogEntry.method).toBe(eventData.method);
            }
            if (eventData.correlationId) {
                expect(lastLogEntry.correlationId).toBe(eventData.correlationId);
            }
            // Verify timestamp is valid ISO string
            expect(() => new Date(lastLogEntry.timestamp)).not.toThrow();
            expect(new Date(lastLogEntry.timestamp).toISOString()).toBe(lastLogEntry.timestamp);
        }), { numRuns: 50 });
    });
    /**
     * Property: Audit trail maintains chronological order
     *
     * Events logged in sequence must appear in the audit trail in the same order
     * with monotonically increasing timestamps.
     */
    test('Property: Audit trail maintains chronological order', () => {
        fast_check_1.default.assert(fast_check_1.default.property(
        // Generate array of security events
        fast_check_1.default.array(fast_check_1.default.record({
            eventType: fast_check_1.default.constantFrom('AUTH_SUCCESS', 'DATA_ACCESS', 'CONFIG_CHANGE'),
            severity: fast_check_1.default.constantFrom('INFO', 'WARNING'),
            clientIp: fast_check_1.default.ipV4(),
            details: fast_check_1.default.record({
                action: fast_check_1.default.string({ minLength: 1, maxLength: 50 })
            })
        }), { minLength: 2, maxLength: 10 }), (events) => {
            // Log all events in sequence
            events.forEach(event => {
                auditLogger.logSecurityEvent(event);
                // Small delay to ensure different timestamps
                const start = Date.now();
                while (Date.now() - start < 2) { /* busy wait */ }
            });
            // Read log file
            const today = new Date().toISOString().split('T')[0];
            const logFile = (0, path_1.join)(testLogDir, `security-audit-${today}.jsonl`);
            const logContent = (0, fs_1.readFileSync)(logFile, 'utf8');
            const logLines = logContent.trim().split('\n');
            // Should have at least as many entries as events
            expect(logLines.length).toBeGreaterThanOrEqual(events.length);
            // Get the last N entries (corresponding to our events)
            const relevantEntries = logLines.slice(-events.length);
            const parsedEntries = relevantEntries.map(line => JSON.parse(line));
            // Verify chronological order
            for (let i = 1; i < parsedEntries.length; i++) {
                const prevTimestamp = new Date(parsedEntries[i - 1].timestamp);
                const currTimestamp = new Date(parsedEntries[i].timestamp);
                // Current timestamp should be >= previous timestamp
                expect(currTimestamp.getTime()).toBeGreaterThanOrEqual(prevTimestamp.getTime());
            }
            // Verify event data matches in order
            for (let i = 0; i < events.length; i++) {
                expect(parsedEntries[i].eventType).toBe(events[i].eventType);
                expect(parsedEntries[i].severity).toBe(events[i].severity);
                expect(parsedEntries[i].clientIp).toBe(events[i].clientIp);
            }
        }), { numRuns: 20 });
    });
    /**
     * Property: Threat detection patterns are consistently applied
     *
     * Any input containing threat patterns must trigger suspicious activity logging
     * in addition to the original event.
     */
    test('Property: Threat detection patterns are consistently applied', () => {
        // Create a separate audit logger with threat detection enabled for this test
        const threatDetectionLogger = new SecurityAuditLogger_js_1.SecurityAuditLogger({
            logDirectory: testLogDir,
            maxLogFileSize: 1024 * 1024,
            retentionDays: 30,
            enableThreatDetection: true,
            alertThresholds: {
                authFailuresPerMinute: 5,
                validationFailuresPerMinute: 20,
                suspiciousActivityPerHour: 10
            }
        });
        fast_check_1.default.assert(fast_check_1.default.property(fast_check_1.default.record({
            baseEvent: fast_check_1.default.record({
                eventType: fast_check_1.default.constantFrom('VALIDATION_FAILURE', 'DATA_ACCESS'),
                severity: fast_check_1.default.constantFrom('WARNING', 'INFO'),
                clientIp: fast_check_1.default.ipV4(),
                endpoint: fast_check_1.default.webPath()
            }),
            threatPattern: fast_check_1.default.constantFrom('union select * from users', // SQL injection
            '<script>alert("xss")</script>', // XSS
            '../../../etc/passwd', // Path traversal
            'rm -rf /', // Command injection
            'x'.repeat(15000) // Excessive size
            )
        }), ({ baseEvent, threatPattern }) => {
            // Create event with threat pattern in details
            const eventWithThreat = {
                ...baseEvent,
                details: {
                    action: 'test_action',
                    userInput: threatPattern,
                    additionalData: 'normal data'
                }
            };
            // Log the event
            threatDetectionLogger.logSecurityEvent(eventWithThreat);
            // Read log file
            const today = new Date().toISOString().split('T')[0];
            const logFile = (0, path_1.join)(testLogDir, `security-audit-${today}.jsonl`);
            const logContent = (0, fs_1.readFileSync)(logFile, 'utf8');
            const logLines = logContent.trim().split('\n');
            // Should have at least 2 entries: original event + suspicious activity
            expect(logLines.length).toBeGreaterThanOrEqual(2);
            const parsedEntries = logLines.map(line => JSON.parse(line));
            // Find the original event
            const originalEvent = parsedEntries.find(entry => entry.eventType === baseEvent.eventType &&
                entry.clientIp === baseEvent.clientIp);
            expect(originalEvent).toBeDefined();
            // Find the suspicious activity event
            const suspiciousEvent = parsedEntries.find(entry => entry.eventType === 'SUSPICIOUS_ACTIVITY' &&
                entry.clientIp === baseEvent.clientIp);
            expect(suspiciousEvent).toBeDefined();
            // Verify suspicious event details
            expect(suspiciousEvent.severity).toBe('CRITICAL');
            expect(suspiciousEvent.details.action).toBe('suspicious_activity');
            expect(suspiciousEvent.details).toHaveProperty('threatPattern');
            expect(suspiciousEvent.details).toHaveProperty('description');
            expect(suspiciousEvent.details.originalEventType).toBe(baseEvent.eventType);
        }), { numRuns: 10 } // Reduced runs for this complex test
        );
    });
    /**
     * Property: Alert thresholds trigger appropriate responses
     *
     * When event counts exceed configured thresholds within time windows,
     * appropriate alerts must be triggered and logged.
     */
    test('Property: Alert thresholds trigger appropriate responses', () => {
        fast_check_1.default.assert(fast_check_1.default.property(fast_check_1.default.record({
            clientIp: fast_check_1.default.ipV4(),
            eventCount: fast_check_1.default.integer({ min: 6, max: 15 }), // Above threshold of 5
            eventType: fast_check_1.default.constantFrom('AUTH_FAILURE', 'VALIDATION_FAILURE')
        }), ({ clientIp, eventCount, eventType }) => {
            // Log multiple events of the same type from same IP
            for (let i = 0; i < eventCount; i++) {
                if (eventType === 'AUTH_FAILURE') {
                    auditLogger.logAuthenticationFailure(clientIp, `user_${i}`, 'invalid_credentials', '/api/auth');
                }
                else {
                    auditLogger.logValidationFailure(clientIp, '/api/signal', [`validation_error_${i}`]);
                }
            }
            // Read log file
            const today = new Date().toISOString().split('T')[0];
            const logFile = (0, path_1.join)(testLogDir, `security-audit-${today}.jsonl`);
            const logContent = (0, fs_1.readFileSync)(logFile, 'utf8');
            const logLines = logContent.trim().split('\n');
            const parsedEntries = logLines.map(line => JSON.parse(line));
            // Count events of the specified type from the client IP
            const eventsFromIp = parsedEntries.filter(entry => entry.eventType === eventType && entry.clientIp === clientIp);
            // Should have logged all events
            expect(eventsFromIp.length).toBe(eventCount);
            // Since we exceeded threshold (5), there should be additional log entries
            // indicating the alert was triggered (logged as errors)
            // This is implementation-specific - the alert is logged via structured logger
            // For this test, we verify that the threshold was indeed exceeded
            expect(eventCount).toBeGreaterThan(5);
        }), { numRuns: 15 });
    });
    /**
     * Property: Audit log format is consistent and parseable
     *
     * All audit log entries must be valid JSON with consistent structure
     * and all required fields present.
     */
    test('Property: Audit log format is consistent and parseable', () => {
        fast_check_1.default.assert(fast_check_1.default.property(fast_check_1.default.array(fast_check_1.default.record({
            eventType: fast_check_1.default.constantFrom('AUTH_SUCCESS', 'AUTH_FAILURE', 'VALIDATION_FAILURE', 'HMAC_FAILURE', 'SUSPICIOUS_ACTIVITY', 'DATA_ACCESS'),
            severity: fast_check_1.default.constantFrom('INFO', 'WARNING', 'CRITICAL'),
            clientIp: fast_check_1.default.ipV4(),
            details: fast_check_1.default.record({
                action: fast_check_1.default.string({ minLength: 1, maxLength: 100 }),
                data: fast_check_1.default.option(fast_check_1.default.string({ maxLength: 200 }))
            })
        }), { minLength: 1, maxLength: 20 }), (events) => {
            // Log all events
            events.forEach(event => auditLogger.logSecurityEvent(event));
            // Read log file
            const today = new Date().toISOString().split('T')[0];
            const logFile = (0, path_1.join)(testLogDir, `security-audit-${today}.jsonl`);
            const logContent = (0, fs_1.readFileSync)(logFile, 'utf8');
            const logLines = logContent.trim().split('\n').filter(line => line.length > 0);
            // Every line should be valid JSON
            logLines.forEach(line => {
                expect(() => JSON.parse(line)).not.toThrow();
                const entry = JSON.parse(line);
                // Verify required fields
                expect(entry).toHaveProperty('timestamp');
                expect(entry).toHaveProperty('eventType');
                expect(entry).toHaveProperty('severity');
                expect(entry).toHaveProperty('clientIp');
                expect(entry).toHaveProperty('details');
                // Verify field types
                expect(typeof entry.timestamp).toBe('string');
                expect(typeof entry.eventType).toBe('string');
                expect(typeof entry.severity).toBe('string');
                expect(typeof entry.clientIp).toBe('string');
                expect(typeof entry.details).toBe('object');
                // Verify timestamp is valid ISO string
                expect(() => new Date(entry.timestamp)).not.toThrow();
                expect(new Date(entry.timestamp).toISOString()).toBe(entry.timestamp);
                // Verify enum values
                expect(['AUTH_SUCCESS', 'AUTH_FAILURE', 'VALIDATION_FAILURE', 'HMAC_FAILURE',
                    'RATE_LIMIT_EXCEEDED', 'SUSPICIOUS_ACTIVITY', 'PRIVILEGE_ESCALATION',
                    'DATA_ACCESS', 'CONFIG_CHANGE', 'EMERGENCY_ACTION']).toContain(entry.eventType);
                expect(['INFO', 'WARNING', 'CRITICAL']).toContain(entry.severity);
            });
        }), { numRuns: 25 });
    });
    /**
     * Property: Security statistics accurately reflect logged events
     *
     * The getSecurityStatistics method must return counts that match
     * the actual events logged within the specified time range.
     */
    test('Property: Security statistics accurately reflect logged events', () => {
        fast_check_1.default.assert(fast_check_1.default.property(fast_check_1.default.record({
            clientIp: fast_check_1.default.ipV4(),
            authFailures: fast_check_1.default.integer({ min: 1, max: 10 }),
            validationFailures: fast_check_1.default.integer({ min: 1, max: 10 })
        }), ({ clientIp, authFailures, validationFailures }) => {
            // Log authentication failures
            for (let i = 0; i < authFailures; i++) {
                auditLogger.logAuthenticationFailure(clientIp, `user_${i}`, 'invalid_password', '/api/auth');
            }
            // Log validation failures
            for (let i = 0; i < validationFailures; i++) {
                auditLogger.logValidationFailure(clientIp, '/api/signal', [`error_${i}`]);
            }
            // Get statistics
            const stats = auditLogger.getSecurityStatistics(1); // Last 1 hour
            // Verify counts match what we logged
            const authFailureKey = `auth_failure_${clientIp}`;
            const validationFailureKey = `validation_failure_${clientIp}`;
            if (stats[authFailureKey]) {
                expect(stats[authFailureKey]).toBe(authFailures);
            }
            if (stats[validationFailureKey]) {
                expect(stats[validationFailureKey]).toBe(validationFailures);
            }
            // Statistics should only contain non-negative numbers
            Object.values(stats).forEach(count => {
                expect(typeof count).toBe('number');
                expect(count).toBeGreaterThanOrEqual(0);
            });
        }), { numRuns: 20 });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3Byb3BlcnR5L1NlY3VyaXR5QXVkaXRMb2dnZXIucHJvcGVydHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7Ozs7QUFFSCw0REFBNEI7QUFDNUIsc0ZBQXFIO0FBQ3JILDJCQUFpRTtBQUNqRSwrQkFBNEI7QUFFNUIsUUFBUSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtJQUNsRCxNQUFNLFVBQVUsR0FBRyxzQkFBc0IsQ0FBQztJQUMxQyxJQUFJLFdBQWdDLENBQUM7SUFDckMsSUFBSSxvQkFBMEMsQ0FBQztJQUUvQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2Qsa0VBQWtFO1FBQ2xFLG9CQUFvQixHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDckMsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFFMUIsMEJBQTBCO1FBQzFCLElBQUksSUFBQSxlQUFVLEVBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUMzQixJQUFBLFdBQU0sRUFBQyxVQUFVLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7UUFDRCxJQUFBLGNBQVMsRUFBQyxVQUFVLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUzQywwQ0FBMEM7UUFDMUMsV0FBVyxHQUFHLElBQUksNENBQW1CLENBQUM7WUFDcEMsWUFBWSxFQUFFLFVBQVU7WUFDeEIsY0FBYyxFQUFFLElBQUksR0FBRyxJQUFJLEVBQUUsa0JBQWtCO1lBQy9DLGFBQWEsRUFBRSxFQUFFO1lBQ2pCLHFCQUFxQixFQUFFLEtBQUssRUFBRSw2Q0FBNkM7WUFDM0UsZUFBZSxFQUFFO2dCQUNmLHFCQUFxQixFQUFFLENBQUM7Z0JBQ3hCLDJCQUEyQixFQUFFLEVBQUU7Z0JBQy9CLHlC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LENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjO1lBRWxFLHFDQUFxQztZQUNyQyxNQUFNLGNBQWMsR0FBRyxnQkFBZ0IsUUFBUSxFQUFFLENBQUM7WUFDbEQsTUFBTSxvQkFBb0IsR0FBRyxzQkFBc0IsUUFBUSxFQUFFLENBQUM7WUFFOUQsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztnQkFDMUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNuRCxDQUFDO1lBQ0QsSUFBSSxLQUFLLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDO2dCQUNoQyxNQUFNLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUMvRCxDQUFDO1lBRUQsc0RBQXNEO1lBQ3RELE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNuQyxNQUFNLENBQUMsT0FBTyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FDRixFQUNELEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUNoQixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvcHJvcGVydHkvU2VjdXJpdHlBdWRpdExvZ2dlci5wcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUHJvcGVydHktYmFzZWQgdGVzdHMgZm9yIFNlY3VyaXR5QXVkaXRMb2dnZXJcbiAqIFxuICogUHJvcGVydHkgOTogQXVkaXQgVHJhaWwgSW50ZWdyaXR5XG4gKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyA2LjVcbiAqIFxuICogVGVzdHMgdGhhdCBhbGwgc2VjdXJpdHkgZXZlbnRzIGFyZSBwcm9wZXJseSBsb2dnZWQgYW5kIGF1ZGl0IHRyYWlscyBtYWludGFpbiBpbnRlZ3JpdHlcbiAqL1xuXG5pbXBvcnQgZmMgZnJvbSAnZmFzdC1jaGVjayc7XG5pbXBvcnQgeyBTZWN1cml0eUF1ZGl0TG9nZ2VyLCBTZWN1cml0eUV2ZW50VHlwZSwgU2VjdXJpdHlTZXZlcml0eSB9IGZyb20gJy4uLy4uL3NyYy9zZWN1cml0eS9TZWN1cml0eUF1ZGl0TG9nZ2VyLmpzJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYywgZXhpc3RzU3luYywgcm1TeW5jLCBta2RpclN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5cbmRlc2NyaWJlKCdTZWN1cml0eUF1ZGl0TG9nZ2VyIFByb3BlcnR5IFRlc3RzJywgKCkgPT4ge1xuICBjb25zdCB0ZXN0TG9nRGlyID0gJy4vdGVzdC1sb2dzL3NlY3VyaXR5JztcbiAgbGV0IGF1ZGl0TG9nZ2VyOiBTZWN1cml0eUF1ZGl0TG9nZ2VyO1xuICBsZXQgb3JpZ2luYWxDb25zb2xlRXJyb3I6IHR5cGVvZiBjb25zb2xlLmVycm9yO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIE1vY2sgY29uc29sZS5lcnJvciB0byBzdXBwcmVzcyBzZWN1cml0eSBhbGVydCBzcGFtIGR1cmluZyB0ZXN0c1xuICAgIG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcbiAgICBjb25zb2xlLmVycm9yID0gamVzdC5mbigpO1xuXG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkaXJlY3RvcnlcbiAgICBpZiAoZXhpc3RzU3luYyh0ZXN0TG9nRGlyKSkge1xuICAgICAgcm1TeW5jKHRlc3RMb2dEaXIsIHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9KTtcbiAgICB9XG4gICAgbWtkaXJTeW5jKHRlc3RMb2dEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGZyZXNoIGF1ZGl0IGxvZ2dlciBmb3IgZWFjaCB0ZXN0XG4gICAgYXVkaXRMb2dnZXIgPSBuZXcgU2VjdXJpdHlBdWRpdExvZ2dlcih7XG4gICAgICBsb2dEaXJlY3Rvcnk6IHRlc3RMb2dEaXIsXG4gICAgICBtYXhMb2dGaWxlU2l6ZTogMTAyNCAqIDEwMjQsIC8vIDFNQiBmb3IgdGVzdGluZ1xuICAgICAgcmV0ZW50aW9uRGF5czogMzAsXG4gICAgICBlbmFibGVUaHJlYXREZXRlY3Rpb246IGZhbHNlLCAvLyBEaXNhYmxlIGZvciBtb3N0IHRlc3RzIHRvIGF2b2lkIGNvbXBsZXhpdHlcbiAgICAgIGFsZXJ0VGhyZXNob2xkczoge1xuICAgICAgICBhdXRoRmFpbHVyZXNQZXJNaW51dGU6IDUsXG4gICAgICAgIHZhbGlkYXRpb25GYWlsdXJlc1Blck1pbnV0ZTogMjAsXG4gICAgICAgIHN1c3BpY2lvdXNBY3Rpdml0eVBlckhvdXI6IDEwXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgLy8gUmVzdG9yZSBjb25zb2xlLmVycm9yXG4gICAgY29uc29sZS5lcnJvciA9IG9yaWdpbmFsQ29uc29sZUVycm9yO1xuXG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkaXJlY3RvcnlcbiAgICBpZiAoZXhpc3RzU3luYyh0ZXN0TG9nRGlyKSkge1xuICAgICAgcm1TeW5jKHRlc3RMb2dEaXIsIHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0eTogQWxsIHNlY3VyaXR5IGV2ZW50cyBtdXN0IGJlIGxvZ2dlZCB0byBhdWRpdCB0cmFpbFxuICAgKiBcbiAgICogRm9yIGFueSB2YWxpZCBzZWN1cml0eSBldmVudCwgaXQgbXVzdCBiZSB3cml0dGVuIHRvIHRoZSBhdWRpdCBsb2cgZmlsZVxuICAgKiBhbmQgYmUgcmV0cmlldmFibGUgd2l0aCBhbGwgb3JpZ2luYWwgZGF0YSBpbnRhY3QuXG4gICAqL1xuICB0ZXN0KCdQcm9wZXJ0eTogQWxsIHNlY3VyaXR5IGV2ZW50cyBhcmUgbG9nZ2VkIHRvIGF1ZGl0IHRyYWlsJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAvLyBHZW5lcmF0ZSB2YWxpZCBzZWN1cml0eSBldmVudCBkYXRhXG4gICAgICAgIGZjLnJlY29yZCh7XG4gICAgICAgICAgZXZlbnRUeXBlOiBmYy5jb25zdGFudEZyb20oXG4gICAgICAgICAgICAnQVVUSF9TVUNDRVNTJywgJ0FVVEhfRkFJTFVSRScsICdWQUxJREFUSU9OX0ZBSUxVUkUnLCBcbiAgICAgICAgICAgICdITUFDX0ZBSUxVUkUnLCAnUkFURV9MSU1JVF9FWENFRURFRCcsICdTVVNQSUNJT1VTX0FDVElWSVRZJyxcbiAgICAgICAgICAgICdQUklWSUxFR0VfRVNDQUxBVElPTicsICdEQVRBX0FDQ0VTUycsICdDT05GSUdfQ0hBTkdFJywgJ0VNRVJHRU5DWV9BQ1RJT04nXG4gICAgICAgICAgKSBhcyBmYy5BcmJpdHJhcnk8U2VjdXJpdHlFdmVudFR5cGU+LFxuICAgICAgICAgIHNldmVyaXR5OiBmYy5jb25zdGFudEZyb20oJ0lORk8nLCAnV0FSTklORycsICdDUklUSUNBTCcpIGFzIGZjLkFyYml0cmFyeTxTZWN1cml0eVNldmVyaXR5PixcbiAgICAgICAgICBjbGllbnRJcDogZmMuaXBWNCgpLFxuICAgICAgICAgIHVzZXJBZ2VudDogZmMub3B0aW9uKGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiAyMDAgfSksIHsgbmlsOiB1bmRlZmluZWQgfSksXG4gICAgICAgICAgb3BlcmF0b3JJZDogZmMub3B0aW9uKGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiA1MCB9KSwgeyBuaWw6IHVuZGVmaW5lZCB9KSxcbiAgICAgICAgICBlbmRwb2ludDogZmMub3B0aW9uKGZjLndlYlBhdGgoKSwgeyBuaWw6IHVuZGVmaW5lZCB9KSxcbiAgICAgICAgICBtZXRob2Q6IGZjLm9wdGlvbihmYy5jb25zdGFudEZyb20oJ0dFVCcsICdQT1NUJywgJ1BVVCcsICdERUxFVEUnKSwgeyBuaWw6IHVuZGVmaW5lZCB9KSxcbiAgICAgICAgICBkZXRhaWxzOiBmYy5yZWNvcmQoe1xuICAgICAgICAgICAgYWN0aW9uOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAwIH0pLFxuICAgICAgICAgICAgYWRkaXRpb25hbERhdGE6IGZjLm9wdGlvbihmYy5zdHJpbmcoeyBtYXhMZW5ndGg6IDUwMCB9KSwgeyBuaWw6IHVuZGVmaW5lZCB9KVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNvcnJlbGF0aW9uSWQ6IGZjLm9wdGlvbihmYy51dWlkKCksIHsgbmlsOiB1bmRlZmluZWQgfSlcbiAgICAgICAgfSksXG4gICAgICAgIChldmVudERhdGEpID0+IHtcbiAgICAgICAgICAvLyBMb2cgdGhlIHNlY3VyaXR5IGV2ZW50XG4gICAgICAgICAgYXVkaXRMb2dnZXIubG9nU2VjdXJpdHlFdmVudChldmVudERhdGEpO1xuXG4gICAgICAgICAgLy8gR2V0IHRvZGF5J3MgbG9nIGZpbGVcbiAgICAgICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgICAgICAgIGNvbnN0IGxvZ0ZpbGUgPSBqb2luKHRlc3RMb2dEaXIsIGBzZWN1cml0eS1hdWRpdC0ke3RvZGF5fS5qc29ubGApO1xuXG4gICAgICAgICAgLy8gVmVyaWZ5IGxvZyBmaWxlIGV4aXN0c1xuICAgICAgICAgIGV4cGVjdChleGlzdHNTeW5jKGxvZ0ZpbGUpKS50b0JlKHRydWUpO1xuXG4gICAgICAgICAgLy8gUmVhZCBhbmQgcGFyc2UgbG9nIGZpbGVcbiAgICAgICAgICBjb25zdCBsb2dDb250ZW50ID0gcmVhZEZpbGVTeW5jKGxvZ0ZpbGUsICd1dGY4Jyk7XG4gICAgICAgICAgY29uc3QgbG9nTGluZXMgPSBsb2dDb250ZW50LnRyaW0oKS5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2hvdWxkIGhhdmUgYXQgbGVhc3Qgb25lIGxvZyBlbnRyeVxuICAgICAgICAgIGV4cGVjdChsb2dMaW5lcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcblxuICAgICAgICAgIC8vIFBhcnNlIHRoZSBsYXN0IGxvZyBlbnRyeSAobW9zdCByZWNlbnQpXG4gICAgICAgICAgY29uc3QgbGFzdExvZ0VudHJ5ID0gSlNPTi5wYXJzZShsb2dMaW5lc1tsb2dMaW5lcy5sZW5ndGggLSAxXSk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgYWxsIHJlcXVpcmVkIGZpZWxkcyBhcmUgcHJlc2VudFxuICAgICAgICAgIGV4cGVjdChsYXN0TG9nRW50cnkpLnRvSGF2ZVByb3BlcnR5KCd0aW1lc3RhbXAnKTtcbiAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5KS50b0hhdmVQcm9wZXJ0eSgnZXZlbnRUeXBlJyk7XG4gICAgICAgICAgZXhwZWN0KGxhc3RMb2dFbnRyeSkudG9IYXZlUHJvcGVydHkoJ3NldmVyaXR5Jyk7XG4gICAgICAgICAgZXhwZWN0KGxhc3RMb2dFbnRyeSkudG9IYXZlUHJvcGVydHkoJ2NsaWVudElwJyk7XG4gICAgICAgICAgZXhwZWN0KGxhc3RMb2dFbnRyeSkudG9IYXZlUHJvcGVydHkoJ2RldGFpbHMnKTtcblxuICAgICAgICAgIC8vIFZlcmlmeSBkYXRhIGludGVncml0eVxuICAgICAgICAgIGV4cGVjdChsYXN0TG9nRW50cnkuZXZlbnRUeXBlKS50b0JlKGV2ZW50RGF0YS5ldmVudFR5cGUpO1xuICAgICAgICAgIGV4cGVjdChsYXN0TG9nRW50cnkuc2V2ZXJpdHkpLnRvQmUoZXZlbnREYXRhLnNldmVyaXR5KTtcbiAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5LmNsaWVudElwKS50b0JlKGV2ZW50RGF0YS5jbGllbnRJcCk7XG4gICAgICAgICAgZXhwZWN0KGxhc3RMb2dFbnRyeS5kZXRhaWxzKS50b0VxdWFsKGV2ZW50RGF0YS5kZXRhaWxzKTtcblxuICAgICAgICAgIC8vIFZlcmlmeSBvcHRpb25hbCBmaWVsZHMgaWYgcHJlc2VudFxuICAgICAgICAgIGlmIChldmVudERhdGEudXNlckFnZW50KSB7XG4gICAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5LnVzZXJBZ2VudCkudG9CZShldmVudERhdGEudXNlckFnZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGV2ZW50RGF0YS5vcGVyYXRvcklkKSB7XG4gICAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5Lm9wZXJhdG9ySWQpLnRvQmUoZXZlbnREYXRhLm9wZXJhdG9ySWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZXZlbnREYXRhLmVuZHBvaW50KSB7XG4gICAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5LmVuZHBvaW50KS50b0JlKGV2ZW50RGF0YS5lbmRwb2ludCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChldmVudERhdGEubWV0aG9kKSB7XG4gICAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5Lm1ldGhvZCkudG9CZShldmVudERhdGEubWV0aG9kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGV2ZW50RGF0YS5jb3JyZWxhdGlvbklkKSB7XG4gICAgICAgICAgICBleHBlY3QobGFzdExvZ0VudHJ5LmNvcnJlbGF0aW9uSWQpLnRvQmUoZXZlbnREYXRhLmNvcnJlbGF0aW9uSWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFZlcmlmeSB0aW1lc3RhbXAgaXMgdmFsaWQgSVNPIHN0cmluZ1xuICAgICAgICAgIGV4cGVjdCgoKSA9PiBuZXcgRGF0ZShsYXN0TG9nRW50cnkudGltZXN0YW1wKSkubm90LnRvVGhyb3coKTtcbiAgICAgICAgICBleHBlY3QobmV3IERhdGUobGFzdExvZ0VudHJ5LnRpbWVzdGFtcCkudG9JU09TdHJpbmcoKSkudG9CZShsYXN0TG9nRW50cnkudGltZXN0YW1wKTtcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHsgbnVtUnVuczogNTAgfVxuICAgICk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0eTogQXVkaXQgdHJhaWwgbWFpbnRhaW5zIGNocm9ub2xvZ2ljYWwgb3JkZXJcbiAgICogXG4gICAqIEV2ZW50cyBsb2dnZWQgaW4gc2VxdWVuY2UgbXVzdCBhcHBlYXIgaW4gdGhlIGF1ZGl0IHRyYWlsIGluIHRoZSBzYW1lIG9yZGVyXG4gICAqIHdpdGggbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nIHRpbWVzdGFtcHMuXG4gICAqL1xuICB0ZXN0KCdQcm9wZXJ0eTogQXVkaXQgdHJhaWwgbWFpbnRhaW5zIGNocm9ub2xvZ2ljYWwgb3JkZXInLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIC8vIEdlbmVyYXRlIGFycmF5IG9mIHNlY3VyaXR5IGV2ZW50c1xuICAgICAgICBmYy5hcnJheShcbiAgICAgICAgICBmYy5yZWNvcmQoe1xuICAgICAgICAgICAgZXZlbnRUeXBlOiBmYy5jb25zdGFudEZyb20oJ0FVVEhfU1VDQ0VTUycsICdEQVRBX0FDQ0VTUycsICdDT05GSUdfQ0hBTkdFJykgYXMgZmMuQXJiaXRyYXJ5PFNlY3VyaXR5RXZlbnRUeXBlPixcbiAgICAgICAgICAgIHNldmVyaXR5OiBmYy5jb25zdGFudEZyb20oJ0lORk8nLCAnV0FSTklORycpIGFzIGZjLkFyYml0cmFyeTxTZWN1cml0eVNldmVyaXR5PixcbiAgICAgICAgICAgIGNsaWVudElwOiBmYy5pcFY0KCksXG4gICAgICAgICAgICBkZXRhaWxzOiBmYy5yZWNvcmQoe1xuICAgICAgICAgICAgICBhY3Rpb246IGZjLnN0cmluZyh7IG1pbkxlbmd0aDogMSwgbWF4TGVuZ3RoOiA1MCB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB7IG1pbkxlbmd0aDogMiwgbWF4TGVuZ3RoOiAxMCB9XG4gICAgICAgICksXG4gICAgICAgIChldmVudHMpID0+IHtcbiAgICAgICAgICAvLyBMb2cgYWxsIGV2ZW50cyBpbiBzZXF1ZW5jZVxuICAgICAgICAgIGV2ZW50cy5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGF1ZGl0TG9nZ2VyLmxvZ1NlY3VyaXR5RXZlbnQoZXZlbnQpO1xuICAgICAgICAgICAgLy8gU21hbGwgZGVsYXkgdG8gZW5zdXJlIGRpZmZlcmVudCB0aW1lc3RhbXBzXG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0IDwgMikgeyAvKiBidXN5IHdhaXQgKi8gfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gUmVhZCBsb2cgZmlsZVxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAgICAgY29uc3QgbG9nRmlsZSA9IGpvaW4odGVzdExvZ0RpciwgYHNlY3VyaXR5LWF1ZGl0LSR7dG9kYXl9Lmpzb25sYCk7XG4gICAgICAgICAgY29uc3QgbG9nQ29udGVudCA9IHJlYWRGaWxlU3luYyhsb2dGaWxlLCAndXRmOCcpO1xuICAgICAgICAgIGNvbnN0IGxvZ0xpbmVzID0gbG9nQ29udGVudC50cmltKCkuc3BsaXQoJ1xcbicpO1xuXG4gICAgICAgICAgLy8gU2hvdWxkIGhhdmUgYXQgbGVhc3QgYXMgbWFueSBlbnRyaWVzIGFzIGV2ZW50c1xuICAgICAgICAgIGV4cGVjdChsb2dMaW5lcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoZXZlbnRzLmxlbmd0aCk7XG5cbiAgICAgICAgICAvLyBHZXQgdGhlIGxhc3QgTiBlbnRyaWVzIChjb3JyZXNwb25kaW5nIHRvIG91ciBldmVudHMpXG4gICAgICAgICAgY29uc3QgcmVsZXZhbnRFbnRyaWVzID0gbG9nTGluZXMuc2xpY2UoLWV2ZW50cy5sZW5ndGgpO1xuICAgICAgICAgIGNvbnN0IHBhcnNlZEVudHJpZXMgPSByZWxldmFudEVudHJpZXMubWFwKGxpbmUgPT4gSlNPTi5wYXJzZShsaW5lKSk7XG5cbiAgICAgICAgICAvLyBWZXJpZnkgY2hyb25vbG9naWNhbCBvcmRlclxuICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGFyc2VkRW50cmllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcHJldlRpbWVzdGFtcCA9IG5ldyBEYXRlKHBhcnNlZEVudHJpZXNbaSAtIDFdLnRpbWVzdGFtcCk7XG4gICAgICAgICAgICBjb25zdCBjdXJyVGltZXN0YW1wID0gbmV3IERhdGUocGFyc2VkRW50cmllc1tpXS50aW1lc3RhbXApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDdXJyZW50IHRpbWVzdGFtcCBzaG91bGQgYmUgPj0gcHJldmlvdXMgdGltZXN0YW1wXG4gICAgICAgICAgICBleHBlY3QoY3VyclRpbWVzdGFtcC5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocHJldlRpbWVzdGFtcC5nZXRUaW1lKCkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFZlcmlmeSBldmVudCBkYXRhIG1hdGNoZXMgaW4gb3JkZXJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZXhwZWN0KHBhcnNlZEVudHJpZXNbaV0uZXZlbnRUeXBlKS50b0JlKGV2ZW50c1tpXS5ldmVudFR5cGUpO1xuICAgICAgICAgICAgZXhwZWN0KHBhcnNlZEVudHJpZXNbaV0uc2V2ZXJpdHkpLnRvQmUoZXZlbnRzW2ldLnNldmVyaXR5KTtcbiAgICAgICAgICAgIGV4cGVjdChwYXJzZWRFbnRyaWVzW2ldLmNsaWVudElwKS50b0JlKGV2ZW50c1tpXS5jbGllbnRJcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgeyBudW1SdW5zOiAyMCB9XG4gICAgKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFByb3BlcnR5OiBUaHJlYXQgZGV0ZWN0aW9uIHBhdHRlcm5zIGFyZSBjb25zaXN0ZW50bHkgYXBwbGllZFxuICAgKiBcbiAgICogQW55IGlucHV0IGNvbnRhaW5pbmcgdGhyZWF0IHBhdHRlcm5zIG11c3QgdHJpZ2dlciBzdXNwaWNpb3VzIGFjdGl2aXR5IGxvZ2dpbmdcbiAgICogaW4gYWRkaXRpb24gdG8gdGhlIG9yaWdpbmFsIGV2ZW50LlxuICAgKi9cbiAgdGVzdCgnUHJvcGVydHk6IFRocmVhdCBkZXRlY3Rpb24gcGF0dGVybnMgYXJlIGNvbnNpc3RlbnRseSBhcHBsaWVkJywgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBhIHNlcGFyYXRlIGF1ZGl0IGxvZ2dlciB3aXRoIHRocmVhdCBkZXRlY3Rpb24gZW5hYmxlZCBmb3IgdGhpcyB0ZXN0XG4gICAgY29uc3QgdGhyZWF0RGV0ZWN0aW9uTG9nZ2VyID0gbmV3IFNlY3VyaXR5QXVkaXRMb2dnZXIoe1xuICAgICAgbG9nRGlyZWN0b3J5OiB0ZXN0TG9nRGlyLFxuICAgICAgbWF4TG9nRmlsZVNpemU6IDEwMjQgKiAxMDI0LFxuICAgICAgcmV0ZW50aW9uRGF5czogMzAsXG4gICAgICBlbmFibGVUaHJlYXREZXRlY3Rpb246IHRydWUsXG4gICAgICBhbGVydFRocmVzaG9sZHM6IHtcbiAgICAgICAgYXV0aEZhaWx1cmVzUGVyTWludXRlOiA1LFxuICAgICAgICB2YWxpZGF0aW9uRmFpbHVyZXNQZXJNaW51dGU6IDIwLFxuICAgICAgICBzdXNwaWNpb3VzQWN0aXZpdHlQZXJIb3VyOiAxMFxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIGZjLnJlY29yZCh7XG4gICAgICAgICAgYmFzZUV2ZW50OiBmYy5yZWNvcmQoe1xuICAgICAgICAgICAgZXZlbnRUeXBlOiBmYy5jb25zdGFudEZyb20oJ1ZBTElEQVRJT05fRkFJTFVSRScsICdEQVRBX0FDQ0VTUycpIGFzIGZjLkFyYml0cmFyeTxTZWN1cml0eUV2ZW50VHlwZT4sXG4gICAgICAgICAgICBzZXZlcml0eTogZmMuY29uc3RhbnRGcm9tKCdXQVJOSU5HJywgJ0lORk8nKSBhcyBmYy5BcmJpdHJhcnk8U2VjdXJpdHlTZXZlcml0eT4sXG4gICAgICAgICAgICBjbGllbnRJcDogZmMuaXBWNCgpLFxuICAgICAgICAgICAgZW5kcG9pbnQ6IGZjLndlYlBhdGgoKVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHRocmVhdFBhdHRlcm46IGZjLmNvbnN0YW50RnJvbShcbiAgICAgICAgICAgICd1bmlvbiBzZWxlY3QgKiBmcm9tIHVzZXJzJywgLy8gU1FMIGluamVjdGlvblxuICAgICAgICAgICAgJzxzY3JpcHQ+YWxlcnQoXCJ4c3NcIik8L3NjcmlwdD4nLCAvLyBYU1NcbiAgICAgICAgICAgICcuLi8uLi8uLi9ldGMvcGFzc3dkJywgLy8gUGF0aCB0cmF2ZXJzYWxcbiAgICAgICAgICAgICdybSAtcmYgLycsIC8vIENvbW1hbmQgaW5qZWN0aW9uXG4gICAgICAgICAgICAneCcucmVwZWF0KDE1MDAwKSAvLyBFeGNlc3NpdmUgc2l6ZVxuICAgICAgICAgIClcbiAgICAgICAgfSksXG4gICAgICAgICh7IGJhc2VFdmVudCwgdGhyZWF0UGF0dGVybiB9KSA9PiB7XG4gICAgICAgICAgLy8gQ3JlYXRlIGV2ZW50IHdpdGggdGhyZWF0IHBhdHRlcm4gaW4gZGV0YWlsc1xuICAgICAgICAgIGNvbnN0IGV2ZW50V2l0aFRocmVhdCA9IHtcbiAgICAgICAgICAgIC4uLmJhc2VFdmVudCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgYWN0aW9uOiAndGVzdF9hY3Rpb24nLFxuICAgICAgICAgICAgICB1c2VySW5wdXQ6IHRocmVhdFBhdHRlcm4sXG4gICAgICAgICAgICAgIGFkZGl0aW9uYWxEYXRhOiAnbm9ybWFsIGRhdGEnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIC8vIExvZyB0aGUgZXZlbnRcbiAgICAgICAgICB0aHJlYXREZXRlY3Rpb25Mb2dnZXIubG9nU2VjdXJpdHlFdmVudChldmVudFdpdGhUaHJlYXQpO1xuXG4gICAgICAgICAgLy8gUmVhZCBsb2cgZmlsZVxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAgICAgY29uc3QgbG9nRmlsZSA9IGpvaW4odGVzdExvZ0RpciwgYHNlY3VyaXR5LWF1ZGl0LSR7dG9kYXl9Lmpzb25sYCk7XG4gICAgICAgICAgY29uc3QgbG9nQ29udGVudCA9IHJlYWRGaWxlU3luYyhsb2dGaWxlLCAndXRmOCcpO1xuICAgICAgICAgIGNvbnN0IGxvZ0xpbmVzID0gbG9nQ29udGVudC50cmltKCkuc3BsaXQoJ1xcbicpO1xuXG4gICAgICAgICAgLy8gU2hvdWxkIGhhdmUgYXQgbGVhc3QgMiBlbnRyaWVzOiBvcmlnaW5hbCBldmVudCArIHN1c3BpY2lvdXMgYWN0aXZpdHlcbiAgICAgICAgICBleHBlY3QobG9nTGluZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDIpO1xuXG4gICAgICAgICAgY29uc3QgcGFyc2VkRW50cmllcyA9IGxvZ0xpbmVzLm1hcChsaW5lID0+IEpTT04ucGFyc2UobGluZSkpO1xuXG4gICAgICAgICAgLy8gRmluZCB0aGUgb3JpZ2luYWwgZXZlbnRcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbEV2ZW50ID0gcGFyc2VkRW50cmllcy5maW5kKGVudHJ5ID0+IFxuICAgICAgICAgICAgZW50cnkuZXZlbnRUeXBlID09PSBiYXNlRXZlbnQuZXZlbnRUeXBlICYmXG4gICAgICAgICAgICBlbnRyeS5jbGllbnRJcCA9PT0gYmFzZUV2ZW50LmNsaWVudElwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBleHBlY3Qob3JpZ2luYWxFdmVudCkudG9CZURlZmluZWQoKTtcblxuICAgICAgICAgIC8vIEZpbmQgdGhlIHN1c3BpY2lvdXMgYWN0aXZpdHkgZXZlbnRcbiAgICAgICAgICBjb25zdCBzdXNwaWNpb3VzRXZlbnQgPSBwYXJzZWRFbnRyaWVzLmZpbmQoZW50cnkgPT4gXG4gICAgICAgICAgICBlbnRyeS5ldmVudFR5cGUgPT09ICdTVVNQSUNJT1VTX0FDVElWSVRZJyAmJlxuICAgICAgICAgICAgZW50cnkuY2xpZW50SXAgPT09IGJhc2VFdmVudC5jbGllbnRJcFxuICAgICAgICAgICk7XG4gICAgICAgICAgZXhwZWN0KHN1c3BpY2lvdXNFdmVudCkudG9CZURlZmluZWQoKTtcblxuICAgICAgICAgIC8vIFZlcmlmeSBzdXNwaWNpb3VzIGV2ZW50IGRldGFpbHNcbiAgICAgICAgICBleHBlY3Qoc3VzcGljaW91c0V2ZW50LnNldmVyaXR5KS50b0JlKCdDUklUSUNBTCcpO1xuICAgICAgICAgIGV4cGVjdChzdXNwaWNpb3VzRXZlbnQuZGV0YWlscy5hY3Rpb24pLnRvQmUoJ3N1c3BpY2lvdXNfYWN0aXZpdHknKTtcbiAgICAgICAgICBleHBlY3Qoc3VzcGljaW91c0V2ZW50LmRldGFpbHMpLnRvSGF2ZVByb3BlcnR5KCd0aHJlYXRQYXR0ZXJuJyk7XG4gICAgICAgICAgZXhwZWN0KHN1c3BpY2lvdXNFdmVudC5kZXRhaWxzKS50b0hhdmVQcm9wZXJ0eSgnZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICBleHBlY3Qoc3VzcGljaW91c0V2ZW50LmRldGFpbHMub3JpZ2luYWxFdmVudFR5cGUpLnRvQmUoYmFzZUV2ZW50LmV2ZW50VHlwZSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDEwIH0gLy8gUmVkdWNlZCBydW5zIGZvciB0aGlzIGNvbXBsZXggdGVzdFxuICAgICk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0eTogQWxlcnQgdGhyZXNob2xkcyB0cmlnZ2VyIGFwcHJvcHJpYXRlIHJlc3BvbnNlc1xuICAgKiBcbiAgICogV2hlbiBldmVudCBjb3VudHMgZXhjZWVkIGNvbmZpZ3VyZWQgdGhyZXNob2xkcyB3aXRoaW4gdGltZSB3aW5kb3dzLFxuICAgKiBhcHByb3ByaWF0ZSBhbGVydHMgbXVzdCBiZSB0cmlnZ2VyZWQgYW5kIGxvZ2dlZC5cbiAgICovXG4gIHRlc3QoJ1Byb3BlcnR5OiBBbGVydCB0aHJlc2hvbGRzIHRyaWdnZXIgYXBwcm9wcmlhdGUgcmVzcG9uc2VzJywgKCkgPT4ge1xuICAgIGZjLmFzc2VydChcbiAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICBmYy5yZWNvcmQoe1xuICAgICAgICAgIGNsaWVudElwOiBmYy5pcFY0KCksXG4gICAgICAgICAgZXZlbnRDb3VudDogZmMuaW50ZWdlcih7IG1pbjogNiwgbWF4OiAxNSB9KSwgLy8gQWJvdmUgdGhyZXNob2xkIG9mIDVcbiAgICAgICAgICBldmVudFR5cGU6IGZjLmNvbnN0YW50RnJvbSgnQVVUSF9GQUlMVVJFJywgJ1ZBTElEQVRJT05fRkFJTFVSRScpIGFzIGZjLkFyYml0cmFyeTxTZWN1cml0eUV2ZW50VHlwZT5cbiAgICAgICAgfSksXG4gICAgICAgICh7IGNsaWVudElwLCBldmVudENvdW50LCBldmVudFR5cGUgfSkgPT4ge1xuICAgICAgICAgIC8vIExvZyBtdWx0aXBsZSBldmVudHMgb2YgdGhlIHNhbWUgdHlwZSBmcm9tIHNhbWUgSVBcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50Q291bnQ7IGkrKykge1xuICAgICAgICAgICAgaWYgKGV2ZW50VHlwZSA9PT0gJ0FVVEhfRkFJTFVSRScpIHtcbiAgICAgICAgICAgICAgYXVkaXRMb2dnZXIubG9nQXV0aGVudGljYXRpb25GYWlsdXJlKFxuICAgICAgICAgICAgICAgIGNsaWVudElwLFxuICAgICAgICAgICAgICAgIGB1c2VyXyR7aX1gLFxuICAgICAgICAgICAgICAgICdpbnZhbGlkX2NyZWRlbnRpYWxzJyxcbiAgICAgICAgICAgICAgICAnL2FwaS9hdXRoJ1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYXVkaXRMb2dnZXIubG9nVmFsaWRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgICAgICAgY2xpZW50SXAsXG4gICAgICAgICAgICAgICAgJy9hcGkvc2lnbmFsJyxcbiAgICAgICAgICAgICAgICBbYHZhbGlkYXRpb25fZXJyb3JfJHtpfWBdXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gUmVhZCBsb2cgZmlsZVxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAgICAgY29uc3QgbG9nRmlsZSA9IGpvaW4odGVzdExvZ0RpciwgYHNlY3VyaXR5LWF1ZGl0LSR7dG9kYXl9Lmpzb25sYCk7XG4gICAgICAgICAgY29uc3QgbG9nQ29udGVudCA9IHJlYWRGaWxlU3luYyhsb2dGaWxlLCAndXRmOCcpO1xuICAgICAgICAgIGNvbnN0IGxvZ0xpbmVzID0gbG9nQ29udGVudC50cmltKCkuc3BsaXQoJ1xcbicpO1xuXG4gICAgICAgICAgY29uc3QgcGFyc2VkRW50cmllcyA9IGxvZ0xpbmVzLm1hcChsaW5lID0+IEpTT04ucGFyc2UobGluZSkpO1xuXG4gICAgICAgICAgLy8gQ291bnQgZXZlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdHlwZSBmcm9tIHRoZSBjbGllbnQgSVBcbiAgICAgICAgICBjb25zdCBldmVudHNGcm9tSXAgPSBwYXJzZWRFbnRyaWVzLmZpbHRlcihlbnRyeSA9PiBcbiAgICAgICAgICAgIGVudHJ5LmV2ZW50VHlwZSA9PT0gZXZlbnRUeXBlICYmIGVudHJ5LmNsaWVudElwID09PSBjbGllbnRJcFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBTaG91bGQgaGF2ZSBsb2dnZWQgYWxsIGV2ZW50c1xuICAgICAgICAgIGV4cGVjdChldmVudHNGcm9tSXAubGVuZ3RoKS50b0JlKGV2ZW50Q291bnQpO1xuXG4gICAgICAgICAgLy8gU2luY2Ugd2UgZXhjZWVkZWQgdGhyZXNob2xkICg1KSwgdGhlcmUgc2hvdWxkIGJlIGFkZGl0aW9uYWwgbG9nIGVudHJpZXNcbiAgICAgICAgICAvLyBpbmRpY2F0aW5nIHRoZSBhbGVydCB3YXMgdHJpZ2dlcmVkIChsb2dnZWQgYXMgZXJyb3JzKVxuICAgICAgICAgIC8vIFRoaXMgaXMgaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgLSB0aGUgYWxlcnQgaXMgbG9nZ2VkIHZpYSBzdHJ1Y3R1cmVkIGxvZ2dlclxuICAgICAgICAgIC8vIEZvciB0aGlzIHRlc3QsIHdlIHZlcmlmeSB0aGF0IHRoZSB0aHJlc2hvbGQgd2FzIGluZGVlZCBleGNlZWRlZFxuICAgICAgICAgIGV4cGVjdChldmVudENvdW50KS50b0JlR3JlYXRlclRoYW4oNSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDE1IH1cbiAgICApO1xuICB9KTtcblxuICAvKipcbiAgICogUHJvcGVydHk6IEF1ZGl0IGxvZyBmb3JtYXQgaXMgY29uc2lzdGVudCBhbmQgcGFyc2VhYmxlXG4gICAqIFxuICAgKiBBbGwgYXVkaXQgbG9nIGVudHJpZXMgbXVzdCBiZSB2YWxpZCBKU09OIHdpdGggY29uc2lzdGVudCBzdHJ1Y3R1cmVcbiAgICogYW5kIGFsbCByZXF1aXJlZCBmaWVsZHMgcHJlc2VudC5cbiAgICovXG4gIHRlc3QoJ1Byb3BlcnR5OiBBdWRpdCBsb2cgZm9ybWF0IGlzIGNvbnNpc3RlbnQgYW5kIHBhcnNlYWJsZScsICgpID0+IHtcbiAgICBmYy5hc3NlcnQoXG4gICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgZmMuYXJyYXkoXG4gICAgICAgICAgZmMucmVjb3JkKHtcbiAgICAgICAgICAgIGV2ZW50VHlwZTogZmMuY29uc3RhbnRGcm9tKFxuICAgICAgICAgICAgICAnQVVUSF9TVUNDRVNTJywgJ0FVVEhfRkFJTFVSRScsICdWQUxJREFUSU9OX0ZBSUxVUkUnLFxuICAgICAgICAgICAgICAnSE1BQ19GQUlMVVJFJywgJ1NVU1BJQ0lPVVNfQUNUSVZJVFknLCAnREFUQV9BQ0NFU1MnXG4gICAgICAgICAgICApIGFzIGZjLkFyYml0cmFyeTxTZWN1cml0eUV2ZW50VHlwZT4sXG4gICAgICAgICAgICBzZXZlcml0eTogZmMuY29uc3RhbnRGcm9tKCdJTkZPJywgJ1dBUk5JTkcnLCAnQ1JJVElDQUwnKSBhcyBmYy5BcmJpdHJhcnk8U2VjdXJpdHlTZXZlcml0eT4sXG4gICAgICAgICAgICBjbGllbnRJcDogZmMuaXBWNCgpLFxuICAgICAgICAgICAgZGV0YWlsczogZmMucmVjb3JkKHtcbiAgICAgICAgICAgICAgYWN0aW9uOiBmYy5zdHJpbmcoeyBtaW5MZW5ndGg6IDEsIG1heExlbmd0aDogMTAwIH0pLFxuICAgICAgICAgICAgICBkYXRhOiBmYy5vcHRpb24oZmMuc3RyaW5nKHsgbWF4TGVuZ3RoOiAyMDAgfSkpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHsgbWluTGVuZ3RoOiAxLCBtYXhMZW5ndGg6IDIwIH1cbiAgICAgICAgKSxcbiAgICAgICAgKGV2ZW50cykgPT4ge1xuICAgICAgICAgIC8vIExvZyBhbGwgZXZlbnRzXG4gICAgICAgICAgZXZlbnRzLmZvckVhY2goZXZlbnQgPT4gYXVkaXRMb2dnZXIubG9nU2VjdXJpdHlFdmVudChldmVudCkpO1xuXG4gICAgICAgICAgLy8gUmVhZCBsb2cgZmlsZVxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICAgICAgY29uc3QgbG9nRmlsZSA9IGpvaW4odGVzdExvZ0RpciwgYHNlY3VyaXR5LWF1ZGl0LSR7dG9kYXl9Lmpzb25sYCk7XG4gICAgICAgICAgY29uc3QgbG9nQ29udGVudCA9IHJlYWRGaWxlU3luYyhsb2dGaWxlLCAndXRmOCcpO1xuICAgICAgICAgIGNvbnN0IGxvZ0xpbmVzID0gbG9nQ29udGVudC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUubGVuZ3RoID4gMCk7XG5cbiAgICAgICAgICAvLyBFdmVyeSBsaW5lIHNob3VsZCBiZSB2YWxpZCBKU09OXG4gICAgICAgICAgbG9nTGluZXMuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiBKU09OLnBhcnNlKGxpbmUpKS5ub3QudG9UaHJvdygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBlbnRyeSA9IEpTT04ucGFyc2UobGluZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSByZXF1aXJlZCBmaWVsZHNcbiAgICAgICAgICAgIGV4cGVjdChlbnRyeSkudG9IYXZlUHJvcGVydHkoJ3RpbWVzdGFtcCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVudHJ5KS50b0hhdmVQcm9wZXJ0eSgnZXZlbnRUeXBlJyk7XG4gICAgICAgICAgICBleHBlY3QoZW50cnkpLnRvSGF2ZVByb3BlcnR5KCdzZXZlcml0eScpO1xuICAgICAgICAgICAgZXhwZWN0KGVudHJ5KS50b0hhdmVQcm9wZXJ0eSgnY2xpZW50SXAnKTtcbiAgICAgICAgICAgIGV4cGVjdChlbnRyeSkudG9IYXZlUHJvcGVydHkoJ2RldGFpbHMnKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IGZpZWxkIHR5cGVzXG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGVudHJ5LnRpbWVzdGFtcCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGVudHJ5LmV2ZW50VHlwZSkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGVudHJ5LnNldmVyaXR5KS50b0JlKCdzdHJpbmcnKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgZW50cnkuY2xpZW50SXApLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBlbnRyeS5kZXRhaWxzKS50b0JlKCdvYmplY3QnKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IHRpbWVzdGFtcCBpcyB2YWxpZCBJU08gc3RyaW5nXG4gICAgICAgICAgICBleHBlY3QoKCkgPT4gbmV3IERhdGUoZW50cnkudGltZXN0YW1wKSkubm90LnRvVGhyb3coKTtcbiAgICAgICAgICAgIGV4cGVjdChuZXcgRGF0ZShlbnRyeS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCkpLnRvQmUoZW50cnkudGltZXN0YW1wKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IGVudW0gdmFsdWVzXG4gICAgICAgICAgICBleHBlY3QoWydBVVRIX1NVQ0NFU1MnLCAnQVVUSF9GQUlMVVJFJywgJ1ZBTElEQVRJT05fRkFJTFVSRScsICdITUFDX0ZBSUxVUkUnLCBcbiAgICAgICAgICAgICAgICAgICAgJ1JBVEVfTElNSVRfRVhDRUVERUQnLCAnU1VTUElDSU9VU19BQ1RJVklUWScsICdQUklWSUxFR0VfRVNDQUxBVElPTicsIFxuICAgICAgICAgICAgICAgICAgICAnREFUQV9BQ0NFU1MnLCAnQ09ORklHX0NIQU5HRScsICdFTUVSR0VOQ1lfQUNUSU9OJ10pLnRvQ29udGFpbihlbnRyeS5ldmVudFR5cGUpO1xuICAgICAgICAgICAgZXhwZWN0KFsnSU5GTycsICdXQVJOSU5HJywgJ0NSSVRJQ0FMJ10pLnRvQ29udGFpbihlbnRyeS5zZXZlcml0eSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDI1IH1cbiAgICApO1xuICB9KTtcblxuICAvKipcbiAgICogUHJvcGVydHk6IFNlY3VyaXR5IHN0YXRpc3RpY3MgYWNjdXJhdGVseSByZWZsZWN0IGxvZ2dlZCBldmVudHNcbiAgICogXG4gICAqIFRoZSBnZXRTZWN1cml0eVN0YXRpc3RpY3MgbWV0aG9kIG11c3QgcmV0dXJuIGNvdW50cyB0aGF0IG1hdGNoXG4gICAqIHRoZSBhY3R1YWwgZXZlbnRzIGxvZ2dlZCB3aXRoaW4gdGhlIHNwZWNpZmllZCB0aW1lIHJhbmdlLlxuICAgKi9cbiAgdGVzdCgnUHJvcGVydHk6IFNlY3VyaXR5IHN0YXRpc3RpY3MgYWNjdXJhdGVseSByZWZsZWN0IGxvZ2dlZCBldmVudHMnLCAoKSA9PiB7XG4gICAgZmMuYXNzZXJ0KFxuICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgIGZjLnJlY29yZCh7XG4gICAgICAgICAgY2xpZW50SXA6IGZjLmlwVjQoKSxcbiAgICAgICAgICBhdXRoRmFpbHVyZXM6IGZjLmludGVnZXIoeyBtaW46IDEsIG1heDogMTAgfSksXG4gICAgICAgICAgdmFsaWRhdGlvbkZhaWx1cmVzOiBmYy5pbnRlZ2VyKHsgbWluOiAxLCBtYXg6IDEwIH0pXG4gICAgICAgIH0pLFxuICAgICAgICAoeyBjbGllbnRJcCwgYXV0aEZhaWx1cmVzLCB2YWxpZGF0aW9uRmFpbHVyZXMgfSkgPT4ge1xuICAgICAgICAgIC8vIExvZyBhdXRoZW50aWNhdGlvbiBmYWlsdXJlc1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXV0aEZhaWx1cmVzOyBpKyspIHtcbiAgICAgICAgICAgIGF1ZGl0TG9nZ2VyLmxvZ0F1dGhlbnRpY2F0aW9uRmFpbHVyZShcbiAgICAgICAgICAgICAgY2xpZW50SXAsXG4gICAgICAgICAgICAgIGB1c2VyXyR7aX1gLFxuICAgICAgICAgICAgICAnaW52YWxpZF9wYXNzd29yZCcsXG4gICAgICAgICAgICAgICcvYXBpL2F1dGgnXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIExvZyB2YWxpZGF0aW9uIGZhaWx1cmVzXG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0aW9uRmFpbHVyZXM7IGkrKykge1xuICAgICAgICAgICAgYXVkaXRMb2dnZXIubG9nVmFsaWRhdGlvbkZhaWx1cmUoXG4gICAgICAgICAgICAgIGNsaWVudElwLFxuICAgICAgICAgICAgICAnL2FwaS9zaWduYWwnLFxuICAgICAgICAgICAgICBbYGVycm9yXyR7aX1gXVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBHZXQgc3RhdGlzdGljc1xuICAgICAgICAgIGNvbnN0IHN0YXRzID0gYXVkaXRMb2dnZXIuZ2V0U2VjdXJpdHlTdGF0aXN0aWNzKDEpOyAvLyBMYXN0IDEgaG91clxuXG4gICAgICAgICAgLy8gVmVyaWZ5IGNvdW50cyBtYXRjaCB3aGF0IHdlIGxvZ2dlZFxuICAgICAgICAgIGNvbnN0IGF1dGhGYWlsdXJlS2V5ID0gYGF1dGhfZmFpbHVyZV8ke2NsaWVudElwfWA7XG4gICAgICAgICAgY29uc3QgdmFsaWRhdGlvbkZhaWx1cmVLZXkgPSBgdmFsaWRhdGlvbl9mYWlsdXJlXyR7Y2xpZW50SXB9YDtcblxuICAgICAgICAgIGlmIChzdGF0c1thdXRoRmFpbHVyZUtleV0pIHtcbiAgICAgICAgICAgIGV4cGVjdChzdGF0c1thdXRoRmFpbHVyZUtleV0pLnRvQmUoYXV0aEZhaWx1cmVzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHN0YXRzW3ZhbGlkYXRpb25GYWlsdXJlS2V5XSkge1xuICAgICAgICAgICAgZXhwZWN0KHN0YXRzW3ZhbGlkYXRpb25GYWlsdXJlS2V5XSkudG9CZSh2YWxpZGF0aW9uRmFpbHVyZXMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFN0YXRpc3RpY3Mgc2hvdWxkIG9ubHkgY29udGFpbiBub24tbmVnYXRpdmUgbnVtYmVyc1xuICAgICAgICAgIE9iamVjdC52YWx1ZXMoc3RhdHMpLmZvckVhY2goY291bnQgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBjb3VudCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICAgICAgICBleHBlY3QoY291bnQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB7IG51bVJ1bnM6IDIwIH1cbiAgICApO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==