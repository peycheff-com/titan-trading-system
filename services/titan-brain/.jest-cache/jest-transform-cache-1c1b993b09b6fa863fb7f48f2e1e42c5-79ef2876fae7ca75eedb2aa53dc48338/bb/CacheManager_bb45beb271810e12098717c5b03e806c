5dc24be1b8a0eabc2d72f00893738e4b
"use strict";
/**
 * CacheManager - Redis with in-memory fallback strategy
 *
 * Provides reliable caching with Redis as primary and in-memory as fallback.
 * Handles Redis unavailability gracefully.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CacheManager = exports.DEFAULT_CACHE_CONFIG = exports.CacheNamespace = void 0;
const events_1 = require("events");
const redis_1 = require("redis");
const InMemoryCache_js_1 = require("./InMemoryCache.js");
/**
 * Cache namespaces
 */
var CacheNamespace;
(function (CacheNamespace) {
    CacheNamespace["RISK"] = "risk";
    CacheNamespace["QUERY"] = "query";
    CacheNamespace["CORRELATION"] = "correlation";
    CacheNamespace["SESSION"] = "session";
    CacheNamespace["METRICS"] = "metrics";
    CacheNamespace["ALLOCATION"] = "allocation";
    CacheNamespace["PERFORMANCE"] = "performance";
})(CacheNamespace || (exports.CacheNamespace = CacheNamespace = {}));
/**
 * Default cache configuration
 */
exports.DEFAULT_CACHE_CONFIG = {
    enableInMemoryFallback: true,
    inMemoryMaxSize: 1000,
    inMemoryTtlMs: 300000,
    healthCheckIntervalMs: 30000,
    healthCheckTimeoutMs: 5000,
    maxReconnectAttempts: 5,
    reconnectDelayMs: 5000,
};
/**
 * Cache manager with Redis primary and in-memory fallback
 */
class CacheManager extends events_1.EventEmitter {
    redisClient = null;
    inMemoryCache;
    config;
    metrics;
    healthCheckInterval = null;
    isShuttingDown = false;
    operationCount = 0;
    totalResponseTime = 0;
    constructor(config = exports.DEFAULT_CACHE_CONFIG) {
        super();
        this.config = config;
        this.inMemoryCache = new InMemoryCache_js_1.InMemoryCache(config.inMemoryMaxSize, config.inMemoryTtlMs);
        this.metrics = {
            redisConnected: false,
            fallbackActive: false,
            totalOperations: 0,
            redisHits: 0,
            redisMisses: 0,
            memoryHits: 0,
            memoryMisses: 0,
            errors: 0,
        };
    }
    /**
     * Create cache configuration from environment variables
     */
    static createConfigFromEnv() {
        const redisUrl = process.env.REDIS_URL;
        let redisConfig = undefined;
        const redisDisabled = process.env.REDIS_DISABLED === "true";
        if (redisUrl && !redisDisabled) {
            redisConfig = { url: redisUrl };
        }
        else if (process.env.REDIS_HOST) {
            redisConfig = {
                host: process.env.REDIS_HOST,
                port: parseInt(process.env.REDIS_PORT || "6379"),
                password: process.env.REDIS_PASSWORD,
                db: parseInt(process.env.REDIS_DB || "0"),
            };
        }
        return {
            redis: redisConfig,
            enableInMemoryFallback: process.env.CACHE_ENABLE_MEMORY_FALLBACK !== "false",
            inMemoryMaxSize: parseInt(process.env.CACHE_MEMORY_MAX_SIZE || "1000"),
            inMemoryTtlMs: parseInt(process.env.CACHE_MEMORY_TTL || "300000"),
            healthCheckIntervalMs: parseInt(process.env.CACHE_HEALTH_CHECK_INTERVAL || "30000"),
            healthCheckTimeoutMs: parseInt(process.env.CACHE_HEALTH_CHECK_TIMEOUT || "5000"),
            maxReconnectAttempts: parseInt(process.env.CACHE_MAX_RECONNECT_ATTEMPTS || "5"),
            reconnectDelayMs: parseInt(process.env.CACHE_RECONNECT_DELAY || "5000"),
        };
    }
    /**
     * Initialize cache manager
     */
    async initialize() {
        this.inMemoryCache.initialize();
        if (this.config.redis) {
            await this.initializeRedis();
        }
        else {
            console.log("Redis not configured, using in-memory cache only");
            this.metrics.fallbackActive = true;
        }
        // Emit initialized event
        this.emit('initialized', {
            redisEnabled: !!this.config.redis,
            fallbackActive: this.metrics.fallbackActive
        });
    }
    async initializeRedis() {
        if (!this.config.redis)
            return;
        try {
            this.redisClient = (0, redis_1.createClient)({
                url: this.config.redis.url,
                socket: {
                    host: this.config.redis.host,
                    port: this.config.redis.port,
                },
            });
            this.redisClient.on("error", (err) => {
                console.error("Redis error:", err);
                this.metrics.redisConnected = false;
                this.metrics.fallbackActive = true;
            });
            this.redisClient.on("connect", () => {
                console.log("Redis connected");
                this.metrics.redisConnected = true;
                this.metrics.fallbackActive = false;
            });
            await this.redisClient.connect();
        }
        catch (error) {
            console.warn("Failed to connect to Redis, using fallback:", error);
            this.metrics.redisConnected = false;
            this.metrics.fallbackActive = true;
        }
    }
    /**
     * Generate namespaced key
     */
    getKey(namespace, key) {
        return `${namespace}:${key}`;
    }
    /**
     * Get value from cache
     * Supports both get(key) and get(namespace, key) signatures
     */
    async get(arg1, arg2) {
        const startTime = Date.now();
        let key;
        if (arg2) {
            key = this.getKey(arg1, arg2);
        }
        else {
            key = arg1;
        }
        this.metrics.totalOperations++;
        // Try Redis first
        if (this.redisClient && this.metrics.redisConnected) {
            try {
                const value = await this.redisClient.get(key);
                const duration = Date.now() - startTime;
                this.totalResponseTime += duration;
                if (value) {
                    this.metrics.redisHits++;
                    this.emit('cache:hit', { source: 'redis', key, duration });
                    return {
                        success: true,
                        value: JSON.parse(value),
                        source: 'redis'
                    };
                }
                else {
                    this.metrics.redisMisses++;
                    this.emit('cache:miss', { source: 'redis', key, duration });
                    return {
                        success: false,
                        source: 'redis'
                    };
                }
            }
            catch (err) {
                this.metrics.errors++;
                const duration = Date.now() - startTime;
                this.emit('cache:error', {
                    source: 'redis',
                    key,
                    error: err instanceof Error ? err.message : 'Unknown error',
                    duration
                });
                // Fall through to memory cache
            }
        }
        // Fallback to memory
        if (this.config.enableInMemoryFallback) {
            const value = this.inMemoryCache.get(key);
            const duration = Date.now() - startTime;
            this.totalResponseTime += duration;
            if (value !== undefined) {
                this.metrics.memoryHits++;
                this.emit('cache:hit', { source: 'memory', key, duration });
                return {
                    success: true,
                    value,
                    source: 'memory'
                };
            }
            else {
                this.metrics.memoryMisses++;
                this.emit('cache:miss', { source: 'memory', key, duration });
                return {
                    success: false,
                    source: 'memory'
                };
            }
        }
        return {
            success: false,
            source: 'none'
        };
    }
    /**
     * Set value in cache
     * Supports both set(key, value, ttl?) and set(namespace, key, value, ttl?)
     */
    async set(arg1, arg2, arg3, arg4) {
        let key;
        let value;
        let ttl;
        // Check if first argument is a namespace enum
        if (typeof arg1 === "string" && Object.values(CacheNamespace).includes(arg1)) {
            // set(namespace, key, value, ttl?)
            key = this.getKey(arg1, arg2);
            value = arg3;
            ttl = arg4;
        }
        else {
            // set(key, value, ttl?)
            key = arg1;
            value = arg2;
            ttl = arg3;
        }
        const stringValue = JSON.stringify(value);
        this.metrics.totalOperations++;
        // Try Redis first
        if (this.redisClient && this.metrics.redisConnected) {
            try {
                if (ttl) {
                    await this.redisClient.setEx(key, ttl, stringValue);
                }
                else {
                    await this.redisClient.set(key, stringValue);
                }
                return {
                    success: true,
                    source: 'redis'
                };
            }
            catch (err) {
                this.metrics.errors++;
                console.error("Redis set error:", err);
                // Fall through to memory cache
            }
        }
        // Fallback to memory
        if (this.config.enableInMemoryFallback) {
            this.inMemoryCache.set(key, value, ttl ? ttl * 1000 : this.config.inMemoryTtlMs);
            return {
                success: true,
                source: 'memory'
            };
        }
        return {
            success: false,
            source: 'none',
            error: 'No cache backend available'
        };
    }
    /**
     * Delete value from cache
     * Supports delete(key) and delete(namespace, key)
     */
    async delete(arg1, arg2) {
        let key;
        if (arg2) {
            key = this.getKey(arg1, arg2);
        }
        else {
            key = arg1;
        }
        this.metrics.totalOperations++;
        let redisSuccess = false;
        let memorySuccess = false;
        if (this.redisClient && this.metrics.redisConnected) {
            try {
                await this.redisClient.del(key);
                redisSuccess = true;
            }
            catch (err) {
                this.metrics.errors++;
                console.error("Redis delete error:", err);
            }
        }
        if (this.config.enableInMemoryFallback) {
            this.inMemoryCache.delete(key);
            memorySuccess = true;
        }
        if (redisSuccess) {
            return { success: true, source: 'redis' };
        }
        else if (memorySuccess) {
            return { success: true, source: 'memory' };
        }
        else {
            return { success: false, source: 'none' };
        }
    }
    /**
     * Invalidate keys by pattern
     */
    async invalidatePattern(namespace, pattern) {
        const fullPattern = this.getKey(namespace, pattern);
        if (this.redisClient && this.metrics.redisConnected) {
            try {
                const keys = await this.redisClient.keys(fullPattern);
                if (keys.length > 0) {
                    await this.redisClient.del(keys);
                }
            }
            catch (err) {
                console.error("Redis invalidatePattern error:", err);
            }
        }
        // Memory cache doesn't efficiently support patterns in this implementation
        // Ideally we iterate keys
        // For now, assuming Redis is primary
    }
    /**
     * Invalidate entire namespace
     */
    async invalidateNamespace(namespace) {
        await this.invalidatePattern(namespace, "*");
    }
    async clear() {
        this.metrics.totalOperations++;
        let redisSuccess = false;
        let memorySuccess = false;
        if (this.redisClient && this.metrics.redisConnected) {
            try {
                await this.redisClient.flushDb();
                redisSuccess = true;
            }
            catch (err) {
                this.metrics.errors++;
                console.error("Redis clear error:", err);
            }
        }
        if (this.config.enableInMemoryFallback) {
            this.inMemoryCache.clear();
            memorySuccess = true;
        }
        if (redisSuccess) {
            return { success: true, source: 'redis' };
        }
        else if (memorySuccess) {
            return { success: true, source: 'memory' };
        }
        else {
            return { success: false, source: 'none' };
        }
    }
    /**
     * Check if cache is healthy
     */
    isHealthy() {
        return this.metrics.redisConnected || this.config.enableInMemoryFallback;
    }
    /**
     * Get cache status
     */
    getStatus() {
        const hitRate = this.metrics.totalOperations > 0
            ? (this.metrics.redisHits + this.metrics.memoryHits) / this.metrics.totalOperations
            : 0;
        const averageResponseTime = this.metrics.totalOperations > 0
            ? this.totalResponseTime / this.metrics.totalOperations
            : 0;
        return {
            redisConnected: this.metrics.redisConnected,
            fallbackActive: this.metrics.fallbackActive,
            totalOperations: this.metrics.totalOperations,
            hitRate,
            averageResponseTime
        };
    }
    /**
     * Get cache metrics
     */
    getMetrics() {
        return { ...this.metrics };
    }
    async shutdown() {
        this.isShuttingDown = true;
        if (this.healthCheckInterval) {
            clearInterval(this.healthCheckInterval);
        }
        if (this.redisClient) {
            try {
                await this.redisClient.disconnect();
            }
            catch (err) {
                console.error("Redis disconnect error:", err);
            }
        }
        this.inMemoryCache.clear();
    }
}
exports.CacheManager = CacheManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9jYWNoZS9DYWNoZU1hbmFnZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFFSCxtQ0FBc0M7QUFDdEMsaUNBQXNEO0FBQ3RELHlEQUFtRDtBQUVuRDs7R0FFRztBQUNILElBQVksY0FRWDtBQVJELFdBQVksY0FBYztJQUN4QiwrQkFBYSxDQUFBO0lBQ2IsaUNBQWUsQ0FBQTtJQUNmLDZDQUEyQixDQUFBO0lBQzNCLHFDQUFtQixDQUFBO0lBQ25CLHFDQUFtQixDQUFBO0lBQ25CLDJDQUF5QixDQUFBO0lBQ3pCLDZDQUEyQixDQUFBO0FBQzdCLENBQUMsRUFSVyxjQUFjLDhCQUFkLGNBQWMsUUFRekI7QUE4QkQ7O0dBRUc7QUFDVSxRQUFBLG9CQUFvQixHQUFnQjtJQUMvQyxzQkFBc0IsRUFBRSxJQUFJO0lBQzVCLGVBQWUsRUFBRSxJQUFJO0lBQ3JCLGFBQWEsRUFBRSxNQUFNO0lBQ3JCLHFCQUFxQixFQUFFLEtBQUs7SUFDNUIsb0JBQW9CLEVBQUUsSUFBSTtJQUMxQixvQkFBb0IsRUFBRSxDQUFDO0lBQ3ZCLGdCQUFnQixFQUFFLElBQUk7Q0FDdkIsQ0FBQztBQStDRjs7R0FFRztBQUNILE1BQWEsWUFBYSxTQUFRLHFCQUFZO0lBQ3BDLFdBQVcsR0FBMkIsSUFBSSxDQUFDO0lBQzNDLGFBQWEsQ0FBZ0I7SUFDN0IsTUFBTSxDQUFjO0lBQ3BCLE9BQU8sQ0FBZTtJQUN0QixtQkFBbUIsR0FBMEIsSUFBSSxDQUFDO0lBQ2xELGNBQWMsR0FBWSxLQUFLLENBQUM7SUFDaEMsY0FBYyxHQUFXLENBQUMsQ0FBQztJQUMzQixpQkFBaUIsR0FBVyxDQUFDLENBQUM7SUFFdEMsWUFBWSxTQUFzQiw0QkFBb0I7UUFDcEQsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksZ0NBQWEs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Q0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzNCLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDN0IsYUFBYSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3RDLENBQUM7WUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO2dCQUNiLE9BQU8sQ0FBQyxLQUFLLENBQUMseUJBQXlCLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDaEQsQ0FBQztRQUNILENBQUM7UUFDRCxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdCLENBQUM7Q0FDRjtBQTlhRCxvQ0E4YUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9jYWNoZS9DYWNoZU1hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDYWNoZU1hbmFnZXIgLSBSZWRpcyB3aXRoIGluLW1lbW9yeSBmYWxsYmFjayBzdHJhdGVneVxuICpcbiAqIFByb3ZpZGVzIHJlbGlhYmxlIGNhY2hpbmcgd2l0aCBSZWRpcyBhcyBwcmltYXJ5IGFuZCBpbi1tZW1vcnkgYXMgZmFsbGJhY2suXG4gKiBIYW5kbGVzIFJlZGlzIHVuYXZhaWxhYmlsaXR5IGdyYWNlZnVsbHkuXG4gKi9cblxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50LCBSZWRpc0NsaWVudFR5cGUgfSBmcm9tIFwicmVkaXNcIjtcbmltcG9ydCB7IEluTWVtb3J5Q2FjaGUgfSBmcm9tIFwiLi9Jbk1lbW9yeUNhY2hlLmpzXCI7XG5cbi8qKlxuICogQ2FjaGUgbmFtZXNwYWNlc1xuICovXG5leHBvcnQgZW51bSBDYWNoZU5hbWVzcGFjZSB7XG4gIFJJU0sgPSBcInJpc2tcIixcbiAgUVVFUlkgPSBcInF1ZXJ5XCIsXG4gIENPUlJFTEFUSU9OID0gXCJjb3JyZWxhdGlvblwiLFxuICBTRVNTSU9OID0gXCJzZXNzaW9uXCIsXG4gIE1FVFJJQ1MgPSBcIm1ldHJpY3NcIixcbiAgQUxMT0NBVElPTiA9IFwiYWxsb2NhdGlvblwiLFxuICBQRVJGT1JNQU5DRSA9IFwicGVyZm9ybWFuY2VcIixcbn1cblxuLyoqXG4gKiBDYWNoZSBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2FjaGVDb25maWcge1xuICByZWRpcz86IHtcbiAgICB1cmw/OiBzdHJpbmc7XG4gICAgaG9zdD86IHN0cmluZztcbiAgICBwb3J0PzogbnVtYmVyO1xuICAgIHBhc3N3b3JkPzogc3RyaW5nO1xuICAgIGRiPzogbnVtYmVyO1xuICAgIGNvbm5lY3RUaW1lb3V0PzogbnVtYmVyO1xuICAgIGNvbW1hbmRUaW1lb3V0PzogbnVtYmVyO1xuICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyPzogbnVtYmVyO1xuICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0PzogbnVtYmVyO1xuICB9O1xuXG4gIC8vIEZhbGxiYWNrIHNldHRpbmdzXG4gIGVuYWJsZUluTWVtb3J5RmFsbGJhY2s6IGJvb2xlYW47XG4gIGluTWVtb3J5TWF4U2l6ZTogbnVtYmVyO1xuICBpbk1lbW9yeVR0bE1zOiBudW1iZXI7XG5cbiAgLy8gSGVhbHRoIGNoZWNrIHNldHRpbmdzXG4gIGhlYWx0aENoZWNrSW50ZXJ2YWxNczogbnVtYmVyO1xuICBoZWFsdGhDaGVja1RpbWVvdXRNczogbnVtYmVyO1xuICBtYXhSZWNvbm5lY3RBdHRlbXB0czogbnVtYmVyO1xuICByZWNvbm5lY3REZWxheU1zOiBudW1iZXI7XG59XG5cbi8qKlxuICogRGVmYXVsdCBjYWNoZSBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUX0NBQ0hFX0NPTkZJRzogQ2FjaGVDb25maWcgPSB7XG4gIGVuYWJsZUluTWVtb3J5RmFsbGJhY2s6IHRydWUsXG4gIGluTWVtb3J5TWF4U2l6ZTogMTAwMCxcbiAgaW5NZW1vcnlUdGxNczogMzAwMDAwLFxuICBoZWFsdGhDaGVja0ludGVydmFsTXM6IDMwMDAwLFxuICBoZWFsdGhDaGVja1RpbWVvdXRNczogNTAwMCxcbiAgbWF4UmVjb25uZWN0QXR0ZW1wdHM6IDUsXG4gIHJlY29ubmVjdERlbGF5TXM6IDUwMDAsXG59O1xuXG4vKipcbiAqIENhY2hlIHN0YXRzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2FjaGVTdGF0cyB7XG4gIGhpdHM6IG51bWJlcjtcbiAgbWlzc2VzOiBudW1iZXI7XG4gIGtleXM6IG51bWJlcjtcbiAgbWVtb3J5VXNhZ2U6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBDYWNoZSBvcGVyYXRpb24gcmVzdWx0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2FjaGVSZXN1bHQ8VCA9IGFueT4ge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB2YWx1ZT86IFQ7XG4gIHNvdXJjZTogJ3JlZGlzJyB8ICdtZW1vcnknIHwgJ25vbmUnO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuLyoqXG4gKiBDYWNoZSBzdGF0dXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDYWNoZVN0YXR1cyB7XG4gIHJlZGlzQ29ubmVjdGVkOiBib29sZWFuO1xuICBmYWxsYmFja0FjdGl2ZTogYm9vbGVhbjtcbiAgdG90YWxPcGVyYXRpb25zOiBudW1iZXI7XG4gIGhpdFJhdGU6IG51bWJlcjtcbiAgYXZlcmFnZVJlc3BvbnNlVGltZTogbnVtYmVyO1xufVxuXG4vKipcbiAqIENhY2hlIG1ldHJpY3NcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDYWNoZU1ldHJpY3Mge1xuICByZWRpc0Nvbm5lY3RlZDogYm9vbGVhbjtcbiAgZmFsbGJhY2tBY3RpdmU6IGJvb2xlYW47XG4gIHRvdGFsT3BlcmF0aW9uczogbnVtYmVyO1xuICByZWRpc0hpdHM6IG51bWJlcjtcbiAgcmVkaXNNaXNzZXM6IG51bWJlcjtcbiAgbWVtb3J5SGl0czogbnVtYmVyO1xuICBtZW1vcnlNaXNzZXM6IG51bWJlcjtcbiAgZXJyb3JzOiBudW1iZXI7XG59XG5cbi8qKlxuICogQ2FjaGUgbWFuYWdlciB3aXRoIFJlZGlzIHByaW1hcnkgYW5kIGluLW1lbW9yeSBmYWxsYmFja1xuICovXG5leHBvcnQgY2xhc3MgQ2FjaGVNYW5hZ2VyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcHJpdmF0ZSByZWRpc0NsaWVudDogUmVkaXNDbGllbnRUeXBlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaW5NZW1vcnlDYWNoZTogSW5NZW1vcnlDYWNoZTtcbiAgcHJpdmF0ZSBjb25maWc6IENhY2hlQ29uZmlnO1xuICBwcml2YXRlIG1ldHJpY3M6IENhY2hlTWV0cmljcztcbiAgcHJpdmF0ZSBoZWFsdGhDaGVja0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzU2h1dHRpbmdEb3duOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgb3BlcmF0aW9uQ291bnQ6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgdG90YWxSZXNwb25zZVRpbWU6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBDYWNoZUNvbmZpZyA9IERFRkFVTFRfQ0FDSEVfQ09ORklHKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLmluTWVtb3J5Q2FjaGUgPSBuZXcgSW5NZW1vcnlDYWNoZShcbiAgICAgIGNvbmZpZy5pbk1lbW9yeU1heFNpemUsXG4gICAgICBjb25maWcuaW5NZW1vcnlUdGxNcyxcbiAgICApO1xuICAgIHRoaXMubWV0cmljcyA9IHtcbiAgICAgIHJlZGlzQ29ubmVjdGVkOiBmYWxzZSxcbiAgICAgIGZhbGxiYWNrQWN0aXZlOiBmYWxzZSxcbiAgICAgIHRvdGFsT3BlcmF0aW9uczogMCxcbiAgICAgIHJlZGlzSGl0czogMCxcbiAgICAgIHJlZGlzTWlzc2VzOiAwLFxuICAgICAgbWVtb3J5SGl0czogMCxcbiAgICAgIG1lbW9yeU1pc3NlczogMCxcbiAgICAgIGVycm9yczogMCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYWNoZSBjb25maWd1cmF0aW9uIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlQ29uZmlnRnJvbUVudigpOiBDYWNoZUNvbmZpZyB7XG4gICAgY29uc3QgcmVkaXNVcmwgPSBwcm9jZXNzLmVudi5SRURJU19VUkw7XG4gICAgbGV0IHJlZGlzQ29uZmlnOiBDYWNoZUNvbmZpZ1tcInJlZGlzXCJdID0gdW5kZWZpbmVkO1xuICAgIGNvbnN0IHJlZGlzRGlzYWJsZWQgPSBwcm9jZXNzLmVudi5SRURJU19ESVNBQkxFRCA9PT0gXCJ0cnVlXCI7XG5cbiAgICBpZiAocmVkaXNVcmwgJiYgIXJlZGlzRGlzYWJsZWQpIHtcbiAgICAgIHJlZGlzQ29uZmlnID0geyB1cmw6IHJlZGlzVXJsIH07XG4gICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5SRURJU19IT1NUKSB7XG4gICAgICByZWRpc0NvbmZpZyA9IHtcbiAgICAgICAgaG9zdDogcHJvY2Vzcy5lbnYuUkVESVNfSE9TVCxcbiAgICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuUkVESVNfUE9SVCB8fCBcIjYzNzlcIiksXG4gICAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURJU19QQVNTV09SRCxcbiAgICAgICAgZGI6IHBhcnNlSW50KHByb2Nlc3MuZW52LlJFRElTX0RCIHx8IFwiMFwiKSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZGlzOiByZWRpc0NvbmZpZyxcbiAgICAgIGVuYWJsZUluTWVtb3J5RmFsbGJhY2s6XG4gICAgICAgIHByb2Nlc3MuZW52LkNBQ0hFX0VOQUJMRV9NRU1PUllfRkFMTEJBQ0sgIT09IFwiZmFsc2VcIixcbiAgICAgIGluTWVtb3J5TWF4U2l6ZTogcGFyc2VJbnQocHJvY2Vzcy5lbnYuQ0FDSEVfTUVNT1JZX01BWF9TSVpFIHx8IFwiMTAwMFwiKSxcbiAgICAgIGluTWVtb3J5VHRsTXM6IHBhcnNlSW50KHByb2Nlc3MuZW52LkNBQ0hFX01FTU9SWV9UVEwgfHwgXCIzMDAwMDBcIiksXG4gICAgICBoZWFsdGhDaGVja0ludGVydmFsTXM6IHBhcnNlSW50KFxuICAgICAgICBwcm9jZXNzLmVudi5DQUNIRV9IRUFMVEhfQ0hFQ0tfSU5URVJWQUwgfHwgXCIzMDAwMFwiLFxuICAgICAgKSxcbiAgICAgIGhlYWx0aENoZWNrVGltZW91dE1zOiBwYXJzZUludChcbiAgICAgICAgcHJvY2Vzcy5lbnYuQ0FDSEVfSEVBTFRIX0NIRUNLX1RJTUVPVVQgfHwgXCI1MDAwXCIsXG4gICAgICApLFxuICAgICAgbWF4UmVjb25uZWN0QXR0ZW1wdHM6IHBhcnNlSW50KFxuICAgICAgICBwcm9jZXNzLmVudi5DQUNIRV9NQVhfUkVDT05ORUNUX0FUVEVNUFRTIHx8IFwiNVwiLFxuICAgICAgKSxcbiAgICAgIHJlY29ubmVjdERlbGF5TXM6IHBhcnNlSW50KHByb2Nlc3MuZW52LkNBQ0hFX1JFQ09OTkVDVF9ERUxBWSB8fCBcIjUwMDBcIiksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGNhY2hlIG1hbmFnZXJcbiAgICovXG4gIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5pbk1lbW9yeUNhY2hlLmluaXRpYWxpemUoKTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5yZWRpcykge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUmVkaXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJSZWRpcyBub3QgY29uZmlndXJlZCwgdXNpbmcgaW4tbWVtb3J5IGNhY2hlIG9ubHlcIik7XG4gICAgICB0aGlzLm1ldHJpY3MuZmFsbGJhY2tBY3RpdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIEVtaXQgaW5pdGlhbGl6ZWQgZXZlbnRcbiAgICB0aGlzLmVtaXQoJ2luaXRpYWxpemVkJywge1xuICAgICAgcmVkaXNFbmFibGVkOiAhIXRoaXMuY29uZmlnLnJlZGlzLFxuICAgICAgZmFsbGJhY2tBY3RpdmU6IHRoaXMubWV0cmljcy5mYWxsYmFja0FjdGl2ZVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplUmVkaXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZWRpcykgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMucmVkaXNDbGllbnQgPSBjcmVhdGVDbGllbnQoe1xuICAgICAgICB1cmw6IHRoaXMuY29uZmlnLnJlZGlzLnVybCxcbiAgICAgICAgc29ja2V0OiB7XG4gICAgICAgICAgaG9zdDogdGhpcy5jb25maWcucmVkaXMuaG9zdCxcbiAgICAgICAgICBwb3J0OiB0aGlzLmNvbmZpZy5yZWRpcy5wb3J0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucmVkaXNDbGllbnQub24oXCJlcnJvclwiLCAoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWRpcyBlcnJvcjpcIiwgZXJyKTtcbiAgICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWV0cmljcy5mYWxsYmFja0FjdGl2ZSA9IHRydWU7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5yZWRpc0NsaWVudC5vbihcImNvbm5lY3RcIiwgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlZGlzIGNvbm5lY3RlZFwiKTtcbiAgICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tZXRyaWNzLmZhbGxiYWNrQWN0aXZlID0gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgdGhpcy5yZWRpc0NsaWVudC5jb25uZWN0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBjb25uZWN0IHRvIFJlZGlzLCB1c2luZyBmYWxsYmFjazpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm1ldHJpY3MuZmFsbGJhY2tBY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBuYW1lc3BhY2VkIGtleVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRLZXkobmFtZXNwYWNlOiBzdHJpbmcgfCBDYWNoZU5hbWVzcGFjZSwga2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHtuYW1lc3BhY2V9OiR7a2V5fWA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZhbHVlIGZyb20gY2FjaGVcbiAgICogU3VwcG9ydHMgYm90aCBnZXQoa2V5KSBhbmQgZ2V0KG5hbWVzcGFjZSwga2V5KSBzaWduYXR1cmVzXG4gICAqL1xuICBhc3luYyBnZXQ8VD4oXG4gICAgYXJnMTogc3RyaW5nIHwgQ2FjaGVOYW1lc3BhY2UsXG4gICAgYXJnMj86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxDYWNoZVJlc3VsdDxUPj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgbGV0IGtleTogc3RyaW5nO1xuXG4gICAgaWYgKGFyZzIpIHtcbiAgICAgIGtleSA9IHRoaXMuZ2V0S2V5KGFyZzEsIGFyZzIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBrZXkgPSBhcmcxIGFzIHN0cmluZztcbiAgICB9XG5cbiAgICB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zKys7XG5cbiAgICAvLyBUcnkgUmVkaXMgZmlyc3RcbiAgICBpZiAodGhpcy5yZWRpc0NsaWVudCAmJiB0aGlzLm1ldHJpY3MucmVkaXNDb25uZWN0ZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgdGhpcy5yZWRpc0NsaWVudC5nZXQoa2V5KTtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgICB0aGlzLnRvdGFsUmVzcG9uc2VUaW1lICs9IGR1cmF0aW9uO1xuICAgICAgICBcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzSGl0cysrO1xuICAgICAgICAgIHRoaXMuZW1pdCgnY2FjaGU6aGl0JywgeyBzb3VyY2U6ICdyZWRpcycsIGtleSwgZHVyYXRpb24gfSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogSlNPTi5wYXJzZSh2YWx1ZSkgYXMgVCxcbiAgICAgICAgICAgIHNvdXJjZTogJ3JlZGlzJ1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzTWlzc2VzKys7XG4gICAgICAgICAgdGhpcy5lbWl0KCdjYWNoZTptaXNzJywgeyBzb3VyY2U6ICdyZWRpcycsIGtleSwgZHVyYXRpb24gfSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgc291cmNlOiAncmVkaXMnXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRoaXMubWV0cmljcy5lcnJvcnMrKztcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgICB0aGlzLmVtaXQoJ2NhY2hlOmVycm9yJywgeyBcbiAgICAgICAgICBzb3VyY2U6ICdyZWRpcycsIFxuICAgICAgICAgIGtleSwgXG4gICAgICAgICAgZXJyb3I6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgICAgZHVyYXRpb24gXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBGYWxsIHRocm91Z2ggdG8gbWVtb3J5IGNhY2hlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmFsbGJhY2sgdG8gbWVtb3J5XG4gICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUluTWVtb3J5RmFsbGJhY2spIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5pbk1lbW9yeUNhY2hlLmdldDxUPihrZXkpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgdGhpcy50b3RhbFJlc3BvbnNlVGltZSArPSBkdXJhdGlvbjtcbiAgICAgIFxuICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5tZXRyaWNzLm1lbW9yeUhpdHMrKztcbiAgICAgICAgdGhpcy5lbWl0KCdjYWNoZTpoaXQnLCB7IHNvdXJjZTogJ21lbW9yeScsIGtleSwgZHVyYXRpb24gfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBzb3VyY2U6ICdtZW1vcnknXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm1ldHJpY3MubWVtb3J5TWlzc2VzKys7XG4gICAgICAgIHRoaXMuZW1pdCgnY2FjaGU6bWlzcycsIHsgc291cmNlOiAnbWVtb3J5Jywga2V5LCBkdXJhdGlvbiB9KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBzb3VyY2U6ICdtZW1vcnknXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc291cmNlOiAnbm9uZSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB2YWx1ZSBpbiBjYWNoZVxuICAgKiBTdXBwb3J0cyBib3RoIHNldChrZXksIHZhbHVlLCB0dGw/KSBhbmQgc2V0KG5hbWVzcGFjZSwga2V5LCB2YWx1ZSwgdHRsPylcbiAgICovXG4gIGFzeW5jIHNldDxUPihcbiAgICBhcmcxOiBzdHJpbmcgfCBDYWNoZU5hbWVzcGFjZSxcbiAgICBhcmcyOiBzdHJpbmcgfCBULFxuICAgIGFyZzM/OiBUIHwgbnVtYmVyLFxuICAgIGFyZzQ/OiBudW1iZXIsXG4gICk6IFByb21pc2U8Q2FjaGVSZXN1bHQ8dm9pZD4+IHtcbiAgICBsZXQga2V5OiBzdHJpbmc7XG4gICAgbGV0IHZhbHVlOiBUO1xuICAgIGxldCB0dGw6IG51bWJlciB8IHVuZGVmaW5lZDtcblxuICAgIC8vIENoZWNrIGlmIGZpcnN0IGFyZ3VtZW50IGlzIGEgbmFtZXNwYWNlIGVudW1cbiAgICBpZiAodHlwZW9mIGFyZzEgPT09IFwic3RyaW5nXCIgJiYgT2JqZWN0LnZhbHVlcyhDYWNoZU5hbWVzcGFjZSkuaW5jbHVkZXMoYXJnMSBhcyBDYWNoZU5hbWVzcGFjZSkpIHtcbiAgICAgIC8vIHNldChuYW1lc3BhY2UsIGtleSwgdmFsdWUsIHR0bD8pXG4gICAgICBrZXkgPSB0aGlzLmdldEtleShhcmcxIGFzIENhY2hlTmFtZXNwYWNlLCBhcmcyIGFzIHN0cmluZyk7XG4gICAgICB2YWx1ZSA9IGFyZzMgYXMgVDtcbiAgICAgIHR0bCA9IGFyZzQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHNldChrZXksIHZhbHVlLCB0dGw/KVxuICAgICAga2V5ID0gYXJnMSBhcyBzdHJpbmc7XG4gICAgICB2YWx1ZSA9IGFyZzIgYXMgVDtcbiAgICAgIHR0bCA9IGFyZzMgYXMgbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHN0cmluZ1ZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMrKztcblxuICAgIC8vIFRyeSBSZWRpcyBmaXJzdFxuICAgIGlmICh0aGlzLnJlZGlzQ2xpZW50ICYmIHRoaXMubWV0cmljcy5yZWRpc0Nvbm5lY3RlZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHR0bCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuc2V0RXgoa2V5LCB0dGwsIHN0cmluZ1ZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzQ2xpZW50LnNldChrZXksIHN0cmluZ1ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgc291cmNlOiAncmVkaXMnXG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5tZXRyaWNzLmVycm9ycysrO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUmVkaXMgc2V0IGVycm9yOlwiLCBlcnIpO1xuICAgICAgICAvLyBGYWxsIHRocm91Z2ggdG8gbWVtb3J5IGNhY2hlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmFsbGJhY2sgdG8gbWVtb3J5XG4gICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUluTWVtb3J5RmFsbGJhY2spIHtcbiAgICAgIHRoaXMuaW5NZW1vcnlDYWNoZS5zZXQoXG4gICAgICAgIGtleSxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIHR0bCA/IHR0bCAqIDEwMDAgOiB0aGlzLmNvbmZpZy5pbk1lbW9yeVR0bE1zLFxuICAgICAgKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHNvdXJjZTogJ21lbW9yeSdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc291cmNlOiAnbm9uZScsXG4gICAgICBlcnJvcjogJ05vIGNhY2hlIGJhY2tlbmQgYXZhaWxhYmxlJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIHZhbHVlIGZyb20gY2FjaGVcbiAgICogU3VwcG9ydHMgZGVsZXRlKGtleSkgYW5kIGRlbGV0ZShuYW1lc3BhY2UsIGtleSlcbiAgICovXG4gIGFzeW5jIGRlbGV0ZShhcmcxOiBzdHJpbmcgfCBDYWNoZU5hbWVzcGFjZSwgYXJnMj86IHN0cmluZyk6IFByb21pc2U8Q2FjaGVSZXN1bHQ8dm9pZD4+IHtcbiAgICBsZXQga2V5OiBzdHJpbmc7XG4gICAgaWYgKGFyZzIpIHtcbiAgICAgIGtleSA9IHRoaXMuZ2V0S2V5KGFyZzEsIGFyZzIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBrZXkgPSBhcmcxIGFzIHN0cmluZztcbiAgICB9XG5cbiAgICB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zKys7XG4gICAgbGV0IHJlZGlzU3VjY2VzcyA9IGZhbHNlO1xuICAgIGxldCBtZW1vcnlTdWNjZXNzID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5yZWRpc0NsaWVudCAmJiB0aGlzLm1ldHJpY3MucmVkaXNDb25uZWN0ZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuZGVsKGtleSk7XG4gICAgICAgIHJlZGlzU3VjY2VzcyA9IHRydWU7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5tZXRyaWNzLmVycm9ycysrO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiUmVkaXMgZGVsZXRlIGVycm9yOlwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVJbk1lbW9yeUZhbGxiYWNrKSB7XG4gICAgICB0aGlzLmluTWVtb3J5Q2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICBtZW1vcnlTdWNjZXNzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAocmVkaXNTdWNjZXNzKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzb3VyY2U6ICdyZWRpcycgfTtcbiAgICB9IGVsc2UgaWYgKG1lbW9yeVN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNvdXJjZTogJ21lbW9yeScgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHNvdXJjZTogJ25vbmUnIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGUga2V5cyBieSBwYXR0ZXJuXG4gICAqL1xuICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihcbiAgICBuYW1lc3BhY2U6IENhY2hlTmFtZXNwYWNlLFxuICAgIHBhdHRlcm46IHN0cmluZyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZnVsbFBhdHRlcm4gPSB0aGlzLmdldEtleShuYW1lc3BhY2UsIHBhdHRlcm4pO1xuXG4gICAgaWYgKHRoaXMucmVkaXNDbGllbnQgJiYgdGhpcy5tZXRyaWNzLnJlZGlzQ29ubmVjdGVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBrZXlzID0gYXdhaXQgdGhpcy5yZWRpc0NsaWVudC5rZXlzKGZ1bGxQYXR0ZXJuKTtcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuZGVsKGtleXMpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlJlZGlzIGludmFsaWRhdGVQYXR0ZXJuIGVycm9yOlwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1lbW9yeSBjYWNoZSBkb2Vzbid0IGVmZmljaWVudGx5IHN1cHBvcnQgcGF0dGVybnMgaW4gdGhpcyBpbXBsZW1lbnRhdGlvblxuICAgIC8vIElkZWFsbHkgd2UgaXRlcmF0ZSBrZXlzXG4gICAgLy8gRm9yIG5vdywgYXNzdW1pbmcgUmVkaXMgaXMgcHJpbWFyeVxuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGUgZW50aXJlIG5hbWVzcGFjZVxuICAgKi9cbiAgYXN5bmMgaW52YWxpZGF0ZU5hbWVzcGFjZShuYW1lc3BhY2U6IENhY2hlTmFtZXNwYWNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihuYW1lc3BhY2UsIFwiKlwiKTtcbiAgfVxuXG4gIGFzeW5jIGNsZWFyKCk6IFByb21pc2U8Q2FjaGVSZXN1bHQ8dm9pZD4+IHtcbiAgICB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zKys7XG4gICAgbGV0IHJlZGlzU3VjY2VzcyA9IGZhbHNlO1xuICAgIGxldCBtZW1vcnlTdWNjZXNzID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5yZWRpc0NsaWVudCAmJiB0aGlzLm1ldHJpY3MucmVkaXNDb25uZWN0ZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuZmx1c2hEYigpO1xuICAgICAgICByZWRpc1N1Y2Nlc3MgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRoaXMubWV0cmljcy5lcnJvcnMrKztcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlJlZGlzIGNsZWFyIGVycm9yOlwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVJbk1lbW9yeUZhbGxiYWNrKSB7XG4gICAgICB0aGlzLmluTWVtb3J5Q2FjaGUuY2xlYXIoKTtcbiAgICAgIG1lbW9yeVN1Y2Nlc3MgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChyZWRpc1N1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNvdXJjZTogJ3JlZGlzJyB9O1xuICAgIH0gZWxzZSBpZiAobWVtb3J5U3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc291cmNlOiAnbWVtb3J5JyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgc291cmNlOiAnbm9uZScgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgY2FjaGUgaXMgaGVhbHRoeVxuICAgKi9cbiAgaXNIZWFsdGh5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY3MucmVkaXNDb25uZWN0ZWQgfHwgdGhpcy5jb25maWcuZW5hYmxlSW5NZW1vcnlGYWxsYmFjaztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FjaGUgc3RhdHVzXG4gICAqL1xuICBnZXRTdGF0dXMoKTogQ2FjaGVTdGF0dXMge1xuICAgIGNvbnN0IGhpdFJhdGUgPSB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zID4gMCBcbiAgICAgID8gKHRoaXMubWV0cmljcy5yZWRpc0hpdHMgKyB0aGlzLm1ldHJpY3MubWVtb3J5SGl0cykgLyB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zIFxuICAgICAgOiAwO1xuICAgIFxuICAgIGNvbnN0IGF2ZXJhZ2VSZXNwb25zZVRpbWUgPSB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zID4gMCBcbiAgICAgID8gdGhpcy50b3RhbFJlc3BvbnNlVGltZSAvIHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMgXG4gICAgICA6IDA7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXNDb25uZWN0ZWQ6IHRoaXMubWV0cmljcy5yZWRpc0Nvbm5lY3RlZCxcbiAgICAgIGZhbGxiYWNrQWN0aXZlOiB0aGlzLm1ldHJpY3MuZmFsbGJhY2tBY3RpdmUsXG4gICAgICB0b3RhbE9wZXJhdGlvbnM6IHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMsXG4gICAgICBoaXRSYXRlLFxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIG1ldHJpY3NcbiAgICovXG4gIGdldE1ldHJpY3MoKTogQ2FjaGVNZXRyaWNzIHtcbiAgICByZXR1cm4geyAuLi50aGlzLm1ldHJpY3MgfTtcbiAgfVxuXG4gIGFzeW5jIHNodXRkb3duKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuaXNTaHV0dGluZ0Rvd24gPSB0cnVlO1xuICAgIGlmICh0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5oZWFsdGhDaGVja0ludGVydmFsKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVkaXNDbGllbnQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXNDbGllbnQuZGlzY29ubmVjdCgpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWRpcyBkaXNjb25uZWN0IGVycm9yOlwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmluTWVtb3J5Q2FjaGUuY2xlYXIoKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9