{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/services/ServiceClient.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/services/ServiceClient.test.ts"],"sourcesContent":["/**\n * Unit tests for ServiceClient\n */\n\nimport { ServiceClient, ServiceClientConfig, ServiceClientDefaults, ServiceClientError } from '../../src/services/ServiceClient';\nimport { CircuitBreakerDefaults } from '../../src/services/CircuitBreaker';\n\n// Mock node-fetch\njest.mock('node-fetch');\nconst mockFetch = require('node-fetch') as jest.MockedFunction<typeof import('node-fetch').default>;\n\ndescribe('ServiceClient', () => {\n  let serviceClient: ServiceClient;\n  let config: ServiceClientConfig;\n  let mockLogger: any;\n\n  beforeEach(() => {\n    mockLogger = {\n      info: jest.fn(),\n      warn: jest.fn(),\n      error: jest.fn()\n    };\n\n    config = {\n      baseUrl: 'https://api.example.com',\n      serviceName: 'test-service',\n      timeout: 5000,\n      maxRetries: 2,\n      initialRetryDelay: 100,\n      maxRetryDelay: 1000,\n      retryMultiplier: 2,\n      circuitBreakerConfig: CircuitBreakerDefaults.IMPORTANT,\n      enableLogging: true\n    };\n\n    serviceClient = new ServiceClient(config, mockLogger);\n    jest.clearAllMocks();\n  });\n\n  describe('constructor', () => {\n    it('should initialize with correct configuration', () => {\n      const clientConfig = serviceClient.getConfig();\n      expect(clientConfig.baseUrl).toBe('https://api.example.com');\n      expect(clientConfig.serviceName).toBe('test-service');\n    });\n\n    it('should use console as default logger', () => {\n      const client = new ServiceClient(config);\n      expect(client).toBeDefined();\n    });\n  });\n\n  describe('request method', () => {\n    it('should make successful GET request', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map([['content-type', 'application/json']]),\n        text: jest.fn().mockResolvedValue('{\"data\": \"test\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      const response = await serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      });\n\n      expect(response.status).toBe(200);\n      expect(response.data).toEqual({ data: 'test' });\n      expect(response.correlationId).toBeDefined();\n      expect(response.retryAttempts).toBe(0);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({\n          method: 'GET',\n          headers: expect.objectContaining({\n            'Content-Type': 'application/json',\n            'X-Correlation-ID': expect.any(String),\n            'X-Service-Client': 'test-service'\n          })\n        })\n      );\n    });\n\n    it('should make successful POST request with body', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 201,\n        statusText: 'Created',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"id\": 123}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      const requestBody = { name: 'test' };\n      const response = await serviceClient.request({\n        method: 'POST',\n        path: '/create',\n        body: requestBody\n      });\n\n      expect(response.status).toBe(201);\n      expect(response.data).toEqual({ id: 123 });\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/create',\n        expect.objectContaining({\n          method: 'POST',\n          body: JSON.stringify(requestBody)\n        })\n      );\n    });\n\n    it('should handle custom headers', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      await serviceClient.request({\n        method: 'GET',\n        path: '/test',\n        headers: { 'Authorization': 'Bearer token' }\n      });\n\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({\n          headers: expect.objectContaining({\n            'Authorization': 'Bearer token'\n          })\n        })\n      );\n    });\n\n    it('should use custom correlation ID', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      const correlationId = 'custom-correlation-id';\n      const response = await serviceClient.request({\n        method: 'GET',\n        path: '/test',\n        correlationId\n      });\n\n      expect(response.correlationId).toBe(correlationId);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({\n          headers: expect.objectContaining({\n            'X-Correlation-ID': correlationId\n          })\n        })\n      );\n    });\n  });\n\n  describe('error handling', () => {\n    it('should throw ServiceClientError for HTTP errors', async () => {\n      const mockResponse = {\n        ok: false,\n        status: 404,\n        statusText: 'Not Found',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"error\": \"Not found\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/not-found'\n      })).rejects.toThrow(ServiceClientError);\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/not-found'\n      })).rejects.toThrow('HTTP 404: Not Found');\n    });\n\n    it('should throw ServiceClientError for network errors', async () => {\n      mockFetch.mockRejectedValue(new Error('Network error'));\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      })).rejects.toThrow(ServiceClientError);\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      })).rejects.toThrow('Network error: Network error');\n    });\n\n    it('should handle non-JSON response gracefully', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('plain text response')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      const response = await serviceClient.request({\n        method: 'GET',\n        path: '/text'\n      });\n\n      expect(response.data).toBe('plain text response');\n    });\n  });\n\n  describe('retry logic', () => {\n    it('should retry on server errors', async () => {\n      const mockErrorResponse = {\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"error\": \"Server error\"}')\n      };\n      const mockSuccessResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"data\": \"success\"}')\n      };\n\n      mockFetch\n        .mockResolvedValueOnce(mockErrorResponse as any)\n        .mockResolvedValueOnce(mockSuccessResponse as any);\n\n      const response = await serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      });\n\n      expect(response.status).toBe(200);\n      expect(response.retryAttempts).toBe(1);\n      expect(mockFetch).toHaveBeenCalledTimes(2);\n    });\n\n    it('should not retry on client errors (except 408, 429)', async () => {\n      const mockResponse = {\n        ok: false,\n        status: 400,\n        statusText: 'Bad Request',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"error\": \"Bad request\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      })).rejects.toThrow(ServiceClientError);\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n\n    it('should retry on 408 and 429 errors', async () => {\n      const mock408Response = {\n        ok: false,\n        status: 408,\n        statusText: 'Request Timeout',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"error\": \"Timeout\"}')\n      };\n      const mockSuccessResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"data\": \"success\"}')\n      };\n\n      mockFetch\n        .mockResolvedValueOnce(mock408Response as any)\n        .mockResolvedValueOnce(mockSuccessResponse as any);\n\n      const response = await serviceClient.request({\n        method: 'GET',\n        path: '/test'\n      });\n\n      expect(response.status).toBe(200);\n      expect(mockFetch).toHaveBeenCalledTimes(2);\n    });\n\n    it('should respect custom retry count', async () => {\n      const mockResponse = {\n        ok: false,\n        status: 500,\n        statusText: 'Internal Server Error',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"error\": \"Server error\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      await expect(serviceClient.request({\n        method: 'GET',\n        path: '/test',\n        retries: 0\n      })).rejects.toThrow(ServiceClientError);\n\n      expect(mockFetch).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('convenience methods', () => {\n    beforeEach(() => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"data\": \"test\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n    });\n\n    it('should support GET convenience method', async () => {\n      await serviceClient.get('/test');\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({ method: 'GET' })\n      );\n    });\n\n    it('should support POST convenience method', async () => {\n      const body = { data: 'test' };\n      await serviceClient.post('/test', body);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({ \n          method: 'POST',\n          body: JSON.stringify(body)\n        })\n      );\n    });\n\n    it('should support PUT convenience method', async () => {\n      const body = { data: 'test' };\n      await serviceClient.put('/test', body);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({ \n          method: 'PUT',\n          body: JSON.stringify(body)\n        })\n      );\n    });\n\n    it('should support DELETE convenience method', async () => {\n      await serviceClient.delete('/test');\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({ method: 'DELETE' })\n      );\n    });\n\n    it('should support PATCH convenience method', async () => {\n      const body = { data: 'test' };\n      await serviceClient.patch('/test', body);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/test',\n        expect.objectContaining({ \n          method: 'PATCH',\n          body: JSON.stringify(body)\n        })\n      );\n    });\n  });\n\n  describe('health check', () => {\n    it('should make health check request with correct parameters', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{\"status\": \"healthy\"}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      const response = await serviceClient.healthCheck();\n\n      expect(response.status).toBe(200);\n      expect(mockFetch).toHaveBeenCalledWith(\n        'https://api.example.com/health',\n        expect.objectContaining({\n          method: 'GET',\n          timeout: 5000\n        })\n      );\n    });\n  });\n\n  describe('circuit breaker integration', () => {\n    it('should use circuit breaker by default', async () => {\n      // Force circuit breaker to open\n      const stats = serviceClient.getCircuitBreakerStats();\n      expect(stats.state).toBe('CLOSED');\n    });\n\n    it('should skip circuit breaker when requested', async () => {\n      const mockResponse = {\n        ok: true,\n        status: 200,\n        statusText: 'OK',\n        headers: new Map(),\n        text: jest.fn().mockResolvedValue('{}')\n      };\n      mockFetch.mockResolvedValue(mockResponse as any);\n\n      await serviceClient.request({\n        method: 'GET',\n        path: '/test',\n        skipCircuitBreaker: true\n      });\n\n      // Should not affect circuit breaker stats\n      const stats = serviceClient.getCircuitBreakerStats();\n      expect(stats.totalRequests).toBe(0);\n    });\n  });\n\n  describe('configuration management', () => {\n    it('should allow updating default headers', () => {\n      serviceClient.updateDefaultHeaders({ 'X-Custom': 'value' });\n      const config = serviceClient.getConfig();\n      expect(config.defaultHeaders).toEqual({ 'X-Custom': 'value' });\n    });\n  });\n});\n\ndescribe('ServiceClientDefaults', () => {\n  it('should provide different configurations for different service types', () => {\n    expect(ServiceClientDefaults.CRITICAL.timeout).toBeGreaterThan(\n      ServiceClientDefaults.OPTIONAL.timeout!\n    );\n    expect(ServiceClientDefaults.CRITICAL.maxRetries).toBeGreaterThan(\n      ServiceClientDefaults.OPTIONAL.maxRetries!\n    );\n  });\n});"],"version":3}