{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/metrics/MetricsCollector.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/metrics/MetricsCollector.test.ts"],"sourcesContent":["/**\n * MetricsCollector Tests\n * \n * Comprehensive unit tests for the MetricsCollector class\n */\n\nimport { MetricsCollector, MetricType } from '../../src/metrics/MetricsCollector';\nimport { Logger } from '../../src/logging/Logger';\n\n// Mock Logger\njest.mock('../../src/logging/Logger');\nconst mockLogger = {\n  info: jest.fn(),\n  warn: jest.fn(),\n  error: jest.fn(),\n  debug: jest.fn()\n} as any;\n\ndescribe('MetricsCollector', () => {\n  let metricsCollector: MetricsCollector;\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    (Logger.getInstance as jest.Mock).mockReturnValue(mockLogger);\n    \n    metricsCollector = new MetricsCollector(mockLogger);\n  });\n\n  describe('constructor', () => {\n    it('should initialize with default metrics', () => {\n      expect(metricsCollector).toBeDefined();\n      \n      const summary = metricsCollector.getMetricsSummary();\n      expect(summary.totalMetrics).toBeGreaterThan(0);\n      expect(summary.httpRequests).toBe(0);\n      expect(summary.databaseQueries).toBe(0);\n      expect(summary.errors).toBe(0);\n    });\n\n    it('should initialize without logger', () => {\n      const collector = new MetricsCollector();\n      expect(collector).toBeDefined();\n    });\n  });\n\n  describe('metric registration', () => {\n    it('should register custom metrics', () => {\n      metricsCollector.registerMetric({\n        name: 'custom_counter',\n        type: MetricType.COUNTER,\n        help: 'A custom counter metric',\n        labels: ['type', 'status']\n      });\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('# HELP custom_counter A custom counter metric');\n      expect(prometheus).toContain('# TYPE custom_counter counter');\n    });\n  });\n\n  describe('HTTP metrics', () => {\n    it('should record HTTP request metrics', () => {\n      metricsCollector.recordHttpRequest('GET', '/api/test', 200, 0.150, 1024);\n\n      const summary = metricsCollector.getMetricsSummary();\n      expect(summary.httpRequests).toBe(1);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('http_requests_total{method=\"GET\",route=\"/api/test\",status_code=\"200\"} 1');\n    });\n\n    it('should track in-flight requests', () => {\n      metricsCollector.recordHttpRequestStart();\n      metricsCollector.recordHttpRequestStart();\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('http_requests_in_flight 2');\n\n      metricsCollector.recordHttpRequestEnd();\n      const prometheus2 = metricsCollector.getPrometheusMetrics();\n      expect(prometheus2).toContain('http_requests_in_flight 1');\n    });\n\n    it('should not allow negative in-flight requests', () => {\n      metricsCollector.recordHttpRequestEnd();\n      metricsCollector.recordHttpRequestEnd();\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('http_requests_in_flight 0');\n    });\n\n    it('should emit HTTP request events', (done) => {\n      metricsCollector.on('http:request', (data) => {\n        expect(data.method).toBe('POST');\n        expect(data.route).toBe('/api/users');\n        expect(data.statusCode).toBe(201);\n        expect(data.duration).toBe(0.250);\n        expect(data.responseSize).toBe(512);\n        done();\n      });\n\n      metricsCollector.recordHttpRequest('POST', '/api/users', 201, 0.250, 512);\n    });\n  });\n\n  describe('database metrics', () => {\n    it('should record database connection metrics', () => {\n      metricsCollector.recordDatabaseConnections(5, 3, 2);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('database_connections_active 5');\n      expect(prometheus).toContain('database_connections_idle 3');\n      expect(prometheus).toContain('database_connections_waiting 2');\n    });\n\n    it('should record database query metrics', () => {\n      metricsCollector.recordDatabaseQuery('SELECT', 0.025, true);\n      metricsCollector.recordDatabaseQuery('INSERT', 0.050, false);\n\n      const summary = metricsCollector.getMetricsSummary();\n      expect(summary.databaseQueries).toBe(2);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('database_queries_total{operation=\"SELECT\",status=\"success\"} 1');\n      expect(prometheus).toContain('database_queries_total{operation=\"INSERT\",status=\"error\"} 1');\n    });\n\n    it('should emit database events', (done) => {\n      let eventCount = 0;\n      \n      metricsCollector.on('database:connections', (data) => {\n        expect(data.active).toBe(10);\n        expect(data.idle).toBe(5);\n        expect(data.waiting).toBe(0);\n        eventCount++;\n        if (eventCount === 2) done();\n      });\n\n      metricsCollector.on('database:query', (data) => {\n        expect(data.operation).toBe('UPDATE');\n        expect(data.duration).toBe(0.075);\n        expect(data.success).toBe(true);\n        eventCount++;\n        if (eventCount === 2) done();\n      });\n\n      metricsCollector.recordDatabaseConnections(10, 5, 0);\n      metricsCollector.recordDatabaseQuery('UPDATE', 0.075, true);\n    });\n  });\n\n  describe('health check metrics', () => {\n    it('should record health check metrics', () => {\n      metricsCollector.recordHealthCheck(true, 0.100);\n      metricsCollector.recordHealthCheck(false, 0.200);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('health_check_status 0'); // Last value (false)\n    });\n\n    it('should record component health status', () => {\n      metricsCollector.recordComponentHealth('database', true);\n      metricsCollector.recordComponentHealth('redis', false);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('component_health_status{component=\"database\"} 1');\n      expect(prometheus).toContain('component_health_status{component=\"redis\"} 0');\n    });\n\n    it('should emit health check events', (done) => {\n      let eventCount = 0;\n      \n      metricsCollector.on('health:check', (data) => {\n        expect(data.healthy).toBe(true);\n        expect(data.duration).toBe(0.050);\n        eventCount++;\n        if (eventCount === 2) done();\n      });\n\n      metricsCollector.on('health:component', (data) => {\n        expect(data.component).toBe('cache');\n        expect(data.healthy).toBe(false);\n        eventCount++;\n        if (eventCount === 2) done();\n      });\n\n      metricsCollector.recordHealthCheck(true, 0.050);\n      metricsCollector.recordComponentHealth('cache', false);\n    });\n  });\n\n  describe('business metrics', () => {\n    it('should record signal processing metrics', () => {\n      metricsCollector.recordSignalProcessed('BUY', true);\n      metricsCollector.recordSignalProcessed('SELL', false);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('signals_processed_total{type=\"BUY\",status=\"success\"} 1');\n      expect(prometheus).toContain('signals_processed_total{type=\"SELL\",status=\"error\"} 1');\n    });\n\n    it('should record order execution metrics', () => {\n      metricsCollector.recordOrderExecuted('BUY', true);\n      metricsCollector.recordOrderExecuted('SELL', true);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('orders_executed_total{side=\"BUY\",status=\"success\"} 1');\n      expect(prometheus).toContain('orders_executed_total{side=\"SELL\",status=\"success\"} 1');\n    });\n\n    it('should record error metrics', () => {\n      metricsCollector.recordError('validation_error', 'api');\n      metricsCollector.recordError('timeout_error', 'database');\n\n      const summary = metricsCollector.getMetricsSummary();\n      expect(summary.errors).toBe(2);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('errors_total{type=\"validation_error\",component=\"api\"} 1');\n      expect(prometheus).toContain('errors_total{type=\"timeout_error\",component=\"database\"} 1');\n    });\n\n    it('should emit business events', (done) => {\n      let eventCount = 0;\n      \n      metricsCollector.on('business:signal', (data) => {\n        expect(data.type).toBe('LONG');\n        expect(data.success).toBe(true);\n        eventCount++;\n        if (eventCount === 3) done();\n      });\n\n      metricsCollector.on('business:order', (data) => {\n        expect(data.side).toBe('BUY');\n        expect(data.success).toBe(false);\n        eventCount++;\n        if (eventCount === 3) done();\n      });\n\n      metricsCollector.on('error:recorded', (data) => {\n        expect(data.type).toBe('network_error');\n        expect(data.component).toBe('client');\n        eventCount++;\n        if (eventCount === 3) done();\n      });\n\n      metricsCollector.recordSignalProcessed('LONG', true);\n      metricsCollector.recordOrderExecuted('BUY', false);\n      metricsCollector.recordError('network_error', 'client');\n    });\n  });\n\n  describe('Prometheus output', () => {\n    it('should generate valid Prometheus format', () => {\n      metricsCollector.recordHttpRequest('GET', '/test', 200, 0.100, 500);\n      metricsCollector.recordDatabaseQuery('SELECT', 0.050, true);\n      metricsCollector.recordHealthCheck(true, 0.025);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      \n      // Check for required Prometheus format elements\n      expect(prometheus).toContain('# HELP');\n      expect(prometheus).toContain('# TYPE');\n      expect(prometheus).toMatch(/\\w+ \\d+(\\.\\d+)?/); // Metric name and value\n      \n      // Check for process metrics\n      expect(prometheus).toContain('process_start_time_seconds');\n      expect(prometheus).toContain('process_uptime_seconds');\n    });\n\n    it('should handle labels with special characters', () => {\n      metricsCollector.recordHttpRequest('GET', '/api/test\"quote', 200, 0.100, 500);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('route=\"/api/test\\\\\"quote\"');\n    });\n\n    it('should handle empty labels', () => {\n      metricsCollector.recordHealthCheck(true, 0.100);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('health_check_status 1');\n      expect(prometheus).not.toContain('health_check_status{} 1');\n    });\n  });\n\n  describe('metrics summary', () => {\n    it('should provide accurate summary', () => {\n      metricsCollector.recordHttpRequest('GET', '/test', 200, 0.100, 500);\n      metricsCollector.recordHttpRequest('POST', '/test', 201, 0.150, 600);\n      metricsCollector.recordDatabaseQuery('SELECT', 0.050, true);\n      metricsCollector.recordError('test_error', 'test_component');\n\n      const summary = metricsCollector.getMetricsSummary();\n      \n      expect(summary.httpRequests).toBe(2);\n      expect(summary.databaseQueries).toBe(1);\n      expect(summary.errors).toBe(1);\n      expect(summary.uptime).toBeGreaterThan(0);\n      expect(summary.totalMetrics).toBeGreaterThan(0);\n    });\n  });\n\n  describe('reset functionality', () => {\n    it('should reset all metrics', () => {\n      metricsCollector.recordHttpRequest('GET', '/test', 200, 0.100, 500);\n      metricsCollector.recordDatabaseQuery('SELECT', 0.050, true);\n      metricsCollector.recordError('test_error', 'test_component');\n\n      let summary = metricsCollector.getMetricsSummary();\n      expect(summary.httpRequests).toBe(1);\n      expect(summary.databaseQueries).toBe(1);\n      expect(summary.errors).toBe(1);\n\n      metricsCollector.reset();\n\n      summary = metricsCollector.getMetricsSummary();\n      expect(summary.httpRequests).toBe(0);\n      expect(summary.databaseQueries).toBe(0);\n      expect(summary.errors).toBe(0);\n    });\n  });\n\n  describe('histogram functionality', () => {\n    it('should record histogram values correctly', () => {\n      // Record various durations to test histogram buckets\n      metricsCollector.recordHttpRequest('GET', '/fast', 200, 0.001, 100);    // 1ms\n      metricsCollector.recordHttpRequest('GET', '/medium', 200, 0.050, 500);  // 50ms\n      metricsCollector.recordHttpRequest('GET', '/slow', 200, 1.500, 1000);   // 1.5s\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      \n      // Should contain histogram metrics\n      expect(prometheus).toContain('http_request_duration_seconds');\n      expect(prometheus).toContain('http_response_size_bytes');\n    });\n  });\n\n  describe('label matching', () => {\n    it('should correctly match labels for counter updates', () => {\n      metricsCollector.recordHttpRequest('GET', '/test', 200, 0.100, 500);\n      metricsCollector.recordHttpRequest('GET', '/test', 200, 0.150, 600);\n      metricsCollector.recordHttpRequest('GET', '/test', 404, 0.050, 100);\n\n      const prometheus = metricsCollector.getPrometheusMetrics();\n      expect(prometheus).toContain('http_requests_total{method=\"GET\",route=\"/test\",status_code=\"200\"} 2');\n      expect(prometheus).toContain('http_requests_total{method=\"GET\",route=\"/test\",status_code=\"404\"} 1');\n    });\n  });\n});"],"version":3}