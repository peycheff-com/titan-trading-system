ee68c3f449ae0c36c4e85320b391b68d
"use strict";
/**
 * TitanBrain - Master Orchestrator for Titan Trading System
 * Integrates all components: Allocation, Performance, Risk, Capital, and Circuit Breaker
 *
 * Requirements: 1.1, 1.7, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TitanBrain = void 0;
const PrometheusMetrics_js_1 = require("../monitoring/PrometheusMetrics.js");
/**
 * Phase priority for signal processing
 * Requirement 7.1: P3 > P2 > P1
 */
const PHASE_PRIORITY = {
    phase3: 3,
    phase2: 2,
    phase1: 1,
};
/**
 * TitanBrain orchestrates all components and processes signals
 */
class TitanBrain {
    config;
    allocationEngine;
    performanceTracker;
    riskGuardian;
    capitalFlowManager;
    circuitBreaker;
    stateRecoveryService;
    manualOverrideService;
    db;
    /** External integrations */
    executionEngine = null;
    phaseNotifier = null;
    notificationHandler = null;
    /** Signal queue for priority processing */
    signalQueue = [];
    /** Current state */
    currentEquity = 0;
    currentPositions = [];
    recentDecisions = [];
    dailyStartEquity = 0;
    recentTrades = [];
    /** Dashboard cache */
    dashboardCache = null;
    dashboardCacheTime = 0;
    /** Metrics update timer */
    metricsUpdateTimer = null;
    /** Signal approval tracking per phase */
    signalStats = {
        phase1: { approved: 0, total: 0 },
        phase2: { approved: 0, total: 0 },
        phase3: { approved: 0, total: 0 },
    };
    constructor(config, allocationEngine, performanceTracker, riskGuardian, capitalFlowManager, circuitBreaker, db, stateRecoveryService, manualOverrideService) {
        this.config = config;
        this.allocationEngine = allocationEngine;
        this.performanceTracker = performanceTracker;
        this.riskGuardian = riskGuardian;
        this.capitalFlowManager = capitalFlowManager;
        this.circuitBreaker = circuitBreaker;
        this.db = db ?? null;
        this.stateRecoveryService = stateRecoveryService ?? null;
        this.manualOverrideService = manualOverrideService ?? null;
        // Wire up circuit breaker handlers
        this.circuitBreaker.setPositionHandler(this);
        this.circuitBreaker.setEventPersistence(this);
    }
    /**
     * Initialize the brain and start metric updates
     * Requirement 9.4, 9.5: Load state and recalculate metrics on startup
     */
    async initialize() {
        console.log("üß† Initializing Titan Brain...");
        // Recover system state on startup
        if (this.stateRecoveryService) {
            console.log("üìä Recovering system state...");
            const recoveredState = await this.stateRecoveryService.recoverState();
            // Validate recovered state
            if (!this.stateRecoveryService.validateRecoveredState(recoveredState)) {
                console.warn("‚ö†Ô∏è Recovered state validation failed, using defaults");
            }
            else {
                console.log("‚úÖ State recovery completed successfully");
                // Apply recovered allocation if available
                if (recoveredState.allocation) {
                    console.log(`üìà Restored allocation: w1=${recoveredState.allocation.w1}, w2=${recoveredState.allocation.w2}, w3=${recoveredState.allocation.w3}`);
                }
                // Apply recovered high watermark
                if (recoveredState.highWatermark > 0) {
                    await this.capitalFlowManager.setHighWatermark(recoveredState.highWatermark);
                    console.log(`üí∞ Restored high watermark: $${recoveredState.highWatermark}`);
                }
                // Apply recovered performance metrics
                for (const [phaseId, performance] of Object.entries(recoveredState.performance)) {
                    console.log(`üìä Restored performance for ${phaseId}: Sharpe=${performance.sharpeRatio.toFixed(2)}, Modifier=${performance.modifier.toFixed(2)}`);
                }
            }
            // Recalculate risk metrics with current positions
            // Requirement 9.5: Recalculate all risk metrics before accepting new signals
            if (this.currentPositions.length > 0) {
                console.log("üîç Recalculating risk metrics with current positions...");
                const riskMetrics = this.stateRecoveryService.recalculateRiskMetrics(this.currentPositions, this.currentEquity);
                console.log("‚úÖ Risk metrics recalculated");
            }
        }
        // Initialize manual override service
        if (this.manualOverrideService) {
            await this.manualOverrideService.initialize();
            console.log("üîß Manual override service initialized");
        }
        // Initialize capital flow manager
        await this.capitalFlowManager.initialize();
        // Load daily start equity
        this.dailyStartEquity = this.currentEquity;
        this.circuitBreaker.setDailyStartEquity(this.dailyStartEquity);
        // Start periodic metric updates
        this.startMetricUpdates();
        console.log("üß† Titan Brain initialization completed");
    }
    /**
     * Shutdown the brain gracefully
     */
    async shutdown() {
        if (this.metricsUpdateTimer) {
            clearInterval(this.metricsUpdateTimer);
            this.metricsUpdateTimer = null;
        }
    }
    /**
     * Set the execution engine client
     */
    setExecutionEngine(client) {
        this.executionEngine = client;
    }
    /**
     * Set the phase notifier
     */
    setPhaseNotifier(notifier) {
        this.phaseNotifier = notifier;
    }
    /**
     * Set the notification handler
     */
    setNotificationHandler(handler) {
        this.notificationHandler = handler;
        this.circuitBreaker.setNotificationHandler(handler);
        // Set correlation notifier if handler supports it
        if ("sendHighCorrelationWarning" in handler) {
            this.riskGuardian.setCorrelationNotifier(handler);
        }
        // Set sweep notifier if handler supports it
        if ("sendSweepNotification" in handler) {
            this.capitalFlowManager.setSweepNotifier(handler);
        }
    }
    /**
     * Update current equity
     */
    setEquity(equity) {
        this.currentEquity = Math.max(0, equity);
        this.riskGuardian.setEquity(this.currentEquity);
    }
    /**
     * Update current positions
     */
    setPositions(positions) {
        this.currentPositions = positions;
    }
    /**
     * Set daily start equity (called at start of trading day)
     */
    setDailyStartEquity(equity) {
        this.dailyStartEquity = Math.max(0, equity);
        this.circuitBreaker.setDailyStartEquity(this.dailyStartEquity);
    }
    /**
     * Process an intent signal through the full pipeline
     * Requirement 7.5: Maximum latency of 100ms
     *
     * Pipeline:
     * 1. Check circuit breaker
     * 2. Get allocation weights
     * 3. Apply performance modifiers
     * 4. Check risk constraints
     * 5. Calculate authorized size
     * 6. Forward to execution or veto
     *
     * @param signal - Intent signal from a phase
     * @returns BrainDecision with approval status
     */
    async processSignal(signal) {
        const startTime = Date.now();
        const timestamp = startTime;
        // Check circuit breaker first
        if (this.circuitBreaker.isActive()) {
            const decision = this.createVetoDecision(signal, "Circuit breaker active: all signals rejected", timestamp);
            await this.recordDecision(decision, signal);
            return decision;
        }
        // Check breaker conditions with current state
        const breakerStatus = this.circuitBreaker.checkConditions({
            equity: this.currentEquity,
            positions: this.currentPositions,
            dailyStartEquity: this.dailyStartEquity,
            recentTrades: this.recentTrades,
        });
        if (breakerStatus.active) {
            const decision = this.createVetoDecision(signal, `Circuit breaker triggered: ${breakerStatus.reason}`, timestamp);
            await this.recordDecision(decision, signal);
            return decision;
        }
        // Get allocation weights (with manual override if active)
        const allocation = this.getAllocation();
        // Get performance modifier for the phase
        const performance = await this.performanceTracker.getPhasePerformance(signal.phaseId);
        // Calculate base allocation for this phase
        const phaseWeight = this.getPhaseWeight(signal.phaseId, allocation);
        const adjustedWeight = phaseWeight * performance.modifier;
        // Calculate max position size based on allocation
        // Requirement 1.7: Cap position size at Equity * Phase_Weight
        const maxPositionSize = this.currentEquity * adjustedWeight;
        // Check risk constraints
        const riskDecision = this.riskGuardian.checkSignal(signal, this.currentPositions);
        // Determine final authorized size
        let authorizedSize;
        let approved;
        let reason;
        if (!riskDecision.approved) {
            // Risk veto
            approved = false;
            authorizedSize = 0;
            reason = riskDecision.reason;
        }
        else {
            // Apply all constraints
            const riskAdjustedSize = riskDecision.adjustedSize ??
                signal.requestedSize;
            authorizedSize = Math.min(signal.requestedSize, maxPositionSize, riskAdjustedSize);
            // Requirement 1.7: Position size consistency
            if (authorizedSize <= 0) {
                approved = false;
                authorizedSize = 0;
                reason = "Authorized size is zero after applying constraints";
            }
            else {
                approved = true;
                reason = this.buildApprovalReason(signal.requestedSize, authorizedSize, maxPositionSize, riskDecision);
            }
        }
        const decision = {
            signalId: signal.signalId,
            approved,
            authorizedSize,
            reason,
            allocation,
            performance,
            risk: riskDecision,
            timestamp,
        };
        // Record decision
        await this.recordDecision(decision, signal);
        // Update signal stats
        this.updateSignalStats(signal.phaseId, approved);
        // Forward to execution or notify veto
        if (approved && this.executionEngine) {
            await this.executionEngine.forwardSignal(signal, authorizedSize);
        }
        else if (!approved) {
            // Requirement 7.6: Notify originating phase of veto
            if (this.phaseNotifier) {
                await this.phaseNotifier.notifyVeto(signal.phaseId, signal.signalId, reason);
            }
            // Send veto notification via notification service
            if (this.notificationHandler &&
                "sendVetoNotification" in this.notificationHandler) {
                try {
                    await this.notificationHandler.sendVetoNotification(signal.phaseId, signal.signalId, signal.symbol, reason, signal.requestedSize);
                }
                catch (error) {
                    console.error("Failed to send veto notification:", error);
                }
            }
        }
        // Check processing latency and record metrics
        const processingTime = Date.now() - startTime;
        if (processingTime > this.config.signalTimeout) {
            console.warn(`Signal processing exceeded timeout: ${processingTime}ms > ${this.config.signalTimeout}ms`);
        }
        // Record metrics
        const metrics = (0, PrometheusMetrics_js_1.getMetrics)();
        metrics.recordSignalLatency(signal.phaseId, processingTime, approved);
        return decision;
    }
    /**
     * Process multiple signals with priority ordering
     * Requirement 7.1: Process in priority order (P3 > P2 > P1)
     *
     * @param signals - Array of intent signals
     * @returns Array of brain decisions
     */
    async processSignals(signals) {
        // Sort by priority (highest first)
        const sortedSignals = [...signals].sort((a, b) => {
            return PHASE_PRIORITY[b.phaseId] - PHASE_PRIORITY[a.phaseId];
        });
        const decisions = [];
        for (const signal of sortedSignals) {
            const decision = await this.processSignal(signal);
            decisions.push(decision);
            // Update positions after each approved signal
            if (decision.approved && this.executionEngine) {
                this.currentPositions = await this.executionEngine.getPositions();
            }
        }
        return decisions;
    }
    /**
     * Enqueue a signal for processing
     * Requirement 7.4: Maintain signal queue with timestamps and phase source
     *
     * @param signal - Intent signal to enqueue
     */
    enqueueSignal(signal) {
        if (this.signalQueue.length >= this.config.maxQueueSize) {
            // Remove oldest signal
            this.signalQueue.shift();
        }
        this.signalQueue.push({
            signal,
            priority: PHASE_PRIORITY[signal.phaseId],
            enqueuedAt: Date.now(),
        });
        // Sort queue by priority
        this.signalQueue.sort((a, b) => b.priority - a.priority);
    }
    /**
     * Process all queued signals
     */
    async processQueue() {
        const signals = this.signalQueue.map((q) => q.signal);
        this.signalQueue = [];
        return this.processSignals(signals);
    }
    /**
     * Update all metrics periodically
     * Requirement 1.1: Recalculate allocation every 1 minute or on trade close
     */
    async updateMetrics() {
        // Update allocation
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        // Update capital flow target allocation
        const futuresAllocation = this.currentEquity *
            (allocation.w1 + allocation.w2);
        this.capitalFlowManager.setTargetAllocation(futuresAllocation);
        // Update high watermark
        await this.capitalFlowManager.updateHighWatermark(this.currentEquity);
        // Check sweep conditions
        await this.capitalFlowManager.performSweepIfNeeded();
        // Invalidate dashboard cache
        this.dashboardCache = null;
        // Update Prometheus metrics
        const metrics = (0, PrometheusMetrics_js_1.getMetrics)();
        metrics.updateEquity(this.currentEquity);
        metrics.updateAllocation(allocation.w1, allocation.w2, allocation.w3);
        metrics.updateCircuitBreakerStatus(this.circuitBreaker.isActive());
        metrics.updateHighWatermark(this.capitalFlowManager.getHighWatermark());
        // Update daily drawdown
        const dailyDrawdown = this.dailyStartEquity > 0
            ? ((this.dailyStartEquity - this.currentEquity) / this.dailyStartEquity) *
                100
            : 0;
        metrics.updateDailyDrawdown(Math.max(0, dailyDrawdown));
        // Update phase performance metrics
        for (const phaseId of ["phase1", "phase2", "phase3"]) {
            const performance = await this.performanceTracker.getPhasePerformance(phaseId);
            metrics.updatePhasePerformance(phaseId, performance.sharpeRatio, performance.modifier);
        }
    }
    /**
     * Record a trade result
     * Updates performance tracking and circuit breaker state
     *
     * @param phaseId - Phase that executed the trade
     * @param pnl - Trade PnL
     * @param symbol - Trading symbol
     * @param side - Trade side
     */
    async recordTrade(phaseId, pnl, symbol, side) {
        const timestamp = Date.now();
        // Record in performance tracker
        await this.performanceTracker.recordTrade(phaseId, pnl, timestamp, symbol, side);
        // Record for circuit breaker
        this.recentTrades.push({ pnl, timestamp });
        this.circuitBreaker.recordTrade(pnl, timestamp);
        // Clean up old trades (keep last hour)
        const oneHourAgo = timestamp - 3600000;
        this.recentTrades = this.recentTrades.filter((t) => t.timestamp >= oneHourAgo);
        // Update metrics after trade
        await this.updateMetrics();
    }
    /**
     * Get dashboard data for UI
     * Requirement 10.1-10.7: Dashboard visibility
     *
     * @returns DashboardData with all metrics
     */
    async getDashboardData() {
        // Check cache
        if (this.dashboardCache &&
            Date.now() - this.dashboardCacheTime < this.config.dashboardCacheTTL) {
            return this.dashboardCache;
        }
        // Get allocation
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        // Calculate phase equity
        const phaseEquity = {
            phase1: this.currentEquity * allocation.w1,
            phase2: this.currentEquity * allocation.w2,
            phase3: this.currentEquity * allocation.w3,
        };
        // Get risk metrics
        const riskMetrics = this.riskGuardian.getRiskMetrics(this.currentPositions);
        // Get treasury status
        const treasury = await this.capitalFlowManager.getTreasuryStatus();
        // Get circuit breaker status
        const circuitBreaker = this.circuitBreaker.getStatus();
        // Get recent decisions (last 20)
        const recentDecisions = this.recentDecisions.slice(-20);
        // Get manual override status
        const manualOverride = this.getCurrentManualOverride();
        const warningBannerActive = this.isWarningBannerActive();
        const dashboardData = {
            nav: this.currentEquity,
            allocation,
            phaseEquity,
            riskMetrics: {
                globalLeverage: riskMetrics.currentLeverage,
                netDelta: riskMetrics.portfolioDelta,
                correlationScore: riskMetrics.correlation,
                portfolioBeta: riskMetrics.portfolioBeta,
            },
            treasury,
            circuitBreaker,
            recentDecisions,
            lastUpdated: Date.now(),
            manualOverride: manualOverride
                ? {
                    active: true,
                    operatorId: manualOverride.operatorId,
                    reason: manualOverride.reason,
                    allocation: manualOverride.overrideAllocation,
                    expiresAt: manualOverride.expiresAt,
                }
                : null,
            warningBannerActive,
        };
        // Cache the result
        this.dashboardCache = dashboardData;
        this.dashboardCacheTime = Date.now();
        return dashboardData;
    }
    /**
     * Get system health status
     *
     * @returns HealthStatus with component health
     */
    async getHealthStatus() {
        const errors = [];
        const components = {
            database: false,
            redis: false,
            executionEngine: false,
            phases: {
                phase1: false,
                phase2: false,
                phase3: false,
            },
        };
        // Check database
        if (this.db) {
            try {
                await this.db.query("SELECT 1");
                components.database = true;
            }
            catch (error) {
                errors.push(`Database: ${error instanceof Error ? error.message : "Unknown error"}`);
            }
        }
        else {
            // For Railway deployment without database, consider it healthy
            components.database = true;
        }
        // Check execution engine (optional for Railway)
        if (this.executionEngine) {
            try {
                await this.executionEngine.getPositions();
                components.executionEngine = true;
            }
            catch (error) {
                errors.push(`Execution Engine: ${error instanceof Error ? error.message : "Unknown error"}`);
            }
        }
        else {
            // For Railway deployment without execution engine, consider it healthy
            components.executionEngine = true;
        }
        // Check phase approval rates
        // Requirement 7.8: Flag for review if approval rate < 50%
        for (const phaseId of ["phase1", "phase2", "phase3"]) {
            const stats = this.signalStats[phaseId];
            if (stats.total > 0) {
                const approvalRate = stats.approved / stats.total;
                components.phases[phaseId] = approvalRate >= 0.5;
                if (approvalRate < 0.5) {
                    errors.push(`${phaseId}: Approval rate ${(approvalRate * 100).toFixed(1)}% < 50%`);
                }
            }
            else {
                components.phases[phaseId] = true; // No signals yet
            }
        }
        // For Railway deployment, be more lenient with health checks
        const isRailwayDeployment = process.env.RAILWAY_ENVIRONMENT === "true";
        const healthy = isRailwayDeployment
            ? // Railway: Just check that the service is running (phases are healthy)
                Object.values(components.phases).every(Boolean)
            : // Local: Check all components
                components.database &&
                    components.executionEngine &&
                    Object.values(components.phases).every(Boolean);
        return {
            healthy,
            components,
            lastCheck: Date.now(),
            errors,
        };
    }
    /**
     * Get signal approval rate for a phase
     * Requirement 7.7: Track signal approval rate per phase
     *
     * @param phaseId - Phase to check
     * @returns Approval rate (0-1)
     */
    getApprovalRate(phaseId) {
        const stats = this.signalStats[phaseId];
        if (stats.total === 0)
            return 1.0;
        return stats.approved / stats.total;
    }
    /**
     * Get all phase approval rates
     */
    getAllApprovalRates() {
        return {
            phase1: this.getApprovalRate("phase1"),
            phase2: this.getApprovalRate("phase2"),
            phase3: this.getApprovalRate("phase3"),
        };
    }
    /**
     * Reset signal stats (e.g., at start of day)
     */
    resetSignalStats() {
        this.signalStats = {
            phase1: { approved: 0, total: 0 },
            phase2: { approved: 0, total: 0 },
            phase3: { approved: 0, total: 0 },
        };
    }
    /**
     * Get current allocation vector (with manual override if active)
     * Requirement 9.7: Support manual override of allocation weights
     */
    getAllocation() {
        const normalAllocation = this.allocationEngine.getWeights(this.currentEquity);
        // Apply manual override if active
        if (this.manualOverrideService) {
            return this.manualOverrideService.getEffectiveAllocation(normalAllocation);
        }
        return normalAllocation;
    }
    /**
     * Get current equity
     */
    getEquity() {
        return this.currentEquity;
    }
    /**
     * Get current positions
     */
    getPositions() {
        return [...this.currentPositions];
    }
    /**
     * Get circuit breaker status
     */
    getCircuitBreakerStatus() {
        return this.circuitBreaker.getStatus();
    }
    /**
     * Manually reset circuit breaker
     * Requirement 5.8: Require operator ID
     *
     * @param operatorId - ID of operator performing reset
     */
    async resetCircuitBreaker(operatorId) {
        await this.circuitBreaker.reset(operatorId);
    }
    /**
     * Get configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Create a manual allocation override
     * Requirement 9.7: Create admin endpoint for allocation override
     *
     * @param operatorId - Operator creating the override
     * @param password - Operator password
     * @param allocation - New allocation vector
     * @param reason - Reason for override
     * @param durationHours - Optional duration in hours
     * @returns True if override created successfully
     */
    async createManualOverride(operatorId, password, allocation, reason, durationHours) {
        if (!this.manualOverrideService) {
            console.error("Manual override service not available");
            return false;
        }
        // Authenticate operator
        const authenticated = await this.manualOverrideService.authenticateOperator(operatorId, password);
        if (!authenticated) {
            console.warn(`Manual override rejected: authentication failed for operator ${operatorId}`);
            return false;
        }
        // Create override
        const override = await this.manualOverrideService.createOverride({
            operatorId,
            allocation,
            reason,
            durationHours,
        });
        if (override) {
            console.log(`‚úÖ Manual override created by operator ${operatorId}`);
            console.log(`   New allocation: w1=${allocation.w1}, w2=${allocation.w2}, w3=${allocation.w3}`);
            console.log(`   Reason: ${reason}`);
            // Invalidate dashboard cache to show warning banner
            this.dashboardCache = null;
            return true;
        }
        return false;
    }
    /**
     * Deactivate the current manual override
     *
     * @param operatorId - Operator deactivating the override
     * @param password - Operator password
     * @returns True if successfully deactivated
     */
    async deactivateManualOverride(operatorId, password) {
        if (!this.manualOverrideService) {
            console.error("Manual override service not available");
            return false;
        }
        // Authenticate operator
        const authenticated = await this.manualOverrideService.authenticateOperator(operatorId, password);
        if (!authenticated) {
            console.warn(`Manual override deactivation rejected: authentication failed for operator ${operatorId}`);
            return false;
        }
        const success = await this.manualOverrideService.deactivateOverride(operatorId);
        if (success) {
            console.log(`‚úÖ Manual override deactivated by operator ${operatorId}`);
            // Invalidate dashboard cache to hide warning banner
            this.dashboardCache = null;
        }
        return success;
    }
    /**
     * Get current manual override status
     *
     * @returns Current override or null if none active
     */
    getCurrentManualOverride() {
        if (!this.manualOverrideService)
            return null;
        return this.manualOverrideService.getCurrentOverride();
    }
    /**
     * Check if warning banner should be displayed
     * Requirement 9.8: Implement warning banner flag
     *
     * @returns True if warning banner should be shown
     */
    isWarningBannerActive() {
        if (!this.manualOverrideService)
            return false;
        return this.manualOverrideService.isWarningBannerActive();
    }
    /**
     * Get manual override history
     *
     * @param operatorId - Optional operator filter
     * @param limit - Maximum number of records
     * @returns Array of historical overrides
     */
    async getManualOverrideHistory(operatorId, limit = 50) {
        if (!this.manualOverrideService)
            return [];
        return this.manualOverrideService.getOverrideHistory(operatorId, limit);
    }
    /**
     * Create a new operator account
     *
     * @param operatorId - Unique operator identifier
     * @param password - Operator password
     * @param permissions - Array of permissions
     * @returns True if created successfully
     */
    async createOperator(operatorId, password, permissions) {
        if (!this.manualOverrideService) {
            console.error("Manual override service not available");
            return false;
        }
        return this.manualOverrideService.createOperator(operatorId, password, permissions);
    }
    // ============ PositionClosureHandler Implementation ============
    /**
     * Close all positions (called by circuit breaker)
     */
    async closeAllPositions() {
        if (this.executionEngine) {
            await this.executionEngine.closeAllPositions();
            this.currentPositions = [];
        }
    }
    // ============ BreakerEventPersistence Implementation ============
    /**
     * Persist circuit breaker event to database
     */
    async persistEvent(event) {
        if (!this.db)
            return;
        await this.db.query(`INSERT INTO circuit_breaker_events 
       (timestamp, event_type, reason, equity, operator_id, metadata)
       VALUES ($1, $2, $3, $4, $5, $6)`, [
            event.timestamp,
            event.eventType,
            event.reason,
            event.equity,
            event.operatorId ?? null,
            event.metadata ? JSON.stringify(event.metadata) : null,
        ]);
    }
    // ============ Private Helper Methods ============
    /**
     * Start periodic metric updates
     */
    startMetricUpdates() {
        if (this.metricsUpdateTimer) {
            clearInterval(this.metricsUpdateTimer);
        }
        this.metricsUpdateTimer = setInterval(async () => {
            try {
                await this.updateMetrics();
            }
            catch (error) {
                console.error("Error updating metrics:", error);
            }
        }, this.config.metricUpdateInterval);
    }
    /**
     * Get phase weight from allocation vector
     */
    getPhaseWeight(phaseId, allocation) {
        switch (phaseId) {
            case "phase1":
                return allocation.w1;
            case "phase2":
                return allocation.w2;
            case "phase3":
                return allocation.w3;
            default:
                return 0;
        }
    }
    /**
     * Create a veto decision
     */
    createVetoDecision(signal, reason, timestamp) {
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        const riskMetrics = this.riskGuardian.getRiskMetrics(this.currentPositions);
        return {
            signalId: signal.signalId,
            approved: false,
            authorizedSize: 0,
            reason,
            allocation,
            performance: {
                phaseId: signal.phaseId,
                sharpeRatio: 0,
                totalPnL: 0,
                tradeCount: 0,
                winRate: 0,
                avgWin: 0,
                avgLoss: 0,
                modifier: 1.0,
            },
            risk: {
                approved: false,
                reason,
                riskMetrics,
            },
            timestamp,
        };
    }
    /**
     * Build approval reason string
     */
    buildApprovalReason(requestedSize, authorizedSize, maxPositionSize, riskDecision) {
        const parts = ["Signal approved"];
        if (authorizedSize < requestedSize) {
            const reductions = [];
            if (authorizedSize <= maxPositionSize && requestedSize > maxPositionSize) {
                reductions.push(`allocation cap (${maxPositionSize.toFixed(2)})`);
            }
            if (riskDecision.adjustedSize && riskDecision.adjustedSize < requestedSize) {
                reductions.push(`risk adjustment`);
            }
            if (reductions.length > 0) {
                parts.push(`with size reduction due to ${reductions.join(", ")}`);
            }
        }
        return parts.join(" ");
    }
    /**
     * Record a decision to database and memory
     */
    async recordDecision(decision, signal) {
        // Add to recent decisions
        this.recentDecisions.push(decision);
        // Keep only last 100 decisions in memory
        if (this.recentDecisions.length > 100) {
            this.recentDecisions.shift();
        }
        // Persist to database
        if (this.db) {
            const record = {
                signalId: signal.signalId,
                phaseId: signal.phaseId,
                timestamp: decision.timestamp,
                approved: decision.approved,
                requestedSize: signal.requestedSize,
                authorizedSize: decision.approved ? decision.authorizedSize : null,
                reason: decision.reason,
                riskMetrics: decision.risk.riskMetrics,
            };
            await this.db.query(`INSERT INTO brain_decisions 
         (signal_id, phase_id, timestamp, approved, requested_size, authorized_size, reason, risk_metrics)
         VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
         ON CONFLICT (signal_id) DO NOTHING`, [
                record.signalId,
                record.phaseId,
                record.timestamp,
                record.approved,
                record.requestedSize,
                record.authorizedSize,
                record.reason,
                record.riskMetrics ? JSON.stringify(record.riskMetrics) : null,
            ]);
        }
    }
    /**
     * Update signal statistics
     */
    updateSignalStats(phaseId, approved) {
        this.signalStats[phaseId].total++;
        if (approved) {
            this.signalStats[phaseId].approved++;
        }
    }
    /**
     * Calculate net position for opposite signals
     * Requirement 7.3: Calculate net position for opposite signals on same asset
     *
     * @param signals - Array of signals for the same asset
     * @returns Net position size and direction
     */
    calculateNetPosition(signals) {
        let netSize = 0;
        for (const signal of signals) {
            if (signal.side === "BUY") {
                netSize += signal.requestedSize;
            }
            else {
                netSize -= signal.requestedSize;
            }
        }
        if (netSize > 0) {
            return { netSize, side: "BUY" };
        }
        else if (netSize < 0) {
            return { netSize: Math.abs(netSize), side: "SELL" };
        }
        else {
            return { netSize: 0, side: "NEUTRAL" };
        }
    }
    /**
     * Get recent decisions
     *
     * @param limit - Maximum number of decisions to return
     * @returns Array of recent decisions
     */
    getRecentDecisions(limit = 20) {
        return this.recentDecisions.slice(-limit);
    }
    /**
     * Export dashboard data to JSON
     * Requirement 10.8: Support exporting dashboard data to JSON
     *
     * @returns JSON string of dashboard data
     */
    async exportDashboardJSON() {
        const data = await this.getDashboardData();
        return JSON.stringify(data, null, 2);
    }
    /**
     * Get performance for all phases
     */
    async getAllPhasePerformance() {
        return this.performanceTracker.getAllPhasePerformance();
    }
    /**
     * Get treasury status
     */
    async getTreasuryStatus() {
        return this.capitalFlowManager.getTreasuryStatus();
    }
    /**
     * Get next sweep trigger level
     */
    getNextSweepTriggerLevel() {
        return this.capitalFlowManager.getNextSweepTriggerLevel();
    }
    /**
     * Get total swept amount
     */
    getTotalSwept() {
        return this.capitalFlowManager.getTotalSwept();
    }
    /**
     * Get high watermark
     */
    getHighWatermark() {
        return this.capitalFlowManager.getHighWatermark();
    }
    /**
     * Update price history for correlation calculations
     *
     * @param symbol - Asset symbol
     * @param price - Current price
     */
    updatePriceHistory(symbol, price) {
        this.riskGuardian.updatePriceHistory(symbol, price);
    }
    /**
     * Get database manager
     */
    getDatabaseManager() {
        return this.db;
    }
}
exports.TitanBrain = TitanBrain;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9lbmdpbmUvVGl0YW5CcmFpbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQWlDSCw2RUFBZ0U7QUFJaEU7OztHQUdHO0FBQ0gsTUFBTSxjQUFjLEdBQTRCO0lBQzlDLE1BQU0sRUFBRSxDQUFDO0lBQ1QsTUFBTSxFQUFFLENBQUM7SUFDVCxNQUFNLEVBQUUsQ0FBQztDQUNWLENBQUM7QUFrQkY7O0dBRUc7QUFDSCxNQUFhLFVBQVU7SUFFSixNQUFNLENBQWM7SUFDcEIsZ0JBQWdCLENBQW1CO0lBQ25DLGtCQUFrQixDQUFxQjtJQUN2QyxZQUFZLENBQWU7SUFDM0Isa0JBQWtCLENBQXFCO0lBQ3ZDLGNBQWMsQ0FBaUI7SUFDL0Isb0JBQW9CLENBQThCO0lBQ2xELHFCQUFxQixDQUErQjtJQUNwRCxFQUFFLENBQXlCO0lBRTVDLDRCQUE0QjtJQUNwQixlQUFlLEdBQWlDLElBQUksQ0FBQztJQUNyRCxhQUFhLEdBQXlCLElBQUksQ0FBQztJQUMzQyxtQkFBbUIsR0FBK0IsSUFBSSxDQUFDO0lBRS9ELDJDQUEyQztJQUNuQyxXQUFXLEdBQW1CLEVBQUUsQ0FBQztJQUV6QyxvQkFBb0I7SUFDWixhQUFhLEdBQVcsQ0FBQyxDQUFDO0lBQzFCLGdCQUFnQixHQUFlLEVBQUUsQ0FBQztJQUNsQyxlQUFlLEdBQW9CLEVBQUUsQ0FBQztJQUN0QyxnQkFBZ0IsR0FBVyxDQUFDLENBQUM7SUFDN0IsWUFBWSxHQUE4QyxFQUFFLENBQUM7SUFFckUsc0JBQXNCO0lBQ2QsY0FBYyxHQUF5QixJQUFJLENBQUM7SUFDNUMsa0JBQWtCLEdBQVcsQ0FBQyxDQUFDO0lBRXZDLDJCQUEyQjtJQUNuQixrQkFBa0IsR0FBMEIsSUFBSSxDQUFDO0lBRXpELHlDQUF5QztJQUNqQyxXQUFXLEdBQXlEO1FBQzFFLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMs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QUFnQixFQUFFLENBQUM7SUFDcEQsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsa0JBQWtCLENBQUMsTUFBYyxFQUFFLEtBQWE7UUFDOUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUNEOztPQUVHO0lBQ0gsa0JBQWtCO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNqQixDQUFDO0NBQ0Y7QUFwdUNELGdDQW91Q0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9lbmdpbmUvVGl0YW5CcmFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRpdGFuQnJhaW4gLSBNYXN0ZXIgT3JjaGVzdHJhdG9yIGZvciBUaXRhbiBUcmFkaW5nIFN5c3RlbVxuICogSW50ZWdyYXRlcyBhbGwgY29tcG9uZW50czogQWxsb2NhdGlvbiwgUGVyZm9ybWFuY2UsIFJpc2ssIENhcGl0YWwsIGFuZCBDaXJjdWl0IEJyZWFrZXJcbiAqXG4gKiBSZXF1aXJlbWVudHM6IDEuMSwgMS43LCA3LjEsIDcuMiwgNy4zLCA3LjQsIDcuNSwgNy42XG4gKi9cblxuaW1wb3J0IHtcbiAgQWxsb2NhdGlvblZlY3RvcixcbiAgQnJhaW5Db25maWcsXG4gIEJyYWluRGVjaXNpb24sXG4gIEJyZWFrZXJTdGF0dXMsXG4gIERhc2hib2FyZERhdGEsXG4gIERlY2lzaW9uUmVjb3JkLFxuICBIZWFsdGhTdGF0dXMsXG4gIEludGVudFNpZ25hbCxcbiAgUGhhc2VJZCxcbiAgUGhhc2VQZXJmb3JtYW5jZSxcbiAgUG9zaXRpb24sXG4gIFF1ZXVlZFNpZ25hbCxcbiAgUmlza0RlY2lzaW9uLFxuICBSaXNrTWV0cmljcyxcbiAgVHJlYXN1cnlTdGF0dXMsXG59IGZyb20gXCIuLi90eXBlcy9pbmRleC5qc1wiO1xuaW1wb3J0IHsgQWxsb2NhdGlvbkVuZ2luZSB9IGZyb20gXCIuL0FsbG9jYXRpb25FbmdpbmUuanNcIjtcbmltcG9ydCB7IFBlcmZvcm1hbmNlVHJhY2tlciB9IGZyb20gXCIuL1BlcmZvcm1hbmNlVHJhY2tlci5qc1wiO1xuaW1wb3J0IHsgSGlnaENvcnJlbGF0aW9uTm90aWZpZXIsIFJpc2tHdWFyZGlhbiB9IGZyb20gXCIuL1Jpc2tHdWFyZGlhbi5qc1wiO1xuaW1wb3J0IHsgQ2FwaXRhbEZsb3dNYW5hZ2VyLCBTd2VlcE5vdGlmaWVyIH0gZnJvbSBcIi4vQ2FwaXRhbEZsb3dNYW5hZ2VyLmpzXCI7XG5pbXBvcnQge1xuICBCcmVha2VyRXZlbnRQZXJzaXN0ZW5jZSxcbiAgQ2lyY3VpdEJyZWFrZXIsXG4gIE5vdGlmaWNhdGlvbkhhbmRsZXIsXG4gIFBvc2l0aW9uQ2xvc3VyZUhhbmRsZXIsXG59IGZyb20gXCIuL0NpcmN1aXRCcmVha2VyLmpzXCI7XG5pbXBvcnQge1xuICBSZWNvdmVyZWRTdGF0ZSxcbiAgU3RhdGVSZWNvdmVyeVNlcnZpY2UsXG59IGZyb20gXCIuL1N0YXRlUmVjb3ZlcnlTZXJ2aWNlLmpzXCI7XG5pbXBvcnQgeyBnZXRNZXRyaWNzIH0gZnJvbSBcIi4uL21vbml0b3JpbmcvUHJvbWV0aGV1c01ldHJpY3MuanNcIjtcbmltcG9ydCB7IE1hbnVhbE92ZXJyaWRlU2VydmljZSB9IGZyb20gXCIuL01hbnVhbE92ZXJyaWRlU2VydmljZS5qc1wiO1xuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyIH0gZnJvbSBcIi4uL2RiL0RhdGFiYXNlTWFuYWdlci5qc1wiO1xuXG4vKipcbiAqIFBoYXNlIHByaW9yaXR5IGZvciBzaWduYWwgcHJvY2Vzc2luZ1xuICogUmVxdWlyZW1lbnQgNy4xOiBQMyA+IFAyID4gUDFcbiAqL1xuY29uc3QgUEhBU0VfUFJJT1JJVFk6IFJlY29yZDxQaGFzZUlkLCBudW1iZXI+ID0ge1xuICBwaGFzZTM6IDMsXG4gIHBoYXNlMjogMixcbiAgcGhhc2UxOiAxLFxufTtcblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIGV4ZWN1dGlvbiBlbmdpbmUgY29tbXVuaWNhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4ZWN1dGlvbkVuZ2luZUNsaWVudCB7XG4gIGZvcndhcmRTaWduYWwoc2lnbmFsOiBJbnRlbnRTaWduYWwsIGF1dGhvcml6ZWRTaXplOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+O1xuICBjbG9zZUFsbFBvc2l0aW9ucygpOiBQcm9taXNlPHZvaWQ+O1xuICBnZXRQb3NpdGlvbnMoKTogUHJvbWlzZTxQb3NpdGlvbltdPjtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIHBoYXNlIG5vdGlmaWNhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBoYXNlTm90aWZpZXIge1xuICBub3RpZnlWZXRvKHBoYXNlSWQ6IFBoYXNlSWQsIHNpZ25hbElkOiBzdHJpbmcsIHJlYXNvbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuLyoqXG4gKiBUaXRhbkJyYWluIG9yY2hlc3RyYXRlcyBhbGwgY29tcG9uZW50cyBhbmQgcHJvY2Vzc2VzIHNpZ25hbHNcbiAqL1xuZXhwb3J0IGNsYXNzIFRpdGFuQnJhaW5cbiAgaW1wbGVtZW50cyBQb3NpdGlvbkNsb3N1cmVIYW5kbGVyLCBCcmVha2VyRXZlbnRQZXJzaXN0ZW5jZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBCcmFpbkNvbmZpZztcbiAgcHJpdmF0ZSByZWFkb25seSBhbGxvY2F0aW9uRW5naW5lOiBBbGxvY2F0aW9uRW5naW5lO1xuICBwcml2YXRlIHJlYWRvbmx5IHBlcmZvcm1hbmNlVHJhY2tlcjogUGVyZm9ybWFuY2VUcmFja2VyO1xuICBwcml2YXRlIHJlYWRvbmx5IHJpc2tHdWFyZGlhbjogUmlza0d1YXJkaWFuO1xuICBwcml2YXRlIHJlYWRvbmx5IGNhcGl0YWxGbG93TWFuYWdlcjogQ2FwaXRhbEZsb3dNYW5hZ2VyO1xuICBwcml2YXRlIHJlYWRvbmx5IGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBzdGF0ZVJlY292ZXJ5U2VydmljZTogU3RhdGVSZWNvdmVyeVNlcnZpY2UgfCBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IG1hbnVhbE92ZXJyaWRlU2VydmljZTogTWFudWFsT3ZlcnJpZGVTZXJ2aWNlIHwgbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBkYjogRGF0YWJhc2VNYW5hZ2VyIHwgbnVsbDtcblxuICAvKiogRXh0ZXJuYWwgaW50ZWdyYXRpb25zICovXG4gIHByaXZhdGUgZXhlY3V0aW9uRW5naW5lOiBFeGVjdXRpb25FbmdpbmVDbGllbnQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwaGFzZU5vdGlmaWVyOiBQaGFzZU5vdGlmaWVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbm90aWZpY2F0aW9uSGFuZGxlcjogTm90aWZpY2F0aW9uSGFuZGxlciB8IG51bGwgPSBudWxsO1xuXG4gIC8qKiBTaWduYWwgcXVldWUgZm9yIHByaW9yaXR5IHByb2Nlc3NpbmcgKi9cbiAgcHJpdmF0ZSBzaWduYWxRdWV1ZTogUXVldWVkU2lnbmFsW10gPSBbXTtcblxuICAvKiogQ3VycmVudCBzdGF0ZSAqL1xuICBwcml2YXRlIGN1cnJlbnRFcXVpdHk6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgY3VycmVudFBvc2l0aW9uczogUG9zaXRpb25bXSA9IFtdO1xuICBwcml2YXRlIHJlY2VudERlY2lzaW9uczogQnJhaW5EZWNpc2lvbltdID0gW107XG4gIHByaXZhdGUgZGFpbHlTdGFydEVxdWl0eTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSByZWNlbnRUcmFkZXM6IEFycmF5PHsgcG5sOiBudW1iZXI7IHRpbWVzdGFtcDogbnVtYmVyIH0+ID0gW107XG5cbiAgLyoqIERhc2hib2FyZCBjYWNoZSAqL1xuICBwcml2YXRlIGRhc2hib2FyZENhY2hlOiBEYXNoYm9hcmREYXRhIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGFzaGJvYXJkQ2FjaGVUaW1lOiBudW1iZXIgPSAwO1xuXG4gIC8qKiBNZXRyaWNzIHVwZGF0ZSB0aW1lciAqL1xuICBwcml2YXRlIG1ldHJpY3NVcGRhdGVUaW1lcjogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcblxuICAvKiogU2lnbmFsIGFwcHJvdmFsIHRyYWNraW5nIHBlciBwaGFzZSAqL1xuICBwcml2YXRlIHNpZ25hbFN0YXRzOiBSZWNvcmQ8UGhhc2VJZCwgeyBhcHByb3ZlZDogbnVtYmVyOyB0b3RhbDogbnVtYmVyIH0+ID0ge1xuICAgIHBoYXNlMTogeyBhcHByb3ZlZDogMCwgdG90YWw6IDAgfSxcbiAgICBwaGFzZTI6IHsgYXBwcm92ZWQ6IDAsIHRvdGFsOiAwIH0sXG4gICAgcGhhc2UzOiB7IGFwcHJvdmVkOiAwLCB0b3RhbDogMCB9LFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGNvbmZpZzogQnJhaW5Db25maWcsXG4gICAgYWxsb2NhdGlvbkVuZ2luZTogQWxsb2NhdGlvbkVuZ2luZSxcbiAgICBwZXJmb3JtYW5jZVRyYWNrZXI6IFBlcmZvcm1hbmNlVHJhY2tlcixcbiAgICByaXNrR3VhcmRpYW46IFJpc2tHdWFyZGlhbixcbiAgICBjYXBpdGFsRmxvd01hbmFnZXI6IENhcGl0YWxGbG93TWFuYWdlcixcbiAgICBjaXJjdWl0QnJlYWtlcjogQ2lyY3VpdEJyZWFrZXIsXG4gICAgZGI/OiBEYXRhYmFzZU1hbmFnZXIsXG4gICAgc3RhdGVSZWNvdmVyeVNlcnZpY2U/OiBTdGF0ZVJlY292ZXJ5U2VydmljZSxcbiAgICBtYW51YWxPdmVycmlkZVNlcnZpY2U/OiBNYW51YWxPdmVycmlkZVNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuYWxsb2NhdGlvbkVuZ2luZSA9IGFsbG9jYXRpb25FbmdpbmU7XG4gICAgdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIgPSBwZXJmb3JtYW5jZVRyYWNrZXI7XG4gICAgdGhpcy5yaXNrR3VhcmRpYW4gPSByaXNrR3VhcmRpYW47XG4gICAgdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIgPSBjYXBpdGFsRmxvd01hbmFnZXI7XG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlciA9IGNpcmN1aXRCcmVha2VyO1xuICAgIHRoaXMuZGIgPSBkYiA/PyBudWxsO1xuICAgIHRoaXMuc3RhdGVSZWNvdmVyeVNlcnZpY2UgPSBzdGF0ZVJlY292ZXJ5U2VydmljZSA/PyBudWxsO1xuICAgIHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlID0gbWFudWFsT3ZlcnJpZGVTZXJ2aWNlID8/IG51bGw7XG5cbiAgICAvLyBXaXJlIHVwIGNpcmN1aXQgYnJlYWtlciBoYW5kbGVyc1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuc2V0UG9zaXRpb25IYW5kbGVyKHRoaXMpO1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuc2V0RXZlbnRQZXJzaXN0ZW5jZSh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBicmFpbiBhbmQgc3RhcnQgbWV0cmljIHVwZGF0ZXNcbiAgICogUmVxdWlyZW1lbnQgOS40LCA5LjU6IExvYWQgc3RhdGUgYW5kIHJlY2FsY3VsYXRlIG1ldHJpY3Mgb24gc3RhcnR1cFxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhcIvCfp6AgSW5pdGlhbGl6aW5nIFRpdGFuIEJyYWluLi4uXCIpO1xuXG4gICAgLy8gUmVjb3ZlciBzeXN0ZW0gc3RhdGUgb24gc3RhcnR1cFxuICAgIGlmICh0aGlzLnN0YXRlUmVjb3ZlcnlTZXJ2aWNlKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIvCfk4ogUmVjb3ZlcmluZyBzeXN0ZW0gc3RhdGUuLi5cIik7XG4gICAgICBjb25zdCByZWNvdmVyZWRTdGF0ZSA9IGF3YWl0IHRoaXMuc3RhdGVSZWNvdmVyeVNlcnZpY2UucmVjb3ZlclN0YXRlKCk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlY292ZXJlZCBzdGF0ZVxuICAgICAgaWYgKCF0aGlzLnN0YXRlUmVjb3ZlcnlTZXJ2aWNlLnZhbGlkYXRlUmVjb3ZlcmVkU3RhdGUocmVjb3ZlcmVkU3RhdGUpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBSZWNvdmVyZWQgc3RhdGUgdmFsaWRhdGlvbiBmYWlsZWQsIHVzaW5nIGRlZmF1bHRzXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgU3RhdGUgcmVjb3ZlcnkgY29tcGxldGVkIHN1Y2Nlc3NmdWxseVwiKTtcblxuICAgICAgICAvLyBBcHBseSByZWNvdmVyZWQgYWxsb2NhdGlvbiBpZiBhdmFpbGFibGVcbiAgICAgICAgaWYgKHJlY292ZXJlZFN0YXRlLmFsbG9jYXRpb24pIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDwn5OIIFJlc3RvcmVkIGFsbG9jYXRpb246IHcxPSR7cmVjb3ZlcmVkU3RhdGUuYWxsb2NhdGlvbi53MX0sIHcyPSR7cmVjb3ZlcmVkU3RhdGUuYWxsb2NhdGlvbi53Mn0sIHczPSR7cmVjb3ZlcmVkU3RhdGUuYWxsb2NhdGlvbi53M31gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBcHBseSByZWNvdmVyZWQgaGlnaCB3YXRlcm1hcmtcbiAgICAgICAgaWYgKHJlY292ZXJlZFN0YXRlLmhpZ2hXYXRlcm1hcmsgPiAwKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuc2V0SGlnaFdhdGVybWFyayhcbiAgICAgICAgICAgIHJlY292ZXJlZFN0YXRlLmhpZ2hXYXRlcm1hcmssXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDwn5KwIFJlc3RvcmVkIGhpZ2ggd2F0ZXJtYXJrOiAkJHtyZWNvdmVyZWRTdGF0ZS5oaWdoV2F0ZXJtYXJrfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGx5IHJlY292ZXJlZCBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAgICAgIGZvciAoXG4gICAgICAgICAgY29uc3QgW3BoYXNlSWQsIHBlcmZvcm1hbmNlXSBvZiBPYmplY3QuZW50cmllcyhcbiAgICAgICAgICAgIHJlY292ZXJlZFN0YXRlLnBlcmZvcm1hbmNlLFxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg8J+TiiBSZXN0b3JlZCBwZXJmb3JtYW5jZSBmb3IgJHtwaGFzZUlkfTogU2hhcnBlPSR7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnNoYXJwZVJhdGlvLnRvRml4ZWQoMilcbiAgICAgICAgICAgIH0sIE1vZGlmaWVyPSR7cGVyZm9ybWFuY2UubW9kaWZpZXIudG9GaXhlZCgyKX1gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVjYWxjdWxhdGUgcmlzayBtZXRyaWNzIHdpdGggY3VycmVudCBwb3NpdGlvbnNcbiAgICAgIC8vIFJlcXVpcmVtZW50IDkuNTogUmVjYWxjdWxhdGUgYWxsIHJpc2sgbWV0cmljcyBiZWZvcmUgYWNjZXB0aW5nIG5ldyBzaWduYWxzXG4gICAgICBpZiAodGhpcy5jdXJyZW50UG9zaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLwn5SNIFJlY2FsY3VsYXRpbmcgcmlzayBtZXRyaWNzIHdpdGggY3VycmVudCBwb3NpdGlvbnMuLi5cIik7XG4gICAgICAgIGNvbnN0IHJpc2tNZXRyaWNzID0gdGhpcy5zdGF0ZVJlY292ZXJ5U2VydmljZS5yZWNhbGN1bGF0ZVJpc2tNZXRyaWNzKFxuICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9ucyxcbiAgICAgICAgICB0aGlzLmN1cnJlbnRFcXVpdHksXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFJpc2sgbWV0cmljcyByZWNhbGN1bGF0ZWRcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSBtYW51YWwgb3ZlcnJpZGUgc2VydmljZVxuICAgIGlmICh0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkge1xuICAgICAgYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgICAgY29uc29sZS5sb2coXCLwn5SnIE1hbnVhbCBvdmVycmlkZSBzZXJ2aWNlIGluaXRpYWxpemVkXCIpO1xuICAgIH1cblxuICAgIC8vIEluaXRpYWxpemUgY2FwaXRhbCBmbG93IG1hbmFnZXJcbiAgICBhd2FpdCB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5pbml0aWFsaXplKCk7XG5cbiAgICAvLyBMb2FkIGRhaWx5IHN0YXJ0IGVxdWl0eVxuICAgIHRoaXMuZGFpbHlTdGFydEVxdWl0eSA9IHRoaXMuY3VycmVudEVxdWl0eTtcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLnNldERhaWx5U3RhcnRFcXVpdHkodGhpcy5kYWlseVN0YXJ0RXF1aXR5KTtcblxuICAgIC8vIFN0YXJ0IHBlcmlvZGljIG1ldHJpYyB1cGRhdGVzXG4gICAgdGhpcy5zdGFydE1ldHJpY1VwZGF0ZXMoKTtcblxuICAgIGNvbnNvbGUubG9nKFwi8J+noCBUaXRhbiBCcmFpbiBpbml0aWFsaXphdGlvbiBjb21wbGV0ZWRcIik7XG4gIH1cblxuICAvKipcbiAgICogU2h1dGRvd24gdGhlIGJyYWluIGdyYWNlZnVsbHlcbiAgICovXG4gIGFzeW5jIHNodXRkb3duKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLm1ldHJpY3NVcGRhdGVUaW1lcikge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1ldHJpY3NVcGRhdGVUaW1lcik7XG4gICAgICB0aGlzLm1ldHJpY3NVcGRhdGVUaW1lciA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZXhlY3V0aW9uIGVuZ2luZSBjbGllbnRcbiAgICovXG4gIHNldEV4ZWN1dGlvbkVuZ2luZShjbGllbnQ6IEV4ZWN1dGlvbkVuZ2luZUNsaWVudCk6IHZvaWQge1xuICAgIHRoaXMuZXhlY3V0aW9uRW5naW5lID0gY2xpZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgcGhhc2Ugbm90aWZpZXJcbiAgICovXG4gIHNldFBoYXNlTm90aWZpZXIobm90aWZpZXI6IFBoYXNlTm90aWZpZXIpOiB2b2lkIHtcbiAgICB0aGlzLnBoYXNlTm90aWZpZXIgPSBub3RpZmllcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIG5vdGlmaWNhdGlvbiBoYW5kbGVyXG4gICAqL1xuICBzZXROb3RpZmljYXRpb25IYW5kbGVyKGhhbmRsZXI6IE5vdGlmaWNhdGlvbkhhbmRsZXIpOiB2b2lkIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbkhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuc2V0Tm90aWZpY2F0aW9uSGFuZGxlcihoYW5kbGVyKTtcblxuICAgIC8vIFNldCBjb3JyZWxhdGlvbiBub3RpZmllciBpZiBoYW5kbGVyIHN1cHBvcnRzIGl0XG4gICAgaWYgKFwic2VuZEhpZ2hDb3JyZWxhdGlvbldhcm5pbmdcIiBpbiBoYW5kbGVyKSB7XG4gICAgICB0aGlzLnJpc2tHdWFyZGlhbi5zZXRDb3JyZWxhdGlvbk5vdGlmaWVyKGhhbmRsZXIgYXMgYW55KTtcbiAgICB9XG5cbiAgICAvLyBTZXQgc3dlZXAgbm90aWZpZXIgaWYgaGFuZGxlciBzdXBwb3J0cyBpdFxuICAgIGlmIChcInNlbmRTd2VlcE5vdGlmaWNhdGlvblwiIGluIGhhbmRsZXIpIHtcbiAgICAgIHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLnNldFN3ZWVwTm90aWZpZXIoaGFuZGxlciBhcyBhbnkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY3VycmVudCBlcXVpdHlcbiAgICovXG4gIHNldEVxdWl0eShlcXVpdHk6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuY3VycmVudEVxdWl0eSA9IE1hdGgubWF4KDAsIGVxdWl0eSk7XG4gICAgdGhpcy5yaXNrR3VhcmRpYW4uc2V0RXF1aXR5KHRoaXMuY3VycmVudEVxdWl0eSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGN1cnJlbnQgcG9zaXRpb25zXG4gICAqL1xuICBzZXRQb3NpdGlvbnMocG9zaXRpb25zOiBQb3NpdGlvbltdKTogdm9pZCB7XG4gICAgdGhpcy5jdXJyZW50UG9zaXRpb25zID0gcG9zaXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBkYWlseSBzdGFydCBlcXVpdHkgKGNhbGxlZCBhdCBzdGFydCBvZiB0cmFkaW5nIGRheSlcbiAgICovXG4gIHNldERhaWx5U3RhcnRFcXVpdHkoZXF1aXR5OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmRhaWx5U3RhcnRFcXVpdHkgPSBNYXRoLm1heCgwLCBlcXVpdHkpO1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuc2V0RGFpbHlTdGFydEVxdWl0eSh0aGlzLmRhaWx5U3RhcnRFcXVpdHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYW4gaW50ZW50IHNpZ25hbCB0aHJvdWdoIHRoZSBmdWxsIHBpcGVsaW5lXG4gICAqIFJlcXVpcmVtZW50IDcuNTogTWF4aW11bSBsYXRlbmN5IG9mIDEwMG1zXG4gICAqXG4gICAqIFBpcGVsaW5lOlxuICAgKiAxLiBDaGVjayBjaXJjdWl0IGJyZWFrZXJcbiAgICogMi4gR2V0IGFsbG9jYXRpb24gd2VpZ2h0c1xuICAgKiAzLiBBcHBseSBwZXJmb3JtYW5jZSBtb2RpZmllcnNcbiAgICogNC4gQ2hlY2sgcmlzayBjb25zdHJhaW50c1xuICAgKiA1LiBDYWxjdWxhdGUgYXV0aG9yaXplZCBzaXplXG4gICAqIDYuIEZvcndhcmQgdG8gZXhlY3V0aW9uIG9yIHZldG9cbiAgICpcbiAgICogQHBhcmFtIHNpZ25hbCAtIEludGVudCBzaWduYWwgZnJvbSBhIHBoYXNlXG4gICAqIEByZXR1cm5zIEJyYWluRGVjaXNpb24gd2l0aCBhcHByb3ZhbCBzdGF0dXNcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NTaWduYWwoc2lnbmFsOiBJbnRlbnRTaWduYWwpOiBQcm9taXNlPEJyYWluRGVjaXNpb24+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IHN0YXJ0VGltZTtcblxuICAgIC8vIENoZWNrIGNpcmN1aXQgYnJlYWtlciBmaXJzdFxuICAgIGlmICh0aGlzLmNpcmN1aXRCcmVha2VyLmlzQWN0aXZlKCkpIHtcbiAgICAgIGNvbnN0IGRlY2lzaW9uID0gdGhpcy5jcmVhdGVWZXRvRGVjaXNpb24oXG4gICAgICAgIHNpZ25hbCxcbiAgICAgICAgXCJDaXJjdWl0IGJyZWFrZXIgYWN0aXZlOiBhbGwgc2lnbmFscyByZWplY3RlZFwiLFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy5yZWNvcmREZWNpc2lvbihkZWNpc2lvbiwgc2lnbmFsKTtcbiAgICAgIHJldHVybiBkZWNpc2lvbjtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBicmVha2VyIGNvbmRpdGlvbnMgd2l0aCBjdXJyZW50IHN0YXRlXG4gICAgY29uc3QgYnJlYWtlclN0YXR1cyA9IHRoaXMuY2lyY3VpdEJyZWFrZXIuY2hlY2tDb25kaXRpb25zKHtcbiAgICAgIGVxdWl0eTogdGhpcy5jdXJyZW50RXF1aXR5LFxuICAgICAgcG9zaXRpb25zOiB0aGlzLmN1cnJlbnRQb3NpdGlvbnMsXG4gICAgICBkYWlseVN0YXJ0RXF1aXR5OiB0aGlzLmRhaWx5U3RhcnRFcXVpdHksXG4gICAgICByZWNlbnRUcmFkZXM6IHRoaXMucmVjZW50VHJhZGVzLFxuICAgIH0pO1xuXG4gICAgaWYgKGJyZWFrZXJTdGF0dXMuYWN0aXZlKSB7XG4gICAgICBjb25zdCBkZWNpc2lvbiA9IHRoaXMuY3JlYXRlVmV0b0RlY2lzaW9uKFxuICAgICAgICBzaWduYWwsXG4gICAgICAgIGBDaXJjdWl0IGJyZWFrZXIgdHJpZ2dlcmVkOiAke2JyZWFrZXJTdGF0dXMucmVhc29ufWAsXG4gICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICk7XG4gICAgICBhd2FpdCB0aGlzLnJlY29yZERlY2lzaW9uKGRlY2lzaW9uLCBzaWduYWwpO1xuICAgICAgcmV0dXJuIGRlY2lzaW9uO1xuICAgIH1cblxuICAgIC8vIEdldCBhbGxvY2F0aW9uIHdlaWdodHMgKHdpdGggbWFudWFsIG92ZXJyaWRlIGlmIGFjdGl2ZSlcbiAgICBjb25zdCBhbGxvY2F0aW9uID0gdGhpcy5nZXRBbGxvY2F0aW9uKCk7XG5cbiAgICAvLyBHZXQgcGVyZm9ybWFuY2UgbW9kaWZpZXIgZm9yIHRoZSBwaGFzZVxuICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gYXdhaXQgdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIuZ2V0UGhhc2VQZXJmb3JtYW5jZShcbiAgICAgIHNpZ25hbC5waGFzZUlkLFxuICAgICk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYmFzZSBhbGxvY2F0aW9uIGZvciB0aGlzIHBoYXNlXG4gICAgY29uc3QgcGhhc2VXZWlnaHQgPSB0aGlzLmdldFBoYXNlV2VpZ2h0KHNpZ25hbC5waGFzZUlkLCBhbGxvY2F0aW9uKTtcbiAgICBjb25zdCBhZGp1c3RlZFdlaWdodCA9IHBoYXNlV2VpZ2h0ICogcGVyZm9ybWFuY2UubW9kaWZpZXI7XG5cbiAgICAvLyBDYWxjdWxhdGUgbWF4IHBvc2l0aW9uIHNpemUgYmFzZWQgb24gYWxsb2NhdGlvblxuICAgIC8vIFJlcXVpcmVtZW50IDEuNzogQ2FwIHBvc2l0aW9uIHNpemUgYXQgRXF1aXR5ICogUGhhc2VfV2VpZ2h0XG4gICAgY29uc3QgbWF4UG9zaXRpb25TaXplID0gdGhpcy5jdXJyZW50RXF1aXR5ICogYWRqdXN0ZWRXZWlnaHQ7XG5cbiAgICAvLyBDaGVjayByaXNrIGNvbnN0cmFpbnRzXG4gICAgY29uc3Qgcmlza0RlY2lzaW9uID0gdGhpcy5yaXNrR3VhcmRpYW4uY2hlY2tTaWduYWwoXG4gICAgICBzaWduYWwsXG4gICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbnMsXG4gICAgKTtcblxuICAgIC8vIERldGVybWluZSBmaW5hbCBhdXRob3JpemVkIHNpemVcbiAgICBsZXQgYXV0aG9yaXplZFNpemU6IG51bWJlcjtcbiAgICBsZXQgYXBwcm92ZWQ6IGJvb2xlYW47XG4gICAgbGV0IHJlYXNvbjogc3RyaW5nO1xuXG4gICAgaWYgKCFyaXNrRGVjaXNpb24uYXBwcm92ZWQpIHtcbiAgICAgIC8vIFJpc2sgdmV0b1xuICAgICAgYXBwcm92ZWQgPSBmYWxzZTtcbiAgICAgIGF1dGhvcml6ZWRTaXplID0gMDtcbiAgICAgIHJlYXNvbiA9IHJpc2tEZWNpc2lvbi5yZWFzb247XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFwcGx5IGFsbCBjb25zdHJhaW50c1xuICAgICAgY29uc3Qgcmlza0FkanVzdGVkU2l6ZSA9IHJpc2tEZWNpc2lvbi5hZGp1c3RlZFNpemUgPz9cbiAgICAgICAgc2lnbmFsLnJlcXVlc3RlZFNpemU7XG4gICAgICBhdXRob3JpemVkU2l6ZSA9IE1hdGgubWluKFxuICAgICAgICBzaWduYWwucmVxdWVzdGVkU2l6ZSxcbiAgICAgICAgbWF4UG9zaXRpb25TaXplLFxuICAgICAgICByaXNrQWRqdXN0ZWRTaXplLFxuICAgICAgKTtcblxuICAgICAgLy8gUmVxdWlyZW1lbnQgMS43OiBQb3NpdGlvbiBzaXplIGNvbnNpc3RlbmN5XG4gICAgICBpZiAoYXV0aG9yaXplZFNpemUgPD0gMCkge1xuICAgICAgICBhcHByb3ZlZCA9IGZhbHNlO1xuICAgICAgICBhdXRob3JpemVkU2l6ZSA9IDA7XG4gICAgICAgIHJlYXNvbiA9IFwiQXV0aG9yaXplZCBzaXplIGlzIHplcm8gYWZ0ZXIgYXBwbHlpbmcgY29uc3RyYWludHNcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwcHJvdmVkID0gdHJ1ZTtcbiAgICAgICAgcmVhc29uID0gdGhpcy5idWlsZEFwcHJvdmFsUmVhc29uKFxuICAgICAgICAgIHNpZ25hbC5yZXF1ZXN0ZWRTaXplLFxuICAgICAgICAgIGF1dGhvcml6ZWRTaXplLFxuICAgICAgICAgIG1heFBvc2l0aW9uU2l6ZSxcbiAgICAgICAgICByaXNrRGVjaXNpb24sXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGVjaXNpb246IEJyYWluRGVjaXNpb24gPSB7XG4gICAgICBzaWduYWxJZDogc2lnbmFsLnNpZ25hbElkLFxuICAgICAgYXBwcm92ZWQsXG4gICAgICBhdXRob3JpemVkU2l6ZSxcbiAgICAgIHJlYXNvbixcbiAgICAgIGFsbG9jYXRpb24sXG4gICAgICBwZXJmb3JtYW5jZSxcbiAgICAgIHJpc2s6IHJpc2tEZWNpc2lvbixcbiAgICAgIHRpbWVzdGFtcCxcbiAgICB9O1xuXG4gICAgLy8gUmVjb3JkIGRlY2lzaW9uXG4gICAgYXdhaXQgdGhpcy5yZWNvcmREZWNpc2lvbihkZWNpc2lvbiwgc2lnbmFsKTtcblxuICAgIC8vIFVwZGF0ZSBzaWduYWwgc3RhdHNcbiAgICB0aGlzLnVwZGF0ZVNpZ25hbFN0YXRzKHNpZ25hbC5waGFzZUlkLCBhcHByb3ZlZCk7XG5cbiAgICAvLyBGb3J3YXJkIHRvIGV4ZWN1dGlvbiBvciBub3RpZnkgdmV0b1xuICAgIGlmIChhcHByb3ZlZCAmJiB0aGlzLmV4ZWN1dGlvbkVuZ2luZSkge1xuICAgICAgYXdhaXQgdGhpcy5leGVjdXRpb25FbmdpbmUuZm9yd2FyZFNpZ25hbChzaWduYWwsIGF1dGhvcml6ZWRTaXplKTtcbiAgICB9IGVsc2UgaWYgKCFhcHByb3ZlZCkge1xuICAgICAgLy8gUmVxdWlyZW1lbnQgNy42OiBOb3RpZnkgb3JpZ2luYXRpbmcgcGhhc2Ugb2YgdmV0b1xuICAgICAgaWYgKHRoaXMucGhhc2VOb3RpZmllcikge1xuICAgICAgICBhd2FpdCB0aGlzLnBoYXNlTm90aWZpZXIubm90aWZ5VmV0byhcbiAgICAgICAgICBzaWduYWwucGhhc2VJZCxcbiAgICAgICAgICBzaWduYWwuc2lnbmFsSWQsXG4gICAgICAgICAgcmVhc29uLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBTZW5kIHZldG8gbm90aWZpY2F0aW9uIHZpYSBub3RpZmljYXRpb24gc2VydmljZVxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbkhhbmRsZXIgJiZcbiAgICAgICAgXCJzZW5kVmV0b05vdGlmaWNhdGlvblwiIGluIHRoaXMubm90aWZpY2F0aW9uSGFuZGxlclxuICAgICAgKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgKHRoaXMubm90aWZpY2F0aW9uSGFuZGxlciBhcyBhbnkpLnNlbmRWZXRvTm90aWZpY2F0aW9uKFxuICAgICAgICAgICAgc2lnbmFsLnBoYXNlSWQsXG4gICAgICAgICAgICBzaWduYWwuc2lnbmFsSWQsXG4gICAgICAgICAgICBzaWduYWwuc3ltYm9sLFxuICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgc2lnbmFsLnJlcXVlc3RlZFNpemUsXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNlbmQgdmV0byBub3RpZmljYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENoZWNrIHByb2Nlc3NpbmcgbGF0ZW5jeSBhbmQgcmVjb3JkIG1ldHJpY3NcbiAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgaWYgKHByb2Nlc3NpbmdUaW1lID4gdGhpcy5jb25maWcuc2lnbmFsVGltZW91dCkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgU2lnbmFsIHByb2Nlc3NpbmcgZXhjZWVkZWQgdGltZW91dDogJHtwcm9jZXNzaW5nVGltZX1tcyA+ICR7dGhpcy5jb25maWcuc2lnbmFsVGltZW91dH1tc2AsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFJlY29yZCBtZXRyaWNzXG4gICAgY29uc3QgbWV0cmljcyA9IGdldE1ldHJpY3MoKTtcbiAgICBtZXRyaWNzLnJlY29yZFNpZ25hbExhdGVuY3koc2lnbmFsLnBoYXNlSWQsIHByb2Nlc3NpbmdUaW1lLCBhcHByb3ZlZCk7XG5cbiAgICByZXR1cm4gZGVjaXNpb247XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBtdWx0aXBsZSBzaWduYWxzIHdpdGggcHJpb3JpdHkgb3JkZXJpbmdcbiAgICogUmVxdWlyZW1lbnQgNy4xOiBQcm9jZXNzIGluIHByaW9yaXR5IG9yZGVyIChQMyA+IFAyID4gUDEpXG4gICAqXG4gICAqIEBwYXJhbSBzaWduYWxzIC0gQXJyYXkgb2YgaW50ZW50IHNpZ25hbHNcbiAgICogQHJldHVybnMgQXJyYXkgb2YgYnJhaW4gZGVjaXNpb25zXG4gICAqL1xuICBhc3luYyBwcm9jZXNzU2lnbmFscyhzaWduYWxzOiBJbnRlbnRTaWduYWxbXSk6IFByb21pc2U8QnJhaW5EZWNpc2lvbltdPiB7XG4gICAgLy8gU29ydCBieSBwcmlvcml0eSAoaGlnaGVzdCBmaXJzdClcbiAgICBjb25zdCBzb3J0ZWRTaWduYWxzID0gWy4uLnNpZ25hbHNdLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBQSEFTRV9QUklPUklUWVtiLnBoYXNlSWRdIC0gUEhBU0VfUFJJT1JJVFlbYS5waGFzZUlkXTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGRlY2lzaW9uczogQnJhaW5EZWNpc2lvbltdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNpZ25hbCBvZiBzb3J0ZWRTaWduYWxzKSB7XG4gICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IHRoaXMucHJvY2Vzc1NpZ25hbChzaWduYWwpO1xuICAgICAgZGVjaXNpb25zLnB1c2goZGVjaXNpb24pO1xuXG4gICAgICAvLyBVcGRhdGUgcG9zaXRpb25zIGFmdGVyIGVhY2ggYXBwcm92ZWQgc2lnbmFsXG4gICAgICBpZiAoZGVjaXNpb24uYXBwcm92ZWQgJiYgdGhpcy5leGVjdXRpb25FbmdpbmUpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb25zID0gYXdhaXQgdGhpcy5leGVjdXRpb25FbmdpbmUuZ2V0UG9zaXRpb25zKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlY2lzaW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnF1ZXVlIGEgc2lnbmFsIGZvciBwcm9jZXNzaW5nXG4gICAqIFJlcXVpcmVtZW50IDcuNDogTWFpbnRhaW4gc2lnbmFsIHF1ZXVlIHdpdGggdGltZXN0YW1wcyBhbmQgcGhhc2Ugc291cmNlXG4gICAqXG4gICAqIEBwYXJhbSBzaWduYWwgLSBJbnRlbnQgc2lnbmFsIHRvIGVucXVldWVcbiAgICovXG4gIGVucXVldWVTaWduYWwoc2lnbmFsOiBJbnRlbnRTaWduYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaWduYWxRdWV1ZS5sZW5ndGggPj0gdGhpcy5jb25maWcubWF4UXVldWVTaXplKSB7XG4gICAgICAvLyBSZW1vdmUgb2xkZXN0IHNpZ25hbFxuICAgICAgdGhpcy5zaWduYWxRdWV1ZS5zaGlmdCgpO1xuICAgIH1cblxuICAgIHRoaXMuc2lnbmFsUXVldWUucHVzaCh7XG4gICAgICBzaWduYWwsXG4gICAgICBwcmlvcml0eTogUEhBU0VfUFJJT1JJVFlbc2lnbmFsLnBoYXNlSWRdLFxuICAgICAgZW5xdWV1ZWRBdDogRGF0ZS5ub3coKSxcbiAgICB9KTtcblxuICAgIC8vIFNvcnQgcXVldWUgYnkgcHJpb3JpdHlcbiAgICB0aGlzLnNpZ25hbFF1ZXVlLnNvcnQoKGEsIGIpID0+IGIucHJpb3JpdHkgLSBhLnByaW9yaXR5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGFsbCBxdWV1ZWQgc2lnbmFsc1xuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc1F1ZXVlKCk6IFByb21pc2U8QnJhaW5EZWNpc2lvbltdPiB7XG4gICAgY29uc3Qgc2lnbmFscyA9IHRoaXMuc2lnbmFsUXVldWUubWFwKChxKSA9PiBxLnNpZ25hbCk7XG4gICAgdGhpcy5zaWduYWxRdWV1ZSA9IFtdO1xuICAgIHJldHVybiB0aGlzLnByb2Nlc3NTaWduYWxzKHNpZ25hbHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbGwgbWV0cmljcyBwZXJpb2RpY2FsbHlcbiAgICogUmVxdWlyZW1lbnQgMS4xOiBSZWNhbGN1bGF0ZSBhbGxvY2F0aW9uIGV2ZXJ5IDEgbWludXRlIG9yIG9uIHRyYWRlIGNsb3NlXG4gICAqL1xuICBhc3luYyB1cGRhdGVNZXRyaWNzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFVwZGF0ZSBhbGxvY2F0aW9uXG4gICAgY29uc3QgYWxsb2NhdGlvbiA9IHRoaXMuYWxsb2NhdGlvbkVuZ2luZS5nZXRXZWlnaHRzKHRoaXMuY3VycmVudEVxdWl0eSk7XG5cbiAgICAvLyBVcGRhdGUgY2FwaXRhbCBmbG93IHRhcmdldCBhbGxvY2F0aW9uXG4gICAgY29uc3QgZnV0dXJlc0FsbG9jYXRpb24gPSB0aGlzLmN1cnJlbnRFcXVpdHkgKlxuICAgICAgKGFsbG9jYXRpb24udzEgKyBhbGxvY2F0aW9uLncyKTtcbiAgICB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKGZ1dHVyZXNBbGxvY2F0aW9uKTtcblxuICAgIC8vIFVwZGF0ZSBoaWdoIHdhdGVybWFya1xuICAgIGF3YWl0IHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLnVwZGF0ZUhpZ2hXYXRlcm1hcmsodGhpcy5jdXJyZW50RXF1aXR5KTtcblxuICAgIC8vIENoZWNrIHN3ZWVwIGNvbmRpdGlvbnNcbiAgICBhd2FpdCB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5wZXJmb3JtU3dlZXBJZk5lZWRlZCgpO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBkYXNoYm9hcmQgY2FjaGVcbiAgICB0aGlzLmRhc2hib2FyZENhY2hlID0gbnVsbDtcblxuICAgIC8vIFVwZGF0ZSBQcm9tZXRoZXVzIG1ldHJpY3NcbiAgICBjb25zdCBtZXRyaWNzID0gZ2V0TWV0cmljcygpO1xuICAgIG1ldHJpY3MudXBkYXRlRXF1aXR5KHRoaXMuY3VycmVudEVxdWl0eSk7XG4gICAgbWV0cmljcy51cGRhdGVBbGxvY2F0aW9uKGFsbG9jYXRpb24udzEsIGFsbG9jYXRpb24udzIsIGFsbG9jYXRpb24udzMpO1xuICAgIG1ldHJpY3MudXBkYXRlQ2lyY3VpdEJyZWFrZXJTdGF0dXModGhpcy5jaXJjdWl0QnJlYWtlci5pc0FjdGl2ZSgpKTtcbiAgICBtZXRyaWNzLnVwZGF0ZUhpZ2hXYXRlcm1hcmsodGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKTtcblxuICAgIC8vIFVwZGF0ZSBkYWlseSBkcmF3ZG93blxuICAgIGNvbnN0IGRhaWx5RHJhd2Rvd24gPSB0aGlzLmRhaWx5U3RhcnRFcXVpdHkgPiAwXG4gICAgICA/ICgodGhpcy5kYWlseVN0YXJ0RXF1aXR5IC0gdGhpcy5jdXJyZW50RXF1aXR5KSAvIHRoaXMuZGFpbHlTdGFydEVxdWl0eSkgKlxuICAgICAgICAxMDBcbiAgICAgIDogMDtcbiAgICBtZXRyaWNzLnVwZGF0ZURhaWx5RHJhd2Rvd24oTWF0aC5tYXgoMCwgZGFpbHlEcmF3ZG93bikpO1xuXG4gICAgLy8gVXBkYXRlIHBoYXNlIHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAgICBmb3IgKGNvbnN0IHBoYXNlSWQgb2YgW1wicGhhc2UxXCIsIFwicGhhc2UyXCIsIFwicGhhc2UzXCJdIGFzIFBoYXNlSWRbXSkge1xuICAgICAgY29uc3QgcGVyZm9ybWFuY2UgPSBhd2FpdCB0aGlzLnBlcmZvcm1hbmNlVHJhY2tlci5nZXRQaGFzZVBlcmZvcm1hbmNlKFxuICAgICAgICBwaGFzZUlkLFxuICAgICAgKTtcbiAgICAgIG1ldHJpY3MudXBkYXRlUGhhc2VQZXJmb3JtYW5jZShcbiAgICAgICAgcGhhc2VJZCxcbiAgICAgICAgcGVyZm9ybWFuY2Uuc2hhcnBlUmF0aW8sXG4gICAgICAgIHBlcmZvcm1hbmNlLm1vZGlmaWVyLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIGEgdHJhZGUgcmVzdWx0XG4gICAqIFVwZGF0ZXMgcGVyZm9ybWFuY2UgdHJhY2tpbmcgYW5kIGNpcmN1aXQgYnJlYWtlciBzdGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gcGhhc2VJZCAtIFBoYXNlIHRoYXQgZXhlY3V0ZWQgdGhlIHRyYWRlXG4gICAqIEBwYXJhbSBwbmwgLSBUcmFkZSBQbkxcbiAgICogQHBhcmFtIHN5bWJvbCAtIFRyYWRpbmcgc3ltYm9sXG4gICAqIEBwYXJhbSBzaWRlIC0gVHJhZGUgc2lkZVxuICAgKi9cbiAgYXN5bmMgcmVjb3JkVHJhZGUoXG4gICAgcGhhc2VJZDogUGhhc2VJZCxcbiAgICBwbmw6IG51bWJlcixcbiAgICBzeW1ib2w/OiBzdHJpbmcsXG4gICAgc2lkZT86IFwiQlVZXCIgfCBcIlNFTExcIixcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgIC8vIFJlY29yZCBpbiBwZXJmb3JtYW5jZSB0cmFja2VyXG4gICAgYXdhaXQgdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIucmVjb3JkVHJhZGUoXG4gICAgICBwaGFzZUlkLFxuICAgICAgcG5sLFxuICAgICAgdGltZXN0YW1wLFxuICAgICAgc3ltYm9sLFxuICAgICAgc2lkZSxcbiAgICApO1xuXG4gICAgLy8gUmVjb3JkIGZvciBjaXJjdWl0IGJyZWFrZXJcbiAgICB0aGlzLnJlY2VudFRyYWRlcy5wdXNoKHsgcG5sLCB0aW1lc3RhbXAgfSk7XG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlci5yZWNvcmRUcmFkZShwbmwsIHRpbWVzdGFtcCk7XG5cbiAgICAvLyBDbGVhbiB1cCBvbGQgdHJhZGVzIChrZWVwIGxhc3QgaG91cilcbiAgICBjb25zdCBvbmVIb3VyQWdvID0gdGltZXN0YW1wIC0gMzYwMDAwMDtcbiAgICB0aGlzLnJlY2VudFRyYWRlcyA9IHRoaXMucmVjZW50VHJhZGVzLmZpbHRlcigodCkgPT5cbiAgICAgIHQudGltZXN0YW1wID49IG9uZUhvdXJBZ29cbiAgICApO1xuXG4gICAgLy8gVXBkYXRlIG1ldHJpY3MgYWZ0ZXIgdHJhZGVcbiAgICBhd2FpdCB0aGlzLnVwZGF0ZU1ldHJpY3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZGFzaGJvYXJkIGRhdGEgZm9yIFVJXG4gICAqIFJlcXVpcmVtZW50IDEwLjEtMTAuNzogRGFzaGJvYXJkIHZpc2liaWxpdHlcbiAgICpcbiAgICogQHJldHVybnMgRGFzaGJvYXJkRGF0YSB3aXRoIGFsbCBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXREYXNoYm9hcmREYXRhKCk6IFByb21pc2U8RGFzaGJvYXJkRGF0YT4ge1xuICAgIC8vIENoZWNrIGNhY2hlXG4gICAgaWYgKFxuICAgICAgdGhpcy5kYXNoYm9hcmRDYWNoZSAmJlxuICAgICAgRGF0ZS5ub3coKSAtIHRoaXMuZGFzaGJvYXJkQ2FjaGVUaW1lIDwgdGhpcy5jb25maWcuZGFzaGJvYXJkQ2FjaGVUVExcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLmRhc2hib2FyZENhY2hlO1xuICAgIH1cblxuICAgIC8vIEdldCBhbGxvY2F0aW9uXG4gICAgY29uc3QgYWxsb2NhdGlvbiA9IHRoaXMuYWxsb2NhdGlvbkVuZ2luZS5nZXRXZWlnaHRzKHRoaXMuY3VycmVudEVxdWl0eSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgcGhhc2UgZXF1aXR5XG4gICAgY29uc3QgcGhhc2VFcXVpdHk6IFJlY29yZDxQaGFzZUlkLCBudW1iZXI+ID0ge1xuICAgICAgcGhhc2UxOiB0aGlzLmN1cnJlbnRFcXVpdHkgKiBhbGxvY2F0aW9uLncxLFxuICAgICAgcGhhc2UyOiB0aGlzLmN1cnJlbnRFcXVpdHkgKiBhbGxvY2F0aW9uLncyLFxuICAgICAgcGhhc2UzOiB0aGlzLmN1cnJlbnRFcXVpdHkgKiBhbGxvY2F0aW9uLnczLFxuICAgIH07XG5cbiAgICAvLyBHZXQgcmlzayBtZXRyaWNzXG4gICAgY29uc3Qgcmlza01ldHJpY3MgPSB0aGlzLnJpc2tHdWFyZGlhbi5nZXRSaXNrTWV0cmljcyh0aGlzLmN1cnJlbnRQb3NpdGlvbnMpO1xuXG4gICAgLy8gR2V0IHRyZWFzdXJ5IHN0YXR1c1xuICAgIGNvbnN0IHRyZWFzdXJ5ID0gYXdhaXQgdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0VHJlYXN1cnlTdGF0dXMoKTtcblxuICAgIC8vIEdldCBjaXJjdWl0IGJyZWFrZXIgc3RhdHVzXG4gICAgY29uc3QgY2lyY3VpdEJyZWFrZXIgPSB0aGlzLmNpcmN1aXRCcmVha2VyLmdldFN0YXR1cygpO1xuXG4gICAgLy8gR2V0IHJlY2VudCBkZWNpc2lvbnMgKGxhc3QgMjApXG4gICAgY29uc3QgcmVjZW50RGVjaXNpb25zID0gdGhpcy5yZWNlbnREZWNpc2lvbnMuc2xpY2UoLTIwKTtcblxuICAgIC8vIEdldCBtYW51YWwgb3ZlcnJpZGUgc3RhdHVzXG4gICAgY29uc3QgbWFudWFsT3ZlcnJpZGUgPSB0aGlzLmdldEN1cnJlbnRNYW51YWxPdmVycmlkZSgpO1xuICAgIGNvbnN0IHdhcm5pbmdCYW5uZXJBY3RpdmUgPSB0aGlzLmlzV2FybmluZ0Jhbm5lckFjdGl2ZSgpO1xuXG4gICAgY29uc3QgZGFzaGJvYXJkRGF0YTogRGFzaGJvYXJkRGF0YSA9IHtcbiAgICAgIG5hdjogdGhpcy5jdXJyZW50RXF1aXR5LFxuICAgICAgYWxsb2NhdGlvbixcbiAgICAgIHBoYXNlRXF1aXR5LFxuICAgICAgcmlza01ldHJpY3M6IHtcbiAgICAgICAgZ2xvYmFsTGV2ZXJhZ2U6IHJpc2tNZXRyaWNzLmN1cnJlbnRMZXZlcmFnZSxcbiAgICAgICAgbmV0RGVsdGE6IHJpc2tNZXRyaWNzLnBvcnRmb2xpb0RlbHRhLFxuICAgICAgICBjb3JyZWxhdGlvblNjb3JlOiByaXNrTWV0cmljcy5jb3JyZWxhdGlvbixcbiAgICAgICAgcG9ydGZvbGlvQmV0YTogcmlza01ldHJpY3MucG9ydGZvbGlvQmV0YSxcbiAgICAgIH0sXG4gICAgICB0cmVhc3VyeSxcbiAgICAgIGNpcmN1aXRCcmVha2VyLFxuICAgICAgcmVjZW50RGVjaXNpb25zLFxuICAgICAgbGFzdFVwZGF0ZWQ6IERhdGUubm93KCksXG4gICAgICBtYW51YWxPdmVycmlkZTogbWFudWFsT3ZlcnJpZGVcbiAgICAgICAgPyB7XG4gICAgICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgICAgIG9wZXJhdG9ySWQ6IG1hbnVhbE92ZXJyaWRlLm9wZXJhdG9ySWQsXG4gICAgICAgICAgcmVhc29uOiBtYW51YWxPdmVycmlkZS5yZWFzb24sXG4gICAgICAgICAgYWxsb2NhdGlvbjogbWFudWFsT3ZlcnJpZGUub3ZlcnJpZGVBbGxvY2F0aW9uLFxuICAgICAgICAgIGV4cGlyZXNBdDogbWFudWFsT3ZlcnJpZGUuZXhwaXJlc0F0LFxuICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICAgIHdhcm5pbmdCYW5uZXJBY3RpdmUsXG4gICAgfTtcblxuICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICB0aGlzLmRhc2hib2FyZENhY2hlID0gZGFzaGJvYXJkRGF0YTtcbiAgICB0aGlzLmRhc2hib2FyZENhY2hlVGltZSA9IERhdGUubm93KCk7XG5cbiAgICByZXR1cm4gZGFzaGJvYXJkRGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3lzdGVtIGhlYWx0aCBzdGF0dXNcbiAgICpcbiAgICogQHJldHVybnMgSGVhbHRoU3RhdHVzIHdpdGggY29tcG9uZW50IGhlYWx0aFxuICAgKi9cbiAgYXN5bmMgZ2V0SGVhbHRoU3RhdHVzKCk6IFByb21pc2U8SGVhbHRoU3RhdHVzPiB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNvbXBvbmVudHMgPSB7XG4gICAgICBkYXRhYmFzZTogZmFsc2UsXG4gICAgICByZWRpczogZmFsc2UsXG4gICAgICBleGVjdXRpb25FbmdpbmU6IGZhbHNlLFxuICAgICAgcGhhc2VzOiB7XG4gICAgICAgIHBoYXNlMTogZmFsc2UsXG4gICAgICAgIHBoYXNlMjogZmFsc2UsXG4gICAgICAgIHBoYXNlMzogZmFsc2UsXG4gICAgICB9IGFzIFJlY29yZDxQaGFzZUlkLCBib29sZWFuPixcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgZGF0YWJhc2VcbiAgICBpZiAodGhpcy5kYikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcIlNFTEVDVCAxXCIpO1xuICAgICAgICBjb21wb25lbnRzLmRhdGFiYXNlID0gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAgIGBEYXRhYmFzZTogJHtcbiAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJcbiAgICAgICAgICB9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRm9yIFJhaWx3YXkgZGVwbG95bWVudCB3aXRob3V0IGRhdGFiYXNlLCBjb25zaWRlciBpdCBoZWFsdGh5XG4gICAgICBjb21wb25lbnRzLmRhdGFiYXNlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBleGVjdXRpb24gZW5naW5lIChvcHRpb25hbCBmb3IgUmFpbHdheSlcbiAgICBpZiAodGhpcy5leGVjdXRpb25FbmdpbmUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0aW9uRW5naW5lLmdldFBvc2l0aW9ucygpO1xuICAgICAgICBjb21wb25lbnRzLmV4ZWN1dGlvbkVuZ2luZSA9IHRydWU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgICBgRXhlY3V0aW9uIEVuZ2luZTogJHtcbiAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJcbiAgICAgICAgICB9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRm9yIFJhaWx3YXkgZGVwbG95bWVudCB3aXRob3V0IGV4ZWN1dGlvbiBlbmdpbmUsIGNvbnNpZGVyIGl0IGhlYWx0aHlcbiAgICAgIGNvbXBvbmVudHMuZXhlY3V0aW9uRW5naW5lID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBwaGFzZSBhcHByb3ZhbCByYXRlc1xuICAgIC8vIFJlcXVpcmVtZW50IDcuODogRmxhZyBmb3IgcmV2aWV3IGlmIGFwcHJvdmFsIHJhdGUgPCA1MCVcbiAgICBmb3IgKGNvbnN0IHBoYXNlSWQgb2YgW1wicGhhc2UxXCIsIFwicGhhc2UyXCIsIFwicGhhc2UzXCJdIGFzIFBoYXNlSWRbXSkge1xuICAgICAgY29uc3Qgc3RhdHMgPSB0aGlzLnNpZ25hbFN0YXRzW3BoYXNlSWRdO1xuICAgICAgaWYgKHN0YXRzLnRvdGFsID4gMCkge1xuICAgICAgICBjb25zdCBhcHByb3ZhbFJhdGUgPSBzdGF0cy5hcHByb3ZlZCAvIHN0YXRzLnRvdGFsO1xuICAgICAgICBjb21wb25lbnRzLnBoYXNlc1twaGFzZUlkXSA9IGFwcHJvdmFsUmF0ZSA+PSAwLjU7XG4gICAgICAgIGlmIChhcHByb3ZhbFJhdGUgPCAwLjUpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgICAgIGAke3BoYXNlSWR9OiBBcHByb3ZhbCByYXRlICR7XG4gICAgICAgICAgICAgIChhcHByb3ZhbFJhdGUgKiAxMDApLnRvRml4ZWQoMSlcbiAgICAgICAgICAgIH0lIDwgNTAlYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb21wb25lbnRzLnBoYXNlc1twaGFzZUlkXSA9IHRydWU7IC8vIE5vIHNpZ25hbHMgeWV0XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRm9yIFJhaWx3YXkgZGVwbG95bWVudCwgYmUgbW9yZSBsZW5pZW50IHdpdGggaGVhbHRoIGNoZWNrc1xuICAgIGNvbnN0IGlzUmFpbHdheURlcGxveW1lbnQgPSBwcm9jZXNzLmVudi5SQUlMV0FZX0VOVklST05NRU5UID09PSBcInRydWVcIjtcbiAgICBjb25zdCBoZWFsdGh5ID0gaXNSYWlsd2F5RGVwbG95bWVudFxuICAgICAgPyAvLyBSYWlsd2F5OiBKdXN0IGNoZWNrIHRoYXQgdGhlIHNlcnZpY2UgaXMgcnVubmluZyAocGhhc2VzIGFyZSBoZWFsdGh5KVxuICAgICAgT2JqZWN0LnZhbHVlcyhjb21wb25lbnRzLnBoYXNlcykuZXZlcnkoQm9vbGVhbilcbiAgICAgIDogLy8gTG9jYWw6IENoZWNrIGFsbCBjb21wb25lbnRzXG4gICAgICBjb21wb25lbnRzLmRhdGFiYXNlICYmXG4gICAgICBjb21wb25lbnRzLmV4ZWN1dGlvbkVuZ2luZSAmJlxuICAgICAgT2JqZWN0LnZhbHVlcyhjb21wb25lbnRzLnBoYXNlcykuZXZlcnkoQm9vbGVhbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGVhbHRoeSxcbiAgICAgIGNvbXBvbmVudHMsXG4gICAgICBsYXN0Q2hlY2s6IERhdGUubm93KCksXG4gICAgICBlcnJvcnMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2lnbmFsIGFwcHJvdmFsIHJhdGUgZm9yIGEgcGhhc2VcbiAgICogUmVxdWlyZW1lbnQgNy43OiBUcmFjayBzaWduYWwgYXBwcm92YWwgcmF0ZSBwZXIgcGhhc2VcbiAgICpcbiAgICogQHBhcmFtIHBoYXNlSWQgLSBQaGFzZSB0byBjaGVja1xuICAgKiBAcmV0dXJucyBBcHByb3ZhbCByYXRlICgwLTEpXG4gICAqL1xuICBnZXRBcHByb3ZhbFJhdGUocGhhc2VJZDogUGhhc2VJZCk6IG51bWJlciB7XG4gICAgY29uc3Qgc3RhdHMgPSB0aGlzLnNpZ25hbFN0YXRzW3BoYXNlSWRdO1xuICAgIGlmIChzdGF0cy50b3RhbCA9PT0gMCkgcmV0dXJuIDEuMDtcbiAgICByZXR1cm4gc3RhdHMuYXBwcm92ZWQgLyBzdGF0cy50b3RhbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHBoYXNlIGFwcHJvdmFsIHJhdGVzXG4gICAqL1xuICBnZXRBbGxBcHByb3ZhbFJhdGVzKCk6IFJlY29yZDxQaGFzZUlkLCBudW1iZXI+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcGhhc2UxOiB0aGlzLmdldEFwcHJvdmFsUmF0ZShcInBoYXNlMVwiKSxcbiAgICAgIHBoYXNlMjogdGhpcy5nZXRBcHByb3ZhbFJhdGUoXCJwaGFzZTJcIiksXG4gICAgICBwaGFzZTM6IHRoaXMuZ2V0QXBwcm92YWxSYXRlKFwicGhhc2UzXCIpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgc2lnbmFsIHN0YXRzIChlLmcuLCBhdCBzdGFydCBvZiBkYXkpXG4gICAqL1xuICByZXNldFNpZ25hbFN0YXRzKCk6IHZvaWQge1xuICAgIHRoaXMuc2lnbmFsU3RhdHMgPSB7XG4gICAgICBwaGFzZTE6IHsgYXBwcm92ZWQ6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBwaGFzZTI6IHsgYXBwcm92ZWQ6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBwaGFzZTM6IHsgYXBwcm92ZWQ6IDAsIHRvdGFsOiAwIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBhbGxvY2F0aW9uIHZlY3RvciAod2l0aCBtYW51YWwgb3ZlcnJpZGUgaWYgYWN0aXZlKVxuICAgKiBSZXF1aXJlbWVudCA5Ljc6IFN1cHBvcnQgbWFudWFsIG92ZXJyaWRlIG9mIGFsbG9jYXRpb24gd2VpZ2h0c1xuICAgKi9cbiAgZ2V0QWxsb2NhdGlvbigpOiBBbGxvY2F0aW9uVmVjdG9yIHtcbiAgICBjb25zdCBub3JtYWxBbGxvY2F0aW9uID0gdGhpcy5hbGxvY2F0aW9uRW5naW5lLmdldFdlaWdodHMoXG4gICAgICB0aGlzLmN1cnJlbnRFcXVpdHksXG4gICAgKTtcblxuICAgIC8vIEFwcGx5IG1hbnVhbCBvdmVycmlkZSBpZiBhY3RpdmVcbiAgICBpZiAodGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZS5nZXRFZmZlY3RpdmVBbGxvY2F0aW9uKFxuICAgICAgICBub3JtYWxBbGxvY2F0aW9uLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9ybWFsQWxsb2NhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBlcXVpdHlcbiAgICovXG4gIGdldEVxdWl0eSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRFcXVpdHk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgcG9zaXRpb25zXG4gICAqL1xuICBnZXRQb3NpdGlvbnMoKTogUG9zaXRpb25bXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmN1cnJlbnRQb3NpdGlvbnNdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjaXJjdWl0IGJyZWFrZXIgc3RhdHVzXG4gICAqL1xuICBnZXRDaXJjdWl0QnJlYWtlclN0YXR1cygpOiBCcmVha2VyU3RhdHVzIHtcbiAgICByZXR1cm4gdGhpcy5jaXJjdWl0QnJlYWtlci5nZXRTdGF0dXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYW51YWxseSByZXNldCBjaXJjdWl0IGJyZWFrZXJcbiAgICogUmVxdWlyZW1lbnQgNS44OiBSZXF1aXJlIG9wZXJhdG9yIElEXG4gICAqXG4gICAqIEBwYXJhbSBvcGVyYXRvcklkIC0gSUQgb2Ygb3BlcmF0b3IgcGVyZm9ybWluZyByZXNldFxuICAgKi9cbiAgYXN5bmMgcmVzZXRDaXJjdWl0QnJlYWtlcihvcGVyYXRvcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNpcmN1aXRCcmVha2VyLnJlc2V0KG9wZXJhdG9ySWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogQnJhaW5Db25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbWFudWFsIGFsbG9jYXRpb24gb3ZlcnJpZGVcbiAgICogUmVxdWlyZW1lbnQgOS43OiBDcmVhdGUgYWRtaW4gZW5kcG9pbnQgZm9yIGFsbG9jYXRpb24gb3ZlcnJpZGVcbiAgICpcbiAgICogQHBhcmFtIG9wZXJhdG9ySWQgLSBPcGVyYXRvciBjcmVhdGluZyB0aGUgb3ZlcnJpZGVcbiAgICogQHBhcmFtIHBhc3N3b3JkIC0gT3BlcmF0b3IgcGFzc3dvcmRcbiAgICogQHBhcmFtIGFsbG9jYXRpb24gLSBOZXcgYWxsb2NhdGlvbiB2ZWN0b3JcbiAgICogQHBhcmFtIHJlYXNvbiAtIFJlYXNvbiBmb3Igb3ZlcnJpZGVcbiAgICogQHBhcmFtIGR1cmF0aW9uSG91cnMgLSBPcHRpb25hbCBkdXJhdGlvbiBpbiBob3Vyc1xuICAgKiBAcmV0dXJucyBUcnVlIGlmIG92ZXJyaWRlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAqL1xuICBhc3luYyBjcmVhdGVNYW51YWxPdmVycmlkZShcbiAgICBvcGVyYXRvcklkOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgICBhbGxvY2F0aW9uOiBBbGxvY2F0aW9uVmVjdG9yLFxuICAgIHJlYXNvbjogc3RyaW5nLFxuICAgIGR1cmF0aW9uSG91cnM/OiBudW1iZXIsXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJNYW51YWwgb3ZlcnJpZGUgc2VydmljZSBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEF1dGhlbnRpY2F0ZSBvcGVyYXRvclxuICAgIGNvbnN0IGF1dGhlbnRpY2F0ZWQgPSBhd2FpdCB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZS5hdXRoZW50aWNhdGVPcGVyYXRvcihcbiAgICAgIG9wZXJhdG9ySWQsXG4gICAgICBwYXNzd29yZCxcbiAgICApO1xuICAgIGlmICghYXV0aGVudGljYXRlZCkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgTWFudWFsIG92ZXJyaWRlIHJlamVjdGVkOiBhdXRoZW50aWNhdGlvbiBmYWlsZWQgZm9yIG9wZXJhdG9yICR7b3BlcmF0b3JJZH1gLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgb3ZlcnJpZGVcbiAgICBjb25zdCBvdmVycmlkZSA9IGF3YWl0IHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlLmNyZWF0ZU92ZXJyaWRlKHtcbiAgICAgIG9wZXJhdG9ySWQsXG4gICAgICBhbGxvY2F0aW9uLFxuICAgICAgcmVhc29uLFxuICAgICAgZHVyYXRpb25Ib3VycyxcbiAgICB9KTtcblxuICAgIGlmIChvdmVycmlkZSkge1xuICAgICAgY29uc29sZS5sb2coYOKchSBNYW51YWwgb3ZlcnJpZGUgY3JlYXRlZCBieSBvcGVyYXRvciAke29wZXJhdG9ySWR9YCk7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYCAgIE5ldyBhbGxvY2F0aW9uOiB3MT0ke2FsbG9jYXRpb24udzF9LCB3Mj0ke2FsbG9jYXRpb24udzJ9LCB3Mz0ke2FsbG9jYXRpb24udzN9YCxcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZyhgICAgUmVhc29uOiAke3JlYXNvbn1gKTtcblxuICAgICAgLy8gSW52YWxpZGF0ZSBkYXNoYm9hcmQgY2FjaGUgdG8gc2hvdyB3YXJuaW5nIGJhbm5lclxuICAgICAgdGhpcy5kYXNoYm9hcmRDYWNoZSA9IG51bGw7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWFjdGl2YXRlIHRoZSBjdXJyZW50IG1hbnVhbCBvdmVycmlkZVxuICAgKlxuICAgKiBAcGFyYW0gb3BlcmF0b3JJZCAtIE9wZXJhdG9yIGRlYWN0aXZhdGluZyB0aGUgb3ZlcnJpZGVcbiAgICogQHBhcmFtIHBhc3N3b3JkIC0gT3BlcmF0b3IgcGFzc3dvcmRcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBzdWNjZXNzZnVsbHkgZGVhY3RpdmF0ZWRcbiAgICovXG4gIGFzeW5jIGRlYWN0aXZhdGVNYW51YWxPdmVycmlkZShcbiAgICBvcGVyYXRvcklkOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1hbnVhbCBvdmVycmlkZSBzZXJ2aWNlIG5vdCBhdmFpbGFibGVcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQXV0aGVudGljYXRlIG9wZXJhdG9yXG4gICAgY29uc3QgYXV0aGVudGljYXRlZCA9IGF3YWl0IHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlLmF1dGhlbnRpY2F0ZU9wZXJhdG9yKFxuICAgICAgb3BlcmF0b3JJZCxcbiAgICAgIHBhc3N3b3JkLFxuICAgICk7XG4gICAgaWYgKCFhdXRoZW50aWNhdGVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBNYW51YWwgb3ZlcnJpZGUgZGVhY3RpdmF0aW9uIHJlamVjdGVkOiBhdXRoZW50aWNhdGlvbiBmYWlsZWQgZm9yIG9wZXJhdG9yICR7b3BlcmF0b3JJZH1gLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuZGVhY3RpdmF0ZU92ZXJyaWRlKFxuICAgICAgb3BlcmF0b3JJZCxcbiAgICApO1xuXG4gICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgTWFudWFsIG92ZXJyaWRlIGRlYWN0aXZhdGVkIGJ5IG9wZXJhdG9yICR7b3BlcmF0b3JJZH1gKTtcblxuICAgICAgLy8gSW52YWxpZGF0ZSBkYXNoYm9hcmQgY2FjaGUgdG8gaGlkZSB3YXJuaW5nIGJhbm5lclxuICAgICAgdGhpcy5kYXNoYm9hcmRDYWNoZSA9IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1Y2Nlc3M7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgbWFudWFsIG92ZXJyaWRlIHN0YXR1c1xuICAgKlxuICAgKiBAcmV0dXJucyBDdXJyZW50IG92ZXJyaWRlIG9yIG51bGwgaWYgbm9uZSBhY3RpdmVcbiAgICovXG4gIGdldEN1cnJlbnRNYW51YWxPdmVycmlkZSgpIHtcbiAgICBpZiAoIXRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuZ2V0Q3VycmVudE92ZXJyaWRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgd2FybmluZyBiYW5uZXIgc2hvdWxkIGJlIGRpc3BsYXllZFxuICAgKiBSZXF1aXJlbWVudCA5Ljg6IEltcGxlbWVudCB3YXJuaW5nIGJhbm5lciBmbGFnXG4gICAqXG4gICAqIEByZXR1cm5zIFRydWUgaWYgd2FybmluZyBiYW5uZXIgc2hvdWxkIGJlIHNob3duXG4gICAqL1xuICBpc1dhcm5pbmdCYW5uZXJBY3RpdmUoKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZS5pc1dhcm5pbmdCYW5uZXJBY3RpdmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWFudWFsIG92ZXJyaWRlIGhpc3RvcnlcbiAgICpcbiAgICogQHBhcmFtIG9wZXJhdG9ySWQgLSBPcHRpb25hbCBvcGVyYXRvciBmaWx0ZXJcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2YgcmVjb3Jkc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBoaXN0b3JpY2FsIG92ZXJyaWRlc1xuICAgKi9cbiAgYXN5bmMgZ2V0TWFudWFsT3ZlcnJpZGVIaXN0b3J5KG9wZXJhdG9ySWQ/OiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSA1MCkge1xuICAgIGlmICghdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHJldHVybiBbXTtcbiAgICByZXR1cm4gdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuZ2V0T3ZlcnJpZGVIaXN0b3J5KG9wZXJhdG9ySWQsIGxpbWl0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgb3BlcmF0b3IgYWNjb3VudFxuICAgKlxuICAgKiBAcGFyYW0gb3BlcmF0b3JJZCAtIFVuaXF1ZSBvcGVyYXRvciBpZGVudGlmaWVyXG4gICAqIEBwYXJhbSBwYXNzd29yZCAtIE9wZXJhdG9yIHBhc3N3b3JkXG4gICAqIEBwYXJhbSBwZXJtaXNzaW9ucyAtIEFycmF5IG9mIHBlcm1pc3Npb25zXG4gICAqIEByZXR1cm5zIFRydWUgaWYgY3JlYXRlZCBzdWNjZXNzZnVsbHlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZU9wZXJhdG9yKFxuICAgIG9wZXJhdG9ySWQ6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICAgIHBlcm1pc3Npb25zOiBzdHJpbmdbXSxcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1hbnVhbCBvdmVycmlkZSBzZXJ2aWNlIG5vdCBhdmFpbGFibGVcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlLmNyZWF0ZU9wZXJhdG9yKFxuICAgICAgb3BlcmF0b3JJZCxcbiAgICAgIHBhc3N3b3JkLFxuICAgICAgcGVybWlzc2lvbnMsXG4gICAgKTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PSBQb3NpdGlvbkNsb3N1cmVIYW5kbGVyIEltcGxlbWVudGF0aW9uID09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDbG9zZSBhbGwgcG9zaXRpb25zIChjYWxsZWQgYnkgY2lyY3VpdCBicmVha2VyKVxuICAgKi9cbiAgYXN5bmMgY2xvc2VBbGxQb3NpdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuZXhlY3V0aW9uRW5naW5lKSB7XG4gICAgICBhd2FpdCB0aGlzLmV4ZWN1dGlvbkVuZ2luZS5jbG9zZUFsbFBvc2l0aW9ucygpO1xuICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb25zID0gW107XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09IEJyZWFrZXJFdmVudFBlcnNpc3RlbmNlIEltcGxlbWVudGF0aW9uID09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBQZXJzaXN0IGNpcmN1aXQgYnJlYWtlciBldmVudCB0byBkYXRhYmFzZVxuICAgKi9cbiAgYXN5bmMgcGVyc2lzdEV2ZW50KGV2ZW50OiB7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG4gICAgZXZlbnRUeXBlOiBcIlRSSUdHRVJcIiB8IFwiUkVTRVRcIjtcbiAgICBicmVha2VyVHlwZT86IHN0cmluZztcbiAgICByZWFzb246IHN0cmluZztcbiAgICBlcXVpdHk6IG51bWJlcjtcbiAgICBvcGVyYXRvcklkPzogc3RyaW5nO1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIH0pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuZGIpIHJldHVybjtcblxuICAgIGF3YWl0IHRoaXMuZGIucXVlcnkoXG4gICAgICBgSU5TRVJUIElOVE8gY2lyY3VpdF9icmVha2VyX2V2ZW50cyBcbiAgICAgICAodGltZXN0YW1wLCBldmVudF90eXBlLCByZWFzb24sIGVxdWl0eSwgb3BlcmF0b3JfaWQsIG1ldGFkYXRhKVxuICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNilgLFxuICAgICAgW1xuICAgICAgICBldmVudC50aW1lc3RhbXAsXG4gICAgICAgIGV2ZW50LmV2ZW50VHlwZSxcbiAgICAgICAgZXZlbnQucmVhc29uLFxuICAgICAgICBldmVudC5lcXVpdHksXG4gICAgICAgIGV2ZW50Lm9wZXJhdG9ySWQgPz8gbnVsbCxcbiAgICAgICAgZXZlbnQubWV0YWRhdGEgPyBKU09OLnN0cmluZ2lmeShldmVudC5tZXRhZGF0YSkgOiBudWxsLFxuICAgICAgXSxcbiAgICApO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09IFByaXZhdGUgSGVscGVyIE1ldGhvZHMgPT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHBlcmlvZGljIG1ldHJpYyB1cGRhdGVzXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0TWV0cmljVXBkYXRlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tZXRyaWNzVXBkYXRlVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tZXRyaWNzVXBkYXRlVGltZXIpO1xuICAgIH1cblxuICAgIHRoaXMubWV0cmljc1VwZGF0ZVRpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVNZXRyaWNzKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgbWV0cmljczpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH0sIHRoaXMuY29uZmlnLm1ldHJpY1VwZGF0ZUludGVydmFsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGhhc2Ugd2VpZ2h0IGZyb20gYWxsb2NhdGlvbiB2ZWN0b3JcbiAgICovXG4gIHByaXZhdGUgZ2V0UGhhc2VXZWlnaHQoXG4gICAgcGhhc2VJZDogUGhhc2VJZCxcbiAgICBhbGxvY2F0aW9uOiBBbGxvY2F0aW9uVmVjdG9yLFxuICApOiBudW1iZXIge1xuICAgIHN3aXRjaCAocGhhc2VJZCkge1xuICAgICAgY2FzZSBcInBoYXNlMVwiOlxuICAgICAgICByZXR1cm4gYWxsb2NhdGlvbi53MTtcbiAgICAgIGNhc2UgXCJwaGFzZTJcIjpcbiAgICAgICAgcmV0dXJuIGFsbG9jYXRpb24udzI7XG4gICAgICBjYXNlIFwicGhhc2UzXCI6XG4gICAgICAgIHJldHVybiBhbGxvY2F0aW9uLnczO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZldG8gZGVjaXNpb25cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlVmV0b0RlY2lzaW9uKFxuICAgIHNpZ25hbDogSW50ZW50U2lnbmFsLFxuICAgIHJlYXNvbjogc3RyaW5nLFxuICAgIHRpbWVzdGFtcDogbnVtYmVyLFxuICApOiBCcmFpbkRlY2lzaW9uIHtcbiAgICBjb25zdCBhbGxvY2F0aW9uID0gdGhpcy5hbGxvY2F0aW9uRW5naW5lLmdldFdlaWdodHModGhpcy5jdXJyZW50RXF1aXR5KTtcbiAgICBjb25zdCByaXNrTWV0cmljcyA9IHRoaXMucmlza0d1YXJkaWFuLmdldFJpc2tNZXRyaWNzKHRoaXMuY3VycmVudFBvc2l0aW9ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2lnbmFsSWQ6IHNpZ25hbC5zaWduYWxJZCxcbiAgICAgIGFwcHJvdmVkOiBmYWxzZSxcbiAgICAgIGF1dGhvcml6ZWRTaXplOiAwLFxuICAgICAgcmVhc29uLFxuICAgICAgYWxsb2NhdGlvbixcbiAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgIHBoYXNlSWQ6IHNpZ25hbC5waGFzZUlkLFxuICAgICAgICBzaGFycGVSYXRpbzogMCxcbiAgICAgICAgdG90YWxQbkw6IDAsXG4gICAgICAgIHRyYWRlQ291bnQ6IDAsXG4gICAgICAgIHdpblJhdGU6IDAsXG4gICAgICAgIGF2Z1dpbjogMCxcbiAgICAgICAgYXZnTG9zczogMCxcbiAgICAgICAgbW9kaWZpZXI6IDEuMCxcbiAgICAgIH0sXG4gICAgICByaXNrOiB7XG4gICAgICAgIGFwcHJvdmVkOiBmYWxzZSxcbiAgICAgICAgcmVhc29uLFxuICAgICAgICByaXNrTWV0cmljcyxcbiAgICAgIH0sXG4gICAgICB0aW1lc3RhbXAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCBhcHByb3ZhbCByZWFzb24gc3RyaW5nXG4gICAqL1xuICBwcml2YXRlIGJ1aWxkQXBwcm92YWxSZWFzb24oXG4gICAgcmVxdWVzdGVkU2l6ZTogbnVtYmVyLFxuICAgIGF1dGhvcml6ZWRTaXplOiBudW1iZXIsXG4gICAgbWF4UG9zaXRpb25TaXplOiBudW1iZXIsXG4gICAgcmlza0RlY2lzaW9uOiBSaXNrRGVjaXNpb24sXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW1wiU2lnbmFsIGFwcHJvdmVkXCJdO1xuXG4gICAgaWYgKGF1dGhvcml6ZWRTaXplIDwgcmVxdWVzdGVkU2l6ZSkge1xuICAgICAgY29uc3QgcmVkdWN0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgaWYgKFxuICAgICAgICBhdXRob3JpemVkU2l6ZSA8PSBtYXhQb3NpdGlvblNpemUgJiYgcmVxdWVzdGVkU2l6ZSA+IG1heFBvc2l0aW9uU2l6ZVxuICAgICAgKSB7XG4gICAgICAgIHJlZHVjdGlvbnMucHVzaChgYWxsb2NhdGlvbiBjYXAgKCR7bWF4UG9zaXRpb25TaXplLnRvRml4ZWQoMil9KWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIHJpc2tEZWNpc2lvbi5hZGp1c3RlZFNpemUgJiYgcmlza0RlY2lzaW9uLmFkanVzdGVkU2l6ZSA8IHJlcXVlc3RlZFNpemVcbiAgICAgICkge1xuICAgICAgICByZWR1Y3Rpb25zLnB1c2goYHJpc2sgYWRqdXN0bWVudGApO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVkdWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhcnRzLnB1c2goYHdpdGggc2l6ZSByZWR1Y3Rpb24gZHVlIHRvICR7cmVkdWN0aW9ucy5qb2luKFwiLCBcIil9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRzLmpvaW4oXCIgXCIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCBhIGRlY2lzaW9uIHRvIGRhdGFiYXNlIGFuZCBtZW1vcnlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVjb3JkRGVjaXNpb24oXG4gICAgZGVjaXNpb246IEJyYWluRGVjaXNpb24sXG4gICAgc2lnbmFsOiBJbnRlbnRTaWduYWwsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEFkZCB0byByZWNlbnQgZGVjaXNpb25zXG4gICAgdGhpcy5yZWNlbnREZWNpc2lvbnMucHVzaChkZWNpc2lvbik7XG5cbiAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAgZGVjaXNpb25zIGluIG1lbW9yeVxuICAgIGlmICh0aGlzLnJlY2VudERlY2lzaW9ucy5sZW5ndGggPiAxMDApIHtcbiAgICAgIHRoaXMucmVjZW50RGVjaXNpb25zLnNoaWZ0KCk7XG4gICAgfVxuXG4gICAgLy8gUGVyc2lzdCB0byBkYXRhYmFzZVxuICAgIGlmICh0aGlzLmRiKSB7XG4gICAgICBjb25zdCByZWNvcmQ6IERlY2lzaW9uUmVjb3JkID0ge1xuICAgICAgICBzaWduYWxJZDogc2lnbmFsLnNpZ25hbElkLFxuICAgICAgICBwaGFzZUlkOiBzaWduYWwucGhhc2VJZCxcbiAgICAgICAgdGltZXN0YW1wOiBkZWNpc2lvbi50aW1lc3RhbXAsXG4gICAgICAgIGFwcHJvdmVkOiBkZWNpc2lvbi5hcHByb3ZlZCxcbiAgICAgICAgcmVxdWVzdGVkU2l6ZTogc2lnbmFsLnJlcXVlc3RlZFNpemUsXG4gICAgICAgIGF1dGhvcml6ZWRTaXplOiBkZWNpc2lvbi5hcHByb3ZlZCA/IGRlY2lzaW9uLmF1dGhvcml6ZWRTaXplIDogbnVsbCxcbiAgICAgICAgcmVhc29uOiBkZWNpc2lvbi5yZWFzb24sXG4gICAgICAgIHJpc2tNZXRyaWNzOiBkZWNpc2lvbi5yaXNrLnJpc2tNZXRyaWNzLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICAgYElOU0VSVCBJTlRPIGJyYWluX2RlY2lzaW9ucyBcbiAgICAgICAgIChzaWduYWxfaWQsIHBoYXNlX2lkLCB0aW1lc3RhbXAsIGFwcHJvdmVkLCByZXF1ZXN0ZWRfc2l6ZSwgYXV0aG9yaXplZF9zaXplLCByZWFzb24sIHJpc2tfbWV0cmljcylcbiAgICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4KVxuICAgICAgICAgT04gQ09ORkxJQ1QgKHNpZ25hbF9pZCkgRE8gTk9USElOR2AsXG4gICAgICAgIFtcbiAgICAgICAgICByZWNvcmQuc2lnbmFsSWQsXG4gICAgICAgICAgcmVjb3JkLnBoYXNlSWQsXG4gICAgICAgICAgcmVjb3JkLnRpbWVzdGFtcCxcbiAgICAgICAgICByZWNvcmQuYXBwcm92ZWQsXG4gICAgICAgICAgcmVjb3JkLnJlcXVlc3RlZFNpemUsXG4gICAgICAgICAgcmVjb3JkLmF1dGhvcml6ZWRTaXplLFxuICAgICAgICAgIHJlY29yZC5yZWFzb24sXG4gICAgICAgICAgcmVjb3JkLnJpc2tNZXRyaWNzID8gSlNPTi5zdHJpbmdpZnkocmVjb3JkLnJpc2tNZXRyaWNzKSA6IG51bGwsXG4gICAgICAgIF0sXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2lnbmFsIHN0YXRpc3RpY3NcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlU2lnbmFsU3RhdHMocGhhc2VJZDogUGhhc2VJZCwgYXBwcm92ZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnNpZ25hbFN0YXRzW3BoYXNlSWRdLnRvdGFsKys7XG4gICAgaWYgKGFwcHJvdmVkKSB7XG4gICAgICB0aGlzLnNpZ25hbFN0YXRzW3BoYXNlSWRdLmFwcHJvdmVkKys7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBuZXQgcG9zaXRpb24gZm9yIG9wcG9zaXRlIHNpZ25hbHNcbiAgICogUmVxdWlyZW1lbnQgNy4zOiBDYWxjdWxhdGUgbmV0IHBvc2l0aW9uIGZvciBvcHBvc2l0ZSBzaWduYWxzIG9uIHNhbWUgYXNzZXRcbiAgICpcbiAgICogQHBhcmFtIHNpZ25hbHMgLSBBcnJheSBvZiBzaWduYWxzIGZvciB0aGUgc2FtZSBhc3NldFxuICAgKiBAcmV0dXJucyBOZXQgcG9zaXRpb24gc2l6ZSBhbmQgZGlyZWN0aW9uXG4gICAqL1xuICBjYWxjdWxhdGVOZXRQb3NpdGlvbihcbiAgICBzaWduYWxzOiBJbnRlbnRTaWduYWxbXSxcbiAgKTogeyBuZXRTaXplOiBudW1iZXI7IHNpZGU6IFwiQlVZXCIgfCBcIlNFTExcIiB8IFwiTkVVVFJBTFwiIH0ge1xuICAgIGxldCBuZXRTaXplID0gMDtcblxuICAgIGZvciAoY29uc3Qgc2lnbmFsIG9mIHNpZ25hbHMpIHtcbiAgICAgIGlmIChzaWduYWwuc2lkZSA9PT0gXCJCVVlcIikge1xuICAgICAgICBuZXRTaXplICs9IHNpZ25hbC5yZXF1ZXN0ZWRTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV0U2l6ZSAtPSBzaWduYWwucmVxdWVzdGVkU2l6ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobmV0U2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiB7IG5ldFNpemUsIHNpZGU6IFwiQlVZXCIgfTtcbiAgICB9IGVsc2UgaWYgKG5ldFNpemUgPCAwKSB7XG4gICAgICByZXR1cm4geyBuZXRTaXplOiBNYXRoLmFicyhuZXRTaXplKSwgc2lkZTogXCJTRUxMXCIgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHsgbmV0U2l6ZTogMCwgc2lkZTogXCJORVVUUkFMXCIgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlY2VudCBkZWNpc2lvbnNcbiAgICpcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2YgZGVjaXNpb25zIHRvIHJldHVyblxuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNlbnQgZGVjaXNpb25zXG4gICAqL1xuICBnZXRSZWNlbnREZWNpc2lvbnMobGltaXQ6IG51bWJlciA9IDIwKTogQnJhaW5EZWNpc2lvbltdIHtcbiAgICByZXR1cm4gdGhpcy5yZWNlbnREZWNpc2lvbnMuc2xpY2UoLWxpbWl0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnQgZGFzaGJvYXJkIGRhdGEgdG8gSlNPTlxuICAgKiBSZXF1aXJlbWVudCAxMC44OiBTdXBwb3J0IGV4cG9ydGluZyBkYXNoYm9hcmQgZGF0YSB0byBKU09OXG4gICAqXG4gICAqIEByZXR1cm5zIEpTT04gc3RyaW5nIG9mIGRhc2hib2FyZCBkYXRhXG4gICAqL1xuICBhc3luYyBleHBvcnREYXNoYm9hcmRKU09OKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0RGFzaGJvYXJkRGF0YSgpO1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGVyZm9ybWFuY2UgZm9yIGFsbCBwaGFzZXNcbiAgICovXG4gIGFzeW5jIGdldEFsbFBoYXNlUGVyZm9ybWFuY2UoKTogUHJvbWlzZTxQaGFzZVBlcmZvcm1hbmNlW10+IHtcbiAgICByZXR1cm4gdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIuZ2V0QWxsUGhhc2VQZXJmb3JtYW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0cmVhc3VyeSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGdldFRyZWFzdXJ5U3RhdHVzKCk6IFByb21pc2U8VHJlYXN1cnlTdGF0dXM+IHtcbiAgICByZXR1cm4gdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0VHJlYXN1cnlTdGF0dXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbmV4dCBzd2VlcCB0cmlnZ2VyIGxldmVsXG4gICAqL1xuICBnZXROZXh0U3dlZXBUcmlnZ2VyTGV2ZWwoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0TmV4dFN3ZWVwVHJpZ2dlckxldmVsKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRvdGFsIHN3ZXB0IGFtb3VudFxuICAgKi9cbiAgZ2V0VG90YWxTd2VwdCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5nZXRUb3RhbFN3ZXB0KCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGhpZ2ggd2F0ZXJtYXJrXG4gICAqL1xuICBnZXRIaWdoV2F0ZXJtYXJrKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLmdldEhpZ2hXYXRlcm1hcmsoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcHJpY2UgaGlzdG9yeSBmb3IgY29ycmVsYXRpb24gY2FsY3VsYXRpb25zXG4gICAqXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBBc3NldCBzeW1ib2xcbiAgICogQHBhcmFtIHByaWNlIC0gQ3VycmVudCBwcmljZVxuICAgKi9cbiAgdXBkYXRlUHJpY2VIaXN0b3J5KHN5bWJvbDogc3RyaW5nLCBwcmljZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5yaXNrR3VhcmRpYW4udXBkYXRlUHJpY2VIaXN0b3J5KHN5bWJvbCwgcHJpY2UpO1xuICB9XG4gIC8qKlxuICAgKiBHZXQgZGF0YWJhc2UgbWFuYWdlclxuICAgKi9cbiAgZ2V0RGF0YWJhc2VNYW5hZ2VyKCk6IERhdGFiYXNlTWFuYWdlciB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmRiO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=