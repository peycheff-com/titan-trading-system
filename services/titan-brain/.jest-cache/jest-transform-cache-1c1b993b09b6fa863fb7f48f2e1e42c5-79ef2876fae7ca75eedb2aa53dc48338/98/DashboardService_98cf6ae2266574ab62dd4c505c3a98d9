be0d9646dced3d7292a7ebdd75390a81
"use strict";
/**
 * DashboardService - Comprehensive data collection and aggregation for dashboard
 * Handles NAV calculation, allocation formatting, risk metrics, and treasury status
 *
 * Requirements: 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DashboardService = void 0;
/**
 * Default configuration
 */
const DEFAULT_CONFIG = {
    cacheTTL: 60000, // 1 minute
    navCacheTTL: 30000, // 30 seconds
    maxRecentDecisions: 50,
    version: '1.0.0',
};
/**
 * DashboardService provides comprehensive data aggregation for the dashboard
 */
class DashboardService {
    config;
    brain;
    db;
    startTime;
    /** Cache for dashboard data */
    dashboardCache = null;
    dashboardCacheTime = 0;
    /** Cache for NAV calculation */
    navCache = null;
    navCacheTime = 0;
    /** External wallet balance providers */
    walletProviders = new Map();
    constructor(brain, db, config) {
        this.config = { ...DEFAULT_CONFIG, ...config };
        this.brain = brain;
        this.db = db ?? null;
        this.startTime = Date.now();
    }
    /**
     * Register a wallet balance provider
     *
     * @param exchange - Exchange name (e.g., 'bybit', 'binance')
     * @param provider - Function that returns wallet balances
     */
    registerWalletProvider(exchange, provider) {
        this.walletProviders.set(exchange, provider);
    }
    /**
     * Calculate NAV from all wallets
     * Requirement 10.2: Implement NAV calculation from all wallets
     *
     * @returns NAV calculation with wallet breakdown
     */
    async calculateNAV() {
        // Check cache
        if (this.navCache &&
            Date.now() - this.navCacheTime < this.config.navCacheTTL) {
            return this.navCache;
        }
        const walletBreakdown = [];
        let totalNAV = 0;
        let unrealizedPnL = 0;
        // Collect balances from all registered providers
        for (const [exchange, provider] of this.walletProviders) {
            try {
                const balances = await provider();
                walletBreakdown.push(...balances);
                // Sum USD values
                for (const balance of balances) {
                    totalNAV += balance.usdValue;
                }
            }
            catch (error) {
                console.error(`Error fetching balances from ${exchange}:`, error);
            }
        }
        // Add unrealized PnL from current positions
        const positions = this.brain.getPositions();
        for (const position of positions) {
            if (position.unrealizedPnL) {
                unrealizedPnL += position.unrealizedPnL;
            }
        }
        totalNAV += unrealizedPnL;
        const result = {
            totalNAV,
            walletBreakdown,
            unrealizedPnL,
            lastUpdated: Date.now(),
        };
        // Cache the result
        this.navCache = result;
        this.navCacheTime = Date.now();
        return result;
    }
    /**
     * Format allocation vector with metadata
     * Requirement 10.3: Implement allocation vector formatting
     *
     * @param allocation - Raw allocation vector
     * @param equity - Current equity
     * @returns Formatted allocation data
     */
    formatAllocation(allocation, equity) {
        return {
            vector: allocation,
            phaseEquity: {
                phase1: {
                    weight: allocation.w1,
                    equity: equity * allocation.w1,
                    percentage: (allocation.w1 * 100).toFixed(2) + '%',
                },
                phase2: {
                    weight: allocation.w2,
                    equity: equity * allocation.w2,
                    percentage: (allocation.w2 * 100).toFixed(2) + '%',
                },
                phase3: {
                    weight: allocation.w3,
                    equity: equity * allocation.w3,
                    percentage: (allocation.w3 * 100).toFixed(2) + '%',
                },
            },
            totalEquity: equity,
            lastUpdated: allocation.timestamp,
        };
    }
    /**
     * Calculate phase equity for each phase
     * Requirement 10.4: Implement phase equity calculation
     *
     * @param allocation - Allocation vector
     * @param equity - Total equity
     * @returns Phase equity breakdown
     */
    calculatePhaseEquity(allocation, equity) {
        return {
            phase1: equity * allocation.w1,
            phase2: equity * allocation.w2,
            phase3: equity * allocation.w3,
        };
    }
    /**
     * Aggregate risk metrics with additional calculations
     * Requirement 10.5: Implement risk metrics aggregation
     *
     * @param positions - Current positions
     * @returns Aggregated risk metrics
     */
    async aggregateRiskMetrics(positions) {
        // Get risk metrics from the brain's internal risk guardian
        // Since we don't have direct access, we'll calculate them here
        const baseMetrics = {
            currentLeverage: 0,
            projectedLeverage: 0,
            correlation: 0,
            portfolioDelta: 0,
            portfolioBeta: 0,
        };
        // Calculate additional metrics
        const positionCount = positions.length;
        const totalNotional = positions.reduce((sum, pos) => sum + Math.abs(pos.size), 0);
        const totalUnrealizedPnL = positions.reduce((sum, pos) => sum + (pos.unrealizedPnL ?? 0), 0);
        // Calculate correlation matrix for all positions
        const correlations = {};
        for (let i = 0; i < positions.length; i++) {
            for (let j = i + 1; j < positions.length; j++) {
                const symbolA = positions[i].symbol;
                const symbolB = positions[j].symbol;
                if (!correlations[symbolA])
                    correlations[symbolA] = {};
                if (!correlations[symbolB])
                    correlations[symbolB] = {};
                // For now, use a placeholder correlation calculation
                // In a real implementation, this would access the risk guardian's correlation data
                const correlation = 0.5;
                correlations[symbolA][symbolB] = correlation;
                correlations[symbolB][symbolA] = correlation;
            }
        }
        return {
            ...baseMetrics,
            positionCount,
            totalNotional,
            totalUnrealizedPnL,
            correlationMatrix: correlations,
            riskScore: this.calculateRiskScore(baseMetrics, positionCount, totalNotional),
        };
    }
    /**
     * Aggregate treasury status with additional metrics
     * Requirement 10.6: Implement treasury status aggregation
     *
     * @returns Enhanced treasury status
     */
    async aggregateTreasuryStatus() {
        const treasury = await this.brain.getTreasuryStatus();
        const nextSweepLevel = this.brain.getNextSweepTriggerLevel();
        const totalSwept = this.brain.getTotalSwept();
        const highWatermark = this.brain.getHighWatermark();
        // Calculate additional metrics
        const currentEquity = this.brain.getEquity();
        const totalEquity = treasury.futuresWallet + treasury.spotWallet;
        const drawdownFromHigh = highWatermark > 0 ? (highWatermark - currentEquity) / highWatermark : 0;
        const sweepProgress = nextSweepLevel > 0 ? Math.min(treasury.futuresWallet / nextSweepLevel, 1) : 0;
        return {
            ...treasury,
            nextSweepTriggerLevel: nextSweepLevel,
            totalSwept,
            highWatermark,
            drawdownFromHigh,
            sweepProgress,
            riskCapitalRatio: totalEquity > 0 ? treasury.riskCapital / totalEquity : 0,
            lockedProfitRatio: totalEquity > 0 ? treasury.lockedProfit / totalEquity : 0,
        };
    }
    /**
     * Retrieve recent decisions with filtering
     * Requirement 10.7: Implement recent decisions retrieval
     *
     * @param limit - Maximum number of decisions
     * @param phaseFilter - Optional phase filter
     * @returns Recent decisions with metadata
     */
    async getRecentDecisions(limit = this.config.maxRecentDecisions, phaseFilter) {
        let decisions = this.brain.getRecentDecisions(limit);
        // Apply phase filter if specified
        if (phaseFilter) {
            decisions = decisions.filter(d => d.allocation && this.getPhaseFromDecision(d) === phaseFilter);
        }
        // Add metadata to each decision
        const enhancedDecisions = decisions.map(decision => ({
            ...decision,
            processingTime: this.estimateProcessingTime(decision),
            riskLevel: this.calculateDecisionRiskLevel(decision),
            impactScore: this.calculateImpactScore(decision),
        }));
        return {
            decisions: enhancedDecisions,
            summary: {
                total: enhancedDecisions.length,
                approved: enhancedDecisions.filter(d => d.approved).length,
                rejected: enhancedDecisions.filter(d => !d.approved).length,
                approvalRate: enhancedDecisions.length > 0
                    ? enhancedDecisions.filter(d => d.approved).length / enhancedDecisions.length
                    : 0,
            },
        };
    }
    /**
     * Get comprehensive dashboard data
     * Aggregates all dashboard components
     *
     * @returns Extended dashboard data
     */
    async getDashboardData() {
        // Check cache
        if (this.dashboardCache &&
            Date.now() - this.dashboardCacheTime < this.config.cacheTTL) {
            return this.dashboardCache;
        }
        // Get base dashboard data from brain
        const baseDashboard = await this.brain.getDashboardData();
        // Calculate NAV
        const navCalculation = await this.calculateNAV();
        // Get enhanced metrics
        const phasePerformance = await this.brain.getAllPhasePerformance();
        const approvalRates = this.brain.getAllApprovalRates();
        const enhancedTreasury = await this.aggregateTreasuryStatus();
        const enhancedDecisions = await this.getRecentDecisions();
        // Calculate additional metrics
        const positions = this.brain.getPositions();
        const positionsSummary = {
            count: positions.length,
            totalNotional: positions.reduce((sum, pos) => sum + Math.abs(pos.size), 0),
            totalUnrealizedPnL: positions.reduce((sum, pos) => sum + (pos.unrealizedPnL ?? 0), 0),
        };
        // Calculate time since last profitable trade
        const timeSinceLastProfit = await this.getTimeSinceLastProfit();
        const extendedData = {
            ...baseDashboard,
            nav: navCalculation.totalNAV,
            version: this.config.version,
            uptime: Date.now() - this.startTime,
            phasePerformance,
            approvalRates,
            nextSweepTriggerLevel: enhancedTreasury.nextSweepTriggerLevel,
            totalSwept: enhancedTreasury.totalSwept,
            highWatermark: enhancedTreasury.highWatermark,
            drawdownFromHigh: enhancedTreasury.drawdownFromHigh,
            timeSinceLastProfit,
            positionsSummary,
            treasury: enhancedTreasury,
            recentDecisions: enhancedDecisions.decisions,
        };
        // Cache the result
        this.dashboardCache = extendedData;
        this.dashboardCacheTime = Date.now();
        return extendedData;
    }
    /**
     * Export dashboard data to JSON with metadata
     * Requirement 10.8: Create export endpoint for dashboard data
     *
     * @returns JSON string with timestamp and version metadata
     */
    async exportDashboardJSON() {
        const dashboardData = await this.getDashboardData();
        const exportData = {
            metadata: {
                exportedAt: new Date().toISOString(),
                version: this.config.version,
                source: 'titan-brain-dashboard-service',
            },
            data: dashboardData,
        };
        return JSON.stringify(exportData, null, 2);
    }
    /**
     * Clear all caches
     */
    clearCache() {
        this.dashboardCache = null;
        this.dashboardCacheTime = 0;
        this.navCache = null;
        this.navCacheTime = 0;
    }
    /**
     * Get cache status
     */
    getCacheStatus() {
        return {
            dashboard: {
                cached: this.dashboardCache !== null,
                age: this.dashboardCache ? Date.now() - this.dashboardCacheTime : 0,
                ttl: this.config.cacheTTL,
            },
            nav: {
                cached: this.navCache !== null,
                age: this.navCache ? Date.now() - this.navCacheTime : 0,
                ttl: this.config.navCacheTTL,
            },
        };
    }
    // ============ Private Helper Methods ============
    /**
     * Calculate overall risk score
     */
    calculateRiskScore(metrics, positionCount, totalNotional) {
        // Simple risk scoring algorithm (0-100)
        let score = 0;
        // Leverage component (0-40 points)
        score += Math.min(metrics.currentLeverage * 2, 40);
        // Correlation component (0-30 points)
        score += metrics.correlation * 30;
        // Position count component (0-20 points)
        score += Math.min(positionCount * 2, 20);
        // Notional size component (0-10 points)
        const equity = this.brain.getEquity();
        if (equity > 0) {
            const notionalRatio = totalNotional / equity;
            score += Math.min(notionalRatio * 5, 10);
        }
        return Math.min(score, 100);
    }
    /**
     * Get phase from decision (helper method)
     */
    getPhaseFromDecision(decision) {
        // This would need to be implemented based on how phase info is stored in decisions
        // For now, return null as we don't have this info in the current structure
        return null;
    }
    /**
     * Estimate processing time for a decision
     */
    estimateProcessingTime(decision) {
        // Simple estimation based on decision complexity
        let baseTime = 10; // Base 10ms
        if (decision.risk.riskMetrics) {
            baseTime += 20; // Risk calculation overhead
        }
        if (!decision.approved) {
            baseTime += 5; // Veto processing
        }
        return baseTime;
    }
    /**
     * Calculate risk level for a decision
     */
    calculateDecisionRiskLevel(decision) {
        if (!decision.risk.riskMetrics)
            return 'low';
        const leverage = decision.risk.riskMetrics.currentLeverage;
        const correlation = decision.risk.riskMetrics.correlation;
        if (leverage > 10 || correlation > 0.8)
            return 'high';
        if (leverage > 5 || correlation > 0.6)
            return 'medium';
        return 'low';
    }
    /**
     * Calculate impact score for a decision
     */
    calculateImpactScore(decision) {
        if (!decision.approved)
            return 0;
        const equity = this.brain.getEquity();
        if (equity === 0)
            return 0;
        return (decision.authorizedSize / equity) * 100;
    }
    /**
     * Get time since last profitable trade
     */
    async getTimeSinceLastProfit() {
        if (!this.db)
            return null;
        try {
            const result = await this.db.query(`SELECT MAX(timestamp) as last_profit_time 
         FROM phase_performance 
         WHERE pnl > 0 
         ORDER BY timestamp DESC 
         LIMIT 1`);
            if (result.rows.length > 0 && result.rows[0].last_profit_time) {
                return Date.now() - result.rows[0].last_profit_time;
            }
        }
        catch (error) {
            console.error('Error fetching last profit time:', error);
        }
        return null;
    }
}
exports.DashboardService = DashboardService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2ZXIvRGFzaGJvYXJkU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQWlGSDs7R0FFRztBQUNILE1BQU0sY0FBYyxHQUEyQjtJQUM3QyxRQUFRLEVBQUUsS0FBSyxFQUFFLFdBQVc7SUFDNUIsV0FBVyxFQUFFLEtBQUssRUFBRSxhQUFhO0lBQ2pDLGtCQUFrQixFQUFFLEVBQUU7SUFDdEIsT0FBTyxFQUFFLE9BQU87Q0FDakIsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBYSxnQkFBZ0I7SUFDVixNQUFNLENBQXlCO0lBQy9CLEtBQUssQ0FBYTtJQUNsQixFQUFFLENBQXlCO0lBQzNCLFNBQVMsQ0FBUztJQUVuQywrQkFBK0I7SUFDdkIsY0FBYyxHQUFpQyxJQUFJLENBQUM7SUFDcEQsa0JBQWtCLEdBQVcsQ0FBQyxDQUFDO0lBRXZDLGdDQUFnQztJQUN4QixRQUFRLEdBQTBCLElBQUksQ0FBQztJQUN2QyxZQUFZLEdBQVcsQ0FBQyxDQUFDO0lBRWpDLHdDQUF3QztJQUNoQyxlQUFlLEdBQWdELElBQUksR0FBRyxFQUFFLENBQUM7SUFFakYsWUFDRSxLQUFpQixFQUNqQixFQUFvQixFQUNwQixNQUF3QztRQUV4QyxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxjQUFjLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQztRQUMvQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsc0JBQXNCLENBQ3BCLFFBQWdCLEVBQ2hCLFFBQXdDO1FBRXhDLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFR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LElBQUksQ0FBQztRQUUxQixJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUNoQzs7OztpQkFJUyxDQUNWLENBQUM7WUFFRixJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7Z0JBQzlELE9BQU8sSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUM7WUFDdEQsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMzRCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUE5ZUQsNENBOGVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi9zcmMvc2VydmVyL0Rhc2hib2FyZFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEYXNoYm9hcmRTZXJ2aWNlIC0gQ29tcHJlaGVuc2l2ZSBkYXRhIGNvbGxlY3Rpb24gYW5kIGFnZ3JlZ2F0aW9uIGZvciBkYXNoYm9hcmRcbiAqIEhhbmRsZXMgTkFWIGNhbGN1bGF0aW9uLCBhbGxvY2F0aW9uIGZvcm1hdHRpbmcsIHJpc2sgbWV0cmljcywgYW5kIHRyZWFzdXJ5IHN0YXR1c1xuICogXG4gKiBSZXF1aXJlbWVudHM6IDEwLjIsIDEwLjMsIDEwLjQsIDEwLjUsIDEwLjYsIDEwLjcsIDEwLjhcbiAqL1xuXG5pbXBvcnQge1xuICBEYXNoYm9hcmREYXRhLFxuICBBbGxvY2F0aW9uVmVjdG9yLFxuICBQaGFzZUlkLFxuICBQaGFzZVBlcmZvcm1hbmNlLFxuICBUcmVhc3VyeVN0YXR1cyxcbiAgQnJlYWtlclN0YXR1cyxcbiAgQnJhaW5EZWNpc2lvbixcbiAgUmlza01ldHJpY3MsXG4gIFBvc2l0aW9uLFxufSBmcm9tICcuLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBUaXRhbkJyYWluIH0gZnJvbSAnLi4vZW5naW5lL1RpdGFuQnJhaW4uanMnO1xuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyIH0gZnJvbSAnLi4vZGIvRGF0YWJhc2VNYW5hZ2VyLmpzJztcblxuLyoqXG4gKiBFeHRlbmRlZCBkYXNoYm9hcmQgZGF0YSB3aXRoIGFkZGl0aW9uYWwgbWV0cmljc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4dGVuZGVkRGFzaGJvYXJkRGF0YSBleHRlbmRzIERhc2hib2FyZERhdGEge1xuICAvKiogVmVyc2lvbiBtZXRhZGF0YSAqL1xuICB2ZXJzaW9uOiBzdHJpbmc7XG4gIC8qKiBTeXN0ZW0gdXB0aW1lIGluIG1pbGxpc2Vjb25kcyAqL1xuICB1cHRpbWU6IG51bWJlcjtcbiAgLyoqIFBlcmZvcm1hbmNlIG1ldHJpY3MgcGVyIHBoYXNlICovXG4gIHBoYXNlUGVyZm9ybWFuY2U6IFBoYXNlUGVyZm9ybWFuY2VbXTtcbiAgLyoqIFNpZ25hbCBhcHByb3ZhbCByYXRlcyBwZXIgcGhhc2UgKi9cbiAgYXBwcm92YWxSYXRlczogUmVjb3JkPFBoYXNlSWQsIG51bWJlcj47XG4gIC8qKiBOZXh0IHN3ZWVwIHRyaWdnZXIgbGV2ZWwgKi9cbiAgbmV4dFN3ZWVwVHJpZ2dlckxldmVsOiBudW1iZXI7XG4gIC8qKiBUb3RhbCBhbW91bnQgc3dlcHQgdG8gc3BvdCB3YWxsZXQgKi9cbiAgdG90YWxTd2VwdDogbnVtYmVyO1xuICAvKiogSGlnaCB3YXRlcm1hcmsgdmFsdWUgKi9cbiAgaGlnaFdhdGVybWFyazogbnVtYmVyO1xuICAvKiogRGlzdGFuY2UgdG8gaGlnaCB3YXRlcm1hcmsgKGN1cnJlbnQgZHJhd2Rvd24pICovXG4gIGRyYXdkb3duRnJvbUhpZ2g6IG51bWJlcjtcbiAgLyoqIFRpbWUgc2luY2UgbGFzdCBwcm9maXRhYmxlIHRyYWRlICovXG4gIHRpbWVTaW5jZUxhc3RQcm9maXQ6IG51bWJlciB8IG51bGw7XG4gIC8qKiBDdXJyZW50IHBvc2l0aW9ucyBzdW1tYXJ5ICovXG4gIHBvc2l0aW9uc1N1bW1hcnk6IHtcbiAgICBjb3VudDogbnVtYmVyO1xuICAgIHRvdGFsTm90aW9uYWw6IG51bWJlcjtcbiAgICB0b3RhbFVucmVhbGl6ZWRQbkw6IG51bWJlcjtcbiAgfTtcbn1cblxuLyoqXG4gKiBXYWxsZXQgYmFsYW5jZSBpbmZvcm1hdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIFdhbGxldEJhbGFuY2Uge1xuICBleGNoYW5nZTogc3RyaW5nO1xuICB3YWxsZXRUeXBlOiAnc3BvdCcgfCAnZnV0dXJlcycgfCAnbWFyZ2luJztcbiAgYXNzZXQ6IHN0cmluZztcbiAgYmFsYW5jZTogbnVtYmVyO1xuICB1c2RWYWx1ZTogbnVtYmVyO1xufVxuXG4vKipcbiAqIE5BViBjYWxjdWxhdGlvbiByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBOQVZDYWxjdWxhdGlvbiB7XG4gIHRvdGFsTkFWOiBudW1iZXI7XG4gIHdhbGxldEJyZWFrZG93bjogV2FsbGV0QmFsYW5jZVtdO1xuICB1bnJlYWxpemVkUG5MOiBudW1iZXI7XG4gIGxhc3RVcGRhdGVkOiBudW1iZXI7XG59XG5cbi8qKlxuICogRGFzaGJvYXJkIHNlcnZpY2UgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIERhc2hib2FyZFNlcnZpY2VDb25maWcge1xuICAvKiogQ2FjaGUgVFRMIGZvciBkYXNoYm9hcmQgZGF0YSAobXMpICovXG4gIGNhY2hlVFRMOiBudW1iZXI7XG4gIC8qKiBDYWNoZSBUVEwgZm9yIE5BViBjYWxjdWxhdGlvbiAobXMpICovXG4gIG5hdkNhY2hlVFRMOiBudW1iZXI7XG4gIC8qKiBNYXhpbXVtIG51bWJlciBvZiByZWNlbnQgZGVjaXNpb25zIHRvIGluY2x1ZGUgKi9cbiAgbWF4UmVjZW50RGVjaXNpb25zOiBudW1iZXI7XG4gIC8qKiBTeXN0ZW0gdmVyc2lvbiAqL1xuICB2ZXJzaW9uOiBzdHJpbmc7XG59XG5cbi8qKlxuICogRGVmYXVsdCBjb25maWd1cmF0aW9uXG4gKi9cbmNvbnN0IERFRkFVTFRfQ09ORklHOiBEYXNoYm9hcmRTZXJ2aWNlQ29uZmlnID0ge1xuICBjYWNoZVRUTDogNjAwMDAsIC8vIDEgbWludXRlXG4gIG5hdkNhY2hlVFRMOiAzMDAwMCwgLy8gMzAgc2Vjb25kc1xuICBtYXhSZWNlbnREZWNpc2lvbnM6IDUwLFxuICB2ZXJzaW9uOiAnMS4wLjAnLFxufTtcblxuLyoqXG4gKiBEYXNoYm9hcmRTZXJ2aWNlIHByb3ZpZGVzIGNvbXByZWhlbnNpdmUgZGF0YSBhZ2dyZWdhdGlvbiBmb3IgdGhlIGRhc2hib2FyZFxuICovXG5leHBvcnQgY2xhc3MgRGFzaGJvYXJkU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBEYXNoYm9hcmRTZXJ2aWNlQ29uZmlnO1xuICBwcml2YXRlIHJlYWRvbmx5IGJyYWluOiBUaXRhbkJyYWluO1xuICBwcml2YXRlIHJlYWRvbmx5IGRiOiBEYXRhYmFzZU1hbmFnZXIgfCBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IHN0YXJ0VGltZTogbnVtYmVyO1xuXG4gIC8qKiBDYWNoZSBmb3IgZGFzaGJvYXJkIGRhdGEgKi9cbiAgcHJpdmF0ZSBkYXNoYm9hcmRDYWNoZTogRXh0ZW5kZWREYXNoYm9hcmREYXRhIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGFzaGJvYXJkQ2FjaGVUaW1lOiBudW1iZXIgPSAwO1xuXG4gIC8qKiBDYWNoZSBmb3IgTkFWIGNhbGN1bGF0aW9uICovXG4gIHByaXZhdGUgbmF2Q2FjaGU6IE5BVkNhbGN1bGF0aW9uIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbmF2Q2FjaGVUaW1lOiBudW1iZXIgPSAwO1xuXG4gIC8qKiBFeHRlcm5hbCB3YWxsZXQgYmFsYW5jZSBwcm92aWRlcnMgKi9cbiAgcHJpdmF0ZSB3YWxsZXRQcm92aWRlcnM6IE1hcDxzdHJpbmcsICgpID0+IFByb21pc2U8V2FsbGV0QmFsYW5jZVtdPj4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYnJhaW46IFRpdGFuQnJhaW4sXG4gICAgZGI/OiBEYXRhYmFzZU1hbmFnZXIsXG4gICAgY29uZmlnPzogUGFydGlhbDxEYXNoYm9hcmRTZXJ2aWNlQ29uZmlnPlxuICApIHtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLmNvbmZpZyB9O1xuICAgIHRoaXMuYnJhaW4gPSBicmFpbjtcbiAgICB0aGlzLmRiID0gZGIgPz8gbnVsbDtcbiAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSB3YWxsZXQgYmFsYW5jZSBwcm92aWRlclxuICAgKiBcbiAgICogQHBhcmFtIGV4Y2hhbmdlIC0gRXhjaGFuZ2UgbmFtZSAoZS5nLiwgJ2J5Yml0JywgJ2JpbmFuY2UnKVxuICAgKiBAcGFyYW0gcHJvdmlkZXIgLSBGdW5jdGlvbiB0aGF0IHJldHVybnMgd2FsbGV0IGJhbGFuY2VzXG4gICAqL1xuICByZWdpc3RlcldhbGxldFByb3ZpZGVyKFxuICAgIGV4Y2hhbmdlOiBzdHJpbmcsXG4gICAgcHJvdmlkZXI6ICgpID0+IFByb21pc2U8V2FsbGV0QmFsYW5jZVtdPlxuICApOiB2b2lkIHtcbiAgICB0aGlzLndhbGxldFByb3ZpZGVycy5zZXQoZXhjaGFuZ2UsIHByb3ZpZGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgTkFWIGZyb20gYWxsIHdhbGxldHNcbiAgICogUmVxdWlyZW1lbnQgMTAuMjogSW1wbGVtZW50IE5BViBjYWxjdWxhdGlvbiBmcm9tIGFsbCB3YWxsZXRzXG4gICAqIFxuICAgKiBAcmV0dXJucyBOQVYgY2FsY3VsYXRpb24gd2l0aCB3YWxsZXQgYnJlYWtkb3duXG4gICAqL1xuICBhc3luYyBjYWxjdWxhdGVOQVYoKTogUHJvbWlzZTxOQVZDYWxjdWxhdGlvbj4ge1xuICAgIC8vIENoZWNrIGNhY2hlXG4gICAgaWYgKFxuICAgICAgdGhpcy5uYXZDYWNoZSAmJlxuICAgICAgRGF0ZS5ub3coKSAtIHRoaXMubmF2Q2FjaGVUaW1lIDwgdGhpcy5jb25maWcubmF2Q2FjaGVUVExcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLm5hdkNhY2hlO1xuICAgIH1cblxuICAgIGNvbnN0IHdhbGxldEJyZWFrZG93bjogV2FsbGV0QmFsYW5jZVtdID0gW107XG4gICAgbGV0IHRvdGFsTkFWID0gMDtcbiAgICBsZXQgdW5yZWFsaXplZFBuTCA9IDA7XG5cbiAgICAvLyBDb2xsZWN0IGJhbGFuY2VzIGZyb20gYWxsIHJlZ2lzdGVyZWQgcHJvdmlkZXJzXG4gICAgZm9yIChjb25zdCBbZXhjaGFuZ2UsIHByb3ZpZGVyXSBvZiB0aGlzLndhbGxldFByb3ZpZGVycykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYmFsYW5jZXMgPSBhd2FpdCBwcm92aWRlcigpO1xuICAgICAgICB3YWxsZXRCcmVha2Rvd24ucHVzaCguLi5iYWxhbmNlcyk7XG4gICAgICAgIFxuICAgICAgICAvLyBTdW0gVVNEIHZhbHVlc1xuICAgICAgICBmb3IgKGNvbnN0IGJhbGFuY2Ugb2YgYmFsYW5jZXMpIHtcbiAgICAgICAgICB0b3RhbE5BViArPSBiYWxhbmNlLnVzZFZhbHVlO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmZXRjaGluZyBiYWxhbmNlcyBmcm9tICR7ZXhjaGFuZ2V9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgdW5yZWFsaXplZCBQbkwgZnJvbSBjdXJyZW50IHBvc2l0aW9uc1xuICAgIGNvbnN0IHBvc2l0aW9ucyA9IHRoaXMuYnJhaW4uZ2V0UG9zaXRpb25zKCk7XG4gICAgZm9yIChjb25zdCBwb3NpdGlvbiBvZiBwb3NpdGlvbnMpIHtcbiAgICAgIGlmIChwb3NpdGlvbi51bnJlYWxpemVkUG5MKSB7XG4gICAgICAgIHVucmVhbGl6ZWRQbkwgKz0gcG9zaXRpb24udW5yZWFsaXplZFBuTDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0b3RhbE5BViArPSB1bnJlYWxpemVkUG5MO1xuXG4gICAgY29uc3QgcmVzdWx0OiBOQVZDYWxjdWxhdGlvbiA9IHtcbiAgICAgIHRvdGFsTkFWLFxuICAgICAgd2FsbGV0QnJlYWtkb3duLFxuICAgICAgdW5yZWFsaXplZFBuTCxcbiAgICAgIGxhc3RVcGRhdGVkOiBEYXRlLm5vdygpLFxuICAgIH07XG5cbiAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgdGhpcy5uYXZDYWNoZSA9IHJlc3VsdDtcbiAgICB0aGlzLm5hdkNhY2hlVGltZSA9IERhdGUubm93KCk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBhbGxvY2F0aW9uIHZlY3RvciB3aXRoIG1ldGFkYXRhXG4gICAqIFJlcXVpcmVtZW50IDEwLjM6IEltcGxlbWVudCBhbGxvY2F0aW9uIHZlY3RvciBmb3JtYXR0aW5nXG4gICAqIFxuICAgKiBAcGFyYW0gYWxsb2NhdGlvbiAtIFJhdyBhbGxvY2F0aW9uIHZlY3RvclxuICAgKiBAcGFyYW0gZXF1aXR5IC0gQ3VycmVudCBlcXVpdHlcbiAgICogQHJldHVybnMgRm9ybWF0dGVkIGFsbG9jYXRpb24gZGF0YVxuICAgKi9cbiAgZm9ybWF0QWxsb2NhdGlvbihhbGxvY2F0aW9uOiBBbGxvY2F0aW9uVmVjdG9yLCBlcXVpdHk6IG51bWJlcikge1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3I6IGFsbG9jYXRpb24sXG4gICAgICBwaGFzZUVxdWl0eToge1xuICAgICAgICBwaGFzZTE6IHtcbiAgICAgICAgICB3ZWlnaHQ6IGFsbG9jYXRpb24udzEsXG4gICAgICAgICAgZXF1aXR5OiBlcXVpdHkgKiBhbGxvY2F0aW9uLncxLFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IChhbGxvY2F0aW9uLncxICogMTAwKS50b0ZpeGVkKDIpICsgJyUnLFxuICAgICAgICB9LFxuICAgICAgICBwaGFzZTI6IHtcbiAgICAgICAgICB3ZWlnaHQ6IGFsbG9jYXRpb24udzIsXG4gICAgICAgICAgZXF1aXR5OiBlcXVpdHkgKiBhbGxvY2F0aW9uLncyLFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IChhbGxvY2F0aW9uLncyICogMTAwKS50b0ZpeGVkKDIpICsgJyUnLFxuICAgICAgICB9LFxuICAgICAgICBwaGFzZTM6IHtcbiAgICAgICAgICB3ZWlnaHQ6IGFsbG9jYXRpb24udzMsXG4gICAgICAgICAgZXF1aXR5OiBlcXVpdHkgKiBhbGxvY2F0aW9uLnczLFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IChhbGxvY2F0aW9uLnczICogMTAwKS50b0ZpeGVkKDIpICsgJyUnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHRvdGFsRXF1aXR5OiBlcXVpdHksXG4gICAgICBsYXN0VXBkYXRlZDogYWxsb2NhdGlvbi50aW1lc3RhbXAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcGhhc2UgZXF1aXR5IGZvciBlYWNoIHBoYXNlXG4gICAqIFJlcXVpcmVtZW50IDEwLjQ6IEltcGxlbWVudCBwaGFzZSBlcXVpdHkgY2FsY3VsYXRpb25cbiAgICogXG4gICAqIEBwYXJhbSBhbGxvY2F0aW9uIC0gQWxsb2NhdGlvbiB2ZWN0b3JcbiAgICogQHBhcmFtIGVxdWl0eSAtIFRvdGFsIGVxdWl0eVxuICAgKiBAcmV0dXJucyBQaGFzZSBlcXVpdHkgYnJlYWtkb3duXG4gICAqL1xuICBjYWxjdWxhdGVQaGFzZUVxdWl0eShcbiAgICBhbGxvY2F0aW9uOiBBbGxvY2F0aW9uVmVjdG9yLFxuICAgIGVxdWl0eTogbnVtYmVyXG4gICk6IFJlY29yZDxQaGFzZUlkLCBudW1iZXI+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcGhhc2UxOiBlcXVpdHkgKiBhbGxvY2F0aW9uLncxLFxuICAgICAgcGhhc2UyOiBlcXVpdHkgKiBhbGxvY2F0aW9uLncyLFxuICAgICAgcGhhc2UzOiBlcXVpdHkgKiBhbGxvY2F0aW9uLnczLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQWdncmVnYXRlIHJpc2sgbWV0cmljcyB3aXRoIGFkZGl0aW9uYWwgY2FsY3VsYXRpb25zXG4gICAqIFJlcXVpcmVtZW50IDEwLjU6IEltcGxlbWVudCByaXNrIG1ldHJpY3MgYWdncmVnYXRpb25cbiAgICogXG4gICAqIEBwYXJhbSBwb3NpdGlvbnMgLSBDdXJyZW50IHBvc2l0aW9uc1xuICAgKiBAcmV0dXJucyBBZ2dyZWdhdGVkIHJpc2sgbWV0cmljc1xuICAgKi9cbiAgYXN5bmMgYWdncmVnYXRlUmlza01ldHJpY3MocG9zaXRpb25zOiBQb3NpdGlvbltdKSB7XG4gICAgLy8gR2V0IHJpc2sgbWV0cmljcyBmcm9tIHRoZSBicmFpbidzIGludGVybmFsIHJpc2sgZ3VhcmRpYW5cbiAgICAvLyBTaW5jZSB3ZSBkb24ndCBoYXZlIGRpcmVjdCBhY2Nlc3MsIHdlJ2xsIGNhbGN1bGF0ZSB0aGVtIGhlcmVcbiAgICBjb25zdCBiYXNlTWV0cmljczogUmlza01ldHJpY3MgPSB7XG4gICAgICBjdXJyZW50TGV2ZXJhZ2U6IDAsXG4gICAgICBwcm9qZWN0ZWRMZXZlcmFnZTogMCxcbiAgICAgIGNvcnJlbGF0aW9uOiAwLFxuICAgICAgcG9ydGZvbGlvRGVsdGE6IDAsXG4gICAgICBwb3J0Zm9saW9CZXRhOiAwLFxuICAgIH07XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGFkZGl0aW9uYWwgbWV0cmljc1xuICAgIGNvbnN0IHBvc2l0aW9uQ291bnQgPSBwb3NpdGlvbnMubGVuZ3RoO1xuICAgIGNvbnN0IHRvdGFsTm90aW9uYWwgPSBwb3NpdGlvbnMucmVkdWNlKChzdW0sIHBvcykgPT4gc3VtICsgTWF0aC5hYnMocG9zLnNpemUpLCAwKTtcbiAgICBjb25zdCB0b3RhbFVucmVhbGl6ZWRQbkwgPSBwb3NpdGlvbnMucmVkdWNlKChzdW0sIHBvcykgPT4gc3VtICsgKHBvcy51bnJlYWxpemVkUG5MID8/IDApLCAwKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgY29ycmVsYXRpb24gbWF0cml4IGZvciBhbGwgcG9zaXRpb25zXG4gICAgY29uc3QgY29ycmVsYXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiA9IHt9O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zaXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCBwb3NpdGlvbnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3Qgc3ltYm9sQSA9IHBvc2l0aW9uc1tpXS5zeW1ib2w7XG4gICAgICAgIGNvbnN0IHN5bWJvbEIgPSBwb3NpdGlvbnNbal0uc3ltYm9sO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFjb3JyZWxhdGlvbnNbc3ltYm9sQV0pIGNvcnJlbGF0aW9uc1tzeW1ib2xBXSA9IHt9O1xuICAgICAgICBpZiAoIWNvcnJlbGF0aW9uc1tzeW1ib2xCXSkgY29ycmVsYXRpb25zW3N5bWJvbEJdID0ge307XG4gICAgICAgIFxuICAgICAgICAvLyBGb3Igbm93LCB1c2UgYSBwbGFjZWhvbGRlciBjb3JyZWxhdGlvbiBjYWxjdWxhdGlvblxuICAgICAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgYWNjZXNzIHRoZSByaXNrIGd1YXJkaWFuJ3MgY29ycmVsYXRpb24gZGF0YVxuICAgICAgICBjb25zdCBjb3JyZWxhdGlvbiA9IDAuNTtcbiAgICAgICAgY29ycmVsYXRpb25zW3N5bWJvbEFdW3N5bWJvbEJdID0gY29ycmVsYXRpb247XG4gICAgICAgIGNvcnJlbGF0aW9uc1tzeW1ib2xCXVtzeW1ib2xBXSA9IGNvcnJlbGF0aW9uO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAuLi5iYXNlTWV0cmljcyxcbiAgICAgIHBvc2l0aW9uQ291bnQsXG4gICAgICB0b3RhbE5vdGlvbmFsLFxuICAgICAgdG90YWxVbnJlYWxpemVkUG5MLFxuICAgICAgY29ycmVsYXRpb25NYXRyaXg6IGNvcnJlbGF0aW9ucyxcbiAgICAgIHJpc2tTY29yZTogdGhpcy5jYWxjdWxhdGVSaXNrU2NvcmUoYmFzZU1ldHJpY3MsIHBvc2l0aW9uQ291bnQsIHRvdGFsTm90aW9uYWwpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQWdncmVnYXRlIHRyZWFzdXJ5IHN0YXR1cyB3aXRoIGFkZGl0aW9uYWwgbWV0cmljc1xuICAgKiBSZXF1aXJlbWVudCAxMC42OiBJbXBsZW1lbnQgdHJlYXN1cnkgc3RhdHVzIGFnZ3JlZ2F0aW9uXG4gICAqIFxuICAgKiBAcmV0dXJucyBFbmhhbmNlZCB0cmVhc3VyeSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGFnZ3JlZ2F0ZVRyZWFzdXJ5U3RhdHVzKCkge1xuICAgIGNvbnN0IHRyZWFzdXJ5ID0gYXdhaXQgdGhpcy5icmFpbi5nZXRUcmVhc3VyeVN0YXR1cygpO1xuICAgIGNvbnN0IG5leHRTd2VlcExldmVsID0gdGhpcy5icmFpbi5nZXROZXh0U3dlZXBUcmlnZ2VyTGV2ZWwoKTtcbiAgICBjb25zdCB0b3RhbFN3ZXB0ID0gdGhpcy5icmFpbi5nZXRUb3RhbFN3ZXB0KCk7XG4gICAgY29uc3QgaGlnaFdhdGVybWFyayA9IHRoaXMuYnJhaW4uZ2V0SGlnaFdhdGVybWFyaygpO1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBhZGRpdGlvbmFsIG1ldHJpY3NcbiAgICBjb25zdCBjdXJyZW50RXF1aXR5ID0gdGhpcy5icmFpbi5nZXRFcXVpdHkoKTtcbiAgICBjb25zdCB0b3RhbEVxdWl0eSA9IHRyZWFzdXJ5LmZ1dHVyZXNXYWxsZXQgKyB0cmVhc3VyeS5zcG90V2FsbGV0O1xuICAgIGNvbnN0IGRyYXdkb3duRnJvbUhpZ2ggPSBoaWdoV2F0ZXJtYXJrID4gMCA/IChoaWdoV2F0ZXJtYXJrIC0gY3VycmVudEVxdWl0eSkgLyBoaWdoV2F0ZXJtYXJrIDogMDtcbiAgICBjb25zdCBzd2VlcFByb2dyZXNzID0gbmV4dFN3ZWVwTGV2ZWwgPiAwID8gTWF0aC5taW4odHJlYXN1cnkuZnV0dXJlc1dhbGxldCAvIG5leHRTd2VlcExldmVsLCAxKSA6IDA7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRyZWFzdXJ5LFxuICAgICAgbmV4dFN3ZWVwVHJpZ2dlckxldmVsOiBuZXh0U3dlZXBMZXZlbCxcbiAgICAgIHRvdGFsU3dlcHQsXG4gICAgICBoaWdoV2F0ZXJtYXJrLFxuICAgICAgZHJhd2Rvd25Gcm9tSGlnaCxcbiAgICAgIHN3ZWVwUHJvZ3Jlc3MsXG4gICAgICByaXNrQ2FwaXRhbFJhdGlvOiB0b3RhbEVxdWl0eSA+IDAgPyB0cmVhc3VyeS5yaXNrQ2FwaXRhbCAvIHRvdGFsRXF1aXR5IDogMCxcbiAgICAgIGxvY2tlZFByb2ZpdFJhdGlvOiB0b3RhbEVxdWl0eSA+IDAgPyB0cmVhc3VyeS5sb2NrZWRQcm9maXQgLyB0b3RhbEVxdWl0eSA6IDAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSByZWNlbnQgZGVjaXNpb25zIHdpdGggZmlsdGVyaW5nXG4gICAqIFJlcXVpcmVtZW50IDEwLjc6IEltcGxlbWVudCByZWNlbnQgZGVjaXNpb25zIHJldHJpZXZhbFxuICAgKiBcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2YgZGVjaXNpb25zXG4gICAqIEBwYXJhbSBwaGFzZUZpbHRlciAtIE9wdGlvbmFsIHBoYXNlIGZpbHRlclxuICAgKiBAcmV0dXJucyBSZWNlbnQgZGVjaXNpb25zIHdpdGggbWV0YWRhdGFcbiAgICovXG4gIGFzeW5jIGdldFJlY2VudERlY2lzaW9ucyhcbiAgICBsaW1pdDogbnVtYmVyID0gdGhpcy5jb25maWcubWF4UmVjZW50RGVjaXNpb25zLFxuICAgIHBoYXNlRmlsdGVyPzogUGhhc2VJZFxuICApIHtcbiAgICBsZXQgZGVjaXNpb25zID0gdGhpcy5icmFpbi5nZXRSZWNlbnREZWNpc2lvbnMobGltaXQpO1xuICAgIFxuICAgIC8vIEFwcGx5IHBoYXNlIGZpbHRlciBpZiBzcGVjaWZpZWRcbiAgICBpZiAocGhhc2VGaWx0ZXIpIHtcbiAgICAgIGRlY2lzaW9ucyA9IGRlY2lzaW9ucy5maWx0ZXIoZCA9PiBcbiAgICAgICAgZC5hbGxvY2F0aW9uICYmIHRoaXMuZ2V0UGhhc2VGcm9tRGVjaXNpb24oZCkgPT09IHBoYXNlRmlsdGVyXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZCBtZXRhZGF0YSB0byBlYWNoIGRlY2lzaW9uXG4gICAgY29uc3QgZW5oYW5jZWREZWNpc2lvbnMgPSBkZWNpc2lvbnMubWFwKGRlY2lzaW9uID0+ICh7XG4gICAgICAuLi5kZWNpc2lvbixcbiAgICAgIHByb2Nlc3NpbmdUaW1lOiB0aGlzLmVzdGltYXRlUHJvY2Vzc2luZ1RpbWUoZGVjaXNpb24pLFxuICAgICAgcmlza0xldmVsOiB0aGlzLmNhbGN1bGF0ZURlY2lzaW9uUmlza0xldmVsKGRlY2lzaW9uKSxcbiAgICAgIGltcGFjdFNjb3JlOiB0aGlzLmNhbGN1bGF0ZUltcGFjdFNjb3JlKGRlY2lzaW9uKSxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGVjaXNpb25zOiBlbmhhbmNlZERlY2lzaW9ucyxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgdG90YWw6IGVuaGFuY2VkRGVjaXNpb25zLmxlbmd0aCxcbiAgICAgICAgYXBwcm92ZWQ6IGVuaGFuY2VkRGVjaXNpb25zLmZpbHRlcihkID0+IGQuYXBwcm92ZWQpLmxlbmd0aCxcbiAgICAgICAgcmVqZWN0ZWQ6IGVuaGFuY2VkRGVjaXNpb25zLmZpbHRlcihkID0+ICFkLmFwcHJvdmVkKS5sZW5ndGgsXG4gICAgICAgIGFwcHJvdmFsUmF0ZTogZW5oYW5jZWREZWNpc2lvbnMubGVuZ3RoID4gMCBcbiAgICAgICAgICA/IGVuaGFuY2VkRGVjaXNpb25zLmZpbHRlcihkID0+IGQuYXBwcm92ZWQpLmxlbmd0aCAvIGVuaGFuY2VkRGVjaXNpb25zLmxlbmd0aCBcbiAgICAgICAgICA6IDAsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbXByZWhlbnNpdmUgZGFzaGJvYXJkIGRhdGFcbiAgICogQWdncmVnYXRlcyBhbGwgZGFzaGJvYXJkIGNvbXBvbmVudHNcbiAgICogXG4gICAqIEByZXR1cm5zIEV4dGVuZGVkIGRhc2hib2FyZCBkYXRhXG4gICAqL1xuICBhc3luYyBnZXREYXNoYm9hcmREYXRhKCk6IFByb21pc2U8RXh0ZW5kZWREYXNoYm9hcmREYXRhPiB7XG4gICAgLy8gQ2hlY2sgY2FjaGVcbiAgICBpZiAoXG4gICAgICB0aGlzLmRhc2hib2FyZENhY2hlICYmXG4gICAgICBEYXRlLm5vdygpIC0gdGhpcy5kYXNoYm9hcmRDYWNoZVRpbWUgPCB0aGlzLmNvbmZpZy5jYWNoZVRUTFxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuZGFzaGJvYXJkQ2FjaGU7XG4gICAgfVxuXG4gICAgLy8gR2V0IGJhc2UgZGFzaGJvYXJkIGRhdGEgZnJvbSBicmFpblxuICAgIGNvbnN0IGJhc2VEYXNoYm9hcmQgPSBhd2FpdCB0aGlzLmJyYWluLmdldERhc2hib2FyZERhdGEoKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgTkFWXG4gICAgY29uc3QgbmF2Q2FsY3VsYXRpb24gPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZU5BVigpO1xuICAgIFxuICAgIC8vIEdldCBlbmhhbmNlZCBtZXRyaWNzXG4gICAgY29uc3QgcGhhc2VQZXJmb3JtYW5jZSA9IGF3YWl0IHRoaXMuYnJhaW4uZ2V0QWxsUGhhc2VQZXJmb3JtYW5jZSgpO1xuICAgIGNvbnN0IGFwcHJvdmFsUmF0ZXMgPSB0aGlzLmJyYWluLmdldEFsbEFwcHJvdmFsUmF0ZXMoKTtcbiAgICBjb25zdCBlbmhhbmNlZFRyZWFzdXJ5ID0gYXdhaXQgdGhpcy5hZ2dyZWdhdGVUcmVhc3VyeVN0YXR1cygpO1xuICAgIGNvbnN0IGVuaGFuY2VkRGVjaXNpb25zID0gYXdhaXQgdGhpcy5nZXRSZWNlbnREZWNpc2lvbnMoKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgYWRkaXRpb25hbCBtZXRyaWNzXG4gICAgY29uc3QgcG9zaXRpb25zID0gdGhpcy5icmFpbi5nZXRQb3NpdGlvbnMoKTtcbiAgICBjb25zdCBwb3NpdGlvbnNTdW1tYXJ5ID0ge1xuICAgICAgY291bnQ6IHBvc2l0aW9ucy5sZW5ndGgsXG4gICAgICB0b3RhbE5vdGlvbmFsOiBwb3NpdGlvbnMucmVkdWNlKChzdW0sIHBvcykgPT4gc3VtICsgTWF0aC5hYnMocG9zLnNpemUpLCAwKSxcbiAgICAgIHRvdGFsVW5yZWFsaXplZFBuTDogcG9zaXRpb25zLnJlZHVjZSgoc3VtLCBwb3MpID0+IHN1bSArIChwb3MudW5yZWFsaXplZFBuTCA/PyAwKSwgMCksXG4gICAgfTtcblxuICAgIC8vIENhbGN1bGF0ZSB0aW1lIHNpbmNlIGxhc3QgcHJvZml0YWJsZSB0cmFkZVxuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RQcm9maXQgPSBhd2FpdCB0aGlzLmdldFRpbWVTaW5jZUxhc3RQcm9maXQoKTtcblxuICAgIGNvbnN0IGV4dGVuZGVkRGF0YTogRXh0ZW5kZWREYXNoYm9hcmREYXRhID0ge1xuICAgICAgLi4uYmFzZURhc2hib2FyZCxcbiAgICAgIG5hdjogbmF2Q2FsY3VsYXRpb24udG90YWxOQVYsXG4gICAgICB2ZXJzaW9uOiB0aGlzLmNvbmZpZy52ZXJzaW9uLFxuICAgICAgdXB0aW1lOiBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWUsXG4gICAgICBwaGFzZVBlcmZvcm1hbmNlLFxuICAgICAgYXBwcm92YWxSYXRlcyxcbiAgICAgIG5leHRTd2VlcFRyaWdnZXJMZXZlbDogZW5oYW5jZWRUcmVhc3VyeS5uZXh0U3dlZXBUcmlnZ2VyTGV2ZWwsXG4gICAgICB0b3RhbFN3ZXB0OiBlbmhhbmNlZFRyZWFzdXJ5LnRvdGFsU3dlcHQsXG4gICAgICBoaWdoV2F0ZXJtYXJrOiBlbmhhbmNlZFRyZWFzdXJ5LmhpZ2hXYXRlcm1hcmssXG4gICAgICBkcmF3ZG93bkZyb21IaWdoOiBlbmhhbmNlZFRyZWFzdXJ5LmRyYXdkb3duRnJvbUhpZ2gsXG4gICAgICB0aW1lU2luY2VMYXN0UHJvZml0LFxuICAgICAgcG9zaXRpb25zU3VtbWFyeSxcbiAgICAgIHRyZWFzdXJ5OiBlbmhhbmNlZFRyZWFzdXJ5LFxuICAgICAgcmVjZW50RGVjaXNpb25zOiBlbmhhbmNlZERlY2lzaW9ucy5kZWNpc2lvbnMsXG4gICAgfTtcblxuICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICB0aGlzLmRhc2hib2FyZENhY2hlID0gZXh0ZW5kZWREYXRhO1xuICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGVUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIHJldHVybiBleHRlbmRlZERhdGE7XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGRhc2hib2FyZCBkYXRhIHRvIEpTT04gd2l0aCBtZXRhZGF0YVxuICAgKiBSZXF1aXJlbWVudCAxMC44OiBDcmVhdGUgZXhwb3J0IGVuZHBvaW50IGZvciBkYXNoYm9hcmQgZGF0YVxuICAgKiBcbiAgICogQHJldHVybnMgSlNPTiBzdHJpbmcgd2l0aCB0aW1lc3RhbXAgYW5kIHZlcnNpb24gbWV0YWRhdGFcbiAgICovXG4gIGFzeW5jIGV4cG9ydERhc2hib2FyZEpTT04oKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBkYXNoYm9hcmREYXRhID0gYXdhaXQgdGhpcy5nZXREYXNoYm9hcmREYXRhKCk7XG4gICAgXG4gICAgY29uc3QgZXhwb3J0RGF0YSA9IHtcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGV4cG9ydGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdmVyc2lvbjogdGhpcy5jb25maWcudmVyc2lvbixcbiAgICAgICAgc291cmNlOiAndGl0YW4tYnJhaW4tZGFzaGJvYXJkLXNlcnZpY2UnLFxuICAgICAgfSxcbiAgICAgIGRhdGE6IGRhc2hib2FyZERhdGEsXG4gICAgfTtcblxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShleHBvcnREYXRhLCBudWxsLCAyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgY2FjaGVzXG4gICAqL1xuICBjbGVhckNhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGUgPSBudWxsO1xuICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGVUaW1lID0gMDtcbiAgICB0aGlzLm5hdkNhY2hlID0gbnVsbDtcbiAgICB0aGlzLm5hdkNhY2hlVGltZSA9IDA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIHN0YXR1c1xuICAgKi9cbiAgZ2V0Q2FjaGVTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhc2hib2FyZDoge1xuICAgICAgICBjYWNoZWQ6IHRoaXMuZGFzaGJvYXJkQ2FjaGUgIT09IG51bGwsXG4gICAgICAgIGFnZTogdGhpcy5kYXNoYm9hcmRDYWNoZSA/IERhdGUubm93KCkgLSB0aGlzLmRhc2hib2FyZENhY2hlVGltZSA6IDAsXG4gICAgICAgIHR0bDogdGhpcy5jb25maWcuY2FjaGVUVEwsXG4gICAgICB9LFxuICAgICAgbmF2OiB7XG4gICAgICAgIGNhY2hlZDogdGhpcy5uYXZDYWNoZSAhPT0gbnVsbCxcbiAgICAgICAgYWdlOiB0aGlzLm5hdkNhY2hlID8gRGF0ZS5ub3coKSAtIHRoaXMubmF2Q2FjaGVUaW1lIDogMCxcbiAgICAgICAgdHRsOiB0aGlzLmNvbmZpZy5uYXZDYWNoZVRUTCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PSBQcml2YXRlIEhlbHBlciBNZXRob2RzID09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgb3ZlcmFsbCByaXNrIHNjb3JlXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVJpc2tTY29yZShcbiAgICBtZXRyaWNzOiBSaXNrTWV0cmljcyxcbiAgICBwb3NpdGlvbkNvdW50OiBudW1iZXIsXG4gICAgdG90YWxOb3Rpb25hbDogbnVtYmVyXG4gICk6IG51bWJlciB7XG4gICAgLy8gU2ltcGxlIHJpc2sgc2NvcmluZyBhbGdvcml0aG0gKDAtMTAwKVxuICAgIGxldCBzY29yZSA9IDA7XG4gICAgXG4gICAgLy8gTGV2ZXJhZ2UgY29tcG9uZW50ICgwLTQwIHBvaW50cylcbiAgICBzY29yZSArPSBNYXRoLm1pbihtZXRyaWNzLmN1cnJlbnRMZXZlcmFnZSAqIDIsIDQwKTtcbiAgICBcbiAgICAvLyBDb3JyZWxhdGlvbiBjb21wb25lbnQgKDAtMzAgcG9pbnRzKVxuICAgIHNjb3JlICs9IG1ldHJpY3MuY29ycmVsYXRpb24gKiAzMDtcbiAgICBcbiAgICAvLyBQb3NpdGlvbiBjb3VudCBjb21wb25lbnQgKDAtMjAgcG9pbnRzKVxuICAgIHNjb3JlICs9IE1hdGgubWluKHBvc2l0aW9uQ291bnQgKiAyLCAyMCk7XG4gICAgXG4gICAgLy8gTm90aW9uYWwgc2l6ZSBjb21wb25lbnQgKDAtMTAgcG9pbnRzKVxuICAgIGNvbnN0IGVxdWl0eSA9IHRoaXMuYnJhaW4uZ2V0RXF1aXR5KCk7XG4gICAgaWYgKGVxdWl0eSA+IDApIHtcbiAgICAgIGNvbnN0IG5vdGlvbmFsUmF0aW8gPSB0b3RhbE5vdGlvbmFsIC8gZXF1aXR5O1xuICAgICAgc2NvcmUgKz0gTWF0aC5taW4obm90aW9uYWxSYXRpbyAqIDUsIDEwKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCAxMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwaGFzZSBmcm9tIGRlY2lzaW9uIChoZWxwZXIgbWV0aG9kKVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRQaGFzZUZyb21EZWNpc2lvbihkZWNpc2lvbjogQnJhaW5EZWNpc2lvbik6IFBoYXNlSWQgfCBudWxsIHtcbiAgICAvLyBUaGlzIHdvdWxkIG5lZWQgdG8gYmUgaW1wbGVtZW50ZWQgYmFzZWQgb24gaG93IHBoYXNlIGluZm8gaXMgc3RvcmVkIGluIGRlY2lzaW9uc1xuICAgIC8vIEZvciBub3csIHJldHVybiBudWxsIGFzIHdlIGRvbid0IGhhdmUgdGhpcyBpbmZvIGluIHRoZSBjdXJyZW50IHN0cnVjdHVyZVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEVzdGltYXRlIHByb2Nlc3NpbmcgdGltZSBmb3IgYSBkZWNpc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBlc3RpbWF0ZVByb2Nlc3NpbmdUaW1lKGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uKTogbnVtYmVyIHtcbiAgICAvLyBTaW1wbGUgZXN0aW1hdGlvbiBiYXNlZCBvbiBkZWNpc2lvbiBjb21wbGV4aXR5XG4gICAgbGV0IGJhc2VUaW1lID0gMTA7IC8vIEJhc2UgMTBtc1xuICAgIFxuICAgIGlmIChkZWNpc2lvbi5yaXNrLnJpc2tNZXRyaWNzKSB7XG4gICAgICBiYXNlVGltZSArPSAyMDsgLy8gUmlzayBjYWxjdWxhdGlvbiBvdmVyaGVhZFxuICAgIH1cbiAgICBcbiAgICBpZiAoIWRlY2lzaW9uLmFwcHJvdmVkKSB7XG4gICAgICBiYXNlVGltZSArPSA1OyAvLyBWZXRvIHByb2Nlc3NpbmdcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGJhc2VUaW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSByaXNrIGxldmVsIGZvciBhIGRlY2lzaW9uXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZURlY2lzaW9uUmlza0xldmVsKGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uKTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB7XG4gICAgaWYgKCFkZWNpc2lvbi5yaXNrLnJpc2tNZXRyaWNzKSByZXR1cm4gJ2xvdyc7XG4gICAgXG4gICAgY29uc3QgbGV2ZXJhZ2UgPSBkZWNpc2lvbi5yaXNrLnJpc2tNZXRyaWNzLmN1cnJlbnRMZXZlcmFnZTtcbiAgICBjb25zdCBjb3JyZWxhdGlvbiA9IGRlY2lzaW9uLnJpc2sucmlza01ldHJpY3MuY29ycmVsYXRpb247XG4gICAgXG4gICAgaWYgKGxldmVyYWdlID4gMTAgfHwgY29ycmVsYXRpb24gPiAwLjgpIHJldHVybiAnaGlnaCc7XG4gICAgaWYgKGxldmVyYWdlID4gNSB8fCBjb3JyZWxhdGlvbiA+IDAuNikgcmV0dXJuICdtZWRpdW0nO1xuICAgIHJldHVybiAnbG93JztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgaW1wYWN0IHNjb3JlIGZvciBhIGRlY2lzaW9uXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUltcGFjdFNjb3JlKGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uKTogbnVtYmVyIHtcbiAgICBpZiAoIWRlY2lzaW9uLmFwcHJvdmVkKSByZXR1cm4gMDtcbiAgICBcbiAgICBjb25zdCBlcXVpdHkgPSB0aGlzLmJyYWluLmdldEVxdWl0eSgpO1xuICAgIGlmIChlcXVpdHkgPT09IDApIHJldHVybiAwO1xuICAgIFxuICAgIHJldHVybiAoZGVjaXNpb24uYXV0aG9yaXplZFNpemUgLyBlcXVpdHkpICogMTAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aW1lIHNpbmNlIGxhc3QgcHJvZml0YWJsZSB0cmFkZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRUaW1lU2luY2VMYXN0UHJvZml0KCk6IFByb21pc2U8bnVtYmVyIHwgbnVsbD4ge1xuICAgIGlmICghdGhpcy5kYikgcmV0dXJuIG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICAgYFNFTEVDVCBNQVgodGltZXN0YW1wKSBhcyBsYXN0X3Byb2ZpdF90aW1lIFxuICAgICAgICAgRlJPTSBwaGFzZV9wZXJmb3JtYW5jZSBcbiAgICAgICAgIFdIRVJFIHBubCA+IDAgXG4gICAgICAgICBPUkRFUiBCWSB0aW1lc3RhbXAgREVTQyBcbiAgICAgICAgIExJTUlUIDFgXG4gICAgICApO1xuXG4gICAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID4gMCAmJiByZXN1bHQucm93c1swXS5sYXN0X3Byb2ZpdF90aW1lKSB7XG4gICAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gcmVzdWx0LnJvd3NbMF0ubGFzdF9wcm9maXRfdGltZTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbGFzdCBwcm9maXQgdGltZTonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=