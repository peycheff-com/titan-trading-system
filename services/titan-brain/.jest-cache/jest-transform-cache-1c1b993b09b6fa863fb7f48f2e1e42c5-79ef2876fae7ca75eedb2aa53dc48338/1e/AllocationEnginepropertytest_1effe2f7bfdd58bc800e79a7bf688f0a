3e7a21525525386e1e835206e8f8a2c1
"use strict";
/**
 * Property-Based Tests for AllocationEngine
 *
 * Tests correctness properties using fast-check:
 * - Property 1: Allocation Vector Sum Invariant (Req 1.6)
 * - Property 12: Equity Tier Consistency (Req 1.2, 1.3, 1.4, 1.5)
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const fc = __importStar(require("fast-check"));
const AllocationEngine_js_1 = require("../../src/engine/AllocationEngine.js");
const index_js_1 = require("../../src/types/index.js");
const defaults_js_1 = require("../../src/config/defaults.js");
describe('AllocationEngine Property Tests', () => {
    let engine;
    beforeEach(() => {
        engine = new AllocationEngine_js_1.AllocationEngine(defaults_js_1.defaultConfig.allocationEngine);
    });
    /**
     * Property 1: Allocation Vector Sum Invariant
     *
     * For any equity level, the sum of all phase weights in the allocation
     * vector should always equal 1.0 (100% capital allocation).
     *
     * Validates: Requirements 1.6
     */
    describe('Property 1: Allocation Vector Sum Invariant', () => {
        it('should always sum to 1.0 for any positive equity', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 1000000, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                const sum = weights.w1 + weights.w2 + weights.w3;
                // Allow for floating point precision (within 1e-10)
                return Math.abs(sum - 1.0) < 1e-10;
            }), { numRuns: 1000 });
        });
        it('should always sum to 1.0 for edge case equity values', () => {
            fc.assert(fc.property(fc.oneof(fc.constant(0), fc.constant(1), fc.constant(1499), fc.constant(1500), fc.constant(1501), fc.constant(4999), fc.constant(5000), fc.constant(5001), fc.constant(24999), fc.constant(25000), fc.constant(25001), fc.constant(49999), fc.constant(50000), fc.constant(50001), fc.constant(100000), fc.constant(1000000)), (equity) => {
                const weights = engine.getWeights(equity);
                const sum = weights.w1 + weights.w2 + weights.w3;
                return Math.abs(sum - 1.0) < 1e-10;
            }), { numRuns: 100 });
        });
        it('should have all weights between 0 and 1', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 1000000, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                return (weights.w1 >= 0 && weights.w1 <= 1 &&
                    weights.w2 >= 0 && weights.w2 <= 1 &&
                    weights.w3 >= 0 && weights.w3 <= 1);
            }), { numRuns: 1000 });
        });
        it('should handle negative equity gracefully (treat as 0)', () => {
            fc.assert(fc.property(fc.float({ min: -1000000, max: 0, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                const sum = weights.w1 + weights.w2 + weights.w3;
                // Should still sum to 1.0 and default to Phase 1 only
                return (Math.abs(sum - 1.0) < 1e-10 &&
                    weights.w1 === 1.0 &&
                    weights.w2 === 0.0 &&
                    weights.w3 === 0.0);
            }), { numRuns: 100 });
        });
    });
    /**
     * Property 12: Equity Tier Consistency
     *
     * For any equity value, the assigned equity tier should match
     * the tier boundaries defined in the allocation engine.
     *
     * Validates: Requirements 1.2, 1.3, 1.4, 1.5
     */
    describe('Property 12: Equity Tier Consistency', () => {
        it('should assign MICRO tier for equity < $1,500', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: Math.fround(1499.99), noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.MICRO;
            }), { numRuns: 500 });
        });
        it('should assign SMALL tier for equity $1,500 - $4,999.99', () => {
            fc.assert(fc.property(fc.float({ min: 1500, max: Math.fround(4999.99), noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.SMALL;
            }), { numRuns: 500 });
        });
        it('should assign MEDIUM tier for equity $5,000 - $24,999.99', () => {
            fc.assert(fc.property(fc.float({ min: 5000, max: Math.fround(24999.99), noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.MEDIUM;
            }), { numRuns: 500 });
        });
        it('should assign LARGE tier for equity $25,000 - $49,999.99', () => {
            fc.assert(fc.property(fc.float({ min: 25000, max: Math.fround(49999.99), noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.LARGE;
            }), { numRuns: 500 });
        });
        it('should assign INSTITUTIONAL tier for equity >= $50,000', () => {
            fc.assert(fc.property(fc.float({ min: 50000, max: 10000000, noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.INSTITUTIONAL;
            }), { numRuns: 500 });
        });
        it('should have consistent tier boundaries (no gaps or overlaps)', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 100000, noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                // Verify tier is one of the valid values
                const validTiers = [
                    index_js_1.EquityTier.MICRO,
                    index_js_1.EquityTier.SMALL,
                    index_js_1.EquityTier.MEDIUM,
                    index_js_1.EquityTier.LARGE,
                    index_js_1.EquityTier.INSTITUTIONAL,
                ];
                return validTiers.includes(tier);
            }), { numRuns: 1000 });
        });
        it('should handle negative equity as MICRO tier', () => {
            fc.assert(fc.property(fc.float({ min: -1000000, max: 0, noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                return tier === index_js_1.EquityTier.MICRO;
            }), { numRuns: 100 });
        });
    });
    /**
     * Additional Property: Leverage Cap Consistency
     *
     * For any equity value, the max leverage should match the tier's cap.
     */
    describe('Leverage Cap Consistency', () => {
        it('should return correct leverage cap for each tier', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 100000, noNaN: true }), (equity) => {
                const tier = engine.getEquityTier(equity);
                const maxLeverage = engine.getMaxLeverage(equity);
                const leverageCaps = engine.getLeverageCaps();
                return maxLeverage === leverageCaps[tier];
            }), { numRuns: 1000 });
        });
        it('should have decreasing leverage caps as equity increases', () => {
            fc.assert(fc.property(fc.tuple(fc.float({ min: 0, max: 50000, noNaN: true }), fc.float({ min: 0, max: 50000, noNaN: true })), ([equity1, equity2]) => {
                const leverage1 = engine.getMaxLeverage(equity1);
                const leverage2 = engine.getMaxLeverage(equity2);
                // If equity1 < equity2, leverage1 should be >= leverage2
                // (higher equity = lower leverage allowed)
                if (equity1 < equity2) {
                    return leverage1 >= leverage2;
                }
                return leverage2 >= leverage1;
            }), { numRuns: 500 });
        });
    });
    /**
     * Additional Property: Allocation Monotonicity
     *
     * Phase 1 weight should decrease as equity increases (in general trend).
     * Phase 2 weight should increase then stabilize.
     * Phase 3 weight should only appear at high equity.
     */
    describe('Allocation Monotonicity', () => {
        it('should have Phase 1 weight = 1.0 below $1,500', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 1499, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                return weights.w1 === 1.0 && weights.w2 === 0.0 && weights.w3 === 0.0;
            }), { numRuns: 500 });
        });
        it('should have Phase 3 weight = 0 below $25,000', () => {
            fc.assert(fc.property(fc.float({ min: 0, max: 24999, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                return weights.w3 === 0.0;
            }), { numRuns: 500 });
        });
        it('should have Phase 3 weight > 0 above $25,000', () => {
            fc.assert(fc.property(fc.float({ min: 25001, max: 1000000, noNaN: true }), (equity) => {
                const weights = engine.getWeights(equity);
                return weights.w3 > 0;
            }), { numRuns: 500 });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3Byb3BlcnR5L0FsbG9jYXRpb25FbmdpbmUucHJvcGVydHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILCtDQUFpQztBQUNqQyw4RUFBd0U7QUFDeEUsdURBQXNEO0FBQ3RELDhEQUE2RDtBQUU3RCxRQUFRLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLElBQUksTUFBd0IsQ0FBQztJQUU3QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsTUFBTSxHQUFHLElBQUksc0NBQWdCLENBQUMsMkJBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7Ozs7T0FPRztJQUNILFFBQVEsQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7UUFDM0QsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUMxRCxFQUFFLENBQUMsTUFBTSxDQUNQLEVBQUUsQ0FBQyxRQUFRLENBQ1QsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFDL0MsQ0FBQyxNQUFNLEVBQUUsRUFBRTtnQkFDVCxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFFakQsb0RBQW9EO2dCQUNwRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNyQyxDQUFDLENBQ0YsRUFDRCxFQUFFLE9BQU8sRUFBRSxJ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QUUsR0FBRyxFQUFFLENBQ2pCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDdEQsRUFBRSxDQUFDLE1BQU0sQ0FDUCxFQUFFLENBQUMsUUFBUSxDQUNULEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQ25ELENBQUMsTUFBTSxFQUFFLEVBQUU7Z0JBQ1QsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDMUMsT0FBTyxPQUFPLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUN4QixDQUFDLENBQ0YsRUFDRCxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FDakIsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvcHJvcGVydHkvQWxsb2NhdGlvbkVuZ2luZS5wcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUHJvcGVydHktQmFzZWQgVGVzdHMgZm9yIEFsbG9jYXRpb25FbmdpbmVcbiAqIFxuICogVGVzdHMgY29ycmVjdG5lc3MgcHJvcGVydGllcyB1c2luZyBmYXN0LWNoZWNrOlxuICogLSBQcm9wZXJ0eSAxOiBBbGxvY2F0aW9uIFZlY3RvciBTdW0gSW52YXJpYW50IChSZXEgMS42KVxuICogLSBQcm9wZXJ0eSAxMjogRXF1aXR5IFRpZXIgQ29uc2lzdGVuY3kgKFJlcSAxLjIsIDEuMywgMS40LCAxLjUpXG4gKi9cblxuaW1wb3J0ICogYXMgZmMgZnJvbSAnZmFzdC1jaGVjayc7XG5pbXBvcnQgeyBBbGxvY2F0aW9uRW5naW5lIH0gZnJvbSAnLi4vLi4vc3JjL2VuZ2luZS9BbGxvY2F0aW9uRW5naW5lLmpzJztcbmltcG9ydCB7IEVxdWl0eVRpZXIgfSBmcm9tICcuLi8uLi9zcmMvdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgZGVmYXVsdENvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy9jb25maWcvZGVmYXVsdHMuanMnO1xuXG5kZXNjcmliZSgnQWxsb2NhdGlvbkVuZ2luZSBQcm9wZXJ0eSBUZXN0cycsICgpID0+IHtcbiAgbGV0IGVuZ2luZTogQWxsb2NhdGlvbkVuZ2luZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBlbmdpbmUgPSBuZXcgQWxsb2NhdGlvbkVuZ2luZShkZWZhdWx0Q29uZmlnLmFsbG9jYXRpb25FbmdpbmUpO1xuICB9KTtcblxuICAvKipcbiAgICogUHJvcGVydHkgMTogQWxsb2NhdGlvbiBWZWN0b3IgU3VtIEludmFyaWFudFxuICAgKiBcbiAgICogRm9yIGFueSBlcXVpdHkgbGV2ZWwsIHRoZSBzdW0gb2YgYWxsIHBoYXNlIHdlaWdodHMgaW4gdGhlIGFsbG9jYXRpb25cbiAgICogdmVjdG9yIHNob3VsZCBhbHdheXMgZXF1YWwgMS4wICgxMDAlIGNhcGl0YWwgYWxsb2NhdGlvbikuXG4gICAqIFxuICAgKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyAxLjZcbiAgICovXG4gIGRlc2NyaWJlKCdQcm9wZXJ0eSAxOiBBbGxvY2F0aW9uIFZlY3RvciBTdW0gSW52YXJpYW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWx3YXlzIHN1bSB0byAxLjAgZm9yIGFueSBwb3NpdGl2ZSBlcXVpdHknLCAoKSA9PiB7XG4gICAgICBmYy5hc3NlcnQoXG4gICAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAgIGZjLmZsb2F0KHsgbWluOiAwLCBtYXg6IDEwMDAwMDAsIG5vTmFOOiB0cnVlIH0pLFxuICAgICAgICAgIChlcXVpdHkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdlaWdodHMgPSBlbmdpbmUuZ2V0V2VpZ2h0cyhlcXVpdHkpO1xuICAgICAgICAgICAgY29uc3Qgc3VtID0gd2VpZ2h0cy53MSArIHdlaWdodHMudzIgKyB3ZWlnaHRzLnczO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBbGxvdyBmb3IgZmxvYXRpbmcgcG9pbnQgcHJlY2lzaW9uICh3aXRoaW4gMWUtMTApXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoc3VtIC0gMS4wKSA8IDFlLTEwO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiAxMDAwIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsd2F5cyBzdW0gdG8gMS4wIGZvciBlZGdlIGNhc2UgZXF1aXR5IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGZjLmFzc2VydChcbiAgICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgICAgZmMub25lb2YoXG4gICAgICAgICAgICBmYy5jb25zdGFudCgwKSxcbiAgICAgICAgICAgIGZjLmNvbnN0YW50KDEpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoMTQ5OSksXG4gICAgICAgICAgICBmYy5jb25zdGFudCgxNTAwKSxcbiAgICAgICAgICAgIGZjLmNvbnN0YW50KDE1MDEpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoNDk5OSksXG4gICAgICAgICAgICBmYy5jb25zdGFudCg1MDAwKSxcbiAgICAgICAgICAgIGZjLmNvbnN0YW50KDUwMDEpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoMjQ5OTkpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoMjUwMDApLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoMjUwMDEpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoNDk5OTkpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoNTAwMDApLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoNTAwMDEpLFxuICAgICAgICAgICAgZmMuY29uc3RhbnQoMTAwMDAwKSxcbiAgICAgICAgICAgIGZjLmNvbnN0YW50KDEwMDAwMDApXG4gICAgICAgICAgKSxcbiAgICAgICAgICAoZXF1aXR5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3ZWlnaHRzID0gZW5naW5lLmdldFdlaWdodHMoZXF1aXR5KTtcbiAgICAgICAgICAgIGNvbnN0IHN1bSA9IHdlaWdodHMudzEgKyB3ZWlnaHRzLncyICsgd2VpZ2h0cy53MztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN1bSAtIDEuMCkgPCAxZS0xMDtcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgYWxsIHdlaWdodHMgYmV0d2VlbiAwIGFuZCAxJywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogMCwgbWF4OiAxMDAwMDAwLCBub05hTjogdHJ1ZSB9KSxcbiAgICAgICAgICAoZXF1aXR5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3ZWlnaHRzID0gZW5naW5lLmdldFdlaWdodHMoZXF1aXR5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgd2VpZ2h0cy53MSA+PSAwICYmIHdlaWdodHMudzEgPD0gMSAmJlxuICAgICAgICAgICAgICB3ZWlnaHRzLncyID49IDAgJiYgd2VpZ2h0cy53MiA8PSAxICYmXG4gICAgICAgICAgICAgIHdlaWdodHMudzMgPj0gMCAmJiB3ZWlnaHRzLnczIDw9IDFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICB7IG51bVJ1bnM6IDEwMDAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lZ2F0aXZlIGVxdWl0eSBncmFjZWZ1bGx5ICh0cmVhdCBhcyAwKScsICgpID0+IHtcbiAgICAgIGZjLmFzc2VydChcbiAgICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgICAgZmMuZmxvYXQoeyBtaW46IC0xMDAwMDAwLCBtYXg6IDAsIG5vTmFOOiB0cnVlIH0pLFxuICAgICAgICAgIChlcXVpdHkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdlaWdodHMgPSBlbmdpbmUuZ2V0V2VpZ2h0cyhlcXVpdHkpO1xuICAgICAgICAgICAgY29uc3Qgc3VtID0gd2VpZ2h0cy53MSArIHdlaWdodHMudzIgKyB3ZWlnaHRzLnczO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTaG91bGQgc3RpbGwgc3VtIHRvIDEuMCBhbmQgZGVmYXVsdCB0byBQaGFzZSAxIG9ubHlcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIE1hdGguYWJzKHN1bSAtIDEuMCkgPCAxZS0xMCAmJlxuICAgICAgICAgICAgICB3ZWlnaHRzLncxID09PSAxLjAgJiZcbiAgICAgICAgICAgICAgd2VpZ2h0cy53MiA9PT0gMC4wICYmXG4gICAgICAgICAgICAgIHdlaWdodHMudzMgPT09IDAuMFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0eSAxMjogRXF1aXR5IFRpZXIgQ29uc2lzdGVuY3lcbiAgICogXG4gICAqIEZvciBhbnkgZXF1aXR5IHZhbHVlLCB0aGUgYXNzaWduZWQgZXF1aXR5IHRpZXIgc2hvdWxkIG1hdGNoXG4gICAqIHRoZSB0aWVyIGJvdW5kYXJpZXMgZGVmaW5lZCBpbiB0aGUgYWxsb2NhdGlvbiBlbmdpbmUuXG4gICAqIFxuICAgKiBWYWxpZGF0ZXM6IFJlcXVpcmVtZW50cyAxLjIsIDEuMywgMS40LCAxLjVcbiAgICovXG4gIGRlc2NyaWJlKCdQcm9wZXJ0eSAxMjogRXF1aXR5IFRpZXIgQ29uc2lzdGVuY3knLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhc3NpZ24gTUlDUk8gdGllciBmb3IgZXF1aXR5IDwgJDEsNTAwJywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogMCwgbWF4OiBNYXRoLmZyb3VuZCgxNDk5Ljk5KSwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gdGllciA9PT0gRXF1aXR5VGllci5NSUNSTztcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHsgbnVtUnVuczogNTAwIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFzc2lnbiBTTUFMTCB0aWVyIGZvciBlcXVpdHkgJDEsNTAwIC0gJDQsOTk5Ljk5JywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogMTUwMCwgbWF4OiBNYXRoLmZyb3VuZCg0OTk5Ljk5KSwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gdGllciA9PT0gRXF1aXR5VGllci5TTUFMTDtcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHsgbnVtUnVuczogNTAwIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFzc2lnbiBNRURJVU0gdGllciBmb3IgZXF1aXR5ICQ1LDAwMCAtICQyNCw5OTkuOTknLCAoKSA9PiB7XG4gICAgICBmYy5hc3NlcnQoXG4gICAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAgIGZjLmZsb2F0KHsgbWluOiA1MDAwLCBtYXg6IE1hdGguZnJvdW5kKDI0OTk5Ljk5KSwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gdGllciA9PT0gRXF1aXR5VGllci5NRURJVU07XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICB7IG51bVJ1bnM6IDUwMCB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhc3NpZ24gTEFSR0UgdGllciBmb3IgZXF1aXR5ICQyNSwwMDAgLSAkNDksOTk5Ljk5JywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogMjUwMDAsIG1heDogTWF0aC5mcm91bmQoNDk5OTkuOTkpLCBub05hTjogdHJ1ZSB9KSxcbiAgICAgICAgICAoZXF1aXR5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aWVyID0gZW5naW5lLmdldEVxdWl0eVRpZXIoZXF1aXR5KTtcbiAgICAgICAgICAgIHJldHVybiB0aWVyID09PSBFcXVpdHlUaWVyLkxBUkdFO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiA1MDAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXNzaWduIElOU1RJVFVUSU9OQUwgdGllciBmb3IgZXF1aXR5ID49ICQ1MCwwMDAnLCAoKSA9PiB7XG4gICAgICBmYy5hc3NlcnQoXG4gICAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAgIGZjLmZsb2F0KHsgbWluOiA1MDAwMCwgbWF4OiAxMDAwMDAwMCwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gdGllciA9PT0gRXF1aXR5VGllci5JTlNUSVRVVElPTkFMO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiA1MDAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBjb25zaXN0ZW50IHRpZXIgYm91bmRhcmllcyAobm8gZ2FwcyBvciBvdmVybGFwcyknLCAoKSA9PiB7XG4gICAgICBmYy5hc3NlcnQoXG4gICAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAgIGZjLmZsb2F0KHsgbWluOiAwLCBtYXg6IDEwMDAwMCwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFZlcmlmeSB0aWVyIGlzIG9uZSBvZiB0aGUgdmFsaWQgdmFsdWVzXG4gICAgICAgICAgICBjb25zdCB2YWxpZFRpZXJzID0gW1xuICAgICAgICAgICAgICBFcXVpdHlUaWVyLk1JQ1JPLFxuICAgICAgICAgICAgICBFcXVpdHlUaWVyLlNNQUxMLFxuICAgICAgICAgICAgICBFcXVpdHlUaWVyLk1FRElVTSxcbiAgICAgICAgICAgICAgRXF1aXR5VGllci5MQVJHRSxcbiAgICAgICAgICAgICAgRXF1aXR5VGllci5JTlNUSVRVVElPTkFMLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkVGllcnMuaW5jbHVkZXModGllcik7XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICB7IG51bVJ1bnM6IDEwMDAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lZ2F0aXZlIGVxdWl0eSBhcyBNSUNSTyB0aWVyJywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogLTEwMDAwMDAsIG1heDogMCwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGllciA9IGVuZ2luZS5nZXRFcXVpdHlUaWVyKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gdGllciA9PT0gRXF1aXR5VGllci5NSUNSTztcbiAgICAgICAgICB9XG4gICAgICAgICksXG4gICAgICAgIHsgbnVtUnVuczogMTAwIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBZGRpdGlvbmFsIFByb3BlcnR5OiBMZXZlcmFnZSBDYXAgQ29uc2lzdGVuY3lcbiAgICogXG4gICAqIEZvciBhbnkgZXF1aXR5IHZhbHVlLCB0aGUgbWF4IGxldmVyYWdlIHNob3VsZCBtYXRjaCB0aGUgdGllcidzIGNhcC5cbiAgICovXG4gIGRlc2NyaWJlKCdMZXZlcmFnZSBDYXAgQ29uc2lzdGVuY3knLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBsZXZlcmFnZSBjYXAgZm9yIGVhY2ggdGllcicsICgpID0+IHtcbiAgICAgIGZjLmFzc2VydChcbiAgICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgICAgZmMuZmxvYXQoeyBtaW46IDAsIG1heDogMTAwMDAwLCBub05hTjogdHJ1ZSB9KSxcbiAgICAgICAgICAoZXF1aXR5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aWVyID0gZW5naW5lLmdldEVxdWl0eVRpZXIoZXF1aXR5KTtcbiAgICAgICAgICAgIGNvbnN0IG1heExldmVyYWdlID0gZW5naW5lLmdldE1heExldmVyYWdlKGVxdWl0eSk7XG4gICAgICAgICAgICBjb25zdCBsZXZlcmFnZUNhcHMgPSBlbmdpbmUuZ2V0TGV2ZXJhZ2VDYXBzKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBtYXhMZXZlcmFnZSA9PT0gbGV2ZXJhZ2VDYXBzW3RpZXJdO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiAxMDAwIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgZGVjcmVhc2luZyBsZXZlcmFnZSBjYXBzIGFzIGVxdWl0eSBpbmNyZWFzZXMnLCAoKSA9PiB7XG4gICAgICBmYy5hc3NlcnQoXG4gICAgICAgIGZjLnByb3BlcnR5KFxuICAgICAgICAgIGZjLnR1cGxlKFxuICAgICAgICAgICAgZmMuZmxvYXQoeyBtaW46IDAsIG1heDogNTAwMDAsIG5vTmFOOiB0cnVlIH0pLFxuICAgICAgICAgICAgZmMuZmxvYXQoeyBtaW46IDAsIG1heDogNTAwMDAsIG5vTmFOOiB0cnVlIH0pXG4gICAgICAgICAgKSxcbiAgICAgICAgICAoW2VxdWl0eTEsIGVxdWl0eTJdKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsZXZlcmFnZTEgPSBlbmdpbmUuZ2V0TWF4TGV2ZXJhZ2UoZXF1aXR5MSk7XG4gICAgICAgICAgICBjb25zdCBsZXZlcmFnZTIgPSBlbmdpbmUuZ2V0TWF4TGV2ZXJhZ2UoZXF1aXR5Mik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIElmIGVxdWl0eTEgPCBlcXVpdHkyLCBsZXZlcmFnZTEgc2hvdWxkIGJlID49IGxldmVyYWdlMlxuICAgICAgICAgICAgLy8gKGhpZ2hlciBlcXVpdHkgPSBsb3dlciBsZXZlcmFnZSBhbGxvd2VkKVxuICAgICAgICAgICAgaWYgKGVxdWl0eTEgPCBlcXVpdHkyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBsZXZlcmFnZTEgPj0gbGV2ZXJhZ2UyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGxldmVyYWdlMiA+PSBsZXZlcmFnZTE7XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICB7IG51bVJ1bnM6IDUwMCB9XG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQWRkaXRpb25hbCBQcm9wZXJ0eTogQWxsb2NhdGlvbiBNb25vdG9uaWNpdHlcbiAgICogXG4gICAqIFBoYXNlIDEgd2VpZ2h0IHNob3VsZCBkZWNyZWFzZSBhcyBlcXVpdHkgaW5jcmVhc2VzIChpbiBnZW5lcmFsIHRyZW5kKS5cbiAgICogUGhhc2UgMiB3ZWlnaHQgc2hvdWxkIGluY3JlYXNlIHRoZW4gc3RhYmlsaXplLlxuICAgKiBQaGFzZSAzIHdlaWdodCBzaG91bGQgb25seSBhcHBlYXIgYXQgaGlnaCBlcXVpdHkuXG4gICAqL1xuICBkZXNjcmliZSgnQWxsb2NhdGlvbiBNb25vdG9uaWNpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYXZlIFBoYXNlIDEgd2VpZ2h0ID0gMS4wIGJlbG93ICQxLDUwMCcsICgpID0+IHtcbiAgICAgIGZjLmFzc2VydChcbiAgICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgICAgZmMuZmxvYXQoeyBtaW46IDAsIG1heDogMTQ5OSwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd2VpZ2h0cyA9IGVuZ2luZS5nZXRXZWlnaHRzKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gd2VpZ2h0cy53MSA9PT0gMS4wICYmIHdlaWdodHMudzIgPT09IDAuMCAmJiB3ZWlnaHRzLnczID09PSAwLjA7XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICB7IG51bVJ1bnM6IDUwMCB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIFBoYXNlIDMgd2VpZ2h0ID0gMCBiZWxvdyAkMjUsMDAwJywgKCkgPT4ge1xuICAgICAgZmMuYXNzZXJ0KFxuICAgICAgICBmYy5wcm9wZXJ0eShcbiAgICAgICAgICBmYy5mbG9hdCh7IG1pbjogMCwgbWF4OiAyNDk5OSwgbm9OYU46IHRydWUgfSksXG4gICAgICAgICAgKGVxdWl0eSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd2VpZ2h0cyA9IGVuZ2luZS5nZXRXZWlnaHRzKGVxdWl0eSk7XG4gICAgICAgICAgICByZXR1cm4gd2VpZ2h0cy53MyA9PT0gMC4wO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiA1MDAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBQaGFzZSAzIHdlaWdodCA+IDAgYWJvdmUgJDI1LDAwMCcsICgpID0+IHtcbiAgICAgIGZjLmFzc2VydChcbiAgICAgICAgZmMucHJvcGVydHkoXG4gICAgICAgICAgZmMuZmxvYXQoeyBtaW46IDI1MDAxLCBtYXg6IDEwMDAwMDAsIG5vTmFOOiB0cnVlIH0pLFxuICAgICAgICAgIChlcXVpdHkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdlaWdodHMgPSBlbmdpbmUuZ2V0V2VpZ2h0cyhlcXVpdHkpO1xuICAgICAgICAgICAgcmV0dXJuIHdlaWdodHMudzMgPiAwO1xuICAgICAgICAgIH1cbiAgICAgICAgKSxcbiAgICAgICAgeyBudW1SdW5zOiA1MDAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==