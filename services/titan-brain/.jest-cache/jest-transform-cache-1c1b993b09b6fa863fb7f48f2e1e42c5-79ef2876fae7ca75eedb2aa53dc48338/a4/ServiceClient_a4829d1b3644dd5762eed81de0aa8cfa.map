{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/services/ServiceClient.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/services/ServiceClient.ts"],"sourcesContent":["/**\n * Service Client with Circuit Breaker\n * \n * Robust HTTP client for inter-service communication with:\n * - Circuit breaker pattern for fault tolerance\n * - Automatic retries with exponential backoff\n * - Request/response logging with correlation IDs\n * - Timeout handling and error classification\n * - Support for Railway service URLs\n */\n\nimport { CircuitBreaker, CircuitBreakerDefaults, CircuitBreakerConfig } from './CircuitBreaker';\n\n// Use dynamic import for node-fetch to avoid ESM issues\nconst fetch = (...args: Parameters<typeof import('node-fetch').default>) => \n  import('node-fetch').then(({ default: fetch }) => fetch(...args));\n\nexport interface ServiceClientConfig {\n  /** Base URL for the service */\n  baseUrl: string;\n  /** Service name for logging and circuit breaker */\n  serviceName: string;\n  /** Default timeout for requests in ms */\n  timeout: number;\n  /** Maximum number of retry attempts */\n  maxRetries: number;\n  /** Initial retry delay in ms */\n  initialRetryDelay: number;\n  /** Maximum retry delay in ms */\n  maxRetryDelay: number;\n  /** Retry delay multiplier for exponential backoff */\n  retryMultiplier: number;\n  /** Circuit breaker configuration */\n  circuitBreakerConfig?: CircuitBreakerConfig;\n  /** Default headers to include in all requests */\n  defaultHeaders?: Record<string, string>;\n  /** Enable request/response logging */\n  enableLogging: boolean;\n}\n\nexport interface ServiceRequest {\n  /** HTTP method */\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  /** Request path (will be appended to baseUrl) */\n  path: string;\n  /** Request body */\n  body?: any;\n  /** Request headers */\n  headers?: Record<string, string>;\n  /** Request timeout override */\n  timeout?: number;\n  /** Retry configuration override */\n  retries?: number;\n  /** Correlation ID for request tracing */\n  correlationId?: string;\n  /** Skip circuit breaker for this request */\n  skipCircuitBreaker?: boolean;\n}\n\nexport interface ServiceResponse<T = any> {\n  /** Response status code */\n  status: number;\n  /** Response status text */\n  statusText: string;\n  /** Response headers */\n  headers: Record<string, string>;\n  /** Response body */\n  data: T;\n  /** Request duration in ms */\n  duration: number;\n  /** Correlation ID */\n  correlationId: string;\n  /** Number of retry attempts made */\n  retryAttempts: number;\n}\n\nexport class ServiceClientError extends Error {\n  constructor(\n    message: string,\n    public readonly status?: number,\n    public readonly response?: Response,\n    public readonly correlationId?: string\n  ) {\n    super(message);\n    this.name = 'ServiceClientError';\n  }\n}\n\nexport class ServiceClient {\n  private readonly circuitBreaker: CircuitBreaker;\n  private readonly logger: any; // Will be injected\n\n  constructor(\n    private readonly config: ServiceClientConfig,\n    logger?: any\n  ) {\n    this.logger = logger || console;\n    \n    // Initialize circuit breaker\n    const cbConfig = config.circuitBreakerConfig || CircuitBreakerDefaults.IMPORTANT;\n    this.circuitBreaker = new CircuitBreaker(`${config.serviceName}-client`, cbConfig);\n  }\n\n  /**\n   * Make an HTTP request with circuit breaker protection\n   */\n  async request<T = any>(request: ServiceRequest): Promise<ServiceResponse<T>> {\n    const correlationId = request.correlationId || this.generateCorrelationId();\n    const startTime = Date.now();\n\n    if (this.config.enableLogging) {\n      this.logger.info('Service request initiated', {\n        service: this.config.serviceName,\n        method: request.method,\n        path: request.path,\n        correlationId,\n        circuitBreakerState: this.circuitBreaker.getStats().state\n      });\n    }\n\n    const executeRequest = async (): Promise<ServiceResponse<T>> => {\n      return this.executeWithRetry(request, correlationId, startTime);\n    };\n\n    try {\n      if (request.skipCircuitBreaker) {\n        return await executeRequest();\n      } else {\n        return await this.circuitBreaker.execute(executeRequest);\n      }\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      \n      if (this.config.enableLogging) {\n        this.logger.error('Service request failed', {\n          service: this.config.serviceName,\n          method: request.method,\n          path: request.path,\n          correlationId,\n          duration,\n          error: error instanceof Error ? error.message : String(error),\n          circuitBreakerState: this.circuitBreaker.getStats().state\n        });\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Execute request with retry logic\n   */\n  private async executeWithRetry<T>(\n    request: ServiceRequest,\n    correlationId: string,\n    startTime: number\n  ): Promise<ServiceResponse<T>> {\n    const maxRetries = request.retries ?? this.config.maxRetries;\n    let lastError: Error | null = null;\n\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        const response = await this.executeRequest<T>(request, correlationId, attempt);\n        \n        if (this.config.enableLogging && attempt > 0) {\n          this.logger.info('Service request succeeded after retries', {\n            service: this.config.serviceName,\n            method: request.method,\n            path: request.path,\n            correlationId,\n            attempt,\n            duration: Date.now() - startTime\n          });\n        }\n\n        return response;\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n\n        // Don't retry on client errors (4xx) except 408, 429\n        if (error instanceof ServiceClientError && error.status) {\n          const status = error.status;\n          if (status >= 400 && status < 500 && status !== 408 && status !== 429) {\n            throw error;\n          }\n        }\n\n        // Don't retry on last attempt\n        if (attempt === maxRetries) {\n          break;\n        }\n\n        // Calculate retry delay with exponential backoff\n        const delay = this.calculateRetryDelay(attempt);\n        \n        if (this.config.enableLogging) {\n          this.logger.warn('Service request failed, retrying', {\n            service: this.config.serviceName,\n            method: request.method,\n            path: request.path,\n            correlationId,\n            attempt,\n            error: error instanceof Error ? error.message : String(error),\n            retryDelay: delay\n          });\n        }\n\n        await this.sleep(delay);\n      }\n    }\n\n    throw lastError || new ServiceClientError('Request failed after all retries', undefined, undefined, correlationId);\n  }\n\n  /**\n   * Execute a single HTTP request\n   */\n  private async executeRequest<T>(\n    request: ServiceRequest,\n    correlationId: string,\n    attempt: number\n  ): Promise<ServiceResponse<T>> {\n    const url = `${this.config.baseUrl}${request.path}`;\n    const timeout = request.timeout || this.config.timeout;\n    \n    // Prepare headers\n    const headers = {\n      'Content-Type': 'application/json',\n      'X-Correlation-ID': correlationId,\n      'X-Service-Client': this.config.serviceName,\n      ...this.config.defaultHeaders,\n      ...request.headers\n    };\n\n    // Create abort controller for timeout\n    const abortController = new AbortController();\n    const timeoutId = setTimeout(() => abortController.abort(), timeout);\n\n    // Prepare request options\n    const options: any = {\n      method: request.method,\n      headers,\n      signal: abortController.signal\n    };\n\n    // Add body for non-GET requests\n    if (request.body && request.method !== 'GET') {\n      options.body = typeof request.body === 'string' ? request.body : JSON.stringify(request.body);\n    }\n\n    const requestStart = Date.now();\n    let response: any;\n\n    try {\n      response = await fetch(url, options);\n      clearTimeout(timeoutId);\n    } catch (error) {\n      clearTimeout(timeoutId);\n      const duration = Date.now() - requestStart;\n      throw new ServiceClientError(\n        `Network error: ${error instanceof Error ? error.message : String(error)}`,\n        undefined,\n        undefined,\n        correlationId\n      );\n    }\n\n    const duration = Date.now() - requestStart;\n\n    // Parse response body\n    let data: T;\n    try {\n      const text = await response.text();\n      data = text ? JSON.parse(text) : null;\n    } catch (error) {\n      // If JSON parsing fails, return text as data\n      data = await response.text() as any;\n    }\n\n    // Convert headers to plain object\n    const responseHeaders: Record<string, string> = {};\n    response.headers.forEach((value: string, key: string) => {\n      responseHeaders[key] = value;\n    });\n\n    const serviceResponse: ServiceResponse<T> = {\n      status: response.status,\n      statusText: response.statusText,\n      headers: responseHeaders,\n      data,\n      duration,\n      correlationId,\n      retryAttempts: attempt\n    };\n\n    // Check if response indicates an error\n    if (!response.ok) {\n      throw new ServiceClientError(\n        `HTTP ${response.status}: ${response.statusText}`,\n        response.status,\n        response,\n        correlationId\n      );\n    }\n\n    return serviceResponse;\n  }\n\n  /**\n   * Calculate retry delay with exponential backoff and jitter\n   */\n  private calculateRetryDelay(attempt: number): number {\n    const baseDelay = this.config.initialRetryDelay * Math.pow(this.config.retryMultiplier, attempt);\n    const maxDelay = this.config.maxRetryDelay;\n    const delay = Math.min(baseDelay, maxDelay);\n    \n    // Add jitter (Â±25% of delay)\n    const jitter = delay * 0.25 * (Math.random() * 2 - 1);\n    return Math.max(0, delay + jitter);\n  }\n\n  /**\n   * Sleep for specified duration\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Generate correlation ID for request tracing\n   */\n  private generateCorrelationId(): string {\n    return `${this.config.serviceName}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Convenience method for GET requests\n   */\n  async get<T = any>(path: string, options?: Partial<ServiceRequest>): Promise<ServiceResponse<T>> {\n    return this.request<T>({\n      method: 'GET',\n      path,\n      ...options\n    });\n  }\n\n  /**\n   * Convenience method for POST requests\n   */\n  async post<T = any>(path: string, body?: any, options?: Partial<ServiceRequest>): Promise<ServiceResponse<T>> {\n    return this.request<T>({\n      method: 'POST',\n      path,\n      body,\n      ...options\n    });\n  }\n\n  /**\n   * Convenience method for PUT requests\n   */\n  async put<T = any>(path: string, body?: any, options?: Partial<ServiceRequest>): Promise<ServiceResponse<T>> {\n    return this.request<T>({\n      method: 'PUT',\n      path,\n      body,\n      ...options\n    });\n  }\n\n  /**\n   * Convenience method for DELETE requests\n   */\n  async delete<T = any>(path: string, options?: Partial<ServiceRequest>): Promise<ServiceResponse<T>> {\n    return this.request<T>({\n      method: 'DELETE',\n      path,\n      ...options\n    });\n  }\n\n  /**\n   * Convenience method for PATCH requests\n   */\n  async patch<T = any>(path: string, body?: any, options?: Partial<ServiceRequest>): Promise<ServiceResponse<T>> {\n    return this.request<T>({\n      method: 'PATCH',\n      path,\n      body,\n      ...options\n    });\n  }\n\n  /**\n   * Get circuit breaker statistics\n   */\n  getCircuitBreakerStats() {\n    return this.circuitBreaker.getStats();\n  }\n\n  /**\n   * Get service client configuration\n   */\n  getConfig(): ServiceClientConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Update default headers\n   */\n  updateDefaultHeaders(headers: Record<string, string>): void {\n    this.config.defaultHeaders = {\n      ...this.config.defaultHeaders,\n      ...headers\n    };\n  }\n\n  /**\n   * Health check endpoint\n   */\n  async healthCheck(): Promise<ServiceResponse> {\n    return this.get('/health', {\n      timeout: 5000,\n      retries: 1,\n      skipCircuitBreaker: true\n    });\n  }\n}\n\n/**\n * Default service client configurations\n */\nexport const ServiceClientDefaults = {\n  /** Configuration for critical services */\n  CRITICAL: {\n    timeout: 10000,\n    maxRetries: 3,\n    initialRetryDelay: 1000,\n    maxRetryDelay: 10000,\n    retryMultiplier: 2,\n    enableLogging: true,\n    circuitBreakerConfig: CircuitBreakerDefaults.CRITICAL\n  } as Partial<ServiceClientConfig>,\n\n  /** Configuration for important services */\n  IMPORTANT: {\n    timeout: 15000,\n    maxRetries: 2,\n    initialRetryDelay: 500,\n    maxRetryDelay: 5000,\n    retryMultiplier: 2,\n    enableLogging: true,\n    circuitBreakerConfig: CircuitBreakerDefaults.IMPORTANT\n  } as Partial<ServiceClientConfig>,\n\n  /** Configuration for optional services */\n  OPTIONAL: {\n    timeout: 5000,\n    maxRetries: 1,\n    initialRetryDelay: 200,\n    maxRetryDelay: 2000,\n    retryMultiplier: 2,\n    enableLogging: false,\n    circuitBreakerConfig: CircuitBreakerDefaults.OPTIONAL\n  } as Partial<ServiceClientConfig>\n};"],"version":3}