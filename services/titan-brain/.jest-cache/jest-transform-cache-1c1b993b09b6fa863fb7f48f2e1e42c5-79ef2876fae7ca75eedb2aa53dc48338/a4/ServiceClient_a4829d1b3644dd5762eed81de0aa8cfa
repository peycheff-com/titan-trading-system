e127be23de9ba00cf07b2dcb7b104b36
"use strict";
/**
 * Service Client with Circuit Breaker
 *
 * Robust HTTP client for inter-service communication with:
 * - Circuit breaker pattern for fault tolerance
 * - Automatic retries with exponential backoff
 * - Request/response logging with correlation IDs
 * - Timeout handling and error classification
 * - Support for Railway service URLs
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ServiceClientDefaults = exports.ServiceClient = exports.ServiceClientError = void 0;
const CircuitBreaker_1 = require("./CircuitBreaker");
// Use dynamic import for node-fetch to avoid ESM issues
const fetch = (...args) => Promise.resolve().then(() => __importStar(require('node-fetch'))).then(({ default: fetch }) => fetch(...args));
class ServiceClientError extends Error {
    status;
    response;
    correlationId;
    constructor(message, status, response, correlationId) {
        super(message);
        this.status = status;
        this.response = response;
        this.correlationId = correlationId;
        this.name = 'ServiceClientError';
    }
}
exports.ServiceClientError = ServiceClientError;
class ServiceClient {
    config;
    circuitBreaker;
    logger; // Will be injected
    constructor(config, logger) {
        this.config = config;
        this.logger = logger || console;
        // Initialize circuit breaker
        const cbConfig = config.circuitBreakerConfig || CircuitBreaker_1.CircuitBreakerDefaults.IMPORTANT;
        this.circuitBreaker = new CircuitBreaker_1.CircuitBreaker(`${config.serviceName}-client`, cbConfig);
    }
    /**
     * Make an HTTP request with circuit breaker protection
     */
    async request(request) {
        const correlationId = request.correlationId || this.generateCorrelationId();
        const startTime = Date.now();
        if (this.config.enableLogging) {
            this.logger.info('Service request initiated', {
                service: this.config.serviceName,
                method: request.method,
                path: request.path,
                correlationId,
                circuitBreakerState: this.circuitBreaker.getStats().state
            });
        }
        const executeRequest = async () => {
            return this.executeWithRetry(request, correlationId, startTime);
        };
        try {
            if (request.skipCircuitBreaker) {
                return await executeRequest();
            }
            else {
                return await this.circuitBreaker.execute(executeRequest);
            }
        }
        catch (error) {
            const duration = Date.now() - startTime;
            if (this.config.enableLogging) {
                this.logger.error('Service request failed', {
                    service: this.config.serviceName,
                    method: request.method,
                    path: request.path,
                    correlationId,
                    duration,
                    error: error instanceof Error ? error.message : String(error),
                    circuitBreakerState: this.circuitBreaker.getStats().state
                });
            }
            throw error;
        }
    }
    /**
     * Execute request with retry logic
     */
    async executeWithRetry(request, correlationId, startTime) {
        const maxRetries = request.retries ?? this.config.maxRetries;
        let lastError = null;
        for (let attempt = 0; attempt <= maxRetries; attempt++) {
            try {
                const response = await this.executeRequest(request, correlationId, attempt);
                if (this.config.enableLogging && attempt > 0) {
                    this.logger.info('Service request succeeded after retries', {
                        service: this.config.serviceName,
                        method: request.method,
                        path: request.path,
                        correlationId,
                        attempt,
                        duration: Date.now() - startTime
                    });
                }
                return response;
            }
            catch (error) {
                lastError = error instanceof Error ? error : new Error(String(error));
                // Don't retry on client errors (4xx) except 408, 429
                if (error instanceof ServiceClientError && error.status) {
                    const status = error.status;
                    if (status >= 400 && status < 500 && status !== 408 && status !== 429) {
                        throw error;
                    }
                }
                // Don't retry on last attempt
                if (attempt === maxRetries) {
                    break;
                }
                // Calculate retry delay with exponential backoff
                const delay = this.calculateRetryDelay(attempt);
                if (this.config.enableLogging) {
                    this.logger.warn('Service request failed, retrying', {
                        service: this.config.serviceName,
                        method: request.method,
                        path: request.path,
                        correlationId,
                        attempt,
                        error: error instanceof Error ? error.message : String(error),
                        retryDelay: delay
                    });
                }
                await this.sleep(delay);
            }
        }
        throw lastError || new ServiceClientError('Request failed after all retries', undefined, undefined, correlationId);
    }
    /**
     * Execute a single HTTP request
     */
    async executeRequest(request, correlationId, attempt) {
        const url = `${this.config.baseUrl}${request.path}`;
        const timeout = request.timeout || this.config.timeout;
        // Prepare headers
        const headers = {
            'Content-Type': 'application/json',
            'X-Correlation-ID': correlationId,
            'X-Service-Client': this.config.serviceName,
            ...this.config.defaultHeaders,
            ...request.headers
        };
        // Create abort controller for timeout
        const abortController = new AbortController();
        const timeoutId = setTimeout(() => abortController.abort(), timeout);
        // Prepare request options
        const options = {
            method: request.method,
            headers,
            signal: abortController.signal
        };
        // Add body for non-GET requests
        if (request.body && request.method !== 'GET') {
            options.body = typeof request.body === 'string' ? request.body : JSON.stringify(request.body);
        }
        const requestStart = Date.now();
        let response;
        try {
            response = await fetch(url, options);
            clearTimeout(timeoutId);
        }
        catch (error) {
            clearTimeout(timeoutId);
            const duration = Date.now() - requestStart;
            throw new ServiceClientError(`Network error: ${error instanceof Error ? error.message : String(error)}`, undefined, undefined, correlationId);
        }
        const duration = Date.now() - requestStart;
        // Parse response body
        let data;
        try {
            const text = await response.text();
            data = text ? JSON.parse(text) : null;
        }
        catch (error) {
            // If JSON parsing fails, return text as data
            data = await response.text();
        }
        // Convert headers to plain object
        const responseHeaders = {};
        response.headers.forEach((value, key) => {
            responseHeaders[key] = value;
        });
        const serviceResponse = {
            status: response.status,
            statusText: response.statusText,
            headers: responseHeaders,
            data,
            duration,
            correlationId,
            retryAttempts: attempt
        };
        // Check if response indicates an error
        if (!response.ok) {
            throw new ServiceClientError(`HTTP ${response.status}: ${response.statusText}`, response.status, response, correlationId);
        }
        return serviceResponse;
    }
    /**
     * Calculate retry delay with exponential backoff and jitter
     */
    calculateRetryDelay(attempt) {
        const baseDelay = this.config.initialRetryDelay * Math.pow(this.config.retryMultiplier, attempt);
        const maxDelay = this.config.maxRetryDelay;
        const delay = Math.min(baseDelay, maxDelay);
        // Add jitter (Â±25% of delay)
        const jitter = delay * 0.25 * (Math.random() * 2 - 1);
        return Math.max(0, delay + jitter);
    }
    /**
     * Sleep for specified duration
     */
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * Generate correlation ID for request tracing
     */
    generateCorrelationId() {
        return `${this.config.serviceName}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }
    /**
     * Convenience method for GET requests
     */
    async get(path, options) {
        return this.request({
            method: 'GET',
            path,
            ...options
        });
    }
    /**
     * Convenience method for POST requests
     */
    async post(path, body, options) {
        return this.request({
            method: 'POST',
            path,
            body,
            ...options
        });
    }
    /**
     * Convenience method for PUT requests
     */
    async put(path, body, options) {
        return this.request({
            method: 'PUT',
            path,
            body,
            ...options
        });
    }
    /**
     * Convenience method for DELETE requests
     */
    async delete(path, options) {
        return this.request({
            method: 'DELETE',
            path,
            ...options
        });
    }
    /**
     * Convenience method for PATCH requests
     */
    async patch(path, body, options) {
        return this.request({
            method: 'PATCH',
            path,
            body,
            ...options
        });
    }
    /**
     * Get circuit breaker statistics
     */
    getCircuitBreakerStats() {
        return this.circuitBreaker.getStats();
    }
    /**
     * Get service client configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Update default headers
     */
    updateDefaultHeaders(headers) {
        this.config.defaultHeaders = {
            ...this.config.defaultHeaders,
            ...headers
        };
    }
    /**
     * Health check endpoint
     */
    async healthCheck() {
        return this.get('/health', {
            timeout: 5000,
            retries: 1,
            skipCircuitBreaker: true
        });
    }
}
exports.ServiceClient = ServiceClient;
/**
 * Default service client configurations
 */
exports.ServiceClientDefaults = {
    /** Configuration for critical services */
    CRITICAL: {
        timeout: 10000,
        maxRetries: 3,
        initialRetryDelay: 1000,
        maxRetryDelay: 10000,
        retryMultiplier: 2,
        enableLogging: true,
        circuitBreakerConfig: CircuitBreaker_1.CircuitBreakerDefaults.CRITICAL
    },
    /** Configuration for important services */
    IMPORTANT: {
        timeout: 15000,
        maxRetries: 2,
        initialRetryDelay: 500,
        maxRetryDelay: 5000,
        retryMultiplier: 2,
        enableLogging: true,
        circuitBreakerConfig: CircuitBreaker_1.CircuitBreakerDefaults.IMPORTANT
    },
    /** Configuration for optional services */
    OPTIONAL: {
        timeout: 5000,
        maxRetries: 1,
        initialRetryDelay: 200,
        maxRetryDelay: 2000,
        retryMultiplier: 2,
        enableLogging: false,
        circuitBreakerConfig: CircuitBreaker_1.CircuitBreakerDefaults.OPTIONAL
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2aWNlcy9TZXJ2aWNlQ2xpZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHFEQUFnRztBQUVoRyx3REFBd0Q7QUFDeEQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQXFELEVBQUUsRUFBRSxDQUN6RSxrREFBTyxZQUFZLElBQUUsSUFBSSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7QUE2RHBFLE1BQWEsa0JBQW1CLFNBQVEsS0FBSztJQUd6QjtJQUNBO0lBQ0E7SUFKbEIsWUFDRSxPQUFlLEVBQ0MsTUFBZSxFQUNmLFFBQW1CLEVBQ25CLGFBQXNCO1FBRXRDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUpDLFdBQU0sR0FBTixNQUFNLENBQVM7UUFDZixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLGtCQUFhLEdBQWIsYUFBYSxDQUFTO1FBR3RDLElBQUksQ0FBQyxJQUFJLEdBQUcsb0JBQW9CLENBQUM7SUFDbkMsQ0FBQztDQUNGO0FBVkQsZ0RBVUM7QUFFRCxNQUFhLGFBQWE7SUFLTDtJQUpGLGNBQWMsQ0FBaUI7SUFDL0IsTUFBTSxDQUFNLENBQUMsbUJBQW1CO0lBRWpELFlBQ21CLE1BQTJCLEVBQzVDLE1BQVk7UUFESyxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQUc1QyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxPQUFPLENBQUM7UUFFaEMsNkJBQTZCO1FBQzdCLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxvQkFBb0IsSUFBSSx1Q0FBc0IsQ0FBQyxTQUFTLENBQUM7UUFDakYsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLCtCQUFjLENBQUMsR0FBRyxN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InNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2aWNlcy9TZXJ2aWNlQ2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmljZSBDbGllbnQgd2l0aCBDaXJjdWl0IEJyZWFrZXJcbiAqIFxuICogUm9idXN0IEhUVFAgY2xpZW50IGZvciBpbnRlci1zZXJ2aWNlIGNvbW11bmljYXRpb24gd2l0aDpcbiAqIC0gQ2lyY3VpdCBicmVha2VyIHBhdHRlcm4gZm9yIGZhdWx0IHRvbGVyYW5jZVxuICogLSBBdXRvbWF0aWMgcmV0cmllcyB3aXRoIGV4cG9uZW50aWFsIGJhY2tvZmZcbiAqIC0gUmVxdWVzdC9yZXNwb25zZSBsb2dnaW5nIHdpdGggY29ycmVsYXRpb24gSURzXG4gKiAtIFRpbWVvdXQgaGFuZGxpbmcgYW5kIGVycm9yIGNsYXNzaWZpY2F0aW9uXG4gKiAtIFN1cHBvcnQgZm9yIFJhaWx3YXkgc2VydmljZSBVUkxzXG4gKi9cblxuaW1wb3J0IHsgQ2lyY3VpdEJyZWFrZXIsIENpcmN1aXRCcmVha2VyRGVmYXVsdHMsIENpcmN1aXRCcmVha2VyQ29uZmlnIH0gZnJvbSAnLi9DaXJjdWl0QnJlYWtlcic7XG5cbi8vIFVzZSBkeW5hbWljIGltcG9ydCBmb3Igbm9kZS1mZXRjaCB0byBhdm9pZCBFU00gaXNzdWVzXG5jb25zdCBmZXRjaCA9ICguLi5hcmdzOiBQYXJhbWV0ZXJzPHR5cGVvZiBpbXBvcnQoJ25vZGUtZmV0Y2gnKS5kZWZhdWx0PikgPT4gXG4gIGltcG9ydCgnbm9kZS1mZXRjaCcpLnRoZW4oKHsgZGVmYXVsdDogZmV0Y2ggfSkgPT4gZmV0Y2goLi4uYXJncykpO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VDbGllbnRDb25maWcge1xuICAvKiogQmFzZSBVUkwgZm9yIHRoZSBzZXJ2aWNlICovXG4gIGJhc2VVcmw6IHN0cmluZztcbiAgLyoqIFNlcnZpY2UgbmFtZSBmb3IgbG9nZ2luZyBhbmQgY2lyY3VpdCBicmVha2VyICovXG4gIHNlcnZpY2VOYW1lOiBzdHJpbmc7XG4gIC8qKiBEZWZhdWx0IHRpbWVvdXQgZm9yIHJlcXVlc3RzIGluIG1zICovXG4gIHRpbWVvdXQ6IG51bWJlcjtcbiAgLyoqIE1heGltdW0gbnVtYmVyIG9mIHJldHJ5IGF0dGVtcHRzICovXG4gIG1heFJldHJpZXM6IG51bWJlcjtcbiAgLyoqIEluaXRpYWwgcmV0cnkgZGVsYXkgaW4gbXMgKi9cbiAgaW5pdGlhbFJldHJ5RGVsYXk6IG51bWJlcjtcbiAgLyoqIE1heGltdW0gcmV0cnkgZGVsYXkgaW4gbXMgKi9cbiAgbWF4UmV0cnlEZWxheTogbnVtYmVyO1xuICAvKiogUmV0cnkgZGVsYXkgbXVsdGlwbGllciBmb3IgZXhwb25lbnRpYWwgYmFja29mZiAqL1xuICByZXRyeU11bHRpcGxpZXI6IG51bWJlcjtcbiAgLyoqIENpcmN1aXQgYnJlYWtlciBjb25maWd1cmF0aW9uICovXG4gIGNpcmN1aXRCcmVha2VyQ29uZmlnPzogQ2lyY3VpdEJyZWFrZXJDb25maWc7XG4gIC8qKiBEZWZhdWx0IGhlYWRlcnMgdG8gaW5jbHVkZSBpbiBhbGwgcmVxdWVzdHMgKi9cbiAgZGVmYXVsdEhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICAvKiogRW5hYmxlIHJlcXVlc3QvcmVzcG9uc2UgbG9nZ2luZyAqL1xuICBlbmFibGVMb2dnaW5nOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VSZXF1ZXN0IHtcbiAgLyoqIEhUVFAgbWV0aG9kICovXG4gIG1ldGhvZDogJ0dFVCcgfCAnUE9TVCcgfCAnUFVUJyB8ICdERUxFVEUnIHwgJ1BBVENIJztcbiAgLyoqIFJlcXVlc3QgcGF0aCAod2lsbCBiZSBhcHBlbmRlZCB0byBiYXNlVXJsKSAqL1xuICBwYXRoOiBzdHJpbmc7XG4gIC8qKiBSZXF1ZXN0IGJvZHkgKi9cbiAgYm9keT86IGFueTtcbiAgLyoqIFJlcXVlc3QgaGVhZGVycyAqL1xuICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgLyoqIFJlcXVlc3QgdGltZW91dCBvdmVycmlkZSAqL1xuICB0aW1lb3V0PzogbnVtYmVyO1xuICAvKiogUmV0cnkgY29uZmlndXJhdGlvbiBvdmVycmlkZSAqL1xuICByZXRyaWVzPzogbnVtYmVyO1xuICAvKiogQ29ycmVsYXRpb24gSUQgZm9yIHJlcXVlc3QgdHJhY2luZyAqL1xuICBjb3JyZWxhdGlvbklkPzogc3RyaW5nO1xuICAvKiogU2tpcCBjaXJjdWl0IGJyZWFrZXIgZm9yIHRoaXMgcmVxdWVzdCAqL1xuICBza2lwQ2lyY3VpdEJyZWFrZXI/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VSZXNwb25zZTxUID0gYW55PiB7XG4gIC8qKiBSZXNwb25zZSBzdGF0dXMgY29kZSAqL1xuICBzdGF0dXM6IG51bWJlcjtcbiAgLyoqIFJlc3BvbnNlIHN0YXR1cyB0ZXh0ICovXG4gIHN0YXR1c1RleHQ6IHN0cmluZztcbiAgLyoqIFJlc3BvbnNlIGhlYWRlcnMgKi9cbiAgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgLyoqIFJlc3BvbnNlIGJvZHkgKi9cbiAgZGF0YTogVDtcbiAgLyoqIFJlcXVlc3QgZHVyYXRpb24gaW4gbXMgKi9cbiAgZHVyYXRpb246IG51bWJlcjtcbiAgLyoqIENvcnJlbGF0aW9uIElEICovXG4gIGNvcnJlbGF0aW9uSWQ6IHN0cmluZztcbiAgLyoqIE51bWJlciBvZiByZXRyeSBhdHRlbXB0cyBtYWRlICovXG4gIHJldHJ5QXR0ZW1wdHM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFNlcnZpY2VDbGllbnRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyByZWFkb25seSBzdGF0dXM/OiBudW1iZXIsXG4gICAgcHVibGljIHJlYWRvbmx5IHJlc3BvbnNlPzogUmVzcG9uc2UsXG4gICAgcHVibGljIHJlYWRvbmx5IGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmdcbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ1NlcnZpY2VDbGllbnRFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlcnZpY2VDbGllbnQge1xuICBwcml2YXRlIHJlYWRvbmx5IGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IGFueTsgLy8gV2lsbCBiZSBpbmplY3RlZFxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBTZXJ2aWNlQ2xpZW50Q29uZmlnLFxuICAgIGxvZ2dlcj86IGFueVxuICApIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlciB8fCBjb25zb2xlO1xuICAgIFxuICAgIC8vIEluaXRpYWxpemUgY2lyY3VpdCBicmVha2VyXG4gICAgY29uc3QgY2JDb25maWcgPSBjb25maWcuY2lyY3VpdEJyZWFrZXJDb25maWcgfHwgQ2lyY3VpdEJyZWFrZXJEZWZhdWx0cy5JTVBPUlRBTlQ7XG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihgJHtjb25maWcuc2VydmljZU5hbWV9LWNsaWVudGAsIGNiQ29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIGFuIEhUVFAgcmVxdWVzdCB3aXRoIGNpcmN1aXQgYnJlYWtlciBwcm90ZWN0aW9uXG4gICAqL1xuICBhc3luYyByZXF1ZXN0PFQgPSBhbnk+KHJlcXVlc3Q6IFNlcnZpY2VSZXF1ZXN0KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gcmVxdWVzdC5jb3JyZWxhdGlvbklkIHx8IHRoaXMuZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCk7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVMb2dnaW5nKSB7XG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdTZXJ2aWNlIHJlcXVlc3QgaW5pdGlhdGVkJywge1xuICAgICAgICBzZXJ2aWNlOiB0aGlzLmNvbmZpZy5zZXJ2aWNlTmFtZSxcbiAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCxcbiAgICAgICAgcGF0aDogcmVxdWVzdC5wYXRoLFxuICAgICAgICBjb3JyZWxhdGlvbklkLFxuICAgICAgICBjaXJjdWl0QnJlYWtlclN0YXRlOiB0aGlzLmNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCkuc3RhdGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGV4ZWN1dGVSZXF1ZXN0ID0gYXN5bmMgKCk6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5leGVjdXRlV2l0aFJldHJ5KHJlcXVlc3QsIGNvcnJlbGF0aW9uSWQsIHN0YXJ0VGltZSk7XG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBpZiAocmVxdWVzdC5za2lwQ2lyY3VpdEJyZWFrZXIpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGVSZXF1ZXN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5jaXJjdWl0QnJlYWtlci5leGVjdXRlKGV4ZWN1dGVSZXF1ZXN0KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlTG9nZ2luZykge1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcignU2VydmljZSByZXF1ZXN0IGZhaWxlZCcsIHtcbiAgICAgICAgICBzZXJ2aWNlOiB0aGlzLmNvbmZpZy5zZXJ2aWNlTmFtZSxcbiAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgICAgIHBhdGg6IHJlcXVlc3QucGF0aCxcbiAgICAgICAgICBjb3JyZWxhdGlvbklkLFxuICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgY2lyY3VpdEJyZWFrZXJTdGF0ZTogdGhpcy5jaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLnN0YXRlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSByZXF1ZXN0IHdpdGggcmV0cnkgbG9naWNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVdpdGhSZXRyeTxUPihcbiAgICByZXF1ZXN0OiBTZXJ2aWNlUmVxdWVzdCxcbiAgICBjb3JyZWxhdGlvbklkOiBzdHJpbmcsXG4gICAgc3RhcnRUaW1lOiBudW1iZXJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICBjb25zdCBtYXhSZXRyaWVzID0gcmVxdWVzdC5yZXRyaWVzID8/IHRoaXMuY29uZmlnLm1heFJldHJpZXM7XG4gICAgbGV0IGxhc3RFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcblxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAwOyBhdHRlbXB0IDw9IG1heFJldHJpZXM7IGF0dGVtcHQrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFQ+KHJlcXVlc3QsIGNvcnJlbGF0aW9uSWQsIGF0dGVtcHQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUxvZ2dpbmcgJiYgYXR0ZW1wdCA+IDApIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdTZXJ2aWNlIHJlcXVlc3Qgc3VjY2VlZGVkIGFmdGVyIHJldHJpZXMnLCB7XG4gICAgICAgICAgICBzZXJ2aWNlOiB0aGlzLmNvbmZpZy5zZXJ2aWNlTmFtZSxcbiAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICAgICAgICBwYXRoOiByZXF1ZXN0LnBhdGgsXG4gICAgICAgICAgICBjb3JyZWxhdGlvbklkLFxuICAgICAgICAgICAgYXR0ZW1wdCxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsYXN0RXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG5cbiAgICAgICAgLy8gRG9uJ3QgcmV0cnkgb24gY2xpZW50IGVycm9ycyAoNHh4KSBleGNlcHQgNDA4LCA0MjlcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2VydmljZUNsaWVudEVycm9yICYmIGVycm9yLnN0YXR1cykge1xuICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGVycm9yLnN0YXR1cztcbiAgICAgICAgICBpZiAoc3RhdHVzID49IDQwMCAmJiBzdGF0dXMgPCA1MDAgJiYgc3RhdHVzICE9PSA0MDggJiYgc3RhdHVzICE9PSA0MjkpIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERvbid0IHJldHJ5IG9uIGxhc3QgYXR0ZW1wdFxuICAgICAgICBpZiAoYXR0ZW1wdCA9PT0gbWF4UmV0cmllcykge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHJldHJ5IGRlbGF5IHdpdGggZXhwb25lbnRpYWwgYmFja29mZlxuICAgICAgICBjb25zdCBkZWxheSA9IHRoaXMuY2FsY3VsYXRlUmV0cnlEZWxheShhdHRlbXB0KTtcbiAgICAgICAgXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVMb2dnaW5nKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIud2FybignU2VydmljZSByZXF1ZXN0IGZhaWxlZCwgcmV0cnlpbmcnLCB7XG4gICAgICAgICAgICBzZXJ2aWNlOiB0aGlzLmNvbmZpZy5zZXJ2aWNlTmFtZSxcbiAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICAgICAgICBwYXRoOiByZXF1ZXN0LnBhdGgsXG4gICAgICAgICAgICBjb3JyZWxhdGlvbklkLFxuICAgICAgICAgICAgYXR0ZW1wdCxcbiAgICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgICByZXRyeURlbGF5OiBkZWxheVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5zbGVlcChkZWxheSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoJ1JlcXVlc3QgZmFpbGVkIGFmdGVyIGFsbCByZXRyaWVzJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvcnJlbGF0aW9uSWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzaW5nbGUgSFRUUCByZXF1ZXN0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVSZXF1ZXN0PFQ+KFxuICAgIHJlcXVlc3Q6IFNlcnZpY2VSZXF1ZXN0LFxuICAgIGNvcnJlbGF0aW9uSWQ6IHN0cmluZyxcbiAgICBhdHRlbXB0OiBudW1iZXJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfSR7cmVxdWVzdC5wYXRofWA7XG4gICAgY29uc3QgdGltZW91dCA9IHJlcXVlc3QudGltZW91dCB8fCB0aGlzLmNvbmZpZy50aW1lb3V0O1xuICAgIFxuICAgIC8vIFByZXBhcmUgaGVhZGVyc1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ1gtQ29ycmVsYXRpb24tSUQnOiBjb3JyZWxhdGlvbklkLFxuICAgICAgJ1gtU2VydmljZS1DbGllbnQnOiB0aGlzLmNvbmZpZy5zZXJ2aWNlTmFtZSxcbiAgICAgIC4uLnRoaXMuY29uZmlnLmRlZmF1bHRIZWFkZXJzLFxuICAgICAgLi4ucmVxdWVzdC5oZWFkZXJzXG4gICAgfTtcblxuICAgIC8vIENyZWF0ZSBhYm9ydCBjb250cm9sbGVyIGZvciB0aW1lb3V0XG4gICAgY29uc3QgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gYWJvcnRDb250cm9sbGVyLmFib3J0KCksIHRpbWVvdXQpO1xuXG4gICAgLy8gUHJlcGFyZSByZXF1ZXN0IG9wdGlvbnNcbiAgICBjb25zdCBvcHRpb25zOiBhbnkgPSB7XG4gICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgaGVhZGVycyxcbiAgICAgIHNpZ25hbDogYWJvcnRDb250cm9sbGVyLnNpZ25hbFxuICAgIH07XG5cbiAgICAvLyBBZGQgYm9keSBmb3Igbm9uLUdFVCByZXF1ZXN0c1xuICAgIGlmIChyZXF1ZXN0LmJvZHkgJiYgcmVxdWVzdC5tZXRob2QgIT09ICdHRVQnKSB7XG4gICAgICBvcHRpb25zLmJvZHkgPSB0eXBlb2YgcmVxdWVzdC5ib2R5ID09PSAnc3RyaW5nJyA/IHJlcXVlc3QuYm9keSA6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuYm9keSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVxdWVzdFN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgcmVzcG9uc2U6IGFueTtcblxuICAgIHRyeSB7XG4gICAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgb3B0aW9ucyk7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSByZXF1ZXN0U3RhcnQ7XG4gICAgICB0aHJvdyBuZXcgU2VydmljZUNsaWVudEVycm9yKFxuICAgICAgICBgTmV0d29yayBlcnJvcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGNvcnJlbGF0aW9uSWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gcmVxdWVzdFN0YXJ0O1xuXG4gICAgLy8gUGFyc2UgcmVzcG9uc2UgYm9keVxuICAgIGxldCBkYXRhOiBUO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgZGF0YSA9IHRleHQgPyBKU09OLnBhcnNlKHRleHQpIDogbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWYgSlNPTiBwYXJzaW5nIGZhaWxzLCByZXR1cm4gdGV4dCBhcyBkYXRhXG4gICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpIGFzIGFueTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0IGhlYWRlcnMgdG8gcGxhaW4gb2JqZWN0XG4gICAgY29uc3QgcmVzcG9uc2VIZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgcmVzcG9uc2UuaGVhZGVycy5mb3JFYWNoKCh2YWx1ZTogc3RyaW5nLCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgcmVzcG9uc2VIZWFkZXJzW2tleV0gPSB2YWx1ZTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlcnZpY2VSZXNwb25zZTogU2VydmljZVJlc3BvbnNlPFQ+ID0ge1xuICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgaGVhZGVyczogcmVzcG9uc2VIZWFkZXJzLFxuICAgICAgZGF0YSxcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgY29ycmVsYXRpb25JZCxcbiAgICAgIHJldHJ5QXR0ZW1wdHM6IGF0dGVtcHRcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgaWYgcmVzcG9uc2UgaW5kaWNhdGVzIGFuIGVycm9yXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IFNlcnZpY2VDbGllbnRFcnJvcihcbiAgICAgICAgYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCxcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICByZXNwb25zZSxcbiAgICAgICAgY29ycmVsYXRpb25JZFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VydmljZVJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSByZXRyeSBkZWxheSB3aXRoIGV4cG9uZW50aWFsIGJhY2tvZmYgYW5kIGppdHRlclxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSZXRyeURlbGF5KGF0dGVtcHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgYmFzZURlbGF5ID0gdGhpcy5jb25maWcuaW5pdGlhbFJldHJ5RGVsYXkgKiBNYXRoLnBvdyh0aGlzLmNvbmZpZy5yZXRyeU11bHRpcGxpZXIsIGF0dGVtcHQpO1xuICAgIGNvbnN0IG1heERlbGF5ID0gdGhpcy5jb25maWcubWF4UmV0cnlEZWxheTtcbiAgICBjb25zdCBkZWxheSA9IE1hdGgubWluKGJhc2VEZWxheSwgbWF4RGVsYXkpO1xuICAgIFxuICAgIC8vIEFkZCBqaXR0ZXIgKMKxMjUlIG9mIGRlbGF5KVxuICAgIGNvbnN0IGppdHRlciA9IGRlbGF5ICogMC4yNSAqIChNYXRoLnJhbmRvbSgpICogMiAtIDEpO1xuICAgIHJldHVybiBNYXRoLm1heCgwLCBkZWxheSArIGppdHRlcik7XG4gIH1cblxuICAvKipcbiAgICogU2xlZXAgZm9yIHNwZWNpZmllZCBkdXJhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNvcnJlbGF0aW9uIElEIGZvciByZXF1ZXN0IHRyYWNpbmdcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke3RoaXMuY29uZmlnLnNlcnZpY2VOYW1lfS0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBHRVQgcmVxdWVzdHNcbiAgICovXG4gIGFzeW5jIGdldDxUID0gYW55PihwYXRoOiBzdHJpbmcsIG9wdGlvbnM/OiBQYXJ0aWFsPFNlcnZpY2VSZXF1ZXN0Pik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPih7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgcGF0aCxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIFBPU1QgcmVxdWVzdHNcbiAgICovXG4gIGFzeW5jIHBvc3Q8VCA9IGFueT4ocGF0aDogc3RyaW5nLCBib2R5PzogYW55LCBvcHRpb25zPzogUGFydGlhbDxTZXJ2aWNlUmVxdWVzdD4pOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4oe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBwYXRoLFxuICAgICAgYm9keSxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIFBVVCByZXF1ZXN0c1xuICAgKi9cbiAgYXN5bmMgcHV0PFQgPSBhbnk+KHBhdGg6IHN0cmluZywgYm9keT86IGFueSwgb3B0aW9ucz86IFBhcnRpYWw8U2VydmljZVJlcXVlc3Q+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBwYXRoLFxuICAgICAgYm9keSxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIERFTEVURSByZXF1ZXN0c1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlPFQgPSBhbnk+KHBhdGg6IHN0cmluZywgb3B0aW9ucz86IFBhcnRpYWw8U2VydmljZVJlcXVlc3Q+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHtcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICBwYXRoLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgUEFUQ0ggcmVxdWVzdHNcbiAgICovXG4gIGFzeW5jIHBhdGNoPFQgPSBhbnk+KHBhdGg6IHN0cmluZywgYm9keT86IGFueSwgb3B0aW9ucz86IFBhcnRpYWw8U2VydmljZVJlcXVlc3Q+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHtcbiAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgIHBhdGgsXG4gICAgICBib2R5LFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjaXJjdWl0IGJyZWFrZXIgc3RhdGlzdGljc1xuICAgKi9cbiAgZ2V0Q2lyY3VpdEJyZWFrZXJTdGF0cygpIHtcbiAgICByZXR1cm4gdGhpcy5jaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXJ2aWNlIGNsaWVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogU2VydmljZUNsaWVudENvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZGVmYXVsdCBoZWFkZXJzXG4gICAqL1xuICB1cGRhdGVEZWZhdWx0SGVhZGVycyhoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcuZGVmYXVsdEhlYWRlcnMgPSB7XG4gICAgICAuLi50aGlzLmNvbmZpZy5kZWZhdWx0SGVhZGVycyxcbiAgICAgIC4uLmhlYWRlcnNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlYWx0aCBjaGVjayBlbmRwb2ludFxuICAgKi9cbiAgYXN5bmMgaGVhbHRoQ2hlY2soKTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJy9oZWFsdGgnLCB7XG4gICAgICB0aW1lb3V0OiA1MDAwLFxuICAgICAgcmV0cmllczogMSxcbiAgICAgIHNraXBDaXJjdWl0QnJlYWtlcjogdHJ1ZVxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogRGVmYXVsdCBzZXJ2aWNlIGNsaWVudCBjb25maWd1cmF0aW9uc1xuICovXG5leHBvcnQgY29uc3QgU2VydmljZUNsaWVudERlZmF1bHRzID0ge1xuICAvKiogQ29uZmlndXJhdGlvbiBmb3IgY3JpdGljYWwgc2VydmljZXMgKi9cbiAgQ1JJVElDQUw6IHtcbiAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICBtYXhSZXRyaWVzOiAzLFxuICAgIGluaXRpYWxSZXRyeURlbGF5OiAxMDAwLFxuICAgIG1heFJldHJ5RGVsYXk6IDEwMDAwLFxuICAgIHJldHJ5TXVsdGlwbGllcjogMixcbiAgICBlbmFibGVMb2dnaW5nOiB0cnVlLFxuICAgIGNpcmN1aXRCcmVha2VyQ29uZmlnOiBDaXJjdWl0QnJlYWtlckRlZmF1bHRzLkNSSVRJQ0FMXG4gIH0gYXMgUGFydGlhbDxTZXJ2aWNlQ2xpZW50Q29uZmlnPixcblxuICAvKiogQ29uZmlndXJhdGlvbiBmb3IgaW1wb3J0YW50IHNlcnZpY2VzICovXG4gIElNUE9SVEFOVDoge1xuICAgIHRpbWVvdXQ6IDE1MDAwLFxuICAgIG1heFJldHJpZXM6IDIsXG4gICAgaW5pdGlhbFJldHJ5RGVsYXk6IDUwMCxcbiAgICBtYXhSZXRyeURlbGF5OiA1MDAwLFxuICAgIHJldHJ5TXVsdGlwbGllcjogMixcbiAgICBlbmFibGVMb2dnaW5nOiB0cnVlLFxuICAgIGNpcmN1aXRCcmVha2VyQ29uZmlnOiBDaXJjdWl0QnJlYWtlckRlZmF1bHRzLklNUE9SVEFOVFxuICB9IGFzIFBhcnRpYWw8U2VydmljZUNsaWVudENvbmZpZz4sXG5cbiAgLyoqIENvbmZpZ3VyYXRpb24gZm9yIG9wdGlvbmFsIHNlcnZpY2VzICovXG4gIE9QVElPTkFMOiB7XG4gICAgdGltZW91dDogNTAwMCxcbiAgICBtYXhSZXRyaWVzOiAxLFxuICAgIGluaXRpYWxSZXRyeURlbGF5OiAyMDAsXG4gICAgbWF4UmV0cnlEZWxheTogMjAwMCxcbiAgICByZXRyeU11bHRpcGxpZXI6IDIsXG4gICAgZW5hYmxlTG9nZ2luZzogZmFsc2UsXG4gICAgY2lyY3VpdEJyZWFrZXJDb25maWc6IENpcmN1aXRCcmVha2VyRGVmYXVsdHMuT1BUSU9OQUxcbiAgfSBhcyBQYXJ0aWFsPFNlcnZpY2VDbGllbnRDb25maWc+XG59OyJdLCJ2ZXJzaW9uIjozfQ==