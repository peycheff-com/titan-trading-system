{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/security/HMACValidator.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/security/HMACValidator.test.ts"],"sourcesContent":["/**\n * HMACValidator Tests\n * \n * Comprehensive unit tests for the HMACValidator class\n */\n\nimport { HMACValidator, HMACDefaults, createHMACMiddleware } from '../../src/security/HMACValidator';\nimport { Logger } from '../../src/logging/Logger';\nimport { createHmac } from 'crypto';\n\n// Mock Logger\njest.mock('../../src/logging/Logger');\nconst mockLogger = {\n  info: jest.fn(),\n  warn: jest.fn(),\n  error: jest.fn(),\n  debug: jest.fn()\n} as any;\n\ndescribe('HMACValidator', () => {\n  let validator: HMACValidator;\n  const testSecret = 'test-secret-key';\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    (Logger.getInstance as jest.Mock).mockReturnValue(mockLogger);\n    \n    validator = new HMACValidator({\n      secret: testSecret,\n      algorithm: 'sha256',\n      headerName: 'x-signature',\n      timestampHeaderName: 'x-timestamp',\n      timestampTolerance: 300,\n      requireTimestamp: true\n    });\n  });\n\n  describe('constructor', () => {\n    it('should initialize with correct configuration', () => {\n      const config = validator.getConfig();\n      \n      expect(config.algorithm).toBe('sha256');\n      expect(config.headerName).toBe('x-signature');\n      expect(config.timestampHeaderName).toBe('x-timestamp');\n      expect(config.timestampTolerance).toBe(300);\n      expect(config.requireTimestamp).toBe(true);\n    });\n\n    it('should throw error if secret is missing', () => {\n      expect(() => new HMACValidator({ secret: '' })).toThrow('HMAC secret is required');\n    });\n\n    it('should log initialization', () => {\n      expect(mockLogger.info).toHaveBeenCalledWith(\n        'HMAC validator initialized',\n        undefined,\n        expect.objectContaining({\n          algorithm: 'sha256',\n          headerName: 'x-signature',\n          timestampHeaderName: 'x-timestamp',\n          timestampTolerance: 300,\n          requireTimestamp: true\n        })\n      );\n    });\n  });\n\n  describe('fromEnvironment', () => {\n    const originalEnv = process.env;\n\n    beforeEach(() => {\n      process.env = { ...originalEnv };\n    });\n\n    afterEach(() => {\n      process.env = originalEnv;\n    });\n\n    it('should create validator from environment variables', () => {\n      process.env.HMAC_SECRET = 'env-secret';\n      process.env.HMAC_ALGORITHM = 'sha512';\n      process.env.HMAC_HEADER_NAME = 'x-custom-signature';\n      process.env.HMAC_TIMESTAMP_TOLERANCE = '600';\n\n      const envValidator = HMACValidator.fromEnvironment();\n      const config = envValidator.getConfig();\n\n      expect(config.algorithm).toBe('sha512');\n      expect(config.headerName).toBe('x-custom-signature');\n      expect(config.timestampTolerance).toBe(600);\n    });\n\n    it('should throw error if HMAC_SECRET is missing', () => {\n      delete process.env.HMAC_SECRET;\n      \n      expect(() => HMACValidator.fromEnvironment()).toThrow('HMAC_SECRET environment variable is required');\n    });\n\n    it('should use defaults for missing optional environment variables', () => {\n      process.env.HMAC_SECRET = 'env-secret';\n      \n      const envValidator = HMACValidator.fromEnvironment();\n      const config = envValidator.getConfig();\n\n      expect(config.algorithm).toBe('sha256');\n      expect(config.headerName).toBe('x-signature');\n      expect(config.timestampTolerance).toBe(300);\n    });\n  });\n\n  describe('generateSignature', () => {\n    it('should generate correct signature without timestamp', () => {\n      const payload = 'test payload';\n      const signature = validator.generateSignature(payload);\n      \n      const expectedSignature = createHmac('sha256', testSecret)\n        .update(payload, 'utf8')\n        .digest('hex');\n      \n      expect(signature).toBe(expectedSignature);\n    });\n\n    it('should generate correct signature with timestamp', () => {\n      const payload = 'test payload';\n      const timestamp = 1234567890;\n      const signature = validator.generateSignature(payload, timestamp);\n      \n      const expectedSignature = createHmac('sha256', testSecret)\n        .update(`${timestamp}.${payload}`, 'utf8')\n        .digest('hex');\n      \n      expect(signature).toBe(expectedSignature);\n    });\n  });\n\n  describe('validateRequest', () => {\n    it('should validate correct signature with timestamp', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const signature = validator.generateSignature(payload, timestamp);\n      \n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(true);\n      expect(result.error).toBeUndefined();\n      expect(result.timestamp).toBe(timestamp);\n    });\n\n    it('should reject missing signature header', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      \n      const headers = {\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Missing x-signature header');\n    });\n\n    it('should reject missing timestamp header when required', () => {\n      const payload = 'test payload';\n      const signature = validator.generateSignature(payload);\n      \n      const headers = {\n        'x-signature': signature\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Missing x-timestamp header');\n    });\n\n    it('should reject invalid timestamp format', () => {\n      const payload = 'test payload';\n      const signature = validator.generateSignature(payload);\n      \n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': 'invalid-timestamp'\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid timestamp format');\n    });\n\n    it('should reject old timestamps', () => {\n      const payload = 'test payload';\n      const oldTimestamp = Math.floor(Date.now() / 1000) - 600; // 10 minutes ago\n      const signature = validator.generateSignature(payload, oldTimestamp);\n      \n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': oldTimestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Timestamp too old');\n    });\n\n    it('should reject future timestamps', () => {\n      const payload = 'test payload';\n      const futureTimestamp = Math.floor(Date.now() / 1000) + 600; // 10 minutes in future\n      const signature = validator.generateSignature(payload, futureTimestamp);\n      \n      const headers = {\n        'x-signature': signature,\n        'x-timestamp': futureTimestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('too far in future');\n    });\n\n    it('should reject invalid signature format', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      \n      const headers = {\n        'x-signature': 'invalid-signature-format!@#',\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid signature format');\n    });\n\n    it('should reject incorrect signature', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const wrongSignature = createHmac('sha256', 'wrong-secret')\n        .update(`${timestamp}.${payload}`, 'utf8')\n        .digest('hex');\n      \n      const headers = {\n        'x-signature': wrongSignature,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid signature');\n    });\n\n    it('should handle case-insensitive headers', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const signature = validator.generateSignature(payload, timestamp);\n      \n      const headers = {\n        'X-SIGNATURE': signature,\n        'X-TIMESTAMP': timestamp.toString()\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n\n    it('should handle array header values', () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const signature = validator.generateSignature(payload, timestamp);\n      \n      const headers = {\n        'x-signature': [signature, 'other-value'],\n        'x-timestamp': [timestamp.toString()]\n      };\n      \n      const result = validator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n\n    it('should work without timestamp when not required', () => {\n      const noTimestampValidator = new HMACValidator({\n        secret: testSecret,\n        requireTimestamp: false\n      });\n      \n      const payload = 'test payload';\n      const signature = noTimestampValidator.generateSignature(payload);\n      \n      const headers = {\n        'x-signature': signature\n      };\n      \n      const result = noTimestampValidator.validateRequest(payload, headers);\n      \n      expect(result.valid).toBe(true);\n    });\n  });\n\n  describe('createHeaders', () => {\n    it('should create headers with timestamp', () => {\n      const payload = 'test payload';\n      const headers = validator.createHeaders(payload, true);\n      \n      expect(headers['x-signature']).toBeDefined();\n      expect(headers['x-timestamp']).toBeDefined();\n      \n      // Verify signature is correct\n      const timestamp = parseInt(headers['x-timestamp']);\n      const expectedSignature = validator.generateSignature(payload, timestamp);\n      expect(headers['x-signature']).toBe(expectedSignature);\n    });\n\n    it('should create headers without timestamp', () => {\n      const payload = 'test payload';\n      const headers = validator.createHeaders(payload, false);\n      \n      expect(headers['x-signature']).toBeDefined();\n      expect(headers['x-timestamp']).toBeUndefined();\n      \n      // Verify signature is correct\n      const expectedSignature = validator.generateSignature(payload);\n      expect(headers['x-signature']).toBe(expectedSignature);\n    });\n  });\n\n  describe('utility methods', () => {\n    it('should check if enabled', () => {\n      expect(validator.isEnabled()).toBe(true);\n      \n      // Test the isEnabled method logic directly\n      const testValidator = new HMACValidator({ secret: 'test-secret' });\n      expect(testValidator.isEnabled()).toBe(true);\n      \n      // We can't test with empty secret since constructor throws error\n      // This is the correct behavior - empty secret should not be allowed\n    });\n\n    it('should update secret', () => {\n      const newSecret = 'new-secret';\n      validator.updateSecret(newSecret);\n      \n      // Test with new secret\n      const payload = 'test payload';\n      const signature = createHmac('sha256', newSecret)\n        .update(payload, 'utf8')\n        .digest('hex');\n      \n      const headers = { 'x-signature': signature };\n      const noTimestampValidator = new HMACValidator({\n        secret: newSecret,\n        requireTimestamp: false\n      });\n      \n      const result = noTimestampValidator.validateRequest(payload, headers);\n      expect(result.valid).toBe(true);\n    });\n\n    it('should throw error when updating to empty secret', () => {\n      expect(() => validator.updateSecret('')).toThrow('HMAC secret cannot be empty');\n    });\n\n    it('should test signature validation', () => {\n      const payload = 'test payload';\n      const signature = validator.generateSignature(payload);\n      \n      expect(validator.test(payload, signature)).toBe(true);\n      expect(validator.test(payload, 'wrong-signature')).toBe(false);\n    });\n  });\n\n  describe('createHMACMiddleware', () => {\n    let mockRequest: any;\n    let mockReply: any;\n\n    beforeEach(() => {\n      mockRequest = {\n        url: '/test',\n        ip: '127.0.0.1',\n        headers: {},\n        rawBody: '',\n        body: {}\n      };\n      \n      mockReply = {\n        status: jest.fn().mockReturnThis(),\n        send: jest.fn()\n      };\n    });\n\n    it('should skip validation for health endpoints', async () => {\n      mockRequest.url = '/health';\n      \n      const middleware = createHMACMiddleware(validator);\n      await middleware(mockRequest, mockReply);\n      \n      expect(mockReply.status).not.toHaveBeenCalled();\n    });\n\n    it('should validate HMAC signature', async () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const signature = validator.generateSignature(payload, timestamp);\n      \n      mockRequest.rawBody = payload;\n      mockRequest.headers = {\n        'x-signature': signature,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const middleware = createHMACMiddleware(validator);\n      await middleware(mockRequest, mockReply);\n      \n      expect(mockReply.status).not.toHaveBeenCalled();\n      expect(mockRequest.hmacValidation).toBeDefined();\n      expect(mockRequest.hmacValidation.valid).toBe(true);\n    });\n\n    it('should reject invalid HMAC signature', async () => {\n      const payload = 'test payload';\n      mockRequest.rawBody = payload;\n      mockRequest.headers = {\n        'x-signature': 'invalid-signature'\n      };\n      \n      const middleware = createHMACMiddleware(validator);\n      await middleware(mockRequest, mockReply);\n      \n      expect(mockReply.status).toHaveBeenCalledWith(401);\n      expect(mockReply.send).toHaveBeenCalledWith({\n        error: 'Unauthorized',\n        message: expect.any(String),\n        timestamp: expect.any(String)\n      });\n    });\n  });\n\n  describe('defaults', () => {\n    it('should have correct default configurations', () => {\n      expect(HMACDefaults.development).toEqual({\n        algorithm: 'sha256',\n        timestampTolerance: 600,\n        requireTimestamp: false\n      });\n\n      expect(HMACDefaults.production).toEqual({\n        algorithm: 'sha512',\n        timestampTolerance: 300,\n        requireTimestamp: true\n      });\n\n      expect(HMACDefaults.test).toEqual({\n        algorithm: 'sha256',\n        timestampTolerance: 3600,\n        requireTimestamp: false\n      });\n    });\n  });\n\n  describe('timing attack protection', () => {\n    it('should take similar time for valid and invalid signatures', async () => {\n      const payload = 'test payload';\n      const timestamp = Math.floor(Date.now() / 1000);\n      const validSignature = validator.generateSignature(payload, timestamp);\n      const invalidSignature = 'a'.repeat(validSignature.length);\n      \n      const validHeaders = {\n        'x-signature': validSignature,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      const invalidHeaders = {\n        'x-signature': invalidSignature,\n        'x-timestamp': timestamp.toString()\n      };\n      \n      // Measure time for valid signature\n      const validStart = Date.now();\n      validator.validateRequest(payload, validHeaders);\n      const validTime = Date.now() - validStart;\n      \n      // Measure time for invalid signature\n      const invalidStart = Date.now();\n      validator.validateRequest(payload, invalidHeaders);\n      const invalidTime = Date.now() - invalidStart;\n      \n      // Times should be similar (within reasonable margin)\n      const timeDifference = Math.abs(validTime - invalidTime);\n      expect(timeDifference).toBeLessThan(50); // 50ms tolerance\n    });\n  });\n});"],"version":3}