{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/services/CircuitBreaker.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/services/CircuitBreaker.test.ts"],"sourcesContent":["/**\n * CircuitBreaker Tests\n * \n * Comprehensive unit tests for the CircuitBreaker class\n */\n\nimport { CircuitBreaker, CircuitBreakerState, CircuitBreakerError, CircuitBreakerDefaults } from '../../src/services/CircuitBreaker';\nimport { Logger } from '../../src/logging/Logger';\n\n// Mock Logger\njest.mock('../../src/logging/Logger');\nconst mockLogger = {\n  info: jest.fn(),\n  warn: jest.fn(),\n  error: jest.fn(),\n  debug: jest.fn()\n} as any;\n\ndescribe('CircuitBreaker', () => {\n  let circuitBreaker: CircuitBreaker;\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    (Logger.getInstance as jest.Mock).mockReturnValue(mockLogger);\n    \n    circuitBreaker = new CircuitBreaker({\n      name: 'test-service',\n      failureThreshold: 3,\n      recoveryTimeout: 1000,\n      requestTimeout: 500,\n      monitoringPeriod: 5000,\n      halfOpenMaxCalls: 2\n    });\n  });\n\n  describe('constructor', () => {\n    it('should initialize with correct configuration', () => {\n      const stats = circuitBreaker.getStats();\n      \n      expect(stats.state).toBe(CircuitBreakerState.CLOSED);\n      expect(stats.failureCount).toBe(0);\n      expect(stats.successCount).toBe(0);\n      expect(stats.totalRequests).toBe(0);\n    });\n\n    it('should log initialization', () => {\n      expect(mockLogger.info).toHaveBeenCalledWith(\n        'Circuit breaker initialized',\n        undefined,\n        expect.objectContaining({\n          name: 'test-service',\n          failureThreshold: 3,\n          recoveryTimeout: 1000,\n          requestTimeout: 500\n        })\n      );\n    });\n  });\n\n  describe('execute - CLOSED state', () => {\n    it('should execute function successfully', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      const result = await circuitBreaker.execute(mockFn);\n      \n      expect(result).toBe('success');\n      expect(mockFn).toHaveBeenCalledTimes(1);\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.state).toBe(CircuitBreakerState.CLOSED);\n      expect(stats.successCount).toBe(1);\n      expect(stats.totalRequests).toBe(1);\n    });\n\n    it('should handle function failure', async () => {\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.state).toBe(CircuitBreakerState.CLOSED);\n      expect(stats.failureCount).toBe(1);\n      expect(stats.totalRequests).toBe(1);\n    });\n\n    it('should transition to OPEN after failure threshold', async () => {\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      // Fail 3 times (threshold)\n      for (let i = 0; i < 3; i++) {\n        await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      }\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.state).toBe(CircuitBreakerState.OPEN);\n      expect(stats.failureCount).toBe(3);\n    });\n\n    it('should reset failure count on success', async () => {\n      const mockFn = jest.fn()\n        .mockRejectedValueOnce(new Error('Test error'))\n        .mockResolvedValue('success');\n      \n      // Fail once\n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      expect(circuitBreaker.getStats().failureCount).toBe(1);\n      \n      // Succeed\n      await circuitBreaker.execute(mockFn);\n      expect(circuitBreaker.getStats().failureCount).toBe(0);\n    });\n\n    it('should handle timeout', async () => {\n      const mockFn = jest.fn().mockImplementation(() => \n        new Promise(resolve => setTimeout(resolve, 1000))\n      );\n      \n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Request timeout');\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.failureCount).toBe(1);\n    });\n  });\n\n  describe('execute - OPEN state', () => {\n    beforeEach(async () => {\n      // Force circuit breaker to OPEN state\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      for (let i = 0; i < 3; i++) {\n        await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      }\n    });\n\n    it('should reject requests immediately', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow(CircuitBreakerError);\n      \n      expect(mockFn).not.toHaveBeenCalled();\n    });\n\n    it('should transition to HALF_OPEN after recovery timeout', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      // Wait for recovery timeout\n      await new Promise(resolve => setTimeout(resolve, 1100));\n      \n      await circuitBreaker.execute(mockFn);\n      \n      expect(circuitBreaker.getStats().state).toBe(CircuitBreakerState.HALF_OPEN);\n    });\n  });\n\n  describe('execute - HALF_OPEN state', () => {\n    beforeEach(async () => {\n      // Force to OPEN state\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      for (let i = 0; i < 3; i++) {\n        await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      }\n      \n      // Wait for recovery timeout and transition to HALF_OPEN\n      await new Promise(resolve => setTimeout(resolve, 1100));\n      const successFn = jest.fn().mockResolvedValue('success');\n      await circuitBreaker.execute(successFn);\n    });\n\n    it('should allow limited calls', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      // Should allow one more call (total 2 in half-open)\n      await circuitBreaker.execute(mockFn);\n      \n      expect(circuitBreaker.getStats().state).toBe(CircuitBreakerState.CLOSED);\n    });\n\n    it('should transition to CLOSED after successful calls', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      await circuitBreaker.execute(mockFn);\n      \n      expect(circuitBreaker.getStats().state).toBe(CircuitBreakerState.CLOSED);\n    });\n\n    it('should transition to OPEN on failure', async () => {\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      \n      expect(circuitBreaker.getStats().state).toBe(CircuitBreakerState.OPEN);\n    });\n\n    it('should reject requests after max calls', async () => {\n      const mockFn = jest.fn().mockResolvedValue('success');\n      \n      // Complete the half-open transition\n      await circuitBreaker.execute(mockFn);\n      \n      // Now in CLOSED state, should accept more calls\n      await circuitBreaker.execute(mockFn);\n      expect(mockFn).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('state transitions', () => {\n    it('should emit stateChange events', async () => {\n      const stateChangeHandler = jest.fn();\n      circuitBreaker.on('stateChange', stateChangeHandler);\n      \n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      // Trigger state change to OPEN\n      for (let i = 0; i < 3; i++) {\n        await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      }\n      \n      expect(stateChangeHandler).toHaveBeenCalledWith({\n        from: CircuitBreakerState.CLOSED,\n        to: CircuitBreakerState.OPEN,\n        stats: expect.any(Object)\n      });\n    });\n  });\n\n  describe('admin operations', () => {\n    it('should force close circuit breaker', () => {\n      circuitBreaker.forceOpen();\n      expect(circuitBreaker.getState()).toBe(CircuitBreakerState.OPEN);\n      \n      circuitBreaker.forceClose();\n      expect(circuitBreaker.getState()).toBe(CircuitBreakerState.CLOSED);\n    });\n\n    it('should reset statistics', async () => {\n      const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));\n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');\n      \n      expect(circuitBreaker.getStats().failureCount).toBe(1);\n      \n      circuitBreaker.reset();\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.failureCount).toBe(0);\n      expect(stats.successCount).toBe(0);\n      expect(stats.totalRequests).toBe(0);\n    });\n  });\n\n  describe('utility methods', () => {\n    it('should calculate failure rate correctly', async () => {\n      const mockFn = jest.fn()\n        .mockRejectedValueOnce(new Error('error1'))\n        .mockRejectedValueOnce(new Error('error2'))\n        .mockResolvedValueOnce('success');\n      \n      // Two failures, then success\n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('error1');\n      await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('error2');\n      await circuitBreaker.execute(mockFn);\n      \n      const stats = circuitBreaker.getStats();\n      expect(stats.totalRequests).toBe(3);\n      // After success in CLOSED state, failure count is reset to 0\n      expect(stats.failureCount).toBe(0);\n      expect(stats.successCount).toBe(1);\n      \n      // Test with no success to see actual failure rate\n      const failureOnlyBreaker = new CircuitBreaker({\n        name: 'failure-test',\n        failureThreshold: 5,\n        recoveryTimeout: 1000,\n        requestTimeout: 500,\n        monitoringPeriod: 5000,\n        halfOpenMaxCalls: 2\n      });\n      \n      const failFn = jest.fn().mockRejectedValue(new Error('error'));\n      \n      await expect(failureOnlyBreaker.execute(failFn)).rejects.toThrow('error');\n      await expect(failureOnlyBreaker.execute(failFn)).rejects.toThrow('error');\n      \n      expect(failureOnlyBreaker.getFailureRate()).toBeCloseTo(1.0);\n      expect(failureOnlyBreaker.getSuccessRate()).toBeCloseTo(0.0);\n    });\n\n    it('should check if healthy', () => {\n      expect(circuitBreaker.isHealthy()).toBe(true);\n      \n      circuitBreaker.forceOpen();\n      expect(circuitBreaker.isHealthy()).toBe(false);\n    });\n\n    it('should calculate time until next attempt', () => {\n      circuitBreaker.forceOpen();\n      const timeUntilNext = circuitBreaker.getTimeUntilNextAttempt();\n      expect(timeUntilNext).toBeGreaterThan(0);\n    });\n  });\n\n  describe('defaults', () => {\n    it('should have correct default configurations', () => {\n      expect(CircuitBreakerDefaults.http).toEqual({\n        failureThreshold: 5,\n        recoveryTimeout: 30000,\n        requestTimeout: 10000,\n        monitoringPeriod: 60000,\n        halfOpenMaxCalls: 3,\n        name: 'http-service'\n      });\n\n      expect(CircuitBreakerDefaults.database).toEqual({\n        failureThreshold: 3,\n        recoveryTimeout: 60000,\n        requestTimeout: 5000,\n        monitoringPeriod: 300000,\n        halfOpenMaxCalls: 2,\n        name: 'database-service'\n      });\n    });\n  });\n\n  describe('error handling', () => {\n    it('should handle CircuitBreakerError correctly', async () => {\n      circuitBreaker.forceOpen();\n      \n      try {\n        await circuitBreaker.execute(() => Promise.resolve('test'));\n      } catch (error) {\n        expect(error).toBeInstanceOf(CircuitBreakerError);\n        expect((error as CircuitBreakerError).state).toBe(CircuitBreakerState.OPEN);\n        expect((error as CircuitBreakerError).stats).toBeDefined();\n      }\n    });\n  });\n});"],"version":3}