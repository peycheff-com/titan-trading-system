{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/services/ServiceClient.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/services/ServiceClient.ts"],"sourcesContent":["/**\n * ServiceClient - Robust HTTP client for inter-service communication\n * \n * Provides a robust HTTP client with automatic retries, exponential backoff,\n * circuit breaker pattern, request/response logging, and Railway service URL support.\n * \n * Requirements: 2.1.1, 2.1.2, 2.1.3, 2.1.4, 2.1.5\n */\n\nimport { EventEmitter } from 'events';\nimport { CircuitBreaker, CircuitBreakerConfig, CircuitBreakerDefaults } from './CircuitBreaker.js';\nimport { Logger } from '../logging/Logger.js';\n\n/**\n * HTTP methods supported by ServiceClient\n */\nexport type HttpMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n\n/**\n * Request configuration\n */\nexport interface RequestConfig {\n  method: HttpMethod;\n  url: string;\n  headers?: Record<string, string>;\n  body?: any;\n  timeout?: number;\n  retries?: number;\n  retryDelay?: number;\n  correlationId?: string;\n}\n\n/**\n * Response object\n */\nexport interface ServiceResponse<T = any> {\n  status: number;\n  statusText: string;\n  headers: Record<string, string>;\n  data: T;\n  duration: number;\n  correlationId?: string;\n}\n\n/**\n * Retry configuration\n */\nexport interface RetryConfig {\n  maxRetries: number;\n  initialDelay: number;\n  maxDelay: number;\n  backoffMultiplier: number;\n  retryableStatusCodes: number[];\n  retryableErrors: string[];\n}\n\n/**\n * Service client configuration\n */\nexport interface ServiceClientConfig {\n  baseUrl?: string;\n  defaultTimeout: number;\n  defaultHeaders: Record<string, string>;\n  retry: RetryConfig;\n  circuitBreaker: CircuitBreakerConfig;\n  logRequests: boolean;\n  logResponses: boolean;\n  maxResponseBodyLogSize: number;\n}\n\n/**\n * Request/Response interceptor functions\n */\nexport type RequestInterceptor = (config: RequestConfig) => RequestConfig | Promise<RequestConfig>;\nexport type ResponseInterceptor<T = any> = (response: ServiceResponse<T>) => ServiceResponse<T> | Promise<ServiceResponse<T>>;\nexport type ErrorInterceptor = (error: ServiceClientError) => ServiceClientError | Promise<ServiceClientError>;\n\n/**\n * Service client error\n */\nexport class ServiceClientError extends Error {\n  constructor(\n    message: string,\n    public readonly status?: number,\n    public readonly response?: ServiceResponse,\n    public readonly config?: RequestConfig,\n    public readonly cause?: Error\n  ) {\n    super(message);\n    this.name = 'ServiceClientError';\n  }\n\n  /**\n   * Check if error is retryable\n   */\n  isRetryable(): boolean {\n    // Network errors are retryable\n    if (!this.status) return true;\n    \n    // 5xx server errors are retryable\n    if (this.status >= 500) return true;\n    \n    // 429 rate limit is retryable\n    if (this.status === 429) return true;\n    \n    // 408 request timeout is retryable\n    if (this.status === 408) return true;\n    \n    return false;\n  }\n\n  /**\n   * Check if error is a timeout\n   */\n  isTimeout(): boolean {\n    return this.message.includes('timeout') || this.status === 408;\n  }\n\n  /**\n   * Check if error is a network error\n   */\n  isNetworkError(): boolean {\n    return !this.status && this.cause !== undefined;\n  }\n}\n\n/**\n * Default retry configuration\n */\nconst DEFAULT_RETRY_CONFIG: RetryConfig = {\n  maxRetries: 3,\n  initialDelay: 1000,      // 1 second\n  maxDelay: 30000,         // 30 seconds\n  backoffMultiplier: 2,\n  retryableStatusCodes: [408, 429, 500, 502, 503, 504],\n  retryableErrors: ['ECONNRESET', 'ENOTFOUND', 'ECONNREFUSED', 'ETIMEDOUT']\n};\n\n/**\n * Default service client configuration\n */\nconst DEFAULT_CONFIG: ServiceClientConfig = {\n  defaultTimeout: 10000,   // 10 seconds\n  defaultHeaders: {\n    'Content-Type': 'application/json',\n    'User-Agent': 'TitanBrain/1.0.0'\n  },\n  retry: DEFAULT_RETRY_CONFIG,\n  circuitBreaker: CircuitBreakerDefaults.http,\n  logRequests: true,\n  logResponses: true,\n  maxResponseBodyLogSize: 1024 // 1KB\n};\n\n/**\n * Service client for robust HTTP communication\n */\nexport class ServiceClient extends EventEmitter {\n  private config: ServiceClientConfig;\n  private circuitBreaker: CircuitBreaker;\n  private logger: Logger;\n  private requestInterceptors: RequestInterceptor[] = [];\n  private responseInterceptors: ResponseInterceptor[] = [];\n  private errorInterceptors: ErrorInterceptor[] = [];\n\n  constructor(config: Partial<ServiceClientConfig> = {}, logger?: Logger) {\n    super();\n    \n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.logger = logger ?? Logger.getInstance('service-client');\n    \n    // Initialize circuit breaker\n    this.circuitBreaker = new CircuitBreaker(\n      { ...this.config.circuitBreaker },\n      this.logger\n    );\n    \n    // Forward circuit breaker events\n    this.circuitBreaker.on('stateChange', (event) => {\n      this.emit('circuitBreakerStateChange', event);\n    });\n    \n    this.logger.info('Service client initialized', undefined, {\n      baseUrl: this.config.baseUrl,\n      defaultTimeout: this.config.defaultTimeout,\n      maxRetries: this.config.retry.maxRetries,\n      circuitBreakerName: this.config.circuitBreaker.name\n    });\n  }\n\n  /**\n   * Make an HTTP request\n   */\n  async request<T = any>(config: RequestConfig): Promise<ServiceResponse<T>> {\n    // Apply request interceptors\n    let processedConfig = config;\n    for (const interceptor of this.requestInterceptors) {\n      processedConfig = await interceptor(processedConfig);\n    }\n    \n    // Add default configuration\n    const finalConfig: RequestConfig = {\n      timeout: this.config.defaultTimeout,\n      retries: this.config.retry.maxRetries,\n      retryDelay: this.config.retry.initialDelay,\n      ...processedConfig,\n      headers: {\n        ...this.config.defaultHeaders,\n        ...processedConfig.headers\n      }\n    };\n    \n    // Add correlation ID if not present\n    if (!finalConfig.correlationId) {\n      finalConfig.correlationId = this.generateCorrelationId();\n    }\n    \n    // Add correlation ID to headers\n    finalConfig.headers!['x-correlation-id'] = finalConfig.correlationId;\n    \n    // Build full URL\n    const fullUrl = this.buildUrl(finalConfig.url);\n    finalConfig.url = fullUrl;\n    \n    this.logger.debug('Making HTTP request', finalConfig.correlationId, {\n      method: finalConfig.method,\n      url: fullUrl,\n      timeout: finalConfig.timeout,\n      retries: finalConfig.retries\n    });\n    \n    try {\n      // Execute with circuit breaker protection\n      const response = await this.circuitBreaker.execute(async () => {\n        return await this.executeWithRetry(finalConfig);\n      });\n      \n      // Apply response interceptors\n      let processedResponse = response;\n      for (const interceptor of this.responseInterceptors) {\n        processedResponse = await interceptor(processedResponse) as ServiceResponse<T>;\n      }\n      \n      this.emit('response', processedResponse);\n      return processedResponse as ServiceResponse<T>;\n      \n    } catch (error) {\n      let processedError = error instanceof ServiceClientError \n        ? error \n        : new ServiceClientError(\n            error instanceof Error ? error.message : String(error),\n            undefined,\n            undefined,\n            finalConfig,\n            error instanceof Error ? error : undefined\n          );\n      \n      // Apply error interceptors\n      for (const interceptor of this.errorInterceptors) {\n        processedError = await interceptor(processedError);\n      }\n      \n      this.emit('error', processedError);\n      throw processedError;\n    }\n  }\n\n  /**\n   * Execute request with retry logic\n   */\n  private async executeWithRetry<T>(config: RequestConfig): Promise<ServiceResponse<T>> {\n    let lastError: ServiceClientError | undefined;\n    let attempt = 0;\n    \n    while (attempt <= (config.retries || 0)) {\n      attempt++;\n      \n      try {\n        const response = await this.executeRequest<T>(config, attempt);\n        \n        if (attempt > 1) {\n          this.logger.info('Request succeeded after retry', config.correlationId, {\n            attempt,\n            url: config.url,\n            method: config.method\n          });\n        }\n        \n        return response;\n        \n      } catch (error) {\n        lastError = error instanceof ServiceClientError \n          ? error \n          : new ServiceClientError(\n              error instanceof Error ? error.message : String(error),\n              undefined,\n              undefined,\n              config,\n              error instanceof Error ? error : undefined\n            );\n        \n        // Check if we should retry\n        if (attempt <= (config.retries || 0) && this.shouldRetry(lastError, attempt, config.retries || 0)) {\n          const delay = this.calculateRetryDelay(attempt);\n          \n          this.logger.warn('Request failed, retrying', config.correlationId, {\n            attempt,\n            maxRetries: config.retries,\n            delay,\n            error: lastError.message,\n            status: lastError.status\n          });\n          \n          // Wait before retry\n          await new Promise(resolve => setTimeout(resolve, delay));\n          continue;\n        }\n        \n        // No more retries or not retryable\n        this.logger.error('Request failed permanently', lastError, config.correlationId, {\n          attempt,\n          maxRetries: config.retries,\n          url: config.url,\n          method: config.method\n        });\n        \n        throw lastError;\n      }\n    }\n    \n    throw lastError!;\n  }\n\n  /**\n   * Execute a single HTTP request\n   */\n  private async executeRequest<T>(config: RequestConfig, attempt: number): Promise<ServiceResponse<T>> {\n    const startTime = Date.now();\n    \n    try {\n      // Log request\n      if (this.config.logRequests) {\n        this.logger.debug('HTTP request', config.correlationId, {\n          method: config.method,\n          url: config.url,\n          attempt,\n          headers: this.sanitizeHeaders(config.headers || {}),\n          bodySize: config.body ? JSON.stringify(config.body).length : 0\n        });\n      }\n      \n      // Make the actual HTTP request using fetch\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), config.timeout);\n      \n      const fetchOptions: RequestInit = {\n        method: config.method,\n        headers: config.headers,\n        body: config.body ? JSON.stringify(config.body) : undefined,\n        signal: controller.signal\n      };\n      \n      const response = await fetch(config.url, fetchOptions);\n      clearTimeout(timeoutId);\n      \n      const duration = Date.now() - startTime;\n      \n      // Parse response\n      let data: T;\n      const contentType = response.headers.get('content-type') || '';\n      \n      if (contentType.includes('application/json')) {\n        data = await response.json() as T;\n      } else {\n        data = await response.text() as T;\n      }\n      \n      // Build response headers object\n      const responseHeaders: Record<string, string> = {};\n      response.headers.forEach((value, key) => {\n        responseHeaders[key] = value;\n      });\n      \n      const serviceResponse: ServiceResponse<T> = {\n        status: response.status,\n        statusText: response.statusText,\n        headers: responseHeaders,\n        data,\n        duration,\n        correlationId: config.correlationId\n      };\n      \n      // Log response\n      if (this.config.logResponses) {\n        this.logger.debug('HTTP response', config.correlationId, {\n          status: response.status,\n          statusText: response.statusText,\n          duration,\n          responseSize: this.getResponseSize(data),\n          responseBody: this.truncateResponseBody(data)\n        });\n      }\n      \n      // Check for HTTP errors\n      if (!response.ok) {\n        throw new ServiceClientError(\n          `HTTP ${response.status}: ${response.statusText}`,\n          response.status,\n          serviceResponse,\n          config\n        );\n      }\n      \n      return serviceResponse;\n      \n    } catch (error) {\n      const duration = Date.now() - startTime;\n      \n      if (error instanceof ServiceClientError) {\n        throw error;\n      }\n      \n      // Handle fetch errors\n      if (error instanceof Error) {\n        if (error.name === 'AbortError') {\n          throw new ServiceClientError(\n            `Request timeout after ${config.timeout}ms`,\n            408,\n            undefined,\n            config,\n            error\n          );\n        }\n        \n        throw new ServiceClientError(\n          `Network error: ${error.message}`,\n          undefined,\n          undefined,\n          config,\n          error\n        );\n      }\n      \n      throw new ServiceClientError(\n        'Unknown error occurred',\n        undefined,\n        undefined,\n        config\n      );\n    }\n  }\n\n  /**\n   * Check if error should be retried\n   */\n  private shouldRetry(error: ServiceClientError, attempt: number, maxRetries: number): boolean {\n    // Don't retry if we've exceeded max attempts\n    if (attempt > maxRetries) {\n      return false;\n    }\n    \n    // Check if error is retryable\n    if (!error.isRetryable()) {\n      return false;\n    }\n    \n    return true;\n  }\n\n  /**\n   * Calculate retry delay with exponential backoff\n   */\n  private calculateRetryDelay(attempt: number): number {\n    const delay = this.config.retry.initialDelay * Math.pow(this.config.retry.backoffMultiplier, attempt - 1);\n    return Math.min(delay, this.config.retry.maxDelay);\n  }\n\n  /**\n   * Build full URL from base URL and path\n   */\n  private buildUrl(url: string): string {\n    if (url.startsWith('http://') || url.startsWith('https://')) {\n      return url;\n    }\n    \n    if (this.config.baseUrl) {\n      const baseUrl = this.config.baseUrl.endsWith('/') \n        ? this.config.baseUrl.slice(0, -1) \n        : this.config.baseUrl;\n      const path = url.startsWith('/') ? url : `/${url}`;\n      return `${baseUrl}${path}`;\n    }\n    \n    return url;\n  }\n\n  /**\n   * Generate correlation ID\n   */\n  private generateCorrelationId(): string {\n    return `req_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n  }\n\n  /**\n   * Sanitize headers for logging (remove sensitive values)\n   */\n  private sanitizeHeaders(headers: Record<string, string>): Record<string, string> {\n    const sanitized: Record<string, string> = {};\n    const sensitiveHeaders = ['authorization', 'x-api-key', 'x-signature'];\n    \n    for (const [key, value] of Object.entries(headers)) {\n      if (sensitiveHeaders.includes(key.toLowerCase())) {\n        sanitized[key] = '[REDACTED]';\n      } else {\n        sanitized[key] = value;\n      }\n    }\n    \n    return sanitized;\n  }\n\n  /**\n   * Get response size for logging\n   */\n  private getResponseSize(data: any): number {\n    if (typeof data === 'string') {\n      return data.length;\n    }\n    return JSON.stringify(data).length;\n  }\n\n  /**\n   * Truncate response body for logging\n   */\n  private truncateResponseBody(data: any): any {\n    const str = typeof data === 'string' ? data : JSON.stringify(data);\n    if (str.length <= this.config.maxResponseBodyLogSize) {\n      return data;\n    }\n    \n    return str.substring(0, this.config.maxResponseBodyLogSize) + '... [truncated]';\n  }\n\n  /**\n   * Convenience methods for common HTTP verbs\n   */\n  async get<T = any>(url: string, config?: Partial<RequestConfig>): Promise<ServiceResponse<T>> {\n    return this.request<T>({ method: 'GET', url, ...config });\n  }\n\n  async post<T = any>(url: string, body?: any, config?: Partial<RequestConfig>): Promise<ServiceResponse<T>> {\n    return this.request<T>({ method: 'POST', url, body, ...config });\n  }\n\n  async put<T = any>(url: string, body?: any, config?: Partial<RequestConfig>): Promise<ServiceResponse<T>> {\n    return this.request<T>({ method: 'PUT', url, body, ...config });\n  }\n\n  async delete<T = any>(url: string, config?: Partial<RequestConfig>): Promise<ServiceResponse<T>> {\n    return this.request<T>({ method: 'DELETE', url, ...config });\n  }\n\n  async patch<T = any>(url: string, body?: any, config?: Partial<RequestConfig>): Promise<ServiceResponse<T>> {\n    return this.request<T>({ method: 'PATCH', url, body, ...config });\n  }\n\n  /**\n   * Add request interceptor\n   */\n  addRequestInterceptor(interceptor: RequestInterceptor): void {\n    this.requestInterceptors.push(interceptor);\n  }\n\n  /**\n   * Add response interceptor\n   */\n  addResponseInterceptor(interceptor: ResponseInterceptor): void {\n    this.responseInterceptors.push(interceptor);\n  }\n\n  /**\n   * Add error interceptor\n   */\n  addErrorInterceptor(interceptor: ErrorInterceptor): void {\n    this.errorInterceptors.push(interceptor);\n  }\n\n  /**\n   * Get circuit breaker statistics\n   */\n  getCircuitBreakerStats() {\n    return this.circuitBreaker.getStats();\n  }\n\n  /**\n   * Check if circuit breaker is healthy\n   */\n  isHealthy(): boolean {\n    return this.circuitBreaker.isHealthy();\n  }\n\n  /**\n   * Reset circuit breaker\n   */\n  resetCircuitBreaker(): void {\n    this.circuitBreaker.forceClose();\n  }\n\n  /**\n   * Get service client configuration\n   */\n  getConfig(): ServiceClientConfig {\n    return { ...this.config };\n  }\n}"],"version":3}