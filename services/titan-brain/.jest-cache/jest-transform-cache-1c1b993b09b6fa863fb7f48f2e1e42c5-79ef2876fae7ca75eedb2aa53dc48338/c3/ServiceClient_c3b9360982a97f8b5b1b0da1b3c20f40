8aa54d624a49c48f4e67d04160287d57
"use strict";
/**
 * ServiceClient - Robust HTTP client for inter-service communication
 *
 * Provides a robust HTTP client with automatic retries, exponential backoff,
 * circuit breaker pattern, request/response logging, and Railway service URL support.
 *
 * Requirements: 2.1.1, 2.1.2, 2.1.3, 2.1.4, 2.1.5
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ServiceClient = exports.ServiceClientError = void 0;
const events_1 = require("events");
const CircuitBreaker_js_1 = require("./CircuitBreaker.js");
const Logger_js_1 = require("../logging/Logger.js");
/**
 * Service client error
 */
class ServiceClientError extends Error {
    status;
    response;
    config;
    cause;
    constructor(message, status, response, config, cause) {
        super(message);
        this.status = status;
        this.response = response;
        this.config = config;
        this.cause = cause;
        this.name = 'ServiceClientError';
    }
    /**
     * Check if error is retryable
     */
    isRetryable() {
        // Network errors are retryable
        if (!this.status)
            return true;
        // 5xx server errors are retryable
        if (this.status >= 500)
            return true;
        // 429 rate limit is retryable
        if (this.status === 429)
            return true;
        // 408 request timeout is retryable
        if (this.status === 408)
            return true;
        return false;
    }
    /**
     * Check if error is a timeout
     */
    isTimeout() {
        return this.message.includes('timeout') || this.status === 408;
    }
    /**
     * Check if error is a network error
     */
    isNetworkError() {
        return !this.status && this.cause !== undefined;
    }
}
exports.ServiceClientError = ServiceClientError;
/**
 * Default retry configuration
 */
const DEFAULT_RETRY_CONFIG = {
    maxRetries: 3,
    initialDelay: 1000, // 1 second
    maxDelay: 30000, // 30 seconds
    backoffMultiplier: 2,
    retryableStatusCodes: [408, 429, 500, 502, 503, 504],
    retryableErrors: ['ECONNRESET', 'ENOTFOUND', 'ECONNREFUSED', 'ETIMEDOUT']
};
/**
 * Default service client configuration
 */
const DEFAULT_CONFIG = {
    defaultTimeout: 10000, // 10 seconds
    defaultHeaders: {
        'Content-Type': 'application/json',
        'User-Agent': 'TitanBrain/1.0.0'
    },
    retry: DEFAULT_RETRY_CONFIG,
    circuitBreaker: CircuitBreaker_js_1.CircuitBreakerDefaults.http,
    logRequests: true,
    logResponses: true,
    maxResponseBodyLogSize: 1024 // 1KB
};
/**
 * Service client for robust HTTP communication
 */
class ServiceClient extends events_1.EventEmitter {
    config;
    circuitBreaker;
    logger;
    requestInterceptors = [];
    responseInterceptors = [];
    errorInterceptors = [];
    constructor(config = {}, logger) {
        super();
        this.config = { ...DEFAULT_CONFIG, ...config };
        this.logger = logger ?? Logger_js_1.Logger.getInstance('service-client');
        // Initialize circuit breaker
        this.circuitBreaker = new CircuitBreaker_js_1.CircuitBreaker({ ...this.config.circuitBreaker }, this.logger);
        // Forward circuit breaker events
        this.circuitBreaker.on('stateChange', (event) => {
            this.emit('circuitBreakerStateChange', event);
        });
        this.logger.info('Service client initialized', undefined, {
            baseUrl: this.config.baseUrl,
            defaultTimeout: this.config.defaultTimeout,
            maxRetries: this.config.retry.maxRetries,
            circuitBreakerName: this.config.circuitBreaker.name
        });
    }
    /**
     * Make an HTTP request
     */
    async request(config) {
        // Apply request interceptors
        let processedConfig = config;
        for (const interceptor of this.requestInterceptors) {
            processedConfig = await interceptor(processedConfig);
        }
        // Add default configuration
        const finalConfig = {
            timeout: this.config.defaultTimeout,
            retries: this.config.retry.maxRetries,
            retryDelay: this.config.retry.initialDelay,
            ...processedConfig,
            headers: {
                ...this.config.defaultHeaders,
                ...processedConfig.headers
            }
        };
        // Add correlation ID if not present
        if (!finalConfig.correlationId) {
            finalConfig.correlationId = this.generateCorrelationId();
        }
        // Add correlation ID to headers
        finalConfig.headers['x-correlation-id'] = finalConfig.correlationId;
        // Build full URL
        const fullUrl = this.buildUrl(finalConfig.url);
        finalConfig.url = fullUrl;
        this.logger.debug('Making HTTP request', finalConfig.correlationId, {
            method: finalConfig.method,
            url: fullUrl,
            timeout: finalConfig.timeout,
            retries: finalConfig.retries
        });
        try {
            // Execute with circuit breaker protection
            const response = await this.circuitBreaker.execute(async () => {
                return await this.executeWithRetry(finalConfig);
            });
            // Apply response interceptors
            let processedResponse = response;
            for (const interceptor of this.responseInterceptors) {
                processedResponse = await interceptor(processedResponse);
            }
            this.emit('response', processedResponse);
            return processedResponse;
        }
        catch (error) {
            let processedError = error instanceof ServiceClientError
                ? error
                : new ServiceClientError(error instanceof Error ? error.message : String(error), undefined, undefined, finalConfig, error instanceof Error ? error : undefined);
            // Apply error interceptors
            for (const interceptor of this.errorInterceptors) {
                processedError = await interceptor(processedError);
            }
            this.emit('error', processedError);
            throw processedError;
        }
    }
    /**
     * Execute request with retry logic
     */
    async executeWithRetry(config) {
        let lastError;
        let attempt = 0;
        while (attempt <= (config.retries || 0)) {
            attempt++;
            try {
                const response = await this.executeRequest(config, attempt);
                if (attempt > 1) {
                    this.logger.info('Request succeeded after retry', config.correlationId, {
                        attempt,
                        url: config.url,
                        method: config.method
                    });
                }
                return response;
            }
            catch (error) {
                lastError = error instanceof ServiceClientError
                    ? error
                    : new ServiceClientError(error instanceof Error ? error.message : String(error), undefined, undefined, config, error instanceof Error ? error : undefined);
                // Check if we should retry
                if (attempt <= (config.retries || 0) && this.shouldRetry(lastError, attempt, config.retries || 0)) {
                    const delay = this.calculateRetryDelay(attempt);
                    this.logger.warn('Request failed, retrying', config.correlationId, {
                        attempt,
                        maxRetries: config.retries,
                        delay,
                        error: lastError.message,
                        status: lastError.status
                    });
                    // Wait before retry
                    await new Promise(resolve => setTimeout(resolve, delay));
                    continue;
                }
                // No more retries or not retryable
                this.logger.error('Request failed permanently', lastError, config.correlationId, {
                    attempt,
                    maxRetries: config.retries,
                    url: config.url,
                    method: config.method
                });
                throw lastError;
            }
        }
        throw lastError;
    }
    /**
     * Execute a single HTTP request
     */
    async executeRequest(config, attempt) {
        const startTime = Date.now();
        try {
            // Log request
            if (this.config.logRequests) {
                this.logger.debug('HTTP request', config.correlationId, {
                    method: config.method,
                    url: config.url,
                    attempt,
                    headers: this.sanitizeHeaders(config.headers || {}),
                    bodySize: config.body ? JSON.stringify(config.body).length : 0
                });
            }
            // Make the actual HTTP request using fetch
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeout);
            const fetchOptions = {
                method: config.method,
                headers: config.headers,
                body: config.body ? JSON.stringify(config.body) : undefined,
                signal: controller.signal
            };
            const response = await fetch(config.url, fetchOptions);
            clearTimeout(timeoutId);
            const duration = Date.now() - startTime;
            // Parse response
            let data;
            const contentType = response.headers.get('content-type') || '';
            if (contentType.includes('application/json')) {
                data = await response.json();
            }
            else {
                data = await response.text();
            }
            // Build response headers object
            const responseHeaders = {};
            response.headers.forEach((value, key) => {
                responseHeaders[key] = value;
            });
            const serviceResponse = {
                status: response.status,
                statusText: response.statusText,
                headers: responseHeaders,
                data,
                duration,
                correlationId: config.correlationId
            };
            // Log response
            if (this.config.logResponses) {
                this.logger.debug('HTTP response', config.correlationId, {
                    status: response.status,
                    statusText: response.statusText,
                    duration,
                    responseSize: this.getResponseSize(data),
                    responseBody: this.truncateResponseBody(data)
                });
            }
            // Check for HTTP errors
            if (!response.ok) {
                throw new ServiceClientError(`HTTP ${response.status}: ${response.statusText}`, response.status, serviceResponse, config);
            }
            return serviceResponse;
        }
        catch (error) {
            const duration = Date.now() - startTime;
            if (error instanceof ServiceClientError) {
                throw error;
            }
            // Handle fetch errors
            if (error instanceof Error) {
                if (error.name === 'AbortError') {
                    throw new ServiceClientError(`Request timeout after ${config.timeout}ms`, 408, undefined, config, error);
                }
                throw new ServiceClientError(`Network error: ${error.message}`, undefined, undefined, config, error);
            }
            throw new ServiceClientError('Unknown error occurred', undefined, undefined, config);
        }
    }
    /**
     * Check if error should be retried
     */
    shouldRetry(error, attempt, maxRetries) {
        // Don't retry if we've exceeded max attempts
        if (attempt > maxRetries) {
            return false;
        }
        // Check if error is retryable
        if (!error.isRetryable()) {
            return false;
        }
        return true;
    }
    /**
     * Calculate retry delay with exponential backoff
     */
    calculateRetryDelay(attempt) {
        const delay = this.config.retry.initialDelay * Math.pow(this.config.retry.backoffMultiplier, attempt - 1);
        return Math.min(delay, this.config.retry.maxDelay);
    }
    /**
     * Build full URL from base URL and path
     */
    buildUrl(url) {
        if (url.startsWith('http://') || url.startsWith('https://')) {
            return url;
        }
        if (this.config.baseUrl) {
            const baseUrl = this.config.baseUrl.endsWith('/')
                ? this.config.baseUrl.slice(0, -1)
                : this.config.baseUrl;
            const path = url.startsWith('/') ? url : `/${url}`;
            return `${baseUrl}${path}`;
        }
        return url;
    }
    /**
     * Generate correlation ID
     */
    generateCorrelationId() {
        return `req_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;
    }
    /**
     * Sanitize headers for logging (remove sensitive values)
     */
    sanitizeHeaders(headers) {
        const sanitized = {};
        const sensitiveHeaders = ['authorization', 'x-api-key', 'x-signature'];
        for (const [key, value] of Object.entries(headers)) {
            if (sensitiveHeaders.includes(key.toLowerCase())) {
                sanitized[key] = '[REDACTED]';
            }
            else {
                sanitized[key] = value;
            }
        }
        return sanitized;
    }
    /**
     * Get response size for logging
     */
    getResponseSize(data) {
        if (typeof data === 'string') {
            return data.length;
        }
        return JSON.stringify(data).length;
    }
    /**
     * Truncate response body for logging
     */
    truncateResponseBody(data) {
        const str = typeof data === 'string' ? data : JSON.stringify(data);
        if (str.length <= this.config.maxResponseBodyLogSize) {
            return data;
        }
        return str.substring(0, this.config.maxResponseBodyLogSize) + '... [truncated]';
    }
    /**
     * Convenience methods for common HTTP verbs
     */
    async get(url, config) {
        return this.request({ method: 'GET', url, ...config });
    }
    async post(url, body, config) {
        return this.request({ method: 'POST', url, body, ...config });
    }
    async put(url, body, config) {
        return this.request({ method: 'PUT', url, body, ...config });
    }
    async delete(url, config) {
        return this.request({ method: 'DELETE', url, ...config });
    }
    async patch(url, body, config) {
        return this.request({ method: 'PATCH', url, body, ...config });
    }
    /**
     * Add request interceptor
     */
    addRequestInterceptor(interceptor) {
        this.requestInterceptors.push(interceptor);
    }
    /**
     * Add response interceptor
     */
    addResponseInterceptor(interceptor) {
        this.responseInterceptors.push(interceptor);
    }
    /**
     * Add error interceptor
     */
    addErrorInterceptor(interceptor) {
        this.errorInterceptors.push(interceptor);
    }
    /**
     * Get circuit breaker statistics
     */
    getCircuitBreakerStats() {
        return this.circuitBreaker.getStats();
    }
    /**
     * Check if circuit breaker is healthy
     */
    isHealthy() {
        return this.circuitBreaker.isHealthy();
    }
    /**
     * Reset circuit breaker
     */
    resetCircuitBreaker() {
        this.circuitBreaker.forceClose();
    }
    /**
     * Get service client configuration
     */
    getConfig() {
        return { ...this.config };
    }
}
exports.ServiceClient = ServiceClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2aWNlcy9TZXJ2aWNlQ2xpZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFFSCxtQ0FBc0M7QUFDdEMsMkRBQW1HO0FBQ25HLG9EQUE4QztBQWtFOUM7O0dBRUc7QUFDSCxNQUFhLGtCQUFtQixTQUFRLEtBQUs7SUFHekI7SUFDQTtJQUNBO0lBQ0E7SUFMbEIsWUFDRSxPQUFlLEVBQ0MsTUFBZSxFQUNmLFFBQTBCLEVBQzFCLE1BQXNCLEVBQ3RCLEtBQWE7UUFFN0IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBTEMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUNmLGFBQVEsR0FBUixRQUFRLENBQWtCO1FBQzFCLFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQ3RCLFVBQUssR0FBTCxLQUFLLENBQVE7UUFHN0IsSUFBSSxDQUFDLElBQUksR0FBRyxvQkFBb0IsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXO1FBQ1QsK0JBQStCO1FBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRTlCLGtDQUFrQztRQUNsQyxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXBDLDhCQUE4QjtRQUM5QixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXJDLG1DQUFtQztRQUNuQyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXJDLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxHQUFHLENBQUM7SUFDakUs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QU0sRUFBRSxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFLLENBQVUsR0FBVyxFQUFFLElBQVUsRUFBRSxNQUErQjtRQUMzRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFRDs7T0FFRztJQUNILHFCQUFxQixDQUFDLFdBQStCO1FBQ25ELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsc0JBQXNCLENBQUMsV0FBZ0M7UUFDckQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxtQkFBbUIsQ0FBQyxXQUE2QjtRQUMvQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRDs7T0FFRztJQUNILHNCQUFzQjtRQUNwQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxtQkFBbUI7UUFDakIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTO1FBQ1AsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7Q0FDRjtBQXpjRCxzQ0F5Y0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2aWNlcy9TZXJ2aWNlQ2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VydmljZUNsaWVudCAtIFJvYnVzdCBIVFRQIGNsaWVudCBmb3IgaW50ZXItc2VydmljZSBjb21tdW5pY2F0aW9uXG4gKiBcbiAqIFByb3ZpZGVzIGEgcm9idXN0IEhUVFAgY2xpZW50IHdpdGggYXV0b21hdGljIHJldHJpZXMsIGV4cG9uZW50aWFsIGJhY2tvZmYsXG4gKiBjaXJjdWl0IGJyZWFrZXIgcGF0dGVybiwgcmVxdWVzdC9yZXNwb25zZSBsb2dnaW5nLCBhbmQgUmFpbHdheSBzZXJ2aWNlIFVSTCBzdXBwb3J0LlxuICogXG4gKiBSZXF1aXJlbWVudHM6IDIuMS4xLCAyLjEuMiwgMi4xLjMsIDIuMS40LCAyLjEuNVxuICovXG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyBDaXJjdWl0QnJlYWtlciwgQ2lyY3VpdEJyZWFrZXJDb25maWcsIENpcmN1aXRCcmVha2VyRGVmYXVsdHMgfSBmcm9tICcuL0NpcmN1aXRCcmVha2VyLmpzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2xvZ2dpbmcvTG9nZ2VyLmpzJztcblxuLyoqXG4gKiBIVFRQIG1ldGhvZHMgc3VwcG9ydGVkIGJ5IFNlcnZpY2VDbGllbnRcbiAqL1xuZXhwb3J0IHR5cGUgSHR0cE1ldGhvZCA9ICdHRVQnIHwgJ1BPU1QnIHwgJ1BVVCcgfCAnREVMRVRFJyB8ICdQQVRDSCc7XG5cbi8qKlxuICogUmVxdWVzdCBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVxdWVzdENvbmZpZyB7XG4gIG1ldGhvZDogSHR0cE1ldGhvZDtcbiAgdXJsOiBzdHJpbmc7XG4gIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBib2R5PzogYW55O1xuICB0aW1lb3V0PzogbnVtYmVyO1xuICByZXRyaWVzPzogbnVtYmVyO1xuICByZXRyeURlbGF5PzogbnVtYmVyO1xuICBjb3JyZWxhdGlvbklkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VSZXNwb25zZTxUID0gYW55PiB7XG4gIHN0YXR1czogbnVtYmVyO1xuICBzdGF0dXNUZXh0OiBzdHJpbmc7XG4gIGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIGRhdGE6IFQ7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUmV0cnkgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJldHJ5Q29uZmlnIHtcbiAgbWF4UmV0cmllczogbnVtYmVyO1xuICBpbml0aWFsRGVsYXk6IG51bWJlcjtcbiAgbWF4RGVsYXk6IG51bWJlcjtcbiAgYmFja29mZk11bHRpcGxpZXI6IG51bWJlcjtcbiAgcmV0cnlhYmxlU3RhdHVzQ29kZXM6IG51bWJlcltdO1xuICByZXRyeWFibGVFcnJvcnM6IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIFNlcnZpY2UgY2xpZW50IGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlQ2xpZW50Q29uZmlnIHtcbiAgYmFzZVVybD86IHN0cmluZztcbiAgZGVmYXVsdFRpbWVvdXQ6IG51bWJlcjtcbiAgZGVmYXVsdEhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIHJldHJ5OiBSZXRyeUNvbmZpZztcbiAgY2lyY3VpdEJyZWFrZXI6IENpcmN1aXRCcmVha2VyQ29uZmlnO1xuICBsb2dSZXF1ZXN0czogYm9vbGVhbjtcbiAgbG9nUmVzcG9uc2VzOiBib29sZWFuO1xuICBtYXhSZXNwb25zZUJvZHlMb2dTaXplOiBudW1iZXI7XG59XG5cbi8qKlxuICogUmVxdWVzdC9SZXNwb25zZSBpbnRlcmNlcHRvciBmdW5jdGlvbnNcbiAqL1xuZXhwb3J0IHR5cGUgUmVxdWVzdEludGVyY2VwdG9yID0gKGNvbmZpZzogUmVxdWVzdENvbmZpZykgPT4gUmVxdWVzdENvbmZpZyB8IFByb21pc2U8UmVxdWVzdENvbmZpZz47XG5leHBvcnQgdHlwZSBSZXNwb25zZUludGVyY2VwdG9yPFQgPSBhbnk+ID0gKHJlc3BvbnNlOiBTZXJ2aWNlUmVzcG9uc2U8VD4pID0+IFNlcnZpY2VSZXNwb25zZTxUPiB8IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PjtcbmV4cG9ydCB0eXBlIEVycm9ySW50ZXJjZXB0b3IgPSAoZXJyb3I6IFNlcnZpY2VDbGllbnRFcnJvcikgPT4gU2VydmljZUNsaWVudEVycm9yIHwgUHJvbWlzZTxTZXJ2aWNlQ2xpZW50RXJyb3I+O1xuXG4vKipcbiAqIFNlcnZpY2UgY2xpZW50IGVycm9yXG4gKi9cbmV4cG9ydCBjbGFzcyBTZXJ2aWNlQ2xpZW50RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgcmVhZG9ubHkgc3RhdHVzPzogbnVtYmVyLFxuICAgIHB1YmxpYyByZWFkb25seSByZXNwb25zZT86IFNlcnZpY2VSZXNwb25zZSxcbiAgICBwdWJsaWMgcmVhZG9ubHkgY29uZmlnPzogUmVxdWVzdENvbmZpZyxcbiAgICBwdWJsaWMgcmVhZG9ubHkgY2F1c2U/OiBFcnJvclxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnU2VydmljZUNsaWVudEVycm9yJztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBlcnJvciBpcyByZXRyeWFibGVcbiAgICovXG4gIGlzUmV0cnlhYmxlKCk6IGJvb2xlYW4ge1xuICAgIC8vIE5ldHdvcmsgZXJyb3JzIGFyZSByZXRyeWFibGVcbiAgICBpZiAoIXRoaXMuc3RhdHVzKSByZXR1cm4gdHJ1ZTtcbiAgICBcbiAgICAvLyA1eHggc2VydmVyIGVycm9ycyBhcmUgcmV0cnlhYmxlXG4gICAgaWYgKHRoaXMuc3RhdHVzID49IDUwMCkgcmV0dXJuIHRydWU7XG4gICAgXG4gICAgLy8gNDI5IHJhdGUgbGltaXQgaXMgcmV0cnlhYmxlXG4gICAgaWYgKHRoaXMuc3RhdHVzID09PSA0MjkpIHJldHVybiB0cnVlO1xuICAgIFxuICAgIC8vIDQwOCByZXF1ZXN0IHRpbWVvdXQgaXMgcmV0cnlhYmxlXG4gICAgaWYgKHRoaXMuc3RhdHVzID09PSA0MDgpIHJldHVybiB0cnVlO1xuICAgIFxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBlcnJvciBpcyBhIHRpbWVvdXRcbiAgICovXG4gIGlzVGltZW91dCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdlLmluY2x1ZGVzKCd0aW1lb3V0JykgfHwgdGhpcy5zdGF0dXMgPT09IDQwODtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBlcnJvciBpcyBhIG5ldHdvcmsgZXJyb3JcbiAgICovXG4gIGlzTmV0d29ya0Vycm9yKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5zdGF0dXMgJiYgdGhpcy5jYXVzZSAhPT0gdW5kZWZpbmVkO1xuICB9XG59XG5cbi8qKlxuICogRGVmYXVsdCByZXRyeSBjb25maWd1cmF0aW9uXG4gKi9cbmNvbnN0IERFRkFVTFRfUkVUUllfQ09ORklHOiBSZXRyeUNvbmZpZyA9IHtcbiAgbWF4UmV0cmllczogMyxcbiAgaW5pdGlhbERlbGF5OiAxMDAwLCAgICAgIC8vIDEgc2Vjb25kXG4gIG1heERlbGF5OiAzMDAwMCwgICAgICAgICAvLyAzMCBzZWNvbmRzXG4gIGJhY2tvZmZNdWx0aXBsaWVyOiAyLFxuICByZXRyeWFibGVTdGF0dXNDb2RlczogWzQwOCwgNDI5LCA1MDAsIDUwMiwgNTAzLCA1MDRdLFxuICByZXRyeWFibGVFcnJvcnM6IFsnRUNPTk5SRVNFVCcsICdFTk9URk9VTkQnLCAnRUNPTk5SRUZVU0VEJywgJ0VUSU1FRE9VVCddXG59O1xuXG4vKipcbiAqIERlZmF1bHQgc2VydmljZSBjbGllbnQgY29uZmlndXJhdGlvblxuICovXG5jb25zdCBERUZBVUxUX0NPTkZJRzogU2VydmljZUNsaWVudENvbmZpZyA9IHtcbiAgZGVmYXVsdFRpbWVvdXQ6IDEwMDAwLCAgIC8vIDEwIHNlY29uZHNcbiAgZGVmYXVsdEhlYWRlcnM6IHtcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICdVc2VyLUFnZW50JzogJ1RpdGFuQnJhaW4vMS4wLjAnXG4gIH0sXG4gIHJldHJ5OiBERUZBVUxUX1JFVFJZX0NPTkZJRyxcbiAgY2lyY3VpdEJyZWFrZXI6IENpcmN1aXRCcmVha2VyRGVmYXVsdHMuaHR0cCxcbiAgbG9nUmVxdWVzdHM6IHRydWUsXG4gIGxvZ1Jlc3BvbnNlczogdHJ1ZSxcbiAgbWF4UmVzcG9uc2VCb2R5TG9nU2l6ZTogMTAyNCAvLyAxS0Jcbn07XG5cbi8qKlxuICogU2VydmljZSBjbGllbnQgZm9yIHJvYnVzdCBIVFRQIGNvbW11bmljYXRpb25cbiAqL1xuZXhwb3J0IGNsYXNzIFNlcnZpY2VDbGllbnQgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIGNvbmZpZzogU2VydmljZUNsaWVudENvbmZpZztcbiAgcHJpdmF0ZSBjaXJjdWl0QnJlYWtlcjogQ2lyY3VpdEJyZWFrZXI7XG4gIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XG4gIHByaXZhdGUgcmVxdWVzdEludGVyY2VwdG9yczogUmVxdWVzdEludGVyY2VwdG9yW10gPSBbXTtcbiAgcHJpdmF0ZSByZXNwb25zZUludGVyY2VwdG9yczogUmVzcG9uc2VJbnRlcmNlcHRvcltdID0gW107XG4gIHByaXZhdGUgZXJyb3JJbnRlcmNlcHRvcnM6IEVycm9ySW50ZXJjZXB0b3JbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxTZXJ2aWNlQ2xpZW50Q29uZmlnPiA9IHt9LCBsb2dnZXI/OiBMb2dnZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIFxuICAgIHRoaXMuY29uZmlnID0geyAuLi5ERUZBVUxUX0NPTkZJRywgLi4uY29uZmlnIH07XG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXIgPz8gTG9nZ2VyLmdldEluc3RhbmNlKCdzZXJ2aWNlLWNsaWVudCcpO1xuICAgIFxuICAgIC8vIEluaXRpYWxpemUgY2lyY3VpdCBicmVha2VyXG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihcbiAgICAgIHsgLi4udGhpcy5jb25maWcuY2lyY3VpdEJyZWFrZXIgfSxcbiAgICAgIHRoaXMubG9nZ2VyXG4gICAgKTtcbiAgICBcbiAgICAvLyBGb3J3YXJkIGNpcmN1aXQgYnJlYWtlciBldmVudHNcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLm9uKCdzdGF0ZUNoYW5nZScsIChldmVudCkgPT4ge1xuICAgICAgdGhpcy5lbWl0KCdjaXJjdWl0QnJlYWtlclN0YXRlQ2hhbmdlJywgZXZlbnQpO1xuICAgIH0pO1xuICAgIFxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ1NlcnZpY2UgY2xpZW50IGluaXRpYWxpemVkJywgdW5kZWZpbmVkLCB7XG4gICAgICBiYXNlVXJsOiB0aGlzLmNvbmZpZy5iYXNlVXJsLFxuICAgICAgZGVmYXVsdFRpbWVvdXQ6IHRoaXMuY29uZmlnLmRlZmF1bHRUaW1lb3V0LFxuICAgICAgbWF4UmV0cmllczogdGhpcy5jb25maWcucmV0cnkubWF4UmV0cmllcyxcbiAgICAgIGNpcmN1aXRCcmVha2VyTmFtZTogdGhpcy5jb25maWcuY2lyY3VpdEJyZWFrZXIubmFtZVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ha2UgYW4gSFRUUCByZXF1ZXN0XG4gICAqL1xuICBhc3luYyByZXF1ZXN0PFQgPSBhbnk+KGNvbmZpZzogUmVxdWVzdENvbmZpZyk6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgLy8gQXBwbHkgcmVxdWVzdCBpbnRlcmNlcHRvcnNcbiAgICBsZXQgcHJvY2Vzc2VkQ29uZmlnID0gY29uZmlnO1xuICAgIGZvciAoY29uc3QgaW50ZXJjZXB0b3Igb2YgdGhpcy5yZXF1ZXN0SW50ZXJjZXB0b3JzKSB7XG4gICAgICBwcm9jZXNzZWRDb25maWcgPSBhd2FpdCBpbnRlcmNlcHRvcihwcm9jZXNzZWRDb25maWcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgY29uc3QgZmluYWxDb25maWc6IFJlcXVlc3RDb25maWcgPSB7XG4gICAgICB0aW1lb3V0OiB0aGlzLmNvbmZpZy5kZWZhdWx0VGltZW91dCxcbiAgICAgIHJldHJpZXM6IHRoaXMuY29uZmlnLnJldHJ5Lm1heFJldHJpZXMsXG4gICAgICByZXRyeURlbGF5OiB0aGlzLmNvbmZpZy5yZXRyeS5pbml0aWFsRGVsYXksXG4gICAgICAuLi5wcm9jZXNzZWRDb25maWcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLnRoaXMuY29uZmlnLmRlZmF1bHRIZWFkZXJzLFxuICAgICAgICAuLi5wcm9jZXNzZWRDb25maWcuaGVhZGVyc1xuICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgLy8gQWRkIGNvcnJlbGF0aW9uIElEIGlmIG5vdCBwcmVzZW50XG4gICAgaWYgKCFmaW5hbENvbmZpZy5jb3JyZWxhdGlvbklkKSB7XG4gICAgICBmaW5hbENvbmZpZy5jb3JyZWxhdGlvbklkID0gdGhpcy5nZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGNvcnJlbGF0aW9uIElEIHRvIGhlYWRlcnNcbiAgICBmaW5hbENvbmZpZy5oZWFkZXJzIVsneC1jb3JyZWxhdGlvbi1pZCddID0gZmluYWxDb25maWcuY29ycmVsYXRpb25JZDtcbiAgICBcbiAgICAvLyBCdWlsZCBmdWxsIFVSTFxuICAgIGNvbnN0IGZ1bGxVcmwgPSB0aGlzLmJ1aWxkVXJsKGZpbmFsQ29uZmlnLnVybCk7XG4gICAgZmluYWxDb25maWcudXJsID0gZnVsbFVybDtcbiAgICBcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnTWFraW5nIEhUVFAgcmVxdWVzdCcsIGZpbmFsQ29uZmlnLmNvcnJlbGF0aW9uSWQsIHtcbiAgICAgIG1ldGhvZDogZmluYWxDb25maWcubWV0aG9kLFxuICAgICAgdXJsOiBmdWxsVXJsLFxuICAgICAgdGltZW91dDogZmluYWxDb25maWcudGltZW91dCxcbiAgICAgIHJldHJpZXM6IGZpbmFsQ29uZmlnLnJldHJpZXNcbiAgICB9KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRXhlY3V0ZSB3aXRoIGNpcmN1aXQgYnJlYWtlciBwcm90ZWN0aW9uXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVXaXRoUmV0cnkoZmluYWxDb25maWcpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IHJlc3BvbnNlIGludGVyY2VwdG9yc1xuICAgICAgbGV0IHByb2Nlc3NlZFJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICBmb3IgKGNvbnN0IGludGVyY2VwdG9yIG9mIHRoaXMucmVzcG9uc2VJbnRlcmNlcHRvcnMpIHtcbiAgICAgICAgcHJvY2Vzc2VkUmVzcG9uc2UgPSBhd2FpdCBpbnRlcmNlcHRvcihwcm9jZXNzZWRSZXNwb25zZSkgYXMgU2VydmljZVJlc3BvbnNlPFQ+O1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLmVtaXQoJ3Jlc3BvbnNlJywgcHJvY2Vzc2VkUmVzcG9uc2UpO1xuICAgICAgcmV0dXJuIHByb2Nlc3NlZFJlc3BvbnNlIGFzIFNlcnZpY2VSZXNwb25zZTxUPjtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsZXQgcHJvY2Vzc2VkRXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIFNlcnZpY2VDbGllbnRFcnJvciBcbiAgICAgICAgPyBlcnJvciBcbiAgICAgICAgOiBuZXcgU2VydmljZUNsaWVudEVycm9yKFxuICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgZmluYWxDb25maWcsXG4gICAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiB1bmRlZmluZWRcbiAgICAgICAgICApO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBlcnJvciBpbnRlcmNlcHRvcnNcbiAgICAgIGZvciAoY29uc3QgaW50ZXJjZXB0b3Igb2YgdGhpcy5lcnJvckludGVyY2VwdG9ycykge1xuICAgICAgICBwcm9jZXNzZWRFcnJvciA9IGF3YWl0IGludGVyY2VwdG9yKHByb2Nlc3NlZEVycm9yKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIHByb2Nlc3NlZEVycm9yKTtcbiAgICAgIHRocm93IHByb2Nlc3NlZEVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHJlcXVlc3Qgd2l0aCByZXRyeSBsb2dpY1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlV2l0aFJldHJ5PFQ+KGNvbmZpZzogUmVxdWVzdENvbmZpZyk6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgbGV0IGxhc3RFcnJvcjogU2VydmljZUNsaWVudEVycm9yIHwgdW5kZWZpbmVkO1xuICAgIGxldCBhdHRlbXB0ID0gMDtcbiAgICBcbiAgICB3aGlsZSAoYXR0ZW1wdCA8PSAoY29uZmlnLnJldHJpZXMgfHwgMCkpIHtcbiAgICAgIGF0dGVtcHQrKztcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmV4ZWN1dGVSZXF1ZXN0PFQ+KGNvbmZpZywgYXR0ZW1wdCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYXR0ZW1wdCA+IDEpIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdSZXF1ZXN0IHN1Y2NlZWRlZCBhZnRlciByZXRyeScsIGNvbmZpZy5jb3JyZWxhdGlvbklkLCB7XG4gICAgICAgICAgICBhdHRlbXB0LFxuICAgICAgICAgICAgdXJsOiBjb25maWcudXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsYXN0RXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIFNlcnZpY2VDbGllbnRFcnJvciBcbiAgICAgICAgICA/IGVycm9yIFxuICAgICAgICAgIDogbmV3IFNlcnZpY2VDbGllbnRFcnJvcihcbiAgICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiB1bmRlZmluZWRcbiAgICAgICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBpZiB3ZSBzaG91bGQgcmV0cnlcbiAgICAgICAgaWYgKGF0dGVtcHQgPD0gKGNvbmZpZy5yZXRyaWVzIHx8IDApICYmIHRoaXMuc2hvdWxkUmV0cnkobGFzdEVycm9yLCBhdHRlbXB0LCBjb25maWcucmV0cmllcyB8fCAwKSkge1xuICAgICAgICAgIGNvbnN0IGRlbGF5ID0gdGhpcy5jYWxjdWxhdGVSZXRyeURlbGF5KGF0dGVtcHQpO1xuICAgICAgICAgIFxuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1JlcXVlc3QgZmFpbGVkLCByZXRyeWluZycsIGNvbmZpZy5jb3JyZWxhdGlvbklkLCB7XG4gICAgICAgICAgICBhdHRlbXB0LFxuICAgICAgICAgICAgbWF4UmV0cmllczogY29uZmlnLnJldHJpZXMsXG4gICAgICAgICAgICBkZWxheSxcbiAgICAgICAgICAgIGVycm9yOiBsYXN0RXJyb3IubWVzc2FnZSxcbiAgICAgICAgICAgIHN0YXR1czogbGFzdEVycm9yLnN0YXR1c1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFdhaXQgYmVmb3JlIHJldHJ5XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5KSk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIE5vIG1vcmUgcmV0cmllcyBvciBub3QgcmV0cnlhYmxlXG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdSZXF1ZXN0IGZhaWxlZCBwZXJtYW5lbnRseScsIGxhc3RFcnJvciwgY29uZmlnLmNvcnJlbGF0aW9uSWQsIHtcbiAgICAgICAgICBhdHRlbXB0LFxuICAgICAgICAgIG1heFJldHJpZXM6IGNvbmZpZy5yZXRyaWVzLFxuICAgICAgICAgIHVybDogY29uZmlnLnVybCxcbiAgICAgICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2RcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB0aHJvdyBsYXN0RXJyb3I7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHRocm93IGxhc3RFcnJvciE7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHNpbmdsZSBIVFRQIHJlcXVlc3RcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVJlcXVlc3Q8VD4oY29uZmlnOiBSZXF1ZXN0Q29uZmlnLCBhdHRlbXB0OiBudW1iZXIpOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIExvZyByZXF1ZXN0XG4gICAgICBpZiAodGhpcy5jb25maWcubG9nUmVxdWVzdHMpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ0hUVFAgcmVxdWVzdCcsIGNvbmZpZy5jb3JyZWxhdGlvbklkLCB7XG4gICAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kLFxuICAgICAgICAgIHVybDogY29uZmlnLnVybCxcbiAgICAgICAgICBhdHRlbXB0LFxuICAgICAgICAgIGhlYWRlcnM6IHRoaXMuc2FuaXRpemVIZWFkZXJzKGNvbmZpZy5oZWFkZXJzIHx8IHt9KSxcbiAgICAgICAgICBib2R5U2l6ZTogY29uZmlnLmJvZHkgPyBKU09OLnN0cmluZ2lmeShjb25maWcuYm9keSkubGVuZ3RoIDogMFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTWFrZSB0aGUgYWN0dWFsIEhUVFAgcmVxdWVzdCB1c2luZyBmZXRjaFxuICAgICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCBjb25maWcudGltZW91dCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZldGNoT3B0aW9uczogUmVxdWVzdEluaXQgPSB7XG4gICAgICAgIG1ldGhvZDogY29uZmlnLm1ldGhvZCxcbiAgICAgICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXG4gICAgICAgIGJvZHk6IGNvbmZpZy5ib2R5ID8gSlNPTi5zdHJpbmdpZnkoY29uZmlnLmJvZHkpIDogdW5kZWZpbmVkLFxuICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGNvbmZpZy51cmwsIGZldGNoT3B0aW9ucyk7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICAvLyBQYXJzZSByZXNwb25zZVxuICAgICAgbGV0IGRhdGE6IFQ7XG4gICAgICBjb25zdCBjb250ZW50VHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKSB8fCAnJztcbiAgICAgIFxuICAgICAgaWYgKGNvbnRlbnRUeXBlLmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykpIHtcbiAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBUO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKSBhcyBUO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBCdWlsZCByZXNwb25zZSBoZWFkZXJzIG9iamVjdFxuICAgICAgY29uc3QgcmVzcG9uc2VIZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgICByZXNwb25zZS5oZWFkZXJzLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgcmVzcG9uc2VIZWFkZXJzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzZXJ2aWNlUmVzcG9uc2U6IFNlcnZpY2VSZXNwb25zZTxUPiA9IHtcbiAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlSGVhZGVycyxcbiAgICAgICAgZGF0YSxcbiAgICAgICAgZHVyYXRpb24sXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6IGNvbmZpZy5jb3JyZWxhdGlvbklkXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBMb2cgcmVzcG9uc2VcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sb2dSZXNwb25zZXMpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ0hUVFAgcmVzcG9uc2UnLCBjb25maWcuY29ycmVsYXRpb25JZCwge1xuICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgcmVzcG9uc2VTaXplOiB0aGlzLmdldFJlc3BvbnNlU2l6ZShkYXRhKSxcbiAgICAgICAgICByZXNwb25zZUJvZHk6IHRoaXMudHJ1bmNhdGVSZXNwb25zZUJvZHkoZGF0YSlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGZvciBIVFRQIGVycm9yc1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgU2VydmljZUNsaWVudEVycm9yKFxuICAgICAgICAgIGBIVFRQICR7cmVzcG9uc2Uuc3RhdHVzfTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWAsXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgIHNlcnZpY2VSZXNwb25zZSxcbiAgICAgICAgICBjb25maWdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHNlcnZpY2VSZXNwb25zZTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFNlcnZpY2VDbGllbnRFcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGZldGNoIGVycm9yc1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykge1xuICAgICAgICAgIHRocm93IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoXG4gICAgICAgICAgICBgUmVxdWVzdCB0aW1lb3V0IGFmdGVyICR7Y29uZmlnLnRpbWVvdXR9bXNgLFxuICAgICAgICAgICAgNDA4LFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aHJvdyBuZXcgU2VydmljZUNsaWVudEVycm9yKFxuICAgICAgICAgIGBOZXR3b3JrIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBlcnJvclxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aHJvdyBuZXcgU2VydmljZUNsaWVudEVycm9yKFxuICAgICAgICAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGVycm9yIHNob3VsZCBiZSByZXRyaWVkXG4gICAqL1xuICBwcml2YXRlIHNob3VsZFJldHJ5KGVycm9yOiBTZXJ2aWNlQ2xpZW50RXJyb3IsIGF0dGVtcHQ6IG51bWJlciwgbWF4UmV0cmllczogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgLy8gRG9uJ3QgcmV0cnkgaWYgd2UndmUgZXhjZWVkZWQgbWF4IGF0dGVtcHRzXG4gICAgaWYgKGF0dGVtcHQgPiBtYXhSZXRyaWVzKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGlmIGVycm9yIGlzIHJldHJ5YWJsZVxuICAgIGlmICghZXJyb3IuaXNSZXRyeWFibGUoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcmV0cnkgZGVsYXkgd2l0aCBleHBvbmVudGlhbCBiYWNrb2ZmXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVJldHJ5RGVsYXkoYXR0ZW1wdDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBkZWxheSA9IHRoaXMuY29uZmlnLnJldHJ5LmluaXRpYWxEZWxheSAqIE1hdGgucG93KHRoaXMuY29uZmlnLnJldHJ5LmJhY2tvZmZNdWx0aXBsaWVyLCBhdHRlbXB0IC0gMSk7XG4gICAgcmV0dXJuIE1hdGgubWluKGRlbGF5LCB0aGlzLmNvbmZpZy5yZXRyeS5tYXhEZWxheSk7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgZnVsbCBVUkwgZnJvbSBiYXNlIFVSTCBhbmQgcGF0aFxuICAgKi9cbiAgcHJpdmF0ZSBidWlsZFVybCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHVybC5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgdXJsLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLmNvbmZpZy5iYXNlVXJsKSB7XG4gICAgICBjb25zdCBiYXNlVXJsID0gdGhpcy5jb25maWcuYmFzZVVybC5lbmRzV2l0aCgnLycpIFxuICAgICAgICA/IHRoaXMuY29uZmlnLmJhc2VVcmwuc2xpY2UoMCwgLTEpIFxuICAgICAgICA6IHRoaXMuY29uZmlnLmJhc2VVcmw7XG4gICAgICBjb25zdCBwYXRoID0gdXJsLnN0YXJ0c1dpdGgoJy8nKSA/IHVybCA6IGAvJHt1cmx9YDtcbiAgICAgIHJldHVybiBgJHtiYXNlVXJsfSR7cGF0aH1gO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdXJsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNvcnJlbGF0aW9uIElEXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgcmVxXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTEpfWA7XG4gIH1cblxuICAvKipcbiAgICogU2FuaXRpemUgaGVhZGVycyBmb3IgbG9nZ2luZyAocmVtb3ZlIHNlbnNpdGl2ZSB2YWx1ZXMpXG4gICAqL1xuICBwcml2YXRlIHNhbml0aXplSGVhZGVycyhoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gICAgY29uc3Qgc2FuaXRpemVkOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgY29uc3Qgc2Vuc2l0aXZlSGVhZGVycyA9IFsnYXV0aG9yaXphdGlvbicsICd4LWFwaS1rZXknLCAneC1zaWduYXR1cmUnXTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhoZWFkZXJzKSkge1xuICAgICAgaWYgKHNlbnNpdGl2ZUhlYWRlcnMuaW5jbHVkZXMoa2V5LnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgIHNhbml0aXplZFtrZXldID0gJ1tSRURBQ1RFRF0nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2FuaXRpemVkW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHNhbml0aXplZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVzcG9uc2Ugc2l6ZSBmb3IgbG9nZ2luZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRSZXNwb25zZVNpemUoZGF0YTogYW55KTogbnVtYmVyIHtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gZGF0YS5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogVHJ1bmNhdGUgcmVzcG9uc2UgYm9keSBmb3IgbG9nZ2luZ1xuICAgKi9cbiAgcHJpdmF0ZSB0cnVuY2F0ZVJlc3BvbnNlQm9keShkYXRhOiBhbnkpOiBhbnkge1xuICAgIGNvbnN0IHN0ciA9IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyA/IGRhdGEgOiBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICBpZiAoc3RyLmxlbmd0aCA8PSB0aGlzLmNvbmZpZy5tYXhSZXNwb25zZUJvZHlMb2dTaXplKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgdGhpcy5jb25maWcubWF4UmVzcG9uc2VCb2R5TG9nU2l6ZSkgKyAnLi4uIFt0cnVuY2F0ZWRdJztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZW5pZW5jZSBtZXRob2RzIGZvciBjb21tb24gSFRUUCB2ZXJic1xuICAgKi9cbiAgYXN5bmMgZ2V0PFQgPSBhbnk+KHVybDogc3RyaW5nLCBjb25maWc/OiBQYXJ0aWFsPFJlcXVlc3RDb25maWc+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHsgbWV0aG9kOiAnR0VUJywgdXJsLCAuLi5jb25maWcgfSk7XG4gIH1cblxuICBhc3luYyBwb3N0PFQgPSBhbnk+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBjb25maWc/OiBQYXJ0aWFsPFJlcXVlc3RDb25maWc+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHsgbWV0aG9kOiAnUE9TVCcsIHVybCwgYm9keSwgLi4uY29uZmlnIH0pO1xuICB9XG5cbiAgYXN5bmMgcHV0PFQgPSBhbnk+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBjb25maWc/OiBQYXJ0aWFsPFJlcXVlc3RDb25maWc+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHsgbWV0aG9kOiAnUFVUJywgdXJsLCBib2R5LCAuLi5jb25maWcgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGU8VCA9IGFueT4odXJsOiBzdHJpbmcsIGNvbmZpZz86IFBhcnRpYWw8UmVxdWVzdENvbmZpZz4pOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Q8VD4oeyBtZXRob2Q6ICdERUxFVEUnLCB1cmwsIC4uLmNvbmZpZyB9KTtcbiAgfVxuXG4gIGFzeW5jIHBhdGNoPFQgPSBhbnk+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBjb25maWc/OiBQYXJ0aWFsPFJlcXVlc3RDb25maWc+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHsgbWV0aG9kOiAnUEFUQ0gnLCB1cmwsIGJvZHksIC4uLmNvbmZpZyB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgcmVxdWVzdCBpbnRlcmNlcHRvclxuICAgKi9cbiAgYWRkUmVxdWVzdEludGVyY2VwdG9yKGludGVyY2VwdG9yOiBSZXF1ZXN0SW50ZXJjZXB0b3IpOiB2b2lkIHtcbiAgICB0aGlzLnJlcXVlc3RJbnRlcmNlcHRvcnMucHVzaChpbnRlcmNlcHRvcik7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJlc3BvbnNlIGludGVyY2VwdG9yXG4gICAqL1xuICBhZGRSZXNwb25zZUludGVyY2VwdG9yKGludGVyY2VwdG9yOiBSZXNwb25zZUludGVyY2VwdG9yKTogdm9pZCB7XG4gICAgdGhpcy5yZXNwb25zZUludGVyY2VwdG9ycy5wdXNoKGludGVyY2VwdG9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgZXJyb3IgaW50ZXJjZXB0b3JcbiAgICovXG4gIGFkZEVycm9ySW50ZXJjZXB0b3IoaW50ZXJjZXB0b3I6IEVycm9ySW50ZXJjZXB0b3IpOiB2b2lkIHtcbiAgICB0aGlzLmVycm9ySW50ZXJjZXB0b3JzLnB1c2goaW50ZXJjZXB0b3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjaXJjdWl0IGJyZWFrZXIgc3RhdGlzdGljc1xuICAgKi9cbiAgZ2V0Q2lyY3VpdEJyZWFrZXJTdGF0cygpIHtcbiAgICByZXR1cm4gdGhpcy5jaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGNpcmN1aXQgYnJlYWtlciBpcyBoZWFsdGh5XG4gICAqL1xuICBpc0hlYWx0aHkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY2lyY3VpdEJyZWFrZXIuaXNIZWFsdGh5KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICByZXNldENpcmN1aXRCcmVha2VyKCk6IHZvaWQge1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuZm9yY2VDbG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXJ2aWNlIGNsaWVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogU2VydmljZUNsaWVudENvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==