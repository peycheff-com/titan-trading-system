2dd98ca79c43fc1c53183b8b8c413d67
"use strict";
/**
 * CircuitBreaker Tests
 *
 * Comprehensive unit tests for the CircuitBreaker class
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Logger
jest.mock('../../src/logging/Logger');
const CircuitBreaker_1 = require("../../src/services/CircuitBreaker");
const Logger_1 = require("../../src/logging/Logger");
const mockLogger = {
    info: jest.fn(),
    warn: jest.fn(),
    error: jest.fn(),
    debug: jest.fn()
};
describe('CircuitBreaker', () => {
    let circuitBreaker;
    beforeEach(() => {
        jest.clearAllMocks();
        Logger_1.Logger.getInstance.mockReturnValue(mockLogger);
        circuitBreaker = new CircuitBreaker_1.CircuitBreaker({
            name: 'test-service',
            failureThreshold: 3,
            recoveryTimeout: 1000,
            requestTimeout: 500,
            monitoringPeriod: 5000,
            halfOpenMaxCalls: 2
        });
    });
    describe('constructor', () => {
        it('should initialize with correct configuration', () => {
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.failureCount).toBe(0);
            expect(stats.successCount).toBe(0);
            expect(stats.totalRequests).toBe(0);
        });
        it('should log initialization', () => {
            expect(mockLogger.info).toHaveBeenCalledWith('Circuit breaker initialized', undefined, expect.objectContaining({
                name: 'test-service',
                failureThreshold: 3,
                recoveryTimeout: 1000,
                requestTimeout: 500
            }));
        });
    });
    describe('execute - CLOSED state', () => {
        it('should execute function successfully', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            const result = await circuitBreaker.execute(mockFn);
            expect(result).toBe('success');
            expect(mockFn).toHaveBeenCalledTimes(1);
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.successCount).toBe(1);
            expect(stats.totalRequests).toBe(1);
        });
        it('should handle function failure', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.failureCount).toBe(1);
            expect(stats.totalRequests).toBe(1);
        });
        it('should transition to OPEN after failure threshold', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            // Fail 3 times (threshold)
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
            expect(stats.failureCount).toBe(3);
        });
        it('should reset failure count on success', async () => {
            const mockFn = jest.fn()
                .mockRejectedValueOnce(new Error('Test error'))
                .mockResolvedValue('success');
            // Fail once
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().failureCount).toBe(1);
            // Succeed
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().failureCount).toBe(0);
        });
        it('should handle timeout', async () => {
            const mockFn = jest.fn().mockImplementation(() => new Promise(resolve => setTimeout(resolve, 1000)));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Request timeout');
            const stats = circuitBreaker.getStats();
            expect(stats.failureCount).toBe(1);
        });
    });
    describe('execute - OPEN state', () => {
        beforeEach(async () => {
            // Force circuit breaker to OPEN state
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
        });
        it('should reject requests immediately', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow(CircuitBreaker_1.CircuitBreakerError);
            expect(mockFn).not.toHaveBeenCalled();
        });
        it('should transition to HALF_OPEN after recovery timeout', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Wait for recovery timeout
            await new Promise(resolve => setTimeout(resolve, 1100));
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.HALF_OPEN);
        });
    });
    describe('execute - HALF_OPEN state', () => {
        beforeEach(async () => {
            // Force to OPEN state
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            // Wait for recovery timeout and transition to HALF_OPEN
            await new Promise(resolve => setTimeout(resolve, 1100));
            const successFn = jest.fn().mockResolvedValue('success');
            await circuitBreaker.execute(successFn);
        });
        it('should allow limited calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Should allow one more call (total 2 in half-open)
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should transition to CLOSED after successful calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should transition to OPEN on failure', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
        });
        it('should reject requests after max calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Complete the half-open transition
            await circuitBreaker.execute(mockFn);
            // Now in CLOSED state, should accept more calls
            await circuitBreaker.execute(mockFn);
            expect(mockFn).toHaveBeenCalledTimes(2);
        });
    });
    describe('state transitions', () => {
        it('should emit stateChange events', async () => {
            const stateChangeHandler = jest.fn();
            circuitBreaker.on('stateChange', stateChangeHandler);
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            // Trigger state change to OPEN
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            expect(stateChangeHandler).toHaveBeenCalledWith({
                from: CircuitBreaker_1.CircuitBreakerState.CLOSED,
                to: CircuitBreaker_1.CircuitBreakerState.OPEN,
                stats: expect.any(Object)
            });
        });
    });
    describe('admin operations', () => {
        it('should force close circuit breaker', () => {
            circuitBreaker.forceOpen();
            expect(circuitBreaker.getState()).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
            circuitBreaker.forceClose();
            expect(circuitBreaker.getState()).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should reset statistics', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().failureCount).toBe(1);
            circuitBreaker.reset();
            const stats = circuitBreaker.getStats();
            expect(stats.failureCount).toBe(0);
            expect(stats.successCount).toBe(0);
            expect(stats.totalRequests).toBe(0);
        });
    });
    describe('utility methods', () => {
        it('should calculate failure rate correctly', async () => {
            const mockFn = jest.fn()
                .mockRejectedValueOnce(new Error('error1'))
                .mockRejectedValueOnce(new Error('error2'))
                .mockResolvedValueOnce('success');
            // Two failures, then success
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('error1');
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('error2');
            await circuitBreaker.execute(mockFn);
            const stats = circuitBreaker.getStats();
            expect(stats.totalRequests).toBe(3);
            // After success in CLOSED state, failure count is reset to 0
            expect(stats.failureCount).toBe(0);
            expect(stats.successCount).toBe(1);
            // Test with no success to see actual failure rate
            const failureOnlyBreaker = new CircuitBreaker_1.CircuitBreaker({
                name: 'failure-test',
                failureThreshold: 5,
                recoveryTimeout: 1000,
                requestTimeout: 500,
                monitoringPeriod: 5000,
                halfOpenMaxCalls: 2
            });
            const failFn = jest.fn().mockRejectedValue(new Error('error'));
            await expect(failureOnlyBreaker.execute(failFn)).rejects.toThrow('error');
            await expect(failureOnlyBreaker.execute(failFn)).rejects.toThrow('error');
            expect(failureOnlyBreaker.getFailureRate()).toBeCloseTo(1.0);
            expect(failureOnlyBreaker.getSuccessRate()).toBeCloseTo(0.0);
        });
        it('should check if healthy', () => {
            expect(circuitBreaker.isHealthy()).toBe(true);
            circuitBreaker.forceOpen();
            expect(circuitBreaker.isHealthy()).toBe(false);
        });
        it('should calculate time until next attempt', () => {
            circuitBreaker.forceOpen();
            const timeUntilNext = circuitBreaker.getTimeUntilNextAttempt();
            expect(timeUntilNext).toBeGreaterThan(0);
        });
    });
    describe('defaults', () => {
        it('should have correct default configurations', () => {
            expect(CircuitBreaker_1.CircuitBreakerDefaults.http).toEqual({
                failureThreshold: 5,
                recoveryTimeout: 30000,
                requestTimeout: 10000,
                monitoringPeriod: 60000,
                halfOpenMaxCalls: 3,
                name: 'http-service'
            });
            expect(CircuitBreaker_1.CircuitBreakerDefaults.database).toEqual({
                failureThreshold: 3,
                recoveryTimeout: 60000,
                requestTimeout: 5000,
                monitoringPeriod: 300000,
                halfOpenMaxCalls: 2,
                name: 'database-service'
            });
        });
    });
    describe('error handling', () => {
        it('should handle CircuitBreakerError correctly', async () => {
            circuitBreaker.forceOpen();
            try {
                await circuitBreaker.execute(() => Promise.resolve('test'));
            }
            catch (error) {
                expect(error).toBeInstanceOf(CircuitBreaker_1.CircuitBreakerError);
                expect(error.state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
                expect(error.stats).toBeDefined();
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3NlcnZpY2VzL0NpcmN1aXRCcmVha2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBS0gsY0FBYztBQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUp0QyxzRUFBcUk7QUFDckkscURBQWtEO0FBSWxELE1BQU0sVUFBVSxHQUFHO0lBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNWLENBQUM7QUFFVCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksY0FBOEIsQ0FBQztJQUVuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3BCLGVBQU0sQ0FBQyxXQUF5QixDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUU5RCxjQUFjLEdBQUcsSUFBSSwrQkFBYyxDQUFDO1lBQ2xDLElBQUksRUFBRSxjQUFjO1lBQ3BCLGdCQUFnQixFQUFFLENBQUM7WUFDbkIsZUFBZSxFQUFFLElBQUk7WUFDckIsY0FBYyxFQUFFLEdBQUc7WUFDbkIsZ0JBQWdCLEVBQUUsSUFBSTtZQUN0QixnQkFBZ0IsRUFBRSxDQUFDO1NBQ3BCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFeEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMs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QzlDLGdCQUFnQixFQUFFLENBQUM7Z0JBQ25CLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixjQUFjLEVBQUUsSUFBSTtnQkFDcEIsZ0JBQWdCLEVBQUUsTUFBTTtnQkFDeEIsZ0JBQWdCLEVBQUUsQ0FBQztnQkFDbkIsSUFBSSxFQUFFLGtCQUFrQjthQUN6QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0QsY0FBYyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRTNCLElBQUksQ0FBQztnQkFDSCxNQUFNLGNBQWMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzlELENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxjQUFjLENBQUMsb0NBQW1CLENBQUMsQ0FBQztnQkFDbEQsTUFBTSxDQUFFLEtBQTZCLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLG9DQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM1RSxNQUFNLENBQUUsS0FBNkIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy9zZXJ2aWNlcy9DaXJjdWl0QnJlYWtlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2lyY3VpdEJyZWFrZXIgVGVzdHNcbiAqIFxuICogQ29tcHJlaGVuc2l2ZSB1bml0IHRlc3RzIGZvciB0aGUgQ2lyY3VpdEJyZWFrZXIgY2xhc3NcbiAqL1xuXG5pbXBvcnQgeyBDaXJjdWl0QnJlYWtlciwgQ2lyY3VpdEJyZWFrZXJTdGF0ZSwgQ2lyY3VpdEJyZWFrZXJFcnJvciwgQ2lyY3VpdEJyZWFrZXJEZWZhdWx0cyB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy9DaXJjdWl0QnJlYWtlcic7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi9zcmMvbG9nZ2luZy9Mb2dnZXInO1xuXG4vLyBNb2NrIExvZ2dlclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvbG9nZ2luZy9Mb2dnZXInKTtcbmNvbnN0IG1vY2tMb2dnZXIgPSB7XG4gIGluZm86IGplc3QuZm4oKSxcbiAgd2FybjogamVzdC5mbigpLFxuICBlcnJvcjogamVzdC5mbigpLFxuICBkZWJ1ZzogamVzdC5mbigpXG59IGFzIGFueTtcblxuZGVzY3JpYmUoJ0NpcmN1aXRCcmVha2VyJywgKCkgPT4ge1xuICBsZXQgY2lyY3VpdEJyZWFrZXI6IENpcmN1aXRCcmVha2VyO1xuICBcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgKExvZ2dlci5nZXRJbnN0YW5jZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShtb2NrTG9nZ2VyKTtcbiAgICBcbiAgICBjaXJjdWl0QnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcih7XG4gICAgICBuYW1lOiAndGVzdC1zZXJ2aWNlJyxcbiAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDMsXG4gICAgICByZWNvdmVyeVRpbWVvdXQ6IDEwMDAsXG4gICAgICByZXF1ZXN0VGltZW91dDogNTAwLFxuICAgICAgbW9uaXRvcmluZ1BlcmlvZDogNTAwMCxcbiAgICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDJcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB3aXRoIGNvcnJlY3QgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN0YXRzLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICAgIGV4cGVjdChzdGF0cy5mYWlsdXJlQ291bnQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuc3VjY2Vzc0NvdW50KS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUmVxdWVzdHMpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBpbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnQ2lyY3VpdCBicmVha2VyIGluaXRpYWxpemVkJyxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbmFtZTogJ3Rlc3Qtc2VydmljZScsXG4gICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMyxcbiAgICAgICAgICByZWNvdmVyeVRpbWVvdXQ6IDEwMDAsXG4gICAgICAgICAgcmVxdWVzdFRpbWVvdXQ6IDUwMFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4ZWN1dGUgLSBDTE9TRUQgc3RhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIGZ1bmN0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChtb2NrRm4pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdWNjZXNzQ291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxSZXF1ZXN0cykudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGZ1bmN0aW9uIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdUZXN0IGVycm9yJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICAgIGV4cGVjdChzdGF0cy5mYWlsdXJlQ291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxSZXF1ZXN0cykudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhbnNpdGlvbiB0byBPUEVOIGFmdGVyIGZhaWx1cmUgdGhyZXNob2xkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgLy8gRmFpbCAzIHRpbWVzICh0aHJlc2hvbGQpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTik7XG4gICAgICBleHBlY3Qoc3RhdHMuZmFpbHVyZUNvdW50KS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNldCBmYWlsdXJlIGNvdW50IG9uIHN1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKClcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJyk7XG4gICAgICBcbiAgICAgIC8vIEZhaWwgb25jZVxuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKS5mYWlsdXJlQ291bnQpLnRvQmUoMSk7XG4gICAgICBcbiAgICAgIC8vIFN1Y2NlZWRcbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKTtcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLmZhaWx1cmVDb3VudCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHRpbWVvdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFxuICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpXG4gICAgICApO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1JlcXVlc3QgdGltZW91dCcpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZmFpbHVyZUNvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXhlY3V0ZSAtIE9QRU4gc3RhdGUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGb3JjZSBjaXJjdWl0IGJyZWFrZXIgdG8gT1BFTiBzdGF0ZVxuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnVGVzdCBlcnJvcicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVxdWVzdHMgaW1tZWRpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KENpcmN1aXRCcmVha2VyRXJyb3IpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0ZuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFuc2l0aW9uIHRvIEhBTEZfT1BFTiBhZnRlciByZWNvdmVyeSB0aW1lb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJyk7XG4gICAgICBcbiAgICAgIC8vIFdhaXQgZm9yIHJlY292ZXJ5IHRpbWVvdXRcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMTAwKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCkuc3RhdGUpLnRvQmUoQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU4pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXhlY3V0ZSAtIEhBTEZfT1BFTiBzdGF0ZScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEZvcmNlIHRvIE9QRU4gc3RhdGVcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gV2FpdCBmb3IgcmVjb3ZlcnkgdGltZW91dCBhbmQgdHJhbnNpdGlvbiB0byBIQUxGX09QRU5cbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMTAwKSk7XG4gICAgICBjb25zdCBzdWNjZXNzRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUoc3VjY2Vzc0ZuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgbGltaXRlZCBjYWxscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgYWxsb3cgb25lIG1vcmUgY2FsbCAodG90YWwgMiBpbiBoYWxmLW9wZW4pXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhbnNpdGlvbiB0byBDTE9TRUQgYWZ0ZXIgc3VjY2Vzc2Z1bCBjYWxscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhbnNpdGlvbiB0byBPUEVOIG9uIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdUZXN0IGVycm9yJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCkuc3RhdGUpLnRvQmUoQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlcXVlc3RzIGFmdGVyIG1heCBjYWxscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICAvLyBDb21wbGV0ZSB0aGUgaGFsZi1vcGVuIHRyYW5zaXRpb25cbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKTtcbiAgICAgIFxuICAgICAgLy8gTm93IGluIENMT1NFRCBzdGF0ZSwgc2hvdWxkIGFjY2VwdCBtb3JlIGNhbGxzXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBleHBlY3QobW9ja0ZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdGF0ZSB0cmFuc2l0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgc3RhdGVDaGFuZ2UgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdGVDaGFuZ2VIYW5kbGVyID0gamVzdC5mbigpO1xuICAgICAgY2lyY3VpdEJyZWFrZXIub24oJ3N0YXRlQ2hhbmdlJywgc3RhdGVDaGFuZ2VIYW5kbGVyKTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgLy8gVHJpZ2dlciBzdGF0ZSBjaGFuZ2UgdG8gT1BFTlxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0ZUNoYW5nZUhhbmRsZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZnJvbTogQ2lyY3VpdEJyZWFrZXJTdGF0ZS5DTE9TRUQsXG4gICAgICAgIHRvOiBDaXJjdWl0QnJlYWtlclN0YXRlLk9QRU4sXG4gICAgICAgIHN0YXRzOiBleHBlY3QuYW55KE9iamVjdClcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWRtaW4gb3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZvcmNlIGNsb3NlIGNpcmN1aXQgYnJlYWtlcicsICgpID0+IHtcbiAgICAgIGNpcmN1aXRCcmVha2VyLmZvcmNlT3BlbigpO1xuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRlKCkpLnRvQmUoQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOKTtcbiAgICAgIFxuICAgICAgY2lyY3VpdEJyZWFrZXIuZm9yY2VDbG9zZSgpO1xuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRlKCkpLnRvQmUoQ2lyY3VpdEJyZWFrZXJTdGF0ZS5DTE9TRUQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNldCBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnVGVzdCBlcnJvcicpO1xuICAgICAgXG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKS5mYWlsdXJlQ291bnQpLnRvQmUoMSk7XG4gICAgICBcbiAgICAgIGNpcmN1aXRCcmVha2VyLnJlc2V0KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5mYWlsdXJlQ291bnQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuc3VjY2Vzc0NvdW50KS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUmVxdWVzdHMpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1dGlsaXR5IG1ldGhvZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgZmFpbHVyZSByYXRlIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKVxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignZXJyb3IxJykpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdlcnJvcjInKSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICAvLyBUd28gZmFpbHVyZXMsIHRoZW4gc3VjY2Vzc1xuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdlcnJvcjEnKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnZXJyb3IyJyk7XG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFJlcXVlc3RzKS50b0JlKDMpO1xuICAgICAgLy8gQWZ0ZXIgc3VjY2VzcyBpbiBDTE9TRUQgc3RhdGUsIGZhaWx1cmUgY291bnQgaXMgcmVzZXQgdG8gMFxuICAgICAgZXhwZWN0KHN0YXRzLmZhaWx1cmVDb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdWNjZXNzQ291bnQpLnRvQmUoMSk7XG4gICAgICBcbiAgICAgIC8vIFRlc3Qgd2l0aCBubyBzdWNjZXNzIHRvIHNlZSBhY3R1YWwgZmFpbHVyZSByYXRlXG4gICAgICBjb25zdCBmYWlsdXJlT25seUJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoe1xuICAgICAgICBuYW1lOiAnZmFpbHVyZS10ZXN0JyxcbiAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogNSxcbiAgICAgICAgcmVjb3ZlcnlUaW1lb3V0OiAxMDAwLFxuICAgICAgICByZXF1ZXN0VGltZW91dDogNTAwLFxuICAgICAgICBtb25pdG9yaW5nUGVyaW9kOiA1MDAwLFxuICAgICAgICBoYWxmT3Blbk1heENhbGxzOiAyXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgZmFpbEZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignZXJyb3InKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChmYWlsdXJlT25seUJyZWFrZXIuZXhlY3V0ZShmYWlsRm4pKS5yZWplY3RzLnRvVGhyb3coJ2Vycm9yJyk7XG4gICAgICBhd2FpdCBleHBlY3QoZmFpbHVyZU9ubHlCcmVha2VyLmV4ZWN1dGUoZmFpbEZuKSkucmVqZWN0cy50b1Rocm93KCdlcnJvcicpO1xuICAgICAgXG4gICAgICBleHBlY3QoZmFpbHVyZU9ubHlCcmVha2VyLmdldEZhaWx1cmVSYXRlKCkpLnRvQmVDbG9zZVRvKDEuMCk7XG4gICAgICBleHBlY3QoZmFpbHVyZU9ubHlCcmVha2VyLmdldFN1Y2Nlc3NSYXRlKCkpLnRvQmVDbG9zZVRvKDAuMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIGlmIGhlYWx0aHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuaXNIZWFsdGh5KCkpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIGNpcmN1aXRCcmVha2VyLmZvcmNlT3BlbigpO1xuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmlzSGVhbHRoeSgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHRpbWUgdW50aWwgbmV4dCBhdHRlbXB0JywgKCkgPT4ge1xuICAgICAgY2lyY3VpdEJyZWFrZXIuZm9yY2VPcGVuKCk7XG4gICAgICBjb25zdCB0aW1lVW50aWxOZXh0ID0gY2lyY3VpdEJyZWFrZXIuZ2V0VGltZVVudGlsTmV4dEF0dGVtcHQoKTtcbiAgICAgIGV4cGVjdCh0aW1lVW50aWxOZXh0KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWZhdWx0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25zJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KENpcmN1aXRCcmVha2VyRGVmYXVsdHMuaHR0cCkudG9FcXVhbCh7XG4gICAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDUsXG4gICAgICAgIHJlY292ZXJ5VGltZW91dDogMzAwMDAsXG4gICAgICAgIHJlcXVlc3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgbW9uaXRvcmluZ1BlcmlvZDogNjAwMDAsXG4gICAgICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDMsXG4gICAgICAgIG5hbWU6ICdodHRwLXNlcnZpY2UnXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KENpcmN1aXRCcmVha2VyRGVmYXVsdHMuZGF0YWJhc2UpLnRvRXF1YWwoe1xuICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiAzLFxuICAgICAgICByZWNvdmVyeVRpbWVvdXQ6IDYwMDAwLFxuICAgICAgICByZXF1ZXN0VGltZW91dDogNTAwMCxcbiAgICAgICAgbW9uaXRvcmluZ1BlcmlvZDogMzAwMDAwLFxuICAgICAgICBoYWxmT3Blbk1heENhbGxzOiAyLFxuICAgICAgICBuYW1lOiAnZGF0YWJhc2Utc2VydmljZSdcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXJyb3IgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgQ2lyY3VpdEJyZWFrZXJFcnJvciBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjaXJjdWl0QnJlYWtlci5mb3JjZU9wZW4oKTtcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZSgoKSA9PiBQcm9taXNlLnJlc29sdmUoJ3Rlc3QnKSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKENpcmN1aXRCcmVha2VyRXJyb3IpO1xuICAgICAgICBleHBlY3QoKGVycm9yIGFzIENpcmN1aXRCcmVha2VyRXJyb3IpLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTik7XG4gICAgICAgIGV4cGVjdCgoZXJyb3IgYXMgQ2lyY3VpdEJyZWFrZXJFcnJvcikuc3RhdHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9