18479adf624d986c4cee510c6de69b61
"use strict";
/**
 * Notification Service for Titan Brain
 * Handles all notification channels (Telegram, email) for alerts
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationService = exports.NotificationType = void 0;
/**
 * Notification types for different alert categories
 */
var NotificationType;
(function (NotificationType) {
    NotificationType["CIRCUIT_BREAKER"] = "CIRCUIT_BREAKER";
    NotificationType["HIGH_CORRELATION"] = "HIGH_CORRELATION";
    NotificationType["SWEEP_NOTIFICATION"] = "SWEEP_NOTIFICATION";
    NotificationType["VETO_NOTIFICATION"] = "VETO_NOTIFICATION";
    NotificationType["SYSTEM_ERROR"] = "SYSTEM_ERROR";
})(NotificationType || (exports.NotificationType = NotificationType = {}));
/**
 * Notification service for sending alerts via multiple channels
 */
class NotificationService {
    config;
    retryAttempts = 3;
    retryDelay = 1000; // 1 second base delay
    constructor(config) {
        this.config = config;
    }
    /**
     * Send circuit breaker emergency notification
     * Requirement 5.6: Send emergency notifications via all configured channels
     */
    async sendCircuitBreakerNotification(data) {
        const message = {
            type: NotificationType.CIRCUIT_BREAKER,
            title: 'ðŸš¨ CIRCUIT BREAKER TRIGGERED',
            message: this.formatCircuitBreakerMessage(data),
            priority: 'CRITICAL',
            timestamp: Date.now(),
            metadata: data,
        };
        await this.sendNotification(message);
    }
    /**
     * Send high correlation warning
     * Requirement 6.5: Display warning when correlation exceeds threshold
     */
    async sendHighCorrelationWarning(data) {
        const message = {
            type: NotificationType.HIGH_CORRELATION,
            title: 'âš ï¸ HIGH CORRELATION WARNING',
            message: this.formatHighCorrelationMessage(data),
            priority: 'HIGH',
            timestamp: Date.now(),
            metadata: data,
        };
        await this.sendNotification(message);
    }
    /**
     * Send sweep notification
     * Requirement 4.7: Log all sweep transactions
     */
    async sendSweepNotification(data) {
        const message = {
            type: NotificationType.SWEEP_NOTIFICATION,
            title: 'ðŸ’° PROFIT SWEEP EXECUTED',
            message: this.formatSweepMessage(data),
            priority: 'MEDIUM',
            timestamp: Date.now(),
            metadata: data,
        };
        await this.sendNotification(message);
    }
    /**
     * Send veto notification to phases
     * Requirement 7.6: Notify originating phase when signal is vetoed
     */
    async sendVetoNotification(data) {
        const message = {
            type: NotificationType.VETO_NOTIFICATION,
            title: 'âŒ SIGNAL VETOED',
            message: this.formatVetoMessage(data),
            priority: 'MEDIUM',
            timestamp: Date.now(),
            metadata: data,
        };
        await this.sendNotification(message);
    }
    /**
     * Send system error notification
     */
    async sendSystemError(error, context) {
        const message = {
            type: NotificationType.SYSTEM_ERROR,
            title: 'ðŸ”¥ SYSTEM ERROR',
            message: `System Error: ${error}`,
            priority: 'HIGH',
            timestamp: Date.now(),
            metadata: context,
        };
        await this.sendNotification(message);
    }
    /**
     * Send notification via all enabled channels
     */
    async sendNotification(message) {
        const promises = [];
        // Send via Telegram if enabled
        if (this.config.telegram.enabled) {
            promises.push(this.sendTelegramNotification(message));
        }
        // Send via Email if enabled
        if (this.config.email.enabled) {
            promises.push(this.sendEmailNotification(message));
        }
        // Wait for all notifications to complete
        if (promises.length > 0) {
            await Promise.allSettled(promises);
        }
    }
    /**
     * Send notification via Telegram
     */
    async sendTelegramNotification(message) {
        if (!this.config.telegram.botToken || !this.config.telegram.chatId) {
            throw new Error('Telegram configuration incomplete');
        }
        const telegramMessage = this.formatTelegramMessage(message);
        const url = `https://api.telegram.org/bot${this.config.telegram.botToken}/sendMessage`;
        const payload = {
            chat_id: this.config.telegram.chatId,
            text: telegramMessage,
            parse_mode: 'Markdown',
        };
        await this.retryRequest(async () => {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            });
            if (!response.ok) {
                const error = await response.text();
                throw new Error(`Telegram API error: ${response.status} - ${error}`);
            }
        });
    }
    /**
     * Send notification via Email (placeholder implementation)
     */
    async sendEmailNotification(message) {
        if (!this.config.email.smtpHost || !this.config.email.from || !this.config.email.to?.length) {
            throw new Error('Email configuration incomplete');
        }
        // TODO: Implement email sending using nodemailer or similar
        // For now, just log the email that would be sent
        console.log('Email notification (not implemented):', {
            to: this.config.email.to,
            subject: message.title,
            body: message.message,
            timestamp: new Date(message.timestamp).toISOString(),
        });
    }
    /**
     * Format circuit breaker message
     */
    formatCircuitBreakerMessage(data) {
        return `EMERGENCY: Circuit breaker triggered!
    
Reason: ${data.reason}
Current Equity: $${data.equity.toFixed(2)}
Drawdown: ${(data.drawdown * 100).toFixed(2)}%
Time: ${new Date(data.triggeredAt).toISOString()}

All positions have been closed and trading is halted.
Manual reset required to resume operations.`;
    }
    /**
     * Format high correlation message
     */
    formatHighCorrelationMessage(data) {
        return `High correlation detected between positions!
    
Correlation Score: ${(data.correlationScore * 100).toFixed(2)}%
Threshold: ${(data.threshold * 100).toFixed(2)}%
Affected Positions: ${data.affectedPositions.join(', ')}

Risk management measures may be applied to new signals.`;
    }
    /**
     * Format sweep message
     */
    formatSweepMessage(data) {
        return `Profit sweep executed successfully!
    
Amount: $${data.amount.toFixed(2)}
From: ${data.fromWallet}
To: ${data.toWallet}
Reason: ${data.reason}
New Balance: $${data.newBalance.toFixed(2)}`;
    }
    /**
     * Format veto message
     */
    formatVetoMessage(data) {
        return `Signal vetoed by Brain risk management!
    
Phase: ${data.phaseId}
Signal ID: ${data.signalId}
Symbol: ${data.symbol}
Requested Size: $${data.requestedSize.toFixed(2)}
Reason: ${data.reason}`;
    }
    /**
     * Format message for Telegram with markdown
     */
    formatTelegramMessage(message) {
        const priorityEmoji = {
            LOW: 'ðŸ”µ',
            MEDIUM: 'ðŸŸ¡',
            HIGH: 'ðŸŸ ',
            CRITICAL: 'ðŸ”´',
        };
        return `${priorityEmoji[message.priority]} *${message.title}*

${message.message}

_${new Date(message.timestamp).toISOString()}_`;
    }
    /**
     * Retry mechanism for network requests
     */
    async retryRequest(fn) {
        let lastError = null;
        for (let attempt = 1; attempt <= this.retryAttempts; attempt++) {
            try {
                await fn();
                return; // Success
            }
            catch (error) {
                lastError = error;
                if (attempt < this.retryAttempts) {
                    // Exponential backoff
                    const delay = this.retryDelay * Math.pow(2, attempt - 1);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        // All retries failed
        throw new Error(`Notification failed after ${this.retryAttempts} attempts: ${lastError?.message}`);
    }
    /**
     * Update configuration
     */
    updateConfig(config) {
        this.config = config;
    }
    /**
     * Test notification channels
     */
    async testNotifications() {
        const results = { telegram: false, email: false };
        // Test Telegram
        if (this.config.telegram.enabled) {
            try {
                const testMessage = {
                    type: NotificationType.SYSTEM_ERROR,
                    title: 'ðŸ§ª Test Notification',
                    message: 'This is a test notification from Titan Brain.',
                    priority: 'LOW',
                    timestamp: Date.now(),
                };
                await this.sendTelegramNotification(testMessage);
                results.telegram = true;
            }
            catch (error) {
                console.error('Telegram test failed:', error);
            }
        }
        // Test Email
        if (this.config.email.enabled) {
            try {
                const testMessage = {
                    type: NotificationType.SYSTEM_ERROR,
                    title: 'ðŸ§ª Test Notification',
                    message: 'This is a test notification from Titan Brain.',
                    priority: 'LOW',
                    timestamp: Date.now(),
                };
                await this.sendEmailNotification(testMessage);
                results.email = true;
            }
            catch (error) {
                console.error('Email test failed:', error);
            }
        }
        return results;
    }
}
exports.NotificationService = NotificationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2ZXIvTm90aWZpY2F0aW9uU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFLSDs7R0FFRztBQUNILElBQVksZ0JBTVg7QUFORCxXQUFZLGdCQUFnQjtJQUMxQix1REFBbUMsQ0FBQTtJQUNuQyx5REFBcUMsQ0FBQTtJQUNyQyw2REFBeUMsQ0FBQTtJQUN6QywyREFBdUMsQ0FBQTtJQUN2QyxpREFBNkIsQ0FBQTtBQUMvQixDQUFDLEVBTlcsZ0JBQWdCLGdDQUFoQixnQkFBZ0IsUUFNM0I7QUF1REQ7O0dBRUc7QUFDSCxNQUFhLG1CQUFtQjtJQUN0QixNQUFNLENBQXFCO0lBQzNCLGFBQWEsR0FBRyxDQUFDLENBQUM7SUFDbEIsVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLHNCQUFzQjtJQUVqRCxZQUFZLE1BQTBCO1FBQ3BDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsOEJBQThCLENBQUMsSUFBZ0M7UUFDbkUsTUFBTSxPQUFPLEdBQXdCO1lBQ25DLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxlQUFlO1lBQ3RDLEtBQUssRUFBRSw4QkFBOEI7WUFDckMsT0FBTyxFQUFFLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxJQUFJLENBQUM7WUFDL0MsUUFBUSxFQUFFLFVBQVU7WUFDcEIsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDckIsUUFBUSxFQUFFLElBQUk7U0FDZixDQUFDO1FBRUYsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxJQUFpQztRQUNoRSxNQUFNLE9BQU8sR0FBd0I7WUFDbkMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLGdCQUFnQjtZQUN2QyxL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aUJBQ3RCLENBQUM7Z0JBQ0YsTUFBTSxJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2pELE9BQU8sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQzFCLENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaEQsQ0FBQztRQUNILENBQUM7UUFFRCxhQUFhO1FBQ2IsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxXQUFXLEdBQXdCO29CQUN2QyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsWUFBWTtvQkFDbkMsS0FBSyxFQUFFLHNCQUFzQjtvQkFDN0IsT0FBTyxFQUFFLCtDQUErQztvQkFDeEQsUUFBUSxFQUFFLEtBQUs7b0JBQ2YsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7aUJBQ3RCLENBQUM7Z0JBQ0YsTUFBTSxJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQzlDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ3ZCLENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0NBQ0Y7QUF4VEQsa0RBd1RDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi9zcmMvc2VydmVyL05vdGlmaWNhdGlvblNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBOb3RpZmljYXRpb24gU2VydmljZSBmb3IgVGl0YW4gQnJhaW5cbiAqIEhhbmRsZXMgYWxsIG5vdGlmaWNhdGlvbiBjaGFubmVscyAoVGVsZWdyYW0sIGVtYWlsKSBmb3IgYWxlcnRzXG4gKi9cblxuaW1wb3J0IHsgTm90aWZpY2F0aW9uQ29uZmlnIH0gZnJvbSAnLi4vdHlwZXMvY29uZmlnLmpzJztcbmltcG9ydCB7IFBoYXNlSWQgfSBmcm9tICcuLi90eXBlcy9wZXJmb3JtYW5jZS5qcyc7XG5cbi8qKlxuICogTm90aWZpY2F0aW9uIHR5cGVzIGZvciBkaWZmZXJlbnQgYWxlcnQgY2F0ZWdvcmllc1xuICovXG5leHBvcnQgZW51bSBOb3RpZmljYXRpb25UeXBlIHtcbiAgQ0lSQ1VJVF9CUkVBS0VSID0gJ0NJUkNVSVRfQlJFQUtFUicsXG4gIEhJR0hfQ09SUkVMQVRJT04gPSAnSElHSF9DT1JSRUxBVElPTicsIFxuICBTV0VFUF9OT1RJRklDQVRJT04gPSAnU1dFRVBfTk9USUZJQ0FUSU9OJyxcbiAgVkVUT19OT1RJRklDQVRJT04gPSAnVkVUT19OT1RJRklDQVRJT04nLFxuICBTWVNURU1fRVJST1IgPSAnU1lTVEVNX0VSUk9SJyxcbn1cblxuLyoqXG4gKiBOb3RpZmljYXRpb24gbWVzc2FnZSBpbnRlcmZhY2VcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBOb3RpZmljYXRpb25NZXNzYWdlIHtcbiAgdHlwZTogTm90aWZpY2F0aW9uVHlwZTtcbiAgdGl0bGU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBwcmlvcml0eTogJ0xPVycgfCAnTUVESVVNJyB8ICdISUdIJyB8ICdDUklUSUNBTCc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbi8qKlxuICogQ2lyY3VpdCBicmVha2VyIG5vdGlmaWNhdGlvbiBkYXRhXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJOb3RpZmljYXRpb24ge1xuICByZWFzb246IHN0cmluZztcbiAgZXF1aXR5OiBudW1iZXI7XG4gIGRyYXdkb3duOiBudW1iZXI7XG4gIHRyaWdnZXJlZEF0OiBudW1iZXI7XG59XG5cbi8qKlxuICogSGlnaCBjb3JyZWxhdGlvbiB3YXJuaW5nIGRhdGFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBIaWdoQ29ycmVsYXRpb25Ob3RpZmljYXRpb24ge1xuICBjb3JyZWxhdGlvblNjb3JlOiBudW1iZXI7XG4gIHRocmVzaG9sZDogbnVtYmVyO1xuICBhZmZlY3RlZFBvc2l0aW9uczogc3RyaW5nW107XG59XG5cbi8qKlxuICogU3dlZXAgbm90aWZpY2F0aW9uIGRhdGFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTd2VlcE5vdGlmaWNhdGlvbiB7XG4gIGFtb3VudDogbnVtYmVyO1xuICBmcm9tV2FsbGV0OiBzdHJpbmc7XG4gIHRvV2FsbGV0OiBzdHJpbmc7XG4gIHJlYXNvbjogc3RyaW5nO1xuICBuZXdCYWxhbmNlOiBudW1iZXI7XG59XG5cbi8qKlxuICogVmV0byBub3RpZmljYXRpb24gZGF0YVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZldG9Ob3RpZmljYXRpb24ge1xuICBwaGFzZUlkOiBQaGFzZUlkO1xuICBzaWduYWxJZDogc3RyaW5nO1xuICBzeW1ib2w6IHN0cmluZztcbiAgcmVhc29uOiBzdHJpbmc7XG4gIHJlcXVlc3RlZFNpemU6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBOb3RpZmljYXRpb24gc2VydmljZSBmb3Igc2VuZGluZyBhbGVydHMgdmlhIG11bHRpcGxlIGNoYW5uZWxzXG4gKi9cbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjb25maWc6IE5vdGlmaWNhdGlvbkNvbmZpZztcbiAgcHJpdmF0ZSByZXRyeUF0dGVtcHRzID0gMztcbiAgcHJpdmF0ZSByZXRyeURlbGF5ID0gMTAwMDsgLy8gMSBzZWNvbmQgYmFzZSBkZWxheVxuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogTm90aWZpY2F0aW9uQ29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBjaXJjdWl0IGJyZWFrZXIgZW1lcmdlbmN5IG5vdGlmaWNhdGlvblxuICAgKiBSZXF1aXJlbWVudCA1LjY6IFNlbmQgZW1lcmdlbmN5IG5vdGlmaWNhdGlvbnMgdmlhIGFsbCBjb25maWd1cmVkIGNoYW5uZWxzXG4gICAqL1xuICBhc3luYyBzZW5kQ2lyY3VpdEJyZWFrZXJOb3RpZmljYXRpb24oZGF0YTogQ2lyY3VpdEJyZWFrZXJOb3RpZmljYXRpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBtZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlID0ge1xuICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5DSVJDVUlUX0JSRUFLRVIsXG4gICAgICB0aXRsZTogJ/CfmqggQ0lSQ1VJVCBCUkVBS0VSIFRSSUdHRVJFRCcsXG4gICAgICBtZXNzYWdlOiB0aGlzLmZvcm1hdENpcmN1aXRCcmVha2VyTWVzc2FnZShkYXRhKSxcbiAgICAgIHByaW9yaXR5OiAnQ1JJVElDQUwnLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgbWV0YWRhdGE6IGRhdGEsXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZE5vdGlmaWNhdGlvbihtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGhpZ2ggY29ycmVsYXRpb24gd2FybmluZ1xuICAgKiBSZXF1aXJlbWVudCA2LjU6IERpc3BsYXkgd2FybmluZyB3aGVuIGNvcnJlbGF0aW9uIGV4Y2VlZHMgdGhyZXNob2xkXG4gICAqL1xuICBhc3luYyBzZW5kSGlnaENvcnJlbGF0aW9uV2FybmluZyhkYXRhOiBIaWdoQ29ycmVsYXRpb25Ob3RpZmljYXRpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBtZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlID0ge1xuICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5ISUdIX0NPUlJFTEFUSU9OLFxuICAgICAgdGl0bGU6ICfimqDvuI8gSElHSCBDT1JSRUxBVElPTiBXQVJOSU5HJyxcbiAgICAgIG1lc3NhZ2U6IHRoaXMuZm9ybWF0SGlnaENvcnJlbGF0aW9uTWVzc2FnZShkYXRhKSxcbiAgICAgIHByaW9yaXR5OiAnSElHSCcsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBtZXRhZGF0YTogZGF0YSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kTm90aWZpY2F0aW9uKG1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgc3dlZXAgbm90aWZpY2F0aW9uXG4gICAqIFJlcXVpcmVtZW50IDQuNzogTG9nIGFsbCBzd2VlcCB0cmFuc2FjdGlvbnNcbiAgICovXG4gIGFzeW5jIHNlbmRTd2VlcE5vdGlmaWNhdGlvbihkYXRhOiBTd2VlcE5vdGlmaWNhdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1lc3NhZ2U6IE5vdGlmaWNhdGlvbk1lc3NhZ2UgPSB7XG4gICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLlNXRUVQX05PVElGSUNBVElPTixcbiAgICAgIHRpdGxlOiAn8J+SsCBQUk9GSVQgU1dFRVAgRVhFQ1VURUQnLFxuICAgICAgbWVzc2FnZTogdGhpcy5mb3JtYXRTd2VlcE1lc3NhZ2UoZGF0YSksXG4gICAgICBwcmlvcml0eTogJ01FRElVTScsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBtZXRhZGF0YTogZGF0YSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kTm90aWZpY2F0aW9uKG1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgdmV0byBub3RpZmljYXRpb24gdG8gcGhhc2VzXG4gICAqIFJlcXVpcmVtZW50IDcuNjogTm90aWZ5IG9yaWdpbmF0aW5nIHBoYXNlIHdoZW4gc2lnbmFsIGlzIHZldG9lZFxuICAgKi9cbiAgYXN5bmMgc2VuZFZldG9Ob3RpZmljYXRpb24oZGF0YTogVmV0b05vdGlmaWNhdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1lc3NhZ2U6IE5vdGlmaWNhdGlvbk1lc3NhZ2UgPSB7XG4gICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLlZFVE9fTk9USUZJQ0FUSU9OLFxuICAgICAgdGl0bGU6ICfinYwgU0lHTkFMIFZFVE9FRCcsXG4gICAgICBtZXNzYWdlOiB0aGlzLmZvcm1hdFZldG9NZXNzYWdlKGRhdGEpLFxuICAgICAgcHJpb3JpdHk6ICdNRURJVU0nLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgbWV0YWRhdGE6IGRhdGEsXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZE5vdGlmaWNhdGlvbihtZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHN5c3RlbSBlcnJvciBub3RpZmljYXRpb25cbiAgICovXG4gIGFzeW5jIHNlbmRTeXN0ZW1FcnJvcihlcnJvcjogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1lc3NhZ2U6IE5vdGlmaWNhdGlvbk1lc3NhZ2UgPSB7XG4gICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLlNZU1RFTV9FUlJPUixcbiAgICAgIHRpdGxlOiAn8J+UpSBTWVNURU0gRVJST1InLFxuICAgICAgbWVzc2FnZTogYFN5c3RlbSBFcnJvcjogJHtlcnJvcn1gLFxuICAgICAgcHJpb3JpdHk6ICdISUdIJyxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIG1ldGFkYXRhOiBjb250ZXh0LFxuICAgIH07XG5cbiAgICBhd2FpdCB0aGlzLnNlbmROb3RpZmljYXRpb24obWVzc2FnZSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBub3RpZmljYXRpb24gdmlhIGFsbCBlbmFibGVkIGNoYW5uZWxzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmROb3RpZmljYXRpb24obWVzc2FnZTogTm90aWZpY2F0aW9uTWVzc2FnZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPHZvaWQ+W10gPSBbXTtcblxuICAgIC8vIFNlbmQgdmlhIFRlbGVncmFtIGlmIGVuYWJsZWRcbiAgICBpZiAodGhpcy5jb25maWcudGVsZWdyYW0uZW5hYmxlZCkge1xuICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLnNlbmRUZWxlZ3JhbU5vdGlmaWNhdGlvbihtZXNzYWdlKSk7XG4gICAgfVxuXG4gICAgLy8gU2VuZCB2aWEgRW1haWwgaWYgZW5hYmxlZFxuICAgIGlmICh0aGlzLmNvbmZpZy5lbWFpbC5lbmFibGVkKSB7XG4gICAgICBwcm9taXNlcy5wdXNoKHRoaXMuc2VuZEVtYWlsTm90aWZpY2F0aW9uKG1lc3NhZ2UpKTtcbiAgICB9XG5cbiAgICAvLyBXYWl0IGZvciBhbGwgbm90aWZpY2F0aW9ucyB0byBjb21wbGV0ZVxuICAgIGlmIChwcm9taXNlcy5sZW5ndGggPiAwKSB7XG4gICAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQocHJvbWlzZXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIG5vdGlmaWNhdGlvbiB2aWEgVGVsZWdyYW1cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZFRlbGVncmFtTm90aWZpY2F0aW9uKG1lc3NhZ2U6IE5vdGlmaWNhdGlvbk1lc3NhZ2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnRlbGVncmFtLmJvdFRva2VuIHx8ICF0aGlzLmNvbmZpZy50ZWxlZ3JhbS5jaGF0SWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGVsZWdyYW0gY29uZmlndXJhdGlvbiBpbmNvbXBsZXRlJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdGVsZWdyYW1NZXNzYWdlID0gdGhpcy5mb3JtYXRUZWxlZ3JhbU1lc3NhZ2UobWVzc2FnZSk7XG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3Qke3RoaXMuY29uZmlnLnRlbGVncmFtLmJvdFRva2VufS9zZW5kTWVzc2FnZWA7XG4gICAgXG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgIGNoYXRfaWQ6IHRoaXMuY29uZmlnLnRlbGVncmFtLmNoYXRJZCxcbiAgICAgIHRleHQ6IHRlbGVncmFtTWVzc2FnZSxcbiAgICAgIHBhcnNlX21vZGU6ICdNYXJrZG93bicsXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMucmV0cnlSZXF1ZXN0KGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUZWxlZ3JhbSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7ZXJyb3J9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBub3RpZmljYXRpb24gdmlhIEVtYWlsIChwbGFjZWhvbGRlciBpbXBsZW1lbnRhdGlvbilcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZEVtYWlsTm90aWZpY2F0aW9uKG1lc3NhZ2U6IE5vdGlmaWNhdGlvbk1lc3NhZ2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVtYWlsLnNtdHBIb3N0IHx8ICF0aGlzLmNvbmZpZy5lbWFpbC5mcm9tIHx8ICF0aGlzLmNvbmZpZy5lbWFpbC50bz8ubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtYWlsIGNvbmZpZ3VyYXRpb24gaW5jb21wbGV0ZScpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IEltcGxlbWVudCBlbWFpbCBzZW5kaW5nIHVzaW5nIG5vZGVtYWlsZXIgb3Igc2ltaWxhclxuICAgIC8vIEZvciBub3csIGp1c3QgbG9nIHRoZSBlbWFpbCB0aGF0IHdvdWxkIGJlIHNlbnRcbiAgICBjb25zb2xlLmxvZygnRW1haWwgbm90aWZpY2F0aW9uIChub3QgaW1wbGVtZW50ZWQpOicsIHtcbiAgICAgIHRvOiB0aGlzLmNvbmZpZy5lbWFpbC50byxcbiAgICAgIHN1YmplY3Q6IG1lc3NhZ2UudGl0bGUsXG4gICAgICBib2R5OiBtZXNzYWdlLm1lc3NhZ2UsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKG1lc3NhZ2UudGltZXN0YW1wKS50b0lTT1N0cmluZygpLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBjaXJjdWl0IGJyZWFrZXIgbWVzc2FnZVxuICAgKi9cbiAgcHJpdmF0ZSBmb3JtYXRDaXJjdWl0QnJlYWtlck1lc3NhZ2UoZGF0YTogQ2lyY3VpdEJyZWFrZXJOb3RpZmljYXRpb24pOiBzdHJpbmcge1xuICAgIHJldHVybiBgRU1FUkdFTkNZOiBDaXJjdWl0IGJyZWFrZXIgdHJpZ2dlcmVkIVxuICAgIFxuUmVhc29uOiAke2RhdGEucmVhc29ufVxuQ3VycmVudCBFcXVpdHk6ICQke2RhdGEuZXF1aXR5LnRvRml4ZWQoMil9XG5EcmF3ZG93bjogJHsoZGF0YS5kcmF3ZG93biAqIDEwMCkudG9GaXhlZCgyKX0lXG5UaW1lOiAke25ldyBEYXRlKGRhdGEudHJpZ2dlcmVkQXQpLnRvSVNPU3RyaW5nKCl9XG5cbkFsbCBwb3NpdGlvbnMgaGF2ZSBiZWVuIGNsb3NlZCBhbmQgdHJhZGluZyBpcyBoYWx0ZWQuXG5NYW51YWwgcmVzZXQgcmVxdWlyZWQgdG8gcmVzdW1lIG9wZXJhdGlvbnMuYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXQgaGlnaCBjb3JyZWxhdGlvbiBtZXNzYWdlXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdEhpZ2hDb3JyZWxhdGlvbk1lc3NhZ2UoZGF0YTogSGlnaENvcnJlbGF0aW9uTm90aWZpY2F0aW9uKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYEhpZ2ggY29ycmVsYXRpb24gZGV0ZWN0ZWQgYmV0d2VlbiBwb3NpdGlvbnMhXG4gICAgXG5Db3JyZWxhdGlvbiBTY29yZTogJHsoZGF0YS5jb3JyZWxhdGlvblNjb3JlICogMTAwKS50b0ZpeGVkKDIpfSVcblRocmVzaG9sZDogJHsoZGF0YS50aHJlc2hvbGQgKiAxMDApLnRvRml4ZWQoMil9JVxuQWZmZWN0ZWQgUG9zaXRpb25zOiAke2RhdGEuYWZmZWN0ZWRQb3NpdGlvbnMuam9pbignLCAnKX1cblxuUmlzayBtYW5hZ2VtZW50IG1lYXN1cmVzIG1heSBiZSBhcHBsaWVkIHRvIG5ldyBzaWduYWxzLmA7XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IHN3ZWVwIG1lc3NhZ2VcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0U3dlZXBNZXNzYWdlKGRhdGE6IFN3ZWVwTm90aWZpY2F0aW9uKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFByb2ZpdCBzd2VlcCBleGVjdXRlZCBzdWNjZXNzZnVsbHkhXG4gICAgXG5BbW91bnQ6ICQke2RhdGEuYW1vdW50LnRvRml4ZWQoMil9XG5Gcm9tOiAke2RhdGEuZnJvbVdhbGxldH1cblRvOiAke2RhdGEudG9XYWxsZXR9XG5SZWFzb246ICR7ZGF0YS5yZWFzb259XG5OZXcgQmFsYW5jZTogJCR7ZGF0YS5uZXdCYWxhbmNlLnRvRml4ZWQoMil9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXQgdmV0byBtZXNzYWdlXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdFZldG9NZXNzYWdlKGRhdGE6IFZldG9Ob3RpZmljYXRpb24pOiBzdHJpbmcge1xuICAgIHJldHVybiBgU2lnbmFsIHZldG9lZCBieSBCcmFpbiByaXNrIG1hbmFnZW1lbnQhXG4gICAgXG5QaGFzZTogJHtkYXRhLnBoYXNlSWR9XG5TaWduYWwgSUQ6ICR7ZGF0YS5zaWduYWxJZH1cblN5bWJvbDogJHtkYXRhLnN5bWJvbH1cblJlcXVlc3RlZCBTaXplOiAkJHtkYXRhLnJlcXVlc3RlZFNpemUudG9GaXhlZCgyKX1cblJlYXNvbjogJHtkYXRhLnJlYXNvbn1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBtZXNzYWdlIGZvciBUZWxlZ3JhbSB3aXRoIG1hcmtkb3duXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdFRlbGVncmFtTWVzc2FnZShtZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlKTogc3RyaW5nIHtcbiAgICBjb25zdCBwcmlvcml0eUVtb2ppID0ge1xuICAgICAgTE9XOiAn8J+UtScsXG4gICAgICBNRURJVU06ICfwn5+hJywgXG4gICAgICBISUdIOiAn8J+foCcsXG4gICAgICBDUklUSUNBTDogJ/CflLQnLFxuICAgIH07XG5cbiAgICByZXR1cm4gYCR7cHJpb3JpdHlFbW9qaVttZXNzYWdlLnByaW9yaXR5XX0gKiR7bWVzc2FnZS50aXRsZX0qXG5cbiR7bWVzc2FnZS5tZXNzYWdlfVxuXG5fJHtuZXcgRGF0ZShtZXNzYWdlLnRpbWVzdGFtcCkudG9JU09TdHJpbmcoKX1fYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyeSBtZWNoYW5pc20gZm9yIG5ldHdvcmsgcmVxdWVzdHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmV0cnlSZXF1ZXN0KGZuOiAoKSA9PiBQcm9taXNlPHZvaWQ+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgbGV0IGxhc3RFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcblxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAxOyBhdHRlbXB0IDw9IHRoaXMucmV0cnlBdHRlbXB0czsgYXR0ZW1wdCsrKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBmbigpO1xuICAgICAgICByZXR1cm47IC8vIFN1Y2Nlc3NcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVycm9yIGFzIEVycm9yO1xuICAgICAgICBcbiAgICAgICAgaWYgKGF0dGVtcHQgPCB0aGlzLnJldHJ5QXR0ZW1wdHMpIHtcbiAgICAgICAgICAvLyBFeHBvbmVudGlhbCBiYWNrb2ZmXG4gICAgICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLnJldHJ5RGVsYXkgKiBNYXRoLnBvdygyLCBhdHRlbXB0IC0gMSk7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBbGwgcmV0cmllcyBmYWlsZWRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vdGlmaWNhdGlvbiBmYWlsZWQgYWZ0ZXIgJHt0aGlzLnJldHJ5QXR0ZW1wdHN9IGF0dGVtcHRzOiAke2xhc3RFcnJvcj8ubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY29uZmlndXJhdGlvblxuICAgKi9cbiAgdXBkYXRlQ29uZmlnKGNvbmZpZzogTm90aWZpY2F0aW9uQ29uZmlnKTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBub3RpZmljYXRpb24gY2hhbm5lbHNcbiAgICovXG4gIGFzeW5jIHRlc3ROb3RpZmljYXRpb25zKCk6IFByb21pc2U8eyB0ZWxlZ3JhbTogYm9vbGVhbjsgZW1haWw6IGJvb2xlYW4gfT4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSB7IHRlbGVncmFtOiBmYWxzZSwgZW1haWw6IGZhbHNlIH07XG5cbiAgICAvLyBUZXN0IFRlbGVncmFtXG4gICAgaWYgKHRoaXMuY29uZmlnLnRlbGVncmFtLmVuYWJsZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHRlc3RNZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlID0ge1xuICAgICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuU1lTVEVNX0VSUk9SLFxuICAgICAgICAgIHRpdGxlOiAn8J+nqiBUZXN0IE5vdGlmaWNhdGlvbicsXG4gICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaXMgYSB0ZXN0IG5vdGlmaWNhdGlvbiBmcm9tIFRpdGFuIEJyYWluLicsXG4gICAgICAgICAgcHJpb3JpdHk6ICdMT1cnLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kVGVsZWdyYW1Ob3RpZmljYXRpb24odGVzdE1lc3NhZ2UpO1xuICAgICAgICByZXN1bHRzLnRlbGVncmFtID0gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RlbGVncmFtIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUZXN0IEVtYWlsXG4gICAgaWYgKHRoaXMuY29uZmlnLmVtYWlsLmVuYWJsZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHRlc3RNZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlID0ge1xuICAgICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuU1lTVEVNX0VSUk9SLFxuICAgICAgICAgIHRpdGxlOiAn8J+nqiBUZXN0IE5vdGlmaWNhdGlvbicsXG4gICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaXMgYSB0ZXN0IG5vdGlmaWNhdGlvbiBmcm9tIFRpdGFuIEJyYWluLicsXG4gICAgICAgICAgcHJpb3JpdHk6ICdMT1cnLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kRW1haWxOb3RpZmljYXRpb24odGVzdE1lc3NhZ2UpO1xuICAgICAgICByZXN1bHRzLmVtYWlsID0gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VtYWlsIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==