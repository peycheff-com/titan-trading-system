8b035036afef1e5808b31b1627cf89a6
"use strict";
/**
 * Unit Tests for CapitalFlowManager
 *
 * Tests sweep condition detection, reserve limit enforcement,
 * high watermark updates, and sweep retry logic.
 * Requirements: 4.1, 4.2, 4.3, 4.5, 4.8
 */
Object.defineProperty(exports, "__esModule", { value: true });
const CapitalFlowManager_js_1 = require("../../src/engine/CapitalFlowManager.js");
const defaults_js_1 = require("../../src/config/defaults.js");
/**
 * Mock Exchange API for testing
 */
class MockExchangeAPI {
    futuresBalance = 0;
    spotBalance = 0;
    transferShouldFail = false;
    failCount = 0;
    maxFailures = 0;
    setFuturesBalance(balance) {
        this.futuresBalance = balance;
    }
    setSpotBalance(balance) {
        this.spotBalance = balance;
    }
    setTransferShouldFail(shouldFail, maxFailures = Infinity) {
        this.transferShouldFail = shouldFail;
        this.maxFailures = maxFailures;
        this.failCount = 0;
    }
    async getFuturesBalance() {
        return this.futuresBalance;
    }
    async getSpotBalance() {
        return this.spotBalance;
    }
    async transferToSpot(amount) {
        if (this.transferShouldFail && this.failCount < this.maxFailures) {
            this.failCount++;
            return { success: false, error: 'Transfer failed' };
        }
        this.futuresBalance -= amount;
        this.spotBalance += amount;
        return { success: true, transactionId: `tx-${Date.now()}` };
    }
}
describe('CapitalFlowManager', () => {
    let manager;
    let mockAPI;
    let config;
    beforeEach(() => {
        config = { ...defaults_js_1.defaultConfig.capitalFlow };
        mockAPI = new MockExchangeAPI();
        manager = new CapitalFlowManager_js_1.CapitalFlowManager(config, undefined, mockAPI);
    });
    describe('constructor', () => {
        it('should initialize with provided configuration', () => {
            const retrievedConfig = manager.getConfig();
            expect(retrievedConfig.sweepThreshold).toBe(1.2);
            expect(retrievedConfig.reserveLimit).toBe(200);
            expect(retrievedConfig.maxRetries).toBe(3);
        });
        it('should accept custom configuration', () => {
            const customConfig = {
                sweepThreshold: 1.3,
                reserveLimit: 500,
                sweepSchedule: '0 12 * * *',
                maxRetries: 5,
                retryBaseDelay: 2000,
            };
            const customManager = new CapitalFlowManager_js_1.CapitalFlowManager(customConfig, undefined, mockAPI);
            const retrievedConfig = customManager.getConfig();
            expect(retrievedConfig.sweepThreshold).toBe(1.3);
            expect(retrievedConfig.reserveLimit).toBe(500);
            expect(retrievedConfig.maxRetries).toBe(5);
        });
    });
    describe('setTargetAllocation', () => {
        it('should set target allocation', () => {
            manager.setTargetAllocation(1000);
            expect(manager.getTargetAllocation()).toBe(1000);
        });
        it('should handle negative values by setting to 0', () => {
            manager.setTargetAllocation(-500);
            expect(manager.getTargetAllocation()).toBe(0);
        });
    });
    describe('getHighWatermark', () => {
        it('should return 0 initially', () => {
            expect(manager.getHighWatermark()).toBe(0);
        });
    });
    describe('updateHighWatermark', () => {
        it('should update watermark when equity exceeds current', async () => {
            const updated = await manager.updateHighWatermark(1000);
            expect(updated).toBe(true);
            expect(manager.getHighWatermark()).toBe(1000);
        });
        it('should not update watermark when equity is lower', async () => {
            await manager.updateHighWatermark(1000);
            const updated = await manager.updateHighWatermark(800);
            expect(updated).toBe(false);
            expect(manager.getHighWatermark()).toBe(1000);
        });
        it('should not update watermark when equity is equal', async () => {
            await manager.updateHighWatermark(1000);
            const updated = await manager.updateHighWatermark(1000);
            expect(updated).toBe(false);
            expect(manager.getHighWatermark()).toBe(1000);
        });
        it('should update watermark monotonically (Property 10)', async () => {
            const equitySequence = [500, 1000, 800, 1200, 900, 1500];
            const expectedWatermarks = [500, 1000, 1000, 1200, 1200, 1500];
            for (let i = 0; i < equitySequence.length; i++) {
                await manager.updateHighWatermark(equitySequence[i]);
                expect(manager.getHighWatermark()).toBe(expectedWatermarks[i]);
            }
        });
    });
    describe('checkSweepConditions', () => {
        beforeEach(() => {
            manager.setTargetAllocation(1000);
        });
        it('should not sweep when balance is below threshold', async () => {
            mockAPI.setFuturesBalance(1100); // 10% over target, below 20% threshold
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(false);
            expect(decision.amount).toBe(0);
        });
        it('should sweep when balance exceeds 20% threshold (Requirement 4.2)', async () => {
            mockAPI.setFuturesBalance(1500); // 50% over target
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(true);
            expect(decision.amount).toBeGreaterThan(0);
        });
        it('should calculate correct excess amount (Requirement 4.3)', async () => {
            mockAPI.setFuturesBalance(1500);
            manager.setTargetAllocation(1000);
            // Sweep trigger level = 1000 * 1.2 = 1200
            // Excess = 1500 - 1200 = 300
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(true);
            expect(decision.amount).toBe(300);
        });
        it('should respect reserve limit (Requirement 4.5)', async () => {
            mockAPI.setFuturesBalance(350); // Low balance
            manager.setTargetAllocation(200);
            // Sweep trigger level = 200 * 1.2 = 240
            // Excess = 350 - 240 = 110
            // But max sweepable = 350 - 200 (reserve) = 150
            // So sweep amount = min(110, 150) = 110
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(true);
            expect(decision.amount).toBe(110);
        });
        it('should not sweep if it would violate reserve limit', async () => {
            mockAPI.setFuturesBalance(200); // Exactly at reserve limit
            manager.setTargetAllocation(100);
            // Sweep trigger level = 100 * 1.2 = 120
            // Balance 200 > 120, so excess = 80
            // But max sweepable = 200 - 200 = 0
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(false);
        });
        it('should return correct futures balance and target allocation', async () => {
            mockAPI.setFuturesBalance(1500);
            manager.setTargetAllocation(1000);
            const decision = await manager.checkSweepConditions();
            expect(decision.futuresBalance).toBe(1500);
            expect(decision.targetAllocation).toBe(1000);
        });
    });
    describe('executeSweep', () => {
        beforeEach(() => {
            mockAPI.setFuturesBalance(1500);
            manager.setTargetAllocation(1000);
        });
        it('should execute sweep successfully', async () => {
            const result = await manager.executeSweep(300);
            expect(result.success).toBe(true);
            expect(result.amount).toBe(300);
            expect(result.transactionId).toBeDefined();
        });
        it('should reject invalid sweep amount', async () => {
            const result = await manager.executeSweep(0);
            expect(result.success).toBe(false);
            expect(result.error).toContain('Invalid sweep amount');
        });
        it('should reject negative sweep amount', async () => {
            const result = await manager.executeSweep(-100);
            expect(result.success).toBe(false);
            expect(result.error).toContain('Invalid sweep amount');
        });
        it('should reject sweep that violates reserve limit (Property 5)', async () => {
            mockAPI.setFuturesBalance(300);
            // Trying to sweep 200 would leave only 100, below reserve of 200
            const result = await manager.executeSweep(200);
            expect(result.success).toBe(false);
            expect(result.error).toContain('reserve limit');
        });
        it('should update total swept on success (Property 4)', async () => {
            const initialSwept = manager.getTotalSwept();
            await manager.executeSweep(100);
            expect(manager.getTotalSwept()).toBe(initialSwept + 100);
            await manager.executeSweep(50);
            expect(manager.getTotalSwept()).toBe(initialSwept + 150);
        });
        it('should retry on failure (Requirement 4.8)', async () => {
            mockAPI.setTransferShouldFail(true, 2); // Fail first 2 attempts
            const result = await manager.executeSweep(100);
            // Should succeed on 3rd attempt
            expect(result.success).toBe(true);
        });
        it('should fail after max retries', async () => {
            mockAPI.setTransferShouldFail(true, 10); // Fail all attempts
            const result = await manager.executeSweep(100);
            expect(result.success).toBe(false);
            expect(result.error).toContain('failed after');
        });
    });
    describe('getTreasuryStatus', () => {
        it('should return correct treasury status', async () => {
            mockAPI.setFuturesBalance(1500);
            mockAPI.setSpotBalance(500);
            await manager.updateHighWatermark(2000);
            await manager.executeSweep(100);
            const status = await manager.getTreasuryStatus();
            expect(status.futuresWallet).toBe(1400); // 1500 - 100
            expect(status.spotWallet).toBe(600); // 500 + 100
            expect(status.highWatermark).toBe(2000);
            expect(status.totalSwept).toBe(100);
            expect(status.lockedProfit).toBe(100);
            expect(status.riskCapital).toBe(1400);
        });
    });
    describe('getNextSweepTriggerLevel', () => {
        it('should calculate correct trigger level', () => {
            manager.setTargetAllocation(1000);
            // Trigger level = 1000 * 1.2 = 1200
            expect(manager.getNextSweepTriggerLevel()).toBe(1200);
        });
        it('should update when target allocation changes', () => {
            manager.setTargetAllocation(500);
            expect(manager.getNextSweepTriggerLevel()).toBe(600);
            manager.setTargetAllocation(2000);
            expect(manager.getNextSweepTriggerLevel()).toBe(2400);
        });
    });
    describe('shouldTriggerSweepOnEquityIncrease', () => {
        it('should return true for > 10% increase', () => {
            expect(manager.shouldTriggerSweepOnEquityIncrease(1000, 1150)).toBe(true);
            expect(manager.shouldTriggerSweepOnEquityIncrease(1000, 1200)).toBe(true);
        });
        it('should return false for <= 10% increase', () => {
            expect(manager.shouldTriggerSweepOnEquityIncrease(1000, 1100)).toBe(false);
            expect(manager.shouldTriggerSweepOnEquityIncrease(1000, 1050)).toBe(false);
        });
        it('should return false for decrease', () => {
            expect(manager.shouldTriggerSweepOnEquityIncrease(1000, 900)).toBe(false);
        });
        it('should handle zero previous equity', () => {
            expect(manager.shouldTriggerSweepOnEquityIncrease(0, 100)).toBe(false);
        });
        it('should handle negative previous equity', () => {
            expect(manager.shouldTriggerSweepOnEquityIncrease(-100, 100)).toBe(false);
        });
    });
    describe('performSweepIfNeeded', () => {
        it('should perform sweep when conditions are met', async () => {
            mockAPI.setFuturesBalance(1500);
            manager.setTargetAllocation(1000);
            const result = await manager.performSweepIfNeeded();
            expect(result).not.toBeNull();
            expect(result?.success).toBe(true);
        });
        it('should return null when conditions are not met', async () => {
            mockAPI.setFuturesBalance(1100);
            manager.setTargetAllocation(1000);
            const result = await manager.performSweepIfNeeded();
            expect(result).toBeNull();
        });
    });
    describe('getReserveLimit', () => {
        it('should return configured reserve limit', () => {
            expect(manager.getReserveLimit()).toBe(200);
        });
    });
    describe('edge cases', () => {
        it('should handle zero target allocation', async () => {
            manager.setTargetAllocation(0);
            mockAPI.setFuturesBalance(500);
            const decision = await manager.checkSweepConditions();
            // With 0 target, trigger level is 0, so any balance triggers sweep
            // But reserve limit still applies
            expect(decision.shouldSweep).toBe(true);
            expect(decision.amount).toBe(300); // 500 - 200 reserve
        });
        it('should handle very large balances', async () => {
            mockAPI.setFuturesBalance(1000000);
            manager.setTargetAllocation(500000);
            const decision = await manager.checkSweepConditions();
            expect(decision.shouldSweep).toBe(true);
            // Excess = 1000000 - (500000 * 1.2) = 1000000 - 600000 = 400000
            expect(decision.amount).toBe(400000);
        });
        it('should handle balance exactly at reserve limit', async () => {
            mockAPI.setFuturesBalance(200);
            manager.setTargetAllocation(100);
            const decision = await manager.checkSweepConditions();
            // Can't sweep anything without violating reserve
            expect(decision.shouldSweep).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvQ2FwaXRhbEZsb3dNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7QUFFSCxrRkFBK0Y7QUFFL0YsOERBQTZEO0FBRTdEOztHQUVHO0FBQ0gsTUFBTSxlQUFlO0lBQ1gsY0FBYyxHQUFXLENBQUMsQ0FBQztJQUMzQixXQUFXLEdBQVcsQ0FBQyxDQUFDO0lBQ3hCLGtCQUFrQixHQUFZLEtBQUssQ0FBQztJQUNwQyxTQUFTLEdBQVcsQ0FBQyxDQUFDO0lBQ3RCLFdBQVcsR0FBVyxDQUFDLENBQUM7SUFFaEMsaUJBQWlCLENBQUMsT0FBZTtRQUMvQixJQUFJLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FBQztJQUNoQyxDQUFDO0lBRUQsY0FBYyxDQUFDLE9BQWU7UUFDNUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7SUFDN0IsQ0FBQztJQUVELHFCQUFxQixDQUFDLFVBQW1CLEVBQUUsY0FBc0IsUUFBUTtRQUN2RSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsVUFBVSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFRCxLQUFLLENBQUMsaUJBQWlCO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUM3QixDQUFDO0lBRUQsS0FBSyxDQUFDLGNBQWM7UUFDbEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7SUFFRCxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQWM7UUFDakMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakUsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2pCLE9BQU8sRUFBRSxPQUFPLEVBQUUs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SSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlELE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMvQixPQUFPLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUN0RCxpREFBaUQ7WUFDakQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy91bml0L0NhcGl0YWxGbG93TWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCBUZXN0cyBmb3IgQ2FwaXRhbEZsb3dNYW5hZ2VyXG4gKiBcbiAqIFRlc3RzIHN3ZWVwIGNvbmRpdGlvbiBkZXRlY3Rpb24sIHJlc2VydmUgbGltaXQgZW5mb3JjZW1lbnQsXG4gKiBoaWdoIHdhdGVybWFyayB1cGRhdGVzLCBhbmQgc3dlZXAgcmV0cnkgbG9naWMuXG4gKiBSZXF1aXJlbWVudHM6IDQuMSwgNC4yLCA0LjMsIDQuNSwgNC44XG4gKi9cblxuaW1wb3J0IHsgQ2FwaXRhbEZsb3dNYW5hZ2VyLCBFeGNoYW5nZVdhbGxldEFQSSB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvQ2FwaXRhbEZsb3dNYW5hZ2VyLmpzJztcbmltcG9ydCB7IENhcGl0YWxGbG93Q29uZmlnIH0gZnJvbSAnLi4vLi4vc3JjL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGRlZmF1bHRDb25maWcgfSBmcm9tICcuLi8uLi9zcmMvY29uZmlnL2RlZmF1bHRzLmpzJztcblxuLyoqXG4gKiBNb2NrIEV4Y2hhbmdlIEFQSSBmb3IgdGVzdGluZ1xuICovXG5jbGFzcyBNb2NrRXhjaGFuZ2VBUEkgaW1wbGVtZW50cyBFeGNoYW5nZVdhbGxldEFQSSB7XG4gIHByaXZhdGUgZnV0dXJlc0JhbGFuY2U6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgc3BvdEJhbGFuY2U6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgdHJhbnNmZXJTaG91bGRGYWlsOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgZmFpbENvdW50OiBudW1iZXIgPSAwO1xuICBwcml2YXRlIG1heEZhaWx1cmVzOiBudW1iZXIgPSAwO1xuXG4gIHNldEZ1dHVyZXNCYWxhbmNlKGJhbGFuY2U6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuZnV0dXJlc0JhbGFuY2UgPSBiYWxhbmNlO1xuICB9XG5cbiAgc2V0U3BvdEJhbGFuY2UoYmFsYW5jZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5zcG90QmFsYW5jZSA9IGJhbGFuY2U7XG4gIH1cblxuICBzZXRUcmFuc2ZlclNob3VsZEZhaWwoc2hvdWxkRmFpbDogYm9vbGVhbiwgbWF4RmFpbHVyZXM6IG51bWJlciA9IEluZmluaXR5KTogdm9pZCB7XG4gICAgdGhpcy50cmFuc2ZlclNob3VsZEZhaWwgPSBzaG91bGRGYWlsO1xuICAgIHRoaXMubWF4RmFpbHVyZXMgPSBtYXhGYWlsdXJlcztcbiAgICB0aGlzLmZhaWxDb3VudCA9IDA7XG4gIH1cblxuICBhc3luYyBnZXRGdXR1cmVzQmFsYW5jZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLmZ1dHVyZXNCYWxhbmNlO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3BvdEJhbGFuY2UoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5zcG90QmFsYW5jZTtcbiAgfVxuXG4gIGFzeW5jIHRyYW5zZmVyVG9TcG90KGFtb3VudDogbnVtYmVyKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHRyYW5zYWN0aW9uSWQ/OiBzdHJpbmc7IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgICBpZiAodGhpcy50cmFuc2ZlclNob3VsZEZhaWwgJiYgdGhpcy5mYWlsQ291bnQgPCB0aGlzLm1heEZhaWx1cmVzKSB7XG4gICAgICB0aGlzLmZhaWxDb3VudCsrO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVHJhbnNmZXIgZmFpbGVkJyB9O1xuICAgIH1cbiAgICBcbiAgICB0aGlzLmZ1dHVyZXNCYWxhbmNlIC09IGFtb3VudDtcbiAgICB0aGlzLnNwb3RCYWxhbmNlICs9IGFtb3VudDtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0cmFuc2FjdGlvbklkOiBgdHgtJHtEYXRlLm5vdygpfWAgfTtcbiAgfVxufVxuXG5kZXNjcmliZSgnQ2FwaXRhbEZsb3dNYW5hZ2VyJywgKCkgPT4ge1xuICBsZXQgbWFuYWdlcjogQ2FwaXRhbEZsb3dNYW5hZ2VyO1xuICBsZXQgbW9ja0FQSTogTW9ja0V4Y2hhbmdlQVBJO1xuICBsZXQgY29uZmlnOiBDYXBpdGFsRmxvd0NvbmZpZztcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjb25maWcgPSB7IC4uLmRlZmF1bHRDb25maWcuY2FwaXRhbEZsb3cgfTtcbiAgICBtb2NrQVBJID0gbmV3IE1vY2tFeGNoYW5nZUFQSSgpO1xuICAgIG1hbmFnZXIgPSBuZXcgQ2FwaXRhbEZsb3dNYW5hZ2VyKGNvbmZpZywgdW5kZWZpbmVkLCBtb2NrQVBJKTtcbiAgfSk7XG5cblxuICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggcHJvdmlkZWQgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHJldHJpZXZlZENvbmZpZyA9IG1hbmFnZXIuZ2V0Q29uZmlnKCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkQ29uZmlnLnN3ZWVwVGhyZXNob2xkKS50b0JlKDEuMik7XG4gICAgICBleHBlY3QocmV0cmlldmVkQ29uZmlnLnJlc2VydmVMaW1pdCkudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZENvbmZpZy5tYXhSZXRyaWVzKS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgY3VzdG9tIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21Db25maWc6IENhcGl0YWxGbG93Q29uZmlnID0ge1xuICAgICAgICBzd2VlcFRocmVzaG9sZDogMS4zLFxuICAgICAgICByZXNlcnZlTGltaXQ6IDUwMCxcbiAgICAgICAgc3dlZXBTY2hlZHVsZTogJzAgMTIgKiAqIConLFxuICAgICAgICBtYXhSZXRyaWVzOiA1LFxuICAgICAgICByZXRyeUJhc2VEZWxheTogMjAwMCxcbiAgICAgIH07XG4gICAgICBjb25zdCBjdXN0b21NYW5hZ2VyID0gbmV3IENhcGl0YWxGbG93TWFuYWdlcihjdXN0b21Db25maWcsIHVuZGVmaW5lZCwgbW9ja0FQSSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJldHJpZXZlZENvbmZpZyA9IGN1c3RvbU1hbmFnZXIuZ2V0Q29uZmlnKCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkQ29uZmlnLnN3ZWVwVGhyZXNob2xkKS50b0JlKDEuMyk7XG4gICAgICBleHBlY3QocmV0cmlldmVkQ29uZmlnLnJlc2VydmVMaW1pdCkudG9CZSg1MDApO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZENvbmZpZy5tYXhSZXRyaWVzKS50b0JlKDUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0VGFyZ2V0QWxsb2NhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCB0YXJnZXQgYWxsb2NhdGlvbicsICgpID0+IHtcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigxMDAwKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLmdldFRhcmdldEFsbG9jYXRpb24oKSkudG9CZSgxMDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lZ2F0aXZlIHZhbHVlcyBieSBzZXR0aW5nIHRvIDAnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLnNldFRhcmdldEFsbG9jYXRpb24oLTUwMCk7XG4gICAgICBleHBlY3QobWFuYWdlci5nZXRUYXJnZXRBbGxvY2F0aW9uKCkpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRIaWdoV2F0ZXJtYXJrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIDAgaW5pdGlhbGx5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlSGlnaFdhdGVybWFyaycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB3YXRlcm1hcmsgd2hlbiBlcXVpdHkgZXhjZWVkcyBjdXJyZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IG1hbmFnZXIudXBkYXRlSGlnaFdhdGVybWFyaygxMDAwKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKS50b0JlKDEwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdXBkYXRlIHdhdGVybWFyayB3aGVuIGVxdWl0eSBpcyBsb3dlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IG1hbmFnZXIudXBkYXRlSGlnaFdhdGVybWFyaygxMDAwKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBtYW5hZ2VyLnVwZGF0ZUhpZ2hXYXRlcm1hcmsoODAwKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLmdldEhpZ2hXYXRlcm1hcmsoKSkudG9CZSgxMDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHVwZGF0ZSB3YXRlcm1hcmsgd2hlbiBlcXVpdHkgaXMgZXF1YWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLnVwZGF0ZUhpZ2hXYXRlcm1hcmsoMTAwMCk7XG4gICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbWFuYWdlci51cGRhdGVIaWdoV2F0ZXJtYXJrKDEwMDApO1xuICAgICAgZXhwZWN0KHVwZGF0ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKS50b0JlKDEwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgd2F0ZXJtYXJrIG1vbm90b25pY2FsbHkgKFByb3BlcnR5IDEwKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVxdWl0eVNlcXVlbmNlID0gWzUwMCwgMTAwMCwgODAwLCAxMjAwLCA5MDAsIDE1MDBdO1xuICAgICAgY29uc3QgZXhwZWN0ZWRXYXRlcm1hcmtzID0gWzUwMCwgMTAwMCwgMTAwMCwgMTIwMCwgMTIwMCwgMTUwMF07XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXF1aXR5U2VxdWVuY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXdhaXQgbWFuYWdlci51cGRhdGVIaWdoV2F0ZXJtYXJrKGVxdWl0eVNlcXVlbmNlW2ldKTtcbiAgICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKS50b0JlKGV4cGVjdGVkV2F0ZXJtYXJrc1tpXSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgZGVzY3JpYmUoJ2NoZWNrU3dlZXBDb25kaXRpb25zJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgbWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKDEwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3Qgc3dlZXAgd2hlbiBiYWxhbmNlIGlzIGJlbG93IHRocmVzaG9sZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoMTEwMCk7IC8vIDEwJSBvdmVyIHRhcmdldCwgYmVsb3cgMjAlIHRocmVzaG9sZFxuICAgICAgXG4gICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IG1hbmFnZXIuY2hlY2tTd2VlcENvbmRpdGlvbnMoKTtcbiAgICAgIGV4cGVjdChkZWNpc2lvbi5zaG91bGRTd2VlcCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uYW1vdW50KS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzd2VlcCB3aGVuIGJhbGFuY2UgZXhjZWVkcyAyMCUgdGhyZXNob2xkIChSZXF1aXJlbWVudCA0LjIpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FQSS5zZXRGdXR1cmVzQmFsYW5jZSgxNTAwKTsgLy8gNTAlIG92ZXIgdGFyZ2V0XG4gICAgICBcbiAgICAgIGNvbnN0IGRlY2lzaW9uID0gYXdhaXQgbWFuYWdlci5jaGVja1N3ZWVwQ29uZGl0aW9ucygpO1xuICAgICAgZXhwZWN0KGRlY2lzaW9uLnNob3VsZFN3ZWVwKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGRlY2lzaW9uLmFtb3VudCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29ycmVjdCBleGNlc3MgYW1vdW50IChSZXF1aXJlbWVudCA0LjMpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FQSS5zZXRGdXR1cmVzQmFsYW5jZSgxNTAwKTtcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigxMDAwKTtcbiAgICAgIFxuICAgICAgLy8gU3dlZXAgdHJpZ2dlciBsZXZlbCA9IDEwMDAgKiAxLjIgPSAxMjAwXG4gICAgICAvLyBFeGNlc3MgPSAxNTAwIC0gMTIwMCA9IDMwMFxuICAgICAgY29uc3QgZGVjaXNpb24gPSBhd2FpdCBtYW5hZ2VyLmNoZWNrU3dlZXBDb25kaXRpb25zKCk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uc2hvdWxkU3dlZXApLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uYW1vdW50KS50b0JlKDMwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgcmVzZXJ2ZSBsaW1pdCAoUmVxdWlyZW1lbnQgNC41KScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoMzUwKTsgLy8gTG93IGJhbGFuY2VcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigyMDApO1xuICAgICAgXG4gICAgICAvLyBTd2VlcCB0cmlnZ2VyIGxldmVsID0gMjAwICogMS4yID0gMjQwXG4gICAgICAvLyBFeGNlc3MgPSAzNTAgLSAyNDAgPSAxMTBcbiAgICAgIC8vIEJ1dCBtYXggc3dlZXBhYmxlID0gMzUwIC0gMjAwIChyZXNlcnZlKSA9IDE1MFxuICAgICAgLy8gU28gc3dlZXAgYW1vdW50ID0gbWluKDExMCwgMTUwKSA9IDExMFxuICAgICAgY29uc3QgZGVjaXNpb24gPSBhd2FpdCBtYW5hZ2VyLmNoZWNrU3dlZXBDb25kaXRpb25zKCk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uc2hvdWxkU3dlZXApLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uYW1vdW50KS50b0JlKDExMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBzd2VlcCBpZiBpdCB3b3VsZCB2aW9sYXRlIHJlc2VydmUgbGltaXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQVBJLnNldEZ1dHVyZXNCYWxhbmNlKDIwMCk7IC8vIEV4YWN0bHkgYXQgcmVzZXJ2ZSBsaW1pdFxuICAgICAgbWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKDEwMCk7XG4gICAgICBcbiAgICAgIC8vIFN3ZWVwIHRyaWdnZXIgbGV2ZWwgPSAxMDAgKiAxLjIgPSAxMjBcbiAgICAgIC8vIEJhbGFuY2UgMjAwID4gMTIwLCBzbyBleGNlc3MgPSA4MFxuICAgICAgLy8gQnV0IG1heCBzd2VlcGFibGUgPSAyMDAgLSAyMDAgPSAwXG4gICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IG1hbmFnZXIuY2hlY2tTd2VlcENvbmRpdGlvbnMoKTtcbiAgICAgIGV4cGVjdChkZWNpc2lvbi5zaG91bGRTd2VlcCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IGZ1dHVyZXMgYmFsYW5jZSBhbmQgdGFyZ2V0IGFsbG9jYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQVBJLnNldEZ1dHVyZXNCYWxhbmNlKDE1MDApO1xuICAgICAgbWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKDEwMDApO1xuICAgICAgXG4gICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IG1hbmFnZXIuY2hlY2tTd2VlcENvbmRpdGlvbnMoKTtcbiAgICAgIGV4cGVjdChkZWNpc2lvbi5mdXR1cmVzQmFsYW5jZSkudG9CZSgxNTAwKTtcbiAgICAgIGV4cGVjdChkZWNpc2lvbi50YXJnZXRBbGxvY2F0aW9uKS50b0JlKDEwMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXhlY3V0ZVN3ZWVwJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgbW9ja0FQSS5zZXRGdXR1cmVzQmFsYW5jZSgxNTAwKTtcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigxMDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBzd2VlcCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtYW5hZ2VyLmV4ZWN1dGVTd2VlcCgzMDApO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmFtb3VudCkudG9CZSgzMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC50cmFuc2FjdGlvbklkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBzd2VlcCBhbW91bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtYW5hZ2VyLmV4ZWN1dGVTd2VlcCgwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignSW52YWxpZCBzd2VlcCBhbW91bnQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5lZ2F0aXZlIHN3ZWVwIGFtb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1hbmFnZXIuZXhlY3V0ZVN3ZWVwKC0xMDApO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdJbnZhbGlkIHN3ZWVwIGFtb3VudCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3Qgc3dlZXAgdGhhdCB2aW9sYXRlcyByZXNlcnZlIGxpbWl0IChQcm9wZXJ0eSA1KScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoMzAwKTtcbiAgICAgIFxuICAgICAgLy8gVHJ5aW5nIHRvIHN3ZWVwIDIwMCB3b3VsZCBsZWF2ZSBvbmx5IDEwMCwgYmVsb3cgcmVzZXJ2ZSBvZiAyMDBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1hbmFnZXIuZXhlY3V0ZVN3ZWVwKDIwMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ3Jlc2VydmUgbGltaXQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHRvdGFsIHN3ZXB0IG9uIHN1Y2Nlc3MgKFByb3BlcnR5IDQpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbFN3ZXB0ID0gbWFuYWdlci5nZXRUb3RhbFN3ZXB0KCk7XG4gICAgICBcbiAgICAgIGF3YWl0IG1hbmFnZXIuZXhlY3V0ZVN3ZWVwKDEwMCk7XG4gICAgICBleHBlY3QobWFuYWdlci5nZXRUb3RhbFN3ZXB0KCkpLnRvQmUoaW5pdGlhbFN3ZXB0ICsgMTAwKTtcbiAgICAgIFxuICAgICAgYXdhaXQgbWFuYWdlci5leGVjdXRlU3dlZXAoNTApO1xuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0VG90YWxTd2VwdCgpKS50b0JlKGluaXRpYWxTd2VwdCArIDE1MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHJ5IG9uIGZhaWx1cmUgKFJlcXVpcmVtZW50IDQuOCknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQVBJLnNldFRyYW5zZmVyU2hvdWxkRmFpbCh0cnVlLCAyKTsgLy8gRmFpbCBmaXJzdCAyIGF0dGVtcHRzXG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1hbmFnZXIuZXhlY3V0ZVN3ZWVwKDEwMCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBzdWNjZWVkIG9uIDNyZCBhdHRlbXB0XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgYWZ0ZXIgbWF4IHJldHJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQVBJLnNldFRyYW5zZmVyU2hvdWxkRmFpbCh0cnVlLCAxMCk7IC8vIEZhaWwgYWxsIGF0dGVtcHRzXG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1hbmFnZXIuZXhlY3V0ZVN3ZWVwKDEwMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ2ZhaWxlZCBhZnRlcicpO1xuICAgIH0pO1xuICB9KTtcblxuXG4gIGRlc2NyaWJlKCdnZXRUcmVhc3VyeVN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IHRyZWFzdXJ5IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoMTUwMCk7XG4gICAgICBtb2NrQVBJLnNldFNwb3RCYWxhbmNlKDUwMCk7XG4gICAgICBhd2FpdCBtYW5hZ2VyLnVwZGF0ZUhpZ2hXYXRlcm1hcmsoMjAwMCk7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmV4ZWN1dGVTd2VlcCgxMDApO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCBtYW5hZ2VyLmdldFRyZWFzdXJ5U3RhdHVzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0dXMuZnV0dXJlc1dhbGxldCkudG9CZSgxNDAwKTsgLy8gMTUwMCAtIDEwMFxuICAgICAgZXhwZWN0KHN0YXR1cy5zcG90V2FsbGV0KS50b0JlKDYwMCk7IC8vIDUwMCArIDEwMFxuICAgICAgZXhwZWN0KHN0YXR1cy5oaWdoV2F0ZXJtYXJrKS50b0JlKDIwMDApO1xuICAgICAgZXhwZWN0KHN0YXR1cy50b3RhbFN3ZXB0KS50b0JlKDEwMCk7XG4gICAgICBleHBlY3Qoc3RhdHVzLmxvY2tlZFByb2ZpdCkudG9CZSgxMDApO1xuICAgICAgZXhwZWN0KHN0YXR1cy5yaXNrQ2FwaXRhbCkudG9CZSgxNDAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE5leHRTd2VlcFRyaWdnZXJMZXZlbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb3JyZWN0IHRyaWdnZXIgbGV2ZWwnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLnNldFRhcmdldEFsbG9jYXRpb24oMTAwMCk7XG4gICAgICBcbiAgICAgIC8vIFRyaWdnZXIgbGV2ZWwgPSAxMDAwICogMS4yID0gMTIwMFxuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0TmV4dFN3ZWVwVHJpZ2dlckxldmVsKCkpLnRvQmUoMTIwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB3aGVuIHRhcmdldCBhbGxvY2F0aW9uIGNoYW5nZXMnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLnNldFRhcmdldEFsbG9jYXRpb24oNTAwKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLmdldE5leHRTd2VlcFRyaWdnZXJMZXZlbCgpKS50b0JlKDYwMCk7XG4gICAgICBcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigyMDAwKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLmdldE5leHRTd2VlcFRyaWdnZXJMZXZlbCgpKS50b0JlKDI0MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2hvdWxkVHJpZ2dlclN3ZWVwT25FcXVpdHlJbmNyZWFzZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGZvciA+IDEwJSBpbmNyZWFzZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLnNob3VsZFRyaWdnZXJTd2VlcE9uRXF1aXR5SW5jcmVhc2UoMTAwMCwgMTE1MCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobWFuYWdlci5zaG91bGRUcmlnZ2VyU3dlZXBPbkVxdWl0eUluY3JlYXNlKDEwMDAsIDEyMDApKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIDw9IDEwJSBpbmNyZWFzZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChtYW5hZ2VyLnNob3VsZFRyaWdnZXJTd2VlcE9uRXF1aXR5SW5jcmVhc2UoMTAwMCwgMTEwMCkpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KG1hbmFnZXIuc2hvdWxkVHJpZ2dlclN3ZWVwT25FcXVpdHlJbmNyZWFzZSgxMDAwLCAxMDUwKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3IgZGVjcmVhc2UnLCAoKSA9PiB7XG4gICAgICBleHBlY3QobWFuYWdlci5zaG91bGRUcmlnZ2VyU3dlZXBPbkVxdWl0eUluY3JlYXNlKDEwMDAsIDkwMCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgemVybyBwcmV2aW91cyBlcXVpdHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QobWFuYWdlci5zaG91bGRUcmlnZ2VyU3dlZXBPbkVxdWl0eUluY3JlYXNlKDAsIDEwMCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmVnYXRpdmUgcHJldmlvdXMgZXF1aXR5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KG1hbmFnZXIuc2hvdWxkVHJpZ2dlclN3ZWVwT25FcXVpdHlJbmNyZWFzZSgtMTAwLCAxMDApKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BlcmZvcm1Td2VlcElmTmVlZGVkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcGVyZm9ybSBzd2VlcCB3aGVuIGNvbmRpdGlvbnMgYXJlIG1ldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoMTUwMCk7XG4gICAgICBtYW5hZ2VyLnNldFRhcmdldEFsbG9jYXRpb24oMTAwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1hbmFnZXIucGVyZm9ybVN3ZWVwSWZOZWVkZWQoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkubm90LnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocmVzdWx0Py5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIGNvbmRpdGlvbnMgYXJlIG5vdCBtZXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQVBJLnNldEZ1dHVyZXNCYWxhbmNlKDExMDApO1xuICAgICAgbWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKDEwMDApO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtYW5hZ2VyLnBlcmZvcm1Td2VlcElmTmVlZGVkKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRSZXNlcnZlTGltaXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29uZmlndXJlZCByZXNlcnZlIGxpbWl0JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KG1hbmFnZXIuZ2V0UmVzZXJ2ZUxpbWl0KCkpLnRvQmUoMjAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VkZ2UgY2FzZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgemVybyB0YXJnZXQgYWxsb2NhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbigwKTtcbiAgICAgIG1vY2tBUEkuc2V0RnV0dXJlc0JhbGFuY2UoNTAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgZGVjaXNpb24gPSBhd2FpdCBtYW5hZ2VyLmNoZWNrU3dlZXBDb25kaXRpb25zKCk7XG4gICAgICAvLyBXaXRoIDAgdGFyZ2V0LCB0cmlnZ2VyIGxldmVsIGlzIDAsIHNvIGFueSBiYWxhbmNlIHRyaWdnZXJzIHN3ZWVwXG4gICAgICAvLyBCdXQgcmVzZXJ2ZSBsaW1pdCBzdGlsbCBhcHBsaWVzXG4gICAgICBleHBlY3QoZGVjaXNpb24uc2hvdWxkU3dlZXApLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZGVjaXNpb24uYW1vdW50KS50b0JlKDMwMCk7IC8vIDUwMCAtIDIwMCByZXNlcnZlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIGJhbGFuY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FQSS5zZXRGdXR1cmVzQmFsYW5jZSgxMDAwMDAwKTtcbiAgICAgIG1hbmFnZXIuc2V0VGFyZ2V0QWxsb2NhdGlvbig1MDAwMDApO1xuICAgICAgXG4gICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IG1hbmFnZXIuY2hlY2tTd2VlcENvbmRpdGlvbnMoKTtcbiAgICAgIGV4cGVjdChkZWNpc2lvbi5zaG91bGRTd2VlcCkudG9CZSh0cnVlKTtcbiAgICAgIC8vIEV4Y2VzcyA9IDEwMDAwMDAgLSAoNTAwMDAwICogMS4yKSA9IDEwMDAwMDAgLSA2MDAwMDAgPSA0MDAwMDBcbiAgICAgIGV4cGVjdChkZWNpc2lvbi5hbW91bnQpLnRvQmUoNDAwMDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGJhbGFuY2UgZXhhY3RseSBhdCByZXNlcnZlIGxpbWl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FQSS5zZXRGdXR1cmVzQmFsYW5jZSgyMDApO1xuICAgICAgbWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKDEwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRlY2lzaW9uID0gYXdhaXQgbWFuYWdlci5jaGVja1N3ZWVwQ29uZGl0aW9ucygpO1xuICAgICAgLy8gQ2FuJ3Qgc3dlZXAgYW55dGhpbmcgd2l0aG91dCB2aW9sYXRpbmcgcmVzZXJ2ZVxuICAgICAgZXhwZWN0KGRlY2lzaW9uLnNob3VsZFN3ZWVwKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==