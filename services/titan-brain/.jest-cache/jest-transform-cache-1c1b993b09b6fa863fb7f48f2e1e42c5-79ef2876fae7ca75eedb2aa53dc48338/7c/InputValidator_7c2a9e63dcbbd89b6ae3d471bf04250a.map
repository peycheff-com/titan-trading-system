{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/security/InputValidator.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/security/InputValidator.ts"],"sourcesContent":["/**\n * InputValidator - Comprehensive input validation and sanitization\n * \n * Implements input validation, sanitization, and security checks\n * to prevent injection attacks and ensure data integrity.\n * \n * Requirements: 6.1, 6.2 - Input validation and sanitization\n */\n\nimport { PhaseId } from '../types/index.js';\n\n/**\n * Validation result\n */\nexport interface ValidationResult {\n  isValid: boolean;\n  errors: string[];\n  sanitizedValue?: unknown;\n}\n\n/**\n * Validation options\n */\nexport interface ValidationOptions {\n  required?: boolean;\n  minLength?: number;\n  maxLength?: number;\n  min?: number;\n  max?: number;\n  pattern?: RegExp;\n  allowedValues?: unknown[];\n  sanitize?: boolean;\n}\n\n/**\n * Input validation and sanitization utilities\n */\nexport class InputValidator {\n  \n  /**\n   * Validate and sanitize a string input\n   */\n  static validateString(\n    value: unknown,\n    fieldName: string,\n    options: ValidationOptions = {}\n  ): ValidationResult {\n    const errors: string[] = [];\n    \n    // Check if required\n    if (options.required && (value === null || value === undefined || value === '')) {\n      errors.push(`${fieldName} is required`);\n      return { isValid: false, errors };\n    }\n    \n    // Allow empty values if not required\n    if (!options.required && (value === null || value === undefined || value === '')) {\n      return { isValid: true, errors: [], sanitizedValue: value };\n    }\n    \n    // Type check\n    if (typeof value !== 'string') {\n      errors.push(`${fieldName} must be a string`);\n      return { isValid: false, errors };\n    }\n    \n    let sanitizedValue = value;\n    \n    // Sanitize if requested\n    if (options.sanitize) {\n      sanitizedValue = this.sanitizeString(value);\n    }\n    \n    // Length validation\n    if (options.minLength !== undefined && sanitizedValue.length < options.minLength) {\n      errors.push(`${fieldName} must be at least ${options.minLength} characters long`);\n    }\n    \n    if (options.maxLength !== undefined && sanitizedValue.length > options.maxLength) {\n      errors.push(`${fieldName} must be at most ${options.maxLength} characters long`);\n    }\n    \n    // Pattern validation\n    if (options.pattern && !options.pattern.test(sanitizedValue)) {\n      errors.push(`${fieldName} format is invalid`);\n    }\n    \n    // Allowed values validation\n    if (options.allowedValues && !options.allowedValues.includes(sanitizedValue)) {\n      errors.push(`${fieldName} must be one of: ${options.allowedValues.join(', ')}`);\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue\n    };\n  }\n  \n  /**\n   * Validate and sanitize a number input\n   */\n  static validateNumber(\n    value: unknown,\n    fieldName: string,\n    options: ValidationOptions = {}\n  ): ValidationResult {\n    const errors: string[] = [];\n    \n    // Check if required\n    if (options.required && (value === null || value === undefined)) {\n      errors.push(`${fieldName} is required`);\n      return { isValid: false, errors };\n    }\n    \n    // Allow empty values if not required\n    if (!options.required && (value === null || value === undefined)) {\n      return { isValid: true, errors: [], sanitizedValue: value };\n    }\n    \n    // Type check and conversion\n    let numValue: number;\n    if (typeof value === 'string') {\n      numValue = parseFloat(value);\n      if (isNaN(numValue)) {\n        errors.push(`${fieldName} must be a valid number`);\n        return { isValid: false, errors };\n      }\n    } else if (typeof value === 'number') {\n      numValue = value;\n    } else {\n      errors.push(`${fieldName} must be a number`);\n      return { isValid: false, errors };\n    }\n    \n    // Check for infinity and NaN\n    if (!isFinite(numValue)) {\n      errors.push(`${fieldName} must be a finite number`);\n      return { isValid: false, errors };\n    }\n    \n    // Range validation\n    if (options.min !== undefined && numValue < options.min) {\n      errors.push(`${fieldName} must be at least ${options.min}`);\n    }\n    \n    if (options.max !== undefined && numValue > options.max) {\n      errors.push(`${fieldName} must be at most ${options.max}`);\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue: numValue\n    };\n  }\n  \n  /**\n   * Validate boolean input\n   */\n  static validateBoolean(\n    value: unknown,\n    fieldName: string,\n    options: ValidationOptions = {}\n  ): ValidationResult {\n    const errors: string[] = [];\n    \n    // Check if required\n    if (options.required && (value === null || value === undefined)) {\n      errors.push(`${fieldName} is required`);\n      return { isValid: false, errors };\n    }\n    \n    // Allow empty values if not required\n    if (!options.required && (value === null || value === undefined)) {\n      return { isValid: true, errors: [], sanitizedValue: value };\n    }\n    \n    // Type check and conversion\n    let boolValue: boolean;\n    if (typeof value === 'boolean') {\n      boolValue = value;\n    } else if (typeof value === 'string') {\n      const lowerValue = value.toLowerCase();\n      if (lowerValue === 'true' || lowerValue === '1') {\n        boolValue = true;\n      } else if (lowerValue === 'false' || lowerValue === '0') {\n        boolValue = false;\n      } else {\n        errors.push(`${fieldName} must be a boolean value (true/false)`);\n        return { isValid: false, errors };\n      }\n    } else if (typeof value === 'number') {\n      boolValue = value !== 0;\n    } else {\n      errors.push(`${fieldName} must be a boolean value`);\n      return { isValid: false, errors };\n    }\n    \n    return {\n      isValid: true,\n      errors: [],\n      sanitizedValue: boolValue\n    };\n  }\n  \n  /**\n   * Validate array input\n   */\n  static validateArray(\n    value: unknown,\n    fieldName: string,\n    options: ValidationOptions = {}\n  ): ValidationResult {\n    const errors: string[] = [];\n    \n    // Check if required\n    if (options.required && (value === null || value === undefined)) {\n      errors.push(`${fieldName} is required`);\n      return { isValid: false, errors };\n    }\n    \n    // Allow empty values if not required\n    if (!options.required && (value === null || value === undefined)) {\n      return { isValid: true, errors: [], sanitizedValue: value };\n    }\n    \n    // Type check\n    if (!Array.isArray(value)) {\n      errors.push(`${fieldName} must be an array`);\n      return { isValid: false, errors };\n    }\n    \n    // Length validation\n    if (options.minLength !== undefined && value.length < options.minLength) {\n      errors.push(`${fieldName} must have at least ${options.minLength} items`);\n    }\n    \n    if (options.maxLength !== undefined && value.length > options.maxLength) {\n      errors.push(`${fieldName} must have at most ${options.maxLength} items`);\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue: value\n    };\n  }\n  \n  /**\n   * Sanitize string input to prevent XSS and injection attacks\n   */\n  private static sanitizeString(input: string): string {\n    return input\n      // Remove null bytes\n      .replace(/\\0/g, '')\n      // Remove control characters except newline, carriage return, and tab\n      .replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '')\n      // Trim whitespace\n      .trim();\n  }\n  \n  /**\n   * Validate signal ID format\n   */\n  static validateSignalId(signalId: unknown): ValidationResult {\n    return this.validateString(signalId, 'signalId', {\n      required: true,\n      minLength: 1,\n      maxLength: 100,\n      pattern: /^[a-zA-Z0-9_-]+$/,\n      sanitize: true\n    });\n  }\n  \n  /**\n   * Validate phase ID\n   */\n  static validatePhaseId(phaseId: unknown): ValidationResult {\n    return this.validateString(phaseId, 'phaseId', {\n      required: true,\n      allowedValues: ['phase1', 'phase2', 'phase3'],\n      sanitize: true\n    });\n  }\n  \n  /**\n   * Validate trading symbol\n   */\n  static validateSymbol(symbol: unknown): ValidationResult {\n    return this.validateString(symbol, 'symbol', {\n      required: true,\n      minLength: 3,\n      maxLength: 20,\n      pattern: /^[A-Z0-9]+$/,\n      sanitize: true\n    });\n  }\n  \n  /**\n   * Validate trade side\n   */\n  static validateSide(side: unknown): ValidationResult {\n    return this.validateString(side, 'side', {\n      required: true,\n      allowedValues: ['BUY', 'SELL'],\n      sanitize: true\n    });\n  }\n  \n  /**\n   * Validate position size\n   */\n  static validatePositionSize(size: unknown): ValidationResult {\n    return this.validateNumber(size, 'requestedSize', {\n      required: true,\n      min: 0.000001,\n      max: 1000000\n    });\n  }\n  \n  /**\n   * Validate leverage\n   */\n  static validateLeverage(leverage: unknown): ValidationResult {\n    return this.validateNumber(leverage, 'leverage', {\n      required: false,\n      min: 1,\n      max: 100\n    });\n  }\n  \n  /**\n   * Validate operator ID\n   */\n  static validateOperatorId(operatorId: unknown): ValidationResult {\n    return this.validateString(operatorId, 'operatorId', {\n      required: true,\n      minLength: 3,\n      maxLength: 50,\n      pattern: /^[a-zA-Z0-9_-]+$/,\n      sanitize: true\n    });\n  }\n  \n  /**\n   * Validate password (basic validation - should be enhanced based on policy)\n   */\n  static validatePassword(password: unknown): ValidationResult {\n    return this.validateString(password, 'password', {\n      required: true,\n      minLength: 8,\n      maxLength: 128\n    });\n  }\n  \n  /**\n   * Validate allocation weights\n   */\n  static validateAllocationWeights(allocation: unknown): ValidationResult {\n    const errors: string[] = [];\n    \n    if (!allocation || typeof allocation !== 'object') {\n      errors.push('allocation must be an object');\n      return { isValid: false, errors };\n    }\n    \n    const alloc = allocation as Record<string, unknown>;\n    \n    // Validate individual weights\n    const w1Result = this.validateNumber(alloc.w1, 'w1', { required: true, min: 0, max: 1 });\n    const w2Result = this.validateNumber(alloc.w2, 'w2', { required: true, min: 0, max: 1 });\n    const w3Result = this.validateNumber(alloc.w3, 'w3', { required: true, min: 0, max: 1 });\n    \n    errors.push(...w1Result.errors, ...w2Result.errors, ...w3Result.errors);\n    \n    if (errors.length > 0) {\n      return { isValid: false, errors };\n    }\n    \n    // Validate sum equals 1.0\n    const sum = (w1Result.sanitizedValue as number) + \n                (w2Result.sanitizedValue as number) + \n                (w3Result.sanitizedValue as number);\n    \n    if (Math.abs(sum - 1.0) > 0.001) {\n      errors.push(`allocation weights must sum to 1.0, got ${sum.toFixed(3)}`);\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue: {\n        w1: w1Result.sanitizedValue,\n        w2: w2Result.sanitizedValue,\n        w3: w3Result.sanitizedValue\n      }\n    };\n  }\n  \n  /**\n   * Validate permissions array\n   */\n  static validatePermissions(permissions: unknown): ValidationResult {\n    const arrayResult = this.validateArray(permissions, 'permissions', {\n      required: true,\n      minLength: 1,\n      maxLength: 20\n    });\n    \n    if (!arrayResult.isValid) {\n      return arrayResult;\n    }\n    \n    const errors: string[] = [];\n    const validPermissions = [\n      'override:create',\n      'override:deactivate',\n      'breaker:reset',\n      'operator:create',\n      'config:update'\n    ];\n    \n    const perms = arrayResult.sanitizedValue as string[];\n    for (const perm of perms) {\n      const permResult = this.validateString(perm, 'permission', {\n        required: true,\n        allowedValues: validPermissions,\n        sanitize: true\n      });\n      \n      if (!permResult.isValid) {\n        errors.push(...permResult.errors);\n      }\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue: perms\n    };\n  }\n  \n  /**\n   * Validate and sanitize a complete signal request\n   */\n  static validateSignalRequest(body: unknown): ValidationResult {\n    const errors: string[] = [];\n    const sanitizedBody: Record<string, unknown> = {};\n    \n    if (!body || typeof body !== 'object') {\n      errors.push('Request body must be an object');\n      return { isValid: false, errors };\n    }\n    \n    const req = body as Record<string, unknown>;\n    \n    // Validate each field\n    const validations = [\n      { field: 'signalId', validator: () => this.validateSignalId(req.signalId) },\n      { field: 'phaseId', validator: () => this.validatePhaseId(req.phaseId) },\n      { field: 'symbol', validator: () => this.validateSymbol(req.symbol) },\n      { field: 'side', validator: () => this.validateSide(req.side) },\n      { field: 'requestedSize', validator: () => this.validatePositionSize(req.requestedSize) },\n      { field: 'leverage', validator: () => this.validateLeverage(req.leverage) },\n      { field: 'timestamp', validator: () => this.validateNumber(req.timestamp, 'timestamp', { required: false, min: 0 }) }\n    ];\n    \n    for (const { field, validator } of validations) {\n      const result = validator();\n      if (!result.isValid) {\n        errors.push(...result.errors);\n      } else if (result.sanitizedValue !== undefined) {\n        sanitizedBody[field] = result.sanitizedValue;\n      }\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors,\n      sanitizedValue: sanitizedBody\n    };\n  }\n  \n  /**\n   * Rate limiting validation (check if request rate is within limits)\n   */\n  static validateRateLimit(\n    clientId: string,\n    requestsPerMinute: number = 60,\n    windowMs: number = 60000\n  ): ValidationResult {\n    // This is a simplified rate limiting check\n    // In production, you would use Redis or similar for distributed rate limiting\n    \n    const now = Date.now();\n    const windowStart = now - windowMs;\n    \n    // This would typically be stored in Redis with expiration\n    // For now, we'll just return success (implement proper rate limiting in production)\n    \n    return {\n      isValid: true,\n      errors: [],\n      sanitizedValue: { clientId, timestamp: now }\n    };\n  }\n}\n\n/**\n * Security audit logger for validation failures\n */\nexport class SecurityAuditLogger {\n  \n  /**\n   * Log security validation failure\n   */\n  static logValidationFailure(\n    clientIp: string,\n    endpoint: string,\n    errors: string[],\n    requestBody?: unknown\n  ): void {\n    const auditEvent = {\n      timestamp: new Date().toISOString(),\n      event: 'VALIDATION_FAILURE',\n      clientIp,\n      endpoint,\n      errors,\n      // Don't log sensitive data in audit logs\n      hasRequestBody: !!requestBody,\n      severity: 'WARNING'\n    };\n    \n    console.warn('SECURITY_AUDIT:', JSON.stringify(auditEvent));\n  }\n  \n  /**\n   * Log potential security threat\n   */\n  static logSecurityThreat(\n    clientIp: string,\n    endpoint: string,\n    threatType: string,\n    details: string\n  ): void {\n    const auditEvent = {\n      timestamp: new Date().toISOString(),\n      event: 'SECURITY_THREAT',\n      clientIp,\n      endpoint,\n      threatType,\n      details,\n      severity: 'CRITICAL'\n    };\n    \n    console.error('SECURITY_THREAT:', JSON.stringify(auditEvent));\n  }\n  \n  /**\n   * Log authentication failure\n   */\n  static logAuthenticationFailure(\n    clientIp: string,\n    operatorId: string,\n    reason: string\n  ): void {\n    const auditEvent = {\n      timestamp: new Date().toISOString(),\n      event: 'AUTH_FAILURE',\n      clientIp,\n      operatorId,\n      reason,\n      severity: 'WARNING'\n    };\n    \n    console.warn('AUTH_AUDIT:', JSON.stringify(auditEvent));\n  }\n}"],"version":3}