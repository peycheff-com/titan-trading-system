{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/startup/StartupManager.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/startup/StartupManager.test.ts"],"sourcesContent":["/**\n * StartupManager Tests\n * \n * Comprehensive unit tests for the StartupManager class covering\n * initialization, step execution, error handling, and graceful shutdown.\n */\n\nimport { StartupManager, StartupStep, StartupStatus } from '../../src/startup/StartupManager.js';\nimport { Logger } from '../../src/logging/Logger.js';\n\n// Mock Logger\njest.mock('../../src/logging/Logger.js');\n\ndescribe('StartupManager', () => {\n  let startupManager: StartupManager;\n  let mockLogger: jest.Mocked<Logger>;\n\n  beforeEach(() => {\n    // Create mock logger\n    mockLogger = {\n      info: jest.fn(),\n      warn: jest.fn(),\n      error: jest.fn(),\n      debug: jest.fn(),\n      logSecurityEvent: jest.fn()\n    } as any;\n\n    (Logger.getInstance as jest.Mock).mockReturnValue(mockLogger);\n\n    // Create startup manager with test configuration\n    startupManager = new StartupManager({\n      maxStartupTime: 10000,\n      stepTimeout: 2000,\n      maxRetries: 2,\n      retryDelay: 100,\n      gracefulShutdownTimeout: 5000,\n      validateEnvironment: false // Disable for most tests\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    // Clean up any running processes\n    if (startupManager) {\n      startupManager.removeAllListeners();\n    }\n  });\n\n  describe('Step Registration', () => {\n    it('should register a startup step successfully', () => {\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      expect(() => startupManager.registerStep(step)).not.toThrow();\n      expect(mockLogger.debug).toHaveBeenCalledWith(\n        'Startup step registered: test-step',\n        undefined,\n        expect.objectContaining({\n          description: 'Test step',\n          timeout: 1000,\n          required: true,\n          dependencies: []\n        })\n      );\n    });\n\n    it('should prevent registration after startup has begun', async () => {\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n      await startupManager.start();\n\n      const newStep: StartupStep = {\n        name: 'new-step',\n        description: 'New step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      expect(() => startupManager.registerStep(newStep)).toThrow(\n        'Cannot register steps after startup has begun'\n      );\n    });\n\n    it('should emit step:registered event', () => {\n      const eventSpy = jest.fn();\n      startupManager.on('step:registered', eventSpy);\n\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n\n      expect(eventSpy).toHaveBeenCalledWith({ name: 'test-step' });\n    });\n  });\n\n  describe('Startup Execution', () => {\n    it('should execute steps successfully', async () => {\n      const executeStep1 = jest.fn().mockResolvedValue(undefined);\n      const executeStep2 = jest.fn().mockResolvedValue(undefined);\n\n      const step1: StartupStep = {\n        name: 'step1',\n        description: 'First step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: executeStep1\n      };\n\n      const step2: StartupStep = {\n        name: 'step2',\n        description: 'Second step',\n        timeout: 1000,\n        required: true,\n        dependencies: ['step1'],\n        execute: executeStep2\n      };\n\n      startupManager.registerStep(step1);\n      startupManager.registerStep(step2);\n\n      await startupManager.start();\n\n      expect(executeStep1).toHaveBeenCalled();\n      expect(executeStep2).toHaveBeenCalled();\n      expect(startupManager.isStartupComplete()).toBe(true);\n    });\n\n    it('should execute steps in dependency order', async () => {\n      const executionOrder: string[] = [];\n\n      const step1: StartupStep = {\n        name: 'step1',\n        description: 'First step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockImplementation(() => {\n          executionOrder.push('step1');\n          return Promise.resolve();\n        })\n      };\n\n      const step2: StartupStep = {\n        name: 'step2',\n        description: 'Second step',\n        timeout: 1000,\n        required: true,\n        dependencies: ['step1'],\n        execute: jest.fn().mockImplementation(() => {\n          executionOrder.push('step2');\n          return Promise.resolve();\n        })\n      };\n\n      const step3: StartupStep = {\n        name: 'step3',\n        description: 'Third step',\n        timeout: 1000,\n        required: true,\n        dependencies: ['step1', 'step2'],\n        execute: jest.fn().mockImplementation(() => {\n          executionOrder.push('step3');\n          return Promise.resolve();\n        })\n      };\n\n      startupManager.registerStep(step1);\n      startupManager.registerStep(step2);\n      startupManager.registerStep(step3);\n\n      await startupManager.start();\n\n      expect(executionOrder).toEqual(['step1', 'step2', 'step3']);\n    });\n\n    it('should detect circular dependencies', () => {\n      const step1: StartupStep = {\n        name: 'step1',\n        description: 'First step',\n        timeout: 1000,\n        required: true,\n        dependencies: ['step2'],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      const step2: StartupStep = {\n        name: 'step2',\n        description: 'Second step',\n        timeout: 1000,\n        required: true,\n        dependencies: ['step1'],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step1);\n      startupManager.registerStep(step2);\n\n      expect(startupManager.start()).rejects.toThrow(\n        'Circular dependency detected involving step: step1'\n      );\n    });\n\n    it('should fail if required step fails', async () => {\n      const step: StartupStep = {\n        name: 'failing-step',\n        description: 'Failing step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockRejectedValue(new Error('Step failed'))\n      };\n\n      startupManager.registerStep(step);\n\n      await expect(startupManager.start()).rejects.toThrow(\n        'Required startup step failed: failing-step - Step failed'\n      );\n    });\n\n    it('should continue if optional step fails', async () => {\n      const failingStep: StartupStep = {\n        name: 'failing-step',\n        description: 'Failing step',\n        timeout: 1000,\n        required: false,\n        dependencies: [],\n        execute: jest.fn().mockRejectedValue(new Error('Step failed'))\n      };\n\n      const successStep: StartupStep = {\n        name: 'success-step',\n        description: 'Success step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(failingStep);\n      startupManager.registerStep(successStep);\n\n      await startupManager.start();\n\n      expect(startupManager.isStartupComplete()).toBe(true);\n      expect(mockLogger.warn).toHaveBeenCalledWith(\n        'Optional startup step failed, continuing: failing-step'\n      );\n    });\n\n    it('should retry failed steps', async () => {\n      let attemptCount = 0;\n      const step: StartupStep = {\n        name: 'retry-step',\n        description: 'Retry step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockImplementation(() => {\n          attemptCount++;\n          if (attemptCount < 2) {\n            return Promise.reject(new Error('Temporary failure'));\n          }\n          return Promise.resolve();\n        })\n      };\n\n      startupManager.registerStep(step);\n\n      await startupManager.start();\n\n      expect(attemptCount).toBe(2);\n      expect(startupManager.isStartupComplete()).toBe(true);\n    });\n\n    it('should timeout steps that take too long', async () => {\n      const step: StartupStep = {\n        name: 'slow-step',\n        description: 'Slow step',\n        timeout: 100,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockImplementation(() => \n          new Promise(resolve => setTimeout(resolve, 200))\n        )\n      };\n\n      startupManager.registerStep(step);\n\n      await expect(startupManager.start()).rejects.toThrow(\n        'Required startup step failed: slow-step - Step timeout: slow-step'\n      );\n    });\n\n    it('should timeout entire startup if it takes too long', async () => {\n      const step: StartupStep = {\n        name: 'slow-step',\n        description: 'Slow step',\n        timeout: 15000, // Longer than maxStartupTime\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockImplementation(() => \n          new Promise(resolve => setTimeout(resolve, 12000))\n        )\n      };\n\n      startupManager.registerStep(step);\n\n      await expect(startupManager.start()).rejects.toThrow(\n        /Startup timeout exceeded/\n      );\n    });\n\n    it('should prevent multiple starts', async () => {\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n      await startupManager.start();\n\n      await expect(startupManager.start()).rejects.toThrow(\n        'Startup manager has already been started'\n      );\n    });\n  });\n\n  describe('Environment Validation', () => {\n    it('should validate environment when enabled', async () => {\n      // Set required environment variables\n      process.env.NODE_ENV = 'test';\n      process.env.PORT = '3000';\n      process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/test';\n\n      const startupManagerWithValidation = new StartupManager({\n        validateEnvironment: true\n      });\n\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManagerWithValidation.registerStep(step);\n\n      await expect(startupManagerWithValidation.start()).resolves.not.toThrow();\n\n      // Clean up\n      delete process.env.NODE_ENV;\n      delete process.env.PORT;\n      delete process.env.DATABASE_URL;\n    });\n\n    it('should fail validation with missing required variables', async () => {\n      // Ensure required variables are not set\n      delete process.env.NODE_ENV;\n      delete process.env.PORT;\n      delete process.env.DATABASE_URL;\n\n      const startupManagerWithValidation = new StartupManager({\n        validateEnvironment: true\n      });\n\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManagerWithValidation.registerStep(step);\n\n      await expect(startupManagerWithValidation.start()).rejects.toThrow(\n        /Environment validation failed/\n      );\n    });\n  });\n\n  describe('Events', () => {\n    it('should emit startup events', async () => {\n      const startedSpy = jest.fn();\n      const completedSpy = jest.fn();\n\n      startupManager.on('startup:started', startedSpy);\n      startupManager.on('startup:completed', completedSpy);\n\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n      await startupManager.start();\n\n      expect(startedSpy).toHaveBeenCalled();\n      expect(completedSpy).toHaveBeenCalledWith(\n        expect.objectContaining({ duration: expect.any(Number) })\n      );\n    });\n\n    it('should emit step events', async () => {\n      const stepStartedSpy = jest.fn();\n      const stepCompletedSpy = jest.fn();\n\n      startupManager.on('step:started', stepStartedSpy);\n      startupManager.on('step:completed', stepCompletedSpy);\n\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n      await startupManager.start();\n\n      expect(stepStartedSpy).toHaveBeenCalledWith({ name: 'test-step' });\n      expect(stepCompletedSpy).toHaveBeenCalledWith(\n        expect.objectContaining({\n          name: 'test-step',\n          status: StartupStatus.COMPLETED,\n          duration: expect.any(Number)\n        })\n      );\n    });\n\n    it('should emit failure events', async () => {\n      const startupFailedSpy = jest.fn();\n      const stepFailedSpy = jest.fn();\n\n      startupManager.on('startup:failed', startupFailedSpy);\n      startupManager.on('step:failed', stepFailedSpy);\n\n      const step: StartupStep = {\n        name: 'failing-step',\n        description: 'Failing step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockRejectedValue(new Error('Step failed'))\n      };\n\n      startupManager.registerStep(step);\n\n      await expect(startupManager.start()).rejects.toThrow();\n\n      expect(stepFailedSpy).toHaveBeenCalledWith(\n        expect.objectContaining({\n          name: 'failing-step',\n          status: StartupStatus.FAILED,\n          error: expect.any(Error)\n        })\n      );\n\n      expect(startupFailedSpy).toHaveBeenCalledWith(\n        expect.objectContaining({\n          error: expect.any(Error),\n          duration: expect.any(Number)\n        })\n      );\n    });\n  });\n\n  describe('Status and Results', () => {\n    it('should track startup results', async () => {\n      const step1: StartupStep = {\n        name: 'step1',\n        description: 'First step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      const step2: StartupStep = {\n        name: 'step2',\n        description: 'Second step',\n        timeout: 1000,\n        required: false,\n        dependencies: [],\n        execute: jest.fn().mockRejectedValue(new Error('Optional failure'))\n      };\n\n      startupManager.registerStep(step1);\n      startupManager.registerStep(step2);\n\n      await startupManager.start();\n\n      const results = startupManager.getResults();\n      expect(results).toHaveLength(2);\n\n      const step1Result = results.find(r => r.name === 'step1');\n      const step2Result = results.find(r => r.name === 'step2');\n\n      expect(step1Result?.status).toBe(StartupStatus.COMPLETED);\n      expect(step2Result?.status).toBe(StartupStatus.FAILED);\n    });\n\n    it('should provide status summary', async () => {\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockResolvedValue(undefined)\n      };\n\n      startupManager.registerStep(step);\n\n      // Before startup\n      let summary = startupManager.getStatusSummary();\n      expect(summary.started).toBe(false);\n      expect(summary.completed).toBe(false);\n\n      await startupManager.start();\n\n      // After startup\n      summary = startupManager.getStatusSummary();\n      expect(summary.started).toBe(true);\n      expect(summary.completed).toBe(true);\n      expect(summary.totalSteps).toBe(1);\n      expect(summary.completedSteps).toBe(1);\n      expect(summary.failedSteps).toBe(0);\n    });\n\n    it('should calculate startup duration', async () => {\n      const step: StartupStep = {\n        name: 'test-step',\n        description: 'Test step',\n        timeout: 1000,\n        required: true,\n        dependencies: [],\n        execute: jest.fn().mockImplementation(() => \n          new Promise(resolve => setTimeout(resolve, 100))\n        )\n      };\n\n      startupManager.registerStep(step);\n\n      const startTime = Date.now();\n      await startupManager.start();\n      const endTime = Date.now();\n\n      const duration = startupManager.getStartupDuration();\n      expect(duration).toBeGreaterThan(0);\n      expect(duration).toBeLessThanOrEqual(endTime - startTime + 10); // Allow small margin\n    });\n  });\n\n  describe('Shutdown Handlers', () => {\n    it('should register and execute shutdown handlers', async () => {\n      const shutdownHandler1 = jest.fn().mockResolvedValue(undefined);\n      const shutdownHandler2 = jest.fn().mockResolvedValue(undefined);\n\n      startupManager.registerShutdownHandler(shutdownHandler1);\n      startupManager.registerShutdownHandler(shutdownHandler2);\n\n      await startupManager.shutdown();\n\n      expect(shutdownHandler1).toHaveBeenCalled();\n      expect(shutdownHandler2).toHaveBeenCalled();\n    });\n\n    it('should handle shutdown handler failures', async () => {\n      const failingHandler = jest.fn().mockRejectedValue(new Error('Shutdown failed'));\n      const successHandler = jest.fn().mockResolvedValue(undefined);\n\n      startupManager.registerShutdownHandler(failingHandler);\n      startupManager.registerShutdownHandler(successHandler);\n\n      await expect(startupManager.shutdown()).rejects.toThrow('Shutdown failed');\n\n      expect(failingHandler).toHaveBeenCalled();\n      expect(successHandler).toHaveBeenCalled();\n    });\n\n    it('should timeout shutdown if it takes too long', async () => {\n      const slowHandler = jest.fn().mockImplementation(() => \n        new Promise(resolve => setTimeout(resolve, 6000))\n      );\n\n      startupManager.registerShutdownHandler(slowHandler);\n\n      await expect(startupManager.shutdown()).rejects.toThrow('Shutdown timeout');\n    });\n\n    it('should prevent multiple shutdowns', async () => {\n      const handler = jest.fn().mockResolvedValue(undefined);\n      startupManager.registerShutdownHandler(handler);\n\n      const shutdown1 = startupManager.shutdown();\n      const shutdown2 = startupManager.shutdown();\n\n      await shutdown1;\n      await shutdown2;\n\n      // Second shutdown should not execute handlers again\n      expect(handler).toHaveBeenCalledTimes(1);\n    });\n  });\n});"],"version":3}