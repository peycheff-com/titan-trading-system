f619ca66d6541f47979c15dfdae8f408
"use strict";
/**
 * CircuitBreaker Tests
 *
 * Comprehensive unit tests for the CircuitBreaker class
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Logger
jest.mock('../../src/logging/Logger');
const CircuitBreaker_1 = require("../../src/services/CircuitBreaker");
const Logger_1 = require("../../src/logging/Logger");
const mockLogger = {
    info: jest.fn(),
    warn: jest.fn(),
    error: jest.fn(),
    debug: jest.fn()
};
describe('CircuitBreaker', () => {
    let circuitBreaker;
    beforeEach(() => {
        jest.clearAllMocks();
        Logger_1.Logger.getInstance.mockReturnValue(mockLogger);
        circuitBreaker = new CircuitBreaker_1.CircuitBreaker({
            name: 'test-service',
            failureThreshold: 3,
            recoveryTimeout: 1000,
            requestTimeout: 500,
            monitoringPeriod: 5000,
            halfOpenMaxCalls: 2
        });
    });
    describe('constructor', () => {
        it('should initialize with correct configuration', () => {
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.failureCount).toBe(0);
            expect(stats.successCount).toBe(0);
            expect(stats.totalRequests).toBe(0);
        });
        it('should log initialization', () => {
            expect(mockLogger.info).toHaveBeenCalledWith('Circuit breaker initialized', undefined, expect.objectContaining({
                name: 'test-service',
                failureThreshold: 3,
                recoveryTimeout: 1000,
                requestTimeout: 500
            }));
        });
    });
    describe('execute - CLOSED state', () => {
        it('should execute function successfully', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            const result = await circuitBreaker.execute(mockFn);
            expect(result).toBe('success');
            expect(mockFn).toHaveBeenCalledTimes(1);
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.successCount).toBe(1);
            expect(stats.totalRequests).toBe(1);
        });
        it('should handle function failure', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
            expect(stats.failureCount).toBe(1);
            expect(stats.totalRequests).toBe(1);
        });
        it('should transition to OPEN after failure threshold', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            // Fail 3 times (threshold)
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            const stats = circuitBreaker.getStats();
            expect(stats.state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
            expect(stats.failureCount).toBe(3);
        });
        it('should reset failure count on success', async () => {
            const mockFn = jest.fn()
                .mockRejectedValueOnce(new Error('Test error'))
                .mockResolvedValue('success');
            // Fail once
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().failureCount).toBe(1);
            // Succeed
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().failureCount).toBe(0);
        });
        it('should handle timeout', async () => {
            const mockFn = jest.fn().mockImplementation(() => new Promise(resolve => setTimeout(resolve, 1000)));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Request timeout');
            const stats = circuitBreaker.getStats();
            expect(stats.failureCount).toBe(1);
        });
    });
    describe('execute - OPEN state', () => {
        beforeEach(async () => {
            // Force circuit breaker to OPEN state
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
        });
        it('should reject requests immediately', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow(CircuitBreaker_1.CircuitBreakerError);
            expect(mockFn).not.toHaveBeenCalled();
        });
        it('should transition to HALF_OPEN after recovery timeout', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Wait for recovery timeout
            await new Promise(resolve => setTimeout(resolve, 1100));
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.HALF_OPEN);
        });
    });
    describe('execute - HALF_OPEN state', () => {
        beforeEach(async () => {
            // Force to OPEN state
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            // Wait for recovery timeout and transition to HALF_OPEN
            await new Promise(resolve => setTimeout(resolve, 1100));
            const successFn = jest.fn().mockResolvedValue('success');
            await circuitBreaker.execute(successFn);
        });
        it('should allow limited calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Should allow one more call (total 2 in half-open)
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should transition to CLOSED after successful calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should transition to OPEN on failure', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
        });
        it('should reject requests after max calls', async () => {
            const mockFn = jest.fn().mockResolvedValue('success');
            // Complete the half-open transition
            await circuitBreaker.execute(mockFn);
            // Now in CLOSED state, should accept more calls
            await circuitBreaker.execute(mockFn);
            expect(mockFn).toHaveBeenCalledTimes(2);
        });
    });
    describe('state transitions', () => {
        it('should emit stateChange events', async () => {
            const stateChangeHandler = jest.fn();
            circuitBreaker.on('stateChange', stateChangeHandler);
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            // Trigger state change to OPEN
            for (let i = 0; i < 3; i++) {
                await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            }
            expect(stateChangeHandler).toHaveBeenCalledWith({
                from: CircuitBreaker_1.CircuitBreakerState.CLOSED,
                to: CircuitBreaker_1.CircuitBreakerState.OPEN,
                stats: expect.any(Object)
            });
        });
    });
    describe('admin operations', () => {
        it('should force close circuit breaker', () => {
            circuitBreaker.forceOpen();
            expect(circuitBreaker.getState()).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
            circuitBreaker.forceClose();
            expect(circuitBreaker.getState()).toBe(CircuitBreaker_1.CircuitBreakerState.CLOSED);
        });
        it('should reset statistics', async () => {
            const mockFn = jest.fn().mockRejectedValue(new Error('Test error'));
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('Test error');
            expect(circuitBreaker.getStats().failureCount).toBe(1);
            circuitBreaker.reset();
            const stats = circuitBreaker.getStats();
            expect(stats.failureCount).toBe(0);
            expect(stats.successCount).toBe(0);
            expect(stats.totalRequests).toBe(0);
        });
    });
    describe('utility methods', () => {
        it('should calculate failure rate correctly', async () => {
            const mockFn = jest.fn()
                .mockResolvedValueOnce('success')
                .mockRejectedValueOnce(new Error('error'))
                .mockResolvedValueOnce('success');
            await circuitBreaker.execute(mockFn);
            await expect(circuitBreaker.execute(mockFn)).rejects.toThrow('error');
            await circuitBreaker.execute(mockFn);
            expect(circuitBreaker.getFailureRate()).toBeCloseTo(1 / 3);
            expect(circuitBreaker.getSuccessRate()).toBeCloseTo(2 / 3);
        });
        it('should check if healthy', () => {
            expect(circuitBreaker.isHealthy()).toBe(true);
            circuitBreaker.forceOpen();
            expect(circuitBreaker.isHealthy()).toBe(false);
        });
        it('should calculate time until next attempt', () => {
            circuitBreaker.forceOpen();
            const timeUntilNext = circuitBreaker.getTimeUntilNextAttempt();
            expect(timeUntilNext).toBeGreaterThan(0);
        });
    });
    describe('defaults', () => {
        it('should have correct default configurations', () => {
            expect(CircuitBreaker_1.CircuitBreakerDefaults.http).toEqual({
                failureThreshold: 5,
                recoveryTimeout: 30000,
                requestTimeout: 10000,
                monitoringPeriod: 60000,
                halfOpenMaxCalls: 3,
                name: 'http-service'
            });
            expect(CircuitBreaker_1.CircuitBreakerDefaults.database).toEqual({
                failureThreshold: 3,
                recoveryTimeout: 60000,
                requestTimeout: 5000,
                monitoringPeriod: 300000,
                halfOpenMaxCalls: 2,
                name: 'database-service'
            });
        });
    });
    describe('error handling', () => {
        it('should handle CircuitBreakerError correctly', async () => {
            circuitBreaker.forceOpen();
            try {
                await circuitBreaker.execute(() => Promise.resolve('test'));
            }
            catch (error) {
                expect(error).toBeInstanceOf(CircuitBreaker_1.CircuitBreakerError);
                expect(error.state).toBe(CircuitBreaker_1.CircuitBreakerState.OPEN);
                expect(error.stats).toBeDefined();
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3NlcnZpY2VzL0NpcmN1aXRCcmVha2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBS0gsY0FBYztBQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUp0QyxzRUFBcUk7QUFDckkscURBQWtEO0FBSWxELE1BQU0sVUFBVSxHQUFHO0lBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNWLENBQUM7QUFFVCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksY0FBOEIsQ0FBQztJQUVuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3BCLGVBQU0sQ0FBQyxXQUF5QixDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUU5RCxjQUFjLEdBQUcsSUFBSSwrQkFBYyxDQUFDO1lBQ2xDLElBQUksRUFBRSxjQUFjO1lBQ3BCLGdCQUFnQixFQUFFLENBQUM7WUFDbkIsZUFBZSxFQUFFLElBQUk7WUFDckIsY0FBYyxFQUFFLEdBQUc7WUFDbkIsZ0JBQWdCLEVBQUUsSUFBSTtZQUN0QixnQkFBZ0IsRUFBRSxDQUFDO1NBQ3BCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFeEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMs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LEVBQUUsY0FBYzthQUNyQixDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsdUNBQXNCLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUM5QyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUNuQixlQUFlLEVBQUUsS0FBSztnQkFDdEIsY0FBYyxFQUFFLElBQUk7Z0JBQ3BCLGdCQUFnQixFQUFFLE1BQU07Z0JBQ3hCLGdCQUFnQixFQUFFLENBQUM7Z0JBQ25CLElBQUksRUFBRSxrQkFBa0I7YUFDekIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELGNBQWMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUUzQixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM5RCxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLG9DQUFtQixDQUFDLENBQUM7Z0JBQ2xELE1BQU0sQ0FBRSxLQUE2QixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxvQ0FBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUUsTUFBTSxDQUFFLEtBQTZCLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvc2VydmljZXMvQ2lyY3VpdEJyZWFrZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENpcmN1aXRCcmVha2VyIFRlc3RzXG4gKiBcbiAqIENvbXByZWhlbnNpdmUgdW5pdCB0ZXN0cyBmb3IgdGhlIENpcmN1aXRCcmVha2VyIGNsYXNzXG4gKi9cblxuaW1wb3J0IHsgQ2lyY3VpdEJyZWFrZXIsIENpcmN1aXRCcmVha2VyU3RhdGUsIENpcmN1aXRCcmVha2VyRXJyb3IsIENpcmN1aXRCcmVha2VyRGVmYXVsdHMgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvQ2lyY3VpdEJyZWFrZXInO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL2xvZ2dpbmcvTG9nZ2VyJztcblxuLy8gTW9jayBMb2dnZXJcbmplc3QubW9jaygnLi4vLi4vc3JjL2xvZ2dpbmcvTG9nZ2VyJyk7XG5jb25zdCBtb2NrTG9nZ2VyID0ge1xuICBpbmZvOiBqZXN0LmZuKCksXG4gIHdhcm46IGplc3QuZm4oKSxcbiAgZXJyb3I6IGplc3QuZm4oKSxcbiAgZGVidWc6IGplc3QuZm4oKVxufSBhcyBhbnk7XG5cbmRlc2NyaWJlKCdDaXJjdWl0QnJlYWtlcicsICgpID0+IHtcbiAgbGV0IGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlcjtcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIChMb2dnZXIuZ2V0SW5zdGFuY2UgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUobW9ja0xvZ2dlcik7XG4gICAgXG4gICAgY2lyY3VpdEJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoe1xuICAgICAgbmFtZTogJ3Rlc3Qtc2VydmljZScsXG4gICAgICBmYWlsdXJlVGhyZXNob2xkOiAzLFxuICAgICAgcmVjb3ZlcnlUaW1lb3V0OiAxMDAwLFxuICAgICAgcmVxdWVzdFRpbWVvdXQ6IDUwMCxcbiAgICAgIG1vbml0b3JpbmdQZXJpb2Q6IDUwMDAsXG4gICAgICBoYWxmT3Blbk1heENhbGxzOiAyXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBjb3JyZWN0IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0cyA9IGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0cy5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZmFpbHVyZUNvdW50KS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnN1Y2Nlc3NDb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFJlcXVlc3RzKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgaW5pdGlhbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0NpcmN1aXQgYnJlYWtlciBpbml0aWFsaXplZCcsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIG5hbWU6ICd0ZXN0LXNlcnZpY2UnLFxuICAgICAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDMsXG4gICAgICAgICAgcmVjb3ZlcnlUaW1lb3V0OiAxMDAwLFxuICAgICAgICAgIHJlcXVlc3RUaW1lb3V0OiA1MDBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdleGVjdXRlIC0gQ0xPU0VEIHN0YXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBmdW5jdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdzdWNjZXNzJyk7XG4gICAgICBleHBlY3QobW9ja0ZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRCk7XG4gICAgICBleHBlY3Qoc3RhdHMuc3VjY2Vzc0NvdW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUmVxdWVzdHMpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmdW5jdGlvbiBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZmFpbHVyZUNvdW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUmVxdWVzdHMpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYW5zaXRpb24gdG8gT1BFTiBhZnRlciBmYWlsdXJlIHRocmVzaG9sZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG4gICAgICBcbiAgICAgIC8vIEZhaWwgMyB0aW1lcyAodGhyZXNob2xkKVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLk9QRU4pO1xuICAgICAgZXhwZWN0KHN0YXRzLmZhaWx1cmVDb3VudCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgZmFpbHVyZSBjb3VudCBvbiBzdWNjZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdUZXN0IGVycm9yJykpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICAvLyBGYWlsIG9uY2VcbiAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnVGVzdCBlcnJvcicpO1xuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCkuZmFpbHVyZUNvdW50KS50b0JlKDEpO1xuICAgICAgXG4gICAgICAvLyBTdWNjZWVkXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKS5mYWlsdXJlQ291bnQpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aW1lb3V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdSZXF1ZXN0IHRpbWVvdXQnKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmZhaWx1cmVDb3VudCkudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4ZWN1dGUgLSBPUEVOIHN0YXRlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRm9yY2UgY2lyY3VpdCBicmVha2VyIHRvIE9QRU4gc3RhdGVcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlcXVlc3RzIGltbWVkaWF0ZWx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdyhDaXJjdWl0QnJlYWtlckVycm9yKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tGbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhbnNpdGlvbiB0byBIQUxGX09QRU4gYWZ0ZXIgcmVjb3ZlcnkgdGltZW91dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICAvLyBXYWl0IGZvciByZWNvdmVyeSB0aW1lb3V0XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTEwMCkpO1xuICAgICAgXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuSEFMRl9PUEVOKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4ZWN1dGUgLSBIQUxGX09QRU4gc3RhdGUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGb3JjZSB0byBPUEVOIHN0YXRlXG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdUZXN0IGVycm9yJykpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFdhaXQgZm9yIHJlY292ZXJ5IHRpbWVvdXQgYW5kIHRyYW5zaXRpb24gdG8gSEFMRl9PUEVOXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTEwMCkpO1xuICAgICAgY29uc3Qgc3VjY2Vzc0ZuID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJyk7XG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKHN1Y2Nlc3NGbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGxpbWl0ZWQgY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIGFsbG93IG9uZSBtb3JlIGNhbGwgKHRvdGFsIDIgaW4gaGFsZi1vcGVuKVxuICAgICAgYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pO1xuICAgICAgXG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKS5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYW5zaXRpb24gdG8gQ0xPU0VEIGFmdGVyIHN1Y2Nlc3NmdWwgY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIFxuICAgICAgYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pO1xuICAgICAgXG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKS5zdGF0ZSkudG9CZShDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYW5zaXRpb24gdG8gT1BFTiBvbiBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZuID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVGVzdCBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKSkucmVqZWN0cy50b1Rocm93KCdUZXN0IGVycm9yJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0cygpLnN0YXRlKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZXF1ZXN0cyBhZnRlciBtYXggY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKTtcbiAgICAgIFxuICAgICAgLy8gQ29tcGxldGUgdGhlIGhhbGYtb3BlbiB0cmFuc2l0aW9uXG4gICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbik7XG4gICAgICBcbiAgICAgIC8vIE5vdyBpbiBDTE9TRUQgc3RhdGUsIHNob3VsZCBhY2NlcHQgbW9yZSBjYWxsc1xuICAgICAgYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pO1xuICAgICAgZXhwZWN0KG1vY2tGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhdGUgdHJhbnNpdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbWl0IHN0YXRlQ2hhbmdlIGV2ZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlQ2hhbmdlSGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNpcmN1aXRCcmVha2VyLm9uKCdzdGF0ZUNoYW5nZScsIHN0YXRlQ2hhbmdlSGFuZGxlcik7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG4gICAgICBcbiAgICAgIC8vIFRyaWdnZXIgc3RhdGUgY2hhbmdlIHRvIE9QRU5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnVGVzdCBlcnJvcicpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdGVDaGFuZ2VIYW5kbGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGZyb206IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VELFxuICAgICAgICB0bzogQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOLFxuICAgICAgICBzdGF0czogZXhwZWN0LmFueShPYmplY3QpXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FkbWluIG9wZXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmb3JjZSBjbG9zZSBjaXJjdWl0IGJyZWFrZXInLCAoKSA9PiB7XG4gICAgICBjaXJjdWl0QnJlYWtlci5mb3JjZU9wZW4oKTtcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0ZSgpKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTik7XG4gICAgICBcbiAgICAgIGNpcmN1aXRCcmVha2VyLmZvcmNlQ2xvc2UoKTtcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5nZXRTdGF0ZSgpKS50b0JlKENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgc3RhdGlzdGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG4gICAgICBhd2FpdCBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShtb2NrRm4pKS5yZWplY3RzLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCkuZmFpbHVyZUNvdW50KS50b0JlKDEpO1xuICAgICAgXG4gICAgICBjaXJjdWl0QnJlYWtlci5yZXNldCgpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZmFpbHVyZUNvdW50KS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnN1Y2Nlc3NDb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFJlcXVlc3RzKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXRpbGl0eSBtZXRob2RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGZhaWx1cmUgcmF0ZSBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRm4gPSBqZXN0LmZuKClcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSgnc3VjY2VzcycpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdlcnJvcicpKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKCdzdWNjZXNzJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjaXJjdWl0QnJlYWtlci5leGVjdXRlKG1vY2tGbikpLnJlamVjdHMudG9UaHJvdygnZXJyb3InKTtcbiAgICAgIGF3YWl0IGNpcmN1aXRCcmVha2VyLmV4ZWN1dGUobW9ja0ZuKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNpcmN1aXRCcmVha2VyLmdldEZhaWx1cmVSYXRlKCkpLnRvQmVDbG9zZVRvKDEvMyk7XG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuZ2V0U3VjY2Vzc1JhdGUoKSkudG9CZUNsb3NlVG8oMi8zKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2hlY2sgaWYgaGVhbHRoeScsICgpID0+IHtcbiAgICAgIGV4cGVjdChjaXJjdWl0QnJlYWtlci5pc0hlYWx0aHkoKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY2lyY3VpdEJyZWFrZXIuZm9yY2VPcGVuKCk7XG4gICAgICBleHBlY3QoY2lyY3VpdEJyZWFrZXIuaXNIZWFsdGh5KCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdGltZSB1bnRpbCBuZXh0IGF0dGVtcHQnLCAoKSA9PiB7XG4gICAgICBjaXJjdWl0QnJlYWtlci5mb3JjZU9wZW4oKTtcbiAgICAgIGNvbnN0IHRpbWVVbnRpbE5leHQgPSBjaXJjdWl0QnJlYWtlci5nZXRUaW1lVW50aWxOZXh0QXR0ZW1wdCgpO1xuICAgICAgZXhwZWN0KHRpbWVVbnRpbE5leHQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlZmF1bHRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGRlZmF1bHQgY29uZmlndXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQ2lyY3VpdEJyZWFrZXJEZWZhdWx0cy5odHRwKS50b0VxdWFsKHtcbiAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogNSxcbiAgICAgICAgcmVjb3ZlcnlUaW1lb3V0OiAzMDAwMCxcbiAgICAgICAgcmVxdWVzdFRpbWVvdXQ6IDEwMDAwLFxuICAgICAgICBtb25pdG9yaW5nUGVyaW9kOiA2MDAwMCxcbiAgICAgICAgaGFsZk9wZW5NYXhDYWxsczogMyxcbiAgICAgICAgbmFtZTogJ2h0dHAtc2VydmljZSdcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoQ2lyY3VpdEJyZWFrZXJEZWZhdWx0cy5kYXRhYmFzZSkudG9FcXVhbCh7XG4gICAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDMsXG4gICAgICAgIHJlY292ZXJ5VGltZW91dDogNjAwMDAsXG4gICAgICAgIHJlcXVlc3RUaW1lb3V0OiA1MDAwLFxuICAgICAgICBtb25pdG9yaW5nUGVyaW9kOiAzMDAwMDAsXG4gICAgICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDIsXG4gICAgICAgIG5hbWU6ICdkYXRhYmFzZS1zZXJ2aWNlJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBDaXJjdWl0QnJlYWtlckVycm9yIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNpcmN1aXRCcmVha2VyLmZvcmNlT3BlbigpO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKCgpID0+IFByb21pc2UucmVzb2x2ZSgndGVzdCcpKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoQ2lyY3VpdEJyZWFrZXJFcnJvcik7XG4gICAgICAgIGV4cGVjdCgoZXJyb3IgYXMgQ2lyY3VpdEJyZWFrZXJFcnJvcikuc3RhdGUpLnRvQmUoQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOKTtcbiAgICAgICAgZXhwZWN0KChlcnJvciBhcyBDaXJjdWl0QnJlYWtlckVycm9yKS5zdGF0cykudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=