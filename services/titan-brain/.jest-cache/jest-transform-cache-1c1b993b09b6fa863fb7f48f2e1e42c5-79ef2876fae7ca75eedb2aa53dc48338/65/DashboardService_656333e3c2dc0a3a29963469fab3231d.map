{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/server/DashboardService.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/server/DashboardService.ts"],"sourcesContent":["/**\n * DashboardService - Comprehensive data collection and aggregation for dashboard\n * Handles NAV calculation, allocation formatting, risk metrics, and treasury status\n * \n * Requirements: 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8\n */\n\nimport {\n  DashboardData,\n  AllocationVector,\n  PhaseId,\n  PhasePerformance,\n  TreasuryStatus,\n  BreakerStatus,\n  BrainDecision,\n  RiskMetrics,\n  Position,\n} from '../types/index.js';\nimport { TitanBrain } from '../engine/TitanBrain.js';\nimport { DatabaseManager } from '../db/DatabaseManager.js';\n\n/**\n * Extended dashboard data with additional metrics\n */\nexport interface ExtendedDashboardData extends DashboardData {\n  /** Version metadata */\n  version: string;\n  /** System uptime in milliseconds */\n  uptime: number;\n  /** Performance metrics per phase */\n  phasePerformance: PhasePerformance[];\n  /** Signal approval rates per phase */\n  approvalRates: Record<PhaseId, number>;\n  /** Next sweep trigger level */\n  nextSweepTriggerLevel: number;\n  /** Total amount swept to spot wallet */\n  totalSwept: number;\n  /** High watermark value */\n  highWatermark: number;\n  /** Distance to high watermark (current drawdown) */\n  drawdownFromHigh: number;\n  /** Time since last profitable trade */\n  timeSinceLastProfit: number | null;\n  /** Current positions summary */\n  positionsSummary: {\n    count: number;\n    totalNotional: number;\n    totalUnrealizedPnL: number;\n  };\n}\n\n/**\n * Wallet balance information\n */\nexport interface WalletBalance {\n  exchange: string;\n  walletType: 'spot' | 'futures' | 'margin';\n  asset: string;\n  balance: number;\n  usdValue: number;\n}\n\n/**\n * NAV calculation result\n */\nexport interface NAVCalculation {\n  totalNAV: number;\n  walletBreakdown: WalletBalance[];\n  unrealizedPnL: number;\n  lastUpdated: number;\n}\n\n/**\n * Dashboard service configuration\n */\nexport interface DashboardServiceConfig {\n  /** Cache TTL for dashboard data (ms) */\n  cacheTTL: number;\n  /** Cache TTL for NAV calculation (ms) */\n  navCacheTTL: number;\n  /** Maximum number of recent decisions to include */\n  maxRecentDecisions: number;\n  /** System version */\n  version: string;\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_CONFIG: DashboardServiceConfig = {\n  cacheTTL: 60000, // 1 minute\n  navCacheTTL: 30000, // 30 seconds\n  maxRecentDecisions: 50,\n  version: '1.0.0',\n};\n\n/**\n * DashboardService provides comprehensive data aggregation for the dashboard\n */\nexport class DashboardService {\n  private readonly config: DashboardServiceConfig;\n  private readonly brain: TitanBrain;\n  private readonly db: DatabaseManager | null;\n  private readonly startTime: number;\n\n  /** Cache for dashboard data */\n  private dashboardCache: ExtendedDashboardData | null = null;\n  private dashboardCacheTime: number = 0;\n\n  /** Cache for NAV calculation */\n  private navCache: NAVCalculation | null = null;\n  private navCacheTime: number = 0;\n\n  /** External wallet balance providers */\n  private walletProviders: Map<string, () => Promise<WalletBalance[]>> = new Map();\n\n  constructor(\n    brain: TitanBrain,\n    db?: DatabaseManager,\n    config?: Partial<DashboardServiceConfig>\n  ) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.brain = brain;\n    this.db = db ?? null;\n    this.startTime = Date.now();\n  }\n\n  /**\n   * Register a wallet balance provider\n   * \n   * @param exchange - Exchange name (e.g., 'bybit', 'binance')\n   * @param provider - Function that returns wallet balances\n   */\n  registerWalletProvider(\n    exchange: string,\n    provider: () => Promise<WalletBalance[]>\n  ): void {\n    this.walletProviders.set(exchange, provider);\n  }\n\n  /**\n   * Calculate NAV from all wallets\n   * Requirement 10.2: Implement NAV calculation from all wallets\n   * \n   * @returns NAV calculation with wallet breakdown\n   */\n  async calculateNAV(): Promise<NAVCalculation> {\n    // Check cache\n    if (\n      this.navCache &&\n      Date.now() - this.navCacheTime < this.config.navCacheTTL\n    ) {\n      return this.navCache;\n    }\n\n    const walletBreakdown: WalletBalance[] = [];\n    let totalNAV = 0;\n    let unrealizedPnL = 0;\n\n    // Collect balances from all registered providers\n    for (const [exchange, provider] of this.walletProviders) {\n      try {\n        const balances = await provider();\n        walletBreakdown.push(...balances);\n        \n        // Sum USD values\n        for (const balance of balances) {\n          totalNAV += balance.usdValue;\n        }\n      } catch (error) {\n        console.error(`Error fetching balances from ${exchange}:`, error);\n      }\n    }\n\n    // Add unrealized PnL from current positions\n    const positions = this.brain.getPositions();\n    for (const position of positions) {\n      if (position.unrealizedPnL) {\n        unrealizedPnL += position.unrealizedPnL;\n      }\n    }\n\n    totalNAV += unrealizedPnL;\n\n    const result: NAVCalculation = {\n      totalNAV,\n      walletBreakdown,\n      unrealizedPnL,\n      lastUpdated: Date.now(),\n    };\n\n    // Cache the result\n    this.navCache = result;\n    this.navCacheTime = Date.now();\n\n    return result;\n  }\n\n  /**\n   * Format allocation vector with metadata\n   * Requirement 10.3: Implement allocation vector formatting\n   * \n   * @param allocation - Raw allocation vector\n   * @param equity - Current equity\n   * @returns Formatted allocation data\n   */\n  formatAllocation(allocation: AllocationVector, equity: number) {\n    return {\n      vector: allocation,\n      phaseEquity: {\n        phase1: {\n          weight: allocation.w1,\n          equity: equity * allocation.w1,\n          percentage: (allocation.w1 * 100).toFixed(2) + '%',\n        },\n        phase2: {\n          weight: allocation.w2,\n          equity: equity * allocation.w2,\n          percentage: (allocation.w2 * 100).toFixed(2) + '%',\n        },\n        phase3: {\n          weight: allocation.w3,\n          equity: equity * allocation.w3,\n          percentage: (allocation.w3 * 100).toFixed(2) + '%',\n        },\n      },\n      totalEquity: equity,\n      lastUpdated: allocation.timestamp,\n    };\n  }\n\n  /**\n   * Calculate phase equity for each phase\n   * Requirement 10.4: Implement phase equity calculation\n   * \n   * @param allocation - Allocation vector\n   * @param equity - Total equity\n   * @returns Phase equity breakdown\n   */\n  calculatePhaseEquity(\n    allocation: AllocationVector,\n    equity: number\n  ): Record<PhaseId, number> {\n    return {\n      phase1: equity * allocation.w1,\n      phase2: equity * allocation.w2,\n      phase3: equity * allocation.w3,\n    };\n  }\n\n  /**\n   * Aggregate risk metrics with additional calculations\n   * Requirement 10.5: Implement risk metrics aggregation\n   * \n   * @param positions - Current positions\n   * @returns Aggregated risk metrics\n   */\n  async aggregateRiskMetrics(positions: Position[]) {\n    // Get risk metrics from the brain's internal risk guardian\n    // Since we don't have direct access, we'll calculate them here\n    const baseMetrics: RiskMetrics = {\n      currentLeverage: 0,\n      projectedLeverage: 0,\n      correlation: 0,\n      portfolioDelta: 0,\n      portfolioBeta: 0,\n    };\n    \n    // Calculate additional metrics\n    const positionCount = positions.length;\n    const totalNotional = positions.reduce((sum, pos) => sum + Math.abs(pos.size), 0);\n    const totalUnrealizedPnL = positions.reduce((sum, pos) => sum + (pos.unrealizedPnL ?? 0), 0);\n    \n    // Calculate correlation matrix for all positions\n    const correlations: Record<string, Record<string, number>> = {};\n    for (let i = 0; i < positions.length; i++) {\n      for (let j = i + 1; j < positions.length; j++) {\n        const symbolA = positions[i].symbol;\n        const symbolB = positions[j].symbol;\n        \n        if (!correlations[symbolA]) correlations[symbolA] = {};\n        if (!correlations[symbolB]) correlations[symbolB] = {};\n        \n        // For now, use a placeholder correlation calculation\n        // In a real implementation, this would access the risk guardian's correlation data\n        const correlation = 0.5;\n        correlations[symbolA][symbolB] = correlation;\n        correlations[symbolB][symbolA] = correlation;\n      }\n    }\n\n    return {\n      ...baseMetrics,\n      positionCount,\n      totalNotional,\n      totalUnrealizedPnL,\n      correlationMatrix: correlations,\n      riskScore: this.calculateRiskScore(baseMetrics, positionCount, totalNotional),\n    };\n  }\n\n  /**\n   * Aggregate treasury status with additional metrics\n   * Requirement 10.6: Implement treasury status aggregation\n   * \n   * @returns Enhanced treasury status\n   */\n  async aggregateTreasuryStatus() {\n    const treasury = await this.brain.getTreasuryStatus();\n    const nextSweepLevel = this.brain.getNextSweepTriggerLevel();\n    const totalSwept = this.brain.getTotalSwept();\n    const highWatermark = this.brain.getHighWatermark();\n    \n    // Calculate additional metrics\n    const currentEquity = this.brain.getEquity();\n    const totalEquity = treasury.futuresWallet + treasury.spotWallet;\n    const drawdownFromHigh = highWatermark > 0 ? (highWatermark - currentEquity) / highWatermark : 0;\n    const sweepProgress = nextSweepLevel > 0 ? Math.min(treasury.futuresWallet / nextSweepLevel, 1) : 0;\n    \n    return {\n      ...treasury,\n      nextSweepTriggerLevel: nextSweepLevel,\n      totalSwept,\n      highWatermark,\n      drawdownFromHigh,\n      sweepProgress,\n      riskCapitalRatio: totalEquity > 0 ? treasury.riskCapital / totalEquity : 0,\n      lockedProfitRatio: totalEquity > 0 ? treasury.lockedProfit / totalEquity : 0,\n    };\n  }\n\n  /**\n   * Retrieve recent decisions with filtering\n   * Requirement 10.7: Implement recent decisions retrieval\n   * \n   * @param limit - Maximum number of decisions\n   * @param phaseFilter - Optional phase filter\n   * @returns Recent decisions with metadata\n   */\n  async getRecentDecisions(\n    limit: number = this.config.maxRecentDecisions,\n    phaseFilter?: PhaseId\n  ) {\n    let decisions = this.brain.getRecentDecisions(limit);\n    \n    // Apply phase filter if specified\n    if (phaseFilter) {\n      decisions = decisions.filter(d => \n        d.allocation && this.getPhaseFromDecision(d) === phaseFilter\n      );\n    }\n\n    // Add metadata to each decision\n    const enhancedDecisions = decisions.map(decision => ({\n      ...decision,\n      processingTime: this.estimateProcessingTime(decision),\n      riskLevel: this.calculateDecisionRiskLevel(decision),\n      impactScore: this.calculateImpactScore(decision),\n    }));\n\n    return {\n      decisions: enhancedDecisions,\n      summary: {\n        total: enhancedDecisions.length,\n        approved: enhancedDecisions.filter(d => d.approved).length,\n        rejected: enhancedDecisions.filter(d => !d.approved).length,\n        approvalRate: enhancedDecisions.length > 0 \n          ? enhancedDecisions.filter(d => d.approved).length / enhancedDecisions.length \n          : 0,\n      },\n    };\n  }\n\n  /**\n   * Get comprehensive dashboard data\n   * Aggregates all dashboard components\n   * \n   * @returns Extended dashboard data\n   */\n  async getDashboardData(): Promise<ExtendedDashboardData> {\n    // Check cache\n    if (\n      this.dashboardCache &&\n      Date.now() - this.dashboardCacheTime < this.config.cacheTTL\n    ) {\n      return this.dashboardCache;\n    }\n\n    // Get base dashboard data from brain\n    const baseDashboard = await this.brain.getDashboardData();\n    \n    // Calculate NAV\n    const navCalculation = await this.calculateNAV();\n    \n    // Get enhanced metrics\n    const phasePerformance = await this.brain.getAllPhasePerformance();\n    const approvalRates = this.brain.getAllApprovalRates();\n    const enhancedTreasury = await this.aggregateTreasuryStatus();\n    const enhancedDecisions = await this.getRecentDecisions();\n    \n    // Calculate additional metrics\n    const positions = this.brain.getPositions();\n    const positionsSummary = {\n      count: positions.length,\n      totalNotional: positions.reduce((sum, pos) => sum + Math.abs(pos.size), 0),\n      totalUnrealizedPnL: positions.reduce((sum, pos) => sum + (pos.unrealizedPnL ?? 0), 0),\n    };\n\n    // Calculate time since last profitable trade\n    const timeSinceLastProfit = await this.getTimeSinceLastProfit();\n\n    const extendedData: ExtendedDashboardData = {\n      ...baseDashboard,\n      nav: navCalculation.totalNAV,\n      version: this.config.version,\n      uptime: Date.now() - this.startTime,\n      phasePerformance,\n      approvalRates,\n      nextSweepTriggerLevel: enhancedTreasury.nextSweepTriggerLevel,\n      totalSwept: enhancedTreasury.totalSwept,\n      highWatermark: enhancedTreasury.highWatermark,\n      drawdownFromHigh: enhancedTreasury.drawdownFromHigh,\n      timeSinceLastProfit,\n      positionsSummary,\n      treasury: enhancedTreasury,\n      recentDecisions: enhancedDecisions.decisions,\n    };\n\n    // Cache the result\n    this.dashboardCache = extendedData;\n    this.dashboardCacheTime = Date.now();\n\n    return extendedData;\n  }\n\n  /**\n   * Export dashboard data to JSON with metadata\n   * Requirement 10.8: Create export endpoint for dashboard data\n   * \n   * @returns JSON string with timestamp and version metadata\n   */\n  async exportDashboardJSON(): Promise<string> {\n    const dashboardData = await this.getDashboardData();\n    \n    const exportData = {\n      metadata: {\n        exportedAt: new Date().toISOString(),\n        version: this.config.version,\n        source: 'titan-brain-dashboard-service',\n      },\n      data: dashboardData,\n    };\n\n    return JSON.stringify(exportData, null, 2);\n  }\n\n  /**\n   * Clear all caches\n   */\n  clearCache(): void {\n    this.dashboardCache = null;\n    this.dashboardCacheTime = 0;\n    this.navCache = null;\n    this.navCacheTime = 0;\n  }\n\n  /**\n   * Get cache status\n   */\n  getCacheStatus() {\n    return {\n      dashboard: {\n        cached: this.dashboardCache !== null,\n        age: this.dashboardCache ? Date.now() - this.dashboardCacheTime : 0,\n        ttl: this.config.cacheTTL,\n      },\n      nav: {\n        cached: this.navCache !== null,\n        age: this.navCache ? Date.now() - this.navCacheTime : 0,\n        ttl: this.config.navCacheTTL,\n      },\n    };\n  }\n\n  // ============ Private Helper Methods ============\n\n  /**\n   * Calculate overall risk score\n   */\n  private calculateRiskScore(\n    metrics: RiskMetrics,\n    positionCount: number,\n    totalNotional: number\n  ): number {\n    // Simple risk scoring algorithm (0-100)\n    let score = 0;\n    \n    // Leverage component (0-40 points)\n    score += Math.min(metrics.currentLeverage * 2, 40);\n    \n    // Correlation component (0-30 points)\n    score += metrics.correlation * 30;\n    \n    // Position count component (0-20 points)\n    score += Math.min(positionCount * 2, 20);\n    \n    // Notional size component (0-10 points)\n    const equity = this.brain.getEquity();\n    if (equity > 0) {\n      const notionalRatio = totalNotional / equity;\n      score += Math.min(notionalRatio * 5, 10);\n    }\n    \n    return Math.min(score, 100);\n  }\n\n  /**\n   * Get phase from decision (helper method)\n   */\n  private getPhaseFromDecision(decision: BrainDecision): PhaseId | null {\n    // This would need to be implemented based on how phase info is stored in decisions\n    // For now, return null as we don't have this info in the current structure\n    return null;\n  }\n\n  /**\n   * Estimate processing time for a decision\n   */\n  private estimateProcessingTime(decision: BrainDecision): number {\n    // Simple estimation based on decision complexity\n    let baseTime = 10; // Base 10ms\n    \n    if (decision.risk.riskMetrics) {\n      baseTime += 20; // Risk calculation overhead\n    }\n    \n    if (!decision.approved) {\n      baseTime += 5; // Veto processing\n    }\n    \n    return baseTime;\n  }\n\n  /**\n   * Calculate risk level for a decision\n   */\n  private calculateDecisionRiskLevel(decision: BrainDecision): 'low' | 'medium' | 'high' {\n    if (!decision.risk.riskMetrics) return 'low';\n    \n    const leverage = decision.risk.riskMetrics.currentLeverage;\n    const correlation = decision.risk.riskMetrics.correlation;\n    \n    if (leverage > 10 || correlation > 0.8) return 'high';\n    if (leverage > 5 || correlation > 0.6) return 'medium';\n    return 'low';\n  }\n\n  /**\n   * Calculate impact score for a decision\n   */\n  private calculateImpactScore(decision: BrainDecision): number {\n    if (!decision.approved) return 0;\n    \n    const equity = this.brain.getEquity();\n    if (equity === 0) return 0;\n    \n    return (decision.authorizedSize / equity) * 100;\n  }\n\n  /**\n   * Get time since last profitable trade\n   */\n  private async getTimeSinceLastProfit(): Promise<number | null> {\n    if (!this.db) return null;\n\n    try {\n      const result = await this.db.query(\n        `SELECT MAX(timestamp) as last_profit_time \n         FROM phase_performance \n         WHERE pnl > 0 \n         ORDER BY timestamp DESC \n         LIMIT 1`\n      );\n\n      if (result.rows.length > 0 && result.rows[0].last_profit_time) {\n        return Date.now() - result.rows[0].last_profit_time;\n      }\n    } catch (error) {\n      console.error('Error fetching last profit time:', error);\n    }\n\n    return null;\n  }\n}"],"version":3}