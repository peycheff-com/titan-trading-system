f462ce6247d97bce921bcf81b94b7a25
"use strict";
/**
 * Unit Tests for PerformanceTracker
 *
 * Tests Sharpe ratio calculation, malus/bonus logic, and trade history handling.
 * Requirements: 2.1, 2.2, 2.3, 2.4, 2.8
 */
Object.defineProperty(exports, "__esModule", { value: true });
const PerformanceTracker_js_1 = require("../../src/engine/PerformanceTracker.js");
const defaults_js_1 = require("../../src/config/defaults.js");
describe('PerformanceTracker', () => {
    let tracker;
    const config = defaults_js_1.defaultConfig.performanceTracker;
    beforeEach(() => {
        // Create tracker without database for pure function testing
        tracker = new PerformanceTracker_js_1.PerformanceTracker(config);
    });
    describe('constructor', () => {
        it('should initialize with provided configuration', () => {
            const trackerConfig = tracker.getConfig();
            expect(trackerConfig.windowDays).toBe(7);
            expect(trackerConfig.minTradeCount).toBe(10);
            expect(trackerConfig.malusMultiplier).toBe(0.5);
            expect(trackerConfig.bonusMultiplier).toBe(1.2);
            expect(trackerConfig.malusThreshold).toBe(0);
            expect(trackerConfig.bonusThreshold).toBe(2.0);
        });
        it('should accept custom configuration', () => {
            const customConfig = {
                windowDays: 14,
                minTradeCount: 20,
                malusMultiplier: 0.3,
                bonusMultiplier: 1.5,
                malusThreshold: -0.5,
                bonusThreshold: 3.0,
            };
            const customTracker = new PerformanceTracker_js_1.PerformanceTracker(customConfig);
            const result = customTracker.getConfig();
            expect(result.windowDays).toBe(14);
            expect(result.minTradeCount).toBe(20);
            expect(result.malusMultiplier).toBe(0.3);
            expect(result.bonusMultiplier).toBe(1.5);
        });
    });
    describe('calculateSharpeRatio', () => {
        describe('basic calculations', () => {
            it('should return 0 for empty array', () => {
                const sharpe = tracker.calculateSharpeRatio([]);
                expect(sharpe).toBe(0);
            });
            it('should return 0 for single value', () => {
                const sharpe = tracker.calculateSharpeRatio([100]);
                expect(sharpe).toBe(0);
            });
            it('should calculate positive Sharpe for consistent gains', () => {
                // Consistent positive returns should yield positive Sharpe
                const pnl = [100, 110, 105, 115, 120, 108, 112];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(sharpe).toBeGreaterThan(0);
            });
            it('should calculate negative Sharpe for consistent losses', () => {
                // Consistent negative returns should yield negative Sharpe
                const pnl = [-100, -110, -105, -115, -120, -108, -112];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(sharpe).toBeLessThan(0);
            });
            it('should return high Sharpe for all identical positive values', () => {
                // All same positive values = zero std dev, should return capped positive
                const pnl = [100, 100, 100, 100, 100];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(sharpe).toBe(3.0);
            });
            it('should return low Sharpe for all identical negative values', () => {
                // All same negative values = zero std dev, should return capped negative
                const pnl = [-100, -100, -100, -100, -100];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(sharpe).toBe(-3.0);
            });
            it('should return 0 for all zero values', () => {
                const pnl = [0, 0, 0, 0, 0];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(sharpe).toBe(0);
            });
        });
        describe('known value tests', () => {
            it('should calculate correct Sharpe for known data', () => {
                // Test with known values
                // Mean = 10, StdDev ≈ 7.07, Daily Sharpe ≈ 1.41
                // Annualized ≈ 1.41 * sqrt(365) ≈ 27
                const pnl = [5, 15, 5, 15, 10];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                // Mean = 10
                // Variance = ((5-10)^2 + (15-10)^2 + (5-10)^2 + (15-10)^2 + (10-10)^2) / 4 = 100/4 = 25
                // StdDev = 5
                // Daily Sharpe = 10/5 = 2
                // Annualized = 2 * sqrt(365) ≈ 38.2
                expect(sharpe).toBeCloseTo(2 * Math.sqrt(365), 1);
            });
            it('should handle mixed positive and negative returns', () => {
                const pnl = [100, -50, 75, -25, 50, -10, 30];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                // Should be positive since net is positive
                expect(sharpe).toBeGreaterThan(0);
            });
        });
        describe('edge cases', () => {
            it('should handle very small values', () => {
                const pnl = [0.001, 0.002, 0.001, 0.003, 0.002];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(Number.isFinite(sharpe)).toBe(true);
            });
            it('should handle very large values', () => {
                const pnl = [1000000, 1100000, 1050000, 1150000, 1200000];
                const sharpe = tracker.calculateSharpeRatio(pnl);
                expect(Number.isFinite(sharpe)).toBe(true);
                expect(sharpe).toBeGreaterThan(0);
            });
        });
    });
    describe('calculateModifier', () => {
        describe('malus penalty (Sharpe < 0)', () => {
            it('should return malusMultiplier for negative Sharpe', () => {
                const modifier = tracker.calculateModifier(-1.0);
                expect(modifier).toBe(0.5);
            });
            it('should return malusMultiplier for Sharpe at threshold', () => {
                // malusThreshold is 0, so exactly 0 should NOT trigger malus
                const modifier = tracker.calculateModifier(0);
                expect(modifier).toBe(1.0);
            });
            it('should return malusMultiplier for very negative Sharpe', () => {
                const modifier = tracker.calculateModifier(-10.0);
                expect(modifier).toBe(0.5);
            });
        });
        describe('bonus multiplier (Sharpe > 2.0)', () => {
            it('should return bonusMultiplier for high Sharpe', () => {
                const modifier = tracker.calculateModifier(2.5);
                expect(modifier).toBe(1.2);
            });
            it('should return 1.0 for Sharpe at bonus threshold', () => {
                // bonusThreshold is 2.0, so exactly 2.0 should NOT trigger bonus
                const modifier = tracker.calculateModifier(2.0);
                expect(modifier).toBe(1.0);
            });
            it('should return bonusMultiplier for very high Sharpe', () => {
                const modifier = tracker.calculateModifier(10.0);
                expect(modifier).toBe(1.2);
            });
        });
        describe('normal performance (0 <= Sharpe <= 2.0)', () => {
            it('should return 1.0 for Sharpe of 0', () => {
                const modifier = tracker.calculateModifier(0);
                expect(modifier).toBe(1.0);
            });
            it('should return 1.0 for Sharpe of 1.0', () => {
                const modifier = tracker.calculateModifier(1.0);
                expect(modifier).toBe(1.0);
            });
            it('should return 1.0 for Sharpe of 2.0', () => {
                const modifier = tracker.calculateModifier(2.0);
                expect(modifier).toBe(1.0);
            });
            it('should return 1.0 for Sharpe of 0.5', () => {
                const modifier = tracker.calculateModifier(0.5);
                expect(modifier).toBe(1.0);
            });
        });
        describe('modifier bounds', () => {
            it('should never return less than malusMultiplier', () => {
                const testValues = [-100, -10, -5, -1, -0.5, -0.1];
                for (const sharpe of testValues) {
                    const modifier = tracker.calculateModifier(sharpe);
                    expect(modifier).toBeGreaterThanOrEqual(0.5);
                }
            });
            it('should never return more than bonusMultiplier', () => {
                const testValues = [2.1, 3, 5, 10, 100];
                for (const sharpe of testValues) {
                    const modifier = tracker.calculateModifier(sharpe);
                    expect(modifier).toBeLessThanOrEqual(1.2);
                }
            });
        });
    });
    describe('custom thresholds', () => {
        it('should respect custom malusThreshold', () => {
            const customConfig = {
                ...config,
                malusThreshold: -0.5,
            };
            const customTracker = new PerformanceTracker_js_1.PerformanceTracker(customConfig);
            // Sharpe of -0.3 should NOT trigger malus with threshold of -0.5
            expect(customTracker.calculateModifier(-0.3)).toBe(1.0);
            // Sharpe of -0.6 should trigger malus
            expect(customTracker.calculateModifier(-0.6)).toBe(0.5);
        });
        it('should respect custom bonusThreshold', () => {
            const customConfig = {
                ...config,
                bonusThreshold: 3.0,
            };
            const customTracker = new PerformanceTracker_js_1.PerformanceTracker(customConfig);
            // Sharpe of 2.5 should NOT trigger bonus with threshold of 3.0
            expect(customTracker.calculateModifier(2.5)).toBe(1.0);
            // Sharpe of 3.5 should trigger bonus
            expect(customTracker.calculateModifier(3.5)).toBe(1.2);
        });
        it('should respect custom multipliers', () => {
            const customConfig = {
                ...config,
                malusMultiplier: 0.3,
                bonusMultiplier: 1.5,
            };
            const customTracker = new PerformanceTracker_js_1.PerformanceTracker(customConfig);
            expect(customTracker.calculateModifier(-1.0)).toBe(0.3);
            expect(customTracker.calculateModifier(3.0)).toBe(1.5);
        });
    });
    describe('database operations without database', () => {
        it('should throw error when recording trade without database', async () => {
            await expect(tracker.recordTrade('phase1', 100, Date.now())).rejects.toThrow('Database not configured');
        });
        it('should return empty array for getTradesInWindow without database', async () => {
            const trades = await tracker.getTradesInWindow('phase1', 7);
            expect(trades).toEqual([]);
        });
        it('should return 0 for getTradeCount without database', async () => {
            const count = await tracker.getTradeCount('phase1', 7);
            expect(count).toBe(0);
        });
        it('should return 0 for getSharpeRatio without database', async () => {
            const sharpe = await tracker.getSharpeRatio('phase1');
            expect(sharpe).toBe(0);
        });
        it('should return 1.0 for getPerformanceModifier without database', async () => {
            // No trades = insufficient history = 1.0 modifier
            const modifier = await tracker.getPerformanceModifier('phase1');
            expect(modifier).toBe(1.0);
        });
    });
    describe('getPhasePerformance without database', () => {
        it('should return default performance metrics', async () => {
            const performance = await tracker.getPhasePerformance('phase1');
            expect(performance.phaseId).toBe('phase1');
            expect(performance.sharpeRatio).toBe(0);
            expect(performance.totalPnL).toBe(0);
            expect(performance.tradeCount).toBe(0);
            expect(performance.winRate).toBe(0);
            expect(performance.avgWin).toBe(0);
            expect(performance.avgLoss).toBe(0);
            expect(performance.modifier).toBe(1.0);
        });
    });
    describe('getAllPhasePerformance', () => {
        it('should return performance for all three phases', async () => {
            const performances = await tracker.getAllPhasePerformance();
            expect(performances).toHaveLength(3);
            expect(performances.map(p => p.phaseId)).toEqual(['phase1', 'phase2', 'phase3']);
        });
    });
    describe('getConfig', () => {
        it('should return a copy of configuration', () => {
            const config1 = tracker.getConfig();
            const config2 = tracker.getConfig();
            expect(config1).toEqual(config2);
            expect(config1).not.toBe(config2); // Should be different objects
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvUGVyZm9ybWFuY2VUcmFja2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOztBQUVILGtGQUE0RTtBQUU1RSw4REFBNkQ7QUFFN0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxJQUFJLE9BQTJCLENBQUM7SUFDaEMsTUFBTSxNQUFNLEdBQTZCLDJCQUFhLENBQUMsa0JBQWtCLENBQUM7SUFFMUUsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLDREQUE0RDtRQUM1RCxPQUFPLEdBQUcsSUFBSSwwQ0FBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQyxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxHQUFHLEVBQUU7WUFDdkQsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQyxDQUFD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QyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNuRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDcEMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRXBDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7UUFDbkUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy91bml0L1BlcmZvcm1hbmNlVHJhY2tlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCBUZXN0cyBmb3IgUGVyZm9ybWFuY2VUcmFja2VyXG4gKiBcbiAqIFRlc3RzIFNoYXJwZSByYXRpbyBjYWxjdWxhdGlvbiwgbWFsdXMvYm9udXMgbG9naWMsIGFuZCB0cmFkZSBoaXN0b3J5IGhhbmRsaW5nLlxuICogUmVxdWlyZW1lbnRzOiAyLjEsIDIuMiwgMi4zLCAyLjQsIDIuOFxuICovXG5cbmltcG9ydCB7IFBlcmZvcm1hbmNlVHJhY2tlciB9IGZyb20gJy4uLy4uL3NyYy9lbmdpbmUvUGVyZm9ybWFuY2VUcmFja2VyLmpzJztcbmltcG9ydCB7IFBlcmZvcm1hbmNlVHJhY2tlckNvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBkZWZhdWx0Q29uZmlnIH0gZnJvbSAnLi4vLi4vc3JjL2NvbmZpZy9kZWZhdWx0cy5qcyc7XG5cbmRlc2NyaWJlKCdQZXJmb3JtYW5jZVRyYWNrZXInLCAoKSA9PiB7XG4gIGxldCB0cmFja2VyOiBQZXJmb3JtYW5jZVRyYWNrZXI7XG4gIGNvbnN0IGNvbmZpZzogUGVyZm9ybWFuY2VUcmFja2VyQ29uZmlnID0gZGVmYXVsdENvbmZpZy5wZXJmb3JtYW5jZVRyYWNrZXI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIHRyYWNrZXIgd2l0aG91dCBkYXRhYmFzZSBmb3IgcHVyZSBmdW5jdGlvbiB0ZXN0aW5nXG4gICAgdHJhY2tlciA9IG5ldyBQZXJmb3JtYW5jZVRyYWNrZXIoY29uZmlnKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB3aXRoIHByb3ZpZGVkIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0cmFja2VyQ29uZmlnID0gdHJhY2tlci5nZXRDb25maWcoKTtcbiAgICAgIGV4cGVjdCh0cmFja2VyQ29uZmlnLndpbmRvd0RheXMpLnRvQmUoNyk7XG4gICAgICBleHBlY3QodHJhY2tlckNvbmZpZy5taW5UcmFkZUNvdW50KS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdCh0cmFja2VyQ29uZmlnLm1hbHVzTXVsdGlwbGllcikudG9CZSgwLjUpO1xuICAgICAgZXhwZWN0KHRyYWNrZXJDb25maWcuYm9udXNNdWx0aXBsaWVyKS50b0JlKDEuMik7XG4gICAgICBleHBlY3QodHJhY2tlckNvbmZpZy5tYWx1c1RocmVzaG9sZCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdCh0cmFja2VyQ29uZmlnLmJvbnVzVGhyZXNob2xkKS50b0JlKDIuMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbUNvbmZpZzogUGVyZm9ybWFuY2VUcmFja2VyQ29uZmlnID0ge1xuICAgICAgICB3aW5kb3dEYXlzOiAxNCxcbiAgICAgICAgbWluVHJhZGVDb3VudDogMjAsXG4gICAgICAgIG1hbHVzTXVsdGlwbGllcjogMC4zLFxuICAgICAgICBib251c011bHRpcGxpZXI6IDEuNSxcbiAgICAgICAgbWFsdXNUaHJlc2hvbGQ6IC0wLjUsXG4gICAgICAgIGJvbnVzVGhyZXNob2xkOiAzLjAsXG4gICAgICB9O1xuICAgICAgY29uc3QgY3VzdG9tVHJhY2tlciA9IG5ldyBQZXJmb3JtYW5jZVRyYWNrZXIoY3VzdG9tQ29uZmlnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGN1c3RvbVRyYWNrZXIuZ2V0Q29uZmlnKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQud2luZG93RGF5cykudG9CZSgxNCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1pblRyYWRlQ291bnQpLnRvQmUoMjApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tYWx1c011bHRpcGxpZXIpLnRvQmUoMC4zKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYm9udXNNdWx0aXBsaWVyKS50b0JlKDEuNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVTaGFycGVSYXRpbycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnYmFzaWMgY2FsY3VsYXRpb25zJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gMCBmb3IgZW1wdHkgYXJyYXknLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNoYXJwZSA9IHRyYWNrZXIuY2FsY3VsYXRlU2hhcnBlUmF0aW8oW10pO1xuICAgICAgICBleHBlY3Qoc2hhcnBlKS50b0JlKDApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDAgZm9yIHNpbmdsZSB2YWx1ZScsICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2hhcnBlID0gdHJhY2tlci5jYWxjdWxhdGVTaGFycGVSYXRpbyhbMTAwXSk7XG4gICAgICAgIGV4cGVjdChzaGFycGUpLnRvQmUoMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgcG9zaXRpdmUgU2hhcnBlIGZvciBjb25zaXN0ZW50IGdhaW5zJywgKCkgPT4ge1xuICAgICAgICAvLyBDb25zaXN0ZW50IHBvc2l0aXZlIHJldHVybnMgc2hvdWxkIHlpZWxkIHBvc2l0aXZlIFNoYXJwZVxuICAgICAgICBjb25zdCBwbmwgPSBbMTAwLCAxMTAsIDEwNSwgMTE1LCAxMjAsIDEwOCwgMTEyXTtcbiAgICAgICAgY29uc3Qgc2hhcnBlID0gdHJhY2tlci5jYWxjdWxhdGVTaGFycGVSYXRpbyhwbmwpO1xuICAgICAgICBleHBlY3Qoc2hhcnBlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgbmVnYXRpdmUgU2hhcnBlIGZvciBjb25zaXN0ZW50IGxvc3NlcycsICgpID0+IHtcbiAgICAgICAgLy8gQ29uc2lzdGVudCBuZWdhdGl2ZSByZXR1cm5zIHNob3VsZCB5aWVsZCBuZWdhdGl2ZSBTaGFycGVcbiAgICAgICAgY29uc3QgcG5sID0gWy0xMDAsIC0xMTAsIC0xMDUsIC0xMTUsIC0xMjAsIC0xMDgsIC0xMTJdO1xuICAgICAgICBjb25zdCBzaGFycGUgPSB0cmFja2VyLmNhbGN1bGF0ZVNoYXJwZVJhdGlvKHBubCk7XG4gICAgICAgIGV4cGVjdChzaGFycGUpLnRvQmVMZXNzVGhhbigwKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBoaWdoIFNoYXJwZSBmb3IgYWxsIGlkZW50aWNhbCBwb3NpdGl2ZSB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICAgIC8vIEFsbCBzYW1lIHBvc2l0aXZlIHZhbHVlcyA9IHplcm8gc3RkIGRldiwgc2hvdWxkIHJldHVybiBjYXBwZWQgcG9zaXRpdmVcbiAgICAgICAgY29uc3QgcG5sID0gWzEwMCwgMTAwLCAxMDAsIDEwMCwgMTAwXTtcbiAgICAgICAgY29uc3Qgc2hhcnBlID0gdHJhY2tlci5jYWxjdWxhdGVTaGFycGVSYXRpbyhwbmwpO1xuICAgICAgICBleHBlY3Qoc2hhcnBlKS50b0JlKDMuMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbG93IFNoYXJwZSBmb3IgYWxsIGlkZW50aWNhbCBuZWdhdGl2ZSB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICAgIC8vIEFsbCBzYW1lIG5lZ2F0aXZlIHZhbHVlcyA9IHplcm8gc3RkIGRldiwgc2hvdWxkIHJldHVybiBjYXBwZWQgbmVnYXRpdmVcbiAgICAgICAgY29uc3QgcG5sID0gWy0xMDAsIC0xMDAsIC0xMDAsIC0xMDAsIC0xMDBdO1xuICAgICAgICBjb25zdCBzaGFycGUgPSB0cmFja2VyLmNhbGN1bGF0ZVNoYXJwZVJhdGlvKHBubCk7XG4gICAgICAgIGV4cGVjdChzaGFycGUpLnRvQmUoLTMuMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gMCBmb3IgYWxsIHplcm8gdmFsdWVzJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwbmwgPSBbMCwgMCwgMCwgMCwgMF07XG4gICAgICAgIGNvbnN0IHNoYXJwZSA9IHRyYWNrZXIuY2FsY3VsYXRlU2hhcnBlUmF0aW8ocG5sKTtcbiAgICAgICAgZXhwZWN0KHNoYXJwZSkudG9CZSgwKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2tub3duIHZhbHVlIHRlc3RzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29ycmVjdCBTaGFycGUgZm9yIGtub3duIGRhdGEnLCAoKSA9PiB7XG4gICAgICAgIC8vIFRlc3Qgd2l0aCBrbm93biB2YWx1ZXNcbiAgICAgICAgLy8gTWVhbiA9IDEwLCBTdGREZXYg4omIIDcuMDcsIERhaWx5IFNoYXJwZSDiiYggMS40MVxuICAgICAgICAvLyBBbm51YWxpemVkIOKJiCAxLjQxICogc3FydCgzNjUpIOKJiCAyN1xuICAgICAgICBjb25zdCBwbmwgPSBbNSwgMTUsIDUsIDE1LCAxMF07XG4gICAgICAgIGNvbnN0IHNoYXJwZSA9IHRyYWNrZXIuY2FsY3VsYXRlU2hhcnBlUmF0aW8ocG5sKTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1lYW4gPSAxMFxuICAgICAgICAvLyBWYXJpYW5jZSA9ICgoNS0xMCleMiArICgxNS0xMCleMiArICg1LTEwKV4yICsgKDE1LTEwKV4yICsgKDEwLTEwKV4yKSAvIDQgPSAxMDAvNCA9IDI1XG4gICAgICAgIC8vIFN0ZERldiA9IDVcbiAgICAgICAgLy8gRGFpbHkgU2hhcnBlID0gMTAvNSA9IDJcbiAgICAgICAgLy8gQW5udWFsaXplZCA9IDIgKiBzcXJ0KDM2NSkg4omIIDM4LjJcbiAgICAgICAgZXhwZWN0KHNoYXJwZSkudG9CZUNsb3NlVG8oMiAqIE1hdGguc3FydCgzNjUpLCAxKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXhlZCBwb3NpdGl2ZSBhbmQgbmVnYXRpdmUgcmV0dXJucycsICgpID0+IHtcbiAgICAgICAgY29uc3QgcG5sID0gWzEwMCwgLTUwLCA3NSwgLTI1LCA1MCwgLTEwLCAzMF07XG4gICAgICAgIGNvbnN0IHNoYXJwZSA9IHRyYWNrZXIuY2FsY3VsYXRlU2hhcnBlUmF0aW8ocG5sKTtcbiAgICAgICAgLy8gU2hvdWxkIGJlIHBvc2l0aXZlIHNpbmNlIG5ldCBpcyBwb3NpdGl2ZVxuICAgICAgICBleHBlY3Qoc2hhcnBlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdlZGdlIGNhc2VzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmVyeSBzbWFsbCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBubCA9IFswLjAwMSwgMC4wMDIsIDAuMDAxLCAwLjAwMywgMC4wMDJdO1xuICAgICAgICBjb25zdCBzaGFycGUgPSB0cmFja2VyLmNhbGN1bGF0ZVNoYXJwZVJhdGlvKHBubCk7XG4gICAgICAgIGV4cGVjdChOdW1iZXIuaXNGaW5pdGUoc2hhcnBlKSkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIHZhbHVlcycsICgpID0+IHtcbiAgICAgICAgY29uc3QgcG5sID0gWzEwMDAwMDAsIDExMDAwMDAsIDEwNTAwMDAsIDExNTAwMDAsIDEyMDAwMDBdO1xuICAgICAgICBjb25zdCBzaGFycGUgPSB0cmFja2VyLmNhbGN1bGF0ZVNoYXJwZVJhdGlvKHBubCk7XG4gICAgICAgIGV4cGVjdChOdW1iZXIuaXNGaW5pdGUoc2hhcnBlKSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHNoYXJwZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZU1vZGlmaWVyJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdtYWx1cyBwZW5hbHR5IChTaGFycGUgPCAwKScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG1hbHVzTXVsdGlwbGllciBmb3IgbmVnYXRpdmUgU2hhcnBlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2RpZmllciA9IHRyYWNrZXIuY2FsY3VsYXRlTW9kaWZpZXIoLTEuMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgwLjUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG1hbHVzTXVsdGlwbGllciBmb3IgU2hhcnBlIGF0IHRocmVzaG9sZCcsICgpID0+IHtcbiAgICAgICAgLy8gbWFsdXNUaHJlc2hvbGQgaXMgMCwgc28gZXhhY3RseSAwIHNob3VsZCBOT1QgdHJpZ2dlciBtYWx1c1xuICAgICAgICBjb25zdCBtb2RpZmllciA9IHRyYWNrZXIuY2FsY3VsYXRlTW9kaWZpZXIoMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgxLjApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG1hbHVzTXVsdGlwbGllciBmb3IgdmVyeSBuZWdhdGl2ZSBTaGFycGUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vZGlmaWVyID0gdHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigtMTAuMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgwLjUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYm9udXMgbXVsdGlwbGllciAoU2hhcnBlID4gMi4wKScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGJvbnVzTXVsdGlwbGllciBmb3IgaGlnaCBTaGFycGUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vZGlmaWVyID0gdHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigyLjUpO1xuICAgICAgICBleHBlY3QobW9kaWZpZXIpLnRvQmUoMS4yKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiAxLjAgZm9yIFNoYXJwZSBhdCBib251cyB0aHJlc2hvbGQnLCAoKSA9PiB7XG4gICAgICAgIC8vIGJvbnVzVGhyZXNob2xkIGlzIDIuMCwgc28gZXhhY3RseSAyLjAgc2hvdWxkIE5PVCB0cmlnZ2VyIGJvbnVzXG4gICAgICAgIGNvbnN0IG1vZGlmaWVyID0gdHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigyLjApO1xuICAgICAgICBleHBlY3QobW9kaWZpZXIpLnRvQmUoMS4wKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBib251c011bHRpcGxpZXIgZm9yIHZlcnkgaGlnaCBTaGFycGUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vZGlmaWVyID0gdHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigxMC4wKTtcbiAgICAgICAgZXhwZWN0KG1vZGlmaWVyKS50b0JlKDEuMik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdub3JtYWwgcGVyZm9ybWFuY2UgKDAgPD0gU2hhcnBlIDw9IDIuMCknLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiAxLjAgZm9yIFNoYXJwZSBvZiAwJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2RpZmllciA9IHRyYWNrZXIuY2FsY3VsYXRlTW9kaWZpZXIoMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgxLjApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDEuMCBmb3IgU2hhcnBlIG9mIDEuMCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSB0cmFja2VyLmNhbGN1bGF0ZU1vZGlmaWVyKDEuMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgxLjApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDEuMCBmb3IgU2hhcnBlIG9mIDIuMCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSB0cmFja2VyLmNhbGN1bGF0ZU1vZGlmaWVyKDIuMCk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgxLjApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIDEuMCBmb3IgU2hhcnBlIG9mIDAuNScsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSB0cmFja2VyLmNhbGN1bGF0ZU1vZGlmaWVyKDAuNSk7XG4gICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZSgxLjApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnbW9kaWZpZXIgYm91bmRzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBuZXZlciByZXR1cm4gbGVzcyB0aGFuIG1hbHVzTXVsdGlwbGllcicsICgpID0+IHtcbiAgICAgICAgY29uc3QgdGVzdFZhbHVlcyA9IFstMTAwLCAtMTAsIC01LCAtMSwgLTAuNSwgLTAuMV07XG4gICAgICAgIGZvciAoY29uc3Qgc2hhcnBlIG9mIHRlc3RWYWx1ZXMpIHtcbiAgICAgICAgICBjb25zdCBtb2RpZmllciA9IHRyYWNrZXIuY2FsY3VsYXRlTW9kaWZpZXIoc2hhcnBlKTtcbiAgICAgICAgICBleHBlY3QobW9kaWZpZXIpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMC41KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbmV2ZXIgcmV0dXJuIG1vcmUgdGhhbiBib251c011bHRpcGxpZXInLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRlc3RWYWx1ZXMgPSBbMi4xLCAzLCA1LCAxMCwgMTAwXTtcbiAgICAgICAgZm9yIChjb25zdCBzaGFycGUgb2YgdGVzdFZhbHVlcykge1xuICAgICAgICAgIGNvbnN0IG1vZGlmaWVyID0gdHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcihzaGFycGUpO1xuICAgICAgICAgIGV4cGVjdChtb2RpZmllcikudG9CZUxlc3NUaGFuT3JFcXVhbCgxLjIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2N1c3RvbSB0aHJlc2hvbGRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVzcGVjdCBjdXN0b20gbWFsdXNUaHJlc2hvbGQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21Db25maWc6IFBlcmZvcm1hbmNlVHJhY2tlckNvbmZpZyA9IHtcbiAgICAgICAgLi4uY29uZmlnLFxuICAgICAgICBtYWx1c1RocmVzaG9sZDogLTAuNSxcbiAgICAgIH07XG4gICAgICBjb25zdCBjdXN0b21UcmFja2VyID0gbmV3IFBlcmZvcm1hbmNlVHJhY2tlcihjdXN0b21Db25maWcpO1xuXG4gICAgICAvLyBTaGFycGUgb2YgLTAuMyBzaG91bGQgTk9UIHRyaWdnZXIgbWFsdXMgd2l0aCB0aHJlc2hvbGQgb2YgLTAuNVxuICAgICAgZXhwZWN0KGN1c3RvbVRyYWNrZXIuY2FsY3VsYXRlTW9kaWZpZXIoLTAuMykpLnRvQmUoMS4wKTtcbiAgICAgIC8vIFNoYXJwZSBvZiAtMC42IHNob3VsZCB0cmlnZ2VyIG1hbHVzXG4gICAgICBleHBlY3QoY3VzdG9tVHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigtMC42KSkudG9CZSgwLjUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGN1c3RvbSBib251c1RocmVzaG9sZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbUNvbmZpZzogUGVyZm9ybWFuY2VUcmFja2VyQ29uZmlnID0ge1xuICAgICAgICAuLi5jb25maWcsXG4gICAgICAgIGJvbnVzVGhyZXNob2xkOiAzLjAsXG4gICAgICB9O1xuICAgICAgY29uc3QgY3VzdG9tVHJhY2tlciA9IG5ldyBQZXJmb3JtYW5jZVRyYWNrZXIoY3VzdG9tQ29uZmlnKTtcblxuICAgICAgLy8gU2hhcnBlIG9mIDIuNSBzaG91bGQgTk9UIHRyaWdnZXIgYm9udXMgd2l0aCB0aHJlc2hvbGQgb2YgMy4wXG4gICAgICBleHBlY3QoY3VzdG9tVHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigyLjUpKS50b0JlKDEuMCk7XG4gICAgICAvLyBTaGFycGUgb2YgMy41IHNob3VsZCB0cmlnZ2VyIGJvbnVzXG4gICAgICBleHBlY3QoY3VzdG9tVHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigzLjUpKS50b0JlKDEuMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgY3VzdG9tIG11bHRpcGxpZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tQ29uZmlnOiBQZXJmb3JtYW5jZVRyYWNrZXJDb25maWcgPSB7XG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgICAgbWFsdXNNdWx0aXBsaWVyOiAwLjMsXG4gICAgICAgIGJvbnVzTXVsdGlwbGllcjogMS41LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGN1c3RvbVRyYWNrZXIgPSBuZXcgUGVyZm9ybWFuY2VUcmFja2VyKGN1c3RvbUNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChjdXN0b21UcmFja2VyLmNhbGN1bGF0ZU1vZGlmaWVyKC0xLjApKS50b0JlKDAuMyk7XG4gICAgICBleHBlY3QoY3VzdG9tVHJhY2tlci5jYWxjdWxhdGVNb2RpZmllcigzLjApKS50b0JlKDEuNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkYXRhYmFzZSBvcGVyYXRpb25zIHdpdGhvdXQgZGF0YWJhc2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHJlY29yZGluZyB0cmFkZSB3aXRob3V0IGRhdGFiYXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICB0cmFja2VyLnJlY29yZFRyYWRlKCdwaGFzZTEnLCAxMDAsIERhdGUubm93KCkpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2Ugbm90IGNvbmZpZ3VyZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IGZvciBnZXRUcmFkZXNJbldpbmRvdyB3aXRob3V0IGRhdGFiYXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhZGVzID0gYXdhaXQgdHJhY2tlci5nZXRUcmFkZXNJbldpbmRvdygncGhhc2UxJywgNyk7XG4gICAgICBleHBlY3QodHJhZGVzKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDAgZm9yIGdldFRyYWRlQ291bnQgd2l0aG91dCBkYXRhYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdHJhY2tlci5nZXRUcmFkZUNvdW50KCdwaGFzZTEnLCA3KTtcbiAgICAgIGV4cGVjdChjb3VudCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDAgZm9yIGdldFNoYXJwZVJhdGlvIHdpdGhvdXQgZGF0YWJhc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzaGFycGUgPSBhd2FpdCB0cmFja2VyLmdldFNoYXJwZVJhdGlvKCdwaGFzZTEnKTtcbiAgICAgIGV4cGVjdChzaGFycGUpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiAxLjAgZm9yIGdldFBlcmZvcm1hbmNlTW9kaWZpZXIgd2l0aG91dCBkYXRhYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE5vIHRyYWRlcyA9IGluc3VmZmljaWVudCBoaXN0b3J5ID0gMS4wIG1vZGlmaWVyXG4gICAgICBjb25zdCBtb2RpZmllciA9IGF3YWl0IHRyYWNrZXIuZ2V0UGVyZm9ybWFuY2VNb2RpZmllcigncGhhc2UxJyk7XG4gICAgICBleHBlY3QobW9kaWZpZXIpLnRvQmUoMS4wKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFBoYXNlUGVyZm9ybWFuY2Ugd2l0aG91dCBkYXRhYmFzZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IHBlcmZvcm1hbmNlIG1ldHJpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJmb3JtYW5jZSA9IGF3YWl0IHRyYWNrZXIuZ2V0UGhhc2VQZXJmb3JtYW5jZSgncGhhc2UxJyk7XG5cbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS5waGFzZUlkKS50b0JlKCdwaGFzZTEnKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS5zaGFycGVSYXRpbykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS50b3RhbFBuTCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS50cmFkZUNvdW50KS50b0JlKDApO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlLndpblJhdGUpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2UuYXZnV2luKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlLmF2Z0xvc3MpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2UubW9kaWZpZXIpLnRvQmUoMS4wKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEFsbFBoYXNlUGVyZm9ybWFuY2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGVyZm9ybWFuY2UgZm9yIGFsbCB0aHJlZSBwaGFzZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJmb3JtYW5jZXMgPSBhd2FpdCB0cmFja2VyLmdldEFsbFBoYXNlUGVyZm9ybWFuY2UoKTtcblxuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlcykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlcy5tYXAocCA9PiBwLnBoYXNlSWQpKS50b0VxdWFsKFsncGhhc2UxJywgJ3BoYXNlMicsICdwaGFzZTMnXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBjb3B5IG9mIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcxID0gdHJhY2tlci5nZXRDb25maWcoKTtcbiAgICAgIGNvbnN0IGNvbmZpZzIgPSB0cmFja2VyLmdldENvbmZpZygpO1xuXG4gICAgICBleHBlY3QoY29uZmlnMSkudG9FcXVhbChjb25maWcyKTtcbiAgICAgIGV4cGVjdChjb25maWcxKS5ub3QudG9CZShjb25maWcyKTsgLy8gU2hvdWxkIGJlIGRpZmZlcmVudCBvYmplY3RzXG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=