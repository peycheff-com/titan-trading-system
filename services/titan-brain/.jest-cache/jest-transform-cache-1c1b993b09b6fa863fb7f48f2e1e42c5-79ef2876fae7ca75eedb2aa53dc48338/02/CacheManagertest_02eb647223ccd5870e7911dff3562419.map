{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/cache/CacheManager.test.ts","mappings":";AAAA;;GAEG;;AAiBH,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC;IACxB,YAAY,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC;CAClE,CAAC,CAAC,CAAC;AAjBJ,+DAAyE;AAEzE,oBAAoB;AACpB,MAAM,eAAe,GAAG;IACtB,OAAO,EAAE,IAAI,CAAC,EAAE,EAAE;IAClB,UAAU,EAAE,IAAI,CAAC,EAAE,EAAE;IACrB,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;IACf,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;IACd,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;IACd,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE;IAChB,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;IACd,OAAO,EAAE,IAAI,CAAC,EAAE,EAAE;IAClB,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE;CACd,CAAC;AAMF,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;IAC5B,IAAI,YAA0B,CAAC;IAE/B,MAAM,UAAU,GAAgB;QAC9B,KAAK,EAAE;YACL,IAAI,EAAE,WAAW;YACjB,IAAI,EAAE,IAAI;YACV,QAAQ,EAAE,eAAe;YACzB,EAAE,EAAE,CAAC;YACL,cAAc,EAAE,KAAK;YACrB,cAAc,EAAE,IAAI;SACrB;QACD,sBAAsB,EAAE,IAAI;QAC5B,eAAe,EAAE,GAAG;QACpB,aAAa,EAAE,KAAK;QACpB,qBAAqB,EAAE,KAAK;QAC5B,oBAAoB,EAAE,IAAI;QAC1B,oBAAoB,EAAE,CAAC;QACvB,gBAAgB,EAAE,IAAI;KACvB,CAAC;IAEF,UAAU,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,YAAY,GAAG,IAAI,2BAAY,CAAC,UAAU,CAAC,CAAC;QAC5C,qEAAqE;QACpE,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;QACpD,4DAA4D;QAC3D,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;QACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,KAAK,IAAI,EAAE;QACnB,IAAI,YAAY,EAAE,CAAC;YACjB,MAAM,YAAY,CAAC,QAAQ,EAAE,CAAC;QAChC,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,MAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC;QAEhC,UAAU,CAAC,GAAG,EAAE;YACd,OAAO,CAAC,GAAG,GAAG,EAAE,GAAG,WAAW,EAAE,CAAC;QACnC,CAAC,CAAC,CAAC;QAEH,SAAS,CAAC,GAAG,EAAE;YACb,OAAO,CAAC,GAAG,GAAG,WAAW,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qCAAqC,EAAE,GAAG,EAAE;YAC7C,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,+BAA+B,CAAC;YAExD,MAAM,MAAM,GAAG,2BAAY,CAAC,mBAAmB,EAAE,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kEAAkE,EAAE,GAAG,EAAE;YAC1E,OAAO,CAAC,GAAG,CAAC,UAAU,GAAG,WAAW,CAAC;YACrC,OAAO,CAAC,GAAG,CAAC,UAAU,GAAG,MAAM,CAAC;YAChC,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,WAAW,CAAC;YACzC,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC;YAE3B,MAAM,MAAM,GAAG,2BAAY,CAAC,mBAAmB,EAAE,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC7C,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACtC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACjD,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2CAA2C,EAAE,GAAG,EAAE;YACnD,MAAM,MAAM,GAAG,2BAAY,CAAC,mBAAmB,EAAE,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,aAAa,EAAE,CAAC;YACrC,MAAM,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8CAA8C,EAAE,GAAG,EAAE;YACtD,MAAM,MAAM,GAAG,2BAAY,CAAC,mBAAmB,EAAE,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1C,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC1C,MAAM,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE;QAC1B,EAAE,CAAC,2CAA2C,EAAE,KAAK,IAAI,EAAE;YACzD,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YAErD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACnD,MAAM,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;YACjF,MAAM,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAAC,OAAO,EAAE,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;YAC7D,MAAM,kBAAkB,GAAgB;gBACtC,GAAG,UAAU;gBACb,KAAK,EAAE,SAAS;aACjB,CAAC;YAEF,YAAY,GAAG,IAAI,2BAAY,CAAC,kBAAkB,CAAC,CAAC;YAEpD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACzD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE;YACvE,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;YAE1E,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,MAAM,MAAM,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;YACxC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC1C,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,UAAU,CAAC,KAAK,IAAI,EAAE;YACpB,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,iDAAiD;YAChD,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,MAAM,SAAS,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;YAC1C,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;YAEjE,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACxC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE5C,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;YAErD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACnE,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAEhE,oEAAoE;YACpE,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAChE,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;YAEjD,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAElD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACxC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE;YAC3E,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE5C,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;YAErD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,UAAU,CAAC,KAAK,IAAI,EAAE;YACpB,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,iDAAiD;YAChD,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;YACtD,MAAM,SAAS,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;YAC1C,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE5C,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;YAE7D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;QAC1F,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,MAAM,SAAS,GAAG,YAAY,CAAC;YAC/B,eAAe,CAAC,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE9C,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAG,YAAoB,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;YAChG,OAAO,CAAC,GAAG,CAAC,wCAAwC,EAAE,CAAC,CAAE,YAAoB,CAAC,WAAW,CAAC,CAAC;YAE3F,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC;YAElE,OAAO,CAAC,GAAG,CAAC,0BAA0B,EAAE,MAAM,CAAC,CAAC;YAChD,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC9D,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAE1D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAAC,UAAU,EAAE,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;QACjG,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACnE,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAEhE,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;YAEhE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE;YAChF,MAAM,qBAAqB,GAAgB;gBACzC,GAAG,UAAU;gBACb,KAAK,EAAE,SAAS;gBAChB,sBAAsB,EAAE,KAAK;aAC9B,CAAC;YAEF,YAAY,GAAG,IAAI,2BAAY,CAAC,qBAAqB,CAAC,CAAC;YACvD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;YAEhE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACnC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,UAAU,CAAC,KAAK,IAAI,EAAE;YACpB,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,iDAAiD;YAChD,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;YAC3D,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEzC,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;YAErD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEzC,8DAA8D;YAC9D,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAChE,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;YAEjD,iCAAiC;YACjC,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;YAErD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;YAC1E,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAEhE,8DAA8D;YAC9D,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAChE,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;YAEjD,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;YAErD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,UAAU,CAAC,KAAK,IAAI,EAAE;YACpB,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,iDAAiD;YAChD,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE;YAC/C,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAEhD,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,KAAK,EAAE,CAAC;YAE1C,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACrD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAEhD,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,KAAK,EAAE,CAAC;YAE1C,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACrD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2DAA2D,EAAE,KAAK,IAAI,EAAE;YACzE,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAEpE,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,KAAK,EAAE,CAAC;YAE1C,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,UAAU,CAAC,KAAK,IAAI,EAAE;YACpB,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,iDAAiD;YAChD,YAAoB,CAAC,WAAW,GAAG,eAAe,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;YACnD,YAAoB,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sDAAsD,EAAE,GAAG,EAAE;YAC9D,MAAM,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,MAAM,MAAM,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;YAExC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACzC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC1C,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YACzD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YACjD,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,GAAG,EAAE;YACtC,MAAM,OAAO,GAAG,YAAY,CAAC,UAAU,EAAE,CAAC;YAE1C,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1C,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC3C,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;YACpD,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,UAAU,EAAE,GAAG,EAAE;QACxB,EAAE,CAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE;YAC1C,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,eAAe,CAAC,UAAU,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YAExD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,MAAM,YAAY,CAAC,QAAQ,EAAE,CAAC;YAE9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,gBAAgB,EAAE,CAAC;QACxD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE;YAC/D,MAAM,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;YACpD,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,eAAe,CAAC,UAAU,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;YAE7E,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAChC,MAAM,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QAC/D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC1B,YAAY,CAAC,EAAE,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;YAExC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,MAAM,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC;gBACnC,YAAY,EAAE,IAAI;gBAClB,cAAc,EAAE,KAAK;aACtB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;YAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YACzB,YAAY,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;YAErC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC;YAEpE,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAEnC,MAAM,CAAC,MAAM,CAAC,CAAC,oBAAoB,CAAC,MAAM,CAAC,gBAAgB,CAAC;gBAC1D,MAAM,EAAE,OAAO;gBACf,GAAG,EAAE,UAAU;gBACf,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;aAC7B,CAAC,CAAC,CAAC;QACN,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;YAC5C,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC1B,YAAY,CAAC,EAAE,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;YAEvC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE5C,MAAM,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;YAEtC,MAAM,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,MAAM,CAAC,gBAAgB,CAAC;gBAC3D,MAAM,EAAE,OAAO;gBACf,GAAG,EAAE,aAAa;gBAClB,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;aAC7B,CAAC,CAAC,CAAC;QACN,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC3B,YAAY,CAAC,EAAE,CAAC,aAAa,EAAE,QAAQ,CAAC,CAAC;YAEzC,eAAe,CAAC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACrD,MAAM,YAAY,CAAC,UAAU,EAAE,CAAC;YAEhC,eAAe,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC;YAEhE,MAAM,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAEnC,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC,MAAM,CAAC,gBAAgB,CAAC;gBAC5D,MAAM,EAAE,OAAO;gBACf,GAAG,EAAE,UAAU;gBACf,KAAK,EAAE,aAAa;aACrB,CAAC,CAAC,CAAC;QACN,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/cache/CacheManager.test.ts"],"sourcesContent":["/**\n * Unit tests for CacheManager\n */\n\nimport { CacheManager, CacheConfig } from '../../src/cache/CacheManager';\n\n// Mock redis module\nconst mockRedisClient = {\n  connect: jest.fn(),\n  disconnect: jest.fn(),\n  ping: jest.fn(),\n  get: jest.fn(),\n  set: jest.fn(),\n  setEx: jest.fn(),\n  del: jest.fn(),\n  flushDb: jest.fn(),\n  on: jest.fn()\n};\n\njest.mock('redis', () => ({\n  createClient: jest.fn().mockImplementation(() => mockRedisClient)\n}));\n\ndescribe('CacheManager', () => {\n  let cacheManager: CacheManager;\n\n  const testConfig: CacheConfig = {\n    redis: {\n      host: 'localhost',\n      port: 6379,\n      password: 'test-password',\n      db: 0,\n      connectTimeout: 10000,\n      commandTimeout: 5000\n    },\n    enableInMemoryFallback: true,\n    inMemoryMaxSize: 100,\n    inMemoryTtlMs: 60000,\n    healthCheckIntervalMs: 30000,\n    healthCheckTimeoutMs: 5000,\n    maxReconnectAttempts: 5,\n    reconnectDelayMs: 5000\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    cacheManager = new CacheManager(testConfig);\n    // Replace the internal Redis client with our mock after construction\n    (cacheManager as any).redisClient = mockRedisClient;\n    // Set initial state to simulate successful Redis connection\n    (cacheManager as any).metrics.redisConnected = true;\n    (cacheManager as any).metrics.fallbackActive = false;\n  });\n\n  afterEach(async () => {\n    if (cacheManager) {\n      await cacheManager.shutdown();\n    }\n  });\n\n  describe('createConfigFromEnv', () => {\n    const originalEnv = process.env;\n\n    beforeEach(() => {\n      process.env = { ...originalEnv };\n    });\n\n    afterEach(() => {\n      process.env = originalEnv;\n    });\n\n    it('should create config from REDIS_URL', () => {\n      process.env.REDIS_URL = 'redis://user:pass@host:6380/1';\n      \n      const config = CacheManager.createConfigFromEnv();\n      \n      expect(config.redis?.url).toBe('redis://user:pass@host:6380/1');\n    });\n\n    it('should create config from individual Redis environment variables', () => {\n      process.env.REDIS_HOST = 'test-host';\n      process.env.REDIS_PORT = '6380';\n      process.env.REDIS_PASSWORD = 'test-pass';\n      process.env.REDIS_DB = '2';\n      \n      const config = CacheManager.createConfigFromEnv();\n      \n      expect(config.redis?.host).toBe('test-host');\n      expect(config.redis?.port).toBe(6380);\n      expect(config.redis?.password).toBe('test-pass');\n      expect(config.redis?.db).toBe(2);\n    });\n\n    it('should handle missing Redis configuration', () => {\n      const config = CacheManager.createConfigFromEnv();\n      \n      expect(config.redis).toBeUndefined();\n      expect(config.enableInMemoryFallback).toBe(true);\n    });\n\n    it('should use default values for cache settings', () => {\n      const config = CacheManager.createConfigFromEnv();\n      \n      expect(config.inMemoryMaxSize).toBe(1000);\n      expect(config.inMemoryTtlMs).toBe(300000);\n      expect(config.enableInMemoryFallback).toBe(true);\n    });\n  });\n\n  describe('initialize', () => {\n    it('should initialize with Redis successfully', async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      \n      await cacheManager.initialize();\n      \n      expect(mockRedisClient.connect).toHaveBeenCalled();\n      expect(mockRedisClient.on).toHaveBeenCalledWith('connect', expect.any(Function));\n      expect(mockRedisClient.on).toHaveBeenCalledWith('error', expect.any(Function));\n    });\n\n    it('should initialize without Redis configuration', async () => {\n      const configWithoutRedis: CacheConfig = {\n        ...testConfig,\n        redis: undefined\n      };\n      \n      cacheManager = new CacheManager(configWithoutRedis);\n      \n      await cacheManager.initialize();\n      \n      expect(mockRedisClient.connect).not.toHaveBeenCalled();\n    });\n\n    it('should handle Redis connection failure and use fallback', async () => {\n      mockRedisClient.connect.mockRejectedValue(new Error('Connection failed'));\n      \n      await cacheManager.initialize();\n      \n      const status = cacheManager.getStatus();\n      expect(status.redisConnected).toBe(false);\n      expect(status.fallbackActive).toBe(true);\n    });\n  });\n\n  describe('get operations', () => {\n    beforeEach(async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      // Re-setup mock after initialize() overwrites it\n      (cacheManager as any).redisClient = mockRedisClient;\n      (cacheManager as any).metrics.redisConnected = true;\n      (cacheManager as any).metrics.fallbackActive = false;\n    });\n\n    it('should get value from Redis successfully', async () => {\n      const testValue = { id: 1, name: 'test' };\n      mockRedisClient.get.mockResolvedValue(JSON.stringify(testValue));\n      \n      const result = await cacheManager.get('test-key');\n      \n      expect(result.success).toBe(true);\n      expect(result.value).toEqual(testValue);\n      expect(result.source).toBe('redis');\n      expect(mockRedisClient.get).toHaveBeenCalledWith('test-key');\n    });\n\n    it('should return miss when key not found in Redis', async () => {\n      mockRedisClient.get.mockResolvedValue(null);\n      \n      const result = await cacheManager.get('missing-key');\n      \n      expect(result.success).toBe(false);\n      expect(result.source).toBe('redis');\n    });\n\n    it('should fallback to in-memory cache when Redis fails', async () => {\n      mockRedisClient.get.mockRejectedValue(new Error('Redis error'));\n      \n      // First set a value in memory cache by making Redis fail on set too\n      mockRedisClient.set.mockRejectedValue(new Error('Redis error'));\n      await cacheManager.set('test-key', 'test-value');\n      \n      const result = await cacheManager.get('test-key');\n      \n      expect(result.success).toBe(true);\n      expect(result.value).toBe('test-value');\n      expect(result.source).toBe('memory');\n    });\n\n    it('should return failure when both Redis and memory cache miss', async () => {\n      mockRedisClient.get.mockResolvedValue(null);\n      \n      const result = await cacheManager.get('missing-key');\n      \n      expect(result.success).toBe(false);\n    });\n  });\n\n  describe('set operations', () => {\n    beforeEach(async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      // Re-setup mock after initialize() overwrites it\n      (cacheManager as any).redisClient = mockRedisClient;\n      (cacheManager as any).metrics.redisConnected = true;\n      (cacheManager as any).metrics.fallbackActive = false;\n    });\n\n    it('should set value in Redis successfully', async () => {\n      const testValue = { id: 1, name: 'test' };\n      mockRedisClient.set.mockResolvedValue('OK');\n      \n      const result = await cacheManager.set('test-key', testValue);\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('redis');\n      expect(mockRedisClient.set).toHaveBeenCalledWith('test-key', JSON.stringify(testValue));\n    });\n\n    it('should set value with TTL in Redis', async () => {\n      const testValue = 'test-value';\n      mockRedisClient.setEx.mockResolvedValue('OK');\n      \n      console.log('Before set call - Redis connected:', (cacheManager as any).metrics.redisConnected);\n      console.log('Before set call - Redis client exists:', !!(cacheManager as any).redisClient);\n      \n      const result = await cacheManager.set('test-key', testValue, 300);\n      \n      console.log('After set call - result:', result);\n      console.log('setEx calls:', mockRedisClient.setEx.mock.calls);\n      console.log('set calls:', mockRedisClient.set.mock.calls);\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('redis');\n      expect(mockRedisClient.setEx).toHaveBeenCalledWith('test-key', 300, JSON.stringify(testValue));\n    });\n\n    it('should fallback to in-memory cache when Redis fails', async () => {\n      mockRedisClient.set.mockRejectedValue(new Error('Redis error'));\n      \n      const result = await cacheManager.set('test-key', 'test-value');\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('memory');\n    });\n\n    it('should handle case when both Redis and memory cache are disabled', async () => {\n      const configWithoutFallback: CacheConfig = {\n        ...testConfig,\n        redis: undefined,\n        enableInMemoryFallback: false\n      };\n      \n      cacheManager = new CacheManager(configWithoutFallback);\n      await cacheManager.initialize();\n      \n      const result = await cacheManager.set('test-key', 'test-value');\n      \n      expect(result.success).toBe(false);\n      expect(result.source).toBe('none');\n      expect(result.error).toBe('No cache backend available');\n    });\n  });\n\n  describe('delete operations', () => {\n    beforeEach(async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      // Re-setup mock after initialize() overwrites it\n      (cacheManager as any).redisClient = mockRedisClient;\n      (cacheManager as any).metrics.redisConnected = true;\n      (cacheManager as any).metrics.fallbackActive = false;\n    });\n\n    it('should delete value from Redis successfully', async () => {\n      mockRedisClient.del.mockResolvedValue(1);\n      \n      const result = await cacheManager.delete('test-key');\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('redis');\n      expect(mockRedisClient.del).toHaveBeenCalledWith('test-key');\n    });\n\n    it('should delete from both Redis and memory cache', async () => {\n      mockRedisClient.del.mockResolvedValue(1);\n      \n      // Set value in memory cache first by making Redis fail on set\n      mockRedisClient.set.mockRejectedValue(new Error('Redis error'));\n      await cacheManager.set('test-key', 'test-value');\n      \n      // Now make Redis work for delete\n      const result = await cacheManager.delete('test-key');\n      \n      expect(result.success).toBe(true);\n      expect(mockRedisClient.del).toHaveBeenCalledWith('test-key');\n    });\n\n    it('should handle Redis delete failure but succeed with memory', async () => {\n      mockRedisClient.del.mockRejectedValue(new Error('Redis error'));\n      \n      // Set value in memory cache first by making Redis fail on set\n      mockRedisClient.set.mockRejectedValue(new Error('Redis error'));\n      await cacheManager.set('test-key', 'test-value');\n      \n      const result = await cacheManager.delete('test-key');\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('memory');\n    });\n  });\n\n  describe('clear operations', () => {\n    beforeEach(async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      // Re-setup mock after initialize() overwrites it\n      (cacheManager as any).redisClient = mockRedisClient;\n      (cacheManager as any).metrics.redisConnected = true;\n      (cacheManager as any).metrics.fallbackActive = false;\n    });\n\n    it('should clear Redis successfully', async () => {\n      mockRedisClient.flushDb.mockResolvedValue('OK');\n      \n      const result = await cacheManager.clear();\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('redis');\n      expect(mockRedisClient.flushDb).toHaveBeenCalled();\n    });\n\n    it('should clear both Redis and memory cache', async () => {\n      mockRedisClient.flushDb.mockResolvedValue('OK');\n      \n      const result = await cacheManager.clear();\n      \n      expect(result.success).toBe(true);\n      expect(mockRedisClient.flushDb).toHaveBeenCalled();\n    });\n\n    it('should handle Redis clear failure but succeed with memory', async () => {\n      mockRedisClient.flushDb.mockRejectedValue(new Error('Redis error'));\n      \n      const result = await cacheManager.clear();\n      \n      expect(result.success).toBe(true);\n      expect(result.source).toBe('memory');\n    });\n  });\n\n  describe('health monitoring', () => {\n    beforeEach(async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      // Re-setup mock after initialize() overwrites it\n      (cacheManager as any).redisClient = mockRedisClient;\n      (cacheManager as any).metrics.redisConnected = true;\n      (cacheManager as any).metrics.fallbackActive = false;\n    });\n\n    it('should report healthy status when Redis is connected', () => {\n      expect(cacheManager.isHealthy()).toBe(true);\n    });\n\n    it('should provide cache status', () => {\n      const status = cacheManager.getStatus();\n      \n      expect(status.redisConnected).toBe(true);\n      expect(status.fallbackActive).toBe(false);\n      expect(status.totalOperations).toBeGreaterThanOrEqual(0);\n      expect(status.hitRate).toBeGreaterThanOrEqual(0);\n      expect(status.averageResponseTime).toBeGreaterThanOrEqual(0);\n    });\n\n    it('should provide cache metrics', () => {\n      const metrics = cacheManager.getMetrics();\n      \n      expect(metrics.redisConnected).toBe(true);\n      expect(metrics.fallbackActive).toBe(false);\n      expect(metrics.totalOperations).toBeGreaterThanOrEqual(0);\n      expect(metrics.redisHits).toBeGreaterThanOrEqual(0);\n      expect(metrics.redisMisses).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('shutdown', () => {\n    it('should shutdown gracefully', async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      mockRedisClient.disconnect.mockResolvedValue(undefined);\n      \n      await cacheManager.initialize();\n      await cacheManager.shutdown();\n      \n      expect(mockRedisClient.disconnect).toHaveBeenCalled();\n    });\n\n    it('should handle shutdown when Redis not connected', async () => {\n      await expect(cacheManager.shutdown()).resolves.not.toThrow();\n    });\n\n    it('should handle Redis disconnect error', async () => {\n      mockRedisClient.connect.mockResolvedValue(undefined);\n      mockRedisClient.disconnect.mockRejectedValue(new Error('Disconnect failed'));\n      \n      await cacheManager.initialize();\n      await expect(cacheManager.shutdown()).resolves.not.toThrow();\n    });\n  });\n\n  describe('event emission', () => {\n    it('should emit initialized event', async () => {\n      const initSpy = jest.fn();\n      cacheManager.on('initialized', initSpy);\n      \n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      \n      expect(initSpy).toHaveBeenCalledWith({\n        redisEnabled: true,\n        fallbackActive: false\n      });\n    });\n\n    it('should emit cache hit event', async () => {\n      const hitSpy = jest.fn();\n      cacheManager.on('cache:hit', hitSpy);\n      \n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      \n      mockRedisClient.get.mockResolvedValue(JSON.stringify('test-value'));\n      \n      await cacheManager.get('test-key');\n      \n      expect(hitSpy).toHaveBeenCalledWith(expect.objectContaining({\n        source: 'redis',\n        key: 'test-key',\n        duration: expect.any(Number)\n      }));\n    });\n\n    it('should emit cache miss event', async () => {\n      const missSpy = jest.fn();\n      cacheManager.on('cache:miss', missSpy);\n      \n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      \n      mockRedisClient.get.mockResolvedValue(null);\n      \n      await cacheManager.get('missing-key');\n      \n      expect(missSpy).toHaveBeenCalledWith(expect.objectContaining({\n        source: 'redis',\n        key: 'missing-key',\n        duration: expect.any(Number)\n      }));\n    });\n\n    it('should emit cache error event', async () => {\n      const errorSpy = jest.fn();\n      cacheManager.on('cache:error', errorSpy);\n      \n      mockRedisClient.connect.mockResolvedValue(undefined);\n      await cacheManager.initialize();\n      \n      mockRedisClient.get.mockRejectedValue(new Error('Redis error'));\n      \n      await cacheManager.get('test-key');\n      \n      expect(errorSpy).toHaveBeenCalledWith(expect.objectContaining({\n        source: 'redis',\n        key: 'test-key',\n        error: 'Redis error'\n      }));\n    });\n  });\n});"],"version":3}