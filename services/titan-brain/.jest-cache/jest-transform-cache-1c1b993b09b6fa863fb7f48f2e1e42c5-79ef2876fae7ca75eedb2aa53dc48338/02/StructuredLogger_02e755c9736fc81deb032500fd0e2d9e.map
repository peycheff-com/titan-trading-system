{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/monitoring/StructuredLogger.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/monitoring/StructuredLogger.ts"],"sourcesContent":["/**\n * StructuredLogger - JSON structured logging with correlation IDs\n * \n * Implements JSON structured logging, correlation IDs, log level configuration,\n * and sensitive data sanitization.\n * \n * Requirements: 2.7, 4.7, 5.7, 9.6\n */\n\nimport { randomUUID } from 'crypto';\n\n/**\n * Log levels in order of severity\n */\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\n/**\n * Log level numeric values for comparison\n */\nconst LOG_LEVEL_VALUES: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\n/**\n * Sensitive field patterns to sanitize\n */\nconst SENSITIVE_PATTERNS = [\n  /api[_-]?key/i,\n  /api[_-]?secret/i,\n  /password/i,\n  /secret/i,\n  /token/i,\n  /auth/i,\n  /credential/i,\n  /private[_-]?key/i,\n  /access[_-]?key/i,\n];\n\n/**\n * Log entry structure\n */\nexport interface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  message: string;\n  correlationId?: string;\n  component?: string;\n  context?: Record<string, unknown>;\n  error?: {\n    name: string;\n    message: string;\n    stack?: string;\n  };\n}\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  level: LogLevel;\n  component?: string;\n  enableConsole?: boolean;\n  enableJson?: boolean;\n  sanitizeSensitive?: boolean;\n  correlationIdHeader?: string;\n}\n\n/**\n * Log output handler\n */\nexport type LogHandler = (entry: LogEntry) => void;\n\n/**\n * StructuredLogger class for JSON logging with correlation IDs\n */\nexport class StructuredLogger {\n  private readonly config: Required<LoggerConfig>;\n  private correlationId: string | null = null;\n  private handlers: LogHandler[] = [];\n\n  constructor(config: Partial<LoggerConfig> = {}) {\n    this.config = {\n      level: config.level ?? 'info',\n      component: config.component ?? 'titan-brain',\n      enableConsole: config.enableConsole ?? true,\n      enableJson: config.enableJson ?? true,\n      sanitizeSensitive: config.sanitizeSensitive ?? true,\n      correlationIdHeader: config.correlationIdHeader ?? 'x-correlation-id',\n    };\n  }\n\n  /**\n   * Set the current correlation ID\n   */\n  setCorrelationId(id: string | null): void {\n    this.correlationId = id;\n  }\n\n  /**\n   * Get the current correlation ID\n   */\n  getCorrelationId(): string | null {\n    return this.correlationId;\n  }\n\n  /**\n   * Generate a new correlation ID\n   */\n  generateCorrelationId(): string {\n    const id = randomUUID();\n    this.correlationId = id;\n    return id;\n  }\n\n  /**\n   * Set the log level\n   */\n  setLevel(level: LogLevel): void {\n    this.config.level = level;\n  }\n\n  /**\n   * Get the current log level\n   */\n  getLevel(): LogLevel {\n    return this.config.level;\n  }\n\n  /**\n   * Add a custom log handler\n   */\n  addHandler(handler: LogHandler): void {\n    this.handlers.push(handler);\n  }\n\n  /**\n   * Remove a custom log handler\n   */\n  removeHandler(handler: LogHandler): void {\n    const index = this.handlers.indexOf(handler);\n    if (index !== -1) {\n      this.handlers.splice(index, 1);\n    }\n  }\n\n  /**\n   * Check if a log level should be logged\n   */\n  private shouldLog(level: LogLevel): boolean {\n    return LOG_LEVEL_VALUES[level] >= LOG_LEVEL_VALUES[this.config.level];\n  }\n\n  /**\n   * Sanitize sensitive data from an object\n   * Requirement: Add sensitive data sanitization\n   */\n  private sanitize(obj: unknown): unknown {\n    if (!this.config.sanitizeSensitive) return obj;\n    \n    if (obj === null || obj === undefined) return obj;\n    \n    if (typeof obj === 'string') {\n      // Check if the string looks like a sensitive value (long alphanumeric)\n      if (obj.length > 20 && /^[A-Za-z0-9+/=_-]+$/.test(obj)) {\n        return '[REDACTED]';\n      }\n      return obj;\n    }\n    \n    if (Array.isArray(obj)) {\n      return obj.map(item => this.sanitize(item));\n    }\n    \n    if (typeof obj === 'object') {\n      const sanitized: Record<string, unknown> = {};\n      for (const [key, value] of Object.entries(obj as Record<string, unknown>)) {\n        // Check if key matches sensitive patterns\n        const isSensitive = SENSITIVE_PATTERNS.some(pattern => pattern.test(key));\n        if (isSensitive) {\n          sanitized[key] = '[REDACTED]';\n        } else {\n          sanitized[key] = this.sanitize(value);\n        }\n      }\n      return sanitized;\n    }\n    \n    return obj;\n  }\n\n  /**\n   * Create a log entry\n   */\n  private createEntry(\n    level: LogLevel,\n    message: string,\n    context?: Record<string, unknown>,\n    error?: Error\n  ): LogEntry {\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      message,\n      component: this.config.component,\n    };\n\n    if (this.correlationId) {\n      entry.correlationId = this.correlationId;\n    }\n\n    if (context) {\n      entry.context = this.sanitize(context) as Record<string, unknown>;\n    }\n\n    if (error) {\n      entry.error = {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      };\n    }\n\n    return entry;\n  }\n\n  /**\n   * Output a log entry\n   */\n  private output(entry: LogEntry): void {\n    // Call custom handlers\n    for (const handler of this.handlers) {\n      try {\n        handler(entry);\n      } catch (e) {\n        // Ignore handler errors\n      }\n    }\n\n    // Console output\n    if (this.config.enableConsole) {\n      if (this.config.enableJson) {\n        console.log(JSON.stringify(entry));\n      } else {\n        const prefix = entry.correlationId ? `[${entry.correlationId.slice(0, 8)}]` : '';\n        const component = entry.component ? `[${entry.component}]` : '';\n        const contextStr = entry.context ? ` ${JSON.stringify(entry.context)}` : '';\n        const errorStr = entry.error ? ` Error: ${entry.error.message}` : '';\n        \n        const logFn = entry.level === 'error' ? console.error :\n                      entry.level === 'warn' ? console.warn :\n                      entry.level === 'debug' ? console.debug :\n                      console.log;\n        \n        logFn(`${entry.timestamp} ${entry.level.toUpperCase()} ${prefix}${component} ${entry.message}${contextStr}${errorStr}`);\n      }\n    }\n  }\n\n\n  /**\n   * Log a debug message\n   */\n  debug(message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog('debug')) return;\n    const entry = this.createEntry('debug', message, context);\n    this.output(entry);\n  }\n\n  /**\n   * Log an info message\n   */\n  info(message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog('info')) return;\n    const entry = this.createEntry('info', message, context);\n    this.output(entry);\n  }\n\n  /**\n   * Log a warning message\n   */\n  warn(message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog('warn')) return;\n    const entry = this.createEntry('warn', message, context);\n    this.output(entry);\n  }\n\n  /**\n   * Log an error message\n   */\n  error(message: string, error?: Error | unknown, context?: Record<string, unknown>): void {\n    if (!this.shouldLog('error')) return;\n    \n    const err = error instanceof Error ? error : undefined;\n    const ctx = error instanceof Error ? context : (error as Record<string, unknown> | undefined);\n    \n    const entry = this.createEntry('error', message, ctx, err);\n    this.output(entry);\n  }\n\n  // ============ Domain-Specific Logging Methods ============\n\n  /**\n   * Log a signal processing event\n   * Requirement 2.7: Log all weight adjustments with reasoning\n   */\n  logSignalProcessing(\n    signalId: string,\n    phaseId: string,\n    approved: boolean,\n    reason: string,\n    context?: Record<string, unknown>\n  ): void {\n    this.info('Signal processed', {\n      signalId,\n      phaseId,\n      approved,\n      reason,\n      ...context,\n    });\n  }\n\n  /**\n   * Log an allocation change\n   * Requirement 9.6: Maintain audit log of all allocation changes\n   */\n  logAllocationChange(\n    previousAllocation: { w1: number; w2: number; w3: number },\n    newAllocation: { w1: number; w2: number; w3: number },\n    reason: string,\n    context?: Record<string, unknown>\n  ): void {\n    this.info('Allocation changed', {\n      previousAllocation,\n      newAllocation,\n      reason,\n      ...context,\n    });\n  }\n\n  /**\n   * Log a sweep operation\n   * Requirement 4.7: Log all sweep transactions with amount and reason\n   */\n  logSweepOperation(\n    amount: number,\n    fromWallet: string,\n    toWallet: string,\n    reason: string,\n    success: boolean,\n    context?: Record<string, unknown>\n  ): void {\n    const level = success ? 'info' : 'warn';\n    const entry = this.createEntry(level, 'Sweep operation', {\n      amount,\n      fromWallet,\n      toWallet,\n      reason,\n      success,\n      ...context,\n    });\n    this.output(entry);\n  }\n\n  /**\n   * Log a circuit breaker event\n   * Requirement 5.7: Log circuit breaker events with full context\n   */\n  logCircuitBreakerEvent(\n    eventType: 'TRIGGER' | 'RESET',\n    reason: string,\n    equity: number,\n    operatorId?: string,\n    context?: Record<string, unknown>\n  ): void {\n    const level = eventType === 'TRIGGER' ? 'error' : 'info';\n    const entry = this.createEntry(level, `Circuit breaker ${eventType.toLowerCase()}`, {\n      eventType,\n      reason,\n      equity,\n      operatorId,\n      ...context,\n    });\n    this.output(entry);\n  }\n\n  /**\n   * Log a performance update\n   * Requirement 2.7: Log weight adjustments with reasoning\n   */\n  logPerformanceUpdate(\n    phaseId: string,\n    sharpeRatio: number,\n    modifier: number,\n    tradeCount: number,\n    context?: Record<string, unknown>\n  ): void {\n    this.debug('Performance updated', {\n      phaseId,\n      sharpeRatio,\n      modifier,\n      tradeCount,\n      ...context,\n    });\n  }\n\n  /**\n   * Log a risk decision\n   */\n  logRiskDecision(\n    signalId: string,\n    approved: boolean,\n    reason: string,\n    riskMetrics: Record<string, unknown>,\n    context?: Record<string, unknown>\n  ): void {\n    this.info('Risk decision', {\n      signalId,\n      approved,\n      reason,\n      riskMetrics,\n      ...context,\n    });\n  }\n\n  /**\n   * Log a database operation\n   */\n  logDatabaseOperation(\n    operation: string,\n    table: string,\n    durationMs: number,\n    success: boolean,\n    context?: Record<string, unknown>\n  ): void {\n    const level = success ? 'debug' : 'warn';\n    const entry = this.createEntry(level, 'Database operation', {\n      operation,\n      table,\n      durationMs,\n      success,\n      ...context,\n    });\n    this.output(entry);\n  }\n\n  /**\n   * Log a manual override event\n   * Requirement 9.6: Audit log for allocation changes\n   */\n  logManualOverride(\n    operatorId: string,\n    action: 'CREATE' | 'DEACTIVATE',\n    allocation?: { w1: number; w2: number; w3: number },\n    reason?: string,\n    context?: Record<string, unknown>\n  ): void {\n    this.warn('Manual override', {\n      operatorId,\n      action,\n      allocation,\n      reason,\n      ...context,\n    });\n  }\n\n  /**\n   * Log a notification event\n   */\n  logNotification(\n    channel: string,\n    type: string,\n    success: boolean,\n    context?: Record<string, unknown>\n  ): void {\n    const level = success ? 'info' : 'warn';\n    const entry = this.createEntry(level, 'Notification sent', {\n      channel,\n      type,\n      success,\n      ...context,\n    });\n    this.output(entry);\n  }\n\n  /**\n   * Create a child logger with additional context\n   */\n  child(context: Record<string, unknown>): StructuredLogger {\n    const child = new StructuredLogger(this.config);\n    child.correlationId = this.correlationId;\n    \n    // Wrap the output to include additional context\n    const originalOutput = child['output'].bind(child);\n    child['output'] = (entry: LogEntry) => {\n      entry.context = { ...context, ...entry.context };\n      originalOutput(entry);\n    };\n    \n    return child;\n  }\n\n  /**\n   * Execute a function with a correlation ID\n   */\n  async withCorrelationId<T>(\n    correlationId: string | null,\n    fn: () => Promise<T>\n  ): Promise<T> {\n    const previousId = this.correlationId;\n    this.correlationId = correlationId ?? this.generateCorrelationId();\n    \n    try {\n      return await fn();\n    } finally {\n      this.correlationId = previousId;\n    }\n  }\n}\n\n/**\n * Singleton instance for global logging\n */\nlet loggerInstance: StructuredLogger | null = null;\n\n/**\n * Get or create the global logger instance\n */\nexport function getLogger(config?: Partial<LoggerConfig>): StructuredLogger {\n  if (!loggerInstance) {\n    loggerInstance = new StructuredLogger(config);\n  }\n  return loggerInstance;\n}\n\n/**\n * Reset the global logger instance (for testing)\n */\nexport function resetLogger(): void {\n  loggerInstance = null;\n}\n\n/**\n * Create a request-scoped logger with correlation ID\n */\nexport function createRequestLogger(\n  correlationId?: string,\n  config?: Partial<LoggerConfig>\n): StructuredLogger {\n  const logger = new StructuredLogger(config);\n  logger.setCorrelationId(correlationId ?? logger.generateCorrelationId());\n  return logger;\n}\n"],"version":3}