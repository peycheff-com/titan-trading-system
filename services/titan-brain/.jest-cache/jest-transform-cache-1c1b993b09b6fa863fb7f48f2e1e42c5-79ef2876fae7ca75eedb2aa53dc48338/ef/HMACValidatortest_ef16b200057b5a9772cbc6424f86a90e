1d99e45275b3d1db885177544dbb8d2d
"use strict";
/**
 * Unit tests for HMACValidator
 */
Object.defineProperty(exports, "__esModule", { value: true });
const HMACValidator_1 = require("../../src/security/HMACValidator");
describe('HMACValidator', () => {
    let validator;
    const testSecret = 'test-secret-key-that-is-32-chars-long';
    beforeEach(() => {
        validator = new HMACValidator_1.HMACValidator({
            secret: testSecret,
            algorithm: 'sha256',
            maxAge: 300,
            clockSkewTolerance: 60,
            signatureHeader: 'x-signature',
            timestampHeader: 'x-timestamp',
            signaturePrefix: 'sha256='
        });
    });
    describe('constructor', () => {
        it('should initialize with correct configuration', () => {
            const config = validator.getConfig();
            expect(config.algorithm).toBe('sha256');
            expect(config.maxAge).toBe(300);
            expect(config.secretLength).toBe(testSecret.length);
        });
        it('should throw error for missing secret', () => {
            expect(() => new HMACValidator_1.HMACValidator({
                secret: '',
                algorithm: 'sha256',
                maxAge: 300,
                clockSkewTolerance: 60,
                signatureHeader: 'x-signature',
                timestampHeader: 'x-timestamp',
                signaturePrefix: 'sha256='
            })).toThrow('HMAC secret is required');
        });
    });
    describe('generateSignature', () => {
        it('should generate valid signature with timestamp', () => {
            const body = 'test body';
            const timestamp = Math.floor(Date.now() / 1000);
            const result = validator.generateSignature(body, timestamp);
            expect(result.signature).toMatch(/^sha256=[a-f0-9]{64}$/);
            expect(result.timestamp).toBe(timestamp);
            expect(result.headers['x-signature']).toBe(result.signature);
            expect(result.headers['x-timestamp']).toBe(timestamp.toString());
        });
        it('should generate signature with current timestamp if not provided', () => {
            const body = 'test body';
            const beforeTime = Math.floor(Date.now() / 1000);
            const result = validator.generateSignature(body);
            const afterTime = Math.floor(Date.now() / 1000);
            expect(result.timestamp).toBeGreaterThanOrEqual(beforeTime);
            expect(result.timestamp).toBeLessThanOrEqual(afterTime);
        });
        it('should handle Buffer body', () => {
            const body = Buffer.from('test body', 'utf8');
            const result = validator.generateSignature(body);
            expect(result.signature).toMatch(/^sha256=[a-f0-9]{64}$/);
        });
    });
    describe('validateRequest', () => {
        it('should validate correct signature', () => {
            const body = 'test body';
            const { signature, timestamp, headers } = validator.generateSignature(body);
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(true);
            expect(result.computedSignature).toBe(signature);
            expect(result.providedSignature).toBe(signature);
            expect(result.timestamp).toBe(timestamp);
        });
        it('should reject missing signature header', () => {
            const body = 'test body';
            const headers = { 'x-timestamp': Math.floor(Date.now() / 1000).toString() };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Missing x-signature header');
        });
        it('should reject missing timestamp header', () => {
            const body = 'test body';
            const headers = { 'x-signature': 'sha256=abcd1234' };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Missing x-timestamp header');
        });
        it('should reject invalid timestamp format', () => {
            const body = 'test body';
            const headers = {
                'x-signature': 'sha256=abcd1234',
                'x-timestamp': 'invalid-timestamp'
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toBe('Invalid timestamp format');
        });
        it('should reject old requests', () => {
            const body = 'test body';
            const oldTimestamp = Math.floor(Date.now() / 1000) - 400; // 400 seconds ago
            const { signature } = validator.generateSignature(body, oldTimestamp);
            const headers = {
                'x-signature': signature,
                'x-timestamp': oldTimestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Request too old');
        });
        it('should reject future requests beyond tolerance', () => {
            const body = 'test body';
            const futureTimestamp = Math.floor(Date.now() / 1000) + 120; // 2 minutes in future
            const { signature } = validator.generateSignature(body, futureTimestamp);
            const headers = {
                'x-signature': signature,
                'x-timestamp': futureTimestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Request from future');
        });
        it('should accept requests within clock skew tolerance', () => {
            const body = 'test body';
            const futureTimestamp = Math.floor(Date.now() / 1000) + 30; // 30 seconds in future (within tolerance)
            const { signature } = validator.generateSignature(body, futureTimestamp);
            const headers = {
                'x-signature': signature,
                'x-timestamp': futureTimestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(true);
        });
        it('should reject invalid signature', () => {
            const body = 'test body';
            const timestamp = Math.floor(Date.now() / 1000);
            const headers = {
                'x-signature': 'sha256=invalid-signature',
                'x-timestamp': timestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(false);
            expect(result.error).toBe('Invalid signature');
        });
        it('should handle signature without prefix', () => {
            const body = 'test body';
            const { signature, timestamp } = validator.generateSignature(body);
            const signatureWithoutPrefix = signature.replace('sha256=', '');
            const headers = {
                'x-signature': signatureWithoutPrefix,
                'x-timestamp': timestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(true);
        });
        it('should be case-insensitive for headers', () => {
            const body = 'test body';
            const { signature, timestamp } = validator.generateSignature(body);
            const headers = {
                'X-Signature': signature,
                'X-Timestamp': timestamp.toString()
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(true);
        });
        it('should handle array header values', () => {
            const body = 'test body';
            const { signature, timestamp } = validator.generateSignature(body);
            const headers = {
                'x-signature': [signature, 'other-value'],
                'x-timestamp': [timestamp.toString()]
            };
            const result = validator.validateRequest(body, headers);
            expect(result.valid).toBe(true);
        });
    });
    describe('validateConfig', () => {
        it('should validate and return complete configuration', () => {
            const config = HMACValidator_1.HMACValidator.validateConfig({
                secret: testSecret,
                algorithm: 'sha256'
            });
            expect(config.secret).toBe(testSecret);
            expect(config.algorithm).toBe('sha256');
            expect(config.maxAge).toBe(300); // default
            expect(config.clockSkewTolerance).toBe(60); // default
        });
        it('should throw error for missing secret', () => {
            expect(() => HMACValidator_1.HMACValidator.validateConfig({})).toThrow('HMAC secret is required');
        });
        it('should throw error for short secret', () => {
            expect(() => HMACValidator_1.HMACValidator.validateConfig({
                secret: 'short'
            })).toThrow('HMAC secret must be at least 32 characters long');
        });
    });
    describe('fromEnvironment', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create validator from environment variables', () => {
            process.env.HMAC_SECRET = testSecret;
            process.env.HMAC_ALGORITHM = 'sha512';
            process.env.HMAC_MAX_AGE = '600';
            const validator = HMACValidator_1.HMACValidator.fromEnvironment();
            const config = validator.getConfig();
            expect(config.algorithm).toBe('sha512');
            expect(config.maxAge).toBe(600);
        });
        it('should use WEBHOOK_SECRET as fallback', () => {
            process.env.WEBHOOK_SECRET = testSecret;
            const validator = HMACValidator_1.HMACValidator.fromEnvironment();
            expect(validator).toBeDefined();
        });
        it('should throw error if no secret in environment', () => {
            delete process.env.HMAC_SECRET;
            delete process.env.WEBHOOK_SECRET;
            expect(() => HMACValidator_1.HMACValidator.fromEnvironment()).toThrow('HMAC secret is required');
        });
    });
    describe('timing attack protection', () => {
        it('should use constant-time comparison', () => {
            const body = 'test body';
            const { signature, timestamp } = validator.generateSignature(body);
            // Test with correct signature
            const validHeaders = {
                'x-signature': signature,
                'x-timestamp': timestamp.toString()
            };
            const validResult = validator.validateRequest(body, validHeaders);
            expect(validResult.valid).toBe(true);
            // Test with incorrect signature of same length
            const wrongSignature = signature.replace('a', 'b');
            const invalidHeaders = {
                'x-signature': wrongSignature,
                'x-timestamp': timestamp.toString()
            };
            const invalidResult = validator.validateRequest(body, invalidHeaders);
            expect(invalidResult.valid).toBe(false);
        });
    });
});
describe('createHMACMiddleware', () => {
    let validator;
    let middleware;
    let mockReq;
    let mockRes;
    let mockNext;
    beforeEach(() => {
        validator = new HMACValidator_1.HMACValidator({
            secret: 'test-secret-key-that-is-32-chars-long',
            algorithm: 'sha256',
            maxAge: 300,
            clockSkewTolerance: 60,
            signatureHeader: 'x-signature',
            timestampHeader: 'x-timestamp',
            signaturePrefix: 'sha256='
        });
        middleware = (0, HMACValidator_1.createHMACMiddleware)(validator);
        mockNext = jest.fn();
        mockRes = {
            status: jest.fn().mockReturnThis(),
            json: jest.fn()
        };
    });
    it('should skip validation for health endpoint', () => {
        mockReq = { path: '/health' };
        middleware(mockReq, mockRes, mockNext);
        expect(mockNext).toHaveBeenCalled();
        expect(mockRes.status).not.toHaveBeenCalled();
    });
    it('should skip validation for metrics endpoint', () => {
        mockReq = { path: '/metrics' };
        middleware(mockReq, mockRes, mockNext);
        expect(mockNext).toHaveBeenCalled();
        expect(mockRes.status).not.toHaveBeenCalled();
    });
    it('should validate HMAC for other endpoints', () => {
        const body = 'test body';
        const { signature, timestamp } = validator.generateSignature(body);
        mockReq = {
            path: '/api/test',
            rawBody: body,
            headers: {
                'x-signature': signature,
                'x-timestamp': timestamp.toString()
            }
        };
        middleware(mockReq, mockRes, mockNext);
        expect(mockNext).toHaveBeenCalled();
        expect(mockReq.hmacValidation).toBeDefined();
        expect(mockReq.hmacValidation.valid).toBe(true);
    });
    it('should reject invalid HMAC', () => {
        mockReq = {
            path: '/api/test',
            rawBody: 'test body',
            headers: {
                'x-signature': 'invalid-signature',
                'x-timestamp': Math.floor(Date.now() / 1000).toString()
            }
        };
        middleware(mockReq, mockRes, mockNext);
        expect(mockRes.status).toHaveBeenCalledWith(401);
        expect(mockRes.json).toHaveBeenCalledWith(expect.objectContaining({
            error: 'Unauthorized'
        }));
        expect(mockNext).not.toHaveBeenCalled();
    });
});
describe('HMACDefaults', () => {
    it('should provide sensible default configuration', () => {
        expect(HMACValidator_1.HMACDefaults.algorithm).toBe('sha256');
        expect(HMACValidator_1.HMACDefaults.maxAge).toBe(300);
        expect(HMACValidator_1.HMACDefaults.clockSkewTolerance).toBe(60);
        expect(HMACValidator_1.HMACDefaults.signatureHeader).toBe('x-signature');
        expect(HMACValidator_1.HMACDefaults.timestampHeader).toBe('x-timestamp');
        expect(HMACValidator_1.HMACDefaults.signaturePrefix).toBe('sha256=');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3NlY3VyaXR5L0hNQUNWYWxpZGF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsb0VBQXFHO0FBR3JHLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksU0FBd0IsQ0FBQztJQUM3QixNQUFNLFVBQVUsR0FBRyx1Q0FBdUMsQ0FBQztJQUUzRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsU0FBUyxHQUFHLElBQUksNkJBQWEsQ0FBQztZQUM1QixNQUFNLEVBQUUsVUFBVTtZQUNsQixTQUFTLEVBQUUsUUFBUTtZQUNuQixNQUFNLEVBQUUsR0FBRztZQUNYLGtCQUFrQixFQUFFLEVBQUU7WUFDdEIsZUFBZSxFQUFFLGFBQWE7WUFDOUIsZUFBZSxFQUFFLGFBQWE7WUFDOUIsZUFBZSxFQUFFLFNBQVM7U0FDM0IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMsOENBQThDLEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNyQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1lBQy9DLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLDZCQUFhLENBQUM7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QUM5QyxNQUFNLENBQUMsNEJBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsTUFBTSxDQUFDLDRCQUFZLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLDRCQUFZLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sQ0FBQyw0QkFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUN6RCxNQUFNLENBQUMsNEJBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvc2VjdXJpdHkvSE1BQ1ZhbGlkYXRvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCB0ZXN0cyBmb3IgSE1BQ1ZhbGlkYXRvclxuICovXG5cbmltcG9ydCB7IEhNQUNWYWxpZGF0b3IsIEhNQUNEZWZhdWx0cywgY3JlYXRlSE1BQ01pZGRsZXdhcmUgfSBmcm9tICcuLi8uLi9zcmMvc2VjdXJpdHkvSE1BQ1ZhbGlkYXRvcic7XG5pbXBvcnQgKiBhcyBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuZGVzY3JpYmUoJ0hNQUNWYWxpZGF0b3InLCAoKSA9PiB7XG4gIGxldCB2YWxpZGF0b3I6IEhNQUNWYWxpZGF0b3I7XG4gIGNvbnN0IHRlc3RTZWNyZXQgPSAndGVzdC1zZWNyZXQta2V5LXRoYXQtaXMtMzItY2hhcnMtbG9uZyc7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgdmFsaWRhdG9yID0gbmV3IEhNQUNWYWxpZGF0b3Ioe1xuICAgICAgc2VjcmV0OiB0ZXN0U2VjcmV0LFxuICAgICAgYWxnb3JpdGhtOiAnc2hhMjU2JyxcbiAgICAgIG1heEFnZTogMzAwLFxuICAgICAgY2xvY2tTa2V3VG9sZXJhbmNlOiA2MCxcbiAgICAgIHNpZ25hdHVyZUhlYWRlcjogJ3gtc2lnbmF0dXJlJyxcbiAgICAgIHRpbWVzdGFtcEhlYWRlcjogJ3gtdGltZXN0YW1wJyxcbiAgICAgIHNpZ25hdHVyZVByZWZpeDogJ3NoYTI1Nj0nXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBjb3JyZWN0IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB2YWxpZGF0b3IuZ2V0Q29uZmlnKCk7XG4gICAgICBleHBlY3QoY29uZmlnLmFsZ29yaXRobSkudG9CZSgnc2hhMjU2Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLm1heEFnZSkudG9CZSgzMDApO1xuICAgICAgZXhwZWN0KGNvbmZpZy5zZWNyZXRMZW5ndGgpLnRvQmUodGVzdFNlY3JldC5sZW5ndGgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgbWlzc2luZyBzZWNyZXQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gbmV3IEhNQUNWYWxpZGF0b3Ioe1xuICAgICAgICBzZWNyZXQ6ICcnLFxuICAgICAgICBhbGdvcml0aG06ICdzaGEyNTYnLFxuICAgICAgICBtYXhBZ2U6IDMwMCxcbiAgICAgICAgY2xvY2tTa2V3VG9sZXJhbmNlOiA2MCxcbiAgICAgICAgc2lnbmF0dXJlSGVhZGVyOiAneC1zaWduYXR1cmUnLFxuICAgICAgICB0aW1lc3RhbXBIZWFkZXI6ICd4LXRpbWVzdGFtcCcsXG4gICAgICAgIHNpZ25hdHVyZVByZWZpeDogJ3NoYTI1Nj0nXG4gICAgICB9KSkudG9UaHJvdygnSE1BQyBzZWNyZXQgaXMgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlU2lnbmF0dXJlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgdmFsaWQgc2lnbmF0dXJlIHdpdGggdGltZXN0YW1wJywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgdGltZXN0YW1wID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci5nZW5lcmF0ZVNpZ25hdHVyZShib2R5LCB0aW1lc3RhbXApO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnNpZ25hdHVyZSkudG9NYXRjaCgvXnNoYTI1Nj1bYS1mMC05XXs2NH0kLyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRpbWVzdGFtcCkudG9CZSh0aW1lc3RhbXApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzWyd4LXNpZ25hdHVyZSddKS50b0JlKHJlc3VsdC5zaWduYXR1cmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzWyd4LXRpbWVzdGFtcCddKS50b0JlKHRpbWVzdGFtcC50b1N0cmluZygpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgc2lnbmF0dXJlIHdpdGggY3VycmVudCB0aW1lc3RhbXAgaWYgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgYmVmb3JlVGltZSA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IuZ2VuZXJhdGVTaWduYXR1cmUoYm9keSk7XG4gICAgICBjb25zdCBhZnRlclRpbWUgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC50aW1lc3RhbXApLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoYmVmb3JlVGltZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRpbWVzdGFtcCkudG9CZUxlc3NUaGFuT3JFcXVhbChhZnRlclRpbWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgQnVmZmVyIGJvZHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gQnVmZmVyLmZyb20oJ3Rlc3QgYm9keScsICd1dGY4Jyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci5nZW5lcmF0ZVNpZ25hdHVyZShib2R5KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zaWduYXR1cmUpLnRvTWF0Y2goL15zaGEyNTY9W2EtZjAtOV17NjR9JC8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVSZXF1ZXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBzaWduYXR1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSwgdGltZXN0YW1wLCBoZWFkZXJzIH0gPSB2YWxpZGF0b3IuZ2VuZXJhdGVTaWduYXR1cmUoYm9keSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci52YWxpZGF0ZVJlcXVlc3QoYm9keSwgaGVhZGVycyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbXB1dGVkU2lnbmF0dXJlKS50b0JlKHNpZ25hdHVyZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnByb3ZpZGVkU2lnbmF0dXJlKS50b0JlKHNpZ25hdHVyZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRpbWVzdGFtcCkudG9CZSh0aW1lc3RhbXApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbWlzc2luZyBzaWduYXR1cmUgaGVhZGVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgaGVhZGVycyA9IHsgJ3gtdGltZXN0YW1wJzogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkudG9TdHJpbmcoKSB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignTWlzc2luZyB4LXNpZ25hdHVyZSBoZWFkZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG1pc3NpbmcgdGltZXN0YW1wIGhlYWRlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGJvZHkgPSAndGVzdCBib2R5JztcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSB7ICd4LXNpZ25hdHVyZSc6ICdzaGEyNTY9YWJjZDEyMzQnIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci52YWxpZGF0ZVJlcXVlc3QoYm9keSwgaGVhZGVycyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdNaXNzaW5nIHgtdGltZXN0YW1wIGhlYWRlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCB0aW1lc3RhbXAgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgJ3gtc2lnbmF0dXJlJzogJ3NoYTI1Nj1hYmNkMTIzNCcsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6ICdpbnZhbGlkLXRpbWVzdGFtcCdcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci52YWxpZGF0ZVJlcXVlc3QoYm9keSwgaGVhZGVycyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgnSW52YWxpZCB0aW1lc3RhbXAgZm9ybWF0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBvbGQgcmVxdWVzdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgICBjb25zdCBvbGRUaW1lc3RhbXAgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSAtIDQwMDsgLy8gNDAwIHNlY29uZHMgYWdvXG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSB9ID0gdmFsaWRhdG9yLmdlbmVyYXRlU2lnbmF0dXJlKGJvZHksIG9sZFRpbWVzdGFtcCk7XG4gICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAneC1zaWduYXR1cmUnOiBzaWduYXR1cmUsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6IG9sZFRpbWVzdGFtcC50b1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignUmVxdWVzdCB0b28gb2xkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBmdXR1cmUgcmVxdWVzdHMgYmV5b25kIHRvbGVyYW5jZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGJvZHkgPSAndGVzdCBib2R5JztcbiAgICAgIGNvbnN0IGZ1dHVyZVRpbWVzdGFtcCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApICsgMTIwOyAvLyAyIG1pbnV0ZXMgaW4gZnV0dXJlXG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSB9ID0gdmFsaWRhdG9yLmdlbmVyYXRlU2lnbmF0dXJlKGJvZHksIGZ1dHVyZVRpbWVzdGFtcCk7XG4gICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAneC1zaWduYXR1cmUnOiBzaWduYXR1cmUsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6IGZ1dHVyZVRpbWVzdGFtcC50b1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignUmVxdWVzdCBmcm9tIGZ1dHVyZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgcmVxdWVzdHMgd2l0aGluIGNsb2NrIHNrZXcgdG9sZXJhbmNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgZnV0dXJlVGltZXN0YW1wID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyAzMDsgLy8gMzAgc2Vjb25kcyBpbiBmdXR1cmUgKHdpdGhpbiB0b2xlcmFuY2UpXG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSB9ID0gdmFsaWRhdG9yLmdlbmVyYXRlU2lnbmF0dXJlKGJvZHksIGZ1dHVyZVRpbWVzdGFtcCk7XG4gICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAneC1zaWduYXR1cmUnOiBzaWduYXR1cmUsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6IGZ1dHVyZVRpbWVzdGFtcC50b1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBzaWduYXR1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICd4LXNpZ25hdHVyZSc6ICdzaGEyNTY9aW52YWxpZC1zaWduYXR1cmUnLFxuICAgICAgICAneC10aW1lc3RhbXAnOiB0aW1lc3RhbXAudG9TdHJpbmcoKVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdG9yLnZhbGlkYXRlUmVxdWVzdChib2R5LCBoZWFkZXJzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCdJbnZhbGlkIHNpZ25hdHVyZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2lnbmF0dXJlIHdpdGhvdXQgcHJlZml4JywgKCkgPT4ge1xuICAgICAgY29uc3QgYm9keSA9ICd0ZXN0IGJvZHknO1xuICAgICAgY29uc3QgeyBzaWduYXR1cmUsIHRpbWVzdGFtcCB9ID0gdmFsaWRhdG9yLmdlbmVyYXRlU2lnbmF0dXJlKGJvZHkpO1xuICAgICAgY29uc3Qgc2lnbmF0dXJlV2l0aG91dFByZWZpeCA9IHNpZ25hdHVyZS5yZXBsYWNlKCdzaGEyNTY9JywgJycpO1xuICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgJ3gtc2lnbmF0dXJlJzogc2lnbmF0dXJlV2l0aG91dFByZWZpeCxcbiAgICAgICAgJ3gtdGltZXN0YW1wJzogdGltZXN0YW1wLnRvU3RyaW5nKClcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvci52YWxpZGF0ZVJlcXVlc3QoYm9keSwgaGVhZGVycyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGNhc2UtaW5zZW5zaXRpdmUgZm9yIGhlYWRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSwgdGltZXN0YW1wIH0gPSB2YWxpZGF0b3IuZ2VuZXJhdGVTaWduYXR1cmUoYm9keSk7XG4gICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAnWC1TaWduYXR1cmUnOiBzaWduYXR1cmUsXG4gICAgICAgICdYLVRpbWVzdGFtcCc6IHRpbWVzdGFtcC50b1N0cmluZygpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXJyYXkgaGVhZGVyIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGJvZHkgPSAndGVzdCBib2R5JztcbiAgICAgIGNvbnN0IHsgc2lnbmF0dXJlLCB0aW1lc3RhbXAgfSA9IHZhbGlkYXRvci5nZW5lcmF0ZVNpZ25hdHVyZShib2R5KTtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICd4LXNpZ25hdHVyZSc6IFtzaWduYXR1cmUsICdvdGhlci12YWx1ZSddLFxuICAgICAgICAneC10aW1lc3RhbXAnOiBbdGltZXN0YW1wLnRvU3RyaW5nKCldXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIGhlYWRlcnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgcmV0dXJuIGNvbXBsZXRlIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSBITUFDVmFsaWRhdG9yLnZhbGlkYXRlQ29uZmlnKHtcbiAgICAgICAgc2VjcmV0OiB0ZXN0U2VjcmV0LFxuICAgICAgICBhbGdvcml0aG06ICdzaGEyNTYnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5zZWNyZXQpLnRvQmUodGVzdFNlY3JldCk7XG4gICAgICBleHBlY3QoY29uZmlnLmFsZ29yaXRobSkudG9CZSgnc2hhMjU2Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLm1heEFnZSkudG9CZSgzMDApOyAvLyBkZWZhdWx0XG4gICAgICBleHBlY3QoY29uZmlnLmNsb2NrU2tld1RvbGVyYW5jZSkudG9CZSg2MCk7IC8vIGRlZmF1bHRcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIG1pc3Npbmcgc2VjcmV0JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IEhNQUNWYWxpZGF0b3IudmFsaWRhdGVDb25maWcoe30pKS50b1Rocm93KCdITUFDIHNlY3JldCBpcyByZXF1aXJlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igc2hvcnQgc2VjcmV0JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IEhNQUNWYWxpZGF0b3IudmFsaWRhdGVDb25maWcoe1xuICAgICAgICBzZWNyZXQ6ICdzaG9ydCdcbiAgICAgIH0pKS50b1Rocm93KCdITUFDIHNlY3JldCBtdXN0IGJlIGF0IGxlYXN0IDMyIGNoYXJhY3RlcnMgbG9uZycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZnJvbUVudmlyb25tZW50JywgKCkgPT4ge1xuICAgIGNvbnN0IG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnY7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52ID0geyAuLi5vcmlnaW5hbEVudiB9O1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52ID0gb3JpZ2luYWxFbnY7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSB2YWxpZGF0b3IgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5ITUFDX1NFQ1JFVCA9IHRlc3RTZWNyZXQ7XG4gICAgICBwcm9jZXNzLmVudi5ITUFDX0FMR09SSVRITSA9ICdzaGE1MTInO1xuICAgICAgcHJvY2Vzcy5lbnYuSE1BQ19NQVhfQUdFID0gJzYwMCc7XG4gICAgICBcbiAgICAgIGNvbnN0IHZhbGlkYXRvciA9IEhNQUNWYWxpZGF0b3IuZnJvbUVudmlyb25tZW50KCk7XG4gICAgICBjb25zdCBjb25maWcgPSB2YWxpZGF0b3IuZ2V0Q29uZmlnKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25maWcuYWxnb3JpdGhtKS50b0JlKCdzaGE1MTInKTtcbiAgICAgIGV4cGVjdChjb25maWcubWF4QWdlKS50b0JlKDYwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBXRUJIT09LX1NFQ1JFVCBhcyBmYWxsYmFjaycsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LldFQkhPT0tfU0VDUkVUID0gdGVzdFNlY3JldDtcbiAgICAgIFxuICAgICAgY29uc3QgdmFsaWRhdG9yID0gSE1BQ1ZhbGlkYXRvci5mcm9tRW52aXJvbm1lbnQoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHZhbGlkYXRvcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgbm8gc2VjcmV0IGluIGVudmlyb25tZW50JywgKCkgPT4ge1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LkhNQUNfU0VDUkVUO1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LldFQkhPT0tfU0VDUkVUO1xuICAgICAgXG4gICAgICBleHBlY3QoKCkgPT4gSE1BQ1ZhbGlkYXRvci5mcm9tRW52aXJvbm1lbnQoKSkudG9UaHJvdygnSE1BQyBzZWNyZXQgaXMgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RpbWluZyBhdHRhY2sgcHJvdGVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVzZSBjb25zdGFudC10aW1lIGNvbXBhcmlzb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgICBjb25zdCB7IHNpZ25hdHVyZSwgdGltZXN0YW1wIH0gPSB2YWxpZGF0b3IuZ2VuZXJhdGVTaWduYXR1cmUoYm9keSk7XG4gICAgICBcbiAgICAgIC8vIFRlc3Qgd2l0aCBjb3JyZWN0IHNpZ25hdHVyZVxuICAgICAgY29uc3QgdmFsaWRIZWFkZXJzID0ge1xuICAgICAgICAneC1zaWduYXR1cmUnOiBzaWduYXR1cmUsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6IHRpbWVzdGFtcC50b1N0cmluZygpXG4gICAgICB9O1xuICAgICAgY29uc3QgdmFsaWRSZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGVSZXF1ZXN0KGJvZHksIHZhbGlkSGVhZGVycyk7XG4gICAgICBleHBlY3QodmFsaWRSZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIFRlc3Qgd2l0aCBpbmNvcnJlY3Qgc2lnbmF0dXJlIG9mIHNhbWUgbGVuZ3RoXG4gICAgICBjb25zdCB3cm9uZ1NpZ25hdHVyZSA9IHNpZ25hdHVyZS5yZXBsYWNlKCdhJywgJ2InKTtcbiAgICAgIGNvbnN0IGludmFsaWRIZWFkZXJzID0ge1xuICAgICAgICAneC1zaWduYXR1cmUnOiB3cm9uZ1NpZ25hdHVyZSxcbiAgICAgICAgJ3gtdGltZXN0YW1wJzogdGltZXN0YW1wLnRvU3RyaW5nKClcbiAgICAgIH07XG4gICAgICBjb25zdCBpbnZhbGlkUmVzdWx0ID0gdmFsaWRhdG9yLnZhbGlkYXRlUmVxdWVzdChib2R5LCBpbnZhbGlkSGVhZGVycyk7XG4gICAgICBleHBlY3QoaW52YWxpZFJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdjcmVhdGVITUFDTWlkZGxld2FyZScsICgpID0+IHtcbiAgbGV0IHZhbGlkYXRvcjogSE1BQ1ZhbGlkYXRvcjtcbiAgbGV0IG1pZGRsZXdhcmU6IGFueTtcbiAgbGV0IG1vY2tSZXE6IGFueTtcbiAgbGV0IG1vY2tSZXM6IGFueTtcbiAgbGV0IG1vY2tOZXh0OiBqZXN0Lk1vY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgdmFsaWRhdG9yID0gbmV3IEhNQUNWYWxpZGF0b3Ioe1xuICAgICAgc2VjcmV0OiAndGVzdC1zZWNyZXQta2V5LXRoYXQtaXMtMzItY2hhcnMtbG9uZycsXG4gICAgICBhbGdvcml0aG06ICdzaGEyNTYnLFxuICAgICAgbWF4QWdlOiAzMDAsXG4gICAgICBjbG9ja1NrZXdUb2xlcmFuY2U6IDYwLFxuICAgICAgc2lnbmF0dXJlSGVhZGVyOiAneC1zaWduYXR1cmUnLFxuICAgICAgdGltZXN0YW1wSGVhZGVyOiAneC10aW1lc3RhbXAnLFxuICAgICAgc2lnbmF0dXJlUHJlZml4OiAnc2hhMjU2PSdcbiAgICB9KTtcbiAgICBcbiAgICBtaWRkbGV3YXJlID0gY3JlYXRlSE1BQ01pZGRsZXdhcmUodmFsaWRhdG9yKTtcbiAgICBtb2NrTmV4dCA9IGplc3QuZm4oKTtcbiAgICBtb2NrUmVzID0ge1xuICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGpzb246IGplc3QuZm4oKVxuICAgIH07XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgc2tpcCB2YWxpZGF0aW9uIGZvciBoZWFsdGggZW5kcG9pbnQnLCAoKSA9PiB7XG4gICAgbW9ja1JlcSA9IHsgcGF0aDogJy9oZWFsdGgnIH07XG4gICAgXG4gICAgbWlkZGxld2FyZShtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XG4gICAgXG4gICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNraXAgdmFsaWRhdGlvbiBmb3IgbWV0cmljcyBlbmRwb2ludCcsICgpID0+IHtcbiAgICBtb2NrUmVxID0geyBwYXRoOiAnL21ldHJpY3MnIH07XG4gICAgXG4gICAgbWlkZGxld2FyZShtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XG4gICAgXG4gICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHZhbGlkYXRlIEhNQUMgZm9yIG90aGVyIGVuZHBvaW50cycsICgpID0+IHtcbiAgICBjb25zdCBib2R5ID0gJ3Rlc3QgYm9keSc7XG4gICAgY29uc3QgeyBzaWduYXR1cmUsIHRpbWVzdGFtcCB9ID0gdmFsaWRhdG9yLmdlbmVyYXRlU2lnbmF0dXJlKGJvZHkpO1xuICAgIFxuICAgIG1vY2tSZXEgPSB7XG4gICAgICBwYXRoOiAnL2FwaS90ZXN0JyxcbiAgICAgIHJhd0JvZHk6IGJvZHksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICd4LXNpZ25hdHVyZSc6IHNpZ25hdHVyZSxcbiAgICAgICAgJ3gtdGltZXN0YW1wJzogdGltZXN0YW1wLnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIG1pZGRsZXdhcmUobW9ja1JlcSwgbW9ja1JlcywgbW9ja05leHQpO1xuICAgIFxuICAgIGV4cGVjdChtb2NrTmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIGV4cGVjdChtb2NrUmVxLmhtYWNWYWxpZGF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChtb2NrUmVxLmhtYWNWYWxpZGF0aW9uLnZhbGlkKS50b0JlKHRydWUpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIEhNQUMnLCAoKSA9PiB7XG4gICAgbW9ja1JlcSA9IHtcbiAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxuICAgICAgcmF3Qm9keTogJ3Rlc3QgYm9keScsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICd4LXNpZ25hdHVyZSc6ICdpbnZhbGlkLXNpZ25hdHVyZScsXG4gICAgICAgICd4LXRpbWVzdGFtcCc6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIG1pZGRsZXdhcmUobW9ja1JlcSwgbW9ja1JlcywgbW9ja05leHQpO1xuICAgIFxuICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAxKTtcbiAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnXG4gICAgICB9KVxuICAgICk7XG4gICAgZXhwZWN0KG1vY2tOZXh0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnSE1BQ0RlZmF1bHRzJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIHByb3ZpZGUgc2Vuc2libGUgZGVmYXVsdCBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdChITUFDRGVmYXVsdHMuYWxnb3JpdGhtKS50b0JlKCdzaGEyNTYnKTtcbiAgICBleHBlY3QoSE1BQ0RlZmF1bHRzLm1heEFnZSkudG9CZSgzMDApO1xuICAgIGV4cGVjdChITUFDRGVmYXVsdHMuY2xvY2tTa2V3VG9sZXJhbmNlKS50b0JlKDYwKTtcbiAgICBleHBlY3QoSE1BQ0RlZmF1bHRzLnNpZ25hdHVyZUhlYWRlcikudG9CZSgneC1zaWduYXR1cmUnKTtcbiAgICBleHBlY3QoSE1BQ0RlZmF1bHRzLnRpbWVzdGFtcEhlYWRlcikudG9CZSgneC10aW1lc3RhbXAnKTtcbiAgICBleHBlY3QoSE1BQ0RlZmF1bHRzLnNpZ25hdHVyZVByZWZpeCkudG9CZSgnc2hhMjU2PScpO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==