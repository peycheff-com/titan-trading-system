{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/engine/PerformanceTracker.ts","mappings":";AAAA;;;;;GAKG;;;AAUH,2BAA2B;AAC3B,MAAM,UAAU,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;AAEvC,wEAAwE;AACxE,MAAM,oBAAoB,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAE5C;;;GAGG;AACH,MAAa,kBAAkB;IACZ,MAAM,CAA2B;IACjC,EAAE,CAAyB;IAE5C,YAAY,MAAgC,EAAE,EAAoB;QAChE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,IAAI,CAAC;IACvB,CAAC;IAED;;;;;;;;OAQG;IACH,KAAK,CAAC,WAAW,CACf,OAAgB,EAChB,GAAW,EACX,SAAiB,EACjB,MAAe,EACf,IAAqB;QAErB,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;QACpE,CAAC;QAED,MAAM,IAAI,CAAC,EAAE,CAAC,KAAK,CACjB;mCAC6B,EAC7B,CAAC,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,MAAM,IAAI,IAAI,EAAE,IAAI,IAAI,IAAI,CAAC,CACxD,CAAC;IACJ,CAAC;IAGD;;;;;;OAMG;IACH,KAAK,CAAC,iBAAiB,CACrB,OAAgB,EAChB,UAAkB;QAElB,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO,EAAE,CAAC;QACZ,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,UAAU,GAAG,UAAU,CAAC;QAEzD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,KAAK,CAQhC;;;8BAGwB,EACxB,CAAC,OAAO,EAAE,WAAW,CAAC,CACvB,CAAC;QAEF,OAAO,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;YAC/B,EAAE,EAAE,GAAG,CAAC,EAAE;YACV,OAAO,EAAE,GAAG,CAAC,QAAmB;YAChC,GAAG,EAAE,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC;YACxB,SAAS,EAAE,QAAQ,CAAC,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC;YACtC,MAAM,EAAE,GAAG,CAAC,MAAM,IAAI,SAAS;YAC/B,IAAI,EAAE,GAAG,CAAC,IAAkC;SAC7C,CAAC,CAAC,CAAC;IACN,CAAC;IAED;;;;;;OAMG;IACH,KAAK,CAAC,aAAa,CAAC,OAAgB,EAAE,UAAkB;QACtD,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO,CAAC,CAAC;QACX,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,UAAU,GAAG,UAAU,CAAC;QAEzD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,KAAK,CAChC;;+CAEyC,EACzC,CAAC,OAAO,EAAE,WAAW,CAAC,CACvB,CAAC;QAEF,OAAO,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE,EAAE,CAAC,CAAC;IACpD,CAAC;IAED;;;;;;;;;OASG;IACH,KAAK,CAAC,cAAc,CAClB,OAAgB,EAChB,UAAmB;QAEnB,MAAM,MAAM,GAAG,UAAU,IAAI,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;QACpD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QAE7D,OAAO,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7D,CAAC;IAED;;;;;;OAMG;IACH,oBAAoB,CAAC,SAAmB;QACtC,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACzB,OAAO,CAAC,CAAC;QACX,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;QAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAErD,yBAAyB;QACzB,IAAI,MAAM,KAAK,CAAC,EAAE,CAAC;YACjB,iEAAiE;YACjE,gEAAgE;YAChE,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9C,CAAC;QAED,qBAAqB;QACrB,MAAM,WAAW,GAAG,IAAI,GAAG,MAAM,CAAC;QAElC,6BAA6B;QAC7B,OAAO,WAAW,GAAG,oBAAoB,CAAC;IAC5C,CAAC;IAED;;OAEG;IACK,aAAa,CAAC,MAAgB;QACpC,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC;QAClC,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC;IAC/D,CAAC;IAED;;OAEG;IACK,eAAe,CAAC,MAAgB,EAAE,IAAa;QACrD,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC;YAAE,OAAO,CAAC,CAAC;QAChC,MAAM,CAAC,GAAG,IAAI,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC7C,MAAM,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3D,MAAM,QAAQ,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACnF,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC7B,CAAC;IAGD;;;;;;;;;;;OAWG;IACH,KAAK,CAAC,sBAAsB,CAAC,OAAgB;QAC3C,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAE7E,+DAA+D;QAC/D,IAAI,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;YAC3C,OAAO,GAAG,CAAC;QACb,CAAC;QAED,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;QAEvD,OAAO,IAAI,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;IAC7C,CAAC;IAED;;;;;;OAMG;IACH,iBAAiB,CAAC,WAAmB;QACnC,8CAA8C;QAC9C,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;YAC7C,OAAO,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC;QACrC,CAAC;QAED,mDAAmD;QACnD,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;YAC7C,OAAO,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC;QACrC,CAAC;QAED,sCAAsC;QACtC,OAAO,GAAG,CAAC;IACb,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,mBAAmB,CAAC,OAAgB;QACxC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAC7E,MAAM,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QAE3C,MAAM,QAAQ,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;QAC1D,MAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC;QAEjC,MAAM,IAAI,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC5C,MAAM,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAE9C,MAAM,OAAO,GAAG,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9D,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9D,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAE7E,MAAM,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;QACzD,MAAM,QAAQ,GACZ,UAAU,IAAI,IAAI,CAAC,MAAM,CAAC,aAAa;YACrC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,WAAW,CAAC;YACrC,CAAC,CAAC,GAAG,CAAC;QAEV,OAAO;YACL,OAAO;YACP,WAAW;YACX,QAAQ;YACR,UAAU;YACV,OAAO;YACP,MAAM;YACN,OAAO;YACP,QAAQ;SACT,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,sBAAsB;QAC1B,MAAM,MAAM,GAAc,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACzD,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACrE,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,0BAA0B,CAAC,OAAgB;QAC/C,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;QACpE,CAAC;QAED,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;QAC5D,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAE7B,MAAM,IAAI,CAAC,EAAE,CAAC,KAAK,CACjB;;uCAEiC,EACjC;YACE,OAAO;YACP,SAAS;YACT,WAAW,CAAC,QAAQ;YACpB,WAAW,CAAC,UAAU;YACtB,WAAW,CAAC,WAAW;YACvB,WAAW,CAAC,QAAQ;SACrB,CACF,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,SAAS;QACP,OAAO,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;IAC5B,CAAC;CACF;AA9SD,gDA8SC","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/engine/PerformanceTracker.ts"],"sourcesContent":["/**\n * PerformanceTracker - Tracks PnL and calculates rolling Sharpe Ratios\n * Enables performance-based throttling of phase allocations\n * \n * Requirements: 2.1, 2.2, 2.3, 2.4, 2.8\n */\n\nimport {\n  PhaseId,\n  TradeRecord,\n  PhasePerformance,\n  PerformanceTrackerConfig,\n} from '../types/index.js';\nimport { DatabaseManager } from '../db/DatabaseManager.js';\n\n/** Milliseconds per day */\nconst MS_PER_DAY = 24 * 60 * 60 * 1000;\n\n/** Annualization factor for Sharpe ratio (assuming 365 trading days) */\nconst ANNUALIZATION_FACTOR = Math.sqrt(365);\n\n/**\n * PerformanceTracker tracks PnL per phase and calculates rolling Sharpe Ratios\n * to enable performance-based allocation throttling.\n */\nexport class PerformanceTracker {\n  private readonly config: PerformanceTrackerConfig;\n  private readonly db: DatabaseManager | null;\n\n  constructor(config: PerformanceTrackerConfig, db?: DatabaseManager) {\n    this.config = config;\n    this.db = db ?? null;\n  }\n\n  /**\n   * Record a trade for a phase with database persistence\n   * \n   * @param phaseId - The phase that executed the trade\n   * @param pnl - Profit/loss in USD\n   * @param timestamp - Unix timestamp in milliseconds\n   * @param symbol - Optional trading symbol\n   * @param side - Optional trade side (BUY/SELL)\n   */\n  async recordTrade(\n    phaseId: PhaseId,\n    pnl: number,\n    timestamp: number,\n    symbol?: string,\n    side?: 'BUY' | 'SELL'\n  ): Promise<void> {\n    if (!this.db) {\n      throw new Error('Database not configured for PerformanceTracker');\n    }\n\n    await this.db.query(\n      `INSERT INTO phase_trades (phase_id, timestamp, pnl, symbol, side)\n       VALUES ($1, $2, $3, $4, $5)`,\n      [phaseId, timestamp, pnl, symbol ?? null, side ?? null]\n    );\n  }\n\n\n  /**\n   * Get trade records for a phase within a time window\n   * \n   * @param phaseId - The phase to query\n   * @param windowDays - Number of days to look back\n   * @returns Array of trade records\n   */\n  async getTradesInWindow(\n    phaseId: PhaseId,\n    windowDays: number\n  ): Promise<TradeRecord[]> {\n    if (!this.db) {\n      return [];\n    }\n\n    const windowStart = Date.now() - windowDays * MS_PER_DAY;\n\n    const result = await this.db.query<{\n      id: number;\n      phase_id: string;\n      pnl: string;\n      timestamp: string;\n      symbol: string | null;\n      side: string | null;\n    }>(\n      `SELECT id, phase_id, pnl, timestamp, symbol, side\n       FROM phase_trades\n       WHERE phase_id = $1 AND timestamp >= $2\n       ORDER BY timestamp ASC`,\n      [phaseId, windowStart]\n    );\n\n    return result.rows.map((row) => ({\n      id: row.id,\n      phaseId: row.phase_id as PhaseId,\n      pnl: parseFloat(row.pnl),\n      timestamp: parseInt(row.timestamp, 10),\n      symbol: row.symbol ?? undefined,\n      side: row.side as 'BUY' | 'SELL' | undefined,\n    }));\n  }\n\n  /**\n   * Get the number of trades for a phase within a time window\n   * \n   * @param phaseId - The phase to query\n   * @param windowDays - Number of days to look back\n   * @returns Number of trades\n   */\n  async getTradeCount(phaseId: PhaseId, windowDays: number): Promise<number> {\n    if (!this.db) {\n      return 0;\n    }\n\n    const windowStart = Date.now() - windowDays * MS_PER_DAY;\n\n    const result = await this.db.query<{ count: string }>(\n      `SELECT COUNT(*) as count\n       FROM phase_trades\n       WHERE phase_id = $1 AND timestamp >= $2`,\n      [phaseId, windowStart]\n    );\n\n    return parseInt(result.rows[0]?.count ?? '0', 10);\n  }\n\n  /**\n   * Calculate the rolling Sharpe Ratio for a phase\n   * \n   * Sharpe Ratio = (Mean Return - Risk Free Rate) / Std Dev of Returns\n   * We assume risk-free rate = 0 for simplicity\n   * \n   * @param phaseId - The phase to calculate for\n   * @param windowDays - Rolling window in days (default: config.windowDays)\n   * @returns Sharpe ratio (annualized), or 0 if insufficient data\n   */\n  async getSharpeRatio(\n    phaseId: PhaseId,\n    windowDays?: number\n  ): Promise<number> {\n    const window = windowDays ?? this.config.windowDays;\n    const trades = await this.getTradesInWindow(phaseId, window);\n\n    return this.calculateSharpeRatio(trades.map((t) => t.pnl));\n  }\n\n  /**\n   * Calculate Sharpe ratio from an array of PnL values\n   * Pure function for testability\n   * \n   * @param pnlValues - Array of PnL values\n   * @returns Annualized Sharpe ratio\n   */\n  calculateSharpeRatio(pnlValues: number[]): number {\n    if (pnlValues.length < 2) {\n      return 0;\n    }\n\n    const mean = this.calculateMean(pnlValues);\n    const stdDev = this.calculateStdDev(pnlValues, mean);\n\n    // Avoid division by zero\n    if (stdDev === 0) {\n      // If all returns are the same and positive, return a high Sharpe\n      // If all returns are the same and negative, return a low Sharpe\n      return mean > 0 ? 3.0 : mean < 0 ? -3.0 : 0;\n    }\n\n    // Daily Sharpe ratio\n    const dailySharpe = mean / stdDev;\n\n    // Annualize the Sharpe ratio\n    return dailySharpe * ANNUALIZATION_FACTOR;\n  }\n\n  /**\n   * Calculate mean of an array\n   */\n  private calculateMean(values: number[]): number {\n    if (values.length === 0) return 0;\n    return values.reduce((sum, v) => sum + v, 0) / values.length;\n  }\n\n  /**\n   * Calculate standard deviation of an array\n   */\n  private calculateStdDev(values: number[], mean?: number): number {\n    if (values.length < 2) return 0;\n    const m = mean ?? this.calculateMean(values);\n    const squaredDiffs = values.map((v) => Math.pow(v - m, 2));\n    const variance = squaredDiffs.reduce((sum, v) => sum + v, 0) / (values.length - 1);\n    return Math.sqrt(variance);\n  }\n\n\n  /**\n   * Get the performance modifier for a phase based on Sharpe ratio\n   * \n   * Modifier logic:\n   * - Sharpe < malusThreshold (0): Apply malusMultiplier (0.5x)\n   * - Sharpe > bonusThreshold (2.0): Apply bonusMultiplier (1.2x)\n   * - Otherwise: 1.0x (no modification)\n   * - Insufficient trades (< minTradeCount): 1.0x (no modification)\n   * \n   * @param phaseId - The phase to get modifier for\n   * @returns Performance modifier between 0.5 and 1.2\n   */\n  async getPerformanceModifier(phaseId: PhaseId): Promise<number> {\n    const tradeCount = await this.getTradeCount(phaseId, this.config.windowDays);\n\n    // Requirement 2.8: Insufficient trade history uses base weight\n    if (tradeCount < this.config.minTradeCount) {\n      return 1.0;\n    }\n\n    const sharpeRatio = await this.getSharpeRatio(phaseId);\n\n    return this.calculateModifier(sharpeRatio);\n  }\n\n  /**\n   * Calculate modifier from Sharpe ratio\n   * Pure function for testability\n   * \n   * @param sharpeRatio - The Sharpe ratio\n   * @returns Modifier between malusMultiplier and bonusMultiplier\n   */\n  calculateModifier(sharpeRatio: number): number {\n    // Requirement 2.3: Sharpe < 0 → malus penalty\n    if (sharpeRatio < this.config.malusThreshold) {\n      return this.config.malusMultiplier;\n    }\n\n    // Requirement 2.4: Sharpe > 2.0 → bonus multiplier\n    if (sharpeRatio > this.config.bonusThreshold) {\n      return this.config.bonusMultiplier;\n    }\n\n    // Normal performance: no modification\n    return 1.0;\n  }\n\n  /**\n   * Get full performance metrics for a phase\n   * \n   * @param phaseId - The phase to get metrics for\n   * @returns PhasePerformance object with all metrics\n   */\n  async getPhasePerformance(phaseId: PhaseId): Promise<PhasePerformance> {\n    const trades = await this.getTradesInWindow(phaseId, this.config.windowDays);\n    const pnlValues = trades.map((t) => t.pnl);\n\n    const totalPnL = pnlValues.reduce((sum, v) => sum + v, 0);\n    const tradeCount = trades.length;\n\n    const wins = pnlValues.filter((p) => p > 0);\n    const losses = pnlValues.filter((p) => p < 0);\n\n    const winRate = tradeCount > 0 ? wins.length / tradeCount : 0;\n    const avgWin = wins.length > 0 ? this.calculateMean(wins) : 0;\n    const avgLoss = losses.length > 0 ? Math.abs(this.calculateMean(losses)) : 0;\n\n    const sharpeRatio = this.calculateSharpeRatio(pnlValues);\n    const modifier =\n      tradeCount >= this.config.minTradeCount\n        ? this.calculateModifier(sharpeRatio)\n        : 1.0;\n\n    return {\n      phaseId,\n      sharpeRatio,\n      totalPnL,\n      tradeCount,\n      winRate,\n      avgWin,\n      avgLoss,\n      modifier,\n    };\n  }\n\n  /**\n   * Get performance metrics for all phases\n   * \n   * @returns Array of PhasePerformance for all phases\n   */\n  async getAllPhasePerformance(): Promise<PhasePerformance[]> {\n    const phases: PhaseId[] = ['phase1', 'phase2', 'phase3'];\n    return Promise.all(phases.map((p) => this.getPhasePerformance(p)));\n  }\n\n  /**\n   * Persist performance metrics snapshot to database\n   * Called periodically (every 24 hours per Requirement 2.6)\n   * \n   * @param phaseId - The phase to persist metrics for\n   */\n  async persistPerformanceSnapshot(phaseId: PhaseId): Promise<void> {\n    if (!this.db) {\n      throw new Error('Database not configured for PerformanceTracker');\n    }\n\n    const performance = await this.getPhasePerformance(phaseId);\n    const timestamp = Date.now();\n\n    await this.db.query(\n      `INSERT INTO phase_performance \n       (phase_id, timestamp, pnl, trade_count, sharpe_ratio, modifier)\n       VALUES ($1, $2, $3, $4, $5, $6)`,\n      [\n        phaseId,\n        timestamp,\n        performance.totalPnL,\n        performance.tradeCount,\n        performance.sharpeRatio,\n        performance.modifier,\n      ]\n    );\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): PerformanceTrackerConfig {\n    return { ...this.config };\n  }\n}\n"],"version":3}