{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/startup/StartupManager.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/startup/StartupManager.ts"],"sourcesContent":["/**\n * StartupManager - Reliable service initialization for Railway deployment\n * \n * Ensures reliable service initialization with proper error handling,\n * timeout management, and graceful shutdown for Railway deployment.\n * \n * Requirements: 1.2.1, 1.2.2, 1.2.3, 1.2.4, 1.2.5\n */\n\nimport { EventEmitter } from 'events';\nimport { Logger } from '../logging/Logger.js';\n\n/**\n * Startup step status\n */\nexport enum StartupStatus {\n  PENDING = 'pending',\n  RUNNING = 'running',\n  COMPLETED = 'completed',\n  FAILED = 'failed',\n  SKIPPED = 'skipped'\n}\n\n/**\n * Individual startup step\n */\nexport interface StartupStep {\n  name: string;\n  description: string;\n  timeout: number;\n  required: boolean;\n  dependencies: string[];\n  execute: () => Promise<void>;\n}\n\n/**\n * Startup step result\n */\nexport interface StartupStepResult {\n  name: string;\n  status: StartupStatus;\n  duration: number;\n  error?: Error;\n  timestamp: number;\n}\n\n/**\n * Startup manager configuration\n */\nexport interface StartupManagerConfig {\n  maxStartupTime: number;\n  stepTimeout: number;\n  maxRetries: number;\n  retryDelay: number;\n  gracefulShutdownTimeout: number;\n  validateEnvironment: boolean;\n}\n\n/**\n * Environment validation result\n */\nexport interface EnvironmentValidationResult {\n  valid: boolean;\n  errors: string[];\n  warnings: string[];\n  requiredVariables: string[];\n  optionalVariables: string[];\n}\n\n/**\n * Startup manager for reliable service initialization\n */\nexport class StartupManager extends EventEmitter {\n  private steps: Map<string, StartupStep> = new Map();\n  private results: Map<string, StartupStepResult> = new Map();\n  private config: StartupManagerConfig;\n  private logger: Logger;\n  private startTime: number = 0;\n  private isStarted: boolean = false;\n  private isShuttingDown: boolean = false;\n  private shutdownHandlers: Array<() => Promise<void>> = [];\n  private signalHandlers: Map<string, (...args: any[]) => void> = new Map();\n\n  constructor(config: Partial<StartupManagerConfig> = {}, logger?: Logger) {\n    super();\n    \n    this.config = {\n      maxStartupTime: config.maxStartupTime || 60000, // 60 seconds\n      stepTimeout: config.stepTimeout || 30000, // 30 seconds\n      maxRetries: config.maxRetries || 3,\n      retryDelay: config.retryDelay || 1000, // 1 second\n      gracefulShutdownTimeout: config.gracefulShutdownTimeout || 10000, // 10 seconds\n      validateEnvironment: config.validateEnvironment ?? true\n    };\n    \n    this.logger = logger ?? Logger.getInstance('startup-manager');\n    \n    // Setup process signal handlers\n    this.setupSignalHandlers();\n  }\n\n  /**\n   * Register a startup step\n   */\n  registerStep(step: StartupStep): void {\n    if (this.isStarted) {\n      throw new Error('Cannot register steps after startup has begun');\n    }\n    \n    this.steps.set(step.name, step);\n    this.emit('step:registered', { name: step.name });\n    \n    this.logger.debug(`Startup step registered: ${step.name}`, undefined, {\n      description: step.description,\n      timeout: step.timeout,\n      required: step.required,\n      dependencies: step.dependencies\n    });\n  }\n\n  /**\n   * Register a shutdown handler\n   */\n  registerShutdownHandler(handler: () => Promise<void>): void {\n    this.shutdownHandlers.push(handler);\n  }\n\n  /**\n   * Start the initialization process\n   */\n  async start(): Promise<void> {\n    if (this.isStarted) {\n      throw new Error('Startup manager has already been started');\n    }\n    \n    this.isStarted = true;\n    this.startTime = Date.now();\n    \n    this.logger.info('Starting service initialization', undefined, {\n      totalSteps: this.steps.size,\n      maxStartupTime: this.config.maxStartupTime\n    });\n    \n    this.emit('startup:started');\n    \n    try {\n      // Validate environment if enabled\n      if (this.config.validateEnvironment) {\n        await this.validateEnvironment();\n      }\n      \n      // Execute startup steps\n      await this.executeSteps();\n      \n      const duration = Date.now() - this.startTime;\n      \n      this.logger.info('Service initialization completed successfully', undefined, {\n        duration,\n        completedSteps: Array.from(this.results.values()).filter(r => r.status === StartupStatus.COMPLETED).length,\n        failedSteps: Array.from(this.results.values()).filter(r => r.status === StartupStatus.FAILED).length\n      });\n      \n      this.emit('startup:completed', { duration });\n      \n    } catch (error) {\n      const duration = Date.now() - this.startTime;\n      \n      this.logger.error('Service initialization failed', error instanceof Error ? error : new Error(String(error)), undefined, {\n        duration,\n        completedSteps: Array.from(this.results.values()).filter(r => r.status === StartupStatus.COMPLETED).length,\n        failedSteps: Array.from(this.results.values()).filter(r => r.status === StartupStatus.FAILED).length\n      });\n      \n      this.emit('startup:failed', { error, duration });\n      throw error;\n    }\n  }\n\n  /**\n   * Validate environment variables\n   */\n  private async validateEnvironment(): Promise<void> {\n    this.logger.info('Validating environment configuration');\n    \n    const requiredVariables = [\n      'NODE_ENV',\n      'PORT',\n      'DATABASE_URL'\n    ];\n    \n    const optionalVariables = [\n      'REDIS_URL',\n      'HMAC_SECRET',\n      'LOG_LEVEL',\n      'RATE_LIMIT_WINDOW_MS',\n      'RATE_LIMIT_MAX_REQUESTS'\n    ];\n    \n    const errors: string[] = [];\n    const warnings: string[] = [];\n    \n    // Check required variables\n    for (const variable of requiredVariables) {\n      if (!process.env[variable]) {\n        errors.push(`Required environment variable ${variable} is not set`);\n      }\n    }\n    \n    // Check optional variables and warn if missing\n    for (const variable of optionalVariables) {\n      if (!process.env[variable]) {\n        warnings.push(`Optional environment variable ${variable} is not set`);\n      }\n    }\n    \n    // Validate specific values\n    if (process.env.NODE_ENV && !['development', 'production', 'test'].includes(process.env.NODE_ENV)) {\n      errors.push(`NODE_ENV must be one of: development, production, test. Got: ${process.env.NODE_ENV}`);\n    }\n    \n    if (process.env.PORT) {\n      const port = parseInt(process.env.PORT, 10);\n      if (isNaN(port) || port < 1 || port > 65535) {\n        errors.push(`PORT must be a valid port number (1-65535). Got: ${process.env.PORT}`);\n      }\n    }\n    \n    if (process.env.LOG_LEVEL && !['fatal', 'error', 'warn', 'info', 'debug', 'trace'].includes(process.env.LOG_LEVEL)) {\n      warnings.push(`LOG_LEVEL should be one of: fatal, error, warn, info, debug, trace. Got: ${process.env.LOG_LEVEL}`);\n    }\n    \n    const result: EnvironmentValidationResult = {\n      valid: errors.length === 0,\n      errors,\n      warnings,\n      requiredVariables,\n      optionalVariables\n    };\n    \n    // Log warnings\n    for (const warning of warnings) {\n      this.logger.warn(warning);\n    }\n    \n    // Log configuration summary (mask sensitive values)\n    const configSummary = {\n      NODE_ENV: process.env.NODE_ENV,\n      PORT: process.env.PORT,\n      DATABASE_URL: process.env.DATABASE_URL ? '[CONFIGURED]' : '[NOT SET]',\n      REDIS_URL: process.env.REDIS_URL ? '[CONFIGURED]' : '[NOT SET]',\n      HMAC_SECRET: process.env.HMAC_SECRET ? '[CONFIGURED]' : '[NOT SET]',\n      LOG_LEVEL: process.env.LOG_LEVEL || 'info'\n    };\n    \n    this.logger.info('Environment configuration summary', undefined, configSummary);\n    \n    this.emit('environment:validated', result);\n    \n    if (!result.valid) {\n      const error = new Error(`Environment validation failed: ${errors.join(', ')}`);\n      this.logger.error('Environment validation failed', error, undefined, { errors, warnings });\n      throw error;\n    }\n    \n    this.logger.info('Environment validation completed successfully', undefined, {\n      warningCount: warnings.length\n    });\n  }\n\n  /**\n   * Execute all startup steps in dependency order\n   */\n  private async executeSteps(): Promise<void> {\n    const executionOrder = this.calculateExecutionOrder();\n    \n    this.logger.info('Executing startup steps', undefined, {\n      executionOrder,\n      totalSteps: executionOrder.length\n    });\n    \n    for (const stepName of executionOrder) {\n      const step = this.steps.get(stepName);\n      if (!step) {\n        throw new Error(`Step ${stepName} not found`);\n      }\n      \n      await this.executeStep(step);\n      \n      // Check if we've exceeded the maximum startup time\n      const elapsed = Date.now() - this.startTime;\n      if (elapsed > this.config.maxStartupTime) {\n        throw new Error(`Startup timeout exceeded: ${elapsed}ms > ${this.config.maxStartupTime}ms`);\n      }\n    }\n  }\n\n  /**\n   * Calculate execution order based on dependencies\n   */\n  private calculateExecutionOrder(): string[] {\n    const visited = new Set<string>();\n    const visiting = new Set<string>();\n    const order: string[] = [];\n    \n    const visit = (stepName: string): void => {\n      if (visiting.has(stepName)) {\n        throw new Error(`Circular dependency detected involving step: ${stepName}`);\n      }\n      \n      if (visited.has(stepName)) {\n        return;\n      }\n      \n      visiting.add(stepName);\n      \n      const step = this.steps.get(stepName);\n      if (!step) {\n        throw new Error(`Step ${stepName} not found`);\n      }\n      \n      // Visit dependencies first\n      for (const dependency of step.dependencies) {\n        if (!this.steps.has(dependency)) {\n          throw new Error(`Dependency ${dependency} for step ${stepName} not found`);\n        }\n        visit(dependency);\n      }\n      \n      visiting.delete(stepName);\n      visited.add(stepName);\n      order.push(stepName);\n    };\n    \n    // Visit all steps\n    for (const stepName of this.steps.keys()) {\n      visit(stepName);\n    }\n    \n    return order;\n  }\n\n  /**\n   * Execute a single startup step with retry logic\n   */\n  private async executeStep(step: StartupStep): Promise<void> {\n    const startTime = Date.now();\n    \n    this.logger.info(`Executing startup step: ${step.name}`, undefined, {\n      description: step.description,\n      timeout: step.timeout,\n      required: step.required\n    });\n    \n    this.emit('step:started', { name: step.name });\n    \n    let lastError: Error | undefined;\n    let attempt = 0;\n    \n    while (attempt < this.config.maxRetries) {\n      attempt++;\n      \n      try {\n        // Execute step with timeout\n        await Promise.race([\n          step.execute(),\n          new Promise<never>((_, reject) =>\n            setTimeout(() => reject(new Error(`Step timeout: ${step.name}`)), step.timeout)\n          )\n        ]);\n        \n        const duration = Date.now() - startTime;\n        const result: StartupStepResult = {\n          name: step.name,\n          status: StartupStatus.COMPLETED,\n          duration,\n          timestamp: Date.now()\n        };\n        \n        this.results.set(step.name, result);\n        \n        this.logger.info(`Startup step completed: ${step.name}`, undefined, {\n          duration,\n          attempt\n        });\n        \n        this.emit('step:completed', result);\n        return;\n        \n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n        \n        this.logger.warn(`Startup step failed (attempt ${attempt}/${this.config.maxRetries}): ${step.name}`, undefined, {\n          attempt,\n          maxRetries: this.config.maxRetries\n        });\n        \n        if (attempt < this.config.maxRetries) {\n          // Wait before retry\n          await new Promise(resolve => setTimeout(resolve, this.config.retryDelay * attempt));\n        }\n      }\n    }\n    \n    // All retries failed\n    const duration = Date.now() - startTime;\n    const result: StartupStepResult = {\n      name: step.name,\n      status: StartupStatus.FAILED,\n      duration,\n      error: lastError,\n      timestamp: Date.now()\n    };\n    \n    this.results.set(step.name, result);\n    \n    this.logger.error(`Startup step failed permanently: ${step.name}`, lastError!, undefined, {\n      duration,\n      attempts: attempt,\n      required: step.required\n    });\n    \n    this.emit('step:failed', result);\n    \n    if (step.required) {\n      throw new Error(`Required startup step failed: ${step.name} - ${lastError?.message}`);\n    } else {\n      this.logger.warn(`Optional startup step failed, continuing: ${step.name}`);\n    }\n  }\n\n  /**\n   * Setup process signal handlers for graceful shutdown\n   */\n  private setupSignalHandlers(): void {\n    // Increase max listeners to prevent warnings in tests\n    process.setMaxListeners(20);\n    \n    const signals = ['SIGTERM', 'SIGINT', 'SIGUSR2'] as const;\n    \n    // Store handlers for cleanup\n    this.signalHandlers = new Map();\n    \n    for (const signal of signals) {\n      const handler = async () => {\n        this.logger.info(`Received ${signal}, initiating graceful shutdown`);\n        await this.shutdown();\n        process.exit(0);\n      };\n      \n      this.signalHandlers.set(signal, handler);\n      process.on(signal, handler);\n    }\n    \n    // Handle uncaught exceptions\n    const uncaughtHandler = (error: Error) => {\n      this.logger.error('Uncaught exception, shutting down', error);\n      this.shutdown().finally(() => process.exit(1));\n    };\n    this.signalHandlers.set('uncaughtException', uncaughtHandler);\n    process.on('uncaughtException', uncaughtHandler);\n    \n    // Handle unhandled promise rejections\n    const rejectionHandler = (reason: any, promise: Promise<any>) => {\n      this.logger.error('Unhandled promise rejection, shutting down', new Error(String(reason)), undefined, {\n        promise: promise.toString()\n      });\n      this.shutdown().finally(() => process.exit(1));\n    };\n    this.signalHandlers.set('unhandledRejection', rejectionHandler);\n    process.on('unhandledRejection', rejectionHandler);\n  }\n\n  /**\n   * Graceful shutdown\n   */\n  async shutdown(): Promise<void> {\n    if (this.isShuttingDown) {\n      this.logger.warn('Shutdown already in progress');\n      return;\n    }\n    \n    this.isShuttingDown = true;\n    const shutdownStart = Date.now();\n    \n    this.logger.info('Starting graceful shutdown', undefined, {\n      shutdownHandlers: this.shutdownHandlers.length,\n      timeout: this.config.gracefulShutdownTimeout\n    });\n    \n    this.emit('shutdown:started');\n    \n    try {\n      // Clean up signal handlers first\n      this.cleanupSignalHandlers();\n      \n      // Execute shutdown handlers with timeout\n      await Promise.race([\n        this.executeShutdownHandlers(),\n        new Promise<never>((_, reject) =>\n          setTimeout(() => reject(new Error('Shutdown timeout')), this.config.gracefulShutdownTimeout)\n        )\n      ]);\n      \n      const duration = Date.now() - shutdownStart;\n      \n      this.logger.info('Graceful shutdown completed', undefined, { duration });\n      this.emit('shutdown:completed', { duration });\n      \n    } catch (error) {\n      const duration = Date.now() - shutdownStart;\n      \n      this.logger.error('Graceful shutdown failed', error instanceof Error ? error : new Error(String(error)), undefined, {\n        duration\n      });\n      \n      this.emit('shutdown:failed', { error, duration });\n      throw error;\n    }\n  }\n\n  /**\n   * Clean up signal handlers\n   */\n  private cleanupSignalHandlers(): void {\n    for (const [event, handler] of this.signalHandlers) {\n      try {\n        process.removeListener(event as any, handler);\n      } catch (error) {\n        // Ignore cleanup errors\n      }\n    }\n    this.signalHandlers.clear();\n  }\n\n  /**\n   * Execute all shutdown handlers\n   */\n  private async executeShutdownHandlers(): Promise<void> {\n    const promises = this.shutdownHandlers.map(async (handler, index) => {\n      try {\n        await handler();\n        this.logger.debug(`Shutdown handler ${index} completed`);\n      } catch (error) {\n        this.logger.error(`Shutdown handler ${index} failed`, error instanceof Error ? error : new Error(String(error)));\n        throw error;\n      }\n    });\n    \n    await Promise.all(promises);\n  }\n\n  /**\n   * Get startup results\n   */\n  getResults(): StartupStepResult[] {\n    return Array.from(this.results.values());\n  }\n\n  /**\n   * Get startup duration\n   */\n  getStartupDuration(): number {\n    return this.startTime > 0 ? Date.now() - this.startTime : 0;\n  }\n\n  /**\n   * Check if startup is complete\n   */\n  isStartupComplete(): boolean {\n    if (!this.isStarted) return false;\n    \n    const requiredSteps = Array.from(this.steps.values()).filter(step => step.required);\n    const completedRequiredSteps = Array.from(this.results.values()).filter(\n      result => result.status === StartupStatus.COMPLETED && \n      this.steps.get(result.name)?.required\n    );\n    \n    return completedRequiredSteps.length === requiredSteps.length;\n  }\n\n  /**\n   * Get startup status summary\n   */\n  getStatusSummary(): {\n    started: boolean;\n    completed: boolean;\n    failed: boolean;\n    duration: number;\n    totalSteps: number;\n    completedSteps: number;\n    failedSteps: number;\n    pendingSteps: number;\n  } {\n    const results = Array.from(this.results.values());\n    \n    return {\n      started: this.isStarted,\n      completed: this.isStartupComplete(),\n      failed: results.some(r => r.status === StartupStatus.FAILED && this.steps.get(r.name)?.required),\n      duration: this.getStartupDuration(),\n      totalSteps: this.steps.size,\n      completedSteps: results.filter(r => r.status === StartupStatus.COMPLETED).length,\n      failedSteps: results.filter(r => r.status === StartupStatus.FAILED).length,\n      pendingSteps: this.steps.size - results.length\n    };\n  }\n}"],"version":3}