6297ecae8e94dbcfbcf1af2089d707b2
"use strict";
/**
 * Default Configuration for Titan Brain
 * Contains all default values for the system
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultConfig = void 0;
exports.loadConfigFromEnv = loadConfigFromEnv;
exports.mergeConfig = mergeConfig;
const index_js_1 = require("../types/index.js");
exports.defaultConfig = {
    brain: {
        signalTimeout: 100, // 100ms max latency
        metricUpdateInterval: 60000, // 1 minute
        dashboardCacheTTL: 5000, // 5 seconds
        maxQueueSize: 100,
    },
    allocationEngine: {
        transitionPoints: {
            startP2: 1500, // Phase 2 starts at $1,500
            fullP2: 5000, // Phase 2 full allocation at $5,000
            startP3: 25000, // Phase 3 starts at $25,000
        },
        leverageCaps: {
            [index_js_1.EquityTier.MICRO]: 20, // < $1,500: 20x max
            [index_js_1.EquityTier.SMALL]: 10, // $1,500 - $5,000: 10x max
            [index_js_1.EquityTier.MEDIUM]: 5, // $5,000 - $25,000: 5x max
            [index_js_1.EquityTier.LARGE]: 3, // $25,000 - $50,000: 3x max
            [index_js_1.EquityTier.INSTITUTIONAL]: 2, // > $50,000: 2x max
        },
    },
    performanceTracker: {
        windowDays: 7,
        minTradeCount: 10,
        malusMultiplier: 0.5,
        bonusMultiplier: 1.2,
        malusThreshold: 0,
        bonusThreshold: 2.0,
    },
    riskGuardian: {
        maxCorrelation: 0.8,
        correlationPenalty: 0.5, // 50% size reduction
        betaUpdateInterval: 300000, // 5 minutes
        correlationUpdateInterval: 300000, // 5 minutes
    },
    capitalFlow: {
        sweepThreshold: 1.2, // 20% excess triggers sweep
        reserveLimit: 200, // $200 minimum
        sweepSchedule: "0 0 * * *", // Daily at midnight UTC
        maxRetries: 3,
        retryBaseDelay: 1000, // 1 second
    },
    circuitBreaker: {
        maxDailyDrawdown: 0.15, // 15%
        minEquity: 150, // $150 (75% of $200 starting)
        consecutiveLossLimit: 3,
        consecutiveLossWindow: 3600000, // 1 hour
        cooldownMinutes: 30,
    },
    database: {
        host: "localhost",
        port: 5432,
        database: "titan_brain",
        user: "postgres",
        password: "postgres",
        maxConnections: 20,
        idleTimeout: 30000,
    },
    redis: {
        url: "redis://localhost:6379",
        maxRetries: 3,
        retryDelay: 1000,
    },
    server: {
        host: "0.0.0.0",
        port: 3100,
        corsOrigins: ["http://localhost:3000"],
    },
    notifications: {
        telegram: {
            enabled: false,
        },
        email: {
            enabled: false,
        },
    },
};
/**
 * Load configuration from environment variables
 */
function loadConfigFromEnv() {
    const config = {};
    // Database config from env
    if (process.env.DB_HOST) {
        config.database = {
            ...exports.defaultConfig.database,
            host: process.env.DB_HOST,
            port: parseInt(process.env.DB_PORT || "5432"),
            database: process.env.DB_NAME || "titan_brain",
            user: process.env.DB_USER || "postgres",
            password: process.env.DB_PASSWORD || "postgres",
        };
    }
    // Redis config from env
    if (process.env.REDIS_URL) {
        config.redis = {
            ...exports.defaultConfig.redis,
            url: process.env.REDIS_URL,
        };
    }
    // Server config from env
    if (process.env.SERVER_PORT) {
        config.server = {
            ...exports.defaultConfig.server,
            host: process.env.SERVER_HOST || "0.0.0.0",
            port: parseInt(process.env.PORT || process.env.SERVER_PORT || "3100"),
        };
    }
    // Telegram notifications from env
    if (process.env.TELEGRAM_BOT_TOKEN && process.env.TELEGRAM_CHAT_ID) {
        config.notifications = {
            ...exports.defaultConfig.notifications,
            telegram: {
                enabled: true,
                botToken: process.env.TELEGRAM_BOT_TOKEN,
                chatId: process.env.TELEGRAM_CHAT_ID,
            },
        };
    }
    return config;
}
/**
 * Merge configurations with defaults
 */
function mergeConfig(partial) {
    return {
        brain: { ...exports.defaultConfig.brain, ...partial.brain },
        allocationEngine: {
            ...exports.defaultConfig.allocationEngine,
            ...partial.allocationEngine,
        },
        performanceTracker: {
            ...exports.defaultConfig.performanceTracker,
            ...partial.performanceTracker,
        },
        riskGuardian: { ...exports.defaultConfig.riskGuardian, ...partial.riskGuardian },
        capitalFlow: { ...exports.defaultConfig.capitalFlow, ...partial.capitalFlow },
        circuitBreaker: {
            ...exports.defaultConfig.circuitBreaker,
            ...partial.circuitBreaker,
        },
        database: { ...exports.defaultConfig.database, ...partial.database },
        redis: { ...exports.defaultConfig.redis, ...partial.redis },
        server: { ...exports.defaultConfig.server, ...partial.server },
        notifications: {
            ...exports.defaultConfig.notifications,
            ...partial.notifications,
        },
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9jb25maWcvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBOEZILDhDQTZDQztBQUtELGtDQTJCQztBQXpLRCxnREFBaUU7QUFFcEQsUUFBQSxhQUFhLEdBQXFCO0lBQzdDLEtBQUssRUFBRTtRQUNMLGFBQWEsRUFBRSxHQUFHLEVBQUUsb0JBQW9CO1FBQ3hDLG9CQUFvQixFQUFFLEtBQUssRUFBRSxXQUFXO1FBQ3hDLGlCQUFpQixFQUFFLElBQUksRUFBRSxZQUFZO1FBQ3JDLFlBQVksRUFBRSxHQUFHO0tBQ2xCO0lBRUQsZ0JBQWdCLEVBQUU7UUFDaEIsZ0JBQWdCLEVBQUU7WUFDaEIsT0FBTyxFQUFFLElBQUksRUFBRSwyQkFBMkI7WUFDMUMsTUFBTSxFQUFFLElBQUksRUFBRSxvQ0FBb0M7WUFDbEQsT0FBTyxFQUFFLEtBQUssRUFBRSw0QkFBNEI7U0FDN0M7UUFDRCxZQUFZLEVBQUU7WUFDWixDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLG9CQUFvQjtZQUM1QyxDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLDJCQUEyQjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLDJCQUEyQjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLDRCQUE0QjtZQUNuRCxDQUFDLHFCQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxFQUFFLG9CQUFvQjtTQUNwRDtLQUNGO0lBRUQsa0JBQWtCLEVBQUU7UUFDbEIsVUFBVSxFQUFFLENBQUM7UUFDYixhQUFhLEVBQUUsRUFBRTtRQUNqQixlQUFlLEVBQUUsR0FBRztRQUNwQixlQUFlLEVBQUUsR0FBRztRQUNwQixjQUFjLEVBQUUsQ0FBQztRQUNqQixjQUFjLEVBQUUsR0FBRztLQUNwQjtJQUVE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RyxPQUFPLENBQUMsUUFBUSxFQUFFO1FBQzVELEtBQUssRUFBRSxFQUFFLEdBQUcscUJBQWEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFO1FBQ25ELE1BQU0sRUFBRSxFQUFFLEdBQUcscUJBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFO1FBQ3RELGFBQWEsRUFBRTtZQUNiLEdBQUcscUJBQWEsQ0FBQyxhQUFhO1lBQzlCLEdBQUcsT0FBTyxDQUFDLGFBQWE7U0FDekI7S0FDRixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vc3JjL2NvbmZpZy9kZWZhdWx0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERlZmF1bHQgQ29uZmlndXJhdGlvbiBmb3IgVGl0YW4gQnJhaW5cbiAqIENvbnRhaW5zIGFsbCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhlIHN5c3RlbVxuICovXG5cbmltcG9ydCB7IEVxdWl0eVRpZXIsIFRpdGFuQnJhaW5Db25maWcgfSBmcm9tIFwiLi4vdHlwZXMvaW5kZXguanNcIjtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb25maWc6IFRpdGFuQnJhaW5Db25maWcgPSB7XG4gIGJyYWluOiB7XG4gICAgc2lnbmFsVGltZW91dDogMTAwLCAvLyAxMDBtcyBtYXggbGF0ZW5jeVxuICAgIG1ldHJpY1VwZGF0ZUludGVydmFsOiA2MDAwMCwgLy8gMSBtaW51dGVcbiAgICBkYXNoYm9hcmRDYWNoZVRUTDogNTAwMCwgLy8gNSBzZWNvbmRzXG4gICAgbWF4UXVldWVTaXplOiAxMDAsXG4gIH0sXG5cbiAgYWxsb2NhdGlvbkVuZ2luZToge1xuICAgIHRyYW5zaXRpb25Qb2ludHM6IHtcbiAgICAgIHN0YXJ0UDI6IDE1MDAsIC8vIFBoYXNlIDIgc3RhcnRzIGF0ICQxLDUwMFxuICAgICAgZnVsbFAyOiA1MDAwLCAvLyBQaGFzZSAyIGZ1bGwgYWxsb2NhdGlvbiBhdCAkNSwwMDBcbiAgICAgIHN0YXJ0UDM6IDI1MDAwLCAvLyBQaGFzZSAzIHN0YXJ0cyBhdCAkMjUsMDAwXG4gICAgfSxcbiAgICBsZXZlcmFnZUNhcHM6IHtcbiAgICAgIFtFcXVpdHlUaWVyLk1JQ1JPXTogMjAsIC8vIDwgJDEsNTAwOiAyMHggbWF4XG4gICAgICBbRXF1aXR5VGllci5TTUFMTF06IDEwLCAvLyAkMSw1MDAgLSAkNSwwMDA6IDEweCBtYXhcbiAgICAgIFtFcXVpdHlUaWVyLk1FRElVTV06IDUsIC8vICQ1LDAwMCAtICQyNSwwMDA6IDV4IG1heFxuICAgICAgW0VxdWl0eVRpZXIuTEFSR0VdOiAzLCAvLyAkMjUsMDAwIC0gJDUwLDAwMDogM3ggbWF4XG4gICAgICBbRXF1aXR5VGllci5JTlNUSVRVVElPTkFMXTogMiwgLy8gPiAkNTAsMDAwOiAyeCBtYXhcbiAgICB9LFxuICB9LFxuXG4gIHBlcmZvcm1hbmNlVHJhY2tlcjoge1xuICAgIHdpbmRvd0RheXM6IDcsXG4gICAgbWluVHJhZGVDb3VudDogMTAsXG4gICAgbWFsdXNNdWx0aXBsaWVyOiAwLjUsXG4gICAgYm9udXNNdWx0aXBsaWVyOiAxLjIsXG4gICAgbWFsdXNUaHJlc2hvbGQ6IDAsXG4gICAgYm9udXNUaHJlc2hvbGQ6IDIuMCxcbiAgfSxcblxuICByaXNrR3VhcmRpYW46IHtcbiAgICBtYXhDb3JyZWxhdGlvbjogMC44LFxuICAgIGNvcnJlbGF0aW9uUGVuYWx0eTogMC41LCAvLyA1MCUgc2l6ZSByZWR1Y3Rpb25cbiAgICBiZXRhVXBkYXRlSW50ZXJ2YWw6IDMwMDAwMCwgLy8gNSBtaW51dGVzXG4gICAgY29ycmVsYXRpb25VcGRhdGVJbnRlcnZhbDogMzAwMDAwLCAvLyA1IG1pbnV0ZXNcbiAgfSxcblxuICBjYXBpdGFsRmxvdzoge1xuICAgIHN3ZWVwVGhyZXNob2xkOiAxLjIsIC8vIDIwJSBleGNlc3MgdHJpZ2dlcnMgc3dlZXBcbiAgICByZXNlcnZlTGltaXQ6IDIwMCwgLy8gJDIwMCBtaW5pbXVtXG4gICAgc3dlZXBTY2hlZHVsZTogXCIwIDAgKiAqICpcIiwgLy8gRGFpbHkgYXQgbWlkbmlnaHQgVVRDXG4gICAgbWF4UmV0cmllczogMyxcbiAgICByZXRyeUJhc2VEZWxheTogMTAwMCwgLy8gMSBzZWNvbmRcbiAgfSxcblxuICBjaXJjdWl0QnJlYWtlcjoge1xuICAgIG1heERhaWx5RHJhd2Rvd246IDAuMTUsIC8vIDE1JVxuICAgIG1pbkVxdWl0eTogMTUwLCAvLyAkMTUwICg3NSUgb2YgJDIwMCBzdGFydGluZylcbiAgICBjb25zZWN1dGl2ZUxvc3NMaW1pdDogMyxcbiAgICBjb25zZWN1dGl2ZUxvc3NXaW5kb3c6IDM2MDAwMDAsIC8vIDEgaG91clxuICAgIGNvb2xkb3duTWludXRlczogMzAsXG4gIH0sXG5cbiAgZGF0YWJhc2U6IHtcbiAgICBob3N0OiBcImxvY2FsaG9zdFwiLFxuICAgIHBvcnQ6IDU0MzIsXG4gICAgZGF0YWJhc2U6IFwidGl0YW5fYnJhaW5cIixcbiAgICB1c2VyOiBcInBvc3RncmVzXCIsXG4gICAgcGFzc3dvcmQ6IFwicG9zdGdyZXNcIixcbiAgICBtYXhDb25uZWN0aW9uczogMjAsXG4gICAgaWRsZVRpbWVvdXQ6IDMwMDAwLFxuICB9LFxuXG4gIHJlZGlzOiB7XG4gICAgdXJsOiBcInJlZGlzOi8vbG9jYWxob3N0OjYzNzlcIixcbiAgICBtYXhSZXRyaWVzOiAzLFxuICAgIHJldHJ5RGVsYXk6IDEwMDAsXG4gIH0sXG5cbiAgc2VydmVyOiB7XG4gICAgaG9zdDogXCIwLjAuMC4wXCIsXG4gICAgcG9ydDogMzEwMCxcbiAgICBjb3JzT3JpZ2luczogW1wiaHR0cDovL2xvY2FsaG9zdDozMDAwXCJdLFxuICB9LFxuXG4gIG5vdGlmaWNhdGlvbnM6IHtcbiAgICB0ZWxlZ3JhbToge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSxcbiAgICBlbWFpbDoge1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSxcbiAgfSxcbn07XG5cbi8qKlxuICogTG9hZCBjb25maWd1cmF0aW9uIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2FkQ29uZmlnRnJvbUVudigpOiBQYXJ0aWFsPFRpdGFuQnJhaW5Db25maWc+IHtcbiAgY29uc3QgY29uZmlnOiBQYXJ0aWFsPFRpdGFuQnJhaW5Db25maWc+ID0ge307XG5cbiAgLy8gRGF0YWJhc2UgY29uZmlnIGZyb20gZW52XG4gIGlmIChwcm9jZXNzLmVudi5EQl9IT1NUKSB7XG4gICAgY29uZmlnLmRhdGFiYXNlID0ge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5kYXRhYmFzZSxcbiAgICAgIGhvc3Q6IHByb2Nlc3MuZW52LkRCX0hPU1QsXG4gICAgICBwb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5EQl9QT1JUIHx8IFwiNTQzMlwiKSxcbiAgICAgIGRhdGFiYXNlOiBwcm9jZXNzLmVudi5EQl9OQU1FIHx8IFwidGl0YW5fYnJhaW5cIixcbiAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkRCX1VTRVIgfHwgXCJwb3N0Z3Jlc1wiLFxuICAgICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LkRCX1BBU1NXT1JEIHx8IFwicG9zdGdyZXNcIixcbiAgICB9O1xuICB9XG5cbiAgLy8gUmVkaXMgY29uZmlnIGZyb20gZW52XG4gIGlmIChwcm9jZXNzLmVudi5SRURJU19VUkwpIHtcbiAgICBjb25maWcucmVkaXMgPSB7XG4gICAgICAuLi5kZWZhdWx0Q29uZmlnLnJlZGlzLFxuICAgICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwsXG4gICAgfTtcbiAgfVxuXG4gIC8vIFNlcnZlciBjb25maWcgZnJvbSBlbnZcbiAgaWYgKHByb2Nlc3MuZW52LlNFUlZFUl9QT1JUKSB7XG4gICAgY29uZmlnLnNlcnZlciA9IHtcbiAgICAgIC4uLmRlZmF1bHRDb25maWcuc2VydmVyLFxuICAgICAgaG9zdDogcHJvY2Vzcy5lbnYuU0VSVkVSX0hPU1QgfHwgXCIwLjAuMC4wXCIsXG4gICAgICBwb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5QT1JUIHx8IHByb2Nlc3MuZW52LlNFUlZFUl9QT1JUIHx8IFwiMzEwMFwiKSxcbiAgICB9O1xuICB9XG5cbiAgLy8gVGVsZWdyYW0gbm90aWZpY2F0aW9ucyBmcm9tIGVudlxuICBpZiAocHJvY2Vzcy5lbnYuVEVMRUdSQU1fQk9UX1RPS0VOICYmIHByb2Nlc3MuZW52LlRFTEVHUkFNX0NIQVRfSUQpIHtcbiAgICBjb25maWcubm90aWZpY2F0aW9ucyA9IHtcbiAgICAgIC4uLmRlZmF1bHRDb25maWcubm90aWZpY2F0aW9ucyxcbiAgICAgIHRlbGVncmFtOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGJvdFRva2VuOiBwcm9jZXNzLmVudi5URUxFR1JBTV9CT1RfVE9LRU4sXG4gICAgICAgIGNoYXRJZDogcHJvY2Vzcy5lbnYuVEVMRUdSQU1fQ0hBVF9JRCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiBjb25maWc7XG59XG5cbi8qKlxuICogTWVyZ2UgY29uZmlndXJhdGlvbnMgd2l0aCBkZWZhdWx0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VDb25maWcoXG4gIHBhcnRpYWw6IFBhcnRpYWw8VGl0YW5CcmFpbkNvbmZpZz4sXG4pOiBUaXRhbkJyYWluQ29uZmlnIHtcbiAgcmV0dXJuIHtcbiAgICBicmFpbjogeyAuLi5kZWZhdWx0Q29uZmlnLmJyYWluLCAuLi5wYXJ0aWFsLmJyYWluIH0sXG4gICAgYWxsb2NhdGlvbkVuZ2luZToge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5hbGxvY2F0aW9uRW5naW5lLFxuICAgICAgLi4ucGFydGlhbC5hbGxvY2F0aW9uRW5naW5lLFxuICAgIH0sXG4gICAgcGVyZm9ybWFuY2VUcmFja2VyOiB7XG4gICAgICAuLi5kZWZhdWx0Q29uZmlnLnBlcmZvcm1hbmNlVHJhY2tlcixcbiAgICAgIC4uLnBhcnRpYWwucGVyZm9ybWFuY2VUcmFja2VyLFxuICAgIH0sXG4gICAgcmlza0d1YXJkaWFuOiB7IC4uLmRlZmF1bHRDb25maWcucmlza0d1YXJkaWFuLCAuLi5wYXJ0aWFsLnJpc2tHdWFyZGlhbiB9LFxuICAgIGNhcGl0YWxGbG93OiB7IC4uLmRlZmF1bHRDb25maWcuY2FwaXRhbEZsb3csIC4uLnBhcnRpYWwuY2FwaXRhbEZsb3cgfSxcbiAgICBjaXJjdWl0QnJlYWtlcjoge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZy5jaXJjdWl0QnJlYWtlcixcbiAgICAgIC4uLnBhcnRpYWwuY2lyY3VpdEJyZWFrZXIsXG4gICAgfSxcbiAgICBkYXRhYmFzZTogeyAuLi5kZWZhdWx0Q29uZmlnLmRhdGFiYXNlLCAuLi5wYXJ0aWFsLmRhdGFiYXNlIH0sXG4gICAgcmVkaXM6IHsgLi4uZGVmYXVsdENvbmZpZy5yZWRpcywgLi4ucGFydGlhbC5yZWRpcyB9LFxuICAgIHNlcnZlcjogeyAuLi5kZWZhdWx0Q29uZmlnLnNlcnZlciwgLi4ucGFydGlhbC5zZXJ2ZXIgfSxcbiAgICBub3RpZmljYXRpb25zOiB7XG4gICAgICAuLi5kZWZhdWx0Q29uZmlnLm5vdGlmaWNhdGlvbnMsXG4gICAgICAuLi5wYXJ0aWFsLm5vdGlmaWNhdGlvbnMsXG4gICAgfSxcbiAgfTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==