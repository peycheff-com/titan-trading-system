5bf5adc0250e75eb73511ebf124ee4b5
"use strict";
/**
 * Configuration Tests
 * Verifies default configuration and merging logic
 */
Object.defineProperty(exports, "__esModule", { value: true });
const defaults_js_1 = require("../../src/config/defaults.js");
const index_js_1 = require("../../src/types/index.js");
describe('Configuration', () => {
    describe('defaultConfig', () => {
        it('should have valid brain configuration', () => {
            expect(defaults_js_1.defaultConfig.brain.signalTimeout).toBe(100);
            expect(defaults_js_1.defaultConfig.brain.metricUpdateInterval).toBe(60000);
            expect(defaults_js_1.defaultConfig.brain.dashboardCacheTTL).toBe(5000);
            expect(defaults_js_1.defaultConfig.brain.maxQueueSize).toBe(100);
        });
        it('should have valid allocation engine configuration', () => {
            expect(defaults_js_1.defaultConfig.allocationEngine.transitionPoints.startP2).toBe(1500);
            expect(defaults_js_1.defaultConfig.allocationEngine.transitionPoints.fullP2).toBe(5000);
            expect(defaults_js_1.defaultConfig.allocationEngine.transitionPoints.startP3).toBe(25000);
        });
        it('should have valid leverage caps for all tiers', () => {
            const caps = defaults_js_1.defaultConfig.allocationEngine.leverageCaps;
            expect(caps[index_js_1.EquityTier.MICRO]).toBe(20);
            expect(caps[index_js_1.EquityTier.SMALL]).toBe(10);
            expect(caps[index_js_1.EquityTier.MEDIUM]).toBe(5);
            expect(caps[index_js_1.EquityTier.LARGE]).toBe(3);
            expect(caps[index_js_1.EquityTier.INSTITUTIONAL]).toBe(2);
        });
        it('should have valid performance tracker configuration', () => {
            expect(defaults_js_1.defaultConfig.performanceTracker.windowDays).toBe(7);
            expect(defaults_js_1.defaultConfig.performanceTracker.minTradeCount).toBe(10);
            expect(defaults_js_1.defaultConfig.performanceTracker.malusMultiplier).toBe(0.5);
            expect(defaults_js_1.defaultConfig.performanceTracker.bonusMultiplier).toBe(1.2);
        });
        it('should have valid circuit breaker configuration', () => {
            expect(defaults_js_1.defaultConfig.circuitBreaker.maxDailyDrawdown).toBe(0.15);
            expect(defaults_js_1.defaultConfig.circuitBreaker.minEquity).toBe(150);
            expect(defaults_js_1.defaultConfig.circuitBreaker.consecutiveLossLimit).toBe(3);
            expect(defaults_js_1.defaultConfig.circuitBreaker.cooldownMinutes).toBe(30);
        });
        it('should have valid capital flow configuration', () => {
            expect(defaults_js_1.defaultConfig.capitalFlow.sweepThreshold).toBe(1.2);
            expect(defaults_js_1.defaultConfig.capitalFlow.reserveLimit).toBe(200);
            expect(defaults_js_1.defaultConfig.capitalFlow.maxRetries).toBe(3);
        });
        it('should have valid risk guardian configuration', () => {
            expect(defaults_js_1.defaultConfig.riskGuardian.maxCorrelation).toBe(0.8);
            expect(defaults_js_1.defaultConfig.riskGuardian.correlationPenalty).toBe(0.5);
        });
    });
    describe('mergeConfig', () => {
        it('should merge partial config with defaults', () => {
            const partial = {
                brain: {
                    signalTimeout: 200,
                    metricUpdateInterval: 30000,
                    dashboardCacheTTL: 10000,
                    maxQueueSize: 50,
                },
            };
            const merged = (0, defaults_js_1.mergeConfig)(partial);
            expect(merged.brain.signalTimeout).toBe(200);
            expect(merged.brain.metricUpdateInterval).toBe(30000);
            // Other sections should use defaults
            expect(merged.circuitBreaker.maxDailyDrawdown).toBe(0.15);
        });
        it('should preserve defaults when partial is empty', () => {
            const merged = (0, defaults_js_1.mergeConfig)({});
            expect(merged.brain.signalTimeout).toBe(100);
            expect(merged.allocationEngine.transitionPoints.startP2).toBe(1500);
        });
    });
    describe('loadConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterAll(() => {
            process.env = originalEnv;
        });
        it('should load database config from environment', () => {
            process.env.DB_HOST = 'testhost';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'testdb';
            process.env.DB_USER = 'testuser';
            process.env.DB_PASSWORD = 'testpass';
            const config = (0, defaults_js_1.loadConfigFromEnv)();
            expect(config.database?.host).toBe('testhost');
            expect(config.database?.port).toBe(5433);
            expect(config.database?.database).toBe('testdb');
            expect(config.database?.user).toBe('testuser');
            expect(config.database?.password).toBe('testpass');
        });
        it('should load redis config from environment', () => {
            process.env.REDIS_URL = 'redis://testhost:6380';
            const config = (0, defaults_js_1.loadConfigFromEnv)();
            expect(config.redis?.url).toBe('redis://testhost:6380');
        });
        it('should load server config from environment', () => {
            process.env.SERVER_HOST = '127.0.0.1';
            process.env.SERVER_PORT = '4000';
            const config = (0, defaults_js_1.loadConfigFromEnv)();
            expect(config.server?.host).toBe('127.0.0.1');
            expect(config.server?.port).toBe(4000);
        });
        it('should enable telegram when both token and chat id are set', () => {
            process.env.TELEGRAM_BOT_TOKEN = 'test_token';
            process.env.TELEGRAM_CHAT_ID = 'test_chat';
            const config = (0, defaults_js_1.loadConfigFromEnv)();
            expect(config.notifications?.telegram?.enabled).toBe(true);
            expect(config.notifications?.telegram?.botToken).toBe('test_token');
            expect(config.notifications?.telegram?.chatId).toBe('test_chat');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL3VuaXQvY29uZmlnLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCw4REFBNkY7QUFDN0YsdURBQXNEO0FBRXRELFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsTUFBTSxDQUFDLDJCQUFhLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwRCxNQUFNLENBQUMsMkJBQWEsQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLDJCQUFhLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQywyQkFBYSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbURBQW1ELEVBQUUsR0FBRyxFQUFFO1lBQzNELE1BQU0sQ0FBQywyQkFBYSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzRSxNQUFNLENBQUMsMkJBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUUsTUFBTSxDQUFDLDJCQUFhLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlFLENB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Q0FBQyxZQUFZLENBQUMsQ0FBQztZQUNwRSxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ25FLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvdW5pdC9jb25maWcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbmZpZ3VyYXRpb24gVGVzdHNcbiAqIFZlcmlmaWVzIGRlZmF1bHQgY29uZmlndXJhdGlvbiBhbmQgbWVyZ2luZyBsb2dpY1xuICovXG5cbmltcG9ydCB7IGRlZmF1bHRDb25maWcsIG1lcmdlQ29uZmlnLCBsb2FkQ29uZmlnRnJvbUVudiB9IGZyb20gJy4uLy4uL3NyYy9jb25maWcvZGVmYXVsdHMuanMnO1xuaW1wb3J0IHsgRXF1aXR5VGllciB9IGZyb20gJy4uLy4uL3NyYy90eXBlcy9pbmRleC5qcyc7XG5cbmRlc2NyaWJlKCdDb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICBkZXNjcmliZSgnZGVmYXVsdENvbmZpZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhdmUgdmFsaWQgYnJhaW4gY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmJyYWluLnNpZ25hbFRpbWVvdXQpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmJyYWluLm1ldHJpY1VwZGF0ZUludGVydmFsKS50b0JlKDYwMDAwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmJyYWluLmRhc2hib2FyZENhY2hlVFRMKS50b0JlKDUwMDApO1xuICAgICAgZXhwZWN0KGRlZmF1bHRDb25maWcuYnJhaW4ubWF4UXVldWVTaXplKS50b0JlKDEwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgdmFsaWQgYWxsb2NhdGlvbiBlbmdpbmUgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmFsbG9jYXRpb25FbmdpbmUudHJhbnNpdGlvblBvaW50cy5zdGFydFAyKS50b0JlKDE1MDApO1xuICAgICAgZXhwZWN0KGRlZmF1bHRDb25maWcuYWxsb2NhdGlvbkVuZ2luZS50cmFuc2l0aW9uUG9pbnRzLmZ1bGxQMikudG9CZSg1MDAwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmFsbG9jYXRpb25FbmdpbmUudHJhbnNpdGlvblBvaW50cy5zdGFydFAzKS50b0JlKDI1MDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSB2YWxpZCBsZXZlcmFnZSBjYXBzIGZvciBhbGwgdGllcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYXBzID0gZGVmYXVsdENvbmZpZy5hbGxvY2F0aW9uRW5naW5lLmxldmVyYWdlQ2FwcztcbiAgICAgIGV4cGVjdChjYXBzW0VxdWl0eVRpZXIuTUlDUk9dKS50b0JlKDIwKTtcbiAgICAgIGV4cGVjdChjYXBzW0VxdWl0eVRpZXIuU01BTExdKS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdChjYXBzW0VxdWl0eVRpZXIuTUVESVVNXSkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChjYXBzW0VxdWl0eVRpZXIuTEFSR0VdKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGNhcHNbRXF1aXR5VGllci5JTlNUSVRVVElPTkFMXSkudG9CZSgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSB2YWxpZCBwZXJmb3JtYW5jZSB0cmFja2VyIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoZGVmYXVsdENvbmZpZy5wZXJmb3JtYW5jZVRyYWNrZXIud2luZG93RGF5cykudG9CZSg3KTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLnBlcmZvcm1hbmNlVHJhY2tlci5taW5UcmFkZUNvdW50KS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLnBlcmZvcm1hbmNlVHJhY2tlci5tYWx1c011bHRpcGxpZXIpLnRvQmUoMC41KTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLnBlcmZvcm1hbmNlVHJhY2tlci5ib251c011bHRpcGxpZXIpLnRvQmUoMS4yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSB2YWxpZCBjaXJjdWl0IGJyZWFrZXIgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmNpcmN1aXRCcmVha2VyLm1heERhaWx5RHJhd2Rvd24pLnRvQmUoMC4xNSk7XG4gICAgICBleHBlY3QoZGVmYXVsdENvbmZpZy5jaXJjdWl0QnJlYWtlci5taW5FcXVpdHkpLnRvQmUoMTUwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmNpcmN1aXRCcmVha2VyLmNvbnNlY3V0aXZlTG9zc0xpbWl0KS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGRlZmF1bHRDb25maWcuY2lyY3VpdEJyZWFrZXIuY29vbGRvd25NaW51dGVzKS50b0JlKDMwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSB2YWxpZCBjYXBpdGFsIGZsb3cgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmNhcGl0YWxGbG93LnN3ZWVwVGhyZXNob2xkKS50b0JlKDEuMik7XG4gICAgICBleHBlY3QoZGVmYXVsdENvbmZpZy5jYXBpdGFsRmxvdy5yZXNlcnZlTGltaXQpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0Q29uZmlnLmNhcGl0YWxGbG93Lm1heFJldHJpZXMpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgdmFsaWQgcmlzayBndWFyZGlhbiBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGRlZmF1bHRDb25maWcucmlza0d1YXJkaWFuLm1heENvcnJlbGF0aW9uKS50b0JlKDAuOCk7XG4gICAgICBleHBlY3QoZGVmYXVsdENvbmZpZy5yaXNrR3VhcmRpYW4uY29ycmVsYXRpb25QZW5hbHR5KS50b0JlKDAuNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtZXJnZUNvbmZpZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1lcmdlIHBhcnRpYWwgY29uZmlnIHdpdGggZGVmYXVsdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0aWFsID0ge1xuICAgICAgICBicmFpbjoge1xuICAgICAgICAgIHNpZ25hbFRpbWVvdXQ6IDIwMCxcbiAgICAgICAgICBtZXRyaWNVcGRhdGVJbnRlcnZhbDogMzAwMDAsXG4gICAgICAgICAgZGFzaGJvYXJkQ2FjaGVUVEw6IDEwMDAwLFxuICAgICAgICAgIG1heFF1ZXVlU2l6ZTogNTAsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtZXJnZWQgPSBtZXJnZUNvbmZpZyhwYXJ0aWFsKTtcblxuICAgICAgZXhwZWN0KG1lcmdlZC5icmFpbi5zaWduYWxUaW1lb3V0KS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QobWVyZ2VkLmJyYWluLm1ldHJpY1VwZGF0ZUludGVydmFsKS50b0JlKDMwMDAwKTtcbiAgICAgIC8vIE90aGVyIHNlY3Rpb25zIHNob3VsZCB1c2UgZGVmYXVsdHNcbiAgICAgIGV4cGVjdChtZXJnZWQuY2lyY3VpdEJyZWFrZXIubWF4RGFpbHlEcmF3ZG93bikudG9CZSgwLjE1KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgZGVmYXVsdHMgd2hlbiBwYXJ0aWFsIGlzIGVtcHR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVyZ2VkID0gbWVyZ2VDb25maWcoe30pO1xuXG4gICAgICBleHBlY3QobWVyZ2VkLmJyYWluLnNpZ25hbFRpbWVvdXQpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChtZXJnZWQuYWxsb2NhdGlvbkVuZ2luZS50cmFuc2l0aW9uUG9pbnRzLnN0YXJ0UDIpLnRvQmUoMTUwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2FkQ29uZmlnRnJvbUVudicsICgpID0+IHtcbiAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudiA9IHsgLi4ub3JpZ2luYWxFbnYgfTtcbiAgICB9KTtcblxuICAgIGFmdGVyQWxsKCgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52ID0gb3JpZ2luYWxFbnY7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvYWQgZGF0YWJhc2UgY29uZmlnIGZyb20gZW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5EQl9IT1NUID0gJ3Rlc3Rob3N0JztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1BPUlQgPSAnNTQzMyc7XG4gICAgICBwcm9jZXNzLmVudi5EQl9OQU1FID0gJ3Rlc3RkYic7XG4gICAgICBwcm9jZXNzLmVudi5EQl9VU0VSID0gJ3Rlc3R1c2VyJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1BBU1NXT1JEID0gJ3Rlc3RwYXNzJztcblxuICAgICAgY29uc3QgY29uZmlnID0gbG9hZENvbmZpZ0Zyb21FbnYoKTtcblxuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZT8uaG9zdCkudG9CZSgndGVzdGhvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2U/LnBvcnQpLnRvQmUoNTQzMyk7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlPy5kYXRhYmFzZSkudG9CZSgndGVzdGRiJyk7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlPy51c2VyKS50b0JlKCd0ZXN0dXNlcicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZT8ucGFzc3dvcmQpLnRvQmUoJ3Rlc3RwYXNzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvYWQgcmVkaXMgY29uZmlnIGZyb20gZW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5SRURJU19VUkwgPSAncmVkaXM6Ly90ZXN0aG9zdDo2MzgwJztcblxuICAgICAgY29uc3QgY29uZmlnID0gbG9hZENvbmZpZ0Zyb21FbnYoKTtcblxuICAgICAgZXhwZWN0KGNvbmZpZy5yZWRpcz8udXJsKS50b0JlKCdyZWRpczovL3Rlc3Rob3N0OjYzODAnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9hZCBzZXJ2ZXIgY29uZmlnIGZyb20gZW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5TRVJWRVJfSE9TVCA9ICcxMjcuMC4wLjEnO1xuICAgICAgcHJvY2Vzcy5lbnYuU0VSVkVSX1BPUlQgPSAnNDAwMCc7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IGxvYWRDb25maWdGcm9tRW52KCk7XG5cbiAgICAgIGV4cGVjdChjb25maWcuc2VydmVyPy5ob3N0KS50b0JlKCcxMjcuMC4wLjEnKTtcbiAgICAgIGV4cGVjdChjb25maWcuc2VydmVyPy5wb3J0KS50b0JlKDQwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbmFibGUgdGVsZWdyYW0gd2hlbiBib3RoIHRva2VuIGFuZCBjaGF0IGlkIGFyZSBzZXQnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5URUxFR1JBTV9CT1RfVE9LRU4gPSAndGVzdF90b2tlbic7XG4gICAgICBwcm9jZXNzLmVudi5URUxFR1JBTV9DSEFUX0lEID0gJ3Rlc3RfY2hhdCc7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IGxvYWRDb25maWdGcm9tRW52KCk7XG5cbiAgICAgIGV4cGVjdChjb25maWcubm90aWZpY2F0aW9ucz8udGVsZWdyYW0/LmVuYWJsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29uZmlnLm5vdGlmaWNhdGlvbnM/LnRlbGVncmFtPy5ib3RUb2tlbikudG9CZSgndGVzdF90b2tlbicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5ub3RpZmljYXRpb25zPy50ZWxlZ3JhbT8uY2hhdElkKS50b0JlKCd0ZXN0X2NoYXQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==