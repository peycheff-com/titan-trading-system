75c3d02ad9b31f0775e7360a0c05726c
"use strict";
/**
 * Unit tests for DatabaseManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('pg', () => ({
    Pool: jest.fn().mockImplementation(() => mockPool)
}));
const DatabaseManager_1 = require("../../src/database/DatabaseManager");
// Mock pg module
const mockClient = {
    query: jest.fn(),
    release: jest.fn()
};
const mockPool = {
    connect: jest.fn(),
    query: jest.fn(),
    end: jest.fn(),
    on: jest.fn(),
    totalCount: 5,
    idleCount: 3,
    waitingCount: 0
};
describe('DatabaseManager', () => {
    const testConfig = {
        host: 'localhost',
        port: 5432,
        database: 'test_db',
        user: 'test_user',
        password: 'test_password',
        ssl: false,
        min: 2,
        max: 10,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
        acquireTimeoutMillis: 5000,
        healthCheckIntervalMs: 30000,
        healthCheckTimeoutMs: 5000,
        maxReconnectAttempts: 5,
        reconnectDelayMs: 5000
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Reset mock implementations
        mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
        mockClient.release.mockResolvedValue(undefined);
        mockPool.connect.mockResolvedValue(mockClient);
        mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });
        mockPool.end.mockResolvedValue(undefined);
    });
    describe('createConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create config from DATABASE_URL', () => {
            process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('dbname');
            expect(config.user).toBe('user');
            expect(config.password).toBe('pass');
            expect(config.ssl).toBe(true);
        });
        it('should create config from individual environment variables', () => {
            process.env.DB_HOST = 'test-host';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'test-db';
            process.env.DB_USER = 'test-user';
            process.env.DB_PASSWORD = 'test-pass';
            process.env.DB_SSL = 'true';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('test-host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('test-db');
            expect(config.user).toBe('test-user');
            expect(config.password).toBe('test-pass');
            expect(config.ssl).toBe(true);
        });
        it('should use default values when environment variables are missing', () => {
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('localhost');
            expect(config.port).toBe(5432);
            expect(config.database).toBe('titan_brain');
            expect(config.user).toBe('postgres');
            expect(config.min).toBe(2);
            expect(config.max).toBe(10);
        });
    });
    describe('initialize', () => {
        it('should initialize successfully with valid configuration', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(mockPool.connect).toHaveBeenCalled();
            expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');
            expect(mockClient.release).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should throw error if already initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');
            await databaseManager.shutdown();
        });
        it('should handle connection test failure', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockRejectedValue(new Error('Connection failed'));
            await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');
        });
    });
    describe('query', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute query successfully', async () => {
            const mockResult = {
                rows: [{ id: 1, name: 'test' }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            const result = await databaseManager.query('SELECT * FROM test');
            expect(result.rows).toEqual(mockResult.rows);
            expect(result.rowCount).toBe(1);
            expect(result.command).toBe('SELECT');
            expect(result.duration).toBeGreaterThanOrEqual(0);
        });
        it('should handle query parameters', async () => {
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);
            expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);
        });
        it('should throw error when database is not healthy', async () => {
            // Simulate unhealthy database by directly setting the metrics
            const metrics = databaseManager.getMetrics();
            databaseManager.metrics.isHealthy = false;
            await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');
        });
        it('should handle query errors', async () => {
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');
            const metrics = databaseManager.getMetrics();
            expect(metrics.failedQueries).toBe(1);
        });
    });
    describe('transaction', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute transaction successfully', async () => {
            const callback = jest.fn().mockResolvedValue('success');
            const result = await databaseManager.transaction(callback);
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(callback).toHaveBeenCalledWith(mockClient);
            expect(mockClient.query).toHaveBeenCalledWith('COMMIT');
            expect(result).toBe('success');
        });
        it('should rollback transaction on error', async () => {
            const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));
            await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');
        });
    });
    describe('health monitoring', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should report healthy status when database is working', () => {
            expect(databaseManager.isHealthy()).toBe(true);
        });
        it('should provide connection pool status', () => {
            const status = databaseManager.getPoolStatus();
            expect(status.totalConnections).toBe(5);
            expect(status.idleConnections).toBe(3);
            expect(status.waitingClients).toBe(0);
        });
        it('should provide database metrics', () => {
            const metrics = databaseManager.getMetrics();
            expect(metrics.totalConnections).toBe(5);
            expect(metrics.idleConnections).toBe(3);
            expect(metrics.waitingClients).toBe(0);
            expect(metrics.isHealthy).toBe(true);
        });
    });
    describe('shutdown', () => {
        it('should shutdown gracefully', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await databaseManager.shutdown();
            expect(mockPool.end).toHaveBeenCalled();
        });
        it('should handle shutdown when not initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            await expect(databaseManager.shutdown()).resolves.not.toThrow();
        });
    });
    describe('event emission', () => {
        it('should emit initialized event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const initSpy = jest.fn();
            databaseManager.on('initialized', initSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(initSpy).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should emit query success event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const querySpy = jest.fn();
            databaseManager.on('query:success', querySpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test');
            expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({
                command: 'SELECT',
                rowCount: 1,
                duration: expect.any(Number)
            }));
            await databaseManager.shutdown();
        });
        it('should emit query failure event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const queryFailSpy = jest.fn();
            databaseManager.on('query:failure', queryFailSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();
            expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({
                error: 'Query failed',
                duration: expect.any(Number),
                query: 'SELECT * FROM test'
            }));
            await databaseManager.shutdown();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFvQkgsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztDQUNuRCxDQUFDLENBQUMsQ0FBQztBQXBCSix3RUFBcUY7QUFFckYsaUJBQWlCO0FBQ2pCLE1BQU0sVUFBVSxHQUFHO0lBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ25CLENBQUM7QUFFRixNQUFNLFFBQVEsR0FBRztJQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2xCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2QsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDYixVQUFVLEVBQUUsQ0FBQztJQUNiLFNBQVMsRUFBRSxDQUFDO0lBQ1osWUFBWSxFQUFFLENBQUM7Q0FDaEIsQ0FBQztBQU1GLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFFL0IsTUFBTSxVQUFVLEdBQW1CO1FBQ2pDLElBQUksRUFBRSxXQUFXO1FBQ2pCLElBQUksRUFBRSxJQUFJO1FBQ1YsUUFBUSxFQUFFLFNBQVM7UUFDbkIsSUFBSSxFQUFFLFdBQVc7UUFDakIsUUFBUSxFQUFFLGVBQWU7UUFDekIsR0FBRyxFQUFFLEtBQUs7UUFDVixHQUFHLEVBQUUsQ0FBQztRQUNOLEdBQUcsRUFBRSxFQUFFO1FBQ1AsaUJBQWlCLEVBQUUsS0FBSztRQUN4Qix1QkFB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LENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRTVFLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ2hFLEtBQUssRUFBRSxjQUFjO2dCQUNyQixRQUFRLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7Z0JBQzVCLEtBQUssRUFBRSxvQkFBb0I7YUFDNUIsQ0FBQyxDQUFDLENBQUM7WUFFSixNQUFNLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCB0ZXN0cyBmb3IgRGF0YWJhc2VNYW5hZ2VyXG4gKi9cblxuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyLCBEYXRhYmFzZUNvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZS9EYXRhYmFzZU1hbmFnZXInO1xuXG4vLyBNb2NrIHBnIG1vZHVsZVxuY29uc3QgbW9ja0NsaWVudCA9IHtcbiAgcXVlcnk6IGplc3QuZm4oKSxcbiAgcmVsZWFzZTogamVzdC5mbigpXG59O1xuXG5jb25zdCBtb2NrUG9vbCA9IHtcbiAgY29ubmVjdDogamVzdC5mbigpLFxuICBxdWVyeTogamVzdC5mbigpLFxuICBlbmQ6IGplc3QuZm4oKSxcbiAgb246IGplc3QuZm4oKSxcbiAgdG90YWxDb3VudDogNSxcbiAgaWRsZUNvdW50OiAzLFxuICB3YWl0aW5nQ291bnQ6IDBcbn07XG5cbmplc3QubW9jaygncGcnLCAoKSA9PiAoe1xuICBQb29sOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tQb29sKVxufSkpO1xuXG5kZXNjcmliZSgnRGF0YWJhc2VNYW5hZ2VyJywgKCkgPT4ge1xuXG4gIGNvbnN0IHRlc3RDb25maWc6IERhdGFiYXNlQ29uZmlnID0ge1xuICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgIHBvcnQ6IDU0MzIsXG4gICAgZGF0YWJhc2U6ICd0ZXN0X2RiJyxcbiAgICB1c2VyOiAndGVzdF91c2VyJyxcbiAgICBwYXNzd29yZDogJ3Rlc3RfcGFzc3dvcmQnLFxuICAgIHNzbDogZmFsc2UsXG4gICAgbWluOiAyLFxuICAgIG1heDogMTAsXG4gICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgIGNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzOiAxMDAwMCxcbiAgICBhY3F1aXJlVGltZW91dE1pbGxpczogNTAwMCxcbiAgICBoZWFsdGhDaGVja0ludGVydmFsTXM6IDMwMDAwLFxuICAgIGhlYWx0aENoZWNrVGltZW91dE1zOiA1MDAwLFxuICAgIG1heFJlY29ubmVjdEF0dGVtcHRzOiA1LFxuICAgIHJlY29ubmVjdERlbGF5TXM6IDUwMDBcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBSZXNldCBtb2NrIGltcGxlbWVudGF0aW9uc1xuICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgIG1vY2tDbGllbnQucmVsZWFzZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgIG1vY2tQb29sLmNvbm5lY3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudCk7XG4gICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbXSwgcm93Q291bnQ6IDAsIGNvbW1hbmQ6ICdTRUxFQ1QnIH0pO1xuICAgIG1vY2tQb29sLmVuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlQ29uZmlnRnJvbUVudicsICgpID0+IHtcbiAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudiA9IHsgLi4ub3JpZ2luYWxFbnYgfTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudiA9IG9yaWdpbmFsRW52O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgY29uZmlnIGZyb20gREFUQUJBU0VfVVJMJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gJ3Bvc3RncmVzcWw6Ly91c2VyOnBhc3NAaG9zdDo1NDMzL2RibmFtZT9zc2xtb2RlPXJlcXVpcmUnO1xuICAgICAgXG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ2hvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcucG9ydCkudG9CZSg1NDMzKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2UpLnRvQmUoJ2RibmFtZScpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCd1c2VyJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBhc3N3b3JkKS50b0JlKCdwYXNzJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnNzbCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbmZpZyBmcm9tIGluZGl2aWR1YWwgZW52aXJvbm1lbnQgdmFyaWFibGVzJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuREJfSE9TVCA9ICd0ZXN0LWhvc3QnO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfUE9SVCA9ICc1NDMzJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX05BTUUgPSAndGVzdC1kYic7XG4gICAgICBwcm9jZXNzLmVudi5EQl9VU0VSID0gJ3Rlc3QtdXNlcic7XG4gICAgICBwcm9jZXNzLmVudi5EQl9QQVNTV09SRCA9ICd0ZXN0LXBhc3MnO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfU1NMID0gJ3RydWUnO1xuICAgICAgXG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ3Rlc3QtaG9zdCcpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wb3J0KS50b0JlKDU0MzMpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgndGVzdC1kYicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCd0ZXN0LXVzZXInKTtcbiAgICAgIGV4cGVjdChjb25maWcucGFzc3dvcmQpLnRvQmUoJ3Rlc3QtcGFzcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5zc2wpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHZhbHVlcyB3aGVuIGVudmlyb25tZW50IHZhcmlhYmxlcyBhcmUgbWlzc2luZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IERhdGFiYXNlTWFuYWdlci5jcmVhdGVDb25maWdGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25maWcuaG9zdCkudG9CZSgnbG9jYWxob3N0Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMik7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlKS50b0JlKCd0aXRhbl9icmFpbicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCdwb3N0Z3JlcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5taW4pLnRvQmUoMik7XG4gICAgICBleHBlY3QoY29uZmlnLm1heCkudG9CZSgxMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbml0aWFsaXplJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSBzdWNjZXNzZnVsbHkgd2l0aCB2YWxpZCBjb25maWd1cmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTRUxFQ1QgMScpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucmVsZWFzZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgYWxyZWFkeSBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCkpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2VNYW5hZ2VyIGFscmVhZHkgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25uZWN0aW9uIHRlc3QgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29ubmVjdGlvbiBmYWlsZWQnKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpKS5yZWplY3RzLnRvVGhyb3coJ0Nvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdxdWVyeScsICgpID0+IHtcbiAgICBsZXQgZGF0YWJhc2VNYW5hZ2VyOiBEYXRhYmFzZU1hbmFnZXI7XG4gICAgXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChkYXRhYmFzZU1hbmFnZXIpIHtcbiAgICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgcXVlcnkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEsIG5hbWU6ICd0ZXN0JyB9XSxcbiAgICAgICAgcm93Q291bnQ6IDEsXG4gICAgICAgIGNvbW1hbmQ6ICdTRUxFQ1QnXG4gICAgICB9O1xuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucm93cykudG9FcXVhbChtb2NrUmVzdWx0LnJvd3MpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb3dDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tbWFuZCkudG9CZSgnU0VMRUNUJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcXVlcnkgcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QgV0hFUkUgaWQgPSAkMScsIFsxXSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrUG9vbC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1NFTEVDVCAqIEZST00gdGVzdCBXSEVSRSBpZCA9ICQxJywgWzFdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBkYXRhYmFzZSBpcyBub3QgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIHVuaGVhbHRoeSBkYXRhYmFzZSBieSBkaXJlY3RseSBzZXR0aW5nIHRoZSBtZXRyaWNzXG4gICAgICBjb25zdCBtZXRyaWNzID0gZGF0YWJhc2VNYW5hZ2VyLmdldE1ldHJpY3MoKTtcbiAgICAgIChkYXRhYmFzZU1hbmFnZXIgYXMgYW55KS5tZXRyaWNzLmlzSGVhbHRoeSA9IGZhbHNlO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgMScpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIGlzIG5vdCBoZWFsdGh5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1F1ZXJ5IGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0JykpLnJlamVjdHMudG9UaHJvdygnUXVlcnkgZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBkYXRhYmFzZU1hbmFnZXIuZ2V0TWV0cmljcygpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuZmFpbGVkUXVlcmllcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RyYW5zYWN0aW9uJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIudHJhbnNhY3Rpb24oY2FsbGJhY2spO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JFR0lOJyk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDbGllbnQpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdDT01NSVQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcm9sbGJhY2sgdHJhbnNhY3Rpb24gb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci50cmFuc2FjdGlvbihjYWxsYmFjaykpLnJlamVjdHMudG9UaHJvdygnVHJhbnNhY3Rpb24gZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQkVHSU4nKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnUk9MTEJBQ0snKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWx0aCBtb25pdG9yaW5nJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVwb3J0IGhlYWx0aHkgc3RhdHVzIHdoZW4gZGF0YWJhc2UgaXMgd29ya2luZycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaXNIZWFsdGh5KCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgY29ubmVjdGlvbiBwb29sIHN0YXR1cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGRhdGFiYXNlTWFuYWdlci5nZXRQb29sU3RhdHVzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0dXMudG90YWxDb25uZWN0aW9ucykudG9CZSg1KTtcbiAgICAgIGV4cGVjdChzdGF0dXMuaWRsZUNvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXR1cy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBkYXRhYmFzZSBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtZXRyaWNzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoNSk7XG4gICAgICBleHBlY3QobWV0cmljcy5pZGxlQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3QobWV0cmljcy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmlzSGVhbHRoeSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NodXRkb3duJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2h1dGRvd24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzaHV0ZG93biB3aGVuIG5vdCBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgaW5pdGlhbGl6ZWQgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgY29uc3QgaW5pdFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbignaW5pdGlhbGl6ZWQnLCBpbml0U3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QoaW5pdFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBzdWNjZXNzIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5U3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdxdWVyeTpzdWNjZXNzJywgcXVlcnlTcHkpO1xuICAgICAgXG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIGNvbW1hbmQ6ICdTRUxFQ1QnLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgZHVyYXRpb246IGV4cGVjdC5hbnkoTnVtYmVyKVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBmYWlsdXJlIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5RmFpbFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbigncXVlcnk6ZmFpbHVyZScsIHF1ZXJ5RmFpbFNweSk7XG4gICAgICBcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdRdWVyeSBmYWlsZWQnKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5RmFpbFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBlcnJvcjogJ1F1ZXJ5IGZhaWxlZCcsXG4gICAgICAgIGR1cmF0aW9uOiBleHBlY3QuYW55KE51bWJlciksXG4gICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogRlJPTSB0ZXN0J1xuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=