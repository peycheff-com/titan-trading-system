3bec15b4803b05b58227a71d90456f4e
"use strict";
/**
 * TitanBrain - Master Orchestrator for Titan Trading System
 * Integrates all components: Allocation, Performance, Risk, Capital, and Circuit Breaker
 *
 * Requirements: 1.1, 1.7, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TitanBrain = void 0;
const PrometheusMetrics_js_1 = require("../monitoring/PrometheusMetrics.js");
/**
 * Phase priority for signal processing
 * Requirement 7.1: P3 > P2 > P1
 */
const PHASE_PRIORITY = {
    phase3: 3,
    phase2: 2,
    phase1: 1,
};
/**
 * TitanBrain orchestrates all components and processes signals
 */
class TitanBrain {
    config;
    allocationEngine;
    performanceTracker;
    riskGuardian;
    capitalFlowManager;
    circuitBreaker;
    stateRecoveryService;
    manualOverrideService;
    db;
    /** External integrations */
    executionEngine = null;
    phaseNotifier = null;
    notificationHandler = null;
    /** Signal queue for priority processing */
    signalQueue = [];
    /** Current state */
    currentEquity = 0;
    currentPositions = [];
    recentDecisions = [];
    dailyStartEquity = 0;
    recentTrades = [];
    /** Dashboard cache */
    dashboardCache = null;
    dashboardCacheTime = 0;
    /** Metrics update timer */
    metricsUpdateTimer = null;
    /** Signal approval tracking per phase */
    signalStats = {
        phase1: { approved: 0, total: 0 },
        phase2: { approved: 0, total: 0 },
        phase3: { approved: 0, total: 0 },
    };
    constructor(config, allocationEngine, performanceTracker, riskGuardian, capitalFlowManager, circuitBreaker, db, stateRecoveryService, manualOverrideService) {
        this.config = config;
        this.allocationEngine = allocationEngine;
        this.performanceTracker = performanceTracker;
        this.riskGuardian = riskGuardian;
        this.capitalFlowManager = capitalFlowManager;
        this.circuitBreaker = circuitBreaker;
        this.db = db ?? null;
        this.stateRecoveryService = stateRecoveryService ?? null;
        this.manualOverrideService = manualOverrideService ?? null;
        // Wire up circuit breaker handlers
        this.circuitBreaker.setPositionHandler(this);
        this.circuitBreaker.setEventPersistence(this);
    }
    /**
     * Initialize the brain and start metric updates
     * Requirement 9.4, 9.5: Load state and recalculate metrics on startup
     */
    async initialize() {
        console.log('üß† Initializing Titan Brain...');
        // Recover system state on startup
        if (this.stateRecoveryService) {
            console.log('üìä Recovering system state...');
            const recoveredState = await this.stateRecoveryService.recoverState();
            // Validate recovered state
            if (!this.stateRecoveryService.validateRecoveredState(recoveredState)) {
                console.warn('‚ö†Ô∏è Recovered state validation failed, using defaults');
            }
            else {
                console.log('‚úÖ State recovery completed successfully');
                // Apply recovered allocation if available
                if (recoveredState.allocation) {
                    console.log(`üìà Restored allocation: w1=${recoveredState.allocation.w1}, w2=${recoveredState.allocation.w2}, w3=${recoveredState.allocation.w3}`);
                }
                // Apply recovered high watermark
                if (recoveredState.highWatermark > 0) {
                    await this.capitalFlowManager.setHighWatermark(recoveredState.highWatermark);
                    console.log(`üí∞ Restored high watermark: $${recoveredState.highWatermark}`);
                }
                // Apply recovered performance metrics
                for (const [phaseId, performance] of Object.entries(recoveredState.performance)) {
                    console.log(`üìä Restored performance for ${phaseId}: Sharpe=${performance.sharpeRatio.toFixed(2)}, Modifier=${performance.modifier.toFixed(2)}`);
                }
            }
            // Recalculate risk metrics with current positions
            // Requirement 9.5: Recalculate all risk metrics before accepting new signals
            if (this.currentPositions.length > 0) {
                console.log('üîç Recalculating risk metrics with current positions...');
                const riskMetrics = this.stateRecoveryService.recalculateRiskMetrics(this.currentPositions, this.currentEquity);
                console.log('‚úÖ Risk metrics recalculated');
            }
        }
        // Initialize manual override service
        if (this.manualOverrideService) {
            await this.manualOverrideService.initialize();
            console.log('üîß Manual override service initialized');
        }
        // Initialize capital flow manager
        await this.capitalFlowManager.initialize();
        // Load daily start equity
        this.dailyStartEquity = this.currentEquity;
        this.circuitBreaker.setDailyStartEquity(this.dailyStartEquity);
        // Start periodic metric updates
        this.startMetricUpdates();
        console.log('üß† Titan Brain initialization completed');
    }
    /**
     * Shutdown the brain gracefully
     */
    async shutdown() {
        if (this.metricsUpdateTimer) {
            clearInterval(this.metricsUpdateTimer);
            this.metricsUpdateTimer = null;
        }
    }
    /**
     * Set the execution engine client
     */
    setExecutionEngine(client) {
        this.executionEngine = client;
    }
    /**
     * Set the phase notifier
     */
    setPhaseNotifier(notifier) {
        this.phaseNotifier = notifier;
    }
    /**
     * Set the notification handler
     */
    setNotificationHandler(handler) {
        this.notificationHandler = handler;
        this.circuitBreaker.setNotificationHandler(handler);
        // Set correlation notifier if handler supports it
        if ('sendHighCorrelationWarning' in handler) {
            this.riskGuardian.setCorrelationNotifier(handler);
        }
        // Set sweep notifier if handler supports it
        if ('sendSweepNotification' in handler) {
            this.capitalFlowManager.setSweepNotifier(handler);
        }
    }
    /**
     * Update current equity
     */
    setEquity(equity) {
        this.currentEquity = Math.max(0, equity);
        this.riskGuardian.setEquity(this.currentEquity);
    }
    /**
     * Update current positions
     */
    setPositions(positions) {
        this.currentPositions = positions;
    }
    /**
     * Set daily start equity (called at start of trading day)
     */
    setDailyStartEquity(equity) {
        this.dailyStartEquity = Math.max(0, equity);
        this.circuitBreaker.setDailyStartEquity(this.dailyStartEquity);
    }
    /**
     * Process an intent signal through the full pipeline
     * Requirement 7.5: Maximum latency of 100ms
     *
     * Pipeline:
     * 1. Check circuit breaker
     * 2. Get allocation weights
     * 3. Apply performance modifiers
     * 4. Check risk constraints
     * 5. Calculate authorized size
     * 6. Forward to execution or veto
     *
     * @param signal - Intent signal from a phase
     * @returns BrainDecision with approval status
     */
    async processSignal(signal) {
        const startTime = Date.now();
        const timestamp = startTime;
        // Check circuit breaker first
        if (this.circuitBreaker.isActive()) {
            const decision = this.createVetoDecision(signal, 'Circuit breaker active: all signals rejected', timestamp);
            await this.recordDecision(decision, signal);
            return decision;
        }
        // Check breaker conditions with current state
        const breakerStatus = this.circuitBreaker.checkConditions({
            equity: this.currentEquity,
            positions: this.currentPositions,
            dailyStartEquity: this.dailyStartEquity,
            recentTrades: this.recentTrades,
        });
        if (breakerStatus.active) {
            const decision = this.createVetoDecision(signal, `Circuit breaker triggered: ${breakerStatus.reason}`, timestamp);
            await this.recordDecision(decision, signal);
            return decision;
        }
        // Get allocation weights (with manual override if active)
        const allocation = this.getAllocation();
        // Get performance modifier for the phase
        const performance = await this.performanceTracker.getPhasePerformance(signal.phaseId);
        // Calculate base allocation for this phase
        const phaseWeight = this.getPhaseWeight(signal.phaseId, allocation);
        const adjustedWeight = phaseWeight * performance.modifier;
        // Calculate max position size based on allocation
        // Requirement 1.7: Cap position size at Equity * Phase_Weight
        const maxPositionSize = this.currentEquity * adjustedWeight;
        // Check risk constraints
        const riskDecision = this.riskGuardian.checkSignal(signal, this.currentPositions);
        // Determine final authorized size
        let authorizedSize;
        let approved;
        let reason;
        if (!riskDecision.approved) {
            // Risk veto
            approved = false;
            authorizedSize = 0;
            reason = riskDecision.reason;
        }
        else {
            // Apply all constraints
            const riskAdjustedSize = riskDecision.adjustedSize ?? signal.requestedSize;
            authorizedSize = Math.min(signal.requestedSize, maxPositionSize, riskAdjustedSize);
            // Requirement 1.7: Position size consistency
            if (authorizedSize <= 0) {
                approved = false;
                authorizedSize = 0;
                reason = 'Authorized size is zero after applying constraints';
            }
            else {
                approved = true;
                reason = this.buildApprovalReason(signal.requestedSize, authorizedSize, maxPositionSize, riskDecision);
            }
        }
        const decision = {
            signalId: signal.signalId,
            approved,
            authorizedSize,
            reason,
            allocation,
            performance,
            risk: riskDecision,
            timestamp,
        };
        // Record decision
        await this.recordDecision(decision, signal);
        // Update signal stats
        this.updateSignalStats(signal.phaseId, approved);
        // Forward to execution or notify veto
        if (approved && this.executionEngine) {
            await this.executionEngine.forwardSignal(signal, authorizedSize);
        }
        else if (!approved) {
            // Requirement 7.6: Notify originating phase of veto
            if (this.phaseNotifier) {
                await this.phaseNotifier.notifyVeto(signal.phaseId, signal.signalId, reason);
            }
            // Send veto notification via notification service
            if (this.notificationHandler && 'sendVetoNotification' in this.notificationHandler) {
                try {
                    await this.notificationHandler.sendVetoNotification(signal.phaseId, signal.signalId, signal.symbol, reason, signal.requestedSize);
                }
                catch (error) {
                    console.error('Failed to send veto notification:', error);
                }
            }
        }
        // Check processing latency and record metrics
        const processingTime = Date.now() - startTime;
        if (processingTime > this.config.signalTimeout) {
            console.warn(`Signal processing exceeded timeout: ${processingTime}ms > ${this.config.signalTimeout}ms`);
        }
        // Record metrics
        const metrics = (0, PrometheusMetrics_js_1.getMetrics)();
        metrics.recordSignalLatency(signal.phaseId, processingTime, approved);
        return decision;
    }
    /**
     * Process multiple signals with priority ordering
     * Requirement 7.1: Process in priority order (P3 > P2 > P1)
     *
     * @param signals - Array of intent signals
     * @returns Array of brain decisions
     */
    async processSignals(signals) {
        // Sort by priority (highest first)
        const sortedSignals = [...signals].sort((a, b) => {
            return PHASE_PRIORITY[b.phaseId] - PHASE_PRIORITY[a.phaseId];
        });
        const decisions = [];
        for (const signal of sortedSignals) {
            const decision = await this.processSignal(signal);
            decisions.push(decision);
            // Update positions after each approved signal
            if (decision.approved && this.executionEngine) {
                this.currentPositions = await this.executionEngine.getPositions();
            }
        }
        return decisions;
    }
    /**
     * Enqueue a signal for processing
     * Requirement 7.4: Maintain signal queue with timestamps and phase source
     *
     * @param signal - Intent signal to enqueue
     */
    enqueueSignal(signal) {
        if (this.signalQueue.length >= this.config.maxQueueSize) {
            // Remove oldest signal
            this.signalQueue.shift();
        }
        this.signalQueue.push({
            signal,
            priority: PHASE_PRIORITY[signal.phaseId],
            enqueuedAt: Date.now(),
        });
        // Sort queue by priority
        this.signalQueue.sort((a, b) => b.priority - a.priority);
    }
    /**
     * Process all queued signals
     */
    async processQueue() {
        const signals = this.signalQueue.map(q => q.signal);
        this.signalQueue = [];
        return this.processSignals(signals);
    }
    /**
     * Update all metrics periodically
     * Requirement 1.1: Recalculate allocation every 1 minute or on trade close
     */
    async updateMetrics() {
        // Update allocation
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        // Update capital flow target allocation
        const futuresAllocation = this.currentEquity * (allocation.w1 + allocation.w2);
        this.capitalFlowManager.setTargetAllocation(futuresAllocation);
        // Update high watermark
        await this.capitalFlowManager.updateHighWatermark(this.currentEquity);
        // Check sweep conditions
        await this.capitalFlowManager.performSweepIfNeeded();
        // Invalidate dashboard cache
        this.dashboardCache = null;
        // Update Prometheus metrics
        const metrics = (0, PrometheusMetrics_js_1.getMetrics)();
        metrics.updateEquity(this.currentEquity);
        metrics.updateAllocation(allocation.w1, allocation.w2, allocation.w3);
        metrics.updateCircuitBreakerStatus(this.circuitBreaker.isActive());
        metrics.updateHighWatermark(this.capitalFlowManager.getHighWatermark());
        // Update daily drawdown
        const dailyDrawdown = this.dailyStartEquity > 0
            ? ((this.dailyStartEquity - this.currentEquity) / this.dailyStartEquity) * 100
            : 0;
        metrics.updateDailyDrawdown(Math.max(0, dailyDrawdown));
        // Update phase performance metrics
        for (const phaseId of ['phase1', 'phase2', 'phase3']) {
            const performance = await this.performanceTracker.getPhasePerformance(phaseId);
            metrics.updatePhasePerformance(phaseId, performance.sharpeRatio, performance.modifier);
        }
    }
    /**
     * Record a trade result
     * Updates performance tracking and circuit breaker state
     *
     * @param phaseId - Phase that executed the trade
     * @param pnl - Trade PnL
     * @param symbol - Trading symbol
     * @param side - Trade side
     */
    async recordTrade(phaseId, pnl, symbol, side) {
        const timestamp = Date.now();
        // Record in performance tracker
        await this.performanceTracker.recordTrade(phaseId, pnl, timestamp, symbol, side);
        // Record for circuit breaker
        this.recentTrades.push({ pnl, timestamp });
        this.circuitBreaker.recordTrade(pnl, timestamp);
        // Clean up old trades (keep last hour)
        const oneHourAgo = timestamp - 3600000;
        this.recentTrades = this.recentTrades.filter(t => t.timestamp >= oneHourAgo);
        // Update metrics after trade
        await this.updateMetrics();
    }
    /**
     * Get dashboard data for UI
     * Requirement 10.1-10.7: Dashboard visibility
     *
     * @returns DashboardData with all metrics
     */
    async getDashboardData() {
        // Check cache
        if (this.dashboardCache &&
            Date.now() - this.dashboardCacheTime < this.config.dashboardCacheTTL) {
            return this.dashboardCache;
        }
        // Get allocation
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        // Calculate phase equity
        const phaseEquity = {
            phase1: this.currentEquity * allocation.w1,
            phase2: this.currentEquity * allocation.w2,
            phase3: this.currentEquity * allocation.w3,
        };
        // Get risk metrics
        const riskMetrics = this.riskGuardian.getRiskMetrics(this.currentPositions);
        // Get treasury status
        const treasury = await this.capitalFlowManager.getTreasuryStatus();
        // Get circuit breaker status
        const circuitBreaker = this.circuitBreaker.getStatus();
        // Get recent decisions (last 20)
        const recentDecisions = this.recentDecisions.slice(-20);
        // Get manual override status
        const manualOverride = this.getCurrentManualOverride();
        const warningBannerActive = this.isWarningBannerActive();
        const dashboardData = {
            nav: this.currentEquity,
            allocation,
            phaseEquity,
            riskMetrics: {
                globalLeverage: riskMetrics.currentLeverage,
                netDelta: riskMetrics.portfolioDelta,
                correlationScore: riskMetrics.correlation,
                portfolioBeta: riskMetrics.portfolioBeta,
            },
            treasury,
            circuitBreaker,
            recentDecisions,
            lastUpdated: Date.now(),
            manualOverride: manualOverride ? {
                active: true,
                operatorId: manualOverride.operatorId,
                reason: manualOverride.reason,
                allocation: manualOverride.overrideAllocation,
                expiresAt: manualOverride.expiresAt,
            } : null,
            warningBannerActive,
        };
        // Cache the result
        this.dashboardCache = dashboardData;
        this.dashboardCacheTime = Date.now();
        return dashboardData;
    }
    /**
     * Get system health status
     *
     * @returns HealthStatus with component health
     */
    async getHealthStatus() {
        const errors = [];
        const components = {
            database: false,
            redis: false,
            executionEngine: false,
            phases: {
                phase1: false,
                phase2: false,
                phase3: false,
            },
        };
        // Check database
        if (this.db) {
            try {
                await this.db.query('SELECT 1');
                components.database = true;
            }
            catch (error) {
                errors.push(`Database: ${error instanceof Error ? error.message : 'Unknown error'}`);
            }
        }
        else {
            // For Railway deployment without database, consider it healthy
            components.database = true;
        }
        // Check execution engine (optional for Railway)
        if (this.executionEngine) {
            try {
                await this.executionEngine.getPositions();
                components.executionEngine = true;
            }
            catch (error) {
                errors.push(`Execution Engine: ${error instanceof Error ? error.message : 'Unknown error'}`);
            }
        }
        else {
            // For Railway deployment without execution engine, consider it healthy
            components.executionEngine = true;
        }
        // Check phase approval rates
        // Requirement 7.8: Flag for review if approval rate < 50%
        for (const phaseId of ['phase1', 'phase2', 'phase3']) {
            const stats = this.signalStats[phaseId];
            if (stats.total > 0) {
                const approvalRate = stats.approved / stats.total;
                components.phases[phaseId] = approvalRate >= 0.5;
                if (approvalRate < 0.5) {
                    errors.push(`${phaseId}: Approval rate ${(approvalRate * 100).toFixed(1)}% < 50%`);
                }
            }
            else {
                components.phases[phaseId] = true; // No signals yet
            }
        }
        // For Railway deployment, be more lenient with health checks
        const isRailwayDeployment = process.env.RAILWAY_ENVIRONMENT === 'true';
        const healthy = isRailwayDeployment ?
            // Railway: Just check that the service is running (phases are healthy)
            Object.values(components.phases).every(Boolean) :
            // Local: Check all components
            components.database &&
                components.executionEngine &&
                Object.values(components.phases).every(Boolean);
        return {
            healthy,
            components,
            lastCheck: Date.now(),
            errors,
        };
    }
    /**
     * Get signal approval rate for a phase
     * Requirement 7.7: Track signal approval rate per phase
     *
     * @param phaseId - Phase to check
     * @returns Approval rate (0-1)
     */
    getApprovalRate(phaseId) {
        const stats = this.signalStats[phaseId];
        if (stats.total === 0)
            return 1.0;
        return stats.approved / stats.total;
    }
    /**
     * Get all phase approval rates
     */
    getAllApprovalRates() {
        return {
            phase1: this.getApprovalRate('phase1'),
            phase2: this.getApprovalRate('phase2'),
            phase3: this.getApprovalRate('phase3'),
        };
    }
    /**
     * Reset signal stats (e.g., at start of day)
     */
    resetSignalStats() {
        this.signalStats = {
            phase1: { approved: 0, total: 0 },
            phase2: { approved: 0, total: 0 },
            phase3: { approved: 0, total: 0 },
        };
    }
    /**
     * Get current allocation vector (with manual override if active)
     * Requirement 9.7: Support manual override of allocation weights
     */
    getAllocation() {
        const normalAllocation = this.allocationEngine.getWeights(this.currentEquity);
        // Apply manual override if active
        if (this.manualOverrideService) {
            return this.manualOverrideService.getEffectiveAllocation(normalAllocation);
        }
        return normalAllocation;
    }
    /**
     * Get current equity
     */
    getEquity() {
        return this.currentEquity;
    }
    /**
     * Get current positions
     */
    getPositions() {
        return [...this.currentPositions];
    }
    /**
     * Get circuit breaker status
     */
    getCircuitBreakerStatus() {
        return this.circuitBreaker.getStatus();
    }
    /**
     * Manually reset circuit breaker
     * Requirement 5.8: Require operator ID
     *
     * @param operatorId - ID of operator performing reset
     */
    async resetCircuitBreaker(operatorId) {
        await this.circuitBreaker.reset(operatorId);
    }
    /**
     * Get configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Create a manual allocation override
     * Requirement 9.7: Create admin endpoint for allocation override
     *
     * @param operatorId - Operator creating the override
     * @param password - Operator password
     * @param allocation - New allocation vector
     * @param reason - Reason for override
     * @param durationHours - Optional duration in hours
     * @returns True if override created successfully
     */
    async createManualOverride(operatorId, password, allocation, reason, durationHours) {
        if (!this.manualOverrideService) {
            console.error('Manual override service not available');
            return false;
        }
        // Authenticate operator
        const authenticated = await this.manualOverrideService.authenticateOperator(operatorId, password);
        if (!authenticated) {
            console.warn(`Manual override rejected: authentication failed for operator ${operatorId}`);
            return false;
        }
        // Create override
        const override = await this.manualOverrideService.createOverride({
            operatorId,
            allocation,
            reason,
            durationHours,
        });
        if (override) {
            console.log(`‚úÖ Manual override created by operator ${operatorId}`);
            console.log(`   New allocation: w1=${allocation.w1}, w2=${allocation.w2}, w3=${allocation.w3}`);
            console.log(`   Reason: ${reason}`);
            // Invalidate dashboard cache to show warning banner
            this.dashboardCache = null;
            return true;
        }
        return false;
    }
    /**
     * Deactivate the current manual override
     *
     * @param operatorId - Operator deactivating the override
     * @param password - Operator password
     * @returns True if successfully deactivated
     */
    async deactivateManualOverride(operatorId, password) {
        if (!this.manualOverrideService) {
            console.error('Manual override service not available');
            return false;
        }
        // Authenticate operator
        const authenticated = await this.manualOverrideService.authenticateOperator(operatorId, password);
        if (!authenticated) {
            console.warn(`Manual override deactivation rejected: authentication failed for operator ${operatorId}`);
            return false;
        }
        const success = await this.manualOverrideService.deactivateOverride(operatorId);
        if (success) {
            console.log(`‚úÖ Manual override deactivated by operator ${operatorId}`);
            // Invalidate dashboard cache to hide warning banner
            this.dashboardCache = null;
        }
        return success;
    }
    /**
     * Get current manual override status
     *
     * @returns Current override or null if none active
     */
    getCurrentManualOverride() {
        if (!this.manualOverrideService)
            return null;
        return this.manualOverrideService.getCurrentOverride();
    }
    /**
     * Check if warning banner should be displayed
     * Requirement 9.8: Implement warning banner flag
     *
     * @returns True if warning banner should be shown
     */
    isWarningBannerActive() {
        if (!this.manualOverrideService)
            return false;
        return this.manualOverrideService.isWarningBannerActive();
    }
    /**
     * Get manual override history
     *
     * @param operatorId - Optional operator filter
     * @param limit - Maximum number of records
     * @returns Array of historical overrides
     */
    async getManualOverrideHistory(operatorId, limit = 50) {
        if (!this.manualOverrideService)
            return [];
        return this.manualOverrideService.getOverrideHistory(operatorId, limit);
    }
    /**
     * Create a new operator account
     *
     * @param operatorId - Unique operator identifier
     * @param password - Operator password
     * @param permissions - Array of permissions
     * @returns True if created successfully
     */
    async createOperator(operatorId, password, permissions) {
        if (!this.manualOverrideService) {
            console.error('Manual override service not available');
            return false;
        }
        return this.manualOverrideService.createOperator(operatorId, password, permissions);
    }
    // ============ PositionClosureHandler Implementation ============
    /**
     * Close all positions (called by circuit breaker)
     */
    async closeAllPositions() {
        if (this.executionEngine) {
            await this.executionEngine.closeAllPositions();
            this.currentPositions = [];
        }
    }
    // ============ BreakerEventPersistence Implementation ============
    /**
     * Persist circuit breaker event to database
     */
    async persistEvent(event) {
        if (!this.db)
            return;
        await this.db.query(`INSERT INTO circuit_breaker_events 
       (timestamp, event_type, reason, equity, operator_id, metadata)
       VALUES ($1, $2, $3, $4, $5, $6)`, [
            event.timestamp,
            event.eventType,
            event.reason,
            event.equity,
            event.operatorId ?? null,
            event.metadata ? JSON.stringify(event.metadata) : null,
        ]);
    }
    // ============ Private Helper Methods ============
    /**
     * Start periodic metric updates
     */
    startMetricUpdates() {
        if (this.metricsUpdateTimer) {
            clearInterval(this.metricsUpdateTimer);
        }
        this.metricsUpdateTimer = setInterval(async () => {
            try {
                await this.updateMetrics();
            }
            catch (error) {
                console.error('Error updating metrics:', error);
            }
        }, this.config.metricUpdateInterval);
    }
    /**
     * Get phase weight from allocation vector
     */
    getPhaseWeight(phaseId, allocation) {
        switch (phaseId) {
            case 'phase1':
                return allocation.w1;
            case 'phase2':
                return allocation.w2;
            case 'phase3':
                return allocation.w3;
            default:
                return 0;
        }
    }
    /**
     * Create a veto decision
     */
    createVetoDecision(signal, reason, timestamp) {
        const allocation = this.allocationEngine.getWeights(this.currentEquity);
        const riskMetrics = this.riskGuardian.getRiskMetrics(this.currentPositions);
        return {
            signalId: signal.signalId,
            approved: false,
            authorizedSize: 0,
            reason,
            allocation,
            performance: {
                phaseId: signal.phaseId,
                sharpeRatio: 0,
                totalPnL: 0,
                tradeCount: 0,
                winRate: 0,
                avgWin: 0,
                avgLoss: 0,
                modifier: 1.0,
            },
            risk: {
                approved: false,
                reason,
                riskMetrics,
            },
            timestamp,
        };
    }
    /**
     * Build approval reason string
     */
    buildApprovalReason(requestedSize, authorizedSize, maxPositionSize, riskDecision) {
        const parts = ['Signal approved'];
        if (authorizedSize < requestedSize) {
            const reductions = [];
            if (authorizedSize <= maxPositionSize && requestedSize > maxPositionSize) {
                reductions.push(`allocation cap (${maxPositionSize.toFixed(2)})`);
            }
            if (riskDecision.adjustedSize && riskDecision.adjustedSize < requestedSize) {
                reductions.push(`risk adjustment`);
            }
            if (reductions.length > 0) {
                parts.push(`with size reduction due to ${reductions.join(', ')}`);
            }
        }
        return parts.join(' ');
    }
    /**
     * Record a decision to database and memory
     */
    async recordDecision(decision, signal) {
        // Add to recent decisions
        this.recentDecisions.push(decision);
        // Keep only last 100 decisions in memory
        if (this.recentDecisions.length > 100) {
            this.recentDecisions.shift();
        }
        // Persist to database
        if (this.db) {
            const record = {
                signalId: signal.signalId,
                phaseId: signal.phaseId,
                timestamp: decision.timestamp,
                approved: decision.approved,
                requestedSize: signal.requestedSize,
                authorizedSize: decision.approved ? decision.authorizedSize : null,
                reason: decision.reason,
                riskMetrics: decision.risk.riskMetrics,
            };
            await this.db.query(`INSERT INTO brain_decisions 
         (signal_id, phase_id, timestamp, approved, requested_size, authorized_size, reason, risk_metrics)
         VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
         ON CONFLICT (signal_id) DO NOTHING`, [
                record.signalId,
                record.phaseId,
                record.timestamp,
                record.approved,
                record.requestedSize,
                record.authorizedSize,
                record.reason,
                record.riskMetrics ? JSON.stringify(record.riskMetrics) : null,
            ]);
        }
    }
    /**
     * Update signal statistics
     */
    updateSignalStats(phaseId, approved) {
        this.signalStats[phaseId].total++;
        if (approved) {
            this.signalStats[phaseId].approved++;
        }
    }
    /**
     * Calculate net position for opposite signals
     * Requirement 7.3: Calculate net position for opposite signals on same asset
     *
     * @param signals - Array of signals for the same asset
     * @returns Net position size and direction
     */
    calculateNetPosition(signals) {
        let netSize = 0;
        for (const signal of signals) {
            if (signal.side === 'BUY') {
                netSize += signal.requestedSize;
            }
            else {
                netSize -= signal.requestedSize;
            }
        }
        if (netSize > 0) {
            return { netSize, side: 'BUY' };
        }
        else if (netSize < 0) {
            return { netSize: Math.abs(netSize), side: 'SELL' };
        }
        else {
            return { netSize: 0, side: 'NEUTRAL' };
        }
    }
    /**
     * Get recent decisions
     *
     * @param limit - Maximum number of decisions to return
     * @returns Array of recent decisions
     */
    getRecentDecisions(limit = 20) {
        return this.recentDecisions.slice(-limit);
    }
    /**
     * Export dashboard data to JSON
     * Requirement 10.8: Support exporting dashboard data to JSON
     *
     * @returns JSON string of dashboard data
     */
    async exportDashboardJSON() {
        const data = await this.getDashboardData();
        return JSON.stringify(data, null, 2);
    }
    /**
     * Get performance for all phases
     */
    async getAllPhasePerformance() {
        return this.performanceTracker.getAllPhasePerformance();
    }
    /**
     * Get treasury status
     */
    async getTreasuryStatus() {
        return this.capitalFlowManager.getTreasuryStatus();
    }
    /**
     * Get next sweep trigger level
     */
    getNextSweepTriggerLevel() {
        return this.capitalFlowManager.getNextSweepTriggerLevel();
    }
    /**
     * Get total swept amount
     */
    getTotalSwept() {
        return this.capitalFlowManager.getTotalSwept();
    }
    /**
     * Get high watermark
     */
    getHighWatermark() {
        return this.capitalFlowManager.getHighWatermark();
    }
    /**
     * Update price history for correlation calculations
     *
     * @param symbol - Asset symbol
     * @param price - Current price
     */
    updatePriceHistory(symbol, price) {
        this.riskGuardian.updatePriceHistory(symbol, price);
    }
}
exports.TitanBrain = TitanBrain;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9lbmdpbmUvVGl0YW5CcmFpbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQXlCSCw2RUFBZ0U7QUFJaEU7OztHQUdHO0FBQ0gsTUFBTSxjQUFjLEdBQTRCO0lBQzlDLE1BQU0sRUFBRSxDQUFDO0lBQ1QsTUFBTSxFQUFFLENBQUM7SUFDVCxNQUFNLEVBQUUsQ0FBQztDQUNWLENBQUM7QUFrQkY7O0dBRUc7QUFDSCxNQUFhLFVBQVU7SUFDSixNQUFNLENBQWM7SUFDcEIsZ0JBQWdCLENBQW1CO0lBQ25DLGtCQUFrQixDQUFxQjtJQUN2QyxZQUFZLENBQWU7SUFDM0Isa0JBQWtCLENBQXFCO0lBQ3ZDLGNBQWMsQ0FBaUI7SUFDL0Isb0JBQW9CLENBQThCO0lBQ2xELHFCQUFxQixDQUErQjtJQUNwRCxFQUFFLENBQXlCO0lBRTVDLDRCQUE0QjtJQUNwQixlQUFlLEdBQWlDLElBQUksQ0FBQztJQUNyRCxhQUFhLEdBQXlCLElBQUksQ0FBQztJQUMzQyxtQkFBbUIsR0FBK0IsSUFBSSxDQUFDO0lBRS9ELDJDQUEyQztJQUNuQyxXQUFXLEdBQW1CLEVBQUUsQ0FBQztJQUV6QyxvQkFBb0I7SUFDWixhQUFhLEdBQVcsQ0FBQyxDQUFDO0lBQzFCLGdCQUFnQixHQUFlLEVBQUUsQ0FBQztJQUNsQyxlQUFlLEdBQW9CLEVBQUUsQ0FBQztJQUN0QyxnQkFBZ0IsR0FBVyxDQUFDLENBQUM7SUFDN0IsWUFBWSxHQUE4QyxFQUFFLENBQUM7SUFFckUsc0JBQXNCO0lBQ2QsY0FBYyxHQUF5QixJQUFJLENBQUM7SUFDNUMsa0JBQWtCLEdBQVcsQ0FBQyxDQUFDO0lBRXZDLDJCQUEyQjtJQUNuQixrQkFBa0IsR0FBMEIsSUFBSSxDQUFDO0lBRXpELHlDQUF5QztJQUNqQyxXQUFXLEdBQXlEO1FBQzFFLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMs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QUtHO0lBQ0gsa0JBQWtCLENBQUMsTUFBYyxFQUFFLEtBQWE7UUFDOUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEQsQ0FBQztDQUNGO0FBam9DRCxnQ0Fpb0NDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi9zcmMvZW5naW5lL1RpdGFuQnJhaW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaXRhbkJyYWluIC0gTWFzdGVyIE9yY2hlc3RyYXRvciBmb3IgVGl0YW4gVHJhZGluZyBTeXN0ZW1cbiAqIEludGVncmF0ZXMgYWxsIGNvbXBvbmVudHM6IEFsbG9jYXRpb24sIFBlcmZvcm1hbmNlLCBSaXNrLCBDYXBpdGFsLCBhbmQgQ2lyY3VpdCBCcmVha2VyXG4gKiBcbiAqIFJlcXVpcmVtZW50czogMS4xLCAxLjcsIDcuMSwgNy4yLCA3LjMsIDcuNCwgNy41LCA3LjZcbiAqL1xuXG5pbXBvcnQge1xuICBJbnRlbnRTaWduYWwsXG4gIFBvc2l0aW9uLFxuICBCcmFpbkRlY2lzaW9uLFxuICBEYXNoYm9hcmREYXRhLFxuICBIZWFsdGhTdGF0dXMsXG4gIFF1ZXVlZFNpZ25hbCxcbiAgQnJhaW5Db25maWcsXG4gIEFsbG9jYXRpb25WZWN0b3IsXG4gIFBoYXNlSWQsXG4gIFBoYXNlUGVyZm9ybWFuY2UsXG4gIFJpc2tEZWNpc2lvbixcbiAgUmlza01ldHJpY3MsXG4gIFRyZWFzdXJ5U3RhdHVzLFxuICBCcmVha2VyU3RhdHVzLFxuICBEZWNpc2lvblJlY29yZCxcbn0gZnJvbSAnLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgQWxsb2NhdGlvbkVuZ2luZSB9IGZyb20gJy4vQWxsb2NhdGlvbkVuZ2luZS5qcyc7XG5pbXBvcnQgeyBQZXJmb3JtYW5jZVRyYWNrZXIgfSBmcm9tICcuL1BlcmZvcm1hbmNlVHJhY2tlci5qcyc7XG5pbXBvcnQgeyBSaXNrR3VhcmRpYW4sIEhpZ2hDb3JyZWxhdGlvbk5vdGlmaWVyIH0gZnJvbSAnLi9SaXNrR3VhcmRpYW4uanMnO1xuaW1wb3J0IHsgQ2FwaXRhbEZsb3dNYW5hZ2VyLCBTd2VlcE5vdGlmaWVyIH0gZnJvbSAnLi9DYXBpdGFsRmxvd01hbmFnZXIuanMnO1xuaW1wb3J0IHsgQ2lyY3VpdEJyZWFrZXIsIFBvc2l0aW9uQ2xvc3VyZUhhbmRsZXIsIE5vdGlmaWNhdGlvbkhhbmRsZXIsIEJyZWFrZXJFdmVudFBlcnNpc3RlbmNlIH0gZnJvbSAnLi9DaXJjdWl0QnJlYWtlci5qcyc7XG5pbXBvcnQgeyBTdGF0ZVJlY292ZXJ5U2VydmljZSwgUmVjb3ZlcmVkU3RhdGUgfSBmcm9tICcuL1N0YXRlUmVjb3ZlcnlTZXJ2aWNlLmpzJztcbmltcG9ydCB7IGdldE1ldHJpY3MgfSBmcm9tICcuLi9tb25pdG9yaW5nL1Byb21ldGhldXNNZXRyaWNzLmpzJztcbmltcG9ydCB7IE1hbnVhbE92ZXJyaWRlU2VydmljZSB9IGZyb20gJy4vTWFudWFsT3ZlcnJpZGVTZXJ2aWNlLmpzJztcbmltcG9ydCB7IERhdGFiYXNlTWFuYWdlciB9IGZyb20gJy4uL2RiL0RhdGFiYXNlTWFuYWdlci5qcyc7XG5cbi8qKlxuICogUGhhc2UgcHJpb3JpdHkgZm9yIHNpZ25hbCBwcm9jZXNzaW5nXG4gKiBSZXF1aXJlbWVudCA3LjE6IFAzID4gUDIgPiBQMVxuICovXG5jb25zdCBQSEFTRV9QUklPUklUWTogUmVjb3JkPFBoYXNlSWQsIG51bWJlcj4gPSB7XG4gIHBoYXNlMzogMyxcbiAgcGhhc2UyOiAyLFxuICBwaGFzZTE6IDEsXG59O1xuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgZXhlY3V0aW9uIGVuZ2luZSBjb21tdW5pY2F0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXhlY3V0aW9uRW5naW5lQ2xpZW50IHtcbiAgZm9yd2FyZFNpZ25hbChzaWduYWw6IEludGVudFNpZ25hbCwgYXV0aG9yaXplZFNpemU6IG51bWJlcik6IFByb21pc2U8dm9pZD47XG4gIGNsb3NlQWxsUG9zaXRpb25zKCk6IFByb21pc2U8dm9pZD47XG4gIGdldFBvc2l0aW9ucygpOiBQcm9taXNlPFBvc2l0aW9uW10+O1xufVxuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgcGhhc2Ugbm90aWZpY2F0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGhhc2VOb3RpZmllciB7XG4gIG5vdGlmeVZldG8ocGhhc2VJZDogUGhhc2VJZCwgc2lnbmFsSWQ6IHN0cmluZywgcmVhc29uOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG4vKipcbiAqIFRpdGFuQnJhaW4gb3JjaGVzdHJhdGVzIGFsbCBjb21wb25lbnRzIGFuZCBwcm9jZXNzZXMgc2lnbmFsc1xuICovXG5leHBvcnQgY2xhc3MgVGl0YW5CcmFpbiBpbXBsZW1lbnRzIFBvc2l0aW9uQ2xvc3VyZUhhbmRsZXIsIEJyZWFrZXJFdmVudFBlcnNpc3RlbmNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBjb25maWc6IEJyYWluQ29uZmlnO1xuICBwcml2YXRlIHJlYWRvbmx5IGFsbG9jYXRpb25FbmdpbmU6IEFsbG9jYXRpb25FbmdpbmU7XG4gIHByaXZhdGUgcmVhZG9ubHkgcGVyZm9ybWFuY2VUcmFja2VyOiBQZXJmb3JtYW5jZVRyYWNrZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmlza0d1YXJkaWFuOiBSaXNrR3VhcmRpYW47XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FwaXRhbEZsb3dNYW5hZ2VyOiBDYXBpdGFsRmxvd01hbmFnZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2lyY3VpdEJyZWFrZXI6IENpcmN1aXRCcmVha2VyO1xuICBwcml2YXRlIHJlYWRvbmx5IHN0YXRlUmVjb3ZlcnlTZXJ2aWNlOiBTdGF0ZVJlY292ZXJ5U2VydmljZSB8IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWFudWFsT3ZlcnJpZGVTZXJ2aWNlOiBNYW51YWxPdmVycmlkZVNlcnZpY2UgfCBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IGRiOiBEYXRhYmFzZU1hbmFnZXIgfCBudWxsO1xuXG4gIC8qKiBFeHRlcm5hbCBpbnRlZ3JhdGlvbnMgKi9cbiAgcHJpdmF0ZSBleGVjdXRpb25FbmdpbmU6IEV4ZWN1dGlvbkVuZ2luZUNsaWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBoYXNlTm90aWZpZXI6IFBoYXNlTm90aWZpZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBub3RpZmljYXRpb25IYW5kbGVyOiBOb3RpZmljYXRpb25IYW5kbGVyIHwgbnVsbCA9IG51bGw7XG5cbiAgLyoqIFNpZ25hbCBxdWV1ZSBmb3IgcHJpb3JpdHkgcHJvY2Vzc2luZyAqL1xuICBwcml2YXRlIHNpZ25hbFF1ZXVlOiBRdWV1ZWRTaWduYWxbXSA9IFtdO1xuXG4gIC8qKiBDdXJyZW50IHN0YXRlICovXG4gIHByaXZhdGUgY3VycmVudEVxdWl0eTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBjdXJyZW50UG9zaXRpb25zOiBQb3NpdGlvbltdID0gW107XG4gIHByaXZhdGUgcmVjZW50RGVjaXNpb25zOiBCcmFpbkRlY2lzaW9uW10gPSBbXTtcbiAgcHJpdmF0ZSBkYWlseVN0YXJ0RXF1aXR5OiBudW1iZXIgPSAwO1xuICBwcml2YXRlIHJlY2VudFRyYWRlczogQXJyYXk8eyBwbmw6IG51bWJlcjsgdGltZXN0YW1wOiBudW1iZXIgfT4gPSBbXTtcblxuICAvKiogRGFzaGJvYXJkIGNhY2hlICovXG4gIHByaXZhdGUgZGFzaGJvYXJkQ2FjaGU6IERhc2hib2FyZERhdGEgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkYXNoYm9hcmRDYWNoZVRpbWU6IG51bWJlciA9IDA7XG5cbiAgLyoqIE1ldHJpY3MgdXBkYXRlIHRpbWVyICovXG4gIHByaXZhdGUgbWV0cmljc1VwZGF0ZVRpbWVyOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gIC8qKiBTaWduYWwgYXBwcm92YWwgdHJhY2tpbmcgcGVyIHBoYXNlICovXG4gIHByaXZhdGUgc2lnbmFsU3RhdHM6IFJlY29yZDxQaGFzZUlkLCB7IGFwcHJvdmVkOiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfT4gPSB7XG4gICAgcGhhc2UxOiB7IGFwcHJvdmVkOiAwLCB0b3RhbDogMCB9LFxuICAgIHBoYXNlMjogeyBhcHByb3ZlZDogMCwgdG90YWw6IDAgfSxcbiAgICBwaGFzZTM6IHsgYXBwcm92ZWQ6IDAsIHRvdGFsOiAwIH0sXG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgY29uZmlnOiBCcmFpbkNvbmZpZyxcbiAgICBhbGxvY2F0aW9uRW5naW5lOiBBbGxvY2F0aW9uRW5naW5lLFxuICAgIHBlcmZvcm1hbmNlVHJhY2tlcjogUGVyZm9ybWFuY2VUcmFja2VyLFxuICAgIHJpc2tHdWFyZGlhbjogUmlza0d1YXJkaWFuLFxuICAgIGNhcGl0YWxGbG93TWFuYWdlcjogQ2FwaXRhbEZsb3dNYW5hZ2VyLFxuICAgIGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlcixcbiAgICBkYj86IERhdGFiYXNlTWFuYWdlcixcbiAgICBzdGF0ZVJlY292ZXJ5U2VydmljZT86IFN0YXRlUmVjb3ZlcnlTZXJ2aWNlLFxuICAgIG1hbnVhbE92ZXJyaWRlU2VydmljZT86IE1hbnVhbE92ZXJyaWRlU2VydmljZVxuICApIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLmFsbG9jYXRpb25FbmdpbmUgPSBhbGxvY2F0aW9uRW5naW5lO1xuICAgIHRoaXMucGVyZm9ybWFuY2VUcmFja2VyID0gcGVyZm9ybWFuY2VUcmFja2VyO1xuICAgIHRoaXMucmlza0d1YXJkaWFuID0gcmlza0d1YXJkaWFuO1xuICAgIHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyID0gY2FwaXRhbEZsb3dNYW5hZ2VyO1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIgPSBjaXJjdWl0QnJlYWtlcjtcbiAgICB0aGlzLmRiID0gZGIgPz8gbnVsbDtcbiAgICB0aGlzLnN0YXRlUmVjb3ZlcnlTZXJ2aWNlID0gc3RhdGVSZWNvdmVyeVNlcnZpY2UgPz8gbnVsbDtcbiAgICB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSA9IG1hbnVhbE92ZXJyaWRlU2VydmljZSA/PyBudWxsO1xuXG4gICAgLy8gV2lyZSB1cCBjaXJjdWl0IGJyZWFrZXIgaGFuZGxlcnNcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLnNldFBvc2l0aW9uSGFuZGxlcih0aGlzKTtcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLnNldEV2ZW50UGVyc2lzdGVuY2UodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgYnJhaW4gYW5kIHN0YXJ0IG1ldHJpYyB1cGRhdGVzXG4gICAqIFJlcXVpcmVtZW50IDkuNCwgOS41OiBMb2FkIHN0YXRlIGFuZCByZWNhbGN1bGF0ZSBtZXRyaWNzIG9uIHN0YXJ0dXBcbiAgICovXG4gIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ/Cfp6AgSW5pdGlhbGl6aW5nIFRpdGFuIEJyYWluLi4uJyk7XG5cbiAgICAvLyBSZWNvdmVyIHN5c3RlbSBzdGF0ZSBvbiBzdGFydHVwXG4gICAgaWYgKHRoaXMuc3RhdGVSZWNvdmVyeVNlcnZpY2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OKIFJlY292ZXJpbmcgc3lzdGVtIHN0YXRlLi4uJyk7XG4gICAgICBjb25zdCByZWNvdmVyZWRTdGF0ZSA9IGF3YWl0IHRoaXMuc3RhdGVSZWNvdmVyeVNlcnZpY2UucmVjb3ZlclN0YXRlKCk7XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHJlY292ZXJlZCBzdGF0ZVxuICAgICAgaWYgKCF0aGlzLnN0YXRlUmVjb3ZlcnlTZXJ2aWNlLnZhbGlkYXRlUmVjb3ZlcmVkU3RhdGUocmVjb3ZlcmVkU3RhdGUpKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIFJlY292ZXJlZCBzdGF0ZSB2YWxpZGF0aW9uIGZhaWxlZCwgdXNpbmcgZGVmYXVsdHMnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgU3RhdGUgcmVjb3ZlcnkgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICBcbiAgICAgICAgLy8gQXBwbHkgcmVjb3ZlcmVkIGFsbG9jYXRpb24gaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChyZWNvdmVyZWRTdGF0ZS5hbGxvY2F0aW9uKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfk4ggUmVzdG9yZWQgYWxsb2NhdGlvbjogdzE9JHtyZWNvdmVyZWRTdGF0ZS5hbGxvY2F0aW9uLncxfSwgdzI9JHtyZWNvdmVyZWRTdGF0ZS5hbGxvY2F0aW9uLncyfSwgdzM9JHtyZWNvdmVyZWRTdGF0ZS5hbGxvY2F0aW9uLnczfWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBcHBseSByZWNvdmVyZWQgaGlnaCB3YXRlcm1hcmtcbiAgICAgICAgaWYgKHJlY292ZXJlZFN0YXRlLmhpZ2hXYXRlcm1hcmsgPiAwKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuc2V0SGlnaFdhdGVybWFyayhyZWNvdmVyZWRTdGF0ZS5oaWdoV2F0ZXJtYXJrKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+SsCBSZXN0b3JlZCBoaWdoIHdhdGVybWFyazogJCR7cmVjb3ZlcmVkU3RhdGUuaGlnaFdhdGVybWFya31gKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQXBwbHkgcmVjb3ZlcmVkIHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAgICAgICAgZm9yIChjb25zdCBbcGhhc2VJZCwgcGVyZm9ybWFuY2VdIG9mIE9iamVjdC5lbnRyaWVzKHJlY292ZXJlZFN0YXRlLnBlcmZvcm1hbmNlKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OKIFJlc3RvcmVkIHBlcmZvcm1hbmNlIGZvciAke3BoYXNlSWR9OiBTaGFycGU9JHtwZXJmb3JtYW5jZS5zaGFycGVSYXRpby50b0ZpeGVkKDIpfSwgTW9kaWZpZXI9JHtwZXJmb3JtYW5jZS5tb2RpZmllci50b0ZpeGVkKDIpfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFJlY2FsY3VsYXRlIHJpc2sgbWV0cmljcyB3aXRoIGN1cnJlbnQgcG9zaXRpb25zXG4gICAgICAvLyBSZXF1aXJlbWVudCA5LjU6IFJlY2FsY3VsYXRlIGFsbCByaXNrIG1ldHJpY3MgYmVmb3JlIGFjY2VwdGluZyBuZXcgc2lnbmFsc1xuICAgICAgaWYgKHRoaXMuY3VycmVudFBvc2l0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFJlY2FsY3VsYXRpbmcgcmlzayBtZXRyaWNzIHdpdGggY3VycmVudCBwb3NpdGlvbnMuLi4nKTtcbiAgICAgICAgY29uc3Qgcmlza01ldHJpY3MgPSB0aGlzLnN0YXRlUmVjb3ZlcnlTZXJ2aWNlLnJlY2FsY3VsYXRlUmlza01ldHJpY3MoXG4gICAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb25zLFxuICAgICAgICAgIHRoaXMuY3VycmVudEVxdWl0eVxuICAgICAgICApO1xuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFJpc2sgbWV0cmljcyByZWNhbGN1bGF0ZWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIG1hbnVhbCBvdmVycmlkZSBzZXJ2aWNlXG4gICAgaWYgKHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlKSB7XG4gICAgICBhd2FpdCB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBNYW51YWwgb3ZlcnJpZGUgc2VydmljZSBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIC8vIEluaXRpYWxpemUgY2FwaXRhbCBmbG93IG1hbmFnZXJcbiAgICBhd2FpdCB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5pbml0aWFsaXplKCk7XG5cbiAgICAvLyBMb2FkIGRhaWx5IHN0YXJ0IGVxdWl0eVxuICAgIHRoaXMuZGFpbHlTdGFydEVxdWl0eSA9IHRoaXMuY3VycmVudEVxdWl0eTtcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLnNldERhaWx5U3RhcnRFcXVpdHkodGhpcy5kYWlseVN0YXJ0RXF1aXR5KTtcblxuICAgIC8vIFN0YXJ0IHBlcmlvZGljIG1ldHJpYyB1cGRhdGVzXG4gICAgdGhpcy5zdGFydE1ldHJpY1VwZGF0ZXMoKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+noCBUaXRhbiBCcmFpbiBpbml0aWFsaXphdGlvbiBjb21wbGV0ZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaHV0ZG93biB0aGUgYnJhaW4gZ3JhY2VmdWxseVxuICAgKi9cbiAgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMubWV0cmljc1VwZGF0ZVRpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMubWV0cmljc1VwZGF0ZVRpbWVyKTtcbiAgICAgIHRoaXMubWV0cmljc1VwZGF0ZVRpbWVyID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBleGVjdXRpb24gZW5naW5lIGNsaWVudFxuICAgKi9cbiAgc2V0RXhlY3V0aW9uRW5naW5lKGNsaWVudDogRXhlY3V0aW9uRW5naW5lQ2xpZW50KTogdm9pZCB7XG4gICAgdGhpcy5leGVjdXRpb25FbmdpbmUgPSBjbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBwaGFzZSBub3RpZmllclxuICAgKi9cbiAgc2V0UGhhc2VOb3RpZmllcihub3RpZmllcjogUGhhc2VOb3RpZmllcik6IHZvaWQge1xuICAgIHRoaXMucGhhc2VOb3RpZmllciA9IG5vdGlmaWVyO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbm90aWZpY2F0aW9uIGhhbmRsZXJcbiAgICovXG4gIHNldE5vdGlmaWNhdGlvbkhhbmRsZXIoaGFuZGxlcjogTm90aWZpY2F0aW9uSGFuZGxlcik6IHZvaWQge1xuICAgIHRoaXMubm90aWZpY2F0aW9uSGFuZGxlciA9IGhhbmRsZXI7XG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlci5zZXROb3RpZmljYXRpb25IYW5kbGVyKGhhbmRsZXIpO1xuICAgIFxuICAgIC8vIFNldCBjb3JyZWxhdGlvbiBub3RpZmllciBpZiBoYW5kbGVyIHN1cHBvcnRzIGl0XG4gICAgaWYgKCdzZW5kSGlnaENvcnJlbGF0aW9uV2FybmluZycgaW4gaGFuZGxlcikge1xuICAgICAgdGhpcy5yaXNrR3VhcmRpYW4uc2V0Q29ycmVsYXRpb25Ob3RpZmllcihoYW5kbGVyIGFzIGFueSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFNldCBzd2VlcCBub3RpZmllciBpZiBoYW5kbGVyIHN1cHBvcnRzIGl0XG4gICAgaWYgKCdzZW5kU3dlZXBOb3RpZmljYXRpb24nIGluIGhhbmRsZXIpIHtcbiAgICAgIHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLnNldFN3ZWVwTm90aWZpZXIoaGFuZGxlciBhcyBhbnkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY3VycmVudCBlcXVpdHlcbiAgICovXG4gIHNldEVxdWl0eShlcXVpdHk6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuY3VycmVudEVxdWl0eSA9IE1hdGgubWF4KDAsIGVxdWl0eSk7XG4gICAgdGhpcy5yaXNrR3VhcmRpYW4uc2V0RXF1aXR5KHRoaXMuY3VycmVudEVxdWl0eSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGN1cnJlbnQgcG9zaXRpb25zXG4gICAqL1xuICBzZXRQb3NpdGlvbnMocG9zaXRpb25zOiBQb3NpdGlvbltdKTogdm9pZCB7XG4gICAgdGhpcy5jdXJyZW50UG9zaXRpb25zID0gcG9zaXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBkYWlseSBzdGFydCBlcXVpdHkgKGNhbGxlZCBhdCBzdGFydCBvZiB0cmFkaW5nIGRheSlcbiAgICovXG4gIHNldERhaWx5U3RhcnRFcXVpdHkoZXF1aXR5OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmRhaWx5U3RhcnRFcXVpdHkgPSBNYXRoLm1heCgwLCBlcXVpdHkpO1xuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIuc2V0RGFpbHlTdGFydEVxdWl0eSh0aGlzLmRhaWx5U3RhcnRFcXVpdHkpO1xuICB9XG5cblxuICAvKipcbiAgICogUHJvY2VzcyBhbiBpbnRlbnQgc2lnbmFsIHRocm91Z2ggdGhlIGZ1bGwgcGlwZWxpbmVcbiAgICogUmVxdWlyZW1lbnQgNy41OiBNYXhpbXVtIGxhdGVuY3kgb2YgMTAwbXNcbiAgICogXG4gICAqIFBpcGVsaW5lOlxuICAgKiAxLiBDaGVjayBjaXJjdWl0IGJyZWFrZXJcbiAgICogMi4gR2V0IGFsbG9jYXRpb24gd2VpZ2h0c1xuICAgKiAzLiBBcHBseSBwZXJmb3JtYW5jZSBtb2RpZmllcnNcbiAgICogNC4gQ2hlY2sgcmlzayBjb25zdHJhaW50c1xuICAgKiA1LiBDYWxjdWxhdGUgYXV0aG9yaXplZCBzaXplXG4gICAqIDYuIEZvcndhcmQgdG8gZXhlY3V0aW9uIG9yIHZldG9cbiAgICogXG4gICAqIEBwYXJhbSBzaWduYWwgLSBJbnRlbnQgc2lnbmFsIGZyb20gYSBwaGFzZVxuICAgKiBAcmV0dXJucyBCcmFpbkRlY2lzaW9uIHdpdGggYXBwcm92YWwgc3RhdHVzXG4gICAqL1xuICBhc3luYyBwcm9jZXNzU2lnbmFsKHNpZ25hbDogSW50ZW50U2lnbmFsKTogUHJvbWlzZTxCcmFpbkRlY2lzaW9uPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBzdGFydFRpbWU7XG5cbiAgICAvLyBDaGVjayBjaXJjdWl0IGJyZWFrZXIgZmlyc3RcbiAgICBpZiAodGhpcy5jaXJjdWl0QnJlYWtlci5pc0FjdGl2ZSgpKSB7XG4gICAgICBjb25zdCBkZWNpc2lvbiA9IHRoaXMuY3JlYXRlVmV0b0RlY2lzaW9uKFxuICAgICAgICBzaWduYWwsXG4gICAgICAgICdDaXJjdWl0IGJyZWFrZXIgYWN0aXZlOiBhbGwgc2lnbmFscyByZWplY3RlZCcsXG4gICAgICAgIHRpbWVzdGFtcFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMucmVjb3JkRGVjaXNpb24oZGVjaXNpb24sIHNpZ25hbCk7XG4gICAgICByZXR1cm4gZGVjaXNpb247XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgYnJlYWtlciBjb25kaXRpb25zIHdpdGggY3VycmVudCBzdGF0ZVxuICAgIGNvbnN0IGJyZWFrZXJTdGF0dXMgPSB0aGlzLmNpcmN1aXRCcmVha2VyLmNoZWNrQ29uZGl0aW9ucyh7XG4gICAgICBlcXVpdHk6IHRoaXMuY3VycmVudEVxdWl0eSxcbiAgICAgIHBvc2l0aW9uczogdGhpcy5jdXJyZW50UG9zaXRpb25zLFxuICAgICAgZGFpbHlTdGFydEVxdWl0eTogdGhpcy5kYWlseVN0YXJ0RXF1aXR5LFxuICAgICAgcmVjZW50VHJhZGVzOiB0aGlzLnJlY2VudFRyYWRlcyxcbiAgICB9KTtcblxuICAgIGlmIChicmVha2VyU3RhdHVzLmFjdGl2ZSkge1xuICAgICAgY29uc3QgZGVjaXNpb24gPSB0aGlzLmNyZWF0ZVZldG9EZWNpc2lvbihcbiAgICAgICAgc2lnbmFsLFxuICAgICAgICBgQ2lyY3VpdCBicmVha2VyIHRyaWdnZXJlZDogJHticmVha2VyU3RhdHVzLnJlYXNvbn1gLFxuICAgICAgICB0aW1lc3RhbXBcbiAgICAgICk7XG4gICAgICBhd2FpdCB0aGlzLnJlY29yZERlY2lzaW9uKGRlY2lzaW9uLCBzaWduYWwpO1xuICAgICAgcmV0dXJuIGRlY2lzaW9uO1xuICAgIH1cblxuICAgIC8vIEdldCBhbGxvY2F0aW9uIHdlaWdodHMgKHdpdGggbWFudWFsIG92ZXJyaWRlIGlmIGFjdGl2ZSlcbiAgICBjb25zdCBhbGxvY2F0aW9uID0gdGhpcy5nZXRBbGxvY2F0aW9uKCk7XG5cbiAgICAvLyBHZXQgcGVyZm9ybWFuY2UgbW9kaWZpZXIgZm9yIHRoZSBwaGFzZVxuICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gYXdhaXQgdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIuZ2V0UGhhc2VQZXJmb3JtYW5jZShzaWduYWwucGhhc2VJZCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYmFzZSBhbGxvY2F0aW9uIGZvciB0aGlzIHBoYXNlXG4gICAgY29uc3QgcGhhc2VXZWlnaHQgPSB0aGlzLmdldFBoYXNlV2VpZ2h0KHNpZ25hbC5waGFzZUlkLCBhbGxvY2F0aW9uKTtcbiAgICBjb25zdCBhZGp1c3RlZFdlaWdodCA9IHBoYXNlV2VpZ2h0ICogcGVyZm9ybWFuY2UubW9kaWZpZXI7XG5cbiAgICAvLyBDYWxjdWxhdGUgbWF4IHBvc2l0aW9uIHNpemUgYmFzZWQgb24gYWxsb2NhdGlvblxuICAgIC8vIFJlcXVpcmVtZW50IDEuNzogQ2FwIHBvc2l0aW9uIHNpemUgYXQgRXF1aXR5ICogUGhhc2VfV2VpZ2h0XG4gICAgY29uc3QgbWF4UG9zaXRpb25TaXplID0gdGhpcy5jdXJyZW50RXF1aXR5ICogYWRqdXN0ZWRXZWlnaHQ7XG5cbiAgICAvLyBDaGVjayByaXNrIGNvbnN0cmFpbnRzXG4gICAgY29uc3Qgcmlza0RlY2lzaW9uID0gdGhpcy5yaXNrR3VhcmRpYW4uY2hlY2tTaWduYWwoc2lnbmFsLCB0aGlzLmN1cnJlbnRQb3NpdGlvbnMpO1xuXG4gICAgLy8gRGV0ZXJtaW5lIGZpbmFsIGF1dGhvcml6ZWQgc2l6ZVxuICAgIGxldCBhdXRob3JpemVkU2l6ZTogbnVtYmVyO1xuICAgIGxldCBhcHByb3ZlZDogYm9vbGVhbjtcbiAgICBsZXQgcmVhc29uOiBzdHJpbmc7XG5cbiAgICBpZiAoIXJpc2tEZWNpc2lvbi5hcHByb3ZlZCkge1xuICAgICAgLy8gUmlzayB2ZXRvXG4gICAgICBhcHByb3ZlZCA9IGZhbHNlO1xuICAgICAgYXV0aG9yaXplZFNpemUgPSAwO1xuICAgICAgcmVhc29uID0gcmlza0RlY2lzaW9uLnJlYXNvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXBwbHkgYWxsIGNvbnN0cmFpbnRzXG4gICAgICBjb25zdCByaXNrQWRqdXN0ZWRTaXplID0gcmlza0RlY2lzaW9uLmFkanVzdGVkU2l6ZSA/PyBzaWduYWwucmVxdWVzdGVkU2l6ZTtcbiAgICAgIGF1dGhvcml6ZWRTaXplID0gTWF0aC5taW4oXG4gICAgICAgIHNpZ25hbC5yZXF1ZXN0ZWRTaXplLFxuICAgICAgICBtYXhQb3NpdGlvblNpemUsXG4gICAgICAgIHJpc2tBZGp1c3RlZFNpemVcbiAgICAgICk7XG5cbiAgICAgIC8vIFJlcXVpcmVtZW50IDEuNzogUG9zaXRpb24gc2l6ZSBjb25zaXN0ZW5jeVxuICAgICAgaWYgKGF1dGhvcml6ZWRTaXplIDw9IDApIHtcbiAgICAgICAgYXBwcm92ZWQgPSBmYWxzZTtcbiAgICAgICAgYXV0aG9yaXplZFNpemUgPSAwO1xuICAgICAgICByZWFzb24gPSAnQXV0aG9yaXplZCBzaXplIGlzIHplcm8gYWZ0ZXIgYXBwbHlpbmcgY29uc3RyYWludHMnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwcm92ZWQgPSB0cnVlO1xuICAgICAgICByZWFzb24gPSB0aGlzLmJ1aWxkQXBwcm92YWxSZWFzb24oXG4gICAgICAgICAgc2lnbmFsLnJlcXVlc3RlZFNpemUsXG4gICAgICAgICAgYXV0aG9yaXplZFNpemUsXG4gICAgICAgICAgbWF4UG9zaXRpb25TaXplLFxuICAgICAgICAgIHJpc2tEZWNpc2lvblxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uID0ge1xuICAgICAgc2lnbmFsSWQ6IHNpZ25hbC5zaWduYWxJZCxcbiAgICAgIGFwcHJvdmVkLFxuICAgICAgYXV0aG9yaXplZFNpemUsXG4gICAgICByZWFzb24sXG4gICAgICBhbGxvY2F0aW9uLFxuICAgICAgcGVyZm9ybWFuY2UsXG4gICAgICByaXNrOiByaXNrRGVjaXNpb24sXG4gICAgICB0aW1lc3RhbXAsXG4gICAgfTtcblxuICAgIC8vIFJlY29yZCBkZWNpc2lvblxuICAgIGF3YWl0IHRoaXMucmVjb3JkRGVjaXNpb24oZGVjaXNpb24sIHNpZ25hbCk7XG5cbiAgICAvLyBVcGRhdGUgc2lnbmFsIHN0YXRzXG4gICAgdGhpcy51cGRhdGVTaWduYWxTdGF0cyhzaWduYWwucGhhc2VJZCwgYXBwcm92ZWQpO1xuXG4gICAgLy8gRm9yd2FyZCB0byBleGVjdXRpb24gb3Igbm90aWZ5IHZldG9cbiAgICBpZiAoYXBwcm92ZWQgJiYgdGhpcy5leGVjdXRpb25FbmdpbmUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZXhlY3V0aW9uRW5naW5lLmZvcndhcmRTaWduYWwoc2lnbmFsLCBhdXRob3JpemVkU2l6ZSk7XG4gICAgfSBlbHNlIGlmICghYXBwcm92ZWQpIHtcbiAgICAgIC8vIFJlcXVpcmVtZW50IDcuNjogTm90aWZ5IG9yaWdpbmF0aW5nIHBoYXNlIG9mIHZldG9cbiAgICAgIGlmICh0aGlzLnBoYXNlTm90aWZpZXIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5waGFzZU5vdGlmaWVyLm5vdGlmeVZldG8oc2lnbmFsLnBoYXNlSWQsIHNpZ25hbC5zaWduYWxJZCwgcmVhc29uKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2VuZCB2ZXRvIG5vdGlmaWNhdGlvbiB2aWEgbm90aWZpY2F0aW9uIHNlcnZpY2VcbiAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbkhhbmRsZXIgJiYgJ3NlbmRWZXRvTm90aWZpY2F0aW9uJyBpbiB0aGlzLm5vdGlmaWNhdGlvbkhhbmRsZXIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCAodGhpcy5ub3RpZmljYXRpb25IYW5kbGVyIGFzIGFueSkuc2VuZFZldG9Ob3RpZmljYXRpb24oXG4gICAgICAgICAgICBzaWduYWwucGhhc2VJZCxcbiAgICAgICAgICAgIHNpZ25hbC5zaWduYWxJZCxcbiAgICAgICAgICAgIHNpZ25hbC5zeW1ib2wsXG4gICAgICAgICAgICByZWFzb24sXG4gICAgICAgICAgICBzaWduYWwucmVxdWVzdGVkU2l6ZVxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNlbmQgdmV0byBub3RpZmljYXRpb246JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgcHJvY2Vzc2luZyBsYXRlbmN5IGFuZCByZWNvcmQgbWV0cmljc1xuICAgIGNvbnN0IHByb2Nlc3NpbmdUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBpZiAocHJvY2Vzc2luZ1RpbWUgPiB0aGlzLmNvbmZpZy5zaWduYWxUaW1lb3V0KSB7XG4gICAgICBjb25zb2xlLndhcm4oYFNpZ25hbCBwcm9jZXNzaW5nIGV4Y2VlZGVkIHRpbWVvdXQ6ICR7cHJvY2Vzc2luZ1RpbWV9bXMgPiAke3RoaXMuY29uZmlnLnNpZ25hbFRpbWVvdXR9bXNgKTtcbiAgICB9XG5cbiAgICAvLyBSZWNvcmQgbWV0cmljc1xuICAgIGNvbnN0IG1ldHJpY3MgPSBnZXRNZXRyaWNzKCk7XG4gICAgbWV0cmljcy5yZWNvcmRTaWduYWxMYXRlbmN5KHNpZ25hbC5waGFzZUlkLCBwcm9jZXNzaW5nVGltZSwgYXBwcm92ZWQpO1xuXG4gICAgcmV0dXJuIGRlY2lzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgbXVsdGlwbGUgc2lnbmFscyB3aXRoIHByaW9yaXR5IG9yZGVyaW5nXG4gICAqIFJlcXVpcmVtZW50IDcuMTogUHJvY2VzcyBpbiBwcmlvcml0eSBvcmRlciAoUDMgPiBQMiA+IFAxKVxuICAgKiBcbiAgICogQHBhcmFtIHNpZ25hbHMgLSBBcnJheSBvZiBpbnRlbnQgc2lnbmFsc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBicmFpbiBkZWNpc2lvbnNcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NTaWduYWxzKHNpZ25hbHM6IEludGVudFNpZ25hbFtdKTogUHJvbWlzZTxCcmFpbkRlY2lzaW9uW10+IHtcbiAgICAvLyBTb3J0IGJ5IHByaW9yaXR5IChoaWdoZXN0IGZpcnN0KVxuICAgIGNvbnN0IHNvcnRlZFNpZ25hbHMgPSBbLi4uc2lnbmFsc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgcmV0dXJuIFBIQVNFX1BSSU9SSVRZW2IucGhhc2VJZF0gLSBQSEFTRV9QUklPUklUWVthLnBoYXNlSWRdO1xuICAgIH0pO1xuXG4gICAgY29uc3QgZGVjaXNpb25zOiBCcmFpbkRlY2lzaW9uW10gPSBbXTtcblxuICAgIGZvciAoY29uc3Qgc2lnbmFsIG9mIHNvcnRlZFNpZ25hbHMpIHtcbiAgICAgIGNvbnN0IGRlY2lzaW9uID0gYXdhaXQgdGhpcy5wcm9jZXNzU2lnbmFsKHNpZ25hbCk7XG4gICAgICBkZWNpc2lvbnMucHVzaChkZWNpc2lvbik7XG5cbiAgICAgIC8vIFVwZGF0ZSBwb3NpdGlvbnMgYWZ0ZXIgZWFjaCBhcHByb3ZlZCBzaWduYWxcbiAgICAgIGlmIChkZWNpc2lvbi5hcHByb3ZlZCAmJiB0aGlzLmV4ZWN1dGlvbkVuZ2luZSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbnMgPSBhd2FpdCB0aGlzLmV4ZWN1dGlvbkVuZ2luZS5nZXRQb3NpdGlvbnMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZGVjaXNpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEVucXVldWUgYSBzaWduYWwgZm9yIHByb2Nlc3NpbmdcbiAgICogUmVxdWlyZW1lbnQgNy40OiBNYWludGFpbiBzaWduYWwgcXVldWUgd2l0aCB0aW1lc3RhbXBzIGFuZCBwaGFzZSBzb3VyY2VcbiAgICogXG4gICAqIEBwYXJhbSBzaWduYWwgLSBJbnRlbnQgc2lnbmFsIHRvIGVucXVldWVcbiAgICovXG4gIGVucXVldWVTaWduYWwoc2lnbmFsOiBJbnRlbnRTaWduYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaWduYWxRdWV1ZS5sZW5ndGggPj0gdGhpcy5jb25maWcubWF4UXVldWVTaXplKSB7XG4gICAgICAvLyBSZW1vdmUgb2xkZXN0IHNpZ25hbFxuICAgICAgdGhpcy5zaWduYWxRdWV1ZS5zaGlmdCgpO1xuICAgIH1cblxuICAgIHRoaXMuc2lnbmFsUXVldWUucHVzaCh7XG4gICAgICBzaWduYWwsXG4gICAgICBwcmlvcml0eTogUEhBU0VfUFJJT1JJVFlbc2lnbmFsLnBoYXNlSWRdLFxuICAgICAgZW5xdWV1ZWRBdDogRGF0ZS5ub3coKSxcbiAgICB9KTtcblxuICAgIC8vIFNvcnQgcXVldWUgYnkgcHJpb3JpdHlcbiAgICB0aGlzLnNpZ25hbFF1ZXVlLnNvcnQoKGEsIGIpID0+IGIucHJpb3JpdHkgLSBhLnByaW9yaXR5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGFsbCBxdWV1ZWQgc2lnbmFsc1xuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc1F1ZXVlKCk6IFByb21pc2U8QnJhaW5EZWNpc2lvbltdPiB7XG4gICAgY29uc3Qgc2lnbmFscyA9IHRoaXMuc2lnbmFsUXVldWUubWFwKHEgPT4gcS5zaWduYWwpO1xuICAgIHRoaXMuc2lnbmFsUXVldWUgPSBbXTtcbiAgICByZXR1cm4gdGhpcy5wcm9jZXNzU2lnbmFscyhzaWduYWxzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYWxsIG1ldHJpY3MgcGVyaW9kaWNhbGx5XG4gICAqIFJlcXVpcmVtZW50IDEuMTogUmVjYWxjdWxhdGUgYWxsb2NhdGlvbiBldmVyeSAxIG1pbnV0ZSBvciBvbiB0cmFkZSBjbG9zZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlTWV0cmljcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBVcGRhdGUgYWxsb2NhdGlvblxuICAgIGNvbnN0IGFsbG9jYXRpb24gPSB0aGlzLmFsbG9jYXRpb25FbmdpbmUuZ2V0V2VpZ2h0cyh0aGlzLmN1cnJlbnRFcXVpdHkpO1xuXG4gICAgLy8gVXBkYXRlIGNhcGl0YWwgZmxvdyB0YXJnZXQgYWxsb2NhdGlvblxuICAgIGNvbnN0IGZ1dHVyZXNBbGxvY2F0aW9uID0gdGhpcy5jdXJyZW50RXF1aXR5ICogKGFsbG9jYXRpb24udzEgKyBhbGxvY2F0aW9uLncyKTtcbiAgICB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKGZ1dHVyZXNBbGxvY2F0aW9uKTtcblxuICAgIC8vIFVwZGF0ZSBoaWdoIHdhdGVybWFya1xuICAgIGF3YWl0IHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLnVwZGF0ZUhpZ2hXYXRlcm1hcmsodGhpcy5jdXJyZW50RXF1aXR5KTtcblxuICAgIC8vIENoZWNrIHN3ZWVwIGNvbmRpdGlvbnNcbiAgICBhd2FpdCB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5wZXJmb3JtU3dlZXBJZk5lZWRlZCgpO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBkYXNoYm9hcmQgY2FjaGVcbiAgICB0aGlzLmRhc2hib2FyZENhY2hlID0gbnVsbDtcblxuICAgIC8vIFVwZGF0ZSBQcm9tZXRoZXVzIG1ldHJpY3NcbiAgICBjb25zdCBtZXRyaWNzID0gZ2V0TWV0cmljcygpO1xuICAgIG1ldHJpY3MudXBkYXRlRXF1aXR5KHRoaXMuY3VycmVudEVxdWl0eSk7XG4gICAgbWV0cmljcy51cGRhdGVBbGxvY2F0aW9uKGFsbG9jYXRpb24udzEsIGFsbG9jYXRpb24udzIsIGFsbG9jYXRpb24udzMpO1xuICAgIG1ldHJpY3MudXBkYXRlQ2lyY3VpdEJyZWFrZXJTdGF0dXModGhpcy5jaXJjdWl0QnJlYWtlci5pc0FjdGl2ZSgpKTtcbiAgICBtZXRyaWNzLnVwZGF0ZUhpZ2hXYXRlcm1hcmsodGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgZGFpbHkgZHJhd2Rvd25cbiAgICBjb25zdCBkYWlseURyYXdkb3duID0gdGhpcy5kYWlseVN0YXJ0RXF1aXR5ID4gMCBcbiAgICAgID8gKCh0aGlzLmRhaWx5U3RhcnRFcXVpdHkgLSB0aGlzLmN1cnJlbnRFcXVpdHkpIC8gdGhpcy5kYWlseVN0YXJ0RXF1aXR5KSAqIDEwMCBcbiAgICAgIDogMDtcbiAgICBtZXRyaWNzLnVwZGF0ZURhaWx5RHJhd2Rvd24oTWF0aC5tYXgoMCwgZGFpbHlEcmF3ZG93bikpO1xuXG4gICAgLy8gVXBkYXRlIHBoYXNlIHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAgICBmb3IgKGNvbnN0IHBoYXNlSWQgb2YgWydwaGFzZTEnLCAncGhhc2UyJywgJ3BoYXNlMyddIGFzIFBoYXNlSWRbXSkge1xuICAgICAgY29uc3QgcGVyZm9ybWFuY2UgPSBhd2FpdCB0aGlzLnBlcmZvcm1hbmNlVHJhY2tlci5nZXRQaGFzZVBlcmZvcm1hbmNlKHBoYXNlSWQpO1xuICAgICAgbWV0cmljcy51cGRhdGVQaGFzZVBlcmZvcm1hbmNlKHBoYXNlSWQsIHBlcmZvcm1hbmNlLnNoYXJwZVJhdGlvLCBwZXJmb3JtYW5jZS5tb2RpZmllcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCBhIHRyYWRlIHJlc3VsdFxuICAgKiBVcGRhdGVzIHBlcmZvcm1hbmNlIHRyYWNraW5nIGFuZCBjaXJjdWl0IGJyZWFrZXIgc3RhdGVcbiAgICogXG4gICAqIEBwYXJhbSBwaGFzZUlkIC0gUGhhc2UgdGhhdCBleGVjdXRlZCB0aGUgdHJhZGVcbiAgICogQHBhcmFtIHBubCAtIFRyYWRlIFBuTFxuICAgKiBAcGFyYW0gc3ltYm9sIC0gVHJhZGluZyBzeW1ib2xcbiAgICogQHBhcmFtIHNpZGUgLSBUcmFkZSBzaWRlXG4gICAqL1xuICBhc3luYyByZWNvcmRUcmFkZShcbiAgICBwaGFzZUlkOiBQaGFzZUlkLFxuICAgIHBubDogbnVtYmVyLFxuICAgIHN5bWJvbD86IHN0cmluZyxcbiAgICBzaWRlPzogJ0JVWScgfCAnU0VMTCdcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgIC8vIFJlY29yZCBpbiBwZXJmb3JtYW5jZSB0cmFja2VyXG4gICAgYXdhaXQgdGhpcy5wZXJmb3JtYW5jZVRyYWNrZXIucmVjb3JkVHJhZGUocGhhc2VJZCwgcG5sLCB0aW1lc3RhbXAsIHN5bWJvbCwgc2lkZSk7XG5cbiAgICAvLyBSZWNvcmQgZm9yIGNpcmN1aXQgYnJlYWtlclxuICAgIHRoaXMucmVjZW50VHJhZGVzLnB1c2goeyBwbmwsIHRpbWVzdGFtcCB9KTtcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLnJlY29yZFRyYWRlKHBubCwgdGltZXN0YW1wKTtcblxuICAgIC8vIENsZWFuIHVwIG9sZCB0cmFkZXMgKGtlZXAgbGFzdCBob3VyKVxuICAgIGNvbnN0IG9uZUhvdXJBZ28gPSB0aW1lc3RhbXAgLSAzNjAwMDAwO1xuICAgIHRoaXMucmVjZW50VHJhZGVzID0gdGhpcy5yZWNlbnRUcmFkZXMuZmlsdGVyKHQgPT4gdC50aW1lc3RhbXAgPj0gb25lSG91ckFnbyk7XG5cbiAgICAvLyBVcGRhdGUgbWV0cmljcyBhZnRlciB0cmFkZVxuICAgIGF3YWl0IHRoaXMudXBkYXRlTWV0cmljcygpO1xuICB9XG5cblxuICAvKipcbiAgICogR2V0IGRhc2hib2FyZCBkYXRhIGZvciBVSVxuICAgKiBSZXF1aXJlbWVudCAxMC4xLTEwLjc6IERhc2hib2FyZCB2aXNpYmlsaXR5XG4gICAqIFxuICAgKiBAcmV0dXJucyBEYXNoYm9hcmREYXRhIHdpdGggYWxsIG1ldHJpY3NcbiAgICovXG4gIGFzeW5jIGdldERhc2hib2FyZERhdGEoKTogUHJvbWlzZTxEYXNoYm9hcmREYXRhPiB7XG4gICAgLy8gQ2hlY2sgY2FjaGVcbiAgICBpZiAoXG4gICAgICB0aGlzLmRhc2hib2FyZENhY2hlICYmXG4gICAgICBEYXRlLm5vdygpIC0gdGhpcy5kYXNoYm9hcmRDYWNoZVRpbWUgPCB0aGlzLmNvbmZpZy5kYXNoYm9hcmRDYWNoZVRUTFxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuZGFzaGJvYXJkQ2FjaGU7XG4gICAgfVxuXG4gICAgLy8gR2V0IGFsbG9jYXRpb25cbiAgICBjb25zdCBhbGxvY2F0aW9uID0gdGhpcy5hbGxvY2F0aW9uRW5naW5lLmdldFdlaWdodHModGhpcy5jdXJyZW50RXF1aXR5KTtcblxuICAgIC8vIENhbGN1bGF0ZSBwaGFzZSBlcXVpdHlcbiAgICBjb25zdCBwaGFzZUVxdWl0eTogUmVjb3JkPFBoYXNlSWQsIG51bWJlcj4gPSB7XG4gICAgICBwaGFzZTE6IHRoaXMuY3VycmVudEVxdWl0eSAqIGFsbG9jYXRpb24udzEsXG4gICAgICBwaGFzZTI6IHRoaXMuY3VycmVudEVxdWl0eSAqIGFsbG9jYXRpb24udzIsXG4gICAgICBwaGFzZTM6IHRoaXMuY3VycmVudEVxdWl0eSAqIGFsbG9jYXRpb24udzMsXG4gICAgfTtcblxuICAgIC8vIEdldCByaXNrIG1ldHJpY3NcbiAgICBjb25zdCByaXNrTWV0cmljcyA9IHRoaXMucmlza0d1YXJkaWFuLmdldFJpc2tNZXRyaWNzKHRoaXMuY3VycmVudFBvc2l0aW9ucyk7XG5cbiAgICAvLyBHZXQgdHJlYXN1cnkgc3RhdHVzXG4gICAgY29uc3QgdHJlYXN1cnkgPSBhd2FpdCB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5nZXRUcmVhc3VyeVN0YXR1cygpO1xuXG4gICAgLy8gR2V0IGNpcmN1aXQgYnJlYWtlciBzdGF0dXNcbiAgICBjb25zdCBjaXJjdWl0QnJlYWtlciA9IHRoaXMuY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHVzKCk7XG5cbiAgICAvLyBHZXQgcmVjZW50IGRlY2lzaW9ucyAobGFzdCAyMClcbiAgICBjb25zdCByZWNlbnREZWNpc2lvbnMgPSB0aGlzLnJlY2VudERlY2lzaW9ucy5zbGljZSgtMjApO1xuXG4gICAgLy8gR2V0IG1hbnVhbCBvdmVycmlkZSBzdGF0dXNcbiAgICBjb25zdCBtYW51YWxPdmVycmlkZSA9IHRoaXMuZ2V0Q3VycmVudE1hbnVhbE92ZXJyaWRlKCk7XG4gICAgY29uc3Qgd2FybmluZ0Jhbm5lckFjdGl2ZSA9IHRoaXMuaXNXYXJuaW5nQmFubmVyQWN0aXZlKCk7XG5cbiAgICBjb25zdCBkYXNoYm9hcmREYXRhOiBEYXNoYm9hcmREYXRhID0ge1xuICAgICAgbmF2OiB0aGlzLmN1cnJlbnRFcXVpdHksXG4gICAgICBhbGxvY2F0aW9uLFxuICAgICAgcGhhc2VFcXVpdHksXG4gICAgICByaXNrTWV0cmljczoge1xuICAgICAgICBnbG9iYWxMZXZlcmFnZTogcmlza01ldHJpY3MuY3VycmVudExldmVyYWdlLFxuICAgICAgICBuZXREZWx0YTogcmlza01ldHJpY3MucG9ydGZvbGlvRGVsdGEsXG4gICAgICAgIGNvcnJlbGF0aW9uU2NvcmU6IHJpc2tNZXRyaWNzLmNvcnJlbGF0aW9uLFxuICAgICAgICBwb3J0Zm9saW9CZXRhOiByaXNrTWV0cmljcy5wb3J0Zm9saW9CZXRhLFxuICAgICAgfSxcbiAgICAgIHRyZWFzdXJ5LFxuICAgICAgY2lyY3VpdEJyZWFrZXIsXG4gICAgICByZWNlbnREZWNpc2lvbnMsXG4gICAgICBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKSxcbiAgICAgIG1hbnVhbE92ZXJyaWRlOiBtYW51YWxPdmVycmlkZSA/IHtcbiAgICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgICBvcGVyYXRvcklkOiBtYW51YWxPdmVycmlkZS5vcGVyYXRvcklkLFxuICAgICAgICByZWFzb246IG1hbnVhbE92ZXJyaWRlLnJlYXNvbixcbiAgICAgICAgYWxsb2NhdGlvbjogbWFudWFsT3ZlcnJpZGUub3ZlcnJpZGVBbGxvY2F0aW9uLFxuICAgICAgICBleHBpcmVzQXQ6IG1hbnVhbE92ZXJyaWRlLmV4cGlyZXNBdCxcbiAgICAgIH0gOiBudWxsLFxuICAgICAgd2FybmluZ0Jhbm5lckFjdGl2ZSxcbiAgICB9O1xuXG4gICAgLy8gQ2FjaGUgdGhlIHJlc3VsdFxuICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGUgPSBkYXNoYm9hcmREYXRhO1xuICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGVUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIHJldHVybiBkYXNoYm9hcmREYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzeXN0ZW0gaGVhbHRoIHN0YXR1c1xuICAgKiBcbiAgICogQHJldHVybnMgSGVhbHRoU3RhdHVzIHdpdGggY29tcG9uZW50IGhlYWx0aFxuICAgKi9cbiAgYXN5bmMgZ2V0SGVhbHRoU3RhdHVzKCk6IFByb21pc2U8SGVhbHRoU3RhdHVzPiB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNvbXBvbmVudHMgPSB7XG4gICAgICBkYXRhYmFzZTogZmFsc2UsXG4gICAgICByZWRpczogZmFsc2UsXG4gICAgICBleGVjdXRpb25FbmdpbmU6IGZhbHNlLFxuICAgICAgcGhhc2VzOiB7XG4gICAgICAgIHBoYXNlMTogZmFsc2UsXG4gICAgICAgIHBoYXNlMjogZmFsc2UsXG4gICAgICAgIHBoYXNlMzogZmFsc2UsXG4gICAgICB9IGFzIFJlY29yZDxQaGFzZUlkLCBib29sZWFuPixcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgZGF0YWJhc2VcbiAgICBpZiAodGhpcy5kYikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5kYi5xdWVyeSgnU0VMRUNUIDEnKTtcbiAgICAgICAgY29tcG9uZW50cy5kYXRhYmFzZSA9IHRydWU7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBlcnJvcnMucHVzaChgRGF0YWJhc2U6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBSYWlsd2F5IGRlcGxveW1lbnQgd2l0aG91dCBkYXRhYmFzZSwgY29uc2lkZXIgaXQgaGVhbHRoeVxuICAgICAgY29tcG9uZW50cy5kYXRhYmFzZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZXhlY3V0aW9uIGVuZ2luZSAob3B0aW9uYWwgZm9yIFJhaWx3YXkpXG4gICAgaWYgKHRoaXMuZXhlY3V0aW9uRW5naW5lKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGlvbkVuZ2luZS5nZXRQb3NpdGlvbnMoKTtcbiAgICAgICAgY29tcG9uZW50cy5leGVjdXRpb25FbmdpbmUgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goYEV4ZWN1dGlvbiBFbmdpbmU6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBSYWlsd2F5IGRlcGxveW1lbnQgd2l0aG91dCBleGVjdXRpb24gZW5naW5lLCBjb25zaWRlciBpdCBoZWFsdGh5XG4gICAgICBjb21wb25lbnRzLmV4ZWN1dGlvbkVuZ2luZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgcGhhc2UgYXBwcm92YWwgcmF0ZXNcbiAgICAvLyBSZXF1aXJlbWVudCA3Ljg6IEZsYWcgZm9yIHJldmlldyBpZiBhcHByb3ZhbCByYXRlIDwgNTAlXG4gICAgZm9yIChjb25zdCBwaGFzZUlkIG9mIFsncGhhc2UxJywgJ3BoYXNlMicsICdwaGFzZTMnXSBhcyBQaGFzZUlkW10pIHtcbiAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zaWduYWxTdGF0c1twaGFzZUlkXTtcbiAgICAgIGlmIChzdGF0cy50b3RhbCA+IDApIHtcbiAgICAgICAgY29uc3QgYXBwcm92YWxSYXRlID0gc3RhdHMuYXBwcm92ZWQgLyBzdGF0cy50b3RhbDtcbiAgICAgICAgY29tcG9uZW50cy5waGFzZXNbcGhhc2VJZF0gPSBhcHByb3ZhbFJhdGUgPj0gMC41O1xuICAgICAgICBpZiAoYXBwcm92YWxSYXRlIDwgMC41KSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goYCR7cGhhc2VJZH06IEFwcHJvdmFsIHJhdGUgJHsoYXBwcm92YWxSYXRlICogMTAwKS50b0ZpeGVkKDEpfSUgPCA1MCVgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29tcG9uZW50cy5waGFzZXNbcGhhc2VJZF0gPSB0cnVlOyAvLyBObyBzaWduYWxzIHlldFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZvciBSYWlsd2F5IGRlcGxveW1lbnQsIGJlIG1vcmUgbGVuaWVudCB3aXRoIGhlYWx0aCBjaGVja3NcbiAgICBjb25zdCBpc1JhaWx3YXlEZXBsb3ltZW50ID0gcHJvY2Vzcy5lbnYuUkFJTFdBWV9FTlZJUk9OTUVOVCA9PT0gJ3RydWUnO1xuICAgIGNvbnN0IGhlYWx0aHkgPSBpc1JhaWx3YXlEZXBsb3ltZW50ID8gXG4gICAgICAvLyBSYWlsd2F5OiBKdXN0IGNoZWNrIHRoYXQgdGhlIHNlcnZpY2UgaXMgcnVubmluZyAocGhhc2VzIGFyZSBoZWFsdGh5KVxuICAgICAgT2JqZWN0LnZhbHVlcyhjb21wb25lbnRzLnBoYXNlcykuZXZlcnkoQm9vbGVhbikgOlxuICAgICAgLy8gTG9jYWw6IENoZWNrIGFsbCBjb21wb25lbnRzXG4gICAgICBjb21wb25lbnRzLmRhdGFiYXNlICYmXG4gICAgICBjb21wb25lbnRzLmV4ZWN1dGlvbkVuZ2luZSAmJlxuICAgICAgT2JqZWN0LnZhbHVlcyhjb21wb25lbnRzLnBoYXNlcykuZXZlcnkoQm9vbGVhbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGVhbHRoeSxcbiAgICAgIGNvbXBvbmVudHMsXG4gICAgICBsYXN0Q2hlY2s6IERhdGUubm93KCksXG4gICAgICBlcnJvcnMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2lnbmFsIGFwcHJvdmFsIHJhdGUgZm9yIGEgcGhhc2VcbiAgICogUmVxdWlyZW1lbnQgNy43OiBUcmFjayBzaWduYWwgYXBwcm92YWwgcmF0ZSBwZXIgcGhhc2VcbiAgICogXG4gICAqIEBwYXJhbSBwaGFzZUlkIC0gUGhhc2UgdG8gY2hlY2tcbiAgICogQHJldHVybnMgQXBwcm92YWwgcmF0ZSAoMC0xKVxuICAgKi9cbiAgZ2V0QXBwcm92YWxSYXRlKHBoYXNlSWQ6IFBoYXNlSWQpOiBudW1iZXIge1xuICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zaWduYWxTdGF0c1twaGFzZUlkXTtcbiAgICBpZiAoc3RhdHMudG90YWwgPT09IDApIHJldHVybiAxLjA7XG4gICAgcmV0dXJuIHN0YXRzLmFwcHJvdmVkIC8gc3RhdHMudG90YWw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBwaGFzZSBhcHByb3ZhbCByYXRlc1xuICAgKi9cbiAgZ2V0QWxsQXBwcm92YWxSYXRlcygpOiBSZWNvcmQ8UGhhc2VJZCwgbnVtYmVyPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBoYXNlMTogdGhpcy5nZXRBcHByb3ZhbFJhdGUoJ3BoYXNlMScpLFxuICAgICAgcGhhc2UyOiB0aGlzLmdldEFwcHJvdmFsUmF0ZSgncGhhc2UyJyksXG4gICAgICBwaGFzZTM6IHRoaXMuZ2V0QXBwcm92YWxSYXRlKCdwaGFzZTMnKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHNpZ25hbCBzdGF0cyAoZS5nLiwgYXQgc3RhcnQgb2YgZGF5KVxuICAgKi9cbiAgcmVzZXRTaWduYWxTdGF0cygpOiB2b2lkIHtcbiAgICB0aGlzLnNpZ25hbFN0YXRzID0ge1xuICAgICAgcGhhc2UxOiB7IGFwcHJvdmVkOiAwLCB0b3RhbDogMCB9LFxuICAgICAgcGhhc2UyOiB7IGFwcHJvdmVkOiAwLCB0b3RhbDogMCB9LFxuICAgICAgcGhhc2UzOiB7IGFwcHJvdmVkOiAwLCB0b3RhbDogMCB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgYWxsb2NhdGlvbiB2ZWN0b3IgKHdpdGggbWFudWFsIG92ZXJyaWRlIGlmIGFjdGl2ZSlcbiAgICogUmVxdWlyZW1lbnQgOS43OiBTdXBwb3J0IG1hbnVhbCBvdmVycmlkZSBvZiBhbGxvY2F0aW9uIHdlaWdodHNcbiAgICovXG4gIGdldEFsbG9jYXRpb24oKTogQWxsb2NhdGlvblZlY3RvciB7XG4gICAgY29uc3Qgbm9ybWFsQWxsb2NhdGlvbiA9IHRoaXMuYWxsb2NhdGlvbkVuZ2luZS5nZXRXZWlnaHRzKHRoaXMuY3VycmVudEVxdWl0eSk7XG4gICAgXG4gICAgLy8gQXBwbHkgbWFudWFsIG92ZXJyaWRlIGlmIGFjdGl2ZVxuICAgIGlmICh0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkge1xuICAgICAgcmV0dXJuIHRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlLmdldEVmZmVjdGl2ZUFsbG9jYXRpb24obm9ybWFsQWxsb2NhdGlvbik7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBub3JtYWxBbGxvY2F0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGVxdWl0eVxuICAgKi9cbiAgZ2V0RXF1aXR5KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEVxdWl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBwb3NpdGlvbnNcbiAgICovXG4gIGdldFBvc2l0aW9ucygpOiBQb3NpdGlvbltdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuY3VycmVudFBvc2l0aW9uc107XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNpcmN1aXQgYnJlYWtlciBzdGF0dXNcbiAgICovXG4gIGdldENpcmN1aXRCcmVha2VyU3RhdHVzKCk6IEJyZWFrZXJTdGF0dXMge1xuICAgIHJldHVybiB0aGlzLmNpcmN1aXRCcmVha2VyLmdldFN0YXR1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hbnVhbGx5IHJlc2V0IGNpcmN1aXQgYnJlYWtlclxuICAgKiBSZXF1aXJlbWVudCA1Ljg6IFJlcXVpcmUgb3BlcmF0b3IgSURcbiAgICogXG4gICAqIEBwYXJhbSBvcGVyYXRvcklkIC0gSUQgb2Ygb3BlcmF0b3IgcGVyZm9ybWluZyByZXNldFxuICAgKi9cbiAgYXN5bmMgcmVzZXRDaXJjdWl0QnJlYWtlcihvcGVyYXRvcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNpcmN1aXRCcmVha2VyLnJlc2V0KG9wZXJhdG9ySWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogQnJhaW5Db25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbWFudWFsIGFsbG9jYXRpb24gb3ZlcnJpZGVcbiAgICogUmVxdWlyZW1lbnQgOS43OiBDcmVhdGUgYWRtaW4gZW5kcG9pbnQgZm9yIGFsbG9jYXRpb24gb3ZlcnJpZGVcbiAgICogXG4gICAqIEBwYXJhbSBvcGVyYXRvcklkIC0gT3BlcmF0b3IgY3JlYXRpbmcgdGhlIG92ZXJyaWRlXG4gICAqIEBwYXJhbSBwYXNzd29yZCAtIE9wZXJhdG9yIHBhc3N3b3JkXG4gICAqIEBwYXJhbSBhbGxvY2F0aW9uIC0gTmV3IGFsbG9jYXRpb24gdmVjdG9yXG4gICAqIEBwYXJhbSByZWFzb24gLSBSZWFzb24gZm9yIG92ZXJyaWRlXG4gICAqIEBwYXJhbSBkdXJhdGlvbkhvdXJzIC0gT3B0aW9uYWwgZHVyYXRpb24gaW4gaG91cnNcbiAgICogQHJldHVybnMgVHJ1ZSBpZiBvdmVycmlkZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlTWFudWFsT3ZlcnJpZGUoXG4gICAgb3BlcmF0b3JJZDogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICAgYWxsb2NhdGlvbjogQWxsb2NhdGlvblZlY3RvcixcbiAgICByZWFzb246IHN0cmluZyxcbiAgICBkdXJhdGlvbkhvdXJzPzogbnVtYmVyXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01hbnVhbCBvdmVycmlkZSBzZXJ2aWNlIG5vdCBhdmFpbGFibGUnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBBdXRoZW50aWNhdGUgb3BlcmF0b3JcbiAgICBjb25zdCBhdXRoZW50aWNhdGVkID0gYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuYXV0aGVudGljYXRlT3BlcmF0b3Iob3BlcmF0b3JJZCwgcGFzc3dvcmQpO1xuICAgIGlmICghYXV0aGVudGljYXRlZCkge1xuICAgICAgY29uc29sZS53YXJuKGBNYW51YWwgb3ZlcnJpZGUgcmVqZWN0ZWQ6IGF1dGhlbnRpY2F0aW9uIGZhaWxlZCBmb3Igb3BlcmF0b3IgJHtvcGVyYXRvcklkfWApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBvdmVycmlkZVxuICAgIGNvbnN0IG92ZXJyaWRlID0gYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuY3JlYXRlT3ZlcnJpZGUoe1xuICAgICAgb3BlcmF0b3JJZCxcbiAgICAgIGFsbG9jYXRpb24sXG4gICAgICByZWFzb24sXG4gICAgICBkdXJhdGlvbkhvdXJzLFxuICAgIH0pO1xuXG4gICAgaWYgKG92ZXJyaWRlKSB7XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIE1hbnVhbCBvdmVycmlkZSBjcmVhdGVkIGJ5IG9wZXJhdG9yICR7b3BlcmF0b3JJZH1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBOZXcgYWxsb2NhdGlvbjogdzE9JHthbGxvY2F0aW9uLncxfSwgdzI9JHthbGxvY2F0aW9uLncyfSwgdzM9JHthbGxvY2F0aW9uLnczfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICBcbiAgICAgIC8vIEludmFsaWRhdGUgZGFzaGJvYXJkIGNhY2hlIHRvIHNob3cgd2FybmluZyBiYW5uZXJcbiAgICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGUgPSBudWxsO1xuICAgICAgXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogRGVhY3RpdmF0ZSB0aGUgY3VycmVudCBtYW51YWwgb3ZlcnJpZGVcbiAgICogXG4gICAqIEBwYXJhbSBvcGVyYXRvcklkIC0gT3BlcmF0b3IgZGVhY3RpdmF0aW5nIHRoZSBvdmVycmlkZVxuICAgKiBAcGFyYW0gcGFzc3dvcmQgLSBPcGVyYXRvciBwYXNzd29yZFxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHN1Y2Nlc3NmdWxseSBkZWFjdGl2YXRlZFxuICAgKi9cbiAgYXN5bmMgZGVhY3RpdmF0ZU1hbnVhbE92ZXJyaWRlKG9wZXJhdG9ySWQ6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01hbnVhbCBvdmVycmlkZSBzZXJ2aWNlIG5vdCBhdmFpbGFibGUnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBBdXRoZW50aWNhdGUgb3BlcmF0b3JcbiAgICBjb25zdCBhdXRoZW50aWNhdGVkID0gYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuYXV0aGVudGljYXRlT3BlcmF0b3Iob3BlcmF0b3JJZCwgcGFzc3dvcmQpO1xuICAgIGlmICghYXV0aGVudGljYXRlZCkge1xuICAgICAgY29uc29sZS53YXJuKGBNYW51YWwgb3ZlcnJpZGUgZGVhY3RpdmF0aW9uIHJlamVjdGVkOiBhdXRoZW50aWNhdGlvbiBmYWlsZWQgZm9yIG9wZXJhdG9yICR7b3BlcmF0b3JJZH1gKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuZGVhY3RpdmF0ZU92ZXJyaWRlKG9wZXJhdG9ySWQpO1xuICAgIFxuICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIE1hbnVhbCBvdmVycmlkZSBkZWFjdGl2YXRlZCBieSBvcGVyYXRvciAke29wZXJhdG9ySWR9YCk7XG4gICAgICBcbiAgICAgIC8vIEludmFsaWRhdGUgZGFzaGJvYXJkIGNhY2hlIHRvIGhpZGUgd2FybmluZyBiYW5uZXJcbiAgICAgIHRoaXMuZGFzaGJvYXJkQ2FjaGUgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc3VjY2VzcztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBtYW51YWwgb3ZlcnJpZGUgc3RhdHVzXG4gICAqIFxuICAgKiBAcmV0dXJucyBDdXJyZW50IG92ZXJyaWRlIG9yIG51bGwgaWYgbm9uZSBhY3RpdmVcbiAgICovXG4gIGdldEN1cnJlbnRNYW51YWxPdmVycmlkZSgpIHtcbiAgICBpZiAoIXRoaXMubWFudWFsT3ZlcnJpZGVTZXJ2aWNlKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuZ2V0Q3VycmVudE92ZXJyaWRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgd2FybmluZyBiYW5uZXIgc2hvdWxkIGJlIGRpc3BsYXllZFxuICAgKiBSZXF1aXJlbWVudCA5Ljg6IEltcGxlbWVudCB3YXJuaW5nIGJhbm5lciBmbGFnXG4gICAqIFxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHdhcm5pbmcgYmFubmVyIHNob3VsZCBiZSBzaG93blxuICAgKi9cbiAgaXNXYXJuaW5nQmFubmVyQWN0aXZlKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuaXNXYXJuaW5nQmFubmVyQWN0aXZlKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1hbnVhbCBvdmVycmlkZSBoaXN0b3J5XG4gICAqIFxuICAgKiBAcGFyYW0gb3BlcmF0b3JJZCAtIE9wdGlvbmFsIG9wZXJhdG9yIGZpbHRlclxuICAgKiBAcGFyYW0gbGltaXQgLSBNYXhpbXVtIG51bWJlciBvZiByZWNvcmRzXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGhpc3RvcmljYWwgb3ZlcnJpZGVzXG4gICAqL1xuICBhc3luYyBnZXRNYW51YWxPdmVycmlkZUhpc3Rvcnkob3BlcmF0b3JJZD86IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDUwKSB7XG4gICAgaWYgKCF0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkgcmV0dXJuIFtdO1xuICAgIHJldHVybiB0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZS5nZXRPdmVycmlkZUhpc3Rvcnkob3BlcmF0b3JJZCwgbGltaXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBvcGVyYXRvciBhY2NvdW50XG4gICAqIFxuICAgKiBAcGFyYW0gb3BlcmF0b3JJZCAtIFVuaXF1ZSBvcGVyYXRvciBpZGVudGlmaWVyXG4gICAqIEBwYXJhbSBwYXNzd29yZCAtIE9wZXJhdG9yIHBhc3N3b3JkXG4gICAqIEBwYXJhbSBwZXJtaXNzaW9ucyAtIEFycmF5IG9mIHBlcm1pc3Npb25zXG4gICAqIEByZXR1cm5zIFRydWUgaWYgY3JlYXRlZCBzdWNjZXNzZnVsbHlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZU9wZXJhdG9yKG9wZXJhdG9ySWQ6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZywgcGVybWlzc2lvbnM6IHN0cmluZ1tdKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLm1hbnVhbE92ZXJyaWRlU2VydmljZSkge1xuICAgICAgY29uc29sZS5lcnJvcignTWFudWFsIG92ZXJyaWRlIHNlcnZpY2Ugbm90IGF2YWlsYWJsZScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5tYW51YWxPdmVycmlkZVNlcnZpY2UuY3JlYXRlT3BlcmF0b3Iob3BlcmF0b3JJZCwgcGFzc3dvcmQsIHBlcm1pc3Npb25zKTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PSBQb3NpdGlvbkNsb3N1cmVIYW5kbGVyIEltcGxlbWVudGF0aW9uID09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDbG9zZSBhbGwgcG9zaXRpb25zIChjYWxsZWQgYnkgY2lyY3VpdCBicmVha2VyKVxuICAgKi9cbiAgYXN5bmMgY2xvc2VBbGxQb3NpdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuZXhlY3V0aW9uRW5naW5lKSB7XG4gICAgICBhd2FpdCB0aGlzLmV4ZWN1dGlvbkVuZ2luZS5jbG9zZUFsbFBvc2l0aW9ucygpO1xuICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb25zID0gW107XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09IEJyZWFrZXJFdmVudFBlcnNpc3RlbmNlIEltcGxlbWVudGF0aW9uID09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBQZXJzaXN0IGNpcmN1aXQgYnJlYWtlciBldmVudCB0byBkYXRhYmFzZVxuICAgKi9cbiAgYXN5bmMgcGVyc2lzdEV2ZW50KGV2ZW50OiB7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG4gICAgZXZlbnRUeXBlOiAnVFJJR0dFUicgfCAnUkVTRVQnO1xuICAgIGJyZWFrZXJUeXBlPzogc3RyaW5nO1xuICAgIHJlYXNvbjogc3RyaW5nO1xuICAgIGVxdWl0eTogbnVtYmVyO1xuICAgIG9wZXJhdG9ySWQ/OiBzdHJpbmc7XG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgfSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5kYikgcmV0dXJuO1xuXG4gICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgIGBJTlNFUlQgSU5UTyBjaXJjdWl0X2JyZWFrZXJfZXZlbnRzIFxuICAgICAgICh0aW1lc3RhbXAsIGV2ZW50X3R5cGUsIHJlYXNvbiwgZXF1aXR5LCBvcGVyYXRvcl9pZCwgbWV0YWRhdGEpXG4gICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2KWAsXG4gICAgICBbXG4gICAgICAgIGV2ZW50LnRpbWVzdGFtcCxcbiAgICAgICAgZXZlbnQuZXZlbnRUeXBlLFxuICAgICAgICBldmVudC5yZWFzb24sXG4gICAgICAgIGV2ZW50LmVxdWl0eSxcbiAgICAgICAgZXZlbnQub3BlcmF0b3JJZCA/PyBudWxsLFxuICAgICAgICBldmVudC5tZXRhZGF0YSA/IEpTT04uc3RyaW5naWZ5KGV2ZW50Lm1ldGFkYXRhKSA6IG51bGwsXG4gICAgICBdXG4gICAgKTtcbiAgfVxuXG5cbiAgLy8gPT09PT09PT09PT09IFByaXZhdGUgSGVscGVyIE1ldGhvZHMgPT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHBlcmlvZGljIG1ldHJpYyB1cGRhdGVzXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0TWV0cmljVXBkYXRlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tZXRyaWNzVXBkYXRlVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tZXRyaWNzVXBkYXRlVGltZXIpO1xuICAgIH1cblxuICAgIHRoaXMubWV0cmljc1VwZGF0ZVRpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVNZXRyaWNzKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBtZXRyaWNzOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzLmNvbmZpZy5tZXRyaWNVcGRhdGVJbnRlcnZhbCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBoYXNlIHdlaWdodCBmcm9tIGFsbG9jYXRpb24gdmVjdG9yXG4gICAqL1xuICBwcml2YXRlIGdldFBoYXNlV2VpZ2h0KHBoYXNlSWQ6IFBoYXNlSWQsIGFsbG9jYXRpb246IEFsbG9jYXRpb25WZWN0b3IpOiBudW1iZXIge1xuICAgIHN3aXRjaCAocGhhc2VJZCkge1xuICAgICAgY2FzZSAncGhhc2UxJzpcbiAgICAgICAgcmV0dXJuIGFsbG9jYXRpb24udzE7XG4gICAgICBjYXNlICdwaGFzZTInOlxuICAgICAgICByZXR1cm4gYWxsb2NhdGlvbi53MjtcbiAgICAgIGNhc2UgJ3BoYXNlMyc6XG4gICAgICAgIHJldHVybiBhbGxvY2F0aW9uLnczO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZldG8gZGVjaXNpb25cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlVmV0b0RlY2lzaW9uKFxuICAgIHNpZ25hbDogSW50ZW50U2lnbmFsLFxuICAgIHJlYXNvbjogc3RyaW5nLFxuICAgIHRpbWVzdGFtcDogbnVtYmVyXG4gICk6IEJyYWluRGVjaXNpb24ge1xuICAgIGNvbnN0IGFsbG9jYXRpb24gPSB0aGlzLmFsbG9jYXRpb25FbmdpbmUuZ2V0V2VpZ2h0cyh0aGlzLmN1cnJlbnRFcXVpdHkpO1xuICAgIGNvbnN0IHJpc2tNZXRyaWNzID0gdGhpcy5yaXNrR3VhcmRpYW4uZ2V0Umlza01ldHJpY3ModGhpcy5jdXJyZW50UG9zaXRpb25zKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzaWduYWxJZDogc2lnbmFsLnNpZ25hbElkLFxuICAgICAgYXBwcm92ZWQ6IGZhbHNlLFxuICAgICAgYXV0aG9yaXplZFNpemU6IDAsXG4gICAgICByZWFzb24sXG4gICAgICBhbGxvY2F0aW9uLFxuICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgcGhhc2VJZDogc2lnbmFsLnBoYXNlSWQsXG4gICAgICAgIHNoYXJwZVJhdGlvOiAwLFxuICAgICAgICB0b3RhbFBuTDogMCxcbiAgICAgICAgdHJhZGVDb3VudDogMCxcbiAgICAgICAgd2luUmF0ZTogMCxcbiAgICAgICAgYXZnV2luOiAwLFxuICAgICAgICBhdmdMb3NzOiAwLFxuICAgICAgICBtb2RpZmllcjogMS4wLFxuICAgICAgfSxcbiAgICAgIHJpc2s6IHtcbiAgICAgICAgYXBwcm92ZWQ6IGZhbHNlLFxuICAgICAgICByZWFzb24sXG4gICAgICAgIHJpc2tNZXRyaWNzLFxuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkIGFwcHJvdmFsIHJlYXNvbiBzdHJpbmdcbiAgICovXG4gIHByaXZhdGUgYnVpbGRBcHByb3ZhbFJlYXNvbihcbiAgICByZXF1ZXN0ZWRTaXplOiBudW1iZXIsXG4gICAgYXV0aG9yaXplZFNpemU6IG51bWJlcixcbiAgICBtYXhQb3NpdGlvblNpemU6IG51bWJlcixcbiAgICByaXNrRGVjaXNpb246IFJpc2tEZWNpc2lvblxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHBhcnRzOiBzdHJpbmdbXSA9IFsnU2lnbmFsIGFwcHJvdmVkJ107XG5cbiAgICBpZiAoYXV0aG9yaXplZFNpemUgPCByZXF1ZXN0ZWRTaXplKSB7XG4gICAgICBjb25zdCByZWR1Y3Rpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICBpZiAoYXV0aG9yaXplZFNpemUgPD0gbWF4UG9zaXRpb25TaXplICYmIHJlcXVlc3RlZFNpemUgPiBtYXhQb3NpdGlvblNpemUpIHtcbiAgICAgICAgcmVkdWN0aW9ucy5wdXNoKGBhbGxvY2F0aW9uIGNhcCAoJHttYXhQb3NpdGlvblNpemUudG9GaXhlZCgyKX0pYCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyaXNrRGVjaXNpb24uYWRqdXN0ZWRTaXplICYmIHJpc2tEZWNpc2lvbi5hZGp1c3RlZFNpemUgPCByZXF1ZXN0ZWRTaXplKSB7XG4gICAgICAgIHJlZHVjdGlvbnMucHVzaChgcmlzayBhZGp1c3RtZW50YCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZWR1Y3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGFydHMucHVzaChgd2l0aCBzaXplIHJlZHVjdGlvbiBkdWUgdG8gJHtyZWR1Y3Rpb25zLmpvaW4oJywgJyl9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRzLmpvaW4oJyAnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmQgYSBkZWNpc2lvbiB0byBkYXRhYmFzZSBhbmQgbWVtb3J5XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlY29yZERlY2lzaW9uKFxuICAgIGRlY2lzaW9uOiBCcmFpbkRlY2lzaW9uLFxuICAgIHNpZ25hbDogSW50ZW50U2lnbmFsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEFkZCB0byByZWNlbnQgZGVjaXNpb25zXG4gICAgdGhpcy5yZWNlbnREZWNpc2lvbnMucHVzaChkZWNpc2lvbik7XG5cbiAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAgZGVjaXNpb25zIGluIG1lbW9yeVxuICAgIGlmICh0aGlzLnJlY2VudERlY2lzaW9ucy5sZW5ndGggPiAxMDApIHtcbiAgICAgIHRoaXMucmVjZW50RGVjaXNpb25zLnNoaWZ0KCk7XG4gICAgfVxuXG4gICAgLy8gUGVyc2lzdCB0byBkYXRhYmFzZVxuICAgIGlmICh0aGlzLmRiKSB7XG4gICAgICBjb25zdCByZWNvcmQ6IERlY2lzaW9uUmVjb3JkID0ge1xuICAgICAgICBzaWduYWxJZDogc2lnbmFsLnNpZ25hbElkLFxuICAgICAgICBwaGFzZUlkOiBzaWduYWwucGhhc2VJZCxcbiAgICAgICAgdGltZXN0YW1wOiBkZWNpc2lvbi50aW1lc3RhbXAsXG4gICAgICAgIGFwcHJvdmVkOiBkZWNpc2lvbi5hcHByb3ZlZCxcbiAgICAgICAgcmVxdWVzdGVkU2l6ZTogc2lnbmFsLnJlcXVlc3RlZFNpemUsXG4gICAgICAgIGF1dGhvcml6ZWRTaXplOiBkZWNpc2lvbi5hcHByb3ZlZCA/IGRlY2lzaW9uLmF1dGhvcml6ZWRTaXplIDogbnVsbCxcbiAgICAgICAgcmVhc29uOiBkZWNpc2lvbi5yZWFzb24sXG4gICAgICAgIHJpc2tNZXRyaWNzOiBkZWNpc2lvbi5yaXNrLnJpc2tNZXRyaWNzLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdGhpcy5kYi5xdWVyeShcbiAgICAgICAgYElOU0VSVCBJTlRPIGJyYWluX2RlY2lzaW9ucyBcbiAgICAgICAgIChzaWduYWxfaWQsIHBoYXNlX2lkLCB0aW1lc3RhbXAsIGFwcHJvdmVkLCByZXF1ZXN0ZWRfc2l6ZSwgYXV0aG9yaXplZF9zaXplLCByZWFzb24sIHJpc2tfbWV0cmljcylcbiAgICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4KVxuICAgICAgICAgT04gQ09ORkxJQ1QgKHNpZ25hbF9pZCkgRE8gTk9USElOR2AsXG4gICAgICAgIFtcbiAgICAgICAgICByZWNvcmQuc2lnbmFsSWQsXG4gICAgICAgICAgcmVjb3JkLnBoYXNlSWQsXG4gICAgICAgICAgcmVjb3JkLnRpbWVzdGFtcCxcbiAgICAgICAgICByZWNvcmQuYXBwcm92ZWQsXG4gICAgICAgICAgcmVjb3JkLnJlcXVlc3RlZFNpemUsXG4gICAgICAgICAgcmVjb3JkLmF1dGhvcml6ZWRTaXplLFxuICAgICAgICAgIHJlY29yZC5yZWFzb24sXG4gICAgICAgICAgcmVjb3JkLnJpc2tNZXRyaWNzID8gSlNPTi5zdHJpbmdpZnkocmVjb3JkLnJpc2tNZXRyaWNzKSA6IG51bGwsXG4gICAgICAgIF1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzaWduYWwgc3RhdGlzdGljc1xuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVTaWduYWxTdGF0cyhwaGFzZUlkOiBQaGFzZUlkLCBhcHByb3ZlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuc2lnbmFsU3RhdHNbcGhhc2VJZF0udG90YWwrKztcbiAgICBpZiAoYXBwcm92ZWQpIHtcbiAgICAgIHRoaXMuc2lnbmFsU3RhdHNbcGhhc2VJZF0uYXBwcm92ZWQrKztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIG5ldCBwb3NpdGlvbiBmb3Igb3Bwb3NpdGUgc2lnbmFsc1xuICAgKiBSZXF1aXJlbWVudCA3LjM6IENhbGN1bGF0ZSBuZXQgcG9zaXRpb24gZm9yIG9wcG9zaXRlIHNpZ25hbHMgb24gc2FtZSBhc3NldFxuICAgKiBcbiAgICogQHBhcmFtIHNpZ25hbHMgLSBBcnJheSBvZiBzaWduYWxzIGZvciB0aGUgc2FtZSBhc3NldFxuICAgKiBAcmV0dXJucyBOZXQgcG9zaXRpb24gc2l6ZSBhbmQgZGlyZWN0aW9uXG4gICAqL1xuICBjYWxjdWxhdGVOZXRQb3NpdGlvbihcbiAgICBzaWduYWxzOiBJbnRlbnRTaWduYWxbXVxuICApOiB7IG5ldFNpemU6IG51bWJlcjsgc2lkZTogJ0JVWScgfCAnU0VMTCcgfCAnTkVVVFJBTCcgfSB7XG4gICAgbGV0IG5ldFNpemUgPSAwO1xuXG4gICAgZm9yIChjb25zdCBzaWduYWwgb2Ygc2lnbmFscykge1xuICAgICAgaWYgKHNpZ25hbC5zaWRlID09PSAnQlVZJykge1xuICAgICAgICBuZXRTaXplICs9IHNpZ25hbC5yZXF1ZXN0ZWRTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV0U2l6ZSAtPSBzaWduYWwucmVxdWVzdGVkU2l6ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobmV0U2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiB7IG5ldFNpemUsIHNpZGU6ICdCVVknIH07XG4gICAgfSBlbHNlIGlmIChuZXRTaXplIDwgMCkge1xuICAgICAgcmV0dXJuIHsgbmV0U2l6ZTogTWF0aC5hYnMobmV0U2l6ZSksIHNpZGU6ICdTRUxMJyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geyBuZXRTaXplOiAwLCBzaWRlOiAnTkVVVFJBTCcgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlY2VudCBkZWNpc2lvbnNcbiAgICogXG4gICAqIEBwYXJhbSBsaW1pdCAtIE1heGltdW0gbnVtYmVyIG9mIGRlY2lzaW9ucyB0byByZXR1cm5cbiAgICogQHJldHVybnMgQXJyYXkgb2YgcmVjZW50IGRlY2lzaW9uc1xuICAgKi9cbiAgZ2V0UmVjZW50RGVjaXNpb25zKGxpbWl0OiBudW1iZXIgPSAyMCk6IEJyYWluRGVjaXNpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMucmVjZW50RGVjaXNpb25zLnNsaWNlKC1saW1pdCk7XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGRhc2hib2FyZCBkYXRhIHRvIEpTT05cbiAgICogUmVxdWlyZW1lbnQgMTAuODogU3VwcG9ydCBleHBvcnRpbmcgZGFzaGJvYXJkIGRhdGEgdG8gSlNPTlxuICAgKiBcbiAgICogQHJldHVybnMgSlNPTiBzdHJpbmcgb2YgZGFzaGJvYXJkIGRhdGFcbiAgICovXG4gIGFzeW5jIGV4cG9ydERhc2hib2FyZEpTT04oKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5nZXREYXNoYm9hcmREYXRhKCk7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwZXJmb3JtYW5jZSBmb3IgYWxsIHBoYXNlc1xuICAgKi9cbiAgYXN5bmMgZ2V0QWxsUGhhc2VQZXJmb3JtYW5jZSgpOiBQcm9taXNlPFBoYXNlUGVyZm9ybWFuY2VbXT4ge1xuICAgIHJldHVybiB0aGlzLnBlcmZvcm1hbmNlVHJhY2tlci5nZXRBbGxQaGFzZVBlcmZvcm1hbmNlKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRyZWFzdXJ5IHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgZ2V0VHJlYXN1cnlTdGF0dXMoKTogUHJvbWlzZTxUcmVhc3VyeVN0YXR1cz4ge1xuICAgIHJldHVybiB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5nZXRUcmVhc3VyeVN0YXR1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBuZXh0IHN3ZWVwIHRyaWdnZXIgbGV2ZWxcbiAgICovXG4gIGdldE5leHRTd2VlcFRyaWdnZXJMZXZlbCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNhcGl0YWxGbG93TWFuYWdlci5nZXROZXh0U3dlZXBUcmlnZ2VyTGV2ZWwoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdG90YWwgc3dlcHQgYW1vdW50XG4gICAqL1xuICBnZXRUb3RhbFN3ZXB0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2FwaXRhbEZsb3dNYW5hZ2VyLmdldFRvdGFsU3dlcHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaGlnaCB3YXRlcm1hcmtcbiAgICovXG4gIGdldEhpZ2hXYXRlcm1hcmsoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYXBpdGFsRmxvd01hbmFnZXIuZ2V0SGlnaFdhdGVybWFyaygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBwcmljZSBoaXN0b3J5IGZvciBjb3JyZWxhdGlvbiBjYWxjdWxhdGlvbnNcbiAgICogXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBBc3NldCBzeW1ib2xcbiAgICogQHBhcmFtIHByaWNlIC0gQ3VycmVudCBwcmljZVxuICAgKi9cbiAgdXBkYXRlUHJpY2VIaXN0b3J5KHN5bWJvbDogc3RyaW5nLCBwcmljZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5yaXNrR3VhcmRpYW4udXBkYXRlUHJpY2VIaXN0b3J5KHN5bWJvbCwgcHJpY2UpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=