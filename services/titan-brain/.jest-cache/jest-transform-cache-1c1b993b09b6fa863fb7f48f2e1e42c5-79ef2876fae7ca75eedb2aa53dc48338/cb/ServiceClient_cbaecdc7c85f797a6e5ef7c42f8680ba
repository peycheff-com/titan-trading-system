cf9d4bd376f5195a6aca3dfda579fe1d
"use strict";
/**
 * ServiceClient - Robust HTTP client for inter-service communication
 *
 * Provides a robust HTTP client with automatic retries, exponential backoff,
 * circuit breaker pattern, request/response logging, and Railway service URL support.
 *
 * Requirements: 2.1.1, 2.1.2, 2.1.3, 2.1.4, 2.1.5
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ServiceClient = exports.ServiceClientError = void 0;
const events_1 = require("events");
const CircuitBreaker_js_1 = require("./CircuitBreaker.js");
const Logger_js_1 = require("../logging/Logger.js");
/**
 * Service client error
 */
class ServiceClientError extends Error {
    status;
    response;
    config;
    cause;
    constructor(message, status, response, config, cause) {
        super(message);
        this.status = status;
        this.response = response;
        this.config = config;
        this.cause = cause;
        this.name = 'ServiceClientError';
    }
    /**
     * Check if error is retryable
     */
    isRetryable() {
        // Network errors are retryable
        if (!this.status)
            return true;
        // 5xx server errors are retryable
        if (this.status >= 500)
            return true;
        // 429 rate limit is retryable
        if (this.status === 429)
            return true;
        // 408 request timeout is retryable
        if (this.status === 408)
            return true;
        return false;
    }
    /**
     * Check if error is a timeout
     */
    isTimeout() {
        return this.message.includes('timeout') || this.status === 408;
    }
    /**
     * Check if error is a network error
     */
    isNetworkError() {
        return !this.status && this.cause !== undefined;
    }
}
exports.ServiceClientError = ServiceClientError;
/**
 * Default retry configuration
 */
const DEFAULT_RETRY_CONFIG = {
    maxRetries: 3,
    initialDelay: 1000, // 1 second
    maxDelay: 30000, // 30 seconds
    backoffMultiplier: 2,
    retryableStatusCodes: [408, 429, 500, 502, 503, 504],
    retryableErrors: ['ECONNRESET', 'ENOTFOUND', 'ECONNREFUSED', 'ETIMEDOUT']
};
/**
 * Default service client configuration
 */
const DEFAULT_CONFIG = {
    defaultTimeout: 10000, // 10 seconds
    defaultHeaders: {
        'Content-Type': 'application/json',
        'User-Agent': 'TitanBrain/1.0.0'
    },
    retry: DEFAULT_RETRY_CONFIG,
    circuitBreaker: CircuitBreaker_js_1.CircuitBreakerDefaults.http,
    logRequests: true,
    logResponses: true,
    maxResponseBodyLogSize: 1024 // 1KB
};
/**
 * Service client for robust HTTP communication
 */
class ServiceClient extends events_1.EventEmitter {
    config;
    circuitBreaker;
    logger;
    requestInterceptors = [];
    responseInterceptors = [];
    errorInterceptors = [];
    constructor(config = {}, logger) {
        super();
        this.config = { ...DEFAULT_CONFIG, ...config };
        this.logger = logger ?? Logger_js_1.Logger.getInstance('service-client');
        // Initialize circuit breaker
        this.circuitBreaker = new CircuitBreaker_js_1.CircuitBreaker({ ...this.config.circuitBreaker }, this.logger);
        // Forward circuit breaker events
        this.circuitBreaker.on('stateChange', (event) => {
            this.emit('circuitBreakerStateChange', event);
        });
        this.logger.info('Service client initialized', undefined, {
            baseUrl: this.config.baseUrl,
            defaultTimeout: this.config.defaultTimeout,
            maxRetries: this.config.retry.maxRetries,
            circuitBreakerName: this.config.circuitBreaker.name
        });
    }
    /**
     * Make an HTTP request
     */
    async request(config) {
        // Apply request interceptors
        let processedConfig = config;
        for (const interceptor of this.requestInterceptors) {
            processedConfig = await interceptor(processedConfig);
        }
        // Add default configuration
        const finalConfig = {
            timeout: this.config.defaultTimeout,
            retries: this.config.retry.maxRetries,
            retryDelay: this.config.retry.initialDelay,
            ...processedConfig,
            headers: {
                ...this.config.defaultHeaders,
                ...processedConfig.headers
            }
        };
        // Add correlation ID if not present
        if (!finalConfig.correlationId) {
            finalConfig.correlationId = this.generateCorrelationId();
        }
        // Add correlation ID to headers
        finalConfig.headers['x-correlation-id'] = finalConfig.correlationId;
        // Build full URL
        const fullUrl = this.buildUrl(finalConfig.url);
        finalConfig.url = fullUrl;
        this.logger.debug('Making HTTP request', finalConfig.correlationId, {
            method: finalConfig.method,
            url: fullUrl,
            timeout: finalConfig.timeout,
            retries: finalConfig.retries
        });
        try {
            // Execute with circuit breaker protection
            const response = await this.circuitBreaker.execute(async () => {
                return await this.executeWithRetry(finalConfig);
            });
            // Apply response interceptors
            let processedResponse = response;
            for (const interceptor of this.responseInterceptors) {
                processedResponse = await interceptor(processedResponse);
            }
            this.emit('response', processedResponse);
            return processedResponse;
        }
        catch (error) {
            let processedError = error instanceof ServiceClientError
                ? error
                : new ServiceClientError(error instanceof Error ? error.message : String(error), undefined, undefined, finalConfig, error instanceof Error ? error : undefined);
            // Apply error interceptors
            for (const interceptor of this.errorInterceptors) {
                processedError = await interceptor(processedError);
            }
            this.emit('error', processedError);
            throw processedError;
        }
    }
    /**
     * Execute request with retry logic
     */
    async executeWithRetry(config) {
        let lastError;
        const maxRetries = config.retries || 0;
        // Try initial request + retries
        for (let attempt = 1; attempt <= maxRetries + 1; attempt++) {
            try {
                const response = await this.executeRequest(config, attempt);
                if (attempt > 1) {
                    this.logger.info('Request succeeded after retry', config.correlationId, {
                        attempt,
                        url: config.url,
                        method: config.method
                    });
                }
                return response;
            }
            catch (error) {
                lastError = error instanceof ServiceClientError
                    ? error
                    : new ServiceClientError(error instanceof Error ? error.message : String(error), undefined, undefined, config, error instanceof Error ? error : undefined);
                // Check if we should retry (not on last attempt and error is retryable)
                const isLastAttempt = attempt >= maxRetries + 1;
                if (!isLastAttempt && lastError.isRetryable()) {
                    const delay = this.calculateRetryDelay(attempt);
                    this.logger.warn('Request failed, retrying', config.correlationId, {
                        attempt,
                        maxRetries: maxRetries,
                        delay,
                        error: lastError.message,
                        status: lastError.status
                    });
                    // Wait before retry
                    await new Promise(resolve => setTimeout(resolve, delay));
                    continue;
                }
                // No more retries or not retryable
                this.logger.error('Request failed permanently', lastError, config.correlationId, {
                    attempt,
                    maxRetries: maxRetries,
                    url: config.url,
                    method: config.method
                });
                throw lastError;
            }
        }
        throw lastError;
    }
    /**
     * Execute a single HTTP request
     */
    async executeRequest(config, attempt) {
        const startTime = Date.now();
        try {
            // Log request
            if (this.config.logRequests) {
                this.logger.debug('HTTP request', config.correlationId, {
                    method: config.method,
                    url: config.url,
                    attempt,
                    headers: this.sanitizeHeaders(config.headers || {}),
                    bodySize: config.body ? JSON.stringify(config.body).length : 0
                });
            }
            // Make the actual HTTP request using fetch
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), config.timeout);
            const fetchOptions = {
                method: config.method,
                headers: config.headers,
                body: config.body ? JSON.stringify(config.body) : undefined,
                signal: controller.signal
            };
            const response = await fetch(config.url, fetchOptions);
            clearTimeout(timeoutId);
            const duration = Date.now() - startTime;
            // Parse response
            let data;
            const contentType = response.headers.get('content-type') || '';
            if (contentType.includes('application/json')) {
                data = await response.json();
            }
            else {
                data = await response.text();
            }
            // Build response headers object
            const responseHeaders = {};
            response.headers.forEach((value, key) => {
                responseHeaders[key] = value;
            });
            const serviceResponse = {
                status: response.status,
                statusText: response.statusText,
                headers: responseHeaders,
                data,
                duration,
                correlationId: config.correlationId
            };
            // Log response
            if (this.config.logResponses) {
                this.logger.debug('HTTP response', config.correlationId, {
                    status: response.status,
                    statusText: response.statusText,
                    duration,
                    responseSize: this.getResponseSize(data),
                    responseBody: this.truncateResponseBody(data)
                });
            }
            // Check for HTTP errors
            if (!response.ok) {
                throw new ServiceClientError(`HTTP ${response.status}: ${response.statusText}`, response.status, serviceResponse, config);
            }
            return serviceResponse;
        }
        catch (error) {
            const duration = Date.now() - startTime;
            if (error instanceof ServiceClientError) {
                throw error;
            }
            // Handle fetch errors
            if (error instanceof Error) {
                if (error.name === 'AbortError') {
                    throw new ServiceClientError(`Request timeout after ${config.timeout}ms`, 408, undefined, config, error);
                }
                throw new ServiceClientError(`Network error: ${error.message}`, undefined, undefined, config, error);
            }
            throw new ServiceClientError('Unknown error occurred', undefined, undefined, config);
        }
    }
    /**
     * Check if error should be retried
     */
    shouldRetry(error, attempt, maxRetries) {
        // Don't retry if we've reached max attempts
        if (attempt > maxRetries) {
            return false;
        }
        // Check if error is retryable
        if (!error.isRetryable()) {
            return false;
        }
        return true;
    }
    /**
     * Calculate retry delay with exponential backoff
     */
    calculateRetryDelay(attempt) {
        const delay = this.config.retry.initialDelay * Math.pow(this.config.retry.backoffMultiplier, attempt - 1);
        return Math.min(delay, this.config.retry.maxDelay);
    }
    /**
     * Build full URL from base URL and path
     */
    buildUrl(url) {
        if (url.startsWith('http://') || url.startsWith('https://')) {
            return url;
        }
        if (this.config.baseUrl) {
            const baseUrl = this.config.baseUrl.endsWith('/')
                ? this.config.baseUrl.slice(0, -1)
                : this.config.baseUrl;
            const path = url.startsWith('/') ? url : `/${url}`;
            return `${baseUrl}${path}`;
        }
        return url;
    }
    /**
     * Generate correlation ID
     */
    generateCorrelationId() {
        return `req_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;
    }
    /**
     * Sanitize headers for logging (remove sensitive values)
     */
    sanitizeHeaders(headers) {
        const sanitized = {};
        const sensitiveHeaders = ['authorization', 'x-api-key', 'x-signature'];
        for (const [key, value] of Object.entries(headers)) {
            if (sensitiveHeaders.includes(key.toLowerCase())) {
                sanitized[key] = '[REDACTED]';
            }
            else {
                sanitized[key] = value;
            }
        }
        return sanitized;
    }
    /**
     * Get response size for logging
     */
    getResponseSize(data) {
        if (typeof data === 'string') {
            return data.length;
        }
        return JSON.stringify(data).length;
    }
    /**
     * Truncate response body for logging
     */
    truncateResponseBody(data) {
        const str = typeof data === 'string' ? data : JSON.stringify(data);
        if (str.length <= this.config.maxResponseBodyLogSize) {
            return data;
        }
        return str.substring(0, this.config.maxResponseBodyLogSize) + '... [truncated]';
    }
    /**
     * Convenience methods for common HTTP verbs
     */
    async get(url, config) {
        return this.request({ method: 'GET', url, ...config });
    }
    async post(url, body, config) {
        return this.request({ method: 'POST', url, body, ...config });
    }
    async put(url, body, config) {
        return this.request({ method: 'PUT', url, body, ...config });
    }
    async delete(url, config) {
        return this.request({ method: 'DELETE', url, ...config });
    }
    async patch(url, body, config) {
        return this.request({ method: 'PATCH', url, body, ...config });
    }
    /**
     * Add request interceptor
     */
    addRequestInterceptor(interceptor) {
        this.requestInterceptors.push(interceptor);
    }
    /**
     * Add response interceptor
     */
    addResponseInterceptor(interceptor) {
        this.responseInterceptors.push(interceptor);
    }
    /**
     * Add error interceptor
     */
    addErrorInterceptor(interceptor) {
        this.errorInterceptors.push(interceptor);
    }
    /**
     * Get circuit breaker statistics
     */
    getCircuitBreakerStats() {
        return this.circuitBreaker.getStats();
    }
    /**
     * Check if circuit breaker is healthy
     */
    isHealthy() {
        return this.circuitBreaker.isHealthy();
    }
    /**
     * Reset circuit breaker
     */
    resetCircuitBreaker() {
        this.circuitBreaker.forceClose();
    }
    /**
     * Get service client configuration
     */
    getConfig() {
        return { ...this.config };
    }
}
exports.ServiceClient = ServiceClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3NyYy9zZXJ2aWNlcy9TZXJ2aWNlQ2xpZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFFSCxtQ0FBc0M7QUFDdEMsMkRBQW1HO0FBQ25HLG9EQUE4QztBQWtFOUM7O0dBRUc7QUFDSCxNQUFhLGtCQUFtQixTQUFRLEtBQUs7SUFHekI7SUFDQTtJQUNBO0lBQ0E7SUFMbEIsWUFDRSxPQUFlLEVBQ0MsTUFBZSxFQUNmLFFBQTBCLEVBQzFCLE1BQXNCLEVBQ3RCLEtBQWE7UUFFN0IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBTEMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUNmLGFBQVEsR0FBUixRQUFRLENBQWtCO1FBQzFCLFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQ3RCLFVBQUssR0FBTCxLQUFLLENBQVE7UUFHN0IsSUFBSSxDQUFDLElBQUksR0FBRyxvQkFBb0IsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXO1FBQ1QsK0JBQStCO1FBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRTlCLGtDQUFrQztRQUNsQyxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXBDLDhCQUE4QjtRQUM5QixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXJDLG1DQUFtQztRQUNuQyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssR0FBRztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXJDLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxHQUFHLENBQUM7SUFDakUs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Qy9ELENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSyxDQUFVLEdBQVcsRUFBRSxJQUFVLEVBQUUsTUFBK0I7UUFDM0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUIsQ0FBQyxXQUErQjtRQUNuRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRDs7T0FFRztJQUNILHNCQUFzQixDQUFDLFdBQWdDO1FBQ3JELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CLENBQUMsV0FBNkI7UUFDL0MsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxzQkFBc0I7UUFDcEIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDUCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CO1FBQ2pCLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUF6Y0Qsc0NBeWNDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi9zcmMvc2VydmljZXMvU2VydmljZUNsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNlcnZpY2VDbGllbnQgLSBSb2J1c3QgSFRUUCBjbGllbnQgZm9yIGludGVyLXNlcnZpY2UgY29tbXVuaWNhdGlvblxuICogXG4gKiBQcm92aWRlcyBhIHJvYnVzdCBIVFRQIGNsaWVudCB3aXRoIGF1dG9tYXRpYyByZXRyaWVzLCBleHBvbmVudGlhbCBiYWNrb2ZmLFxuICogY2lyY3VpdCBicmVha2VyIHBhdHRlcm4sIHJlcXVlc3QvcmVzcG9uc2UgbG9nZ2luZywgYW5kIFJhaWx3YXkgc2VydmljZSBVUkwgc3VwcG9ydC5cbiAqIFxuICogUmVxdWlyZW1lbnRzOiAyLjEuMSwgMi4xLjIsIDIuMS4zLCAyLjEuNCwgMi4xLjVcbiAqL1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgQ2lyY3VpdEJyZWFrZXIsIENpcmN1aXRCcmVha2VyQ29uZmlnLCBDaXJjdWl0QnJlYWtlckRlZmF1bHRzIH0gZnJvbSAnLi9DaXJjdWl0QnJlYWtlci5qcyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi9sb2dnaW5nL0xvZ2dlci5qcyc7XG5cbi8qKlxuICogSFRUUCBtZXRob2RzIHN1cHBvcnRlZCBieSBTZXJ2aWNlQ2xpZW50XG4gKi9cbmV4cG9ydCB0eXBlIEh0dHBNZXRob2QgPSAnR0VUJyB8ICdQT1NUJyB8ICdQVVQnIHwgJ0RFTEVURScgfCAnUEFUQ0gnO1xuXG4vKipcbiAqIFJlcXVlc3QgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlcXVlc3RDb25maWcge1xuICBtZXRob2Q6IEh0dHBNZXRob2Q7XG4gIHVybDogc3RyaW5nO1xuICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgYm9keT86IGFueTtcbiAgdGltZW91dD86IG51bWJlcjtcbiAgcmV0cmllcz86IG51bWJlcjtcbiAgcmV0cnlEZWxheT86IG51bWJlcjtcbiAgY29ycmVsYXRpb25JZD86IHN0cmluZztcbn1cblxuLyoqXG4gKiBSZXNwb25zZSBvYmplY3RcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlUmVzcG9uc2U8VCA9IGFueT4ge1xuICBzdGF0dXM6IG51bWJlcjtcbiAgc3RhdHVzVGV4dDogc3RyaW5nO1xuICBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBkYXRhOiBUO1xuICBkdXJhdGlvbjogbnVtYmVyO1xuICBjb3JyZWxhdGlvbklkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFJldHJ5IGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZXRyeUNvbmZpZyB7XG4gIG1heFJldHJpZXM6IG51bWJlcjtcbiAgaW5pdGlhbERlbGF5OiBudW1iZXI7XG4gIG1heERlbGF5OiBudW1iZXI7XG4gIGJhY2tvZmZNdWx0aXBsaWVyOiBudW1iZXI7XG4gIHJldHJ5YWJsZVN0YXR1c0NvZGVzOiBudW1iZXJbXTtcbiAgcmV0cnlhYmxlRXJyb3JzOiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBTZXJ2aWNlIGNsaWVudCBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VydmljZUNsaWVudENvbmZpZyB7XG4gIGJhc2VVcmw/OiBzdHJpbmc7XG4gIGRlZmF1bHRUaW1lb3V0OiBudW1iZXI7XG4gIGRlZmF1bHRIZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICByZXRyeTogUmV0cnlDb25maWc7XG4gIGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlckNvbmZpZztcbiAgbG9nUmVxdWVzdHM6IGJvb2xlYW47XG4gIGxvZ1Jlc3BvbnNlczogYm9vbGVhbjtcbiAgbWF4UmVzcG9uc2VCb2R5TG9nU2l6ZTogbnVtYmVyO1xufVxuXG4vKipcbiAqIFJlcXVlc3QvUmVzcG9uc2UgaW50ZXJjZXB0b3IgZnVuY3Rpb25zXG4gKi9cbmV4cG9ydCB0eXBlIFJlcXVlc3RJbnRlcmNlcHRvciA9IChjb25maWc6IFJlcXVlc3RDb25maWcpID0+IFJlcXVlc3RDb25maWcgfCBQcm9taXNlPFJlcXVlc3RDb25maWc+O1xuZXhwb3J0IHR5cGUgUmVzcG9uc2VJbnRlcmNlcHRvcjxUID0gYW55PiA9IChyZXNwb25zZTogU2VydmljZVJlc3BvbnNlPFQ+KSA9PiBTZXJ2aWNlUmVzcG9uc2U8VD4gfCBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj47XG5leHBvcnQgdHlwZSBFcnJvckludGVyY2VwdG9yID0gKGVycm9yOiBTZXJ2aWNlQ2xpZW50RXJyb3IpID0+IFNlcnZpY2VDbGllbnRFcnJvciB8IFByb21pc2U8U2VydmljZUNsaWVudEVycm9yPjtcblxuLyoqXG4gKiBTZXJ2aWNlIGNsaWVudCBlcnJvclxuICovXG5leHBvcnQgY2xhc3MgU2VydmljZUNsaWVudEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgcHVibGljIHJlYWRvbmx5IHN0YXR1cz86IG51bWJlcixcbiAgICBwdWJsaWMgcmVhZG9ubHkgcmVzcG9uc2U/OiBTZXJ2aWNlUmVzcG9uc2UsXG4gICAgcHVibGljIHJlYWRvbmx5IGNvbmZpZz86IFJlcXVlc3RDb25maWcsXG4gICAgcHVibGljIHJlYWRvbmx5IGNhdXNlPzogRXJyb3JcbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ1NlcnZpY2VDbGllbnRFcnJvcic7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZXJyb3IgaXMgcmV0cnlhYmxlXG4gICAqL1xuICBpc1JldHJ5YWJsZSgpOiBib29sZWFuIHtcbiAgICAvLyBOZXR3b3JrIGVycm9ycyBhcmUgcmV0cnlhYmxlXG4gICAgaWYgKCF0aGlzLnN0YXR1cykgcmV0dXJuIHRydWU7XG4gICAgXG4gICAgLy8gNXh4IHNlcnZlciBlcnJvcnMgYXJlIHJldHJ5YWJsZVxuICAgIGlmICh0aGlzLnN0YXR1cyA+PSA1MDApIHJldHVybiB0cnVlO1xuICAgIFxuICAgIC8vIDQyOSByYXRlIGxpbWl0IGlzIHJldHJ5YWJsZVxuICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gNDI5KSByZXR1cm4gdHJ1ZTtcbiAgICBcbiAgICAvLyA0MDggcmVxdWVzdCB0aW1lb3V0IGlzIHJldHJ5YWJsZVxuICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gNDA4KSByZXR1cm4gdHJ1ZTtcbiAgICBcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZXJyb3IgaXMgYSB0aW1lb3V0XG4gICAqL1xuICBpc1RpbWVvdXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZS5pbmNsdWRlcygndGltZW91dCcpIHx8IHRoaXMuc3RhdHVzID09PSA0MDg7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZXJyb3IgaXMgYSBuZXR3b3JrIGVycm9yXG4gICAqL1xuICBpc05ldHdvcmtFcnJvcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuc3RhdHVzICYmIHRoaXMuY2F1c2UgIT09IHVuZGVmaW5lZDtcbiAgfVxufVxuXG4vKipcbiAqIERlZmF1bHQgcmV0cnkgY29uZmlndXJhdGlvblxuICovXG5jb25zdCBERUZBVUxUX1JFVFJZX0NPTkZJRzogUmV0cnlDb25maWcgPSB7XG4gIG1heFJldHJpZXM6IDMsXG4gIGluaXRpYWxEZWxheTogMTAwMCwgICAgICAvLyAxIHNlY29uZFxuICBtYXhEZWxheTogMzAwMDAsICAgICAgICAgLy8gMzAgc2Vjb25kc1xuICBiYWNrb2ZmTXVsdGlwbGllcjogMixcbiAgcmV0cnlhYmxlU3RhdHVzQ29kZXM6IFs0MDgsIDQyOSwgNTAwLCA1MDIsIDUwMywgNTA0XSxcbiAgcmV0cnlhYmxlRXJyb3JzOiBbJ0VDT05OUkVTRVQnLCAnRU5PVEZPVU5EJywgJ0VDT05OUkVGVVNFRCcsICdFVElNRURPVVQnXVxufTtcblxuLyoqXG4gKiBEZWZhdWx0IHNlcnZpY2UgY2xpZW50IGNvbmZpZ3VyYXRpb25cbiAqL1xuY29uc3QgREVGQVVMVF9DT05GSUc6IFNlcnZpY2VDbGllbnRDb25maWcgPSB7XG4gIGRlZmF1bHRUaW1lb3V0OiAxMDAwMCwgICAvLyAxMCBzZWNvbmRzXG4gIGRlZmF1bHRIZWFkZXJzOiB7XG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAnVXNlci1BZ2VudCc6ICdUaXRhbkJyYWluLzEuMC4wJ1xuICB9LFxuICByZXRyeTogREVGQVVMVF9SRVRSWV9DT05GSUcsXG4gIGNpcmN1aXRCcmVha2VyOiBDaXJjdWl0QnJlYWtlckRlZmF1bHRzLmh0dHAsXG4gIGxvZ1JlcXVlc3RzOiB0cnVlLFxuICBsb2dSZXNwb25zZXM6IHRydWUsXG4gIG1heFJlc3BvbnNlQm9keUxvZ1NpemU6IDEwMjQgLy8gMUtCXG59O1xuXG4vKipcbiAqIFNlcnZpY2UgY2xpZW50IGZvciByb2J1c3QgSFRUUCBjb21tdW5pY2F0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBTZXJ2aWNlQ2xpZW50IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcHJpdmF0ZSBjb25maWc6IFNlcnZpY2VDbGllbnRDb25maWc7XG4gIHByaXZhdGUgY2lyY3VpdEJyZWFrZXI6IENpcmN1aXRCcmVha2VyO1xuICBwcml2YXRlIGxvZ2dlcjogTG9nZ2VyO1xuICBwcml2YXRlIHJlcXVlc3RJbnRlcmNlcHRvcnM6IFJlcXVlc3RJbnRlcmNlcHRvcltdID0gW107XG4gIHByaXZhdGUgcmVzcG9uc2VJbnRlcmNlcHRvcnM6IFJlc3BvbnNlSW50ZXJjZXB0b3JbXSA9IFtdO1xuICBwcml2YXRlIGVycm9ySW50ZXJjZXB0b3JzOiBFcnJvckludGVyY2VwdG9yW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFBhcnRpYWw8U2VydmljZUNsaWVudENvbmZpZz4gPSB7fSwgbG9nZ2VyPzogTG9nZ2VyKSB7XG4gICAgc3VwZXIoKTtcbiAgICBcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLmNvbmZpZyB9O1xuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyID8/IExvZ2dlci5nZXRJbnN0YW5jZSgnc2VydmljZS1jbGllbnQnKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIGNpcmN1aXQgYnJlYWtlclxuICAgIHRoaXMuY2lyY3VpdEJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoXG4gICAgICB7IC4uLnRoaXMuY29uZmlnLmNpcmN1aXRCcmVha2VyIH0sXG4gICAgICB0aGlzLmxvZ2dlclxuICAgICk7XG4gICAgXG4gICAgLy8gRm9yd2FyZCBjaXJjdWl0IGJyZWFrZXIgZXZlbnRzXG4gICAgdGhpcy5jaXJjdWl0QnJlYWtlci5vbignc3RhdGVDaGFuZ2UnLCAoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMuZW1pdCgnY2lyY3VpdEJyZWFrZXJTdGF0ZUNoYW5nZScsIGV2ZW50KTtcbiAgICB9KTtcbiAgICBcbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdTZXJ2aWNlIGNsaWVudCBpbml0aWFsaXplZCcsIHVuZGVmaW5lZCwge1xuICAgICAgYmFzZVVybDogdGhpcy5jb25maWcuYmFzZVVybCxcbiAgICAgIGRlZmF1bHRUaW1lb3V0OiB0aGlzLmNvbmZpZy5kZWZhdWx0VGltZW91dCxcbiAgICAgIG1heFJldHJpZXM6IHRoaXMuY29uZmlnLnJldHJ5Lm1heFJldHJpZXMsXG4gICAgICBjaXJjdWl0QnJlYWtlck5hbWU6IHRoaXMuY29uZmlnLmNpcmN1aXRCcmVha2VyLm5hbWVcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIGFuIEhUVFAgcmVxdWVzdFxuICAgKi9cbiAgYXN5bmMgcmVxdWVzdDxUID0gYW55Pihjb25maWc6IFJlcXVlc3RDb25maWcpOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj4ge1xuICAgIC8vIEFwcGx5IHJlcXVlc3QgaW50ZXJjZXB0b3JzXG4gICAgbGV0IHByb2Nlc3NlZENvbmZpZyA9IGNvbmZpZztcbiAgICBmb3IgKGNvbnN0IGludGVyY2VwdG9yIG9mIHRoaXMucmVxdWVzdEludGVyY2VwdG9ycykge1xuICAgICAgcHJvY2Vzc2VkQ29uZmlnID0gYXdhaXQgaW50ZXJjZXB0b3IocHJvY2Vzc2VkQ29uZmlnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGRlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIGNvbnN0IGZpbmFsQ29uZmlnOiBSZXF1ZXN0Q29uZmlnID0ge1xuICAgICAgdGltZW91dDogdGhpcy5jb25maWcuZGVmYXVsdFRpbWVvdXQsXG4gICAgICByZXRyaWVzOiB0aGlzLmNvbmZpZy5yZXRyeS5tYXhSZXRyaWVzLFxuICAgICAgcmV0cnlEZWxheTogdGhpcy5jb25maWcucmV0cnkuaW5pdGlhbERlbGF5LFxuICAgICAgLi4ucHJvY2Vzc2VkQ29uZmlnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAuLi50aGlzLmNvbmZpZy5kZWZhdWx0SGVhZGVycyxcbiAgICAgICAgLi4ucHJvY2Vzc2VkQ29uZmlnLmhlYWRlcnNcbiAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIC8vIEFkZCBjb3JyZWxhdGlvbiBJRCBpZiBub3QgcHJlc2VudFxuICAgIGlmICghZmluYWxDb25maWcuY29ycmVsYXRpb25JZCkge1xuICAgICAgZmluYWxDb25maWcuY29ycmVsYXRpb25JZCA9IHRoaXMuZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBjb3JyZWxhdGlvbiBJRCB0byBoZWFkZXJzXG4gICAgZmluYWxDb25maWcuaGVhZGVycyFbJ3gtY29ycmVsYXRpb24taWQnXSA9IGZpbmFsQ29uZmlnLmNvcnJlbGF0aW9uSWQ7XG4gICAgXG4gICAgLy8gQnVpbGQgZnVsbCBVUkxcbiAgICBjb25zdCBmdWxsVXJsID0gdGhpcy5idWlsZFVybChmaW5hbENvbmZpZy51cmwpO1xuICAgIGZpbmFsQ29uZmlnLnVybCA9IGZ1bGxVcmw7XG4gICAgXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ01ha2luZyBIVFRQIHJlcXVlc3QnLCBmaW5hbENvbmZpZy5jb3JyZWxhdGlvbklkLCB7XG4gICAgICBtZXRob2Q6IGZpbmFsQ29uZmlnLm1ldGhvZCxcbiAgICAgIHVybDogZnVsbFVybCxcbiAgICAgIHRpbWVvdXQ6IGZpbmFsQ29uZmlnLnRpbWVvdXQsXG4gICAgICByZXRyaWVzOiBmaW5hbENvbmZpZy5yZXRyaWVzXG4gICAgfSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEV4ZWN1dGUgd2l0aCBjaXJjdWl0IGJyZWFrZXIgcHJvdGVjdGlvblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNpcmN1aXRCcmVha2VyLmV4ZWN1dGUoYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlV2l0aFJldHJ5KGZpbmFsQ29uZmlnKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBBcHBseSByZXNwb25zZSBpbnRlcmNlcHRvcnNcbiAgICAgIGxldCBwcm9jZXNzZWRSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgZm9yIChjb25zdCBpbnRlcmNlcHRvciBvZiB0aGlzLnJlc3BvbnNlSW50ZXJjZXB0b3JzKSB7XG4gICAgICAgIHByb2Nlc3NlZFJlc3BvbnNlID0gYXdhaXQgaW50ZXJjZXB0b3IocHJvY2Vzc2VkUmVzcG9uc2UpIGFzIFNlcnZpY2VSZXNwb25zZTxUPjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5lbWl0KCdyZXNwb25zZScsIHByb2Nlc3NlZFJlc3BvbnNlKTtcbiAgICAgIHJldHVybiBwcm9jZXNzZWRSZXNwb25zZSBhcyBTZXJ2aWNlUmVzcG9uc2U8VD47XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbGV0IHByb2Nlc3NlZEVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBTZXJ2aWNlQ2xpZW50RXJyb3IgXG4gICAgICAgID8gZXJyb3IgXG4gICAgICAgIDogbmV3IFNlcnZpY2VDbGllbnRFcnJvcihcbiAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGZpbmFsQ29uZmlnLFxuICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogdW5kZWZpbmVkXG4gICAgICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgZXJyb3IgaW50ZXJjZXB0b3JzXG4gICAgICBmb3IgKGNvbnN0IGludGVyY2VwdG9yIG9mIHRoaXMuZXJyb3JJbnRlcmNlcHRvcnMpIHtcbiAgICAgICAgcHJvY2Vzc2VkRXJyb3IgPSBhd2FpdCBpbnRlcmNlcHRvcihwcm9jZXNzZWRFcnJvcik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBwcm9jZXNzZWRFcnJvcik7XG4gICAgICB0aHJvdyBwcm9jZXNzZWRFcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSByZXF1ZXN0IHdpdGggcmV0cnkgbG9naWNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVdpdGhSZXRyeTxUPihjb25maWc6IFJlcXVlc3RDb25maWcpOiBQcm9taXNlPFNlcnZpY2VSZXNwb25zZTxUPj4ge1xuICAgIGxldCBsYXN0RXJyb3I6IFNlcnZpY2VDbGllbnRFcnJvciB8IHVuZGVmaW5lZDtcbiAgICBjb25zdCBtYXhSZXRyaWVzID0gY29uZmlnLnJldHJpZXMgfHwgMDtcbiAgICBcbiAgICAvLyBUcnkgaW5pdGlhbCByZXF1ZXN0ICsgcmV0cmllc1xuICAgIGZvciAobGV0IGF0dGVtcHQgPSAxOyBhdHRlbXB0IDw9IG1heFJldHJpZXMgKyAxOyBhdHRlbXB0KyspIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5leGVjdXRlUmVxdWVzdDxUPihjb25maWcsIGF0dGVtcHQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGF0dGVtcHQgPiAxKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVxdWVzdCBzdWNjZWVkZWQgYWZ0ZXIgcmV0cnknLCBjb25maWcuY29ycmVsYXRpb25JZCwge1xuICAgICAgICAgICAgYXR0ZW1wdCxcbiAgICAgICAgICAgIHVybDogY29uZmlnLnVybCxcbiAgICAgICAgICAgIG1ldGhvZDogY29uZmlnLm1ldGhvZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbGFzdEVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBTZXJ2aWNlQ2xpZW50RXJyb3IgXG4gICAgICAgICAgPyBlcnJvciBcbiAgICAgICAgICA6IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoXG4gICAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogdW5kZWZpbmVkXG4gICAgICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIHJldHJ5IChub3Qgb24gbGFzdCBhdHRlbXB0IGFuZCBlcnJvciBpcyByZXRyeWFibGUpXG4gICAgICAgIGNvbnN0IGlzTGFzdEF0dGVtcHQgPSBhdHRlbXB0ID49IG1heFJldHJpZXMgKyAxO1xuICAgICAgICBpZiAoIWlzTGFzdEF0dGVtcHQgJiYgbGFzdEVycm9yLmlzUmV0cnlhYmxlKCkpIHtcbiAgICAgICAgICBjb25zdCBkZWxheSA9IHRoaXMuY2FsY3VsYXRlUmV0cnlEZWxheShhdHRlbXB0KTtcbiAgICAgICAgICBcbiAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdSZXF1ZXN0IGZhaWxlZCwgcmV0cnlpbmcnLCBjb25maWcuY29ycmVsYXRpb25JZCwge1xuICAgICAgICAgICAgYXR0ZW1wdCxcbiAgICAgICAgICAgIG1heFJldHJpZXM6IG1heFJldHJpZXMsXG4gICAgICAgICAgICBkZWxheSxcbiAgICAgICAgICAgIGVycm9yOiBsYXN0RXJyb3IubWVzc2FnZSxcbiAgICAgICAgICAgIHN0YXR1czogbGFzdEVycm9yLnN0YXR1c1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFdhaXQgYmVmb3JlIHJldHJ5XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5KSk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIE5vIG1vcmUgcmV0cmllcyBvciBub3QgcmV0cnlhYmxlXG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdSZXF1ZXN0IGZhaWxlZCBwZXJtYW5lbnRseScsIGxhc3RFcnJvciwgY29uZmlnLmNvcnJlbGF0aW9uSWQsIHtcbiAgICAgICAgICBhdHRlbXB0LFxuICAgICAgICAgIG1heFJldHJpZXM6IG1heFJldHJpZXMsXG4gICAgICAgICAgdXJsOiBjb25maWcudXJsLFxuICAgICAgICAgIG1ldGhvZDogY29uZmlnLm1ldGhvZFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRocm93IGxhc3RFcnJvcjtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgdGhyb3cgbGFzdEVycm9yITtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgc2luZ2xlIEhUVFAgcmVxdWVzdFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlUmVxdWVzdDxUPihjb25maWc6IFJlcXVlc3RDb25maWcsIGF0dGVtcHQ6IG51bWJlcik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gTG9nIHJlcXVlc3RcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sb2dSZXF1ZXN0cykge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnSFRUUCByZXF1ZXN0JywgY29uZmlnLmNvcnJlbGF0aW9uSWQsIHtcbiAgICAgICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2QsXG4gICAgICAgICAgdXJsOiBjb25maWcudXJsLFxuICAgICAgICAgIGF0dGVtcHQsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5zYW5pdGl6ZUhlYWRlcnMoY29uZmlnLmhlYWRlcnMgfHwge30pLFxuICAgICAgICAgIGJvZHlTaXplOiBjb25maWcuYm9keSA/IEpTT04uc3RyaW5naWZ5KGNvbmZpZy5ib2R5KS5sZW5ndGggOiAwXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBNYWtlIHRoZSBhY3R1YWwgSFRUUCByZXF1ZXN0IHVzaW5nIGZldGNoXG4gICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIGNvbmZpZy50aW1lb3V0KTtcbiAgICAgIFxuICAgICAgY29uc3QgZmV0Y2hPcHRpb25zOiBSZXF1ZXN0SW5pdCA9IHtcbiAgICAgICAgbWV0aG9kOiBjb25maWcubWV0aG9kLFxuICAgICAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcbiAgICAgICAgYm9keTogY29uZmlnLmJvZHkgPyBKU09OLnN0cmluZ2lmeShjb25maWcuYm9keSkgOiB1bmRlZmluZWQsXG4gICAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goY29uZmlnLnVybCwgZmV0Y2hPcHRpb25zKTtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIC8vIFBhcnNlIHJlc3BvbnNlXG4gICAgICBsZXQgZGF0YTogVDtcbiAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpIHx8ICcnO1xuICAgICAgXG4gICAgICBpZiAoY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkge1xuICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpIGFzIFQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpIGFzIFQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEJ1aWxkIHJlc3BvbnNlIGhlYWRlcnMgb2JqZWN0XG4gICAgICBjb25zdCByZXNwb25zZUhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICAgIHJlc3BvbnNlLmhlYWRlcnMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICByZXNwb25zZUhlYWRlcnNba2V5XSA9IHZhbHVlO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNlcnZpY2VSZXNwb25zZTogU2VydmljZVJlc3BvbnNlPFQ+ID0ge1xuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgaGVhZGVyczogcmVzcG9uc2VIZWFkZXJzLFxuICAgICAgICBkYXRhLFxuICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgY29ycmVsYXRpb25JZDogY29uZmlnLmNvcnJlbGF0aW9uSWRcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIExvZyByZXNwb25zZVxuICAgICAgaWYgKHRoaXMuY29uZmlnLmxvZ1Jlc3BvbnNlcykge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnSFRUUCByZXNwb25zZScsIGNvbmZpZy5jb3JyZWxhdGlvbklkLCB7XG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgICByZXNwb25zZVNpemU6IHRoaXMuZ2V0UmVzcG9uc2VTaXplKGRhdGEpLFxuICAgICAgICAgIHJlc3BvbnNlQm9keTogdGhpcy50cnVuY2F0ZVJlc3BvbnNlQm9keShkYXRhKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIEhUVFAgZXJyb3JzXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoXG4gICAgICAgICAgYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCxcbiAgICAgICAgICByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgc2VydmljZVJlc3BvbnNlLFxuICAgICAgICAgIGNvbmZpZ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gc2VydmljZVJlc3BvbnNlO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2VydmljZUNsaWVudEVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBIYW5kbGUgZmV0Y2ggZXJyb3JzXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFNlcnZpY2VDbGllbnRFcnJvcihcbiAgICAgICAgICAgIGBSZXF1ZXN0IHRpbWVvdXQgYWZ0ZXIgJHtjb25maWcudGltZW91dH1tc2AsXG4gICAgICAgICAgICA0MDgsXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBlcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRocm93IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoXG4gICAgICAgICAgYE5ldHdvcmsgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIGVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRocm93IG5ldyBTZXJ2aWNlQ2xpZW50RXJyb3IoXG4gICAgICAgICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGNvbmZpZ1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgZXJyb3Igc2hvdWxkIGJlIHJldHJpZWRcbiAgICovXG4gIHByaXZhdGUgc2hvdWxkUmV0cnkoZXJyb3I6IFNlcnZpY2VDbGllbnRFcnJvciwgYXR0ZW1wdDogbnVtYmVyLCBtYXhSZXRyaWVzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAvLyBEb24ndCByZXRyeSBpZiB3ZSd2ZSByZWFjaGVkIG1heCBhdHRlbXB0c1xuICAgIGlmIChhdHRlbXB0ID4gbWF4UmV0cmllcykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiBlcnJvciBpcyByZXRyeWFibGVcbiAgICBpZiAoIWVycm9yLmlzUmV0cnlhYmxlKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHJldHJ5IGRlbGF5IHdpdGggZXhwb25lbnRpYWwgYmFja29mZlxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSZXRyeURlbGF5KGF0dGVtcHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgZGVsYXkgPSB0aGlzLmNvbmZpZy5yZXRyeS5pbml0aWFsRGVsYXkgKiBNYXRoLnBvdyh0aGlzLmNvbmZpZy5yZXRyeS5iYWNrb2ZmTXVsdGlwbGllciwgYXR0ZW1wdCAtIDEpO1xuICAgIHJldHVybiBNYXRoLm1pbihkZWxheSwgdGhpcy5jb25maWcucmV0cnkubWF4RGVsYXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkIGZ1bGwgVVJMIGZyb20gYmFzZSBVUkwgYW5kIHBhdGhcbiAgICovXG4gIHByaXZhdGUgYnVpbGRVcmwodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICh1cmwuc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IHVybC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XG4gICAgICByZXR1cm4gdXJsO1xuICAgIH1cbiAgICBcbiAgICBpZiAodGhpcy5jb25maWcuYmFzZVVybCkge1xuICAgICAgY29uc3QgYmFzZVVybCA9IHRoaXMuY29uZmlnLmJhc2VVcmwuZW5kc1dpdGgoJy8nKSBcbiAgICAgICAgPyB0aGlzLmNvbmZpZy5iYXNlVXJsLnNsaWNlKDAsIC0xKSBcbiAgICAgICAgOiB0aGlzLmNvbmZpZy5iYXNlVXJsO1xuICAgICAgY29uc3QgcGF0aCA9IHVybC5zdGFydHNXaXRoKCcvJykgPyB1cmwgOiBgLyR7dXJsfWA7XG4gICAgICByZXR1cm4gYCR7YmFzZVVybH0ke3BhdGh9YDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHVybDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb3JyZWxhdGlvbiBJRFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHJlcV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDExKX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFNhbml0aXplIGhlYWRlcnMgZm9yIGxvZ2dpbmcgKHJlbW92ZSBzZW5zaXRpdmUgdmFsdWVzKVxuICAgKi9cbiAgcHJpdmF0ZSBzYW5pdGl6ZUhlYWRlcnMoaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGNvbnN0IHNhbml0aXplZDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgIGNvbnN0IHNlbnNpdGl2ZUhlYWRlcnMgPSBbJ2F1dGhvcml6YXRpb24nLCAneC1hcGkta2V5JywgJ3gtc2lnbmF0dXJlJ107XG4gICAgXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoaGVhZGVycykpIHtcbiAgICAgIGlmIChzZW5zaXRpdmVIZWFkZXJzLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICBzYW5pdGl6ZWRba2V5XSA9ICdbUkVEQUNURURdJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNhbml0aXplZFtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzYW5pdGl6ZWQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlc3BvbnNlIHNpemUgZm9yIGxvZ2dpbmdcbiAgICovXG4gIHByaXZhdGUgZ2V0UmVzcG9uc2VTaXplKGRhdGE6IGFueSk6IG51bWJlciB7XG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGRhdGEubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSkubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIFRydW5jYXRlIHJlc3BvbnNlIGJvZHkgZm9yIGxvZ2dpbmdcbiAgICovXG4gIHByaXZhdGUgdHJ1bmNhdGVSZXNwb25zZUJvZHkoZGF0YTogYW55KTogYW55IHtcbiAgICBjb25zdCBzdHIgPSB0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycgPyBkYXRhIDogSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgaWYgKHN0ci5sZW5ndGggPD0gdGhpcy5jb25maWcubWF4UmVzcG9uc2VCb2R5TG9nU2l6ZSkge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHRoaXMuY29uZmlnLm1heFJlc3BvbnNlQm9keUxvZ1NpemUpICsgJy4uLiBbdHJ1bmNhdGVkXSc7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kcyBmb3IgY29tbW9uIEhUVFAgdmVyYnNcbiAgICovXG4gIGFzeW5jIGdldDxUID0gYW55Pih1cmw6IHN0cmluZywgY29uZmlnPzogUGFydGlhbDxSZXF1ZXN0Q29uZmlnPik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPih7IG1ldGhvZDogJ0dFVCcsIHVybCwgLi4uY29uZmlnIH0pO1xuICB9XG5cbiAgYXN5bmMgcG9zdDxUID0gYW55Pih1cmw6IHN0cmluZywgYm9keT86IGFueSwgY29uZmlnPzogUGFydGlhbDxSZXF1ZXN0Q29uZmlnPik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPih7IG1ldGhvZDogJ1BPU1QnLCB1cmwsIGJvZHksIC4uLmNvbmZpZyB9KTtcbiAgfVxuXG4gIGFzeW5jIHB1dDxUID0gYW55Pih1cmw6IHN0cmluZywgYm9keT86IGFueSwgY29uZmlnPzogUGFydGlhbDxSZXF1ZXN0Q29uZmlnPik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPih7IG1ldGhvZDogJ1BVVCcsIHVybCwgYm9keSwgLi4uY29uZmlnIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlPFQgPSBhbnk+KHVybDogc3RyaW5nLCBjb25maWc/OiBQYXJ0aWFsPFJlcXVlc3RDb25maWc+KTogUHJvbWlzZTxTZXJ2aWNlUmVzcG9uc2U8VD4+IHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0PFQ+KHsgbWV0aG9kOiAnREVMRVRFJywgdXJsLCAuLi5jb25maWcgfSk7XG4gIH1cblxuICBhc3luYyBwYXRjaDxUID0gYW55Pih1cmw6IHN0cmluZywgYm9keT86IGFueSwgY29uZmlnPzogUGFydGlhbDxSZXF1ZXN0Q29uZmlnPik6IFByb21pc2U8U2VydmljZVJlc3BvbnNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdDxUPih7IG1ldGhvZDogJ1BBVENIJywgdXJsLCBib2R5LCAuLi5jb25maWcgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJlcXVlc3QgaW50ZXJjZXB0b3JcbiAgICovXG4gIGFkZFJlcXVlc3RJbnRlcmNlcHRvcihpbnRlcmNlcHRvcjogUmVxdWVzdEludGVyY2VwdG9yKTogdm9pZCB7XG4gICAgdGhpcy5yZXF1ZXN0SW50ZXJjZXB0b3JzLnB1c2goaW50ZXJjZXB0b3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCByZXNwb25zZSBpbnRlcmNlcHRvclxuICAgKi9cbiAgYWRkUmVzcG9uc2VJbnRlcmNlcHRvcihpbnRlcmNlcHRvcjogUmVzcG9uc2VJbnRlcmNlcHRvcik6IHZvaWQge1xuICAgIHRoaXMucmVzcG9uc2VJbnRlcmNlcHRvcnMucHVzaChpbnRlcmNlcHRvcik7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGVycm9yIGludGVyY2VwdG9yXG4gICAqL1xuICBhZGRFcnJvckludGVyY2VwdG9yKGludGVyY2VwdG9yOiBFcnJvckludGVyY2VwdG9yKTogdm9pZCB7XG4gICAgdGhpcy5lcnJvckludGVyY2VwdG9ycy5wdXNoKGludGVyY2VwdG9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2lyY3VpdCBicmVha2VyIHN0YXRpc3RpY3NcbiAgICovXG4gIGdldENpcmN1aXRCcmVha2VyU3RhdHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2lyY3VpdEJyZWFrZXIuZ2V0U3RhdHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBjaXJjdWl0IGJyZWFrZXIgaXMgaGVhbHRoeVxuICAgKi9cbiAgaXNIZWFsdGh5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNpcmN1aXRCcmVha2VyLmlzSGVhbHRoeSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IGNpcmN1aXQgYnJlYWtlclxuICAgKi9cbiAgcmVzZXRDaXJjdWl0QnJlYWtlcigpOiB2b2lkIHtcbiAgICB0aGlzLmNpcmN1aXRCcmVha2VyLmZvcmNlQ2xvc2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2VydmljZSBjbGllbnQgY29uZmlndXJhdGlvblxuICAgKi9cbiAgZ2V0Q29uZmlnKCk6IFNlcnZpY2VDbGllbnRDb25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=