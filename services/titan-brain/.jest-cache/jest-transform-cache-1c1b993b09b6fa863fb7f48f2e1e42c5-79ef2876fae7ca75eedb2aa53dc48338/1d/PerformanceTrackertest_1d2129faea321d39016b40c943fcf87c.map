{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/unit/PerformanceTracker.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/unit/PerformanceTracker.test.ts"],"sourcesContent":["/**\n * Unit Tests for PerformanceTracker\n * \n * Tests specific examples, edge cases, and error conditions\n * **Validates: Requirements 2.2, 2.3, 2.4, 2.8**\n */\n\nimport { PerformanceTracker } from '../../src/engine/PerformanceTracker';\nimport { PerformanceTrackerConfig, PhaseId } from '../../src/types/index';\nimport { DatabaseManager } from '../../src/db/DatabaseManager';\n\n// Mock DatabaseManager\nconst mockDb = {\n  query: jest.fn(),\n} as unknown as DatabaseManager;\n\n// Test configuration\nconst testConfig: PerformanceTrackerConfig = {\n  windowDays: 7,\n  minTradeCount: 10,\n  malusThreshold: 0,\n  bonusThreshold: 2.0,\n  malusMultiplier: 0.5,\n  bonusMultiplier: 1.2\n};\n\ndescribe('PerformanceTracker Unit Tests', () => {\n  let tracker: PerformanceTracker;\n\n  beforeEach(() => {\n    tracker = new PerformanceTracker(testConfig, mockDb);\n    jest.clearAllMocks();\n  });\n\n  describe('Sharpe Ratio Calculation', () => {\n    /**\n     * **Validates: Requirements 2.2**\n     * Test Sharpe ratio calculation with known data\n     */\n    it('should calculate Sharpe ratio correctly with known data', () => {\n      // Test case 1: Simple positive returns\n      const positiveReturns = [100, 150, 120, 180, 110];\n      const sharpe1 = tracker.calculateSharpeRatio(positiveReturns);\n      \n      // Should be positive since all returns are positive\n      expect(sharpe1).toBeGreaterThan(0);\n      expect(isFinite(sharpe1)).toBe(true);\n\n      // Test case 2: Mixed returns with known calculation\n      const mixedReturns = [100, -50, 200, -25, 75];\n      const sharpe2 = tracker.calculateSharpeRatio(mixedReturns);\n      \n      // Manual calculation for verification\n      const mean = (100 - 50 + 200 - 25 + 75) / 5; // 60\n      const variance = (\n        Math.pow(100 - 60, 2) + \n        Math.pow(-50 - 60, 2) + \n        Math.pow(200 - 60, 2) + \n        Math.pow(-25 - 60, 2) + \n        Math.pow(75 - 60, 2)\n      ) / 4; // Sample variance (n-1)\n      const stdDev = Math.sqrt(variance);\n      const expectedSharpe = (mean / stdDev) * Math.sqrt(365);\n      \n      expect(sharpe2).toBeCloseTo(expectedSharpe, 2);\n\n      // Test case 3: All negative returns\n      const negativeReturns = [-100, -150, -120, -180, -110];\n      const sharpe3 = tracker.calculateSharpeRatio(negativeReturns);\n      \n      // Should be negative since all returns are negative\n      expect(sharpe3).toBeLessThan(0);\n    });\n\n    it('should return 0 for insufficient data', () => {\n      expect(tracker.calculateSharpeRatio([])).toBe(0);\n      expect(tracker.calculateSharpeRatio([100])).toBe(0);\n    });\n\n    it('should handle zero standard deviation correctly', () => {\n      // All same positive values\n      expect(tracker.calculateSharpeRatio([100, 100, 100])).toBe(3.0);\n      \n      // All same negative values\n      expect(tracker.calculateSharpeRatio([-100, -100, -100])).toBe(-3.0);\n      \n      // All zeros\n      expect(tracker.calculateSharpeRatio([0, 0, 0])).toBe(0);\n    });\n  });\n\n  describe('Performance Modifier Logic', () => {\n    /**\n     * **Validates: Requirements 2.3**\n     * Test malus penalty application (Sharpe < 0)\n     */\n    it('should apply malus penalty for negative Sharpe ratios', () => {\n      const testCases = [-3.0, -1.5, -0.5, -0.001];\n      \n      testCases.forEach(sharpe => {\n        const modifier = tracker.calculateModifier(sharpe);\n        expect(modifier).toBe(testConfig.malusMultiplier);\n      });\n    });\n\n    /**\n     * **Validates: Requirements 2.4**\n     * Test bonus multiplier application (Sharpe > 2.0)\n     */\n    it('should apply bonus multiplier for high Sharpe ratios', () => {\n      const testCases = [2.001, 2.5, 3.0, 5.0];\n      \n      testCases.forEach(sharpe => {\n        const modifier = tracker.calculateModifier(sharpe);\n        expect(modifier).toBe(testConfig.bonusMultiplier);\n      });\n    });\n\n    it('should return 1.0 for normal Sharpe ratios', () => {\n      const testCases = [0, 0.5, 1.0, 1.5, 2.0];\n      \n      testCases.forEach(sharpe => {\n        const modifier = tracker.calculateModifier(sharpe);\n        expect(modifier).toBe(1.0);\n      });\n    });\n\n    /**\n     * **Validates: Requirements 2.8**\n     * Test insufficient trade history handling\n     */\n    it('should use base weight for insufficient trade history', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      // Mock insufficient trade count\n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: [{ count: '5' }] // Less than minTradeCount (10)\n      });\n      \n      const modifier = await tracker.getPerformanceModifier(phaseId);\n      \n      expect(modifier).toBe(1.0);\n      expect(mockDb.query).toHaveBeenCalledWith(\n        expect.stringContaining('COUNT(*)'),\n        expect.arrayContaining([phaseId])\n      );\n    });\n\n    it('should calculate modifier when sufficient trade history exists', async () => {\n      const phaseId: PhaseId = 'phase2';\n      \n      // Mock sufficient trade count\n      (mockDb.query as jest.Mock)\n        .mockResolvedValueOnce({\n          rows: [{ count: '15' }] // More than minTradeCount (10)\n        })\n        .mockResolvedValueOnce({\n          rows: [\n            { pnl: '100' },\n            { pnl: '150' },\n            { pnl: '-50' },\n            { pnl: '200' },\n            { pnl: '75' }\n          ]\n        });\n      \n      const modifier = await tracker.getPerformanceModifier(phaseId);\n      \n      expect(modifier).toBeGreaterThan(0);\n      expect(modifier).toBeLessThanOrEqual(testConfig.bonusMultiplier);\n      expect(mockDb.query).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('Database Integration', () => {\n    it('should record trade with all parameters', async () => {\n      const phaseId: PhaseId = 'phase1';\n      const pnl = 150.75;\n      const timestamp = Date.now();\n      const symbol = 'BTCUSDT';\n      const side = 'BUY';\n      \n      await tracker.recordTrade(phaseId, pnl, timestamp, symbol, side);\n      \n      expect(mockDb.query).toHaveBeenCalledWith(\n        expect.stringContaining('INSERT INTO phase_trades'),\n        [phaseId, timestamp, pnl, symbol, side]\n      );\n    });\n\n    it('should record trade with minimal parameters', async () => {\n      const phaseId: PhaseId = 'phase2';\n      const pnl = -75.25;\n      const timestamp = Date.now();\n      \n      await tracker.recordTrade(phaseId, pnl, timestamp);\n      \n      expect(mockDb.query).toHaveBeenCalledWith(\n        expect.stringContaining('INSERT INTO phase_trades'),\n        [phaseId, timestamp, pnl, null, null]\n      );\n    });\n\n    it('should throw error when database not configured', async () => {\n      const trackerWithoutDb = new PerformanceTracker(testConfig);\n      \n      await expect(\n        trackerWithoutDb.recordTrade('phase1', 100, Date.now())\n      ).rejects.toThrow('Database not configured');\n    });\n\n    it('should get trades in window correctly', async () => {\n      const phaseId: PhaseId = 'phase3';\n      const windowDays = 7;\n      \n      const mockTrades = [\n        {\n          id: 1,\n          phase_id: 'phase3',\n          pnl: '100.50',\n          timestamp: '1640995200000',\n          symbol: 'BTCUSDT',\n          side: 'BUY'\n        },\n        {\n          id: 2,\n          phase_id: 'phase3',\n          pnl: '-75.25',\n          timestamp: '1641081600000',\n          symbol: 'ETHUSDT',\n          side: 'SELL'\n        }\n      ];\n      \n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: mockTrades\n      });\n      \n      const trades = await tracker.getTradesInWindow(phaseId, windowDays);\n      \n      expect(trades).toHaveLength(2);\n      expect(trades[0]).toEqual({\n        id: 1,\n        phaseId: 'phase3',\n        pnl: 100.50,\n        timestamp: 1640995200000,\n        symbol: 'BTCUSDT',\n        side: 'BUY'\n      });\n      expect(trades[1]).toEqual({\n        id: 2,\n        phaseId: 'phase3',\n        pnl: -75.25,\n        timestamp: 1641081600000,\n        symbol: 'ETHUSDT',\n        side: 'SELL'\n      });\n      \n      // Verify query parameters\n      const queryCall = (mockDb.query as jest.Mock).mock.calls[0];\n      expect(queryCall[1][0]).toBe(phaseId);\n      expect(queryCall[1][1]).toBeGreaterThan(0); // Window start timestamp\n    });\n\n    it('should return empty array when database not configured', async () => {\n      const trackerWithoutDb = new PerformanceTracker(testConfig);\n      \n      const trades = await trackerWithoutDb.getTradesInWindow('phase1', 7);\n      expect(trades).toEqual([]);\n    });\n  });\n\n  describe('Phase Performance Metrics', () => {\n    it('should calculate comprehensive phase performance', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      // Mock trades data\n      const mockTrades = [\n        { pnl: '100' },\n        { pnl: '150' },\n        { pnl: '-50' },\n        { pnl: '200' },\n        { pnl: '-25' },\n        { pnl: '75' }\n      ];\n      \n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: mockTrades\n      });\n      \n      const performance = await tracker.getPhasePerformance(phaseId);\n      \n      expect(performance.phaseId).toBe(phaseId);\n      expect(performance.totalPnL).toBe(450); // Sum of all PnL\n      expect(performance.tradeCount).toBe(6);\n      expect(performance.winRate).toBeCloseTo(0.667, 2); // 4 wins out of 6\n      expect(performance.avgWin).toBeCloseTo(131.25, 2); // (100+150+200+75)/4\n      expect(performance.avgLoss).toBeCloseTo(37.5, 2); // (50+25)/2\n      expect(performance.sharpeRatio).toBeGreaterThan(0);\n      expect(performance.modifier).toBeGreaterThan(0);\n    });\n\n    it('should handle empty trade history', async () => {\n      const phaseId: PhaseId = 'phase2';\n      \n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: []\n      });\n      \n      const performance = await tracker.getPhasePerformance(phaseId);\n      \n      expect(performance.phaseId).toBe(phaseId);\n      expect(performance.totalPnL).toBe(0);\n      expect(performance.tradeCount).toBe(0);\n      expect(performance.winRate).toBe(0);\n      expect(performance.avgWin).toBe(0);\n      expect(performance.avgLoss).toBe(0);\n      expect(performance.sharpeRatio).toBe(0);\n      expect(performance.modifier).toBe(1.0);\n    });\n\n    it('should get all phase performance', async () => {\n      // Mock responses for all three phases\n      (mockDb.query as jest.Mock)\n        .mockResolvedValueOnce({ rows: [{ pnl: '100' }] }) // phase1\n        .mockResolvedValueOnce({ rows: [{ pnl: '200' }] }) // phase2\n        .mockResolvedValueOnce({ rows: [{ pnl: '-50' }] }); // phase3\n      \n      const allPerformance = await tracker.getAllPhasePerformance();\n      \n      expect(allPerformance).toHaveLength(3);\n      expect(allPerformance[0].phaseId).toBe('phase1');\n      expect(allPerformance[1].phaseId).toBe('phase2');\n      expect(allPerformance[2].phaseId).toBe('phase3');\n    });\n  });\n\n  describe('Performance Snapshot Persistence', () => {\n    it('should persist performance snapshot to database', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      // Mock trade data for performance calculation\n      (mockDb.query as jest.Mock)\n        .mockResolvedValueOnce({\n          rows: [\n            { pnl: '100' },\n            { pnl: '150' },\n            { pnl: '-50' }\n          ]\n        })\n        .mockResolvedValueOnce({}); // Insert response\n      \n      await tracker.persistPerformanceSnapshot(phaseId);\n      \n      expect(mockDb.query).toHaveBeenCalledTimes(2);\n      \n      // Verify the insert call\n      const insertCall = (mockDb.query as jest.Mock).mock.calls[1];\n      expect(insertCall[0]).toContain('INSERT INTO phase_performance');\n      expect(insertCall[1][0]).toBe(phaseId);\n      expect(insertCall[1][1]).toBeGreaterThan(0); // timestamp\n      expect(insertCall[1][2]).toBe(200); // totalPnL\n      expect(insertCall[1][3]).toBe(3); // tradeCount\n      expect(typeof insertCall[1][4]).toBe('number'); // sharpeRatio\n      expect(typeof insertCall[1][5]).toBe('number'); // modifier\n    });\n\n    it('should throw error when database not configured for persistence', async () => {\n      const trackerWithoutDb = new PerformanceTracker(testConfig);\n      \n      await expect(\n        trackerWithoutDb.persistPerformanceSnapshot('phase1')\n      ).rejects.toThrow('Database not configured');\n    });\n  });\n\n  describe('Configuration Management', () => {\n    it('should return configuration copy', () => {\n      const config = tracker.getConfig();\n      \n      expect(config).toEqual(testConfig);\n      expect(config).not.toBe(testConfig); // Should be a copy\n    });\n\n    it('should use custom configuration correctly', () => {\n      const customConfig: PerformanceTrackerConfig = {\n        windowDays: 14,\n        minTradeCount: 20,\n        malusThreshold: -0.5,\n        bonusThreshold: 1.5,\n        malusMultiplier: 0.3,\n        bonusMultiplier: 1.5\n      };\n      \n      const customTracker = new PerformanceTracker(customConfig);\n      \n      // Test that custom thresholds are used\n      expect(customTracker.calculateModifier(-0.6)).toBe(0.3);\n      expect(customTracker.calculateModifier(-0.4)).toBe(1.0);\n      expect(customTracker.calculateModifier(1.4)).toBe(1.0);\n      expect(customTracker.calculateModifier(1.6)).toBe(1.5);\n      \n      expect(customTracker.getConfig()).toEqual(customConfig);\n    });\n  });\n\n  describe('Edge Cases and Error Handling', () => {\n    it('should handle extreme PnL values', () => {\n      const extremeValues = [\n        1000000,  // Very large profit\n        -1000000, // Very large loss\n        0.01,     // Very small profit\n        -0.01,    // Very small loss\n        0         // Zero PnL\n      ];\n      \n      const sharpe = tracker.calculateSharpeRatio(extremeValues);\n      expect(isFinite(sharpe)).toBe(true);\n    });\n\n    it('should handle very small standard deviations', () => {\n      // Values very close to each other\n      const closeValues = [100.001, 100.002, 100.003, 100.004];\n      const sharpe = tracker.calculateSharpeRatio(closeValues);\n      \n      expect(isFinite(sharpe)).toBe(true);\n      expect(sharpe).toBeGreaterThan(0); // Should be positive\n    });\n\n    it('should handle database query errors gracefully', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      // Mock database error\n      (mockDb.query as jest.Mock).mockRejectedValueOnce(\n        new Error('Database connection failed')\n      );\n      \n      await expect(\n        tracker.getTradeCount(phaseId, 7)\n      ).rejects.toThrow('Database connection failed');\n    });\n\n    it('should handle malformed database responses', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      // Mock malformed response\n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: [{ count: null }] // Null count\n      });\n      \n      const count = await tracker.getTradeCount(phaseId, 7);\n      expect(count).toBe(0); // Should default to 0\n    });\n  });\n\n  describe('Time Window Calculations', () => {\n    it('should calculate correct time window for queries', async () => {\n      const phaseId: PhaseId = 'phase1';\n      const windowDays = 7;\n      const currentTime = Date.now();\n      \n      // Mock Date.now to control time\n      const originalNow = Date.now;\n      Date.now = jest.fn(() => currentTime);\n      \n      try {\n        (mockDb.query as jest.Mock).mockResolvedValueOnce({\n          rows: [{ count: '5' }]\n        });\n        \n        await tracker.getTradeCount(phaseId, windowDays);\n        \n        const queryCall = (mockDb.query as jest.Mock).mock.calls[0];\n        const expectedWindowStart = currentTime - windowDays * 24 * 60 * 60 * 1000;\n        \n        expect(queryCall[1][1]).toBe(expectedWindowStart);\n      } finally {\n        Date.now = originalNow;\n      }\n    });\n\n    it('should use default window days from config', async () => {\n      const phaseId: PhaseId = 'phase1';\n      \n      (mockDb.query as jest.Mock).mockResolvedValueOnce({\n        rows: []\n      });\n      \n      await tracker.getSharpeRatio(phaseId); // No windowDays parameter\n      \n      // Should use config.windowDays (7)\n      const queryCall = (mockDb.query as jest.Mock).mock.calls[0];\n      expect(queryCall[0]).toContain('timestamp >= $2');\n    });\n  });\n});"],"version":3}