{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/src/health/HealthManager.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/src/health/HealthManager.ts"],"sourcesContent":["/**\n * HealthManager - Comprehensive health monitoring for Titan Brain\n * \n * Provides reliable health status for Railway monitoring and internal diagnostics.\n * Implements component-based health checks with proper error handling.\n * \n * Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8\n */\n\nimport { TitanBrain } from '../engine/TitanBrain.js';\nimport { HealthStatus } from '../types/brain.js';\nimport { DatabaseManager } from '../database/DatabaseManager.js';\nimport { CacheManager } from '../cache/CacheManager.js';\n\n/**\n * Health status for individual components (internal use)\n */\nexport interface ComponentHealth {\n  healthy: boolean;\n  message?: string;\n  lastCheck: number;\n  responseTime?: number;\n  error?: string;\n}\n\n/**\n * Enhanced health status for Railway (extends the basic interface)\n */\nexport interface EnhancedHealthStatus {\n  status: 'healthy' | 'unhealthy' | 'starting';\n  code: 200 | 503;\n  timestamp: string;\n  uptime: number;\n  components: Record<string, ComponentHealth>;\n  errors?: string[];\n  metadata?: {\n    version?: string;\n    environment?: string;\n    nodeVersion?: string;\n    memoryUsage?: NodeJS.MemoryUsage;\n  };\n}\n\n/**\n * Health check component interface\n */\nexport interface HealthComponent {\n  name: string;\n  check(): Promise<ComponentHealth>;\n  timeout: number;\n  required: boolean;\n}\n\n/**\n * Enhanced database health component using DatabaseManager\n */\nexport class DatabaseHealthComponent implements HealthComponent {\n  name = 'database';\n  timeout = 3000; // 3 seconds\n  required = true;\n\n  constructor(private databaseManager: DatabaseManager) {}\n\n  async check(): Promise<ComponentHealth> {\n    const startTime = Date.now();\n    \n    try {\n      // Use DatabaseManager's health check\n      const isHealthy = this.databaseManager.isHealthy();\n      const metrics = this.databaseManager.getMetrics();\n      const responseTime = Date.now() - startTime;\n      \n      if (isHealthy) {\n        return {\n          healthy: true,\n          message: `Database connection active (${metrics.totalConnections} connections, ${metrics.averageQueryTime.toFixed(1)}ms avg query time)`,\n          lastCheck: Date.now(),\n          responseTime\n        };\n      } else {\n        return {\n          healthy: false,\n          message: 'Database connection failed',\n          lastCheck: Date.now(),\n          responseTime,\n          error: `Database unhealthy: ${metrics.connectionErrors} connection errors`\n        };\n      }\n    } catch (error) {\n      const responseTime = Date.now() - startTime;\n      return {\n        healthy: false,\n        message: 'Database health check failed',\n        lastCheck: Date.now(),\n        responseTime,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n}\n\n/**\n * Enhanced Redis health component using CacheManager\n */\nexport class RedisHealthComponent implements HealthComponent {\n  name = 'redis';\n  timeout = 2000; // 2 seconds\n  required = false; // Redis is optional\n\n  constructor(private cacheManager: CacheManager) {}\n\n  async check(): Promise<ComponentHealth> {\n    const startTime = Date.now();\n    \n    try {\n      // Use CacheManager's health check\n      const isHealthy = this.cacheManager.isHealthy();\n      const status = this.cacheManager.getStatus();\n      const responseTime = Date.now() - startTime;\n      \n      if (isHealthy) {\n        const message = status.redisConnected \n          ? `Redis connection active (${status.hitRate.toFixed(1)}% hit rate, ${status.averageResponseTime.toFixed(1)}ms avg response)`\n          : `In-memory cache active (${status.hitRate.toFixed(1)}% hit rate, ${status.averageResponseTime.toFixed(1)}ms avg response)`;\n        \n        return {\n          healthy: true,\n          message,\n          lastCheck: Date.now(),\n          responseTime\n        };\n      } else {\n        return {\n          healthy: false,\n          message: 'Cache system unavailable',\n          lastCheck: Date.now(),\n          responseTime,\n          error: 'Both Redis and in-memory cache failed'\n        };\n      }\n    } catch (error) {\n      const responseTime = Date.now() - startTime;\n      return {\n        healthy: false,\n        message: 'Cache health check failed',\n        lastCheck: Date.now(),\n        responseTime,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n}\n\n/**\n * Configuration health component\n */\nexport class ConfigHealthComponent implements HealthComponent {\n  name = 'configuration';\n  timeout = 1000; // 1 second\n  required = true;\n\n  async check(): Promise<ComponentHealth> {\n    const startTime = Date.now();\n    \n    try {\n      // Check critical environment variables\n      const requiredVars = [\n        'NODE_ENV',\n        'SERVER_PORT',\n        'DB_HOST',\n        'DB_NAME',\n        'DB_USER',\n        'DB_PASSWORD'\n      ];\n      \n      const missingVars = requiredVars.filter(varName => !process.env[varName]);\n      const responseTime = Date.now() - startTime;\n      \n      if (missingVars.length > 0) {\n        return {\n          healthy: false,\n          message: `Missing required environment variables: ${missingVars.join(', ')}`,\n          lastCheck: Date.now(),\n          responseTime,\n          error: `Configuration incomplete: ${missingVars.length} missing variables`\n        };\n      }\n      \n      return {\n        healthy: true,\n        message: 'Configuration valid',\n        lastCheck: Date.now(),\n        responseTime\n      };\n    } catch (error) {\n      const responseTime = Date.now() - startTime;\n      return {\n        healthy: false,\n        message: 'Configuration check failed',\n        lastCheck: Date.now(),\n        responseTime,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n}\n\n/**\n * Memory health component\n */\nexport class MemoryHealthComponent implements HealthComponent {\n  name = 'memory';\n  timeout = 500; // 500ms\n  required = false;\n\n  async check(): Promise<ComponentHealth> {\n    const startTime = Date.now();\n    \n    try {\n      const memUsage = process.memoryUsage();\n      const responseTime = Date.now() - startTime;\n      \n      // Convert to MB for easier reading\n      const heapUsedMB = Math.round(memUsage.heapUsed / 1024 / 1024);\n      const heapTotalMB = Math.round(memUsage.heapTotal / 1024 / 1024);\n      const rssMB = Math.round(memUsage.rss / 1024 / 1024);\n      \n      // Check if memory usage is concerning (>80% of heap)\n      const heapUsagePercent = (memUsage.heapUsed / memUsage.heapTotal) * 100;\n      const isHealthy = heapUsagePercent < 80;\n      \n      return {\n        healthy: isHealthy,\n        message: `Memory usage: ${heapUsedMB}MB/${heapTotalMB}MB heap, ${rssMB}MB RSS (${heapUsagePercent.toFixed(1)}%)`,\n        lastCheck: Date.now(),\n        responseTime,\n        error: isHealthy ? undefined : 'High memory usage detected'\n      };\n    } catch (error) {\n      const responseTime = Date.now() - startTime;\n      return {\n        healthy: false,\n        message: 'Memory check failed',\n        lastCheck: Date.now(),\n        responseTime,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n}\n\n/**\n * HealthManager orchestrates all health checks\n */\nexport class HealthManager {\n  private components: Map<string, HealthComponent> = new Map();\n  private startupComplete: boolean = false;\n  private startTime: number = Date.now();\n\n  constructor(\n    databaseManager?: DatabaseManager,\n    cacheManager?: CacheManager\n  ) {\n    // Register health components based on available managers\n    if (databaseManager) {\n      this.registerComponent(new DatabaseHealthComponent(databaseManager));\n    }\n    \n    if (cacheManager) {\n      this.registerComponent(new RedisHealthComponent(cacheManager));\n    }\n    \n    // Always register configuration and memory components\n    this.registerComponent(new ConfigHealthComponent());\n    this.registerComponent(new MemoryHealthComponent());\n  }\n\n  /**\n   * Register a health component\n   */\n  registerComponent(component: HealthComponent): void {\n    this.components.set(component.name, component);\n  }\n\n  /**\n   * Mark startup as complete\n   */\n  markStartupComplete(): void {\n    this.startupComplete = true;\n  }\n\n  /**\n   * Check if startup is complete\n   */\n  isStartupComplete(): boolean {\n    return this.startupComplete;\n  }\n\n  /**\n   * Perform comprehensive health check\n   */\n  async checkHealth(): Promise<EnhancedHealthStatus> {\n    // If startup is not complete, return unhealthy status\n    if (!this.startupComplete) {\n      return {\n        status: 'starting',\n        code: 503,\n        timestamp: new Date().toISOString(),\n        uptime: Date.now() - this.startTime,\n        components: {},\n        errors: ['Service is starting up']\n      };\n    }\n\n    const componentResults: Record<string, ComponentHealth> = {};\n    const errors: string[] = [];\n    let hasRequiredFailure = false;\n\n    // Run all health checks with timeout protection\n    const healthCheckPromises = Array.from(this.components.entries()).map(\n      async ([name, component]) => {\n        try {\n          const result = await this.executeWithTimeout(\n            component.check(),\n            component.timeout\n          );\n          componentResults[name] = result;\n          \n          // Track failures for required components\n          if (!result.healthy && component.required) {\n            hasRequiredFailure = true;\n            errors.push(`${name}: ${result.error || result.message || 'Unknown error'}`);\n          }\n        } catch (error) {\n          const failedResult: ComponentHealth = {\n            healthy: false,\n            message: 'Health check timeout or error',\n            lastCheck: Date.now(),\n            error: error instanceof Error ? error.message : 'Unknown error'\n          };\n          \n          componentResults[name] = failedResult;\n          \n          if (component.required) {\n            hasRequiredFailure = true;\n            errors.push(`${name}: ${failedResult.error}`);\n          }\n        }\n      }\n    );\n\n    // Wait for all health checks to complete\n    await Promise.allSettled(healthCheckPromises);\n\n    // Determine overall health status\n    const isHealthy = !hasRequiredFailure;\n    const status: EnhancedHealthStatus = {\n      status: isHealthy ? 'healthy' : 'unhealthy',\n      code: isHealthy ? 200 : 503,\n      timestamp: new Date().toISOString(),\n      uptime: Date.now() - this.startTime,\n      components: componentResults,\n      errors: errors.length > 0 ? errors : undefined,\n      metadata: {\n        version: process.env.npm_package_version || 'unknown',\n        environment: process.env.NODE_ENV || 'unknown',\n        nodeVersion: process.version,\n        memoryUsage: process.memoryUsage()\n      }\n    };\n\n    return status;\n  }\n\n  /**\n   * Execute a promise with timeout\n   */\n  private async executeWithTimeout<T>(\n    promise: Promise<T>,\n    timeoutMs: number\n  ): Promise<T> {\n    return Promise.race([\n      promise,\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(`Timeout after ${timeoutMs}ms`)), timeoutMs)\n      )\n    ]);\n  }\n\n  /**\n   * Get a quick health status (for high-frequency checks)\n   */\n  async getQuickHealth(): Promise<{ healthy: boolean; message: string }> {\n    if (!this.startupComplete) {\n      return { healthy: false, message: 'Starting up' };\n    }\n\n    try {\n      // Only check critical components quickly\n      const configComponent = this.components.get('configuration');\n      if (configComponent) {\n        const configHealth = await this.executeWithTimeout(\n          configComponent.check(),\n          1000\n        );\n        \n        if (!configHealth.healthy) {\n          return { healthy: false, message: 'Configuration error' };\n        }\n      }\n\n      return { healthy: true, message: 'Service operational' };\n    } catch (error) {\n      return { \n        healthy: false, \n        message: error instanceof Error ? error.message : 'Health check failed' \n      };\n    }\n  }\n}"],"version":3}