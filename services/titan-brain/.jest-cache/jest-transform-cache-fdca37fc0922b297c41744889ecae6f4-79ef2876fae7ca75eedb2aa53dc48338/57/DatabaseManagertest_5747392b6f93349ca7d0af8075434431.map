{"file":"/Users/ivan/Code/trading/titan/services/titan-brain/tests/database/DatabaseManager.test.ts","mappings":"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","names":[],"sources":["/Users/ivan/Code/trading/titan/services/titan-brain/tests/database/DatabaseManager.test.ts"],"sourcesContent":["/**\n * Unit tests for DatabaseManager\n */\n\nimport { DatabaseManager, DatabaseConfig } from '../../src/database/DatabaseManager';\n\n// Mock pg module\njest.mock('pg', () => {\n  const mockClient = {\n    query: jest.fn(),\n    release: jest.fn()\n  };\n  \n  const mockPool = {\n    connect: jest.fn().mockResolvedValue(mockClient),\n    query: jest.fn(),\n    end: jest.fn(),\n    on: jest.fn(),\n    totalCount: 5,\n    idleCount: 3,\n    waitingCount: 0\n  };\n  \n  return {\n    Pool: jest.fn().mockImplementation(() => mockPool)\n  };\n});\n\ndescribe('DatabaseManager', () => {\n  let mockPool: any;\n  let mockClient: any;\n\n  const testConfig: DatabaseConfig = {\n    host: 'localhost',\n    port: 5432,\n    database: 'test_db',\n    user: 'test_user',\n    password: 'test_password',\n    ssl: false,\n    min: 2,\n    max: 10,\n    idleTimeoutMillis: 30000,\n    connectionTimeoutMillis: 10000,\n    acquireTimeoutMillis: 5000,\n    healthCheckIntervalMs: 30000,\n    healthCheckTimeoutMs: 5000,\n    maxReconnectAttempts: 5,\n    reconnectDelayMs: 5000\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Get references to the mocked objects\n    const { Pool } = require('pg');\n    mockPool = new Pool();\n    mockClient = mockPool.connect.mockReturnValue;\n    \n    // Ensure mockClient has the expected methods\n    if (!mockClient) {\n      mockClient = {\n        query: jest.fn(),\n        release: jest.fn()\n      };\n      mockPool.connect.mockResolvedValue(mockClient);\n    }\n    \n    mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });\n  });\n\n  describe('createConfigFromEnv', () => {\n    const originalEnv = process.env;\n\n    beforeEach(() => {\n      process.env = { ...originalEnv };\n    });\n\n    afterEach(() => {\n      process.env = originalEnv;\n    });\n\n    it('should create config from DATABASE_URL', () => {\n      process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';\n      \n      const config = DatabaseManager.createConfigFromEnv();\n      \n      expect(config.host).toBe('host');\n      expect(config.port).toBe(5433);\n      expect(config.database).toBe('dbname');\n      expect(config.user).toBe('user');\n      expect(config.password).toBe('pass');\n      expect(config.ssl).toBe(true);\n    });\n\n    it('should create config from individual environment variables', () => {\n      process.env.DB_HOST = 'test-host';\n      process.env.DB_PORT = '5433';\n      process.env.DB_NAME = 'test-db';\n      process.env.DB_USER = 'test-user';\n      process.env.DB_PASSWORD = 'test-pass';\n      process.env.DB_SSL = 'true';\n      \n      const config = DatabaseManager.createConfigFromEnv();\n      \n      expect(config.host).toBe('test-host');\n      expect(config.port).toBe(5433);\n      expect(config.database).toBe('test-db');\n      expect(config.user).toBe('test-user');\n      expect(config.password).toBe('test-pass');\n      expect(config.ssl).toBe(true);\n    });\n\n    it('should use default values when environment variables are missing', () => {\n      const config = DatabaseManager.createConfigFromEnv();\n      \n      expect(config.host).toBe('localhost');\n      expect(config.port).toBe(5432);\n      expect(config.database).toBe('titan_brain');\n      expect(config.user).toBe('postgres');\n      expect(config.min).toBe(2);\n      expect(config.max).toBe(10);\n    });\n  });\n\n  describe('initialize', () => {\n    it('should initialize successfully with valid configuration', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      \n      await databaseManager.initialize();\n      \n      expect(mockPool.connect).toHaveBeenCalled();\n      expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');\n      expect(mockClient.release).toHaveBeenCalled();\n      \n      await databaseManager.shutdown();\n    });\n\n    it('should throw error if already initialized', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      \n      await databaseManager.initialize();\n      \n      await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');\n      \n      await databaseManager.shutdown();\n    });\n\n    it('should handle connection test failure', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockRejectedValue(new Error('Connection failed'));\n      \n      await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');\n    });\n  });\n\n  describe('query', () => {\n    let databaseManager: DatabaseManager;\n    \n    beforeEach(async () => {\n      databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n    });\n\n    afterEach(async () => {\n      if (databaseManager) {\n        await databaseManager.shutdown();\n      }\n    });\n\n    it('should execute query successfully', async () => {\n      const mockResult = {\n        rows: [{ id: 1, name: 'test' }],\n        rowCount: 1,\n        command: 'SELECT'\n      };\n      mockPool.query.mockResolvedValue(mockResult);\n      \n      const result = await databaseManager.query('SELECT * FROM test');\n      \n      expect(result.rows).toEqual(mockResult.rows);\n      expect(result.rowCount).toBe(1);\n      expect(result.command).toBe('SELECT');\n      expect(result.duration).toBeGreaterThan(0);\n    });\n\n    it('should handle query parameters', async () => {\n      const mockResult = {\n        rows: [{ id: 1 }],\n        rowCount: 1,\n        command: 'SELECT'\n      };\n      mockPool.query.mockResolvedValue(mockResult);\n      \n      await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);\n      \n      expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);\n    });\n\n    it('should throw error when database is not healthy', async () => {\n      // Simulate unhealthy database\n      const metrics = databaseManager.getMetrics();\n      (metrics as any).isHealthy = false;\n      \n      await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');\n    });\n\n    it('should handle query errors', async () => {\n      mockPool.query.mockRejectedValue(new Error('Query failed'));\n      \n      await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');\n      \n      const metrics = databaseManager.getMetrics();\n      expect(metrics.failedQueries).toBe(1);\n    });\n  });\n\n  describe('transaction', () => {\n    let databaseManager: DatabaseManager;\n    \n    beforeEach(async () => {\n      databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n    });\n\n    afterEach(async () => {\n      if (databaseManager) {\n        await databaseManager.shutdown();\n      }\n    });\n\n    it('should execute transaction successfully', async () => {\n      const callback = jest.fn().mockResolvedValue('success');\n      \n      const result = await databaseManager.transaction(callback);\n      \n      expect(mockClient.query).toHaveBeenCalledWith('BEGIN');\n      expect(callback).toHaveBeenCalledWith(mockClient);\n      expect(mockClient.query).toHaveBeenCalledWith('COMMIT');\n      expect(result).toBe('success');\n    });\n\n    it('should rollback transaction on error', async () => {\n      const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));\n      \n      await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');\n      \n      expect(mockClient.query).toHaveBeenCalledWith('BEGIN');\n      expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');\n    });\n  });\n\n  describe('health monitoring', () => {\n    let databaseManager: DatabaseManager;\n    \n    beforeEach(async () => {\n      databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n    });\n\n    afterEach(async () => {\n      if (databaseManager) {\n        await databaseManager.shutdown();\n      }\n    });\n\n    it('should report healthy status when database is working', () => {\n      expect(databaseManager.isHealthy()).toBe(true);\n    });\n\n    it('should provide connection pool status', () => {\n      const status = databaseManager.getPoolStatus();\n      \n      expect(status.totalConnections).toBe(5);\n      expect(status.idleConnections).toBe(3);\n      expect(status.waitingClients).toBe(0);\n    });\n\n    it('should provide database metrics', () => {\n      const metrics = databaseManager.getMetrics();\n      \n      expect(metrics.totalConnections).toBe(5);\n      expect(metrics.idleConnections).toBe(3);\n      expect(metrics.waitingClients).toBe(0);\n      expect(metrics.isHealthy).toBe(true);\n    });\n  });\n\n  describe('shutdown', () => {\n    it('should shutdown gracefully', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n      \n      await databaseManager.shutdown();\n      \n      expect(mockPool.end).toHaveBeenCalled();\n    });\n\n    it('should handle shutdown when not initialized', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      await expect(databaseManager.shutdown()).resolves.not.toThrow();\n    });\n  });\n\n  describe('event emission', () => {\n    it('should emit initialized event', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      const initSpy = jest.fn();\n      databaseManager.on('initialized', initSpy);\n      \n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n      \n      expect(initSpy).toHaveBeenCalled();\n      \n      await databaseManager.shutdown();\n    });\n\n    it('should emit query success event', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      const querySpy = jest.fn();\n      databaseManager.on('query:success', querySpy);\n      \n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n      \n      const mockResult = {\n        rows: [{ id: 1 }],\n        rowCount: 1,\n        command: 'SELECT'\n      };\n      mockPool.query.mockResolvedValue(mockResult);\n      \n      await databaseManager.query('SELECT * FROM test');\n      \n      expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({\n        query: 'SELECT * FROM test',\n        duration: expect.any(Number)\n      }));\n      \n      await databaseManager.shutdown();\n    });\n\n    it('should emit query failure event', async () => {\n      const databaseManager = new DatabaseManager(testConfig);\n      const queryFailSpy = jest.fn();\n      databaseManager.on('query:failure', queryFailSpy);\n      \n      mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });\n      await databaseManager.initialize();\n      \n      mockPool.query.mockRejectedValue(new Error('Query failed'));\n      \n      await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();\n      \n      expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({\n        query: 'SELECT * FROM test',\n        error: expect.any(Error)\n      }));\n      \n      await databaseManager.shutdown();\n    });\n  });\n});"],"version":3}