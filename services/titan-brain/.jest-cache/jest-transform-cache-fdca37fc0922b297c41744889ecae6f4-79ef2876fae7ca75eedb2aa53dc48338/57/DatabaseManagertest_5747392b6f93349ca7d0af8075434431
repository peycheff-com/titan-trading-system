d8ae3fb998788e6625716192193d652b
"use strict";
/**
 * Unit tests for DatabaseManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock pg module
jest.mock('pg', () => {
    const mockClient = {
        query: jest.fn(),
        release: jest.fn()
    };
    const mockPool = {
        connect: jest.fn().mockResolvedValue(mockClient),
        query: jest.fn(),
        end: jest.fn(),
        on: jest.fn(),
        totalCount: 5,
        idleCount: 3,
        waitingCount: 0
    };
    return {
        Pool: jest.fn().mockImplementation(() => mockPool)
    };
});
const DatabaseManager_1 = require("../../src/database/DatabaseManager");
describe('DatabaseManager', () => {
    let mockPool;
    let mockClient;
    const testConfig = {
        host: 'localhost',
        port: 5432,
        database: 'test_db',
        user: 'test_user',
        password: 'test_password',
        ssl: false,
        min: 2,
        max: 10,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
        acquireTimeoutMillis: 5000,
        healthCheckIntervalMs: 30000,
        healthCheckTimeoutMs: 5000,
        maxReconnectAttempts: 5,
        reconnectDelayMs: 5000
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Get references to the mocked objects
        const { Pool } = require('pg');
        mockPool = new Pool();
        mockClient = mockPool.connect.mockReturnValue;
        // Ensure mockClient has the expected methods
        if (!mockClient) {
            mockClient = {
                query: jest.fn(),
                release: jest.fn()
            };
            mockPool.connect.mockResolvedValue(mockClient);
        }
        mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });
    });
    describe('createConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create config from DATABASE_URL', () => {
            process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('dbname');
            expect(config.user).toBe('user');
            expect(config.password).toBe('pass');
            expect(config.ssl).toBe(true);
        });
        it('should create config from individual environment variables', () => {
            process.env.DB_HOST = 'test-host';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'test-db';
            process.env.DB_USER = 'test-user';
            process.env.DB_PASSWORD = 'test-pass';
            process.env.DB_SSL = 'true';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('test-host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('test-db');
            expect(config.user).toBe('test-user');
            expect(config.password).toBe('test-pass');
            expect(config.ssl).toBe(true);
        });
        it('should use default values when environment variables are missing', () => {
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('localhost');
            expect(config.port).toBe(5432);
            expect(config.database).toBe('titan_brain');
            expect(config.user).toBe('postgres');
            expect(config.min).toBe(2);
            expect(config.max).toBe(10);
        });
    });
    describe('initialize', () => {
        it('should initialize successfully with valid configuration', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(mockPool.connect).toHaveBeenCalled();
            expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');
            expect(mockClient.release).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should throw error if already initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');
            await databaseManager.shutdown();
        });
        it('should handle connection test failure', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockRejectedValue(new Error('Connection failed'));
            await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');
        });
    });
    describe('query', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute query successfully', async () => {
            const mockResult = {
                rows: [{ id: 1, name: 'test' }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            const result = await databaseManager.query('SELECT * FROM test');
            expect(result.rows).toEqual(mockResult.rows);
            expect(result.rowCount).toBe(1);
            expect(result.command).toBe('SELECT');
            expect(result.duration).toBeGreaterThan(0);
        });
        it('should handle query parameters', async () => {
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);
            expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);
        });
        it('should throw error when database is not healthy', async () => {
            // Simulate unhealthy database
            const metrics = databaseManager.getMetrics();
            metrics.isHealthy = false;
            await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');
        });
        it('should handle query errors', async () => {
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');
            const metrics = databaseManager.getMetrics();
            expect(metrics.failedQueries).toBe(1);
        });
    });
    describe('transaction', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute transaction successfully', async () => {
            const callback = jest.fn().mockResolvedValue('success');
            const result = await databaseManager.transaction(callback);
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(callback).toHaveBeenCalledWith(mockClient);
            expect(mockClient.query).toHaveBeenCalledWith('COMMIT');
            expect(result).toBe('success');
        });
        it('should rollback transaction on error', async () => {
            const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));
            await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');
        });
    });
    describe('health monitoring', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should report healthy status when database is working', () => {
            expect(databaseManager.isHealthy()).toBe(true);
        });
        it('should provide connection pool status', () => {
            const status = databaseManager.getPoolStatus();
            expect(status.totalConnections).toBe(5);
            expect(status.idleConnections).toBe(3);
            expect(status.waitingClients).toBe(0);
        });
        it('should provide database metrics', () => {
            const metrics = databaseManager.getMetrics();
            expect(metrics.totalConnections).toBe(5);
            expect(metrics.idleConnections).toBe(3);
            expect(metrics.waitingClients).toBe(0);
            expect(metrics.isHealthy).toBe(true);
        });
    });
    describe('shutdown', () => {
        it('should shutdown gracefully', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await databaseManager.shutdown();
            expect(mockPool.end).toHaveBeenCalled();
        });
        it('should handle shutdown when not initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            await expect(databaseManager.shutdown()).resolves.not.toThrow();
        });
    });
    describe('event emission', () => {
        it('should emit initialized event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const initSpy = jest.fn();
            databaseManager.on('initialized', initSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(initSpy).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should emit query success event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const querySpy = jest.fn();
            databaseManager.on('query:success', querySpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test');
            expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                duration: expect.any(Number)
            }));
            await databaseManager.shutdown();
        });
        it('should emit query failure event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const queryFailSpy = jest.fn();
            databaseManager.on('query:failure', queryFailSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();
            expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                error: expect.any(Error)
            }));
            await databaseManager.shutdown();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCxpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFO0lBQ25CLE1BQU0sVUFBVSxHQUFHO1FBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ25CLENBQUM7SUFFRixNQUFNLFFBQVEsR0FBRztRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDO1FBQ2hELEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDYixVQUFVLEVBQUUsQ0FBQztRQUNiLFNBQVMsRUFBRSxDQUFDO1FBQ1osWUFBWSxFQUFFLENBQUM7S0FDaEIsQ0FBQztJQUVGLE9BQU87UUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztLQUNuRCxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUF0Qkgsd0VBQXFGO0FBd0JyRixRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksUUFBYSxDQUFDO0lBQ2xCLElBQUksVUFBZSxDQUFDO0lBRXBCLE1BQU0sVUFBVSxHQUFtQjtRQUNqQyxJQUFJLEVBQUUsV0FBVztRQUNqQixJQUFJLEVBQUUsSUFBSTtRQUNWLFFBQVEsRUFBRSxTQUFTO1FBQ25CLElBQUksRUFBRSxXQUFXO1FBQ2pCLFFBQVEsRUFBRSxlQUFlO1FBQ3pCLEdBQUcsRUFB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QUVuQyxRQUFRLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFFNUQsTUFBTSxNQUFNLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRTVFLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ2hFLEtBQUssRUFBRSxvQkFBb0I7Z0JBQzNCLEtBQUssRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQzthQUN6QixDQUFDLENBQUMsQ0FBQztZQUVKLE1BQU0sZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaXZhbi9Db2RlL3RyYWRpbmcvdGl0YW4vc2VydmljZXMvdGl0YW4tYnJhaW4vdGVzdHMvZGF0YWJhc2UvRGF0YWJhc2VNYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbml0IHRlc3RzIGZvciBEYXRhYmFzZU1hbmFnZXJcbiAqL1xuXG5pbXBvcnQgeyBEYXRhYmFzZU1hbmFnZXIsIERhdGFiYXNlQ29uZmlnIH0gZnJvbSAnLi4vLi4vc3JjL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlcic7XG5cbi8vIE1vY2sgcGcgbW9kdWxlXG5qZXN0Lm1vY2soJ3BnJywgKCkgPT4ge1xuICBjb25zdCBtb2NrQ2xpZW50ID0ge1xuICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgcmVsZWFzZTogamVzdC5mbigpXG4gIH07XG4gIFxuICBjb25zdCBtb2NrUG9vbCA9IHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudCksXG4gICAgcXVlcnk6IGplc3QuZm4oKSxcbiAgICBlbmQ6IGplc3QuZm4oKSxcbiAgICBvbjogamVzdC5mbigpLFxuICAgIHRvdGFsQ291bnQ6IDUsXG4gICAgaWRsZUNvdW50OiAzLFxuICAgIHdhaXRpbmdDb3VudDogMFxuICB9O1xuICBcbiAgcmV0dXJuIHtcbiAgICBQb29sOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tQb29sKVxuICB9O1xufSk7XG5cbmRlc2NyaWJlKCdEYXRhYmFzZU1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCBtb2NrUG9vbDogYW55O1xuICBsZXQgbW9ja0NsaWVudDogYW55O1xuXG4gIGNvbnN0IHRlc3RDb25maWc6IERhdGFiYXNlQ29uZmlnID0ge1xuICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgIHBvcnQ6IDU0MzIsXG4gICAgZGF0YWJhc2U6ICd0ZXN0X2RiJyxcbiAgICB1c2VyOiAndGVzdF91c2VyJyxcbiAgICBwYXNzd29yZDogJ3Rlc3RfcGFzc3dvcmQnLFxuICAgIHNzbDogZmFsc2UsXG4gICAgbWluOiAyLFxuICAgIG1heDogMTAsXG4gICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgIGNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzOiAxMDAwMCxcbiAgICBhY3F1aXJlVGltZW91dE1pbGxpczogNTAwMCxcbiAgICBoZWFsdGhDaGVja0ludGVydmFsTXM6IDMwMDAwLFxuICAgIGhlYWx0aENoZWNrVGltZW91dE1zOiA1MDAwLFxuICAgIG1heFJlY29ubmVjdEF0dGVtcHRzOiA1LFxuICAgIHJlY29ubmVjdERlbGF5TXM6IDUwMDBcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBHZXQgcmVmZXJlbmNlcyB0byB0aGUgbW9ja2VkIG9iamVjdHNcbiAgICBjb25zdCB7IFBvb2wgfSA9IHJlcXVpcmUoJ3BnJyk7XG4gICAgbW9ja1Bvb2wgPSBuZXcgUG9vbCgpO1xuICAgIG1vY2tDbGllbnQgPSBtb2NrUG9vbC5jb25uZWN0Lm1vY2tSZXR1cm5WYWx1ZTtcbiAgICBcbiAgICAvLyBFbnN1cmUgbW9ja0NsaWVudCBoYXMgdGhlIGV4cGVjdGVkIG1ldGhvZHNcbiAgICBpZiAoIW1vY2tDbGllbnQpIHtcbiAgICAgIG1vY2tDbGllbnQgPSB7XG4gICAgICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgICAgIHJlbGVhc2U6IGplc3QuZm4oKVxuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLmNvbm5lY3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudCk7XG4gICAgfVxuICAgIFxuICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW10sIHJvd0NvdW50OiAwLCBjb21tYW5kOiAnU0VMRUNUJyB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZUNvbmZpZ0Zyb21FbnYnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYgPSB7IC4uLm9yaWdpbmFsRW52IH07XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYgPSBvcmlnaW5hbEVudjtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbmZpZyBmcm9tIERBVEFCQVNFX1VSTCcsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzQGhvc3Q6NTQzMy9kYm5hbWU/c3NsbW9kZT1yZXF1aXJlJztcbiAgICAgIFxuICAgICAgY29uc3QgY29uZmlnID0gRGF0YWJhc2VNYW5hZ2VyLmNyZWF0ZUNvbmZpZ0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5ob3N0KS50b0JlKCdob3N0Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMyk7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlKS50b0JlKCdkYm5hbWUnKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgndXNlcicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wYXNzd29yZCkudG9CZSgncGFzcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5zc2wpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjb25maWcgZnJvbSBpbmRpdmlkdWFsIGVudmlyb25tZW50IHZhcmlhYmxlcycsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LkRCX0hPU1QgPSAndGVzdC1ob3N0JztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1BPUlQgPSAnNTQzMyc7XG4gICAgICBwcm9jZXNzLmVudi5EQl9OQU1FID0gJ3Rlc3QtZGInO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfVVNFUiA9ICd0ZXN0LXVzZXInO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfUEFTU1dPUkQgPSAndGVzdC1wYXNzJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1NTTCA9ICd0cnVlJztcbiAgICAgIFxuICAgICAgY29uc3QgY29uZmlnID0gRGF0YWJhc2VNYW5hZ2VyLmNyZWF0ZUNvbmZpZ0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5ob3N0KS50b0JlKCd0ZXN0LWhvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcucG9ydCkudG9CZSg1NDMzKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2UpLnRvQmUoJ3Rlc3QtZGInKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgndGVzdC11c2VyJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBhc3N3b3JkKS50b0JlKCd0ZXN0LXBhc3MnKTtcbiAgICAgIGV4cGVjdChjb25maWcuc3NsKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZXMgd2hlbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ2xvY2FsaG9zdCcpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wb3J0KS50b0JlKDU0MzIpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgndGl0YW5fYnJhaW4nKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgncG9zdGdyZXMnKTtcbiAgICAgIGV4cGVjdChjb25maWcubWluKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5tYXgpLnRvQmUoMTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW5pdGlhbGl6ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgc3VjY2Vzc2Z1bGx5IHdpdGggdmFsaWQgY29uZmlndXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQb29sLmNvbm5lY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnU0VMRUNUIDEnKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnJlbGVhc2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGFscmVhZHkgaW5pdGlhbGl6ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlTWFuYWdlciBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29ubmVjdGlvbiB0ZXN0IGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0Nvbm5lY3Rpb24gZmFpbGVkJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKSkucmVqZWN0cy50b1Rocm93KCdDb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncXVlcnknLCAoKSA9PiB7XG4gICAgbGV0IGRhdGFiYXNlTWFuYWdlcjogRGF0YWJhc2VNYW5hZ2VyO1xuICAgIFxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoZGF0YWJhc2VNYW5hZ2VyKSB7XG4gICAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIHF1ZXJ5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxLCBuYW1lOiAndGVzdCcgfV0sXG4gICAgICAgIHJvd0NvdW50OiAxLFxuICAgICAgICBjb21tYW5kOiAnU0VMRUNUJ1xuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnJvd3MpLnRvRXF1YWwobW9ja1Jlc3VsdC5yb3dzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucm93Q291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbW1hbmQpLnRvQmUoJ1NFTEVDVCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kdXJhdGlvbikudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcXVlcnkgcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QgV0hFUkUgaWQgPSAkMScsIFsxXSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrUG9vbC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1NFTEVDVCAqIEZST00gdGVzdCBXSEVSRSBpZCA9ICQxJywgWzFdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBkYXRhYmFzZSBpcyBub3QgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIHVuaGVhbHRoeSBkYXRhYmFzZVxuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICAobWV0cmljcyBhcyBhbnkpLmlzSGVhbHRoeSA9IGZhbHNlO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgMScpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIGlzIG5vdCBoZWFsdGh5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1F1ZXJ5IGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0JykpLnJlamVjdHMudG9UaHJvdygnUXVlcnkgZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBkYXRhYmFzZU1hbmFnZXIuZ2V0TWV0cmljcygpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuZmFpbGVkUXVlcmllcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RyYW5zYWN0aW9uJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIudHJhbnNhY3Rpb24oY2FsbGJhY2spO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JFR0lOJyk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDbGllbnQpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdDT01NSVQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcm9sbGJhY2sgdHJhbnNhY3Rpb24gb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci50cmFuc2FjdGlvbihjYWxsYmFjaykpLnJlamVjdHMudG9UaHJvdygnVHJhbnNhY3Rpb24gZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQkVHSU4nKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnUk9MTEJBQ0snKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWx0aCBtb25pdG9yaW5nJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVwb3J0IGhlYWx0aHkgc3RhdHVzIHdoZW4gZGF0YWJhc2UgaXMgd29ya2luZycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaXNIZWFsdGh5KCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgY29ubmVjdGlvbiBwb29sIHN0YXR1cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGRhdGFiYXNlTWFuYWdlci5nZXRQb29sU3RhdHVzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0dXMudG90YWxDb25uZWN0aW9ucykudG9CZSg1KTtcbiAgICAgIGV4cGVjdChzdGF0dXMuaWRsZUNvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXR1cy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBkYXRhYmFzZSBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtZXRyaWNzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoNSk7XG4gICAgICBleHBlY3QobWV0cmljcy5pZGxlQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3QobWV0cmljcy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmlzSGVhbHRoeSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NodXRkb3duJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2h1dGRvd24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzaHV0ZG93biB3aGVuIG5vdCBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgaW5pdGlhbGl6ZWQgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgY29uc3QgaW5pdFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbignaW5pdGlhbGl6ZWQnLCBpbml0U3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QoaW5pdFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBzdWNjZXNzIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5U3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdxdWVyeTpzdWNjZXNzJywgcXVlcnlTcHkpO1xuICAgICAgXG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogRlJPTSB0ZXN0JyxcbiAgICAgICAgZHVyYXRpb246IGV4cGVjdC5hbnkoTnVtYmVyKVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBmYWlsdXJlIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5RmFpbFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbigncXVlcnk6ZmFpbHVyZScsIHF1ZXJ5RmFpbFNweSk7XG4gICAgICBcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdRdWVyeSBmYWlsZWQnKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5RmFpbFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBxdWVyeTogJ1NFTEVDVCAqIEZST00gdGVzdCcsXG4gICAgICAgIGVycm9yOiBleHBlY3QuYW55KEVycm9yKVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=