77f0492247cc62f2dc869bf58989ab7a
"use strict";
/**
 * Unit tests for DatabaseManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock pg module
jest.mock('pg', () => ({
    Pool: jest.fn().mockImplementation(() => ({
        connect: jest.fn(),
        query: jest.fn(),
        end: jest.fn(),
        on: jest.fn(),
        totalCount: 5,
        idleCount: 3,
        waitingCount: 0
    }))
}));
const DatabaseManager_1 = require("../../src/database/DatabaseManager");
describe('DatabaseManager', () => {
    let mockPool;
    let mockClient;
    const testConfig = {
        host: 'localhost',
        port: 5432,
        database: 'test_db',
        user: 'test_user',
        password: 'test_password',
        ssl: false,
        min: 2,
        max: 10,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
        acquireTimeoutMillis: 5000,
        healthCheckIntervalMs: 30000,
        healthCheckTimeoutMs: 5000,
        maxReconnectAttempts: 5,
        reconnectDelayMs: 5000
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup mock client
        mockClient = {
            query: jest.fn(),
            release: jest.fn()
        };
        // Setup mock pool
        const { Pool } = require('pg');
        mockPool = new Pool();
        mockPool.connect.mockResolvedValue(mockClient);
        mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });
    });
    describe('createConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create config from DATABASE_URL', () => {
            process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('dbname');
            expect(config.user).toBe('user');
            expect(config.password).toBe('pass');
            expect(config.ssl).toBe(true);
        });
        it('should create config from individual environment variables', () => {
            process.env.DB_HOST = 'test-host';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'test-db';
            process.env.DB_USER = 'test-user';
            process.env.DB_PASSWORD = 'test-pass';
            process.env.DB_SSL = 'true';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('test-host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('test-db');
            expect(config.user).toBe('test-user');
            expect(config.password).toBe('test-pass');
            expect(config.ssl).toBe(true);
        });
        it('should use default values when environment variables are missing', () => {
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('localhost');
            expect(config.port).toBe(5432);
            expect(config.database).toBe('titan_brain');
            expect(config.user).toBe('postgres');
            expect(config.min).toBe(2);
            expect(config.max).toBe(10);
        });
    });
    describe('initialize', () => {
        it('should initialize successfully with valid configuration', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(mockPool.connect).toHaveBeenCalled();
            expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');
            expect(mockClient.release).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should throw error if already initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');
            await databaseManager.shutdown();
        });
        it('should handle connection test failure', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockRejectedValue(new Error('Connection failed'));
            await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');
        });
    });
    describe('query', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute query successfully', async () => {
            const mockResult = {
                rows: [{ id: 1, name: 'test' }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            const result = await databaseManager.query('SELECT * FROM test');
            expect(result.rows).toEqual(mockResult.rows);
            expect(result.rowCount).toBe(1);
            expect(result.command).toBe('SELECT');
            expect(result.duration).toBeGreaterThan(0);
        });
        it('should handle query parameters', async () => {
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);
            expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);
        });
        it('should throw error when database is not healthy', async () => {
            // Simulate unhealthy database
            const metrics = databaseManager.getMetrics();
            metrics.isHealthy = false;
            await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');
        });
        it('should handle query errors', async () => {
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');
            const metrics = databaseManager.getMetrics();
            expect(metrics.failedQueries).toBe(1);
        });
    });
    describe('transaction', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute transaction successfully', async () => {
            const callback = jest.fn().mockResolvedValue('success');
            const result = await databaseManager.transaction(callback);
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(callback).toHaveBeenCalledWith(mockClient);
            expect(mockClient.query).toHaveBeenCalledWith('COMMIT');
            expect(result).toBe('success');
        });
        it('should rollback transaction on error', async () => {
            const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));
            await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');
        });
    });
    describe('health monitoring', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should report healthy status when database is working', () => {
            expect(databaseManager.isHealthy()).toBe(true);
        });
        it('should provide connection pool status', () => {
            const status = databaseManager.getPoolStatus();
            expect(status.totalConnections).toBe(5);
            expect(status.idleConnections).toBe(3);
            expect(status.waitingClients).toBe(0);
        });
        it('should provide database metrics', () => {
            const metrics = databaseManager.getMetrics();
            expect(metrics.totalConnections).toBe(5);
            expect(metrics.idleConnections).toBe(3);
            expect(metrics.waitingClients).toBe(0);
            expect(metrics.isHealthy).toBe(true);
        });
    });
    describe('shutdown', () => {
        it('should shutdown gracefully', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await databaseManager.shutdown();
            expect(mockPool.end).toHaveBeenCalled();
        });
        it('should handle shutdown when not initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            await expect(databaseManager.shutdown()).resolves.not.toThrow();
        });
    });
    describe('event emission', () => {
        it('should emit initialized event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            const initSpy = jest.fn();
            databaseManager.on('initialized', initSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(initSpy).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should emit query success event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            const querySpy = jest.fn();
            databaseManager.on('query:success', querySpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test');
            expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                duration: expect.any(Number)
            }));
            await databaseManager.shutdown();
        });
        it('should emit query failure event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            databaseManager.pool = mockPool;
            const queryFailSpy = jest.fn();
            databaseManager.on('query:failure', queryFailSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();
            expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                error: expect.any(Error)
            }));
            await databaseManager.shutdown();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCxpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDeEMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNiLFVBQVUsRUFBRSxDQUFDO1FBQ2IsU0FBUyxFQUFFLENBQUM7UUFDWixZQUFZLEVBQUUsQ0FBQztLQUNoQixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQWJKLHdFQUFxRjtBQWVyRixRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksUUFBYSxDQUFDO0lBQ2xCLElBQUksVUFBZSxDQUFDO0lBRXBCLE1BQU0sVUFBVSxHQUFtQjtRQUNqQyxJQUFJLEVBQUUsV0FBVztRQUNqQixJQUFJLEVBQUUsSUFBSTtRQUNWLFFBQVEsRUFBRSxTQUFTO1FBQ25CLElBQUksRUFBRSxXQUFXO1FBQ2pCLFFBQVEsRUFBRSxlQUFlO1FBQ3pCLEdBQUcsRUFBRSxLQUFLO1FBQ1YsR0FBRyxFQUFFLENBQUM7UUFDTixHQUFHLEVBQUUsRUFBRTtRQUNQLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsdUJBQXVCLEVBQUUsS0FBSztRQUM5QixvQkFBb0IsRUFBRSxJQUFJO1FBQzFCLHFCQUFxQixFQUFFLEtBQUs7UUFDNUIsb0JBQW9CLEVBQUUsSUFBSTtR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Q0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sZUFBZSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRW5DLFFBQVEsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUU1RCxNQUFNLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFNUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDaEUsS0FBSyxFQUFFLG9CQUFvQjtnQkFDM0IsS0FBSyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO2FBQ3pCLENBQUMsQ0FBQyxDQUFDO1lBRUosTUFBTSxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9pdmFuL0NvZGUvdHJhZGluZy90aXRhbi9zZXJ2aWNlcy90aXRhbi1icmFpbi90ZXN0cy9kYXRhYmFzZS9EYXRhYmFzZU1hbmFnZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgdGVzdHMgZm9yIERhdGFiYXNlTWFuYWdlclxuICovXG5cbmltcG9ydCB7IERhdGFiYXNlTWFuYWdlciwgRGF0YWJhc2VDb25maWcgfSBmcm9tICcuLi8uLi9zcmMvZGF0YWJhc2UvRGF0YWJhc2VNYW5hZ2VyJztcblxuLy8gTW9jayBwZyBtb2R1bGVcbmplc3QubW9jaygncGcnLCAoKSA9PiAoe1xuICBQb29sOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgY29ubmVjdDogamVzdC5mbigpLFxuICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgZW5kOiBqZXN0LmZuKCksXG4gICAgb246IGplc3QuZm4oKSxcbiAgICB0b3RhbENvdW50OiA1LFxuICAgIGlkbGVDb3VudDogMyxcbiAgICB3YWl0aW5nQ291bnQ6IDBcbiAgfSkpXG59KSk7XG5cbmRlc2NyaWJlKCdEYXRhYmFzZU1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCBtb2NrUG9vbDogYW55O1xuICBsZXQgbW9ja0NsaWVudDogYW55O1xuXG4gIGNvbnN0IHRlc3RDb25maWc6IERhdGFiYXNlQ29uZmlnID0ge1xuICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgIHBvcnQ6IDU0MzIsXG4gICAgZGF0YWJhc2U6ICd0ZXN0X2RiJyxcbiAgICB1c2VyOiAndGVzdF91c2VyJyxcbiAgICBwYXNzd29yZDogJ3Rlc3RfcGFzc3dvcmQnLFxuICAgIHNzbDogZmFsc2UsXG4gICAgbWluOiAyLFxuICAgIG1heDogMTAsXG4gICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgIGNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzOiAxMDAwMCxcbiAgICBhY3F1aXJlVGltZW91dE1pbGxpczogNTAwMCxcbiAgICBoZWFsdGhDaGVja0ludGVydmFsTXM6IDMwMDAwLFxuICAgIGhlYWx0aENoZWNrVGltZW91dE1zOiA1MDAwLFxuICAgIG1heFJlY29ubmVjdEF0dGVtcHRzOiA1LFxuICAgIHJlY29ubmVjdERlbGF5TXM6IDUwMDBcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBTZXR1cCBtb2NrIGNsaWVudFxuICAgIG1vY2tDbGllbnQgPSB7XG4gICAgICBxdWVyeTogamVzdC5mbigpLFxuICAgICAgcmVsZWFzZTogamVzdC5mbigpXG4gICAgfTtcblxuICAgIC8vIFNldHVwIG1vY2sgcG9vbFxuICAgIGNvbnN0IHsgUG9vbCB9ID0gcmVxdWlyZSgncGcnKTtcbiAgICBtb2NrUG9vbCA9IG5ldyBQb29sKCk7XG4gICAgbW9ja1Bvb2wuY29ubmVjdC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50KTtcbiAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFtdLCByb3dDb3VudDogMCwgY29tbWFuZDogJ1NFTEVDVCcgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVDb25maWdGcm9tRW52JywgKCkgPT4ge1xuICAgIGNvbnN0IG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnY7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52ID0geyAuLi5vcmlnaW5hbEVudiB9O1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52ID0gb3JpZ2luYWxFbnY7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjb25maWcgZnJvbSBEQVRBQkFTRV9VUkwnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPSAncG9zdGdyZXNxbDovL3VzZXI6cGFzc0Bob3N0OjU0MzMvZGJuYW1lP3NzbG1vZGU9cmVxdWlyZSc7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbmZpZyA9IERhdGFiYXNlTWFuYWdlci5jcmVhdGVDb25maWdGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25maWcuaG9zdCkudG9CZSgnaG9zdCcpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wb3J0KS50b0JlKDU0MzMpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgnZGJuYW1lJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnVzZXIpLnRvQmUoJ3VzZXInKTtcbiAgICAgIGV4cGVjdChjb25maWcucGFzc3dvcmQpLnRvQmUoJ3Bhc3MnKTtcbiAgICAgIGV4cGVjdChjb25maWcuc3NsKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgY29uZmlnIGZyb20gaW5kaXZpZHVhbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5EQl9IT1NUID0gJ3Rlc3QtaG9zdCc7XG4gICAgICBwcm9jZXNzLmVudi5EQl9QT1JUID0gJzU0MzMnO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfTkFNRSA9ICd0ZXN0LWRiJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1VTRVIgPSAndGVzdC11c2VyJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1BBU1NXT1JEID0gJ3Rlc3QtcGFzcyc7XG4gICAgICBwcm9jZXNzLmVudi5EQl9TU0wgPSAndHJ1ZSc7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbmZpZyA9IERhdGFiYXNlTWFuYWdlci5jcmVhdGVDb25maWdGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25maWcuaG9zdCkudG9CZSgndGVzdC1ob3N0Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMyk7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlKS50b0JlKCd0ZXN0LWRiJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnVzZXIpLnRvQmUoJ3Rlc3QtdXNlcicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wYXNzd29yZCkudG9CZSgndGVzdC1wYXNzJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnNzbCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgdmFsdWVzIHdoZW4gZW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSBtaXNzaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0gRGF0YWJhc2VNYW5hZ2VyLmNyZWF0ZUNvbmZpZ0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5ob3N0KS50b0JlKCdsb2NhbGhvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcucG9ydCkudG9CZSg1NDMyKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2UpLnRvQmUoJ3RpdGFuX2JyYWluJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnVzZXIpLnRvQmUoJ3Bvc3RncmVzJyk7XG4gICAgICBleHBlY3QoY29uZmlnLm1pbikudG9CZSgyKTtcbiAgICAgIGV4cGVjdChjb25maWcubWF4KS50b0JlKDEwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luaXRpYWxpemUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHN1Y2Nlc3NmdWxseSB3aXRoIHZhbGlkIGNvbmZpZ3VyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgKGRhdGFiYXNlTWFuYWdlciBhcyBhbnkpLnBvb2wgPSBtb2NrUG9vbDtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTRUxFQ1QgMScpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucmVsZWFzZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgYWxyZWFkeSBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICAoZGF0YWJhc2VNYW5hZ2VyIGFzIGFueSkucG9vbCA9IG1vY2tQb29sO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlTWFuYWdlciBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29ubmVjdGlvbiB0ZXN0IGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgKGRhdGFiYXNlTWFuYWdlciBhcyBhbnkpLnBvb2wgPSBtb2NrUG9vbDtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDb25uZWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCkpLnJlamVjdHMudG9UaHJvdygnQ29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3F1ZXJ5JywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICAoZGF0YWJhc2VNYW5hZ2VyIGFzIGFueSkucG9vbCA9IG1vY2tQb29sO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChkYXRhYmFzZU1hbmFnZXIpIHtcbiAgICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgcXVlcnkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEsIG5hbWU6ICd0ZXN0JyB9XSxcbiAgICAgICAgcm93Q291bnQ6IDEsXG4gICAgICAgIGNvbW1hbmQ6ICdTRUxFQ1QnXG4gICAgICB9O1xuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucm93cykudG9FcXVhbChtb2NrUmVzdWx0LnJvd3MpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb3dDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tbWFuZCkudG9CZSgnU0VMRUNUJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEgfV0sXG4gICAgICAgIHJvd0NvdW50OiAxLFxuICAgICAgICBjb21tYW5kOiAnU0VMRUNUJ1xuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCBXSEVSRSBpZCA9ICQxJywgWzFdKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQb29sLnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnU0VMRUNUICogRlJPTSB0ZXN0IFdIRVJFIGlkID0gJDEnLCBbMV0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGRhdGFiYXNlIGlzIG5vdCBoZWFsdGh5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgdW5oZWFsdGh5IGRhdGFiYXNlXG4gICAgICBjb25zdCBtZXRyaWNzID0gZGF0YWJhc2VNYW5hZ2VyLmdldE1ldHJpY3MoKTtcbiAgICAgIChtZXRyaWNzIGFzIGFueSkuaXNIZWFsdGh5ID0gZmFsc2U7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAxJykpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgaXMgbm90IGhlYWx0aHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHF1ZXJ5IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignUXVlcnkgZmFpbGVkJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QnKSkucmVqZWN0cy50b1Rocm93KCdRdWVyeSBmYWlsZWQnKTtcbiAgICAgIFxuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICBleHBlY3QobWV0cmljcy5mYWlsZWRRdWVyaWVzKS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndHJhbnNhY3Rpb24nLCAoKSA9PiB7XG4gICAgbGV0IGRhdGFiYXNlTWFuYWdlcjogRGF0YWJhc2VNYW5hZ2VyO1xuICAgIFxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIChkYXRhYmFzZU1hbmFnZXIgYXMgYW55KS5wb29sID0gbW9ja1Bvb2w7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIudHJhbnNhY3Rpb24oY2FsbGJhY2spO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JFR0lOJyk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDbGllbnQpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdDT01NSVQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcm9sbGJhY2sgdHJhbnNhY3Rpb24gb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci50cmFuc2FjdGlvbihjYWxsYmFjaykpLnJlamVjdHMudG9UaHJvdygnVHJhbnNhY3Rpb24gZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQkVHSU4nKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnUk9MTEJBQ0snKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWx0aCBtb25pdG9yaW5nJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICAoZGF0YWJhc2VNYW5hZ2VyIGFzIGFueSkucG9vbCA9IG1vY2tQb29sO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChkYXRhYmFzZU1hbmFnZXIpIHtcbiAgICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcG9ydCBoZWFsdGh5IHN0YXR1cyB3aGVuIGRhdGFiYXNlIGlzIHdvcmtpbmcnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLmlzSGVhbHRoeSgpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGNvbm5lY3Rpb24gcG9vbCBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0dXMgPSBkYXRhYmFzZU1hbmFnZXIuZ2V0UG9vbFN0YXR1cygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHVzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoNSk7XG4gICAgICBleHBlY3Qoc3RhdHVzLmlkbGVDb25uZWN0aW9ucykudG9CZSgzKTtcbiAgICAgIGV4cGVjdChzdGF0dXMud2FpdGluZ0NsaWVudHMpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgZGF0YWJhc2UgbWV0cmljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBkYXRhYmFzZU1hbmFnZXIuZ2V0TWV0cmljcygpO1xuICAgICAgXG4gICAgICBleHBlY3QobWV0cmljcy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuaWRsZUNvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KG1ldHJpY3Mud2FpdGluZ0NsaWVudHMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QobWV0cmljcy5pc0hlYWx0aHkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzaHV0ZG93bicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNodXRkb3duIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgKGRhdGFiYXNlTWFuYWdlciBhcyBhbnkpLnBvb2wgPSBtb2NrUG9vbDtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrUG9vbC5lbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNodXRkb3duIHdoZW4gbm90IGluaXRpYWxpemVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V2ZW50IGVtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW1pdCBpbml0aWFsaXplZCBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICAoZGF0YWJhc2VNYW5hZ2VyIGFzIGFueSkucG9vbCA9IG1vY2tQb29sO1xuICAgICAgY29uc3QgaW5pdFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbignaW5pdGlhbGl6ZWQnLCBpbml0U3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QoaW5pdFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBzdWNjZXNzIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIChkYXRhYmFzZU1hbmFnZXIgYXMgYW55KS5wb29sID0gbW9ja1Bvb2w7XG4gICAgICBjb25zdCBxdWVyeVNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbigncXVlcnk6c3VjY2VzcycsIHF1ZXJ5U3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBtb2NrUmVzdWx0ID0ge1xuICAgICAgICByb3dzOiBbeyBpZDogMSB9XSxcbiAgICAgICAgcm93Q291bnQ6IDEsXG4gICAgICAgIGNvbW1hbmQ6ICdTRUxFQ1QnXG4gICAgICB9O1xuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChxdWVyeVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBxdWVyeTogJ1NFTEVDVCAqIEZST00gdGVzdCcsXG4gICAgICAgIGR1cmF0aW9uOiBleHBlY3QuYW55KE51bWJlcilcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVtaXQgcXVlcnkgZmFpbHVyZSBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICAoZGF0YWJhc2VNYW5hZ2VyIGFzIGFueSkucG9vbCA9IG1vY2tQb29sO1xuICAgICAgY29uc3QgcXVlcnlGYWlsU3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdxdWVyeTpmYWlsdXJlJywgcXVlcnlGYWlsU3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1F1ZXJ5IGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0JykpLnJlamVjdHMudG9UaHJvdygpO1xuICAgICAgXG4gICAgICBleHBlY3QocXVlcnlGYWlsU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogRlJPTSB0ZXN0JyxcbiAgICAgICAgZXJyb3I6IGV4cGVjdC5hbnkoRXJyb3IpXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==