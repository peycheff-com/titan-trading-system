bfee0f102c87983a827c6c2dd8df756a
"use strict";
/**
 * Unit tests for DatabaseManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('pg', () => ({
    Pool: jest.fn().mockImplementation(() => mockPool)
}));
const DatabaseManager_1 = require("../../src/database/DatabaseManager");
// Mock pg module
const mockClient = {
    query: jest.fn(),
    release: jest.fn()
};
const mockPool = {
    connect: jest.fn(),
    query: jest.fn(),
    end: jest.fn(),
    on: jest.fn(),
    totalCount: 5,
    idleCount: 3,
    waitingCount: 0
};
describe('DatabaseManager', () => {
    const testConfig = {
        host: 'localhost',
        port: 5432,
        database: 'test_db',
        user: 'test_user',
        password: 'test_password',
        ssl: false,
        min: 2,
        max: 10,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
        acquireTimeoutMillis: 5000,
        healthCheckIntervalMs: 30000,
        healthCheckTimeoutMs: 5000,
        maxReconnectAttempts: 5,
        reconnectDelayMs: 5000
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Reset mock implementations
        mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
        mockClient.release.mockResolvedValue(undefined);
        mockPool.connect.mockResolvedValue(mockClient);
        mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });
        mockPool.end.mockResolvedValue(undefined);
    });
    describe('createConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create config from DATABASE_URL', () => {
            process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('dbname');
            expect(config.user).toBe('user');
            expect(config.password).toBe('pass');
            expect(config.ssl).toBe(true);
        });
        it('should create config from individual environment variables', () => {
            process.env.DB_HOST = 'test-host';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'test-db';
            process.env.DB_USER = 'test-user';
            process.env.DB_PASSWORD = 'test-pass';
            process.env.DB_SSL = 'true';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('test-host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('test-db');
            expect(config.user).toBe('test-user');
            expect(config.password).toBe('test-pass');
            expect(config.ssl).toBe(true);
        });
        it('should use default values when environment variables are missing', () => {
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('localhost');
            expect(config.port).toBe(5432);
            expect(config.database).toBe('titan_brain');
            expect(config.user).toBe('postgres');
            expect(config.min).toBe(2);
            expect(config.max).toBe(10);
        });
    });
    describe('initialize', () => {
        it('should initialize successfully with valid configuration', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(mockPool.connect).toHaveBeenCalled();
            expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');
            expect(mockClient.release).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should throw error if already initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');
            await databaseManager.shutdown();
        });
        it('should handle connection test failure', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockRejectedValue(new Error('Connection failed'));
            await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');
        });
    });
    describe('query', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute query successfully', async () => {
            const mockResult = {
                rows: [{ id: 1, name: 'test' }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            const result = await databaseManager.query('SELECT * FROM test');
            expect(result.rows).toEqual(mockResult.rows);
            expect(result.rowCount).toBe(1);
            expect(result.command).toBe('SELECT');
            expect(result.duration).toBeGreaterThan(0);
        });
        it('should handle query parameters', async () => {
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);
            expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);
        });
        it('should throw error when database is not healthy', async () => {
            // Simulate unhealthy database
            const metrics = databaseManager.getMetrics();
            metrics.isHealthy = false;
            await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');
        });
        it('should handle query errors', async () => {
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');
            const metrics = databaseManager.getMetrics();
            expect(metrics.failedQueries).toBe(1);
        });
    });
    describe('transaction', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute transaction successfully', async () => {
            const callback = jest.fn().mockResolvedValue('success');
            const result = await databaseManager.transaction(callback);
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(callback).toHaveBeenCalledWith(mockClient);
            expect(mockClient.query).toHaveBeenCalledWith('COMMIT');
            expect(result).toBe('success');
        });
        it('should rollback transaction on error', async () => {
            const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));
            await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');
        });
    });
    describe('health monitoring', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should report healthy status when database is working', () => {
            expect(databaseManager.isHealthy()).toBe(true);
        });
        it('should provide connection pool status', () => {
            const status = databaseManager.getPoolStatus();
            expect(status.totalConnections).toBe(5);
            expect(status.idleConnections).toBe(3);
            expect(status.waitingClients).toBe(0);
        });
        it('should provide database metrics', () => {
            const metrics = databaseManager.getMetrics();
            expect(metrics.totalConnections).toBe(5);
            expect(metrics.idleConnections).toBe(3);
            expect(metrics.waitingClients).toBe(0);
            expect(metrics.isHealthy).toBe(true);
        });
    });
    describe('shutdown', () => {
        it('should shutdown gracefully', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await databaseManager.shutdown();
            expect(mockPool.end).toHaveBeenCalled();
        });
        it('should handle shutdown when not initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            await expect(databaseManager.shutdown()).resolves.not.toThrow();
        });
    });
    describe('event emission', () => {
        it('should emit initialized event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const initSpy = jest.fn();
            databaseManager.on('initialized', initSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(initSpy).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should emit query success event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const querySpy = jest.fn();
            databaseManager.on('query:success', querySpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test');
            expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                duration: expect.any(Number)
            }));
            await databaseManager.shutdown();
        });
        it('should emit query failure event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const queryFailSpy = jest.fn();
            databaseManager.on('query:failure', queryFailSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();
            expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                error: expect.any(Error)
            }));
            await databaseManager.shutdown();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFvQkgsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztDQUNuRCxDQUFDLENBQUMsQ0FBQztBQXBCSix3RUFBcUY7QUFFckYsaUJBQWlCO0FBQ2pCLE1BQU0sVUFBVSxHQUFHO0lBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ25CLENBQUM7QUFFRixNQUFNLFFBQVEsR0FBRztJQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2xCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2QsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDYixVQUFVLEVBQUUsQ0FBQztJQUNiLFNBQVMsRUFBRSxDQUFDO0lBQ1osWUFBWSxFQUFFLENBQUM7Q0FDaEIsQ0FBQztBQU1GLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFFL0IsTUFBTSxVQUFVLEdBQW1CO1FBQ2pDLElBQUksRUFBRSxXQUFXO1FBQ2pCLElBQUksRUFBRSxJQUFJO1FBQ1YsUUFBUSxFQUFFLFNBQVM7UUFDbkIsSUFBSSxFQUFFLFdBQVc7UUFDakIsUUFBUSxFQUFFLGVBQWU7UUFDekIsR0FBRyxFQUFFLEtBQUs7UUFDVixHQUFHLEVBQUUsQ0FBQztRQUNOLEdBQUcsRUFBRSxFQUFFO1FBQ1AsaUJBQWlCLEVBQUUsS0FBSztRQUN4Qix1QkFB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QUU1RSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUNoRSxLQUFLLEVBQUUsb0JBQW9CO2dCQUMzQixLQUFLLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7YUFDekIsQ0FBQyxDQUFDLENBQUM7WUFFSixNQUFNLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCB0ZXN0cyBmb3IgRGF0YWJhc2VNYW5hZ2VyXG4gKi9cblxuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyLCBEYXRhYmFzZUNvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZS9EYXRhYmFzZU1hbmFnZXInO1xuXG4vLyBNb2NrIHBnIG1vZHVsZVxuY29uc3QgbW9ja0NsaWVudCA9IHtcbiAgcXVlcnk6IGplc3QuZm4oKSxcbiAgcmVsZWFzZTogamVzdC5mbigpXG59O1xuXG5jb25zdCBtb2NrUG9vbCA9IHtcbiAgY29ubmVjdDogamVzdC5mbigpLFxuICBxdWVyeTogamVzdC5mbigpLFxuICBlbmQ6IGplc3QuZm4oKSxcbiAgb246IGplc3QuZm4oKSxcbiAgdG90YWxDb3VudDogNSxcbiAgaWRsZUNvdW50OiAzLFxuICB3YWl0aW5nQ291bnQ6IDBcbn07XG5cbmplc3QubW9jaygncGcnLCAoKSA9PiAoe1xuICBQb29sOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tQb29sKVxufSkpO1xuXG5kZXNjcmliZSgnRGF0YWJhc2VNYW5hZ2VyJywgKCkgPT4ge1xuXG4gIGNvbnN0IHRlc3RDb25maWc6IERhdGFiYXNlQ29uZmlnID0ge1xuICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgIHBvcnQ6IDU0MzIsXG4gICAgZGF0YWJhc2U6ICd0ZXN0X2RiJyxcbiAgICB1c2VyOiAndGVzdF91c2VyJyxcbiAgICBwYXNzd29yZDogJ3Rlc3RfcGFzc3dvcmQnLFxuICAgIHNzbDogZmFsc2UsXG4gICAgbWluOiAyLFxuICAgIG1heDogMTAsXG4gICAgaWRsZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxuICAgIGNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzOiAxMDAwMCxcbiAgICBhY3F1aXJlVGltZW91dE1pbGxpczogNTAwMCxcbiAgICBoZWFsdGhDaGVja0ludGVydmFsTXM6IDMwMDAwLFxuICAgIGhlYWx0aENoZWNrVGltZW91dE1zOiA1MDAwLFxuICAgIG1heFJlY29ubmVjdEF0dGVtcHRzOiA1LFxuICAgIHJlY29ubmVjdERlbGF5TXM6IDUwMDBcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBSZXNldCBtb2NrIGltcGxlbWVudGF0aW9uc1xuICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgIG1vY2tDbGllbnQucmVsZWFzZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgIG1vY2tQb29sLmNvbm5lY3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudCk7XG4gICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbXSwgcm93Q291bnQ6IDAsIGNvbW1hbmQ6ICdTRUxFQ1QnIH0pO1xuICAgIG1vY2tQb29sLmVuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlQ29uZmlnRnJvbUVudicsICgpID0+IHtcbiAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudiA9IHsgLi4ub3JpZ2luYWxFbnYgfTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudiA9IG9yaWdpbmFsRW52O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgY29uZmlnIGZyb20gREFUQUJBU0VfVVJMJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gJ3Bvc3RncmVzcWw6Ly91c2VyOnBhc3NAaG9zdDo1NDMzL2RibmFtZT9zc2xtb2RlPXJlcXVpcmUnO1xuICAgICAgXG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ2hvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcucG9ydCkudG9CZSg1NDMzKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2UpLnRvQmUoJ2RibmFtZScpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCd1c2VyJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBhc3N3b3JkKS50b0JlKCdwYXNzJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnNzbCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbmZpZyBmcm9tIGluZGl2aWR1YWwgZW52aXJvbm1lbnQgdmFyaWFibGVzJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuREJfSE9TVCA9ICd0ZXN0LWhvc3QnO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfUE9SVCA9ICc1NDMzJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX05BTUUgPSAndGVzdC1kYic7XG4gICAgICBwcm9jZXNzLmVudi5EQl9VU0VSID0gJ3Rlc3QtdXNlcic7XG4gICAgICBwcm9jZXNzLmVudi5EQl9QQVNTV09SRCA9ICd0ZXN0LXBhc3MnO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfU1NMID0gJ3RydWUnO1xuICAgICAgXG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ3Rlc3QtaG9zdCcpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wb3J0KS50b0JlKDU0MzMpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgndGVzdC1kYicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCd0ZXN0LXVzZXInKTtcbiAgICAgIGV4cGVjdChjb25maWcucGFzc3dvcmQpLnRvQmUoJ3Rlc3QtcGFzcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5zc2wpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHZhbHVlcyB3aGVuIGVudmlyb25tZW50IHZhcmlhYmxlcyBhcmUgbWlzc2luZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IERhdGFiYXNlTWFuYWdlci5jcmVhdGVDb25maWdGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25maWcuaG9zdCkudG9CZSgnbG9jYWxob3N0Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMik7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlKS50b0JlKCd0aXRhbl9icmFpbicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy51c2VyKS50b0JlKCdwb3N0Z3JlcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5taW4pLnRvQmUoMik7XG4gICAgICBleHBlY3QoY29uZmlnLm1heCkudG9CZSgxMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbml0aWFsaXplJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSBzdWNjZXNzZnVsbHkgd2l0aCB2YWxpZCBjb25maWd1cmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTRUxFQ1QgMScpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucmVsZWFzZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgYWxyZWFkeSBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCkpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2VNYW5hZ2VyIGFscmVhZHkgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25uZWN0aW9uIHRlc3QgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29ubmVjdGlvbiBmYWlsZWQnKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpKS5yZWplY3RzLnRvVGhyb3coJ0Nvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdxdWVyeScsICgpID0+IHtcbiAgICBsZXQgZGF0YWJhc2VNYW5hZ2VyOiBEYXRhYmFzZU1hbmFnZXI7XG4gICAgXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChkYXRhYmFzZU1hbmFnZXIpIHtcbiAgICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgcXVlcnkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEsIG5hbWU6ICd0ZXN0JyB9XSxcbiAgICAgICAgcm93Q291bnQ6IDEsXG4gICAgICAgIGNvbW1hbmQ6ICdTRUxFQ1QnXG4gICAgICB9O1xuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucm93cykudG9FcXVhbChtb2NrUmVzdWx0LnJvd3MpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb3dDb3VudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tbWFuZCkudG9CZSgnU0VMRUNUJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEgfV0sXG4gICAgICAgIHJvd0NvdW50OiAxLFxuICAgICAgICBjb21tYW5kOiAnU0VMRUNUJ1xuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCBXSEVSRSBpZCA9ICQxJywgWzFdKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQb29sLnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnU0VMRUNUICogRlJPTSB0ZXN0IFdIRVJFIGlkID0gJDEnLCBbMV0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGRhdGFiYXNlIGlzIG5vdCBoZWFsdGh5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgdW5oZWFsdGh5IGRhdGFiYXNlXG4gICAgICBjb25zdCBtZXRyaWNzID0gZGF0YWJhc2VNYW5hZ2VyLmdldE1ldHJpY3MoKTtcbiAgICAgIChtZXRyaWNzIGFzIGFueSkuaXNIZWFsdGh5ID0gZmFsc2U7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAxJykpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgaXMgbm90IGhlYWx0aHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHF1ZXJ5IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignUXVlcnkgZmFpbGVkJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QnKSkucmVqZWN0cy50b1Rocm93KCdRdWVyeSBmYWlsZWQnKTtcbiAgICAgIFxuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICBleHBlY3QobWV0cmljcy5mYWlsZWRRdWVyaWVzKS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndHJhbnNhY3Rpb24nLCAoKSA9PiB7XG4gICAgbGV0IGRhdGFiYXNlTWFuYWdlcjogRGF0YWJhc2VNYW5hZ2VyO1xuICAgIFxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoZGF0YWJhc2VNYW5hZ2VyKSB7XG4gICAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIHRyYW5zYWN0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGxiYWNrID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRhdGFiYXNlTWFuYWdlci50cmFuc2FjdGlvbihjYWxsYmFjayk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQkVHSU4nKTtcbiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0NsaWVudCk7XG4gICAgICBleHBlY3QobW9ja0NsaWVudC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0NPTU1JVCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnc3VjY2VzcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByb2xsYmFjayB0cmFuc2FjdGlvbiBvbiBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGxiYWNrID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVHJhbnNhY3Rpb24gZmFpbGVkJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnRyYW5zYWN0aW9uKGNhbGxiYWNrKSkucmVqZWN0cy50b1Rocm93KCdUcmFuc2FjdGlvbiBmYWlsZWQnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdCRUdJTicpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdST0xMQkFDSycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGVhbHRoIG1vbml0b3JpbmcnLCAoKSA9PiB7XG4gICAgbGV0IGRhdGFiYXNlTWFuYWdlcjogRGF0YWJhc2VNYW5hZ2VyO1xuICAgIFxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoZGF0YWJhc2VNYW5hZ2VyKSB7XG4gICAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXBvcnQgaGVhbHRoeSBzdGF0dXMgd2hlbiBkYXRhYmFzZSBpcyB3b3JraW5nJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5pc0hlYWx0aHkoKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBjb25uZWN0aW9uIHBvb2wgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHVzID0gZGF0YWJhc2VNYW5hZ2VyLmdldFBvb2xTdGF0dXMoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN0YXR1cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5pZGxlQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3Qoc3RhdHVzLndhaXRpbmdDbGllbnRzKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGRhdGFiYXNlIG1ldHJpY3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRyaWNzID0gZGF0YWJhc2VNYW5hZ2VyLmdldE1ldHJpY3MoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1ldHJpY3MudG90YWxDb25uZWN0aW9ucykudG9CZSg1KTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmlkbGVDb25uZWN0aW9ucykudG9CZSgzKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLndhaXRpbmdDbGllbnRzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuaXNIZWFsdGh5KS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2h1dGRvd24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzaHV0ZG93biBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrUG9vbC5lbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNodXRkb3duIHdoZW4gbm90IGluaXRpYWxpemVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V2ZW50IGVtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW1pdCBpbml0aWFsaXplZCBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBjb25zdCBpbml0U3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdpbml0aWFsaXplZCcsIGluaXRTcHkpO1xuICAgICAgXG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChpbml0U3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IHF1ZXJ5IHN1Y2Nlc3MgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgY29uc3QgcXVlcnlTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBkYXRhYmFzZU1hbmFnZXIub24oJ3F1ZXJ5OnN1Y2Nlc3MnLCBxdWVyeVNweSk7XG4gICAgICBcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgICAgcm93czogW3sgaWQ6IDEgfV0sXG4gICAgICAgIHJvd0NvdW50OiAxLFxuICAgICAgICBjb21tYW5kOiAnU0VMRUNUJ1xuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocXVlcnlTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgcXVlcnk6ICdTRUxFQ1QgKiBGUk9NIHRlc3QnLFxuICAgICAgICBkdXJhdGlvbjogZXhwZWN0LmFueShOdW1iZXIpXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IHF1ZXJ5IGZhaWx1cmUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgY29uc3QgcXVlcnlGYWlsU3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdxdWVyeTpmYWlsdXJlJywgcXVlcnlGYWlsU3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1F1ZXJ5IGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0JykpLnJlamVjdHMudG9UaHJvdygpO1xuICAgICAgXG4gICAgICBleHBlY3QocXVlcnlGYWlsU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogRlJPTSB0ZXN0JyxcbiAgICAgICAgZXJyb3I6IGV4cGVjdC5hbnkoRXJyb3IpXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==