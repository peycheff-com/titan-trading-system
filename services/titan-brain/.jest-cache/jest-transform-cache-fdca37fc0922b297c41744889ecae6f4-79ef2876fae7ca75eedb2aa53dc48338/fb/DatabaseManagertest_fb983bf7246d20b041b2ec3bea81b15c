e6a92cb569527e9cb18a4716d6f398ac
"use strict";
/**
 * Unit tests for DatabaseManager
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock pg module
jest.mock('pg', () => ({
    Pool: jest.fn().mockImplementation(() => ({
        connect: jest.fn(),
        query: jest.fn(),
        end: jest.fn(),
        on: jest.fn(),
        totalCount: 5,
        idleCount: 3,
        waitingCount: 0
    }))
}));
const DatabaseManager_1 = require("../../src/database/DatabaseManager");
describe('DatabaseManager', () => {
    let mockPool;
    let mockClient;
    const testConfig = {
        host: 'localhost',
        port: 5432,
        database: 'test_db',
        user: 'test_user',
        password: 'test_password',
        ssl: false,
        min: 2,
        max: 10,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
        acquireTimeoutMillis: 5000,
        healthCheckIntervalMs: 30000,
        healthCheckTimeoutMs: 5000,
        maxReconnectAttempts: 5,
        reconnectDelayMs: 5000
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup mock client
        mockClient = {
            query: jest.fn(),
            release: jest.fn()
        };
        // Setup mock pool
        const { Pool } = require('pg');
        mockPool = new Pool();
        mockPool.connect.mockResolvedValue(mockClient);
        mockPool.query.mockResolvedValue({ rows: [], rowCount: 0, command: 'SELECT' });
    });
    describe('createConfigFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            process.env = { ...originalEnv };
        });
        afterEach(() => {
            process.env = originalEnv;
        });
        it('should create config from DATABASE_URL', () => {
            process.env.DATABASE_URL = 'postgresql://user:pass@host:5433/dbname?sslmode=require';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('dbname');
            expect(config.user).toBe('user');
            expect(config.password).toBe('pass');
            expect(config.ssl).toBe(true);
        });
        it('should create config from individual environment variables', () => {
            process.env.DB_HOST = 'test-host';
            process.env.DB_PORT = '5433';
            process.env.DB_NAME = 'test-db';
            process.env.DB_USER = 'test-user';
            process.env.DB_PASSWORD = 'test-pass';
            process.env.DB_SSL = 'true';
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('test-host');
            expect(config.port).toBe(5433);
            expect(config.database).toBe('test-db');
            expect(config.user).toBe('test-user');
            expect(config.password).toBe('test-pass');
            expect(config.ssl).toBe(true);
        });
        it('should use default values when environment variables are missing', () => {
            const config = DatabaseManager_1.DatabaseManager.createConfigFromEnv();
            expect(config.host).toBe('localhost');
            expect(config.port).toBe(5432);
            expect(config.database).toBe('titan_brain');
            expect(config.user).toBe('postgres');
            expect(config.min).toBe(2);
            expect(config.max).toBe(10);
        });
    });
    describe('initialize', () => {
        it('should initialize successfully with valid configuration', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(mockPool.connect).toHaveBeenCalled();
            expect(mockClient.query).toHaveBeenCalledWith('SELECT 1');
            expect(mockClient.release).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should throw error if already initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await expect(databaseManager.initialize()).rejects.toThrow('DatabaseManager already initialized');
            await databaseManager.shutdown();
        });
        it('should handle connection test failure', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockRejectedValue(new Error('Connection failed'));
            await expect(databaseManager.initialize()).rejects.toThrow('Connection failed');
        });
    });
    describe('query', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute query successfully', async () => {
            const mockResult = {
                rows: [{ id: 1, name: 'test' }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            const result = await databaseManager.query('SELECT * FROM test');
            expect(result.rows).toEqual(mockResult.rows);
            expect(result.rowCount).toBe(1);
            expect(result.command).toBe('SELECT');
            expect(result.duration).toBeGreaterThan(0);
        });
        it('should handle query parameters', async () => {
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test WHERE id = $1', [1]);
            expect(mockPool.query).toHaveBeenCalledWith('SELECT * FROM test WHERE id = $1', [1]);
        });
        it('should throw error when database is not healthy', async () => {
            // Simulate unhealthy database
            const metrics = databaseManager.getMetrics();
            metrics.isHealthy = false;
            await expect(databaseManager.query('SELECT 1')).rejects.toThrow('Database is not healthy');
        });
        it('should handle query errors', async () => {
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow('Query failed');
            const metrics = databaseManager.getMetrics();
            expect(metrics.failedQueries).toBe(1);
        });
    });
    describe('transaction', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should execute transaction successfully', async () => {
            const callback = jest.fn().mockResolvedValue('success');
            const result = await databaseManager.transaction(callback);
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(callback).toHaveBeenCalledWith(mockClient);
            expect(mockClient.query).toHaveBeenCalledWith('COMMIT');
            expect(result).toBe('success');
        });
        it('should rollback transaction on error', async () => {
            const callback = jest.fn().mockRejectedValue(new Error('Transaction failed'));
            await expect(databaseManager.transaction(callback)).rejects.toThrow('Transaction failed');
            expect(mockClient.query).toHaveBeenCalledWith('BEGIN');
            expect(mockClient.query).toHaveBeenCalledWith('ROLLBACK');
        });
    });
    describe('health monitoring', () => {
        let databaseManager;
        beforeEach(async () => {
            databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
        });
        afterEach(async () => {
            if (databaseManager) {
                await databaseManager.shutdown();
            }
        });
        it('should report healthy status when database is working', () => {
            expect(databaseManager.isHealthy()).toBe(true);
        });
        it('should provide connection pool status', () => {
            const status = databaseManager.getPoolStatus();
            expect(status.totalConnections).toBe(5);
            expect(status.idleConnections).toBe(3);
            expect(status.waitingClients).toBe(0);
        });
        it('should provide database metrics', () => {
            const metrics = databaseManager.getMetrics();
            expect(metrics.totalConnections).toBe(5);
            expect(metrics.idleConnections).toBe(3);
            expect(metrics.waitingClients).toBe(0);
            expect(metrics.isHealthy).toBe(true);
        });
    });
    describe('shutdown', () => {
        it('should shutdown gracefully', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            await databaseManager.shutdown();
            expect(mockPool.end).toHaveBeenCalled();
        });
        it('should handle shutdown when not initialized', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            await expect(databaseManager.shutdown()).resolves.not.toThrow();
        });
    });
    describe('event emission', () => {
        it('should emit initialized event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const initSpy = jest.fn();
            databaseManager.on('initialized', initSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            expect(initSpy).toHaveBeenCalled();
            await databaseManager.shutdown();
        });
        it('should emit query success event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const querySpy = jest.fn();
            databaseManager.on('query:success', querySpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            const mockResult = {
                rows: [{ id: 1 }],
                rowCount: 1,
                command: 'SELECT'
            };
            mockPool.query.mockResolvedValue(mockResult);
            await databaseManager.query('SELECT * FROM test');
            expect(querySpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                duration: expect.any(Number)
            }));
            await databaseManager.shutdown();
        });
        it('should emit query failure event', async () => {
            const databaseManager = new DatabaseManager_1.DatabaseManager(testConfig);
            const queryFailSpy = jest.fn();
            databaseManager.on('query:failure', queryFailSpy);
            mockClient.query.mockResolvedValue({ rows: [{ '?column?': 1 }] });
            await databaseManager.initialize();
            mockPool.query.mockRejectedValue(new Error('Query failed'));
            await expect(databaseManager.query('SELECT * FROM test')).rejects.toThrow();
            expect(queryFailSpy).toHaveBeenCalledWith(expect.objectContaining({
                query: 'SELECT * FROM test',
                error: expect.any(Error)
            }));
            await databaseManager.shutdown();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCxpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDeEMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNiLFVBQVUsRUFBRSxDQUFDO1FBQ2IsU0FBUyxFQUFFLENBQUM7UUFDWixZQUFZLEVBQUUsQ0FBQztLQUNoQixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQWJKLHdFQUFxRjtBQWVyRixRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksUUFBYSxDQUFDO0lBQ2xCLElBQUksVUFBZSxDQUFDO0lBRXBCLE1BQU0sVUFBVSxHQUFtQjtRQUNqQyxJQUFJLEVBQUUsV0FBVztRQUNqQixJQUFJLEVBQUUsSUFBSTtRQUNWLFFBQVEsRUFBRSxTQUFTO1FBQ25CLElBQUksRUFBRSxXQUFXO1FBQ2pCLFFBQVEsRUFBRSxlQUFlO1FBQ3pCLEdBQUcsRUFBRSxLQUFLO1FBQ1YsR0FBRyxFQUFFLENBQUM7UUFDTixHQUFHLEVBQUUsRUFBRTtRQUNQLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsdUJBQXVCLEVBQUUsS0FBSztRQUM5QixvQkFBb0IsRUFBRSxJQUFJO1FBQzFCLHFCQUFxQixFQUFFLEtBQUs7UUFDNUIsb0JBQW9CLEVBQUUsSUFBSTtR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QUMzQixLQUFLLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7YUFDekIsQ0FBQyxDQUFDLENBQUM7WUFFSixNQUFNLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2l2YW4vQ29kZS90cmFkaW5nL3RpdGFuL3NlcnZpY2VzL3RpdGFuLWJyYWluL3Rlc3RzL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCB0ZXN0cyBmb3IgRGF0YWJhc2VNYW5hZ2VyXG4gKi9cblxuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyLCBEYXRhYmFzZUNvbmZpZyB9IGZyb20gJy4uLy4uL3NyYy9kYXRhYmFzZS9EYXRhYmFzZU1hbmFnZXInO1xuXG4vLyBNb2NrIHBnIG1vZHVsZVxuamVzdC5tb2NrKCdwZycsICgpID0+ICh7XG4gIFBvb2w6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgcXVlcnk6IGplc3QuZm4oKSxcbiAgICBlbmQ6IGplc3QuZm4oKSxcbiAgICBvbjogamVzdC5mbigpLFxuICAgIHRvdGFsQ291bnQ6IDUsXG4gICAgaWRsZUNvdW50OiAzLFxuICAgIHdhaXRpbmdDb3VudDogMFxuICB9KSlcbn0pKTtcblxuZGVzY3JpYmUoJ0RhdGFiYXNlTWFuYWdlcicsICgpID0+IHtcbiAgbGV0IG1vY2tQb29sOiBhbnk7XG4gIGxldCBtb2NrQ2xpZW50OiBhbnk7XG5cbiAgY29uc3QgdGVzdENvbmZpZzogRGF0YWJhc2VDb25maWcgPSB7XG4gICAgaG9zdDogJ2xvY2FsaG9zdCcsXG4gICAgcG9ydDogNTQzMixcbiAgICBkYXRhYmFzZTogJ3Rlc3RfZGInLFxuICAgIHVzZXI6ICd0ZXN0X3VzZXInLFxuICAgIHBhc3N3b3JkOiAndGVzdF9wYXNzd29yZCcsXG4gICAgc3NsOiBmYWxzZSxcbiAgICBtaW46IDIsXG4gICAgbWF4OiAxMCxcbiAgICBpZGxlVGltZW91dE1pbGxpczogMzAwMDAsXG4gICAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDEwMDAwLFxuICAgIGFjcXVpcmVUaW1lb3V0TWlsbGlzOiA1MDAwLFxuICAgIGhlYWx0aENoZWNrSW50ZXJ2YWxNczogMzAwMDAsXG4gICAgaGVhbHRoQ2hlY2tUaW1lb3V0TXM6IDUwMDAsXG4gICAgbWF4UmVjb25uZWN0QXR0ZW1wdHM6IDUsXG4gICAgcmVjb25uZWN0RGVsYXlNczogNTAwMFxuICB9O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIFNldHVwIG1vY2sgY2xpZW50XG4gICAgbW9ja0NsaWVudCA9IHtcbiAgICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgICByZWxlYXNlOiBqZXN0LmZuKClcbiAgICB9O1xuXG4gICAgLy8gU2V0dXAgbW9jayBwb29sXG4gICAgY29uc3QgeyBQb29sIH0gPSByZXF1aXJlKCdwZycpO1xuICAgIG1vY2tQb29sID0gbmV3IFBvb2woKTtcbiAgICBtb2NrUG9vbC5jb25uZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGllbnQpO1xuICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW10sIHJvd0NvdW50OiAwLCBjb21tYW5kOiAnU0VMRUNUJyB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZUNvbmZpZ0Zyb21FbnYnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYgPSB7IC4uLm9yaWdpbmFsRW52IH07XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYgPSBvcmlnaW5hbEVudjtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbmZpZyBmcm9tIERBVEFCQVNFX1VSTCcsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzQGhvc3Q6NTQzMy9kYm5hbWU/c3NsbW9kZT1yZXF1aXJlJztcbiAgICAgIFxuICAgICAgY29uc3QgY29uZmlnID0gRGF0YWJhc2VNYW5hZ2VyLmNyZWF0ZUNvbmZpZ0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5ob3N0KS50b0JlKCdob3N0Jyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMyk7XG4gICAgICBleHBlY3QoY29uZmlnLmRhdGFiYXNlKS50b0JlKCdkYm5hbWUnKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgndXNlcicpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wYXNzd29yZCkudG9CZSgncGFzcycpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5zc2wpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjb25maWcgZnJvbSBpbmRpdmlkdWFsIGVudmlyb25tZW50IHZhcmlhYmxlcycsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LkRCX0hPU1QgPSAndGVzdC1ob3N0JztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1BPUlQgPSAnNTQzMyc7XG4gICAgICBwcm9jZXNzLmVudi5EQl9OQU1FID0gJ3Rlc3QtZGInO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfVVNFUiA9ICd0ZXN0LXVzZXInO1xuICAgICAgcHJvY2Vzcy5lbnYuREJfUEFTU1dPUkQgPSAndGVzdC1wYXNzJztcbiAgICAgIHByb2Nlc3MuZW52LkRCX1NTTCA9ICd0cnVlJztcbiAgICAgIFxuICAgICAgY29uc3QgY29uZmlnID0gRGF0YWJhc2VNYW5hZ2VyLmNyZWF0ZUNvbmZpZ0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZy5ob3N0KS50b0JlKCd0ZXN0LWhvc3QnKTtcbiAgICAgIGV4cGVjdChjb25maWcucG9ydCkudG9CZSg1NDMzKTtcbiAgICAgIGV4cGVjdChjb25maWcuZGF0YWJhc2UpLnRvQmUoJ3Rlc3QtZGInKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgndGVzdC11c2VyJyk7XG4gICAgICBleHBlY3QoY29uZmlnLnBhc3N3b3JkKS50b0JlKCd0ZXN0LXBhc3MnKTtcbiAgICAgIGV4cGVjdChjb25maWcuc3NsKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZXMgd2hlbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSBEYXRhYmFzZU1hbmFnZXIuY3JlYXRlQ29uZmlnRnJvbUVudigpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmhvc3QpLnRvQmUoJ2xvY2FsaG9zdCcpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5wb3J0KS50b0JlKDU0MzIpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgndGl0YW5fYnJhaW4nKTtcbiAgICAgIGV4cGVjdChjb25maWcudXNlcikudG9CZSgncG9zdGdyZXMnKTtcbiAgICAgIGV4cGVjdChjb25maWcubWluKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KGNvbmZpZy5tYXgpLnRvQmUoMTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW5pdGlhbGl6ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgc3VjY2Vzc2Z1bGx5IHdpdGggdmFsaWQgY29uZmlndXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQb29sLmNvbm5lY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnU0VMRUNUIDEnKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnJlbGVhc2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGFscmVhZHkgaW5pdGlhbGl6ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlTWFuYWdlciBhbHJlYWR5IGluaXRpYWxpemVkJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29ubmVjdGlvbiB0ZXN0IGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0Nvbm5lY3Rpb24gZmFpbGVkJykpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKSkucmVqZWN0cy50b1Rocm93KCdDb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncXVlcnknLCAoKSA9PiB7XG4gICAgbGV0IGRhdGFiYXNlTWFuYWdlcjogRGF0YWJhc2VNYW5hZ2VyO1xuICAgIFxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoZGF0YWJhc2VNYW5hZ2VyKSB7XG4gICAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIHF1ZXJ5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxLCBuYW1lOiAndGVzdCcgfV0sXG4gICAgICAgIHJvd0NvdW50OiAxLFxuICAgICAgICBjb21tYW5kOiAnU0VMRUNUJ1xuICAgICAgfTtcbiAgICAgIG1vY2tQb29sLnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnJvd3MpLnRvRXF1YWwobW9ja1Jlc3VsdC5yb3dzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucm93Q291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbW1hbmQpLnRvQmUoJ1NFTEVDVCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kdXJhdGlvbikudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcXVlcnkgcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QgV0hFUkUgaWQgPSAkMScsIFsxXSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrUG9vbC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1NFTEVDVCAqIEZST00gdGVzdCBXSEVSRSBpZCA9ICQxJywgWzFdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBkYXRhYmFzZSBpcyBub3QgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIHVuaGVhbHRoeSBkYXRhYmFzZVxuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICAobWV0cmljcyBhcyBhbnkpLmlzSGVhbHRoeSA9IGZhbHNlO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgMScpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIGlzIG5vdCBoZWFsdGh5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWVyeSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1F1ZXJ5IGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci5xdWVyeSgnU0VMRUNUICogRlJPTSB0ZXN0JykpLnJlamVjdHMudG9UaHJvdygnUXVlcnkgZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBkYXRhYmFzZU1hbmFnZXIuZ2V0TWV0cmljcygpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuZmFpbGVkUXVlcmllcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RyYW5zYWN0aW9uJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnc3VjY2VzcycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhYmFzZU1hbmFnZXIudHJhbnNhY3Rpb24oY2FsbGJhY2spO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JFR0lOJyk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDbGllbnQpO1xuICAgICAgZXhwZWN0KG1vY2tDbGllbnQucXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdDT01NSVQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcm9sbGJhY2sgdHJhbnNhY3Rpb24gb24gZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGRhdGFiYXNlTWFuYWdlci50cmFuc2FjdGlvbihjYWxsYmFjaykpLnJlamVjdHMudG9UaHJvdygnVHJhbnNhY3Rpb24gZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQkVHSU4nKTtcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnUk9MTEJBQ0snKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYWx0aCBtb25pdG9yaW5nJywgKCkgPT4ge1xuICAgIGxldCBkYXRhYmFzZU1hbmFnZXI6IERhdGFiYXNlTWFuYWdlcjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGRhdGFiYXNlTWFuYWdlcikge1xuICAgICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVwb3J0IGhlYWx0aHkgc3RhdHVzIHdoZW4gZGF0YWJhc2UgaXMgd29ya2luZycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYXRhYmFzZU1hbmFnZXIuaXNIZWFsdGh5KCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgY29ubmVjdGlvbiBwb29sIHN0YXR1cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGRhdGFiYXNlTWFuYWdlci5nZXRQb29sU3RhdHVzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0dXMudG90YWxDb25uZWN0aW9ucykudG9CZSg1KTtcbiAgICAgIGV4cGVjdChzdGF0dXMuaWRsZUNvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXR1cy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBkYXRhYmFzZSBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljcyA9IGRhdGFiYXNlTWFuYWdlci5nZXRNZXRyaWNzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtZXRyaWNzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoNSk7XG4gICAgICBleHBlY3QobWV0cmljcy5pZGxlQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3QobWV0cmljcy53YWl0aW5nQ2xpZW50cykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmlzSGVhbHRoeSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NodXRkb3duJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2h1dGRvd24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5zaHV0ZG93bigpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1Bvb2wuZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzaHV0ZG93biB3aGVuIG5vdCBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGFiYXNlTWFuYWdlciA9IG5ldyBEYXRhYmFzZU1hbmFnZXIodGVzdENvbmZpZyk7XG4gICAgICBhd2FpdCBleHBlY3QoZGF0YWJhc2VNYW5hZ2VyLnNodXRkb3duKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgaW5pdGlhbGl6ZWQgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZU1hbmFnZXIgPSBuZXcgRGF0YWJhc2VNYW5hZ2VyKHRlc3RDb25maWcpO1xuICAgICAgY29uc3QgaW5pdFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbignaW5pdGlhbGl6ZWQnLCBpbml0U3B5KTtcbiAgICAgIFxuICAgICAgbW9ja0NsaWVudC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFt7ICc/Y29sdW1uPyc6IDEgfV0gfSk7XG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QoaW5pdFNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBzdWNjZXNzIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5U3B5ID0gamVzdC5mbigpO1xuICAgICAgZGF0YWJhc2VNYW5hZ2VyLm9uKCdxdWVyeTpzdWNjZXNzJywgcXVlcnlTcHkpO1xuICAgICAgXG4gICAgICBtb2NrQ2xpZW50LnF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW3sgJz9jb2x1bW4/JzogMSB9XSB9KTtcbiAgICAgIGF3YWl0IGRhdGFiYXNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIHJvd3M6IFt7IGlkOiAxIH1dLFxuICAgICAgICByb3dDb3VudDogMSxcbiAgICAgICAgY29tbWFuZDogJ1NFTEVDVCdcbiAgICAgIH07XG4gICAgICBtb2NrUG9vbC5xdWVyeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHRlc3QnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHF1ZXJ5OiAnU0VMRUNUICogRlJPTSB0ZXN0JyxcbiAgICAgICAgZHVyYXRpb246IGV4cGVjdC5hbnkoTnVtYmVyKVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBxdWVyeSBmYWlsdXJlIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VNYW5hZ2VyID0gbmV3IERhdGFiYXNlTWFuYWdlcih0ZXN0Q29uZmlnKTtcbiAgICAgIGNvbnN0IHF1ZXJ5RmFpbFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGRhdGFiYXNlTWFuYWdlci5vbigncXVlcnk6ZmFpbHVyZScsIHF1ZXJ5RmFpbFNweSk7XG4gICAgICBcbiAgICAgIG1vY2tDbGllbnQucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoeyByb3dzOiBbeyAnP2NvbHVtbj8nOiAxIH1dIH0pO1xuICAgICAgYXdhaXQgZGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgbW9ja1Bvb2wucXVlcnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdRdWVyeSBmYWlsZWQnKSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChkYXRhYmFzZU1hbmFnZXIucXVlcnkoJ1NFTEVDVCAqIEZST00gdGVzdCcpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHF1ZXJ5RmFpbFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBxdWVyeTogJ1NFTEVDVCAqIEZST00gdGVzdCcsXG4gICAgICAgIGVycm9yOiBleHBlY3QuYW55KEVycm9yKVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBhd2FpdCBkYXRhYmFzZU1hbmFnZXIuc2h1dGRvd24oKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=