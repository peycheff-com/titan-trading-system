
> titan-brain@1.0.0 test:unit
> NODE_OPTIONS=--experimental-vm-modules jest --config jest.config.cjs

FAIL tests/unit/NotificationService.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       7 |
       8 | // Mock fetch globally
    >  9 | global.fetch = jest.fn();
         |                ^
      10 |
      11 | describe('NotificationService', () => {
      12 |   let notificationService: NotificationService;

      at tests/unit/NotificationService.test.ts:9:16

(node:49609) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/health/HealthManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      16 | // Mock database manager
      17 | const mockDatabaseManager = {
    > 18 |   isHealthy: jest.fn(),
         |              ^
      19 |   getMetrics: jest.fn()
      20 | };
      21 |

      at tests/health/HealthManager.test.ts:18:14

(node:49607) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/performance/performance.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | import { performance } from "perf_hooks";
    > 11 | jest.mock("../../src/monitoring/index.js", () => ({
         | ^
      12 |   getLogger: () => ({
      13 |     info: jest.fn(),
      14 |     warn: jest.fn(),

      at tests/performance/performance.test.ts:11:1

FAIL tests/unit/CapitalFlowManager.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

(node:49611) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/startup/StartupManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      10 |
      11 | // Mock Logger
    > 12 | jest.mock('../../src/logging/Logger.js');
         | ^
      13 |
      14 | describe('StartupManager', () => {
      15 |   let startupManager: StartupManager;

      at tests/startup/StartupManager.test.ts:12:1

(node:49608) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/services/CircuitBreaker.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | // Mock Logger
    > 11 | jest.mock('../../src/logging/Logger');
         | ^
      12 | const mockLogger = {
      13 |   info: jest.fn(),
      14 |   warn: jest.fn(),

      at tests/services/CircuitBreaker.test.ts:11:1

(node:49610) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/EventStore.test.ts
  ● Test suite failed to run

    Configuration error:

    Could not locate module ../../src/utils/Logger.js mapped as:
    $1.

    Please check your configuration for these entries:
    {
      "moduleNameMapper": {
        "/^(\.{1,2}\/.*)\.js$/": "$1"
      },
      "resolver": undefined
    }

      18 |
      19 | // Mock Logger to avoid dependency issues
    > 20 | jest.mock("../../src/utils/Logger.js", () => ({
         |      ^
      21 |     logger: {
      22 |         info: jest.fn(),
      23 |         error: jest.fn(),

      at createNoMappedModuleFoundError (../../node_modules/jest-resolve/build/resolver.js:759:17)
      at tests/unit/EventStore.test.ts:20:6

(node:49606) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/PowerLawIntegration.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

(node:49605) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/ConfigLoader.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

PASS tests/unit/ManualTradeService.test.ts
  ● Console

    console.log
      [ManualTradeService] Executing manual trade: manual-dabb8ce1-b3ef-4194-be46-ccb085ccd847 BUY BTCUSDT size=1000

      at ManualTradeService.executeManualTrade (src/engine/ManualTradeService.ts:43:13)

    console.log
      [ManualTradeService] Executing manual trade: manual-6cdf135a-3471-4e6d-ae59-42c5023da924 BUY BTCUSDT size=1000

      at ManualTradeService.executeManualTrade (src/engine/ManualTradeService.ts:43:13)

    console.error
      [ManualTradeService] Failed to execute trade: Error: Execution failed
          at Object.<anonymous> (/Users/ivan/Code/trading/titan/services/titan-brain/tests/unit/ManualTradeService.test.ts:67:27)
          at Promise.then.completed (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/testWorker.js:106:12)

      33 |
      34 |   // Otherwise, log normally
    > 35 |   originalConsoleError.apply(console, args);
         |                        ^
      36 | };
      37 |
      38 | // Increase max listeners for tests to prevent warnings

      at console.error (tests/setup.ts:35:24)
      at ManualTradeService.executeManualTrade (src/engine/ManualTradeService.ts:51:15)
      at Object.<anonymous> (tests/unit/ManualTradeService.test.ts:70:13)

    console.log
      [ManualTradeService] Executing manual trade: manual-3ab62a31-2b62-4891-88b5-1529cbd3715d SELL ETHUSDT size=500

      at ManualTradeService.executeManualTrade (src/engine/ManualTradeService.ts:43:13)

    console.warn
      [ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions

      58 |    */
      59 |   async cancelAllTrades(): Promise<void> {
    > 60 |     console.warn(`[ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions`);
         |             ^
      61 |     const client = this.getExecutionClient();
      62 |     if (!client) {
      63 |       throw new Error('Execution Engine not connected - cannot close positions');

      at ManualTradeService.cancelAllTrades (src/engine/ManualTradeService.ts:60:13)
      at Object.<anonymous> (tests/unit/ManualTradeService.test.ts:95:38)

    console.log
      [ManualTradeService] Successfully requested close all positions

      at ManualTradeService.cancelAllTrades (src/engine/ManualTradeService.ts:68:15)

    console.warn
      [ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions

      58 |    */
      59 |   async cancelAllTrades(): Promise<void> {
    > 60 |     console.warn(`[ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions`);
         |             ^
      61 |     const client = this.getExecutionClient();
      62 |     if (!client) {
      63 |       throw new Error('Execution Engine not connected - cannot close positions');

      at ManualTradeService.cancelAllTrades (src/engine/ManualTradeService.ts:60:13)
      at Object.<anonymous> (tests/unit/ManualTradeService.test.ts:106:45)

    console.warn
      [ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions

      58 |    */
      59 |   async cancelAllTrades(): Promise<void> {
    > 60 |     console.warn(`[ManualTradeService] PANIC BUTTON TRIGGERED: Closing all positions`);
         |             ^
      61 |     const client = this.getExecutionClient();
      62 |     if (!client) {
      63 |       throw new Error('Execution Engine not connected - cannot close positions');

      at ManualTradeService.cancelAllTrades (src/engine/ManualTradeService.ts:60:13)
      at Object.<anonymous> (tests/unit/ManualTradeService.test.ts:118:45)

    console.error
      [ManualTradeService] Failed to close all positions: Error: Panic close failed
          at Object.<anonymous> (/Users/ivan/Code/trading/titan/services/titan-brain/tests/unit/ManualTradeService.test.ts:115:27)
          at Promise.then.completed (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/ivan/Code/trading/titan/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/ivan/Code/trading/titan/node_modules/jest-runner/build/testWorker.js:106:12)

      33 |
      34 |   // Otherwise, log normally
    > 35 |   originalConsoleError.apply(console, args);
         |                        ^
      36 | };
      37 |
      38 | // Increase max listeners for tests to prevent warnings

      at console.error (tests/setup.ts:35:24)
      at ManualTradeService.cancelAllTrades (src/engine/ManualTradeService.ts:70:15)
      at Object.<anonymous> (tests/unit/ManualTradeService.test.ts:118:13)

FAIL tests/services/ServiceClient.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      14 |
      15 | // Mock Logger
    > 16 | jest.mock('../../src/logging/Logger');
         | ^
      17 | const mockLogger = {
      18 |   info: jest.fn(),
      19 |   warn: jest.fn(),

      at tests/services/ServiceClient.test.ts:16:1

PASS tests/unit/ReconciliationService.test.ts
  ● Console

    console.info
      {"timestamp":"2026-01-23T11:54:17.638Z","level":"INFO","message":"[Reconciliation] BYBIT: MATCH (0 mismatches)","component":"titan-brain"}

      at Logger.writeLog (../shared/src/logger/Logger.ts:278:19)

    console.warn
      {"timestamp":"2026-01-23T11:54:17.649Z","level":"WARN","message":"⚠️ RECONCILIATION DRIFT [BYBIT]: 1 issues found","component":"titan-brain"}

      279 |           break;
      280 |         case 'WARN':
    > 281 |           console.warn(logString);
          |                   ^
      282 |           break;
      283 |         case 'ERROR':
      284 |         case 'FATAL':

      at Logger.writeLog (../shared/src/logger/Logger.ts:281:19)
      at Logger.warn (../shared/src/logger/Logger.ts:326:10)
      at ReconciliationService.handleDiscrepancy (src/reconciliation/ReconciliationService.ts:437:12)
      at ReconciliationService.reconcile (src/reconciliation/ReconciliationService.ts:273:14)
      at Object.<anonymous> (tests/unit/ReconciliationService.test.ts:121:9)

    console.info
      {"timestamp":"2026-01-23T11:54:17.649Z","level":"INFO","message":"[Reconciliation] BYBIT: MISMATCH (1 mismatches)","component":"titan-brain"}

      at Logger.writeLog (../shared/src/logger/Logger.ts:278:19)

    console.warn
      {"timestamp":"2026-01-23T11:54:17.650Z","level":"WARN","message":"⚠️ RECONCILIATION DRIFT [BYBIT]: 1 issues found","component":"titan-brain"}

      279 |           break;
      280 |         case 'WARN':
    > 281 |           console.warn(logString);
          |                   ^
      282 |           break;
      283 |         case 'ERROR':
      284 |         case 'FATAL':

      at Logger.writeLog (../shared/src/logger/Logger.ts:281:19)
      at Logger.warn (../shared/src/logger/Logger.ts:326:10)
      at ReconciliationService.handleDiscrepancy (src/reconciliation/ReconciliationService.ts:437:12)
      at ReconciliationService.reconcile (src/reconciliation/ReconciliationService.ts:273:14)
      at Object.<anonymous> (tests/unit/ReconciliationService.test.ts:162:9)

    console.info
      {"timestamp":"2026-01-23T11:54:17.650Z","level":"INFO","message":"[Reconciliation] BYBIT: MISMATCH (1 mismatches)","component":"titan-brain"}

      at Logger.writeLog (../shared/src/logger/Logger.ts:278:19)

FAIL tests/property/RiskGuardian.property.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/CircuitBreaker.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/property/SecurityAuditLogger.property.test.ts
  ● SecurityAuditLogger Property Tests › Property: All security events are logged to audit trail

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Audit trail maintains chronological order

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Threat detection patterns are consistently applied

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Alert thresholds trigger appropriate responses

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Audit log format is consistent and parseable

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Security statistics accurately reflect logged events

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

FAIL tests/unit/services/Reconciliation.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock Logger
    >  8 | jest.mock("@/logging/Logger");
         | ^
       9 | (Logger.getInstance as jest.Mock).mockReturnValue({
      10 |     info: jest.fn(),
      11 |     error: jest.fn(),

      at tests/unit/services/Reconciliation.test.ts:8:1

FAIL tests/unit/RiskGuardian.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/logging/Logger.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      21 |
      22 | // Mock fs methods
    > 23 | jest.mock('fs');
         | ^
      24 | const mockFs = fs as jest.Mocked<typeof fs>;
      25 |
      26 | describe('Logger', () => {

      at tests/logging/Logger.test.ts:23:1

FAIL tests/metrics/MetricsCollector.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | // Mock Logger
    > 11 | jest.mock('../../src/logging/Logger');
         | ^
      12 | const mockLogger = {
      13 |   info: jest.fn(),
      14 |   warn: jest.fn(),

      at tests/metrics/MetricsCollector.test.ts:11:1

(node:49604) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/server/WebhookServer.hmac.test.ts
  ● WebhookServer HMAC validation › accepts a valid HMAC signature (raw body + timestamp)

    ReferenceError: jest is not defined

      22 |         }),
      23 |       }),
    > 24 |       getEquity: jest.fn().mockReturnValue(0),
         |                  ^
      25 |       getCircuitBreakerStatus: jest.fn().mockReturnValue({ active: false }),
      26 |       processSignal: jest.fn().mockResolvedValue({ approved: true, reason: "ok" }),
      27 |     } as unknown as TitanBrain;

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:24:18)

  ● WebhookServer HMAC validation › rejects a modified body with the original signature

    ReferenceError: jest is not defined

      22 |         }),
      23 |       }),
    > 24 |       getEquity: jest.fn().mockReturnValue(0),
         |                  ^
      25 |       getCircuitBreakerStatus: jest.fn().mockReturnValue({ active: false }),
      26 |       processSignal: jest.fn().mockResolvedValue({ approved: true, reason: "ok" }),
      27 |     } as unknown as TitanBrain;

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:24:18)


  ● Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'stop')

      49 |
      50 |   afterAll(async () => {
    > 51 |     await server.stop();
         |                  ^
      52 |   });
      53 |
      54 |   it("accepts a valid HMAC signature (raw body + timestamp)", async () => {

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:51:18)

FAIL tests/unit/AllocationEngine.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

PASS tests/property/CapitalFlowManager.property.test.ts
FAIL tests/unit/RiskGuardianVerification.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      17 | // Mock dependencies
      18 | const mockAllocationEngine = {
    > 19 |     getMaxLeverage: jest.fn().mockReturnValue(10), // 10x max
         |                     ^
      20 | } as unknown as AllocationEngine;
      21 |
      22 | const mockGovernanceEngine = {

      at tests/unit/RiskGuardianVerification.test.ts:19:21

FAIL tests/cache/InMemoryCache.test.ts
  ● InMemoryCache › event emission › should emit set event

    ReferenceError: jest is not defined

      279 |   describe('event emission', () => {
      280 |     it('should emit set event', () => {
    > 281 |       const setSpy = jest.fn();
          |                      ^
      282 |       cache.on('set', setSpy);
      283 |       
      284 |       cache.set('key1', 'value1', 500);

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:281:22)

  ● InMemoryCache › event emission › should emit hit event

    ReferenceError: jest is not defined

      293 |
      294 |     it('should emit hit event', () => {
    > 295 |       const hitSpy = jest.fn();
          |                      ^
      296 |       cache.on('hit', hitSpy);
      297 |       
      298 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:295:22)

  ● InMemoryCache › event emission › should emit miss event

    ReferenceError: jest is not defined

      306 |
      307 |     it('should emit miss event', () => {
    > 308 |       const missSpy = jest.fn();
          |                       ^
      309 |       cache.on('miss', missSpy);
      310 |       
      311 |       cache.get('missing');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:308:23)

  ● InMemoryCache › event emission › should emit delete event

    ReferenceError: jest is not defined

      315 |
      316 |     it('should emit delete event', () => {
    > 317 |       const deleteSpy = jest.fn();
          |                         ^
      318 |       cache.on('delete', deleteSpy);
      319 |       
      320 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:317:25)

  ● InMemoryCache › event emission › should emit clear event

    ReferenceError: jest is not defined

      328 |
      329 |     it('should emit clear event', () => {
    > 330 |       const clearSpy = jest.fn();
          |                        ^
      331 |       cache.on('clear', clearSpy);
      332 |       
      333 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:330:24)

  ● InMemoryCache › event emission › should emit eviction event

    ReferenceError: jest is not defined

      339 |
      340 |     it('should emit eviction event', () => {
    > 341 |       const evictionSpy = jest.fn();
          |                           ^
      342 |       cache.on('eviction', evictionSpy);
      343 |       
      344 |       // Fill cache to capacity

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:341:27)

  ● InMemoryCache › event emission › should emit expired event

    ReferenceError: jest is not defined

      357 |
      358 |     it('should emit expired event', (done) => {
    > 359 |       const expiredSpy = jest.fn();
          |                          ^
      360 |       cache.on('expired', expiredSpy);
      361 |       
      362 |       cache.set('key1', 'value1', 50); // 50ms TTL

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:359:26)

FAIL tests/security/HMACValidator.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      10 |
      11 | // Mock Logger
    > 12 | jest.mock('../../src/logging/Logger');
         | ^
      13 | const mockLogger = {
      14 |   info: jest.fn(),
      15 |   warn: jest.fn(),

      at tests/security/HMACValidator.test.ts:12:1

FAIL tests/middleware/RateLimiter.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      11 |
      12 | // Mock dependencies
    > 13 | jest.mock('../../src/cache/CacheManager');
         | ^
      14 | jest.mock('../../src/logging/Logger');
      15 |
      16 | const mockCacheManager = {

      at tests/middleware/RateLimiter.test.ts:13:1

FAIL tests/property/AllocationEngine.property.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/TitanNotificationHandler.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       8 |
       9 | // Mock the NotificationService
    > 10 | jest.mock('../../src/server/NotificationService.js');
         | ^
      11 |
      12 | describe('TitanNotificationHandler', () => {
      13 |   let handler: TitanNotificationHandler;

      at tests/unit/TitanNotificationHandler.test.ts:10:1

PASS tests/property/PerformanceTracker.property.test.ts
FAIL tests/unit/PerformanceTracker.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      12 | // Mock DatabaseManager
      13 | const mockDb = {
    > 14 |   query: jest.fn(),
         |          ^
      15 | } as unknown as DatabaseManager;
      16 |
      17 | // Test configuration

      at tests/unit/PerformanceTracker.test.ts:14:10

FAIL tests/unit/DashboardService.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      23 | // Mock implementations
      24 | const mockAllocationEngine = {
    > 25 |   getWeights: jest.fn(),
         |               ^
      26 |   getMaxLeverage: jest.fn(),
      27 | } as unknown as AllocationEngine;
      28 |

      at tests/unit/DashboardService.test.ts:25:15

PASS tests/database/DatabaseManager.test.ts
  ● Console

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

    console.log
      ✅ Connected to PostgreSQL database

      at DatabaseManager.connect (src/db/DatabaseManager.ts:128:15)

FAIL tests/unit/db/FillsRepository.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      4 |
      5 | // Mock DatabaseManager
    > 6 | const mockQuery = jest.fn();
        |                   ^
      7 | const mockDb = {
      8 |     query: mockQuery,
      9 | } as unknown as DatabaseManager;

      at tests/unit/db/FillsRepository.test.ts:6:19

FAIL tests/server/ExecutionEngineClient.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      4 | const mockPublishEnvelope = jest.fn().mockResolvedValue(undefined);
      5 | const mockIsConnected = jest.fn().mockReturnValue(true);
    > 6 | jest.mock("@titan/shared", () => ({
        | ^
      7 |   getNatsClient: jest.fn(() => ({
      8 |     publish: mockPublish,
      9 |     publishEnvelope: mockPublishEnvelope,

      at tests/server/ExecutionEngineClient.test.ts:6:1

PASS tests/unit/accounting/PostingEngine.test.ts
FAIL tests/unit/BanditAllocator.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

PASS tests/unit/InputValidator.test.ts
PASS tests/unit/PrometheusMetrics.test.ts
PASS tests/services/accounting/PostingEngine.test.ts
FAIL tests/unit/types.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

PASS tests/services/RiskManager.test.ts
PASS tests/unit/ChangePointDetector.test.ts
FAIL tests/cache/CacheManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      18 | };
      19 |
    > 20 | jest.mock('redis', () => ({
         | ^
      21 |   createClient: jest.fn().mockImplementation(() => mockRedisClient)
      22 | }));
      23 |

      at tests/cache/CacheManager.test.ts:20:1

FAIL tests/unit/CanaryLogic.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock Logger
    >  8 | jest.mock("../../src/logging/Logger", () => {
         | ^
       9 |     return {
      10 |         Logger: {
      11 |             getInstance: jest.fn().mockReturnValue({

      at tests/unit/CanaryLogic.test.ts:8:1

FAIL tests/integration/MarketDataIngestion.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock dependencies
    >  8 | jest.mock("uuid", () => ({ v4: () => "mock-uuid" }));
         | ^
       9 |
      10 | jest.mock("@titan/shared", () => {
      11 |     const actual = jest.requireActual("@titan/shared");

      at tests/integration/MarketDataIngestion.test.ts:8:1

FAIL tests/unit/TitanBrain.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

Summary of all failing tests
FAIL tests/unit/NotificationService.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       7 |
       8 | // Mock fetch globally
    >  9 | global.fetch = jest.fn();
         |                ^
      10 |
      11 | describe('NotificationService', () => {
      12 |   let notificationService: NotificationService;

      at tests/unit/NotificationService.test.ts:9:16

FAIL tests/health/HealthManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      16 | // Mock database manager
      17 | const mockDatabaseManager = {
    > 18 |   isHealthy: jest.fn(),
         |              ^
      19 |   getMetrics: jest.fn()
      20 | };
      21 |

      at tests/health/HealthManager.test.ts:18:14

FAIL tests/performance/performance.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | import { performance } from "perf_hooks";
    > 11 | jest.mock("../../src/monitoring/index.js", () => ({
         | ^
      12 |   getLogger: () => ({
      13 |     info: jest.fn(),
      14 |     warn: jest.fn(),

      at tests/performance/performance.test.ts:11:1

FAIL tests/unit/CapitalFlowManager.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/startup/StartupManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      10 |
      11 | // Mock Logger
    > 12 | jest.mock('../../src/logging/Logger.js');
         | ^
      13 |
      14 | describe('StartupManager', () => {
      15 |   let startupManager: StartupManager;

      at tests/startup/StartupManager.test.ts:12:1

FAIL tests/services/CircuitBreaker.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | // Mock Logger
    > 11 | jest.mock('../../src/logging/Logger');
         | ^
      12 | const mockLogger = {
      13 |   info: jest.fn(),
      14 |   warn: jest.fn(),

      at tests/services/CircuitBreaker.test.ts:11:1

FAIL tests/unit/EventStore.test.ts
  ● Test suite failed to run

    Configuration error:

    Could not locate module ../../src/utils/Logger.js mapped as:
    $1.

    Please check your configuration for these entries:
    {
      "moduleNameMapper": {
        "/^(\.{1,2}\/.*)\.js$/": "$1"
      },
      "resolver": undefined
    }

      18 |
      19 | // Mock Logger to avoid dependency issues
    > 20 | jest.mock("../../src/utils/Logger.js", () => ({
         |      ^
      21 |     logger: {
      22 |         info: jest.fn(),
      23 |         error: jest.fn(),

      at createNoMappedModuleFoundError (../../node_modules/jest-resolve/build/resolver.js:759:17)
      at tests/unit/EventStore.test.ts:20:6

FAIL tests/unit/PowerLawIntegration.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/ConfigLoader.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/services/ServiceClient.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      14 |
      15 | // Mock Logger
    > 16 | jest.mock('../../src/logging/Logger');
         | ^
      17 | const mockLogger = {
      18 |   info: jest.fn(),
      19 |   warn: jest.fn(),

      at tests/services/ServiceClient.test.ts:16:1

FAIL tests/property/RiskGuardian.property.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/CircuitBreaker.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/property/SecurityAuditLogger.property.test.ts
  ● SecurityAuditLogger Property Tests › Property: All security events are logged to audit trail

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Audit trail maintains chronological order

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Threat detection patterns are consistently applied

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Alert thresholds trigger appropriate responses

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Audit log format is consistent and parseable

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

  ● SecurityAuditLogger Property Tests › Property: Security statistics accurately reflect logged events

    ReferenceError: jest is not defined

      21 |     // Mock console.error to suppress security alert spam during tests
      22 |     originalConsoleError = console.error;
    > 23 |     console.error = jest.fn();
         |                     ^
      24 |
      25 |     // Clean up test directory
      26 |     if (existsSync(testLogDir)) {

      at Object.<anonymous> (tests/property/SecurityAuditLogger.property.test.ts:23:21)

FAIL tests/unit/services/Reconciliation.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock Logger
    >  8 | jest.mock("@/logging/Logger");
         | ^
       9 | (Logger.getInstance as jest.Mock).mockReturnValue({
      10 |     info: jest.fn(),
      11 |     error: jest.fn(),

      at tests/unit/services/Reconciliation.test.ts:8:1

FAIL tests/unit/RiskGuardian.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/logging/Logger.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      21 |
      22 | // Mock fs methods
    > 23 | jest.mock('fs');
         | ^
      24 | const mockFs = fs as jest.Mocked<typeof fs>;
      25 |
      26 | describe('Logger', () => {

      at tests/logging/Logger.test.ts:23:1

FAIL tests/metrics/MetricsCollector.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       9 |
      10 | // Mock Logger
    > 11 | jest.mock('../../src/logging/Logger');
         | ^
      12 | const mockLogger = {
      13 |   info: jest.fn(),
      14 |   warn: jest.fn(),

      at tests/metrics/MetricsCollector.test.ts:11:1

FAIL tests/server/WebhookServer.hmac.test.ts
  ● WebhookServer HMAC validation › accepts a valid HMAC signature (raw body + timestamp)

    ReferenceError: jest is not defined

      22 |         }),
      23 |       }),
    > 24 |       getEquity: jest.fn().mockReturnValue(0),
         |                  ^
      25 |       getCircuitBreakerStatus: jest.fn().mockReturnValue({ active: false }),
      26 |       processSignal: jest.fn().mockResolvedValue({ approved: true, reason: "ok" }),
      27 |     } as unknown as TitanBrain;

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:24:18)

  ● WebhookServer HMAC validation › rejects a modified body with the original signature

    ReferenceError: jest is not defined

      22 |         }),
      23 |       }),
    > 24 |       getEquity: jest.fn().mockReturnValue(0),
         |                  ^
      25 |       getCircuitBreakerStatus: jest.fn().mockReturnValue({ active: false }),
      26 |       processSignal: jest.fn().mockResolvedValue({ approved: true, reason: "ok" }),
      27 |     } as unknown as TitanBrain;

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:24:18)


  ● Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'stop')

      49 |
      50 |   afterAll(async () => {
    > 51 |     await server.stop();
         |                  ^
      52 |   });
      53 |
      54 |   it("accepts a valid HMAC signature (raw body + timestamp)", async () => {

      at Object.<anonymous> (tests/server/WebhookServer.hmac.test.ts:51:18)

FAIL tests/unit/AllocationEngine.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/RiskGuardianVerification.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      17 | // Mock dependencies
      18 | const mockAllocationEngine = {
    > 19 |     getMaxLeverage: jest.fn().mockReturnValue(10), // 10x max
         |                     ^
      20 | } as unknown as AllocationEngine;
      21 |
      22 | const mockGovernanceEngine = {

      at tests/unit/RiskGuardianVerification.test.ts:19:21

FAIL tests/cache/InMemoryCache.test.ts
  ● InMemoryCache › event emission › should emit set event

    ReferenceError: jest is not defined

      279 |   describe('event emission', () => {
      280 |     it('should emit set event', () => {
    > 281 |       const setSpy = jest.fn();
          |                      ^
      282 |       cache.on('set', setSpy);
      283 |       
      284 |       cache.set('key1', 'value1', 500);

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:281:22)

  ● InMemoryCache › event emission › should emit hit event

    ReferenceError: jest is not defined

      293 |
      294 |     it('should emit hit event', () => {
    > 295 |       const hitSpy = jest.fn();
          |                      ^
      296 |       cache.on('hit', hitSpy);
      297 |       
      298 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:295:22)

  ● InMemoryCache › event emission › should emit miss event

    ReferenceError: jest is not defined

      306 |
      307 |     it('should emit miss event', () => {
    > 308 |       const missSpy = jest.fn();
          |                       ^
      309 |       cache.on('miss', missSpy);
      310 |       
      311 |       cache.get('missing');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:308:23)

  ● InMemoryCache › event emission › should emit delete event

    ReferenceError: jest is not defined

      315 |
      316 |     it('should emit delete event', () => {
    > 317 |       const deleteSpy = jest.fn();
          |                         ^
      318 |       cache.on('delete', deleteSpy);
      319 |       
      320 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:317:25)

  ● InMemoryCache › event emission › should emit clear event

    ReferenceError: jest is not defined

      328 |
      329 |     it('should emit clear event', () => {
    > 330 |       const clearSpy = jest.fn();
          |                        ^
      331 |       cache.on('clear', clearSpy);
      332 |       
      333 |       cache.set('key1', 'value1');

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:330:24)

  ● InMemoryCache › event emission › should emit eviction event

    ReferenceError: jest is not defined

      339 |
      340 |     it('should emit eviction event', () => {
    > 341 |       const evictionSpy = jest.fn();
          |                           ^
      342 |       cache.on('eviction', evictionSpy);
      343 |       
      344 |       // Fill cache to capacity

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:341:27)

  ● InMemoryCache › event emission › should emit expired event

    ReferenceError: jest is not defined

      357 |
      358 |     it('should emit expired event', (done) => {
    > 359 |       const expiredSpy = jest.fn();
          |                          ^
      360 |       cache.on('expired', expiredSpy);
      361 |       
      362 |       cache.set('key1', 'value1', 50); // 50ms TTL

      at Object.<anonymous> (tests/cache/InMemoryCache.test.ts:359:26)

FAIL tests/security/HMACValidator.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      10 |
      11 | // Mock Logger
    > 12 | jest.mock('../../src/logging/Logger');
         | ^
      13 | const mockLogger = {
      14 |   info: jest.fn(),
      15 |   warn: jest.fn(),

      at tests/security/HMACValidator.test.ts:12:1

FAIL tests/middleware/RateLimiter.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      11 |
      12 | // Mock dependencies
    > 13 | jest.mock('../../src/cache/CacheManager');
         | ^
      14 | jest.mock('../../src/logging/Logger');
      15 |
      16 | const mockCacheManager = {

      at tests/middleware/RateLimiter.test.ts:13:1

FAIL tests/property/AllocationEngine.property.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/TitanNotificationHandler.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       8 |
       9 | // Mock the NotificationService
    > 10 | jest.mock('../../src/server/NotificationService.js');
         | ^
      11 |
      12 | describe('TitanNotificationHandler', () => {
      13 |   let handler: TitanNotificationHandler;

      at tests/unit/TitanNotificationHandler.test.ts:10:1

FAIL tests/unit/PerformanceTracker.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      12 | // Mock DatabaseManager
      13 | const mockDb = {
    > 14 |   query: jest.fn(),
         |          ^
      15 | } as unknown as DatabaseManager;
      16 |
      17 | // Test configuration

      at tests/unit/PerformanceTracker.test.ts:14:10

FAIL tests/unit/DashboardService.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      23 | // Mock implementations
      24 | const mockAllocationEngine = {
    > 25 |   getWeights: jest.fn(),
         |               ^
      26 |   getMaxLeverage: jest.fn(),
      27 | } as unknown as AllocationEngine;
      28 |

      at tests/unit/DashboardService.test.ts:25:15

FAIL tests/unit/db/FillsRepository.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      4 |
      5 | // Mock DatabaseManager
    > 6 | const mockQuery = jest.fn();
        |                   ^
      7 | const mockDb = {
      8 |     query: mockQuery,
      9 | } as unknown as DatabaseManager;

      at tests/unit/db/FillsRepository.test.ts:6:19

FAIL tests/server/ExecutionEngineClient.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      4 | const mockPublishEnvelope = jest.fn().mockResolvedValue(undefined);
      5 | const mockIsConnected = jest.fn().mockReturnValue(true);
    > 6 | jest.mock("@titan/shared", () => ({
        | ^
      7 |   getNatsClient: jest.fn(() => ({
      8 |     publish: mockPublish,
      9 |     publishEnvelope: mockPublishEnvelope,

      at tests/server/ExecutionEngineClient.test.ts:6:1

FAIL tests/unit/BanditAllocator.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/unit/types.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)

FAIL tests/cache/CacheManager.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

      18 | };
      19 |
    > 20 | jest.mock('redis', () => ({
         | ^
      21 |   createClient: jest.fn().mockImplementation(() => mockRedisClient)
      22 | }));
      23 |

      at tests/cache/CacheManager.test.ts:20:1

FAIL tests/unit/CanaryLogic.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock Logger
    >  8 | jest.mock("../../src/logging/Logger", () => {
         | ^
       9 |     return {
      10 |         Logger: {
      11 |             getInstance: jest.fn().mockReturnValue({

      at tests/unit/CanaryLogic.test.ts:8:1

FAIL tests/integration/MarketDataIngestion.test.ts
  ● Test suite failed to run

    ReferenceError: jest is not defined

       6 |
       7 | // Mock dependencies
    >  8 | jest.mock("uuid", () => ({ v4: () => "mock-uuid" }));
         | ^
       9 |
      10 | jest.mock("@titan/shared", () => {
      11 |     const actual = jest.requireActual("@titan/shared");

      at tests/integration/MarketDataIngestion.test.ts:8:1

FAIL tests/unit/TitanBrain.test.ts
  ● Test suite failed to run

    SyntaxError: The requested module './allocation.js' does not provide an export named 'AllocationEngineConfig'

      at Runtime.linkAndEvaluateModule (../../node_modules/jest-runtime/build/index.js:708:5)


Test Suites: 35 failed, 11 passed, 46 total
Tests:       15 failed, 133 passed, 148 total
Snapshots:   0 total
Time:        1.539 s, estimated 21 s
Ran all test suites.
npm error Lifecycle script `test:unit` failed with error:
npm error code 1
npm error path /Users/ivan/Code/trading/titan/services/titan-brain
npm error workspace titan-brain@1.0.0
npm error location /Users/ivan/Code/trading/titan/services/titan-brain
npm error command failed
npm error command sh -c NODE_OPTIONS=--experimental-vm-modules jest --config jest.config.cjs
