{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Titan Trading System Documentation","text":"<p>Version: 2030 Standard Status: Canonical</p>"},{"location":"#core-system-truth-start-here","title":"\ud83e\udde0 Core System Truth (Start Here)","text":"<p>These documents form the immutable foundation of the system.</p> <ul> <li>system-source-of-truth.md \u2014 The Bible. If code disagrees with this doc, code is wrong (or this doc is stale).</li> <li>ai-readme.md \u2014 \ud83e\udd16 AGENTS START HERE. Zero-shot context and navigation instructions.</li> <li>knowledge-graph.md \u2014 Map of Concepts &lt;-&gt; Code.</li> <li>architecture.md \u2014 High-level organism design, data flow, and \"Bio-Mimetic\" principles.</li> <li>security.md \u2014 AuthZ, Secrets, Threat Model (Panic-on-miss).</li> </ul>"},{"location":"#concepts-guides","title":"\ud83d\udca1 Concepts &amp; Guides","text":"<ul> <li>High Availability \u2014 Strategy for 99.99% uptime.</li> <li>Execution Routing \u2014 How orders reach the exchange.</li> <li>Quality Gates \u2014 CI/CD standards.</li> <li>Legal \u2014 Compliance notes.</li> </ul>"},{"location":"#operations-deployment","title":"\ud83d\udee0 Operations &amp; Deployment","text":"<p>How to run, deploy, and keep it alive.</p> <ul> <li>OPERATIONS \u2014 Dashboards, Metrics, Monitoring, Troubleshooting.</li> <li>deployment-standard.md \u2014 The \"Dull Standard\" for prod. Docker Compose specs.</li> <li>PROVISIONING \u2014 DigitalOcean infrastructure setup.</li> <li>RUNBOOKS \u2014 \"When X happens, do Y\". Incident response procedure.</li> </ul>"},{"location":"#references-specifications","title":"\ud83d\udcda References &amp; Specifications","text":"<p>Deep dives into specific components.</p> <ul> <li>REFERENCE \u2014 API specs, NATS subject maps, Schema catalogs.</li> <li>CONTRACTS \u2014 Immutable data contracts and interface definitions.</li> <li>DESIGN SYSTEM \u2014 UI/UX principles and component library.</li> <li>TLA+ SPECS \u2014 Formal verification models.</li> </ul>"},{"location":"#component-documentation","title":"\ud83e\udde9 Component Documentation","text":"<p>For deeper implementation details, see local READMEs:</p>"},{"location":"#core-services","title":"\ud83e\udde0 Core Services","text":"<ul> <li>Brain: titan-brain.md</li> <li>Execution: titan-execution-rs.md</li> <li>Shared Lib: shared.md</li> </ul>"},{"location":"#strategy-phase-services-the-organs","title":"\ud83d\udd75\ufe0f Strategy Phase Services (The \"Organs\")","text":"<ul> <li>Phase 1: Scavenger: titan-phase1-scavenger.md</li> <li>Phase 2: Hunter: titan-phase2-hunter.md</li> <li>Phase 3: Sentinel: titan-phase3-sentinel.md</li> </ul>"},{"location":"#labs-support","title":"\ud83e\uddea Labs &amp; Support","text":"<ul> <li>PowerLaw Lab: titan-powerlaw-lab.md</li> <li>AI Quant: titan-ai-quant.md</li> <li>Ops Daemon: titan-opsd.md</li> <li>Console API: titan-console-api.md</li> </ul>"},{"location":"#frontend","title":"\ud83d\udda5\ufe0f Frontend","text":"<ul> <li>Console: titan-console.md</li> </ul>"},{"location":"#development-contribution","title":"\ud83c\udfd7\ufe0f Development &amp; Contribution","text":"<ul> <li>Contribution Guide \u2014 How to propose changes.</li> <li>Repo Structure \u2014 Where does code live?</li> <li>Testing Strategy \u2014 How to run tests.</li> <li>Integration Verification \u2014 End-to-end verification.</li> <li>Configuration \u2014 Environment variables guide.</li> </ul>"},{"location":"#risk-security","title":"\ud83d\udee1\ufe0f Risk &amp; Security","text":"<ul> <li>Risk Policy \u2014 The mathematical laws of safety.</li> <li>Circuit Breakers \u2014 Automated shutoff thresholds.</li> <li>Redis Security \u2014 securing the cache.</li> <li>Infrastructure Setup \u2014 Provisioning guide.</li> </ul>"},{"location":"#architecture-rfcs","title":"\ud83c\udfdb\ufe0f Architecture &amp; RFCs","text":"<ul> <li>Decision Loop \u2014 How the Brain thinks.</li> <li>Execution Engine \u2014 Rust-based execution.</li> <li>Research \u2014 AI Model implementation.</li> <li>Alpha Workflow \u2014 How to add new alpha.</li> <li>RFCs \u2014 Request for Comments.</li> <li>Connectivity Demo \u2014 Connection verification.</li> <li>Phases \u2014 Strategy phase breakdown.</li> </ul>"},{"location":"#launch-ci","title":"\ud83d\ude80 Launch &amp; CI","text":"<ul> <li>Launch Checklist \u2014 Go-live procedure.</li> <li>Branch Protection \u2014 Git rules.</li> </ul>"},{"location":"#connectivity-topology","title":"\ud83d\udd17 Connectivity &amp; Topology","text":"<ul> <li>Schemas \u2014 Data structure definitions.</li> <li>NATS Topology \u2014 Event bus graph.</li> </ul>"},{"location":"CONTRIBUTING/","title":"Contributing to Titan","text":"<p>Strict Adherence Required: This repository enforces high-assurance engineering standards. All contributions must pass the SOTA (State-of-the-Art) Quality Gates.</p>"},{"location":"CONTRIBUTING/#1-the-titan-philosophy","title":"1. The Titan Philosophy","text":"<p>We treat the codebase like a Formula 1 car\u2014it must be clean, light, and reliable.</p> <ul> <li>Zero Dead Code: If it's not used, it's deleted.</li> <li>Zero Flakiness: Flaky tests are bugs.</li> <li>Immutability: Functional patterns over state mutation.</li> </ul>"},{"location":"CONTRIBUTING/#2-agent-coding-rules-strict-compliance","title":"2. Agent Coding Rules (Strict Compliance)","text":"<p>You are an advanced AI engineer. You MUST follow these rules when writing code for this repository.</p>"},{"location":"CONTRIBUTING/#functional-programming-immutability","title":"Functional Programming &amp; Immutability","text":"<ul> <li>NEVER use <code>let</code>. Use <code>const</code> for everything.</li> <li>NEVER use mutator methods like <code>push</code>, <code>pop</code>, <code>splice</code>, <code>shift</code>, <code>unshift</code>, <code>sort</code>, <code>reverse</code>.</li> <li>BAD: <code>arr.push(item)</code></li> <li>GOOD: <code>const newArr = [...arr, item]</code></li> <li>NEVER mutate object properties directly.</li> <li>BAD: <code>obj.prop = value</code></li> <li>GOOD: <code>const newObj = { ...obj, prop: value }</code></li> <li>NEVER use <code>delete</code>.</li> <li>BAD: <code>delete obj.prop</code></li> <li>GOOD: <code>const { prop, ...rest } = obj</code></li> <li>Maps/Sets: Treat them as immutable where possible, or encapsulate strictly.</li> </ul>"},{"location":"CONTRIBUTING/#type-safety","title":"Type Safety","text":"<ul> <li>NEVER use <code>any</code>. Use <code>unknown</code> if necessary, or define a type.</li> <li>ALWAYS define return types for functions.</li> <li>ALWAYS handle null/undefined explicitly.</li> </ul>"},{"location":"CONTRIBUTING/#complexity","title":"Complexity","text":"<ul> <li>Modules: Keep files under 200 lines. Break large logic into sub-modules or strategy patterns.</li> <li>Functions: Keep functions simple. Cyclomatic complexity should be &lt; 10.</li> <li>No God Classes: If you touch a &gt;400 LOC file, extract at least one function.</li> </ul>"},{"location":"CONTRIBUTING/#architecture","title":"Architecture","text":"<ul> <li>Dependency Inspection: Always check dependencies in <code>package.json</code> before importing.</li> <li>Circular Dependencies: Do not create circular imports. Use interfaces or dependency injection.</li> </ul>"},{"location":"CONTRIBUTING/#3-sota-toolchain-quality-gates","title":"3. SOTA Toolchain (Quality Gates)","text":"<p>We use a \"State-of-the-Art\" (SOTA) script suite to enforce quality.</p> Command Purpose When to Use <code>npm run sota:all</code> Full Verification. Runs all gates. MANDATORY before PR/Commit. <code>npm run sota:circular</code> Circular Dependency Guard. When adding new imports across service boundaries. <code>npm run sota:arch</code> Architecture Fitness. Enforces layer rules. When creating new modules. <code>npm run sota:dead</code> Dead Code Scanner. When performing cleanup or after major deletions. <code>npm run sota:zombie</code> Zombie Dependency Scan. When updating <code>package.json</code> deps. <code>npm run sota:secrets</code> Secret Scanner. MANDATORY before creating artifacts/pushing code. <code>npm run sota:flake</code> Flakiness Detector. When a test fails \"randomly\". <code>npm run sota:impact</code> Smart Testing. To verify your changes quickly."},{"location":"CONTRIBUTING/#4-remediation-qa-protocol","title":"4. Remediation &amp; QA Protocol","text":""},{"location":"CONTRIBUTING/#zero-behavior-change-rule-for-auto-fixes","title":"Zero Behavior Change Rule for Auto-Fixes","text":"<p>Automated tools (<code>eslint --fix</code>, <code>prettier</code>, etc.) must only be used for:</p> <ul> <li>Formatting (whitespace, indentation).</li> <li>Removing definitely unused imports/variables (verified by <code>tsc</code>).</li> <li>Syntactic sugar that preserves AST semantics.</li> </ul> <p>FORBIDDEN Auto-Fixes:</p> <ul> <li>Changing control flow (loops to map/reduce).</li> <li>Modifying logic inside Risk Gates or Order Lifecycle.</li> <li>Reordering side-effecting calls.</li> </ul>"},{"location":"CONTRIBUTING/#behavioral-diff-requirement","title":"Behavioral Diff Requirement","text":"<p>Any Pull Request touching the following areas must include a \"Behavioral Diff\" section in the description:</p> <ul> <li>Risk Gates: <code>services/titan-brain/src/risk/**/*.ts</code></li> <li>Order Lifecycle: <code>services/titan-brain/src/orders/**/*.ts</code></li> <li>Reconciliation: <code>services/titan-brain/src/recon/**/*.ts</code></li> <li>Allocations: <code>services/titan-execution-rs/**/*.rs</code></li> </ul>"},{"location":"CONTRIBUTING/#sota-release-criteria","title":"SOTA Release Criteria","text":"<p>A release candidate is accepted ONLY IF:</p> <ol> <li><code>npm run sota:all</code> passes (Exit Code 0).</li> <li>No new High/Critical vulnerabilities in <code>sota:deps</code> / <code>sota:audit</code>.</li> <li><code>sota:perf</code> confirms no regression &gt; 5% in latency.</li> <li><code>sota:correctness</code> passes (Idempotency and Contract checks).</li> </ol>"},{"location":"CONTRIBUTING/#emergency-override","title":"Emergency Override","text":"<p>If a gate must be bypassed for a hotfix:</p> <ol> <li>Open an issue titled <code>[QA-OVERRIDE] &lt;Reason&gt;</code>.</li> <li>Commit with trailer <code>Qa-Override: #issue-id</code>.</li> <li>Schedule immediate tech-debt task to fix the gate.</li> </ol>"},{"location":"CONTRIBUTING/#5-documentation-style-guide","title":"5. Documentation Style Guide","text":""},{"location":"CONTRIBUTING/#voice-tone","title":"Voice &amp; Tone","text":"<ul> <li>Voice: Professional, direct, and active. \"Configure the bot\" instead of \"The bot should be configured.\"</li> <li>Tense: Present tense. \"The system runs...\" (not \"will run\").</li> <li>Audience: Operators and Engineers. Assume competence but not context.</li> <li>No Fluff: Avoid \"Please\", \"Simply\", \"Just\".</li> </ul>"},{"location":"CONTRIBUTING/#formatting","title":"Formatting","text":"<ul> <li>Headings: Sentence case (<code># How to deploy</code>).</li> <li>Code Blocks: Always specify language (<code>bash</code>, <code>ts</code>).</li> <li>Admonitions: Use GitHub-style alerts (<code>&gt; [!NOTE]</code>).</li> <li>Links: Use relative paths.</li> </ul>"},{"location":"SECURITY/","title":"Security &amp; Compliance","text":"<p>Context: Security Policy &amp; Implementation See Also: Risk Policy, Knowledge Graph Status: Canonical Authority: Titan Security Lead</p>"},{"location":"SECURITY/#supported-versions","title":"Supported Versions","text":"Version Supported main :white_check_mark: &lt; main :x:"},{"location":"SECURITY/#1-core-principles","title":"1. Core Principles","text":"<ul> <li>Zero Trust: No service trusts another by default. All NATS traffic is authenticated.</li> <li>Fail-Closed: If a secret is missing (e.g., <code>HMAC_SECRET</code>), the system panic-crashes.</li> <li>Least Privilege: Services have granular NATS ACLs (e.g., Hunter cannot punish risk).</li> </ul>"},{"location":"SECURITY/#2-authorization-acls-nats","title":"2. Authorization &amp; ACLs (NATS)","text":""},{"location":"SECURITY/#service-identities","title":"Service Identities","text":"<p>Each service has a distinct user in <code>config/nats.conf</code>.</p> User Role Permissions <code>brain</code> Orchestrator Full Access (<code>&gt;</code>) <code>execution</code> Motor Control Sub: <code>cmd.execution.&gt;</code>, Pub: <code>evt.execution.&gt;</code> <code>scavenger</code> Strategy Pub: <code>evt.scavenger.&gt;</code>, No Risk Control"},{"location":"SECURITY/#enforcement","title":"Enforcement","text":"<ul> <li>Network: NATS 2.0 Auth (User/Pass + ACLs).</li> <li>Application: Brain rejects commands from wrong source IDs in envelopes.</li> </ul>"},{"location":"SECURITY/#3-secrets-management","title":"3. Secrets Management","text":""},{"location":"SECURITY/#critical-secrets","title":"Critical Secrets","text":"Secret Purpose Rotation Policy <code>HMAC_SECRET</code> Signing inter-service commands (Brain &lt;-&gt; Exec) Quarterly <code>TITAN_MASTER_PASSWORD</code> Operator sudo command authorization Quarterly <code>BYBIT_API_KEY</code> Exchange access On-compromise"},{"location":"SECURITY/#injection","title":"Injection","text":"<ul> <li>Production: Injected via CI/CD into container <code>.env</code>.</li> <li>Local: <code>.env</code> file (gitignored).</li> </ul>"},{"location":"SECURITY/#4-threat-model","title":"4. Threat Model","text":""},{"location":"SECURITY/#attack-vectors","title":"Attack Vectors","text":"<ol> <li>Compromised NATS: Attacker can spoof signals.<ul> <li>Mitigation: NATS ACLs prevent <code>hunter</code> from publishing <code>titan.cmd.execute</code>.</li> </ul> </li> <li>Compromised Brain: Attacker can drain funds.<ul> <li>Mitigation: Execution-RS RiskGuard (Max Daily Loss) is hard-coded/config-locked.</li> </ul> </li> <li>Supply Chain: Malicious dependency.<ul> <li>Mitigation: <code>npm audit</code>, <code>cargo audit</code>, pinned versions.</li> </ul> </li> </ol>"},{"location":"SECURITY/#5-authentication-authorization-standards","title":"5. Authentication &amp; Authorization Standards","text":"<ul> <li>JWT Authentication: Shared secret (HMAC-SHA256).</li> <li>Role-Based Access Control (RBAC): All operations require appropriate role.</li> <li>HMAC-SHA256 Signed Commands: Privileged operations use signed command paths.</li> <li>Future Roadmap: OAuth 2.1 with PKCE.</li> </ul>"},{"location":"SECURITY/#credential-management","title":"Credential Management","text":"<ul> <li>Zero-secret storage in client applications.</li> <li>AES-256-GCM encryption for credentials at rest.</li> <li>Immutable audit logging for all credential access.</li> <li>Automatic key rotation policies.</li> </ul>"},{"location":"SECURITY/#infrastructure-security","title":"Infrastructure Security","text":"<ul> <li>All services communicate over encrypted channels (TLS 1.3).</li> <li>Container isolation for all microservices.</li> <li>Network segmentation between trading and control plane components.</li> <li>Regular security scanning and dependency auditing.</li> </ul>"},{"location":"SECURITY/#code-security","title":"Code Security","text":"<ul> <li>Automated SAST (Static Application Security Testing) in CI.</li> <li>Dependency vulnerability scanning (<code>npm audit</code>, <code>cargo audit</code>, <code>govulncheck</code>).</li> <li>SBOM (Software Bill of Materials) generation.</li> <li>License compliance verification.</li> </ul>"},{"location":"SECURITY/#6-reporting-a-vulnerability","title":"6. Reporting a Vulnerability","text":"<p>Please do not report security vulnerabilities through public GitHub issues.</p>"},{"location":"SECURITY/#how-to-report","title":"How to Report","text":"<ol> <li>Email: Send a detailed report to security@peycheff.com</li> <li>Subject Line: Use <code>[SECURITY] Titan Vulnerability Report</code> as the subject</li> <li>Encrypt (optional): If you need to share sensitive details, request our PGP key</li> </ol>"},{"location":"SECURITY/#what-to-include","title":"What to Include","text":"<ul> <li>Type of vulnerability (e.g., credential exposure, authentication bypass, injection, etc.)</li> <li>Full paths of source file(s) related to the vulnerability</li> <li>Location of the affected source code (tag/branch/commit or direct URL)</li> <li>Step-by-step instructions to reproduce the issue</li> <li>Proof-of-concept or exploit code (if possible)</li> <li>Impact assessment of the vulnerability</li> <li>Any potential mitigations you've identified</li> </ul>"},{"location":"SECURITY/#response-timeline","title":"Response Timeline","text":"Action Timeline Initial acknowledgment Within 48 hours Initial assessment Within 7 days Status update Every 7 days until resolution Fix release Based on severity (Critical: 24-72h, High: 7 days, Medium: 30 days)"},{"location":"SECURITY/#7-scope","title":"7. Scope","text":""},{"location":"SECURITY/#in-scope","title":"In Scope","text":"<ul> <li>Titan monorepo codebase and all services</li> <li>HELM Control Room and Console API</li> <li>Trading connectors and venue integrations</li> <li>Authentication and credential management systems</li> <li>CI/CD pipeline security</li> </ul>"},{"location":"SECURITY/#out-of-scope","title":"Out of Scope","text":"<ul> <li>Third-party exchange/venue security issues</li> <li>Social engineering attacks</li> <li>Physical security</li> <li>Denial of service attacks (please report, but lower priority)</li> </ul>"},{"location":"SECURITY/#8-disclosure-policy","title":"8. Disclosure Policy","text":"<ol> <li>Reporter submits vulnerability</li> <li>We acknowledge and begin investigation</li> <li>We develop and test a fix</li> <li>We coordinate disclosure timing with the reporter</li> <li>We release the fix and publish a security advisory</li> <li>Reporter may publish their findings after the advisory</li> </ol>"},{"location":"SECURITY/#security-updates","title":"Security Updates","text":"<p>Security updates are published via: - GitHub Security Advisories - Release notes with <code>[SECURITY]</code> tag - Direct notification to affected users (for critical issues)</p> <p>Thank you for helping keep Titan Trading System and its users secure.</p>"},{"location":"ai-readme/","title":"AI Agent Instructions","text":"<p>READ THIS FIRST.</p> <p>If you are an AI agent or autonomous coding assistant, this document is your Operating System. It defines how you should navigate, modify, and verify the Titan Trading System.</p>"},{"location":"ai-readme/#1-navigation-protocol","title":"1. Navigation Protocol","text":"<ul> <li>Global Map: Always check <code>docs/knowledge-graph.md</code> first to locate files.</li> <li>Source of Truth: <code>docs/system-source-of-truth.md</code> overrides ALL other documents. If code conflicts with it, the code is likely wrong (or the doc needs updating).</li> <li>Service Context: Every service has a <code>README.md</code> in its root (e.g., <code>services/titan-brain/README.md</code>). Use these only to find the canonical docs link.</li> </ul>"},{"location":"ai-readme/#2-coding-standards-the-sota-standard","title":"2. Coding Standards (The \"SOTA\" Standard)","text":"<p>\"Dull is good. Boring is reliable.\"</p> <ul> <li>Strict Types: No <code>any</code>. No <code>// @ts-ignore</code> without an essay-length justification.</li> <li>Fail-Closed: If a secret is missing, crash. If a signature is invalid, reject. Never fallback to \"insecure mode\".</li> <li>Evidence-Based: Never change code based on a guess. grep first. <code>npm test</code> after.</li> <li>Canonical Deps: Use <code>npm install</code> at the root. Do not manually edit <code>package.json</code> versions unless necessary.</li> </ul>"},{"location":"ai-readme/#3-invariants-do-not-break","title":"3. Invariants (Do Not Break)","text":"<ol> <li>Risk Policy: <code>packages/shared/risk_policy.json</code> must be identical to <code>services/titan-execution-rs/src/risk_policy.json</code>.</li> <li>Immutability: Do not modify <code>metrics/</code> manually.</li> <li>Ports: See <code>docs/system-source-of-truth.md</code> for the canonical port map.</li> </ol>"},{"location":"ai-readme/#4-verification-workflow","title":"4. Verification Workflow","text":"<p>Before reporting a task as \"Done\":</p> <ol> <li>Lint: <code>npm run lint:fix</code></li> <li>Test: <code>npm test</code> (or specific service test)</li> <li>Build: <code>npm run build</code> (if structural changes)</li> <li>Docs: <code>npm run lint:docs</code> (if you touched .md files)</li> </ol>"},{"location":"ai-readme/#5-emergency-contacts","title":"5. Emergency Contacts","text":"<ul> <li>Logs: <code>pm2 logs</code></li> <li>Config Check: <code>npm run validate:config</code></li> <li>SOTA Check: <code>npm run sota:all</code></li> </ul>"},{"location":"architecture/","title":"Architecture: The Titan Organism","text":"<p>Context: High-Level System Design See Also: Knowledge Graph, Source of Truth Status: Canonical Authority: Titan Lead Architect Model: Bio-Mimetic Active Inference</p>"},{"location":"architecture/#1-high-level-concept","title":"1. High Level Concept","text":"<p>Titan is not a \"bot\"; it is an autonomous Trading Organism. It is designed around the principles of Active Inference (Free Energy Principle), where the system constantly models external reality (markets) and acts to minimize the divergence between its model and its goals (profit, survival).</p> <p>The system is composed of specialized organs (services) that communicate via a central nervous system (NATS JetStream).</p>"},{"location":"architecture/#11-the-prime-directive-survival","title":"1.1 The Prime Directive: Survival","text":"<p>Unlike traditional algos that maximize PnL, Titan maximizes Survival (Capital Preservation) first, and PnL second.</p> <ul> <li>Risk First: If the \"Truth Layer\" (reconciliation) degrades, the organism freezes.</li> <li>Fail-Closed: Missing signals or broken contracts result in a safe halting state.</li> </ul>"},{"location":"architecture/#2-anatomy-topology","title":"2. Anatomy (Topology)","text":"<pre><code>graph TD\n    subgraph \"Sense Organs (Strategy)\"\n        P1[Scavenger&lt;br/&gt;Trap/Scalp]\n        P2[Hunter&lt;br/&gt;Holographic]\n        P3[Sentinel&lt;br/&gt;Arbitrage]\n        P4[AI Quant&lt;br/&gt;Research]\n    end\n\n    subgraph \"Central Nervous System\"\n        NATS[NATS JetStream&lt;br/&gt;Event Bus]\n    end\n\n    subgraph \"Cortex (Decision)\"\n        BRAIN[Titan Brain&lt;br/&gt;Active Inference]\n    end\n\n    subgraph \"Motor Control (Action)\"\n        EXEC[Execution-RS&lt;br/&gt;Rust Engine]\n    end\n\n    P1 &amp; P2 &amp; P3 &amp; P4 --&gt;|Signals| NATS\n    NATS --&gt;|Events| BRAIN\n    BRAIN --&gt;|Intents| NATS\n    NATS --&gt;|Commands| EXEC\n    EXEC --&gt;|Fills| NATS</code></pre>"},{"location":"architecture/#21-the-organs","title":"2.1 The Organs","text":""},{"location":"architecture/#titan-brain-the-cortex","title":"Titan Brain (The Cortex)","text":"<ul> <li>Stack: TypeScript, Active Inference.</li> <li>Role: State aggregation, Allocation, High-Level Decision Making.</li> <li>Behavior: It listens to all signals, updates its internal \"Belief State\" (Market Regime, Volatility), and decides if and how much capital to allocate to a strategy's intent. It acts as the \"Risk Governor\".</li> </ul>"},{"location":"architecture/#execution-rs-motor-control","title":"Execution-RS (Motor Control)","text":"<ul> <li>Stack: Rust, Actix, Redb.</li> <li>Role: Low-latency execution, position management, exchange connectivity.</li> <li>Behavior: It is \"dumb\" but fast and safe. It executes commands signed by the Brain. It maintains the \"Shadow State\" (local truth) and reconciles it with the Exchange. It houses the Circuit Breakers.</li> </ul>"},{"location":"architecture/#strategies-the-senses","title":"Strategies (The Senses)","text":"<ul> <li>Phase 1: Scavenger: High-frequency, low-capital \"Trap\" system. Detects short-term inefficiencies.</li> <li>Phase 2: Hunter: Holographic market structure analysis. Detects medium-term trends.</li> <li>Phase 3: Sentinel: Delta-neutral arbitrage. Low risk, steady yield.</li> <li>AI Quant: Offline (and near-realtime) optimization engine using Gemini 2.0 Flash to evolve parameters.</li> </ul>"},{"location":"architecture/#3-the-nervous-system-nats-jetstream","title":"3. The Nervous System (NATS JetStream)","text":"<p>Communication is asynchronous and event-driven, but strictly typed.</p> <ul> <li>Commands (<code>titan.cmd.&gt;</code>): Directives to do something.</li> <li><code>titan.cmd.execution.place.v1</code>: Place an order.</li> <li><code>titan.cmd.sys.halt.v1</code>: HALT trading.</li> <li>Events (<code>titan.evt.&gt;</code>): Facts that occurred.</li> <li><code>titan.evt.execution.fill.v1</code>: An order was filled.</li> <li><code>titan.evt.scavenger.signal.v1</code>: A strategy saw something.</li> <li>Data (<code>titan.data.&gt;</code>): Ephemeral telemetry (tickers, metrics).</li> </ul> <p>Invariant: The stream is the \"Journal of Record\". Only if an event is persisted in JetStream did it \"happen\".</p>"},{"location":"architecture/#4-the-loop-how-it-trades","title":"4. The Loop (How it Trades)","text":"<ol> <li>Sensing: A Strategy (e.g., Hunter) detects a pattern. It publishes a <code>Signal</code> (Event) via NATS.</li> <li>Perception: Brain consumes the <code>Signal</code>. It checks:<ul> <li>Is the signal valid?</li> <li>Does this align with the current Regime (e.g., \"Bullish Trend\")?</li> <li>Do we have budget?</li> </ul> </li> <li>Action Selection: Brain generates a <code>Trade Intent</code>. It signs it with <code>HMAC_SECRET</code>.</li> <li>Transmission: The Intent is published as a <code>Command</code> to Execution.</li> <li>Validation: Execution-RS receives the Command. It verifies:<ul> <li>Signature (Security).</li> <li>Risk Limits (Policy).</li> <li>Circuit Breaker State.</li> </ul> </li> <li>Actuation: Execution-RS sends HTTP/WS request to the target Exchange (17 supported: Binance, Bybit, OKX, Coinbase, Kraken, KuCoin, Gate.io, MEXC, Crypto.com, dYdX, Uniswap, PancakeSwap, SushiSwap, Curve, Jupiter, GMX, Hyperliquid).</li> <li>Feedback: Exchange confirms Fill. Execution-RS publishes <code>FillEvent</code>.</li> <li>Learning: Brain records the outcome. AI Quant later analyzes this for optimization.</li> </ol>"},{"location":"architecture/#5-risk-immune-system","title":"5. Risk Immune System","text":"<p>Titan treats risk as a pathogen. The Immune System has 3 layers:</p> <ol> <li>Strategic Layer (Brain):<ul> <li>Max Allocation per Phase.</li> <li>Correlation penalties (don't go long BTC and ETH if correlation &gt; 0.7).</li> </ul> </li> <li>Transactional Layer (Execution RiskGuard):<ul> <li>Pre-trade checks (Max Leverage, Max Notional).</li> <li>Rate Limits.</li> </ul> </li> <li>Circuit Breakers (Reflexes):<ul> <li>Daily Drawdown: 50% of limit consumed \u2192 Cautious (0.5\u00d7 sizing). 75% consumed \u2192 Defensive (no new positions). Max daily loss breached \u2192 Emergency (flatten all).</li> <li>Consecutive Loss: Stop Phase after N failures.</li> <li>Drift: If Local State != Exchange State \u2192 Emergency (flatten all).</li> </ul> </li> </ol>"},{"location":"architecture/#6-truth-layer-reconciliation","title":"6. Truth Layer (Reconciliation)","text":"<p>We do not trust the exchange blindly. We maintain a \"Shadow State\" (Redb) in Execution-RS. Every minute, we perform a defined \"Reconciliation Handshake\":</p> <ul> <li><code>Local State</code> vs <code>Exchange State</code></li> <li>Discrepancy &gt; Tolerance? -&gt; Safety Halt.</li> </ul>"},{"location":"deployment-standard/","title":"Production Deployment Guide","text":"<p>Status: SOTA (State of the Art) Target: Cloud Agnostic (DigitalOcean, Railway, AWS, etc.)</p>"},{"location":"deployment-standard/#1-principles","title":"1. Principles","text":"<ul> <li>Container First: All services run as Docker containers.</li> <li>Environment Driven: Configuration via 12-factor environment variables.</li> <li>Zero Trust: Services do not trust the network; all inter-service comms are authenticated.</li> </ul>"},{"location":"deployment-standard/#2-supported-platforms","title":"2. Supported Platforms","text":"<p>The system adapts to its environment via the <code>PlatformFactory</code>:</p>"},{"location":"deployment-standard/#digitalocean-recommended","title":"DigitalOcean (Recommended)","text":"<ul> <li>Type: Docker Droplet or App Platform.</li> <li>Config: Standard <code>docker-compose.yml</code>.</li> <li>Networking: Host networking or Bridge.</li> </ul>"},{"location":"deployment-standard/#generic-cloud-railway-heroku-render","title":"Generic Cloud (Railway, Heroku, Render)","text":"<ul> <li>Type: PaaS / Cloud Native.</li> <li>Detection: Automatically detects <code>PORT</code> and environment signals (e.g., <code>RAILWAY_ENVIRONMENT</code>).</li> <li>Networking: Binds to <code>0.0.0.0</code> on the assigned <code>PORT</code>.</li> </ul>"},{"location":"deployment-standard/#3-deployment-steps","title":"3. Deployment Steps","text":""},{"location":"deployment-standard/#production","title":"Production","text":"<ol> <li>Build: <code>docker build -t titan-brain .</code></li> <li>Configure: Set env vars (see <code>system-source-of-truth.md</code>).</li> <li>Run: <code>./scripts/ops/deploy_prod.sh</code></li> </ol>"},{"location":"deployment-standard/#staging-micro-capital","title":"Staging (Micro-Capital)","text":"<p>Uses <code>docker-compose.micro.yml</code> \u2014 optimised for $50\u2013$100 test deployment with minimal resources.</p> <ol> <li>Deploy: <code>./scripts/ops/deploy_staging.sh</code></li> <li>Required Env Vars (or defaults applied):</li> <li><code>HMAC_SECRET</code> \u2014 HMAC signing key (defaults to staging placeholder)</li> <li><code>SAFETY_SECRET</code> \u2014 Safety session key (defaults to staging placeholder)</li> <li><code>BINANCE_API_KEY</code> / <code>BINANCE_API_SECRET</code> \u2014 Exchange credentials</li> <li><code>BYBIT_API_KEY</code> / <code>BYBIT_API_SECRET</code> \u2014 Exchange credentials</li> <li><code>POSTGRES_PASSWORD</code> \u2014 Database password (defaults to <code>password</code>)</li> <li>Services: postgres, redis, nats, titan-brain, titan-execution, titan-scavenger, titan-hunter, titan-sentinel</li> </ol>"},{"location":"deployment-standard/#4-verification","title":"4. Verification","text":"<ul> <li>curl <code>/health</code> to verify <code>UP</code>.</li> <li><code>docker ps</code> \u2014 all titan containers should show <code>healthy</code> or <code>Up</code>.</li> <li>Check logs for \"Platform Adapter: [Name]\".</li> </ul>"},{"location":"knowledge-graph/","title":"Titan Knowledge Graph","text":"<p>Purpose: This file maps high-level concepts to their concrete implementation files. Use this to quickly find the code responsible for a specific feature or domain.</p> Domain Concept Implementation File Documentation Orchestration Brain Service Entry <code>services/titan-brain/src/index.ts</code> <code>docs/components/titan-brain.md</code> Signal Processing <code>services/titan-brain/src/flow/Signalprocessor.ts</code> Circuit Breaker (State) <code>services/titan-brain/src/risk/CircuitBreaker.ts</code> <code>docs/risk/circuit_breakers.md</code> Database Schema <code>services/titan-brain/src/db/schema.sql</code> Execution Execution Engine Entry <code>services/titan-execution-rs/src/main.rs</code> <code>services/titan-execution-rs/README.md</code> Order Placement <code>services/titan-execution-rs/src/main.rs</code> <code>docs/explanation/execution-routing.md</code> Risk Guard (Rust) <code>services/titan-execution-rs/src/risk_guard.rs</code> HMAC Verification <code>services/titan-execution-rs/src/security.rs</code> <code>docs/security.md</code> Rate Limiting <code>services/titan-execution-rs/src/rate_limiter.rs</code> <code>docs/system-source-of-truth.md</code> Strategy Phase 1 (Scavenger) <code>services/titan-phase1-scavenger/src/index.tsx</code> Phase 2 (Hunter) <code>services/titan-phase2-hunter/src/index.ts</code> Phase 3 (Sentinel) <code>services/titan-phase3-sentinel/src/index.tsx</code> Risk Policy (Canonical) <code>packages/shared/risk_policy.json</code> <code>docs/risk/risk_policy.md</code> Infrastructure Docker Compose (Prod) <code>docker-compose.prod.yml</code> <code>docs/deployment-standard.md</code> NATS Configuration <code>config/nats.conf</code> <code>packages/shared/src/messaging/NatsClient.ts</code> CI Pipeline <code>.github/workflows/ci.yml</code> <code>docs/dev/quality-gates.md</code> Shared NATS Subjects <code>packages/shared/src/messaging/powerlaw_subjects.ts</code> Types &amp; Schemas <code>packages/shared/src/schemas/</code>"},{"location":"start-here/","title":"Start Here: Titan Trading System Documentation","text":"<p>Welcome to the Titan Trading System documentation hub. This guide helps you navigate the system's documentation based on your role and goal.</p>"},{"location":"start-here/#navigation-by-role","title":"\ud83e\udded Navigation by Role","text":""},{"location":"start-here/#for-developers-core-features","title":"\ud83d\ude80 For Developers (Core &amp; Features)","text":"<p>Build, test, and extend the system.</p> <ol> <li>System Source of Truth: Start here. The authoritative map of ports, services, and invariants.</li> <li>Architecture Overview: High-level topology.</li> <li>Repo Structure: Where does code live?</li> <li>Contributing &amp; Style: Coding rules, SOTA gates, and style guide.</li> </ol>"},{"location":"start-here/#for-operators-live-environment","title":"\ud83d\udee1\ufe0f For Operators (Live Environment)","text":"<p>Deploy, monitor, and manage the organism.</p> <ol> <li>Deployment Guide: Production deployment (Manual &amp; Policy).</li> <li>Operations Manual: Monitoring, Secrets, and Self-Hosted AI.</li> <li>Incident Response: Emergency procedures.</li> </ol>"},{"location":"start-here/#by-section","title":"By Section","text":""},{"location":"start-here/#reference","title":"\ud83d\udcda Reference","text":"<p>Technical details.</p> <ul> <li>Canonical Source of Truth</li> <li>API Reference</li> </ul>"},{"location":"start-here/#explanation","title":"\ud83d\udca1 Explanation","text":"<p>Background and context.</p> <ul> <li>Architecture Overview</li> <li>Execution Routing</li> <li>HA Strategy</li> <li>Quality Gates</li> </ul>"},{"location":"start-here/#for-researchers-strategy-verification","title":"\ud83d\udd2c For Researchers (Strategy &amp; Verification)","text":"<p>Backtest, optimize, and audit.</p> <ol> <li>Research Workflow: From idea to production signal.</li> <li>Valuation Report: System integrity and IP audit. (Coming Soon)</li> <li>Power Law Lab: Tail risk analysis.</li> <li>Legal &amp; Compliance: Risk limits and authorized use.</li> </ol>"},{"location":"start-here/#key-concepts-invariants","title":"\ud83d\udd11 Key Concepts &amp; Invariants","text":"<ul> <li>Canonical Truth: If <code>system-source-of-truth.md</code> disagrees with another doc, Source of Truth wins.</li> <li>Fail-Closed: The system defaults to safety (panic on missing secrets, reject on missing signatures).</li> <li>Zero Drift: Docs must match code. Run <code>npm run sota:arch</code> to verify.</li> <li>Evidence First: Claims must be backed by file paths or command outputs.</li> </ul>"},{"location":"start-here/#documentation-structure","title":"\ud83d\udcc2 Documentation Structure","text":"<pre><code>docs/\n\u251c\u2500\u2500 components/         # Component documentation (services, packages, apps).\n\u251c\u2500\u2500 runbooks/           # ACTION: Procedures for incidents and ops.\n\u251c\u2500\u2500 operations/         # KNOWLEDGE: Standards, legal, workflows.\n\u251c\u2500\u2500 architecture/       # DESIGN: Diagrams and decisions.\n\u251c\u2500\u2500 contracts/          # INTERFACES: JSON schemas and API specs.\n\u251c\u2500\u2500 reference/          # REFERENCE: API specs, NATS subjects, schemas.\n\u2514\u2500\u2500 setup/              # SETUP: Infrastructure provisioning guides.\n</code></pre> <p>Last Updated: 2026-02-14</p>"},{"location":"system-source-of-truth/","title":"Titan Trading System: Canonical Source of Truth","text":"<p>[!IMPORTANT] This document is the single, authoritative source of truth for the Titan Trading System. All statements are derived from repository artifacts at the commit hash specified below. Any discrepancy between this document and reality should be resolved in favor of the repository's physical state. Any conflicting doc is non-authoritative.</p>"},{"location":"system-source-of-truth/#1-canonical-header","title":"1. Canonical Header","text":"<p>Context Map: See Knowledge Graph and AI Agent Instructions.</p> Field Value Repository Name <code>titan</code> (peycheff-com/titan-trading-system) Default Branch <code>main</code> Commit Hash <code>a77c842f9af7953cec76954d6d2696cf4ac7ca0d</code> Generation Timestamp 2026-02-10T20:02:00Z Node.js Version v22.19.0 NPM Version 11.6.2 Rust Toolchain rustc 1.89.0 (29483883e 2025-08-04) Cargo Version 1.89.0 (c24e10642 2025-06-23) Document SHA256 Compute via: <code>shasum -a 256 docs/system-source-of-truth.md</code>"},{"location":"system-source-of-truth/#2-system-invariants-non-negotiables","title":"2. System Invariants (Non-negotiables)","text":"<p>These are the inviolable rules governing the Titan system. Each invariant is backed by symbol-based evidence (not line numbers) for resilience to refactoring.</p> <p>[!NOTE] Evidence references use symbol names to survive code changes. Verify via: <code>grep -r \"SymbolName\" path/to/file</code></p> ID Invariant Evidence (Symbol-Based) I-01 All trading signals MUST be mediated through Titan Brain before reaching Execution <code>ExecutionPipeline.process_intent()</code> in <code>nats_engine.rs</code> I-02 HMAC_SECRET is fail-closed: empty secret = <code>panic!</code> in production <code>HmacValidator::new()</code> panic block in <code>security.rs</code> I-03 Risk Policy hash MUST match between TypeScript and Rust at boot <code>RiskPolicy.computeHash()</code> in TS, <code>RiskPolicy::get_hash()</code> in Rust I-04 Symbol whitelist is the sole source of tradeable pairs <code>symbolWhitelist</code> field in <code>packages/shared/risk_policy.json</code> I-05 All phase services (Scavenger, Hunter, Sentinel) require Brain approval before execution <code>publish</code> ACLs in <code>config/nats.conf</code> (titan.cmd.* subjects) I-06 Circuit breaker activation is final until operator ARM command with HMAC signature <code>GlobalHaltState.set_halt()</code> + <code>validate_risk_command()</code> in <code>security.rs</code> I-07 Execution engine only processes intents from <code>titan.cmd.execution.&gt;</code> subjects Consumer <code>EXECUTION_CORE</code> filter in <code>nats_engine.rs</code> I-08 JetStream streams are authoritative for event persistence (<code>TITAN_CMD</code>, <code>TITAN_EVT</code>) Stream init in <code>NatsClient.ensureJetStreamResources()</code> (TS) and <code>nats_engine.rs</code> I-09 Envelope signatures require <code>ts</code>, <code>nonce</code>, and <code>sig</code> fields; missing any = rejection <code>HmacValidator::validate()</code> field checks in <code>security.rs</code> I-10 Timestamp drift tolerance is 5 minutes (300,000ms) by default <code>HMAC_TIMESTAMP_TOLERANCE</code> env var parsed in <code>HmacValidator::new()</code> I-11 Rate limiting enforced via TokenBucket in Rust (default 10 RPS for Bybit) <code>struct TokenBucket</code> in <code>rate_limiter.rs</code> I-12 RiskGuard is final veto before order submission; it evaluates policy + shadow state <code>RiskGuard::evaluate()</code> in <code>risk_guard.rs</code> I-13 NATS users have granular publish/subscribe ACLs preventing cross-service impersonation <code>authorization { users [ ... ] }</code> block in <code>config/nats.conf</code> I-14 Database tables use Row Level Security (RLS) enabled by default <code>ALTER TABLE ... ENABLE ROW LEVEL SECURITY</code> in <code>schema.sql</code> I-15 <code>fills</code> and <code>event_log</code> tables are partitioned by month for performance and retention <code>PARTITION BY RANGE</code> in <code>schema.sql</code> table definitions I-16 Circuit breaker states are: Normal \u2192 Cautious \u2192 Defensive \u2192 Emergency <code>pub enum RiskState</code> in <code>risk_policy.rs</code> I-17 All services must expose <code>/health</code> endpoint for orchestration health checks <code>healthcheck</code> directives in <code>docker-compose.prod.yml</code> I-18 Phase services broadcast state via <code>titan.evt.phase.*</code> subjects <code>publish: [\"titan.evt.phase.*\"]</code> ACLs in <code>config/nats.conf</code> I-19 DLQ (Dead Letter Queue) exists at <code>titan.dlq.execution.core</code> <code>DLQ_EXECUTION_CORE</code> constant in <code>subjects.rs</code> I-20 Risk policy embedded at Rust compile time via <code>include_str!</code> <code>const RISK_POLICY_JSON: &amp;str = include_str!()</code> in <code>risk_policy.rs</code>"},{"location":"system-source-of-truth/#3-organism-topology","title":"3. Organism Topology","text":""},{"location":"system-source-of-truth/#31-service-inventory","title":"3.1 Service Inventory","text":"Service Language Port Entrypoint Dockerfile titan-brain TypeScript 3100 <code>services/titan-brain/src/index.ts</code> <code>services/titan-brain/Dockerfile</code> titan-execution-rs Rust 3002 <code>services/titan-execution-rs/src/main.rs</code> <code>services/titan-execution-rs/Dockerfile</code> titan-phase1-scavenger TypeScript 8081 <code>services/titan-phase1-scavenger/src/index.tsx</code> <code>services/titan-phase1-scavenger/Dockerfile</code> titan-phase2-hunter TypeScript 8083 <code>services/titan-phase2-hunter/src/index.ts</code> <code>services/titan-phase2-hunter/Dockerfile</code> titan-phase3-sentinel TypeScript 8084 <code>services/titan-phase3-sentinel/src/index.tsx</code> <code>services/titan-phase3-sentinel/Dockerfile</code> titan-ai-quant TypeScript 8082 <code>services/titan-ai-quant/src/index.ts</code> (lib) <code>services/titan-ai-quant/Dockerfile</code> titan-powerlaw-lab TypeScript - <code>services/titan-powerlaw-lab/src/main.ts</code> <code>services/titan-powerlaw-lab/Dockerfile</code> titan-console React/Vite 3001 <code>apps/titan-console/</code> <code>apps/titan-console/Dockerfile</code>"},{"location":"system-source-of-truth/#32-infrastructure-services-docker-composeprodyml","title":"3.2 Infrastructure Services (docker-compose.prod.yml)","text":"Service Image Port(s) Purpose <code>traefik</code> traefik:v3.0 80, 443 Reverse proxy, TLS termination <code>nats</code> nats:2.10.22-alpine 4222, 8222 Event bus, JetStream persistence <code>postgres</code> postgres:16-alpine 5432 Primary truth ledger <code>redis</code> redis:alpine 6379 Idempotency cache, distributed state <code>prometheus</code> prom/prometheus 9090 Metrics collection <code>grafana</code> grafana/grafana 3000 Observability dashboards <code>titan-tempo</code> grafana/tempo 3200, 4317 Distributed tracing (4317=OTLP/gRPC)"},{"location":"system-source-of-truth/#33-signal-flow-diagram","title":"3.3 Signal Flow Diagram","text":"<pre><code>graph TD\n    subgraph \"Strategy Layer\"\n        S1[\"Phase 1: Scavenger&lt;br/&gt;(Port 8081)\"]\n        S2[\"Phase 2: Hunter&lt;br/&gt;(Port 8083)\"]\n        S3[\"Phase 3: Sentinel&lt;br/&gt;(Port 8084)\"]\n    end\n\n    subgraph \"Orchestration Layer\"\n        B[\"Titan Brain&lt;br/&gt;(Port 3100)\"]\n    end\n\n    subgraph \"Execution Layer\"\n        E[\"Titan Execution-RS&lt;br/&gt;(Port 3002)\"]\n    end\n\n    subgraph \"External\"\n        EX[\"Exchange APIs&lt;br/&gt;(Bybit/Binance)\"]\n    end\n\n    S1 --&gt;|\"titan.evt.phase.*\"| N[\"NATS JetStream\"]\n    S2 --&gt;|\"titan.evt.phase.*\"| N\n    S3 --&gt;|\"titan.evt.phase.*\"| N\n    N --&gt;|Events| B\n     B --&gt;|\"titan.cmd.execute.&gt;\"| N\n    N --&gt;|Commands| E\n    E --&gt;|\"titan.evt.execution.fill.v1\"| N\n    E --&gt;|REST/WS| EX</code></pre>"},{"location":"system-source-of-truth/#4-build-boot-truth-graph","title":"4. Build &amp; Boot Truth Graph","text":""},{"location":"system-source-of-truth/#41-monorepo-structure","title":"4.1 Monorepo Structure","text":"<pre><code>titan/\n\u251c\u2500\u2500 apps/\n\u2502   \u2514\u2500\u2500 titan-console/          # React/Vite frontend\n\u251c\u2500\u2500 packages/\n\u2502   \u2514\u2500\u2500 shared/                 # @titan/shared (schemas, messaging, config)\n\u2514\u2500\u2500 services/\n    \u251c\u2500\u2500 titan-brain/            # TypeScript orchestrator\n    \u251c\u2500\u2500 titan-execution-rs/     # Rust execution engine\n    \u251c\u2500\u2500 titan-phase1-scavenger/ # Phase 1 strategy\n    \u251c\u2500\u2500 titan-phase2-hunter/    # Phase 2 strategy\n    \u251c\u2500\u2500 titan-phase3-sentinel/  # Phase 3 strategy\n    \u251c\u2500\u2500 titan-ai-quant/         # AI optimization library\n    \u2514\u2500\u2500 titan-powerlaw-lab/     # Power law analysis\n</code></pre>"},{"location":"system-source-of-truth/#42-build-commands","title":"4.2 Build Commands","text":"Command Purpose Evidence <code>npm run build</code> Build all TS services via Turbo + provenance <code>package.json:32</code> <code>npm run start:brain</code> Start Brain service <code>package.json:13</code> <code>npm run start:execution</code> Build + run Rust execution (release) <code>package.json:14</code> <code>npm run start:prod</code> Production startup script <code>package.json:22</code> \u2192 <code>scrip../start_production.sh</code> <code>cargo build --release</code> Production Rust binary <code>services/titan-execution-rs/Cargo.toml</code>"},{"location":"system-source-of-truth/#43-dev-vs-prod-boot","title":"4.3 Dev vs Prod Boot","text":"<p>Development:</p> <pre><code>docker compose up -d nats postgres redis\nnpm run start:brain\nnpm run start:execution\nnpm run start:console\n</code></pre> <p>Production:</p> <pre><code>docker compose -f docker-compose.prod.yml up -d\n# OR\nnpm run start:prod  # Runs scrip../start_production.sh\n</code></pre>"},{"location":"system-source-of-truth/#44-ci-pipeline-7-jobs","title":"4.4 CI Pipeline (7 Jobs)","text":"Job Description Status Evidence <code>config-validation</code> Validates configuration schemas Required <code>.github/workflows/ci.yml:13-31</code> <code>sota-checks</code> Zombie deps, circular deps, immutability, knip Required <code>.github/workflows/ci.yml:36-78</code> <code>security-scan</code> NPM audit, cargo audit, SBOM generation Required <code>.github/workflows/ci.yml:83-137</code> <code>contract-check</code> Schema drift detection Required <code>.github/workflows/ci.yml:142-157</code> <code>node-services</code> Lint, test, build for 7 TS services Required <code>.github/workflows/ci.yml:162-213</code> <code>rust-services</code> fmt, clippy, test, build for execution-rs Required <code>.github/workflows/ci.yml:218-265</code> <code>status-check</code> Final gate aggregation Required <code>.github/workflows/ci.yml:270-289</code> <code>deploy-production</code> VPS Deployment Strategy (Blue/Green-ish) CD Only <code>.github/workflows/deploy-prod.yml</code>"},{"location":"system-source-of-truth/#45-live-vs-dead-scripts","title":"4.5 Live vs Dead Scripts","text":"Script Category Examples Status Live <code>sota:*</code>, <code>start:*</code>, <code>build</code>, <code>test</code>, <code>lint</code> Active Deprecated None identified -"},{"location":"system-source-of-truth/#5-configuration-canon","title":"5. Configuration Canon","text":""},{"location":"system-source-of-truth/#51-environment-variables-critical","title":"5.1 Environment Variables (Critical)","text":"Variable Required Purpose Source <code>HMAC_SECRET</code> Yes Command signing (fail-closed) <code>.env</code> / Vault <code>TITAN_MASTER_PASSWORD</code> Yes Operator authentication <code>.env</code> / Vault <code>DATABASE_URL</code> Yes Postgres connection string <code>.env</code> <code>NATS_URL</code> Yes NATS server address <code>.env</code> <code>NATS_USER</code> Yes NATS authentication <code>.env</code> <code>NATS_PASS</code> Yes NATS authentication <code>.env</code> <code>BYBIT_API_KEY</code> Yes Exchange credentials <code>.env</code> / Vault <code>BYBIT_API_SECRET</code> Yes Exchange credentials <code>.env</code> / Vault <code>BINANCE_API_KEY</code> Trade Exchange credentials (optional) <code>.env</code> <code>REDIS_URL</code> Yes Redis for idempotency <code>.env</code> <p>Evidence: <code>.env.example:1-177</code></p>"},{"location":"system-source-of-truth/#52-configuration-files","title":"5.2 Configuration Files","text":"File Purpose Hash (SHA256) <code>docker-compose.prod.yml</code> Production orchestration <code>f5957a020975044ad2500e8c88d62fffc5e92fef8d30a7cc4e9e65fbebf33701</code> <code>docker-compose.yml</code> Development orchestration <code>4e002c4d03e329539fba06b6fb41b27337150f5091f003b4e94f792495f9ce93</code> <code>packages/shared/risk_policy.json</code> Canonical risk policy <code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code> <code>config/nats.conf</code> NATS server + ACL configuration <code>42b0a657e815a911688710bfa9776eeb4bc7215c635d99bf787c5e3851b74971</code> <code>services/titan-brain/src/db/schema.sql</code> Database schema <code>aa1b8369ecb230b1a1809f52c482f6f48a734df4393dc4ce74c474259bfe0bd0</code>"},{"location":"system-source-of-truth/#53-single-source-of-truth-per-domain","title":"5.3 Single Source of Truth per Domain","text":"Domain Source Loaded By Risk Policy <code>packages/shared/risk_policy.json</code> TS: Zod parse, Rust: <code>include_str!</code> NATS Subjects <code>packages/shared/src/messaging/powerlaw_subjects.ts</code> All services import Fee Schedule <code>packages/shared/fee_schedule.json</code> Brain, Execution Database Schema <code>services/titan-brain/src/db/schema.sql</code> Brain migrations Exchange Credentials <code>.env</code> / Vault All services via <code>loadSecretsFromFiles()</code>"},{"location":"system-source-of-truth/#6-event-bus-canon-nats-jetstream","title":"6. Event Bus Canon (NATS JetStream)","text":""},{"location":"system-source-of-truth/#61-stream-definitions","title":"6.1 Stream Definitions","text":"Stream Name Subjects Retention Evidence <code>TITAN_COMMANDS</code> <code>titan.cmd.&gt;</code> WorkQueue <code>packages/shared/src/messaging/NatsClient.ts:175-183</code> <code>TITAN_EVENTS</code> <code>titan.evt.&gt;</code> Limits <code>packages/shared/src/messaging/NatsClient.ts:184-191</code> <code>TITAN_DATA</code> <code>titan.data.&gt;</code> Limits <code>packages/shared/src/messaging/NatsClient.ts:192-197</code> <code>TITAN_SIGNALS</code> <code>titan.signal.&gt;</code> Limits DEPRECATED \u2014 No longer initialized in code. Scheduled for removal. <p>[!NOTE] Additional connectivity-layer streams (<code>TITAN_VENUE_STATUS</code>, <code>TITAN_MARKET_TRADES</code>) are defined in connectivity/nats-topology.md.</p>"},{"location":"system-source-of-truth/#62-subject-namespace-map","title":"6.2 Subject Namespace Map","text":"Subject Pattern Publisher(s) Subscriber(s) Type Payload Schema <code>titan.cmd.execution.place.v1.&gt;</code> Brain Execution Command <code>IntentEnvelope</code> <code>titan.evt.execution.fill.v1</code> Execution Brain, Console Event <code>FillEvent</code> <code>titan.evt.scavenger.signal.v1</code> Scavenger Brain Signal <code>PhaseDiagnostics</code> <code>titan.evt.hunter.&gt;</code> Hunter Brain Signal <code>IntentSignal</code> <code>titan.evt.sentinel.&gt;</code> Sentinel Brain Signal <code>ArbitrageSignal</code> <code>titan.evt.phase.*</code> All phases Brain Telemetry <code>PhasePosture</code> <code>powerlaw.metrics.*</code> PowerLaw Lab All phases, Quant Data <code>PowerLawMetrics</code> <code>titan.ai.*</code> AI Quant, PowerLaw Hunter, Brain Data Various <code>titan.evt.budget.update</code> Brain All phases Event <code>BudgetUpdate</code> <code>titan.cmd.risk.*</code> Brain Execution Command <code>RiskCommand</code> <code>titan.cmd.sys.halt.v1</code> Brain/Operator Execution Command <code>HaltPayload</code>"},{"location":"system-source-of-truth/#63-nats-acl-matrix","title":"6.3 NATS ACL Matrix","text":"User Publish Permissions Subscribe Permissions <code>brain</code> <code>&gt;</code> (full) <code>&gt;</code> (full) <code>execution</code> <code>titan.evt.execution.fill.v1</code>, <code>titan.evt.execution.&gt;</code>, <code>titan.evt.phase.&gt;</code> <code>titan.cmd.execution.place.v1.&gt;</code>, <code>titan.cmd.risk.&gt;</code>, <code>titan.cmd.sys.halt.v1</code> <code>scavenger</code> <code>titan.evt.scavenger.signal.v1</code>, <code>titan.evt.phase.&gt;</code> <code>powerlaw.metrics.&gt;</code>, <code>titan.evt.budget.update.v1</code> <code>hunter</code> <code>titan.evt.hunter.&gt;</code>, <code>titan.evt.phase.&gt;</code> <code>titan.cmd.hunter.&gt;</code>, <code>powerlaw.metrics.&gt;</code> <code>sentinel</code> <code>titan.evt.sentinel.&gt;</code>, <code>titan.evt.phase.&gt;</code> <code>titan.cmd.sentinel.&gt;</code>, <code>powerlaw.metrics.&gt;</code> <code>powerlaw</code> <code>titan.evt.powerlaw.&gt;</code>, <code>titan.data.powerlaw.&gt;</code>, <code>titan.ai.&gt;</code> <code>titan.data.market.&gt;</code>, <code>titan.evt.&gt;</code> <code>quant</code> <code>titan.evt.quant.&gt;</code>, <code>titan.cmd.ai.&gt;</code> <code>titan.cmd.ai.&gt;</code>, <code>titan.evt.&gt;</code>, <code>titan.data.powerlaw.&gt;</code> <code>console</code> <code>$JS.API.&gt;</code> <code>titan.data.&gt;</code>, <code>titan.evt.&gt;</code>, <code>_INBOX.&gt;</code> <p>Evidence: <code>config/nats.conf:22-101</code></p>"},{"location":"system-source-of-truth/#64-message-envelope-schema","title":"6.4 Message Envelope Schema","text":"<p>Required Fields (IntentEnvelope):</p> <ul> <li><code>type</code>: Message type identifier</li> <li><code>payload</code>: Actual message content</li> <li><code>source</code>: Origin service identifier</li> <li><code>ts</code>: Unix timestamp (milliseconds)</li> <li><code>nonce</code>: Unique request identifier</li> <li><code>sig</code>: HMAC-SHA256 signature (hex)</li> </ul> <p>Evidence: <code>packages/shared/src/schemas/intentSchema.ts</code></p>"},{"location":"system-source-of-truth/#7-data-truth-postgresql","title":"7. Data Truth (PostgreSQL)","text":""},{"location":"system-source-of-truth/#71-table-ownership","title":"7.1 Table Ownership","text":"Table Owner Service Purpose Partitioned RLS <code>allocation_history</code> Brain Tracks phase allocation changes No Enabled <code>phase_trades</code> Brain Individual trade records per phase No Enabled <code>phase_performance</code> Brain Aggregated performance metrics No Enabled <code>brain_decisions</code> Brain Signal approval/rejection audit trail No Enabled <code>treasury_operations</code> Brain Capital movement ledger No Enabled <code>circuit_breaker_events</code> Brain Breaker activation log No Enabled <code>risk_snapshots</code> Brain Periodic risk state captures No Enabled <code>high_watermark</code> Brain Peak equity tracking No Enabled <code>system_state</code> Brain Recovery checkpointing (JSONB) No Enabled <code>manual_overrides</code> Brain Operator allocation interventions No Enabled <code>operators</code> Brain User credentials and permissions No Enabled <code>fills</code> Brain Trade execution records Yes Enabled <code>event_log</code> Brain Event sourcing journal Yes Enabled <code>ledger_accounts</code> Brain Double-entry accounting accounts No Enabled <code>ledger_transactions</code> Brain Accounting transaction headers No Enabled <code>ledger_entries</code> Brain Accounting debit/credit entries No Enabled"},{"location":"system-source-of-truth/#72-migration-system","title":"7.2 Migration System","text":"Aspect Value Location <code>services/titan-brain/migrations/</code> System Idempotent runner (<code>scripts/ops/run_migrations.sh</code>) with <code>_titan_migrations</code> tracking table (SHA256 drift detection) Current Schema <code>services/titan-brain/src/db/schema.sql</code> CI Validation <code>scripts/ci/test_fresh_bootstrap.sh</code> (ephemeral Postgres \u2192 migrate \u2192 validate \u2192 idempotency proof)"},{"location":"system-source-of-truth/#73-migrations","title":"7.3 Migrations","text":"Migration File Purpose <code>003_dedup_fills.sql</code> Fill deduplication constraints <code>004_performance_view.sql</code> Performance aggregation views <code>20240523_canary_config.sql</code> Canary deployment configuration"},{"location":"system-source-of-truth/#8-risk-immune-system","title":"8. Risk Immune System","text":""},{"location":"system-source-of-truth/#81-canonical-risk-policy","title":"8.1 Canonical Risk Policy","text":"<p>Source File: <code>packages/shared/risk_policy.json</code> SHA256 Hash: <code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code></p> <pre><code>{\n  \"maxAccountLeverage\": 10.0,\n  \"maxPositionNotional\": 50000.0,\n  \"maxDailyLoss\": -1000.0,\n  \"maxOpenOrdersPerSymbol\": 5,\n  \"symbolWhitelist\": [\"BTC/USDT\", \"ETH/USDT\", \"SOL/USDT\"],\n  \"maxSlippageBps\": 100,\n  \"maxStalenessMs\": 5000,\n  \"maxCorrelation\": 0.7,\n  \"correlationPenalty\": 0.5,\n  \"minConfidenceScore\": 0.7,\n  \"minStopDistanceMultiplier\": 1.5,\n  \"version\": 1,\n  \"lastUpdated\": 0\n}\n</code></pre>"},{"location":"system-source-of-truth/#82-policy-enforcement-points","title":"8.2 Policy Enforcement Points","text":"Layer File Method Strategy (TS) <code>packages/shared/src/schemas/RiskPolicy.ts:5-26</code> Zod schema validation Execution (Rust) <code>services/titan-execution-rs/src/risk_policy.rs:17-75</code> Serde deserialization Hash Verification Both layers compute SHA256; mismatch = abort <code>getCanonicalRiskPolicy()</code>, <code>RiskPolicy::get_hash()</code>"},{"location":"system-source-of-truth/#83-circuit-breaker-states","title":"8.3 Circuit Breaker States","text":"State Trigger Condition Effect <code>Normal</code> All metrics within bounds Full trading enabled <code>Cautious</code> 50% daily drawdown limit consumed Position sizing reduced 50% <code>Defensive</code> 75% daily drawdown limit consumed New positions blocked <code>Emergency</code> Max daily loss breached OR operator halt All positions flattened <p>Evidence: <code>services/titan-execution-rs/src/risk_policy.rs:8-15</code></p>"},{"location":"system-source-of-truth/#84-kill-switches","title":"8.4 Kill Switches","text":"Mechanism Trigger Evidence <code>GlobalHalt</code> Operator command via <code>titan.cmd.sys.halt.v1</code> <code>services/titan-execution-rs/src/circuit_breaker.rs</code> <code>ArmedState</code> Disarm command prevents new orders <code>services/titan-execution-rs/src/armed_state.rs</code> <code>RiskGuard</code> Policy violation <code>services/titan-execution-rs/src/risk_guard.rs</code>"},{"location":"system-source-of-truth/#9-execution-boundary-and-order-lifecycle","title":"9. Execution Boundary and Order Lifecycle","text":""},{"location":"system-source-of-truth/#91-boundary-contract","title":"9.1 Boundary Contract","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Strategy/Brain \u2502 \u2500\u2500CMD\u2500\u2500\u25b6\u2502  titan-execution \u2502 \u2500\u2500REST\u2500\u2500\u25b6\u2502    Exchange     \u2502\n\u2502   (Orchestration)\u2502\u25c0\u2500\u2500EVT\u2500\u2500 \u2502      (Rust)      \u2502\u25c0\u2500\u2500WS\u2500\u2500\u2500\u2500 \u2502   (Bybit/Binance) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"system-source-of-truth/#92-allowed-vs-forbidden-channels","title":"9.2 Allowed vs Forbidden Channels","text":"Channel Type Allowed Forbidden Trade Intent NATS <code>titan.cmd.execution.place.v1.&gt;</code> Direct HTTP to exchange from Brain Fill Events NATS <code>titan.evt.execution.fill.v1</code> Database writes from Execution Risk Commands NATS <code>titan.cmd.risk.*</code> Direct gRPC/HTTP bypass"},{"location":"system-source-of-truth/#93-order-lifecycle","title":"9.3 Order Lifecycle","text":"<ol> <li>Signal Generated (Phase 1/2/3) \u2192 Published to <code>titan.evt.*</code></li> <li>Brain Approval \u2192 Validates against policy, allocations</li> <li>Command Published \u2192 <code>titan.cmd.execution.place.v1.{venue}.{account}.{symbol}</code></li> <li>HMAC Validated (Execution) \u2192 <code>security.rs:64-128</code></li> <li>Risk Guard Check \u2192 <code>risk_guard.rs:130-198</code></li> <li>Order Submitted \u2192 Exchange adapter</li> <li>Fill Received \u2192 Published to <code>titan.evt.execution.fill.v1</code></li> <li>Brain Records \u2192 Fills table + event log</li> </ol>"},{"location":"system-source-of-truth/#94-idempotency-rules","title":"9.4 Idempotency Rules","text":"Mechanism Implementation Evidence Signal ID Cache Redis-backed, TTL 5 minutes <code>.env.example:176</code> (<code>SIGNAL_CACHE_TTL_MS</code>) Nonce Tracking Envelope nonce prevents replay <code>security.rs:78</code> Order Dedup Fill ID unique constraint <code>schema.sql:157</code> (<code>fill_id</code> in PRIMARY KEY)"},{"location":"system-source-of-truth/#95-truth-layer-definition","title":"9.5 Truth Layer Definition","text":"<p>\"Verified\" status requires:</p> <ol> <li>Fill confirmed by exchange WebSocket ACK</li> <li>Fill recorded in <code>fills</code> table with <code>t_exchange</code> timestamp</li> <li>Fill event published to NATS</li> </ol> <p>Evidence: <code>services/titan-execution-rs/src/nats_engine.rs</code> (fill publishing logic)</p>"},{"location":"system-source-of-truth/#10-observability-and-operability","title":"10. Observability and Operability","text":""},{"location":"system-source-of-truth/#101-health-endpoints","title":"10.1 Health Endpoints","text":""},{"location":"system-source-of-truth/#nats-subjects-auto-generated","title":"NATS Subjects (Auto-Generated)","text":"Constant Path Subject Pattern <code>CMD.EXECUTION.PLACE</code> <code>Function(...args)</code> <code>CMD.EXECUTION.PREFIX</code> <code>titan.cmd.execution.place.v1</code> <code>CMD.EXECUTION.ALL</code> <code>titan.cmd.execution.place.v1.&gt;</code> <code>CMD.ALL</code> <code>titan.cmd.execution.place.v1.&gt;</code> <code>CMD.RISK.CONTROL</code> <code>titan.cmd.risk.control.v1</code> <code>CMD.RISK.FLATTEN</code> <code>titan.cmd.risk.flatten</code> <code>CMD.RISK.POLICY</code> <code>titan.cmd.risk.policy.v1</code> <code>CMD.CONFIG.ROLLBACK</code> <code>titan.cmd.config.rollback</code> <code>CMD.OPERATOR.ARM</code> <code>titan.cmd.operator.arm.v1</code> <code>CMD.OPERATOR.DISARM</code> <code>titan.cmd.operator.disarm.v1</code> <code>CMD.OPERATOR.ALL</code> <code>titan.cmd.operator.v1.&gt;</code> <code>CMD.SYS.HALT</code> <code>titan.cmd.sys.halt.v1</code> <code>CMD.HUNTER.ALL</code> <code>titan.cmd.hunter.v1.&gt;</code> <code>CMD.SENTINEL.ALL</code> <code>titan.cmd.sentinel.v1.&gt;</code> <code>CMD.AI.OPTIMIZE</code> <code>titan.cmd.ai.optimize.v1</code> <code>CMD.AI.OPTIMIZE_PROPOSAL</code> <code>titan.cmd.ai.optimize.proposal.v1</code> <code>CMD.AI.ALL</code> <code>titan.cmd.ai.v1.&gt;</code> <code>EVT.ANALYSIS.TRADE_COMPLETED</code> <code>titan.evt.analysis.trade_completed.v1</code> <code>EVT.ALERT.DRIFT</code> <code>titan.evt.alert.drift.v1</code> <code>EVT.ALERT.INTEGRITY</code> <code>titan.evt.alert.integrity.v1</code> <code>EVT.ALERT.LATENCY</code> <code>titan.evt.alert.latency.v1</code> <code>EVT.EXECUTION.FILL</code> <code>titan.evt.execution.fill.v1</code> <code>EVT.EXECUTION.SHADOW_FILL</code> <code>titan.evt.execution.shadow_fill.v1</code> <code>EVT.EXECUTION.REPORT</code> <code>titan.evt.execution.report.v1</code> <code>EVT.EXECUTION.REJECT</code> <code>titan.evt.execution.reject.v1</code> <code>EVT.EXECUTION.BALANCE</code> <code>titan.evt.execution.balance</code> <code>EVT.EXECUTION.ALL</code> <code>titan.evt.execution.&gt;</code> <code>EVT.SCAVENGER.SIGNAL</code> <code>titan.evt.scavenger.signal.v1</code> <code>EVT.HUNTER.ALL</code> <code>titan.evt.hunter.&gt;</code> <code>EVT.SENTINEL.ALL</code> <code>titan.evt.sentinel.&gt;</code> <code>EVT.POWERLAW.IMPACT</code> <code>titan.evt.powerlaw.impact.v1</code> <code>EVT.POWERLAW.ALL</code> <code>titan.evt.powerlaw.&gt;</code> <code>EVT.QUANT.ALL</code> <code>titan.evt.quant.&gt;</code> <code>EVT.PHASE.INTENT</code> <code>titan.evt.phase.intent.v1</code> <code>EVT.PHASE.POSTURE</code> <code>titan.evt.phase.posture.v1</code> <code>EVT.PHASE.DIAGNOSTICS</code> <code>titan.evt.phase.diagnostics.v1</code> <code>EVT.PHASE.ALL</code> <code>titan.evt.phase.&gt;</code> <code>EVT.BRAIN.SIGNAL</code> <code>titan.evt.brain.signal.v1</code> <code>EVT.BRAIN.REGIME</code> <code>titan.evt.brain.regime.v1</code> <code>EVT.ANALYTICS.POWERLAW</code> <code>titan.evt.analytics.powerlaw.v1</code> <code>EVT.BUDGET.UPDATE</code> <code>titan.evt.budget.update.v1</code> <code>EVT.AUDIT.OPERATOR</code> <code>titan.evt.audit.operator.v1</code> <code>EVT.RISK.CORRELATION_WARNING</code> <code>titan.evt.risk.correlation_warning.v1</code> <code>EVT.RISK.STATE</code> <code>titan.evt.risk.state.v1</code> <code>EVT.SYS.FAILOVER_INITIATED</code> <code>titan.evt.sys.failover_initiated.v1</code> <code>EVT.SYS.RESTORE_INITIATED</code> <code>titan.evt.sys.restore_initiated.v1</code> <code>DATA.POWERLAW.METRICS</code> <code>Function(...args)</code> <code>DATA.POWERLAW.PREFIX</code> <code>titan.data.powerlaw.metrics.v1</code> <code>DATA.POWERLAW.ALL</code> <code>titan.data.powerlaw.metrics.v1.&gt;</code> <code>DATA.EXECUTION.CONSTRAINTS</code> <code>Function(...args)</code> <code>DATA.EXECUTION.PREFIX</code> <code>titan.data.execution.constraints.v1</code> <code>DATA.EXECUTION.ALL</code> <code>titan.data.execution.constraints.v1.&gt;</code> <code>DATA.MARKET.TICKER</code> <code>Function(...args)</code> <code>DATA.MARKET.PREFIX</code> <code>titan.data.market.ticker.v1</code> <code>DATA.MARKET.ALL</code> <code>titan.data.market.ticker.v1.&gt;</code> <code>DATA.DASHBOARD.UPDATE</code> <code>titan.data.dashboard.update.v1</code> <code>SYS.HEARTBEAT</code> <code>Function(...args)</code> <code>SYS.RPC.GET_POSITIONS</code> <code>Function(...args)</code> <code>SYS.RPC.GET_BALANCES</code> <code>Function(...args)</code>"},{"location":"system-source-of-truth/#jetstream-streams","title":"JetStream Streams","text":""},{"location":"system-source-of-truth/#102-metrics-endpoints","title":"10.2 Metrics Endpoints","text":"<p>| titan-execution   | <code>/metrics</code>      | Prometheus | | titan-brain       | <code>/metrics</code>      | Prometheus | | NATS              | <code>:8222/varz</code>    | JSON       |</p>"},{"location":"system-source-of-truth/#103-critical-metrics","title":"10.3 Critical Metrics","text":"Metric Source Alert Threshold Position exposure Execution &gt; 80% of max notional Account leverage Execution &gt; 8x (of 10x max) Daily drawdown Brain &gt; 50% of <code>maxDailyLoss</code> consumed \u2192 alert; 100% \u2192 Emergency Order latency p99 Execution &gt; 500ms HMAC rejection rate Execution &gt; 1 per minute"},{"location":"system-source-of-truth/#104-log-correlation","title":"10.4 Log Correlation","text":"ID Type Format Usage <code>signal_id</code> UUID v4 End-to-end signal tracking <code>correlation_id</code> UUID v4 Request correlation <code>order_id</code> Exchange-provided Exchange order tracking <code>fill_id</code> Exchange-provided Fill deduplication"},{"location":"system-source-of-truth/#105-tracing","title":"10.5 Tracing","text":"<p>OpenTelemetry configured via:</p> <ul> <li><code>opentelemetry-otlp</code> in Rust (<code>Cargo.toml:46</code>)</li> <li>Tempo receiver on <code>4317</code> (OTLP/gRPC)</li> </ul>"},{"location":"system-source-of-truth/#11-security-canon","title":"11. Security Canon","text":""},{"location":"system-source-of-truth/#111-hmac-signing-boundaries","title":"11.1 HMAC Signing Boundaries","text":"Boundary What is Signed Where Verified Brain \u2192 Execution <code>ts.nonce.payload_json</code> <code>security.rs:64-128</code> Operator \u2192 Execution <code>timestamp:action:actor_id:command_id</code> <code>security.rs:130-184</code>"},{"location":"system-source-of-truth/#112-fail-closed-behavior","title":"11.2 Fail-Closed Behavior","text":"<pre><code>// services/titan-execution-rs/src/security.rs:35-49\nif secret.is_empty() {\n    let allow_empty = env::var(\"HMAC_ALLOW_EMPTY_SECRET\")\n        .map(|v| v == \"true\")\n        .unwrap_or(false);\n    if allow_empty {\n        warn!(\"\u26a0\ufe0f HMAC_SECRET not set but HMAC_ALLOW_EMPTY_SECRET=true. TEST MODE ONLY.\");\n    } else {\n        panic!(\"FATAL: HMAC_SECRET environment variable is required.\");\n    }\n}\n</code></pre>"},{"location":"system-source-of-truth/#113-secret-handling","title":"11.3 Secret Handling","text":"Secret Storage Load Method <code>HMAC_SECRET</code> <code>.env</code> / Vault <code>std::env::var()</code> + panic on miss Exchange API keys <code>.env</code> / Vault <code>loadSecretsFromFiles()</code> <code>TITAN_MASTER_PASSWORD</code> <code>.env</code> / Vault Brain config loader"},{"location":"system-source-of-truth/#114-rate-limiting","title":"11.4 Rate Limiting","text":"Service Limit Implementation titan-execution 10 RPS per exchange <code>rate_limiter.rs</code> (TokenBucket) Brain API 12 RPS <code>.env.example:126</code>"},{"location":"system-source-of-truth/#12-contradictions-and-dual-truth-findings","title":"12. Contradictions and Dual Truth Findings","text":"ID Finding Resolution Status D-01 Two risk_policy.json files exist Files are byte-identical (same SHA256) RESOLVED D-02 Legacy NATS subjects (<code>titan.data.*</code>) vs new (<code>titan.data.*</code>) Migration map exists; both active during transition DOCUMENTED D-03 <code>docker compose config</code> requires NATS_SYS_PASSWORD <code>validate_prod_env.sh</code> checks all required vars pre-deploy; <code>:?</code> fail-fast syntax in compose RESOLVED <p>Dual Truth Verification:</p> <pre><code># Verify risk policy files are identical\nshasum -a 256 packages/shared/risk_policy.json services/titan-execution-rs/src/risk_policy.json\n# Output: d4fb422e... (both files)\n</code></pre>"},{"location":"system-source-of-truth/#13-deadlegacyunused-inventory","title":"13. Dead/Legacy/Unused Inventory","text":""},{"location":"system-source-of-truth/#131-detected-by-knip-analysis","title":"13.1 Detected by Knip Analysis","text":"Item Type Path/Pattern Evidence Action Unlisted dependency <code>@titan/shared</code> in scripts/verification <code>knip</code> output Add to deps Unlisted dependency <code>globals</code> in eslint configs <code>knip</code> output Add to deps Unlisted binary <code>tsx</code>, <code>ts-node</code>, <code>python3</code> <code>knip</code> output Add to deps Unused exports 220 unused exports (mostly UI components) <code>knip</code> output Review Unresolved imports <code>identity-obj-proxy</code>, <code>@jest/test-sequencer</code> Jest config issues Fix config"},{"location":"system-source-of-truth/#132-legacy-services","title":"13.2 Legacy Services","text":"Service Path Status Action <code>canonical-powerlaw-service</code> <code>services/canonical-powerlaw-service/</code> Deleted \u2705 Removed <code>titan-memory</code> <code>services/titan-memory/</code> Deleted \u2705 Removed"},{"location":"system-source-of-truth/#133-legacy-nats-subjects","title":"13.3 Legacy NATS Subjects","text":"Subject Pattern Status Replacement Deadline <code>signal.*</code> Deprecated <code>titan.data.*</code> Feb 28, 2026"},{"location":"system-source-of-truth/#14-canonical-artifacts-and-hash-ledger","title":"14. Canonical Artifacts and Hash Ledger","text":""},{"location":"system-source-of-truth/#141-critical-artifacts-sha256","title":"14.1 Critical Artifacts (SHA256)","text":"Artifact SHA256 <code>docker-compose.prod.yml</code> <code>f5957a020975044ad2500e8c88d62fffc5e92fef8d30a7cc4e9e65fbebf33701</code> <code>docker-compose.yml</code> <code>4e002c4d03e329539fba06b6fb41b27337150f5091f003b4e94f792495f9ce93</code> <code>packages/shared/risk_policy.json</code> <code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code> <code>services/titan-execution-rs/src/risk_policy.json</code> <code>d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1</code> <code>config/nats.conf</code> <code>42b0a657e815a911688710bfa9776eeb4bc7215c635d99bf787c5e3851b74971</code> <code>services/titan-brain/src/db/schema.sql</code> <code>aa1b8369ecb230b1a1809f52c482f6f48a734df4393dc4ce74c474259bfe0bd0</code> <code>packages/shared/src/schemas/RiskPolicy.ts</code> <code>12964aaf9d30f6f4876fa5ff54da8d3035c4556ead4ff9765a5106adac7c2932</code> <code>packages/shared/src/messaging/NatsClient.ts</code> <code>f2e9f3ec1f4fe22b0f2d5dc112a654d071016c572b189f946e89a7d9be5ab9d1</code> <code>packages/shared/src/messaging/ExecutionClient.ts</code> <code>d413c4efa4676dfd5d8fe93ac203ae316e48b4b6b958ea1286d38599a6e8f5f9</code> <code>services/titan-execution-rs/src/risk_policy.rs</code> <code>6808e7ca92f856ffe465f88311be6d8721dd28cb96795eddf4b1e81a725d562e</code> <code>services/titan-execution-rs/src/security.rs</code> <code>624f0384eb51573ede5f94d3783d78a51e93ab8130cad43802dcc4b38cad5d34</code> <code>services/titan-execution-rs/src/nats_engine.rs</code> <code>92bf7301558e51d4320203efa64b526489fa89e2aae1c36974778dcc00c0d6ee</code> <code>services/titan-brain/src/index.ts</code> <code>b03c71431500b41ac163b05a3e80d5a5095e7b75ff30855c090069e097be1c76</code> <code>turbo.json</code> <code>40a2fb5f91c04664d838e8057aa47591000414d44c2465870f93d498377564e7</code> <code>.github/workflows/ci.yml</code> <code>46659f81fb57ec1f6245a7c2847a75e91f1649bceaba8012a63b1bfd15c3d2de</code> <code>.github/workflows/deploy-prod.yml</code> <code>7e455b9a699af2924128f2bc3382cbf0d11d3eae3d5c3b60d7acf55947b67593</code>"},{"location":"system-source-of-truth/#142-hash-computation-command","title":"14.2 Hash Computation Command","text":"<pre><code>shasum -a 256 &lt;file&gt;\n</code></pre>"},{"location":"system-source-of-truth/#15-closure-tasks","title":"15. Closure Tasks","text":"ID Task Priority Evidence Trigger C-01 Add <code>@titan/shared</code> to dependencies in verification scripts Medium Knip unlisted dependency warning C-02 Add missing binaries (<code>tsx</code>, <code>ts-node</code>, <code>python3</code>) to package.json Low Knip unlisted binaries warning C-05 Complete NATS subject migration from <code>titan.data.*</code> to <code>titan.data.*</code> High <code>powerlaw_subjects.ts:77</code> deprecation notice C-06 Review 220 unused exports identified by Knip Low Knip unused exports output C-07 Set <code>NATS_SYS_PASSWORD</code> environment variable for production RESOLVED <code>validate_prod_env.sh</code> + fail-fast <code>:?</code> syntax"},{"location":"system-source-of-truth/#16-mandatory-command-evidence","title":"16. Mandatory Command Evidence","text":""},{"location":"system-source-of-truth/#161-git-rev-parse-head","title":"16.1 git rev-parse HEAD","text":"<pre><code>a77c842f9af7953cec76954d6d2696cf4ac7ca0d\n</code></pre>"},{"location":"system-source-of-truth/#162-git-status-porcelain","title":"16.2 git status --porcelain","text":"<pre><code>M knip.json\nM package-lock.json\nM package.json\nM services/titan-ai-quant/package.json\nM services/titan-phase2-hunter/package.json\nM services/titan-phase3-sentinel/package.json\n</code></pre>"},{"location":"system-source-of-truth/#163-npm-run-script-inventory","title":"16.3 npm run (script inventory)","text":"<pre><code>start:brain, start:execution, start:console, start:scavenger, \nstart:hunter, start:sentinel, start:powerlaw-lab, start:ai-quant,\nstart:prod, build, test:all, lint:all, lint:fix, format, format:check,\nvalidate:config, sota:circular, sota:arch, sota:complexity, sota:god,\nsota:dead, sota:zombie, sota:secrets, sota:flake, sota:immutability,\nsota:audit, sota:license, ... (60+ scripts)\n</code></pre>"},{"location":"system-source-of-truth/#164-docker-compose-config","title":"16.4 docker compose config","text":"<pre><code>Passes when .env contains all required variables.\nvalidate_prod_env.sh enforces 14 required vars + rejects known defaults.\n</code></pre>"},{"location":"system-source-of-truth/#165-cargo-metadata","title":"16.5 cargo metadata","text":"<pre><code>Package: titan-execution-rs v0.1.0\nDependencies: tokio, async-nats, serde, actix-web, hmac, sha2, \n              opentelemetry, prometheus, crossbeam-channel, etc.\n</code></pre>"},{"location":"system-source-of-truth/#document-verification","title":"Document Verification","text":"<p>To verify this document against the repository state:</p> <pre><code># 1. Verify commit hash\ngit rev-parse HEAD | grep -q \"a77c842f9af7953cec76954d6d2696cf4ac7ca0d\" &amp;&amp; echo \"\u2713 Commit matches\"\n\n# 2. Verify critical artifact hashes\nshasum -a 256 packages/shared/risk_policy.json services/titan-execution-rs/src/risk_policy.json | \\\n  grep -c \"d4fb422e7c5ff4dd7410b254e9dc2cd1c892fd013adb2fa59dec6445a958a2c1\" | \\\n  grep -q 2 &amp;&amp; echo \"\u2713 Risk policy parity confirmed\"\n\n# 3. Run configuration validation\nnpm run validate:config\n\n# 4. Verify NATS ACLs\ngrep -c \"user:\" config/nats.conf  # Should return 8 users\n</code></pre>"},{"location":"system-source-of-truth/#106-reconciliation-truth-convergence","title":"10.6 Reconciliation &amp; Truth Convergence","text":"<p>[!IMPORTANT] Production Standard: Truth is not just \"Event Emitted\", it is \"Exchange Acknowledged and Verified\".</p> <p>The system implements a rigorous Reconciliation Loop to survive WebSocket disconnects and state drift:</p> <ol> <li>Scheduled Reconcile: Every 1 minute, Brain queries the Exchange REST API for open orders and positions.</li> <li>Snapshot Digest: Brain creates a <code>PositionSnapshot</code> containing the authoritative state.</li> <li>Drift Detection:<ul> <li>If <code>Brain State</code> != <code>Exchange State</code>, it enters Truth Degrade Mode.</li> <li>Action: All Risk limits are frozen (no new risk).</li> <li>Self-Healing: Brain emits synthetic checks or alerts operator if manual intervention is needed.</li> </ul> </li> <li>Hard Proof Test:<ul> <li>The system MUST demonstrate convergence without manual cleanup after a simulated 5-minute network partition during active trading.</li> </ul> </li> </ol> <p>Document Generated: 2026-02-10T20:02:00Z Generator: Canonical System Cartographer (AI-Assisted) Verification Status: Evidence-backed from repository artifacts</p>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/","title":"ADR: Quarantined Memory Organ + Console Generative UI","text":""},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#status","title":"Status","text":"<p>Proposed</p>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#context","title":"Context","text":"<p>Titan needs to augment its operator effectiveness and research capabilities with institutional memory (Cognee) and context-aware interfaces (Generative UI). However, Titan's core principles of determinism, verifiable risk safety, and \"execution as truth\" cannot be compromised. The new systems must be useful but strictly quarantined from the execution critical path.</p>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#decision","title":"Decision","text":"<p>We will implement two new \"organs\" as optional, sidecar extensions:</p>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#1-titan-memory-service-cognee-based","title":"1. Titan Memory Service (Cognee-based)","text":"<ul> <li>Architecture: A standalone Node.js/Python service (<code>titan-memory</code>) running Cognee.</li> <li>Role: Ingests runbooks, post-mortems, and non-sensitive logs to provide a semantic search and question-answering graphs.</li> <li>Quarantine:</li> <li>No write access to any production database (Postgres/Redis) used by Brain or Execution.</li> <li>Read-only access to specific, sanitized log streams or documents.</li> <li>No direct network path to <code>titan-execution-rs</code>.</li> <li>Data Classification:</li> <li>PUBLIC: External docs.</li> <li>INTERNAL: Runbooks, non-sensitive logs.</li> <li>SECRET: API keys, PII, strategy secrets (Strictly DENIED).</li> </ul>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#2-console-generative-ui-copilotkit-based","title":"2. Console Generative UI (CopilotKit-based)","text":"<ul> <li>Architecture: Integrated into <code>titan-console</code> (React/Vite) using CopilotKit.</li> <li>Role: Renders context-specific UI components (e.g., \"Show me the drift incident from last Tuesday\") to assist operators.</li> <li>Quarantine:</li> <li>Render-Only/Draft-Only: The agent can only render UI components or pre-fill \"Action Drafts\".</li> <li>Human-in-the-loop: All privileged actions (ARM, FLATTEN) require the standard \"Armed + Double-Confirm\" flow. The AI cannot bypass this.</li> <li>Component Whitelist: The AI can only instantiate components from a strict registry.</li> </ul>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#trust-boundaries","title":"Trust Boundaries","text":"<ol> <li>Memory -&gt; Operator: Advisory only. \"The memory organ suggests X\".</li> <li>GenUI -&gt; Console: Display only. \"Here is a dashboard view of X\".</li> <li>Console -&gt; Brain: Existing API contracts. The AI generates the payload for the API call, but the user clicks the button.</li> </ol>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#interfaces","title":"interfaces","text":"<ul> <li>Memory Service:</li> <li><code>POST /ingest</code> (Admin only)</li> <li><code>POST /search</code> (Internal users)</li> <li><code>GET /health</code></li> <li>GenUI Protocol:</li> <li><code>useCopilotChat</code> hook in Console.</li> <li>Custom tool definitions that map to <code>titan-memory</code> search or local state visualization.</li> </ul>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#failure-modes-default-safe-behavior","title":"Failure Modes &amp; Default-Safe Behavior","text":"<ul> <li>Memory Service Down: Console shows \"Memory Offline\" badge. Search returns empty. Trading continues unaffected.</li> <li>GenUI Hallucination: If AI suggests non-existent component or invalid props, strict schema validation catches it and renders an \"Error Card\".</li> <li>Prompt Injection: Any attempt to inject commands is blocked by the backend's rigorous <code>OperatorAction</code> schema validation and the human confirmation step.</li> </ul>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#metrics","title":"Metrics","text":"<ul> <li><code>memory_ingest_count</code>, <code>memory_search_latency</code></li> <li><code>ui_gen_requests</code>, <code>ui_validation_failures</code></li> <li><code>operator_draft_adoption_rate</code> (how often AI suggestions are used)</li> </ul>"},{"location":"architecture/ADR_quarantined_memory_and_generative_ui/#rollout","title":"Rollout","text":"<ul> <li>Feature Flags: <code>VITE_ENABLE_MEMORY</code>, <code>VITE_ENABLE_COPILOT</code>.</li> <li>Profile: <code>docker-compose --profile optional up -d</code>.</li> </ul>"},{"location":"ci/branch_protection/","title":"Branch Protection Policy for CI","text":""},{"location":"ci/branch_protection/#required-status-checks","title":"Required status checks","text":"<p>For <code>main</code>, require only:</p> <ul> <li><code>CI Pipeline Status</code></li> </ul> <p>All other CI jobs remain active but are non-required and roll up into the aggregator check above.</p>"},{"location":"ci/branch_protection/#why","title":"Why","text":"<ul> <li>Keeps required-check policy stable when CI internals evolve.</li> <li>Prevents branch-protection churn when jobs are split, merged, or renamed.</li> <li>Preserves strict gating because <code>CI Pipeline Status</code> fails on any failed/cancelled required job.</li> </ul>"},{"location":"ci/branch_protection/#admin-update-checklist","title":"Admin update checklist","text":"<ol> <li>Open repository settings for branch protection rules on <code>main</code>.</li> <li>Remove per-job required checks.</li> <li>Add <code>CI Pipeline Status</code> as the only required status check.</li> <li>Save and verify on the next PR that only the aggregator is required.</li> </ol>"},{"location":"components/shared/","title":"@titan/shared","text":"<p>Context: Shared Library Package Location: <code>packages/shared/</code></p> <p>The <code>@titan/shared</code> package provides shared types, NATS clients, risk policy schemas, and utilities consumed by all Titan services.</p> <p>See Repo Structure for package layout details.</p>"},{"location":"components/titan-ai-quant/","title":"Titan AI Quant - Phase 4","text":"<p>Context: Service &gt; AI Research (Quant) Parent: Architecture Knowledge Graph: Map</p> <p>Closed-Loop Parameter Optimization Engine - Maximizes R:R (Risk:Reward) of Phase 1 &amp; 2 strategies through AI-powered analysis and safe configuration updates.</p>"},{"location":"components/titan-ai-quant/#overview","title":"Overview","text":"<p>The Titan AI Quant is a sophisticated offline advisor that analyzes trading performance and proposes safe configuration optimizations. Unlike standard \"AI Trading\" which attempts to predict price, the Titan Quant predicts Parameter Efficiency. It answers one question: \"Given the last 24 hours of market microstructure, what configuration settings would have yielded the highest PnL?\"</p>"},{"location":"components/titan-ai-quant/#key-features","title":"Key Features","text":"<ul> <li>Offline Operation: Zero latency impact on live execution</li> <li>Safety-First: Strict parameter bounds and validation prevent dangerous configurations</li> <li>AI-Powered Analysis: Uses Gemini 2.0 Flash for cost-effective pattern recognition</li> <li>Backtesting Validation: All proposals validated through realistic simulation</li> <li>Interactive UI: Chat interface and approval workflow for human oversight</li> <li>Strategic Memory: Weaviate Vector Database for high-dimensional pattern matching</li> </ul>"},{"location":"components/titan-ai-quant/#quick-start","title":"Quick Start","text":"<pre><code># Install dependencies\nnpm install\n\n# Set up environment variables\ncp .env.example .env\n# Edit .env with your Gemini API key\n\n# Run the system\nnpm run dev\n</code></pre>"},{"location":"components/titan-ai-quant/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     AI Analysis Layer                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u2502  TitanAnalyst    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502   Guardrails     \u2502         \u2502\n\u2502  \u2502  (Gemini API)    \u2502         \u2502  (Safety Check)  \u2502         \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Validation Layer                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u2502   Backtester     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502  Latency Model   \u2502         \u2502\n\u2502  \u2502  (Simulation)    \u2502         \u2502  (Bulgaria Tax)  \u2502         \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Data Layer                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502  \u2502     Journal      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192\u2502 Strategic Memory \u2502         \u2502\n\u2502  \u2502  (Log Parser)    \u2502         \u2502 (Weaviate Vector)\u2502         \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"components/titan-ai-quant/#core-components","title":"Core Components","text":""},{"location":"components/titan-ai-quant/#1-journal-trade-log-parser","title":"1. Journal (Trade Log Parser)","text":"<p>Converts raw execution data into AI-readable narratives with regime context.</p> <p>Key Features: - Streaming parser for large <code>trades.jsonl</code> files - Correlates trades with regime snapshots (volatility, trend, liquidity) - Token-efficient narratives for cost-effective AI analysis - Filters failed trades for pattern analysis</p>"},{"location":"components/titan-ai-quant/#2-titananalyst-ai-engine","title":"2. TitanAnalyst (AI Engine)","text":"<p>Uses Gemini 2.0 Flash to analyze patterns and generate optimization proposals.</p> <p>Capabilities: - Pattern recognition in failed trades - Time-of-day correlation analysis - Symbol-specific issue detection - Regime-aware optimization proposals</p>"},{"location":"components/titan-ai-quant/#3-strategic-memory-weaviate-vector-database","title":"3. Strategic Memory (Weaviate Vector Database)","text":"<p>Persistent learning system that uses vector embeddings to match current market conditions with historical patterns.</p> <p>Capabilities: - Semantic search over trade history - Regime similarity matching (e.g. \"Find times when Volatility &gt; 5% and Trend was Flat\") - Outcome persistence for optimization proposals</p>"},{"location":"components/titan-ai-quant/#4-guardrails-safety-system","title":"4. Guardrails (Safety System)","text":"<p>Prevents dangerous configurations through strict validation.</p> <p>Protection: - Parameter bounds enforcement - Schema validation against config structure - Anti-hallucination checks for AI outputs - Type validation for all proposed values</p>"},{"location":"components/titan-ai-quant/#5-backtester-validation-engine","title":"5. Backtester (Validation Engine)","text":"<p>Simulates proposed changes against historical data with realistic execution modeling.</p> <p>Features: - Latency penalty application (Bulgaria Tax) - Slippage modeling based on volatility - PnL and drawdown comparison - Automatic rejection of poor proposals</p>"},{"location":"components/titan-ai-quant/#configuration","title":"Configuration","text":""},{"location":"components/titan-ai-quant/#environment-variables","title":"Environment Variables","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># Gemini AI Configuration\nGEMINI_API_KEY=your_gemini_api_key_here\n\n# Rate Limiting (optional)\nMAX_REQUESTS_PER_MINUTE=10\n\n# Weaviate Configuration\nWEAVIATE_SCHEME=http\nWEAVIATE_HOST=localhost:8080\nWEAVIATE_API_KEY= # Optional for local, required for cloud\n\n# Logging (optional)\nLOG_LEVEL=info\nERROR_LOG_PATH=./logs/ai-quant-errors.log\n</code></pre>"},{"location":"components/titan-ai-quant/#parameter-bounds","title":"Parameter Bounds","text":"<p>The system enforces strict safety bounds on all parameters:</p> <pre><code>const PARAMETER_BOUNDS = {\n  'max_leverage': { min: 1, max: 10 },\n  'stop_loss': { min: 0.001, max: 0.05 },        // 0.1% to 5%\n  'risk_per_trade': { min: 0.001, max: 0.05 },   // 0.1% to 5%\n  'take_profit': { min: 0.005, max: 0.20 },      // 0.5% to 20%\n  'trailing_stop': { min: 0.001, max: 0.05 },    // 0.1% to 5%\n  'cooldown_period': { min: 0, max: 3600 },      // 0 to 1 hour\n  'max_daily_loss': { min: 0.01, max: 0.20 },    // 1% to 20%\n  'max_position_size': { min: 0.1, max: 1.0 },   // 10% to 100%\n}\n</code></pre> <p>Rationale: - Leverage Cap (20x): Prevents excessive risk while allowing aggressive strategies - Stop Loss Range: Balances protection vs. premature exits - Risk Per Trade: Ensures position sizing stays within Kelly Criterion bounds - Daily Loss Limit: Circuit breaker for bad market days</p>"},{"location":"components/titan-ai-quant/#chat-interface-commands","title":"Chat Interface Commands","text":"<p>Access the AI chat interface with <code>Cmd+K</code> (or <code>Ctrl+K</code> on Windows/Linux).</p>"},{"location":"components/titan-ai-quant/#available-commands","title":"Available Commands","text":"Command Description Example <code>/analyze</code> Analyze last 24 hours of trades <code>/analyze</code> <code>/optimize [symbol]</code> Generate optimization for specific symbol <code>/optimize SOL</code> <code>/insights</code> Show recent AI insights <code>/insights</code> <code>/status</code> Display system status and proposals <code>/status</code> <code>/help</code> Show command help <code>/help</code>"},{"location":"components/titan-ai-quant/#command-examples","title":"Command Examples","text":"<pre><code># Analyze recent performance\n&gt; /analyze\n\ud83e\udd16 Analyzing 47 trades from the last 24 hours...\nFound 3 patterns:\n1. [85%] SOL trades during 14:00-16:00 UTC show 12% higher slippage\n2. [72%] AVAX stop losses triggered prematurely in low volatility periods\n3. [68%] ETH funding spike traps underperforming during weekend sessions\n\n# Optimize specific symbol\n&gt; /optimize BTC\n\ud83e\udd16 Generating optimization for BTC...\nProposal: Increase stop_loss from 0.015 to 0.018 (+20%)\nReasoning: BTC volatility increased 15% this week, wider stops reduce noise\nExpected Impact: +3.2% PnL, +1.1% risk\nConfidence: 78%\n\n# Check system status\n&gt; /status\n\ud83d\udcca System Status\nConfig Version: v1734-p42\nPending Proposals: 1\nApplied Proposals: 8\nRejected Proposals: 3\n</code></pre>"},{"location":"components/titan-ai-quant/#prompt-engineering-strategy","title":"Prompt Engineering Strategy","text":"<p>The AI system uses carefully crafted prompts to ensure consistent, actionable outputs.</p>"},{"location":"components/titan-ai-quant/#analysis-prompt-template","title":"Analysis Prompt Template","text":"<p>Purpose: Identify patterns in failed trades Input: Failed trade narratives with regime context Output: Structured insights with confidence scores</p> <p>Key Elements: - Recent insights for context continuity - Time period specification for relevance - Failed trade narratives with regime data - Specific analysis dimensions (time, symbol, regime, trap type, slippage) - JSON output format for reliable parsing</p>"},{"location":"components/titan-ai-quant/#optimization-prompt-template","title":"Optimization Prompt Template","text":"<p>Purpose: Map insights to specific configuration changes Input: Insight text, current config schema, relevant values Output: Single parameter change proposal</p> <p>Constraints: - Only modify existing parameters - Respect parameter bounds - Propose ONE change per insight - Include reasoning and impact estimates - JSON output with expected structure</p>"},{"location":"components/titan-ai-quant/#anti-hallucination-measures","title":"Anti-Hallucination Measures","text":"<ol> <li>Schema Validation: All proposals validated against Zod config schema</li> <li>Parameter Bounds: Numeric values checked against safety limits</li> <li>Key Existence: Target keys verified in configuration structure</li> <li>Type Checking: Value types matched to expected schema types</li> <li>Structured Output: JSON format prevents free-form hallucinations</li> </ol>"},{"location":"components/titan-ai-quant/#reading-optimization-reports","title":"Reading Optimization Reports","text":""},{"location":"components/titan-ai-quant/#proposal-structure","title":"Proposal Structure","text":"<pre><code>{\n  \"targetKey\": \"traps.oi_wipeout.stop_loss\",\n  \"currentValue\": 0.02,\n  \"suggestedValue\": 0.025,\n  \"reasoning\": \"SOL trades show 15% higher success with wider stops during high volatility periods\",\n  \"expectedImpact\": {\n    \"pnlImprovement\": 5.2,      // Expected PnL increase (%)\n    \"riskChange\": 2.1,          // Risk increase (%)\n    \"confidenceScore\": 0.78     // AI confidence (0-1)\n  }\n}\n</code></pre>"},{"location":"components/titan-ai-quant/#validation-report","title":"Validation Report","text":"<pre><code>{\n  \"passed\": true,\n  \"backtestPeriod\": {\n    \"start\": 1703980800000,\n    \"end\": 1704067200000\n  },\n  \"baselineMetrics\": {\n    \"totalPnL\": 2.34,\n    \"maxDrawdown\": 0.08,\n    \"winRate\": 0.65,\n    \"sharpeRatio\": 1.42\n  },\n  \"proposedMetrics\": {\n    \"totalPnL\": 2.56,           // +9.4% improvement\n    \"maxDrawdown\": 0.09,        // +12.5% increase (acceptable)\n    \"winRate\": 0.68,            // +4.6% improvement\n    \"sharpeRatio\": 1.51         // +6.3% improvement\n  },\n  \"recommendation\": \"approve\"\n}\n</code></pre>"},{"location":"components/titan-ai-quant/#interpreting-results","title":"Interpreting Results","text":"<p>Green Flags (Approve): - PnL improvement &gt; 2% - Drawdown increase &lt; 15% - Win rate maintained or improved - Confidence score &gt; 0.7</p> <p>Yellow Flags (Review): - PnL improvement 0-2% - Drawdown increase 10-15% - Confidence score 0.5-0.7</p> <p>Red Flags (Reject): - PnL decrease or no improvement - Drawdown increase &gt; 15% - Win rate decrease &gt; 5% - Confidence score &lt; 0.5</p>"},{"location":"components/titan-brain/","title":"Titan Brain (Orchestrator)","text":"<p>Context: Backend Service (TypeScript) Port: 3100 Role: Orchestration, Risk Management, Phase Coordination. Status: Verified against Codebase (Jan 26, 2026)</p>"},{"location":"components/titan-brain/#key-files","title":"Key Files","text":"<ul> <li><code>src/index.ts</code>: Entry point. Starts Fastify and NATS.</li> <li><code>src/flow/Signalprocessor.ts</code>: Core logic for handling incoming phase signals.</li> <li><code>src/risk/CircuitBreaker.ts</code>: System-wide safety switch.</li> <li><code>src/services/config/ConfigRegistry.ts</code>: Runtime configuration catalog with safety enforcement, overrides, and audit receipts.</li> <li><code>src/server/controllers/ConfigController.ts</code>: REST API for configuration management (catalog, overrides, presets).</li> <li><code>src/db/</code>: Database schema and migrations (PostgreSQL).</li> </ul>"},{"location":"components/titan-brain/#configuration-management","title":"Configuration Management","text":"<p>The Brain hosts the <code>ConfigRegistry</code> \u2014 a catalog-based runtime configuration system. See Configuration for full details.</p> <ul> <li>Catalog: All tunable parameters defined in <code>CONFIG_CATALOG</code> with safety constraints and schemas.</li> <li>Overrides: Runtime overrides via <code>POST /config/override</code> with tighten-only / raise-only enforcement.</li> <li>Presets: Three built-in profiles (Conservative, Balanced, Aggressive) via <code>POST /config/preset/:name</code>.</li> <li>Receipts: HMAC-signed audit trail for all configuration changes.</li> </ul>"},{"location":"components/titan-brain/#dependencies","title":"Dependencies","text":"<ul> <li>Upstream: Receives signals from <code>titan-phase*</code> services.</li> <li>Downstream: Sends commands to <code>titan-execution-rs</code>.</li> <li>Database: Connects to <code>postgres</code> (primary) and <code>redis</code> (cache).</li> </ul>"},{"location":"components/titan-brain/#documentation","title":"Documentation","text":"<ul> <li>API Reference \u2014 Detailed request/response examples.</li> </ul>"},{"location":"components/titan-brain/#architecture-deep-dive","title":"Architecture Deep Dive","text":"<p>Note: This section was merged from <code>docs/architecture/titan-brain.md</code>.</p>"},{"location":"components/titan-brain/#core-engines","title":"Core Engines","text":"<p>The Brain is composed of specialized \"Engines\" that run in a unified Fastify process.</p>"},{"location":"components/titan-brain/#active-inference-engine-amygdala","title":"Active Inference Engine (\"Amygdala\")","text":"<p>Source: <code>src/engine/ActiveInferenceEngine.ts</code></p> <p>Implements a biological \"Surprise\" metric to modulate system aggression.</p> <ul> <li>Concept: Minimization of Variational Free Energy (VFE).</li> <li>Mechanism:</li> <li>Maintains a rolling window of market returns.</li> <li>Compares observed returns against an \"Expected Distribution\" (Gaussian).</li> <li>Calculates KL Divergence (Surprise).</li> <li>Maps Surprise to a Cortisol Level (0.0 to 1.0) using a Sigmoid activation function.</li> <li>Effect: High Cortisol triggers \"Freeze\" or defensive modes, reducing allocation leverage.</li> </ul>"},{"location":"components/titan-brain/#governance-engine-prefrontal-cortex","title":"Governance Engine (\"Prefrontal Cortex\")","text":"<p>Source: <code>src/engine/GovernanceEngine.ts</code></p> <p>Enforces policy and structural rules.</p> <ul> <li>Manages global \"Defcon\" levels.</li> <li>Validates all outgoing Intents against the Global Risk Policy.</li> <li>Interlocks with the \"Manual Override Service\" to allow operator intervention.</li> </ul>"},{"location":"components/titan-brain/#accounting-service-phase-4","title":"Accounting Service (Phase 4)","text":"<p>Source: <code>src/services/accounting/AccountingService.ts</code></p> <p>The \"Truth Arbiter\" responsible for reconciling Intents (Plans) with Fills (Reality).</p> <ul> <li>Ingress Tracking: Subscribes to <code>titan.cmd.execution.place.v1.&gt;</code> to mark when an Intent was broadcast.</li> <li>Fill Reconciliation: Matches fills from <code>titan.evt.execution.fill.v1</code> against active Intents.</li> <li>Shadow Fills: Subscribes to <code>titan.evt.execution.shadow_fill.v1</code> to compare \"Simulation\" vs \"Reality\".</li> <li>Drift Detection:</li> <li>Calculates <code>driftPct</code> between Real Price and Shadow Price.</li> <li>Alerts <code>titan.evt.alert.drift.v1</code> if deviation &gt; 0.1%.</li> <li>Ledger Posting: Posts normalized transactions to the General Ledger (Postgres).</li> </ul>"},{"location":"components/titan-brain/#event-loop-integration","title":"Event Loop &amp; Integration","text":"<p>Titan Brain uses a NATS-First architecture.</p> Subject Direction Purpose <code>titan.cmd.execution.place.v1.&gt;</code> Outbound Validated Intents sent to Execution Engine. <code>titan.evt.{phase}.signal.v1</code> Inbound Strategies (Scavenger/Hunter/Sentinel) submitting signals. <code>titan.evt.execution.fill.v1</code> Inbound Confirmation of trades from Execution. <code>titan.evt.alert.drift.v1</code> Outbound Critical alerts for pricing deviations."},{"location":"components/titan-brain/#data-persistence","title":"Data Persistence","text":"<ul> <li>PostgreSQL: Primary store for configuration, risk state, and ledgers.</li> <li>Redis (Optional): Used for signal queues and hot configuration. If disabled, falls back to in-memory queues (verified in <code>src/index.ts</code>).</li> </ul>"},{"location":"components/titan-brain/#startup-safety","title":"Startup &amp; Safety","text":"<p>StartupManager:</p> <ul> <li>Enforces a deterministic initialization sequence (Env -&gt; Config -&gt; DB -&gt; NATS -&gt; Engine -&gt; Server).</li> <li>Enforces a 5-minute (300s) maximum startup time window (<code>maxStartupTime</code>).</li> <li>Registers graceful shutdown handlers for all components (Worker, WebSocket, NATS).</li> </ul>"},{"location":"components/titan-console-api/","title":"BFF (Backend for Frontend)","text":"<p>Context: Service &gt; BFF (Backend for Frontend) Parent: Architecture Knowledge Graph: Map</p>"},{"location":"components/titan-console-api/#overview","title":"Overview","text":"<p>Service documentation pending.</p>"},{"location":"components/titan-console/","title":"Titan Console","text":"<p>Context: Frontend Application (React/Vite) Port: 3001 Role: Operator Interface, Monitoring, Manual Control.</p>"},{"location":"components/titan-console/#key-files","title":"Key Files","text":"<ul> <li><code>src/App.tsx</code>: Main application shell.</li> <li><code>src/components/</code>: Reusable UI components.</li> <li><code>src/components/settings/ConfigItemRenderer.tsx</code>: Generic renderer for config items (slider, input, toggle, select, secret widgets).</li> <li><code>src/hooks/useConfig.ts</code>: Config management hooks \u2014 catalog, effective values, overrides, presets.</li> <li><code>src/pages/</code>: Route pages (Dashboard, Settings, etc.).</li> </ul>"},{"location":"components/titan-console/#settings-page","title":"Settings Page","text":"<p>The Settings page (<code>src/pages/Settings.tsx</code>) provides the operator interface for runtime configuration:</p> <ul> <li>Dynamic rendering: Config items are fetched from <code>GET /config/catalog</code> and rendered based on their <code>widget</code> type.</li> <li>Provenance badges: Each value shows its source \u2014 <code>default</code>, <code>env</code>, or <code>override</code>.</li> <li>Save with reason: Overrides are applied via <code>POST /config/override</code> with a required audit reason.</li> <li>Rollback: Active overrides can be rolled back to the previous value with one click.</li> <li>Preset profiles: Quick-apply buttons for Conservative, Balanced, and Aggressive risk profiles.</li> <li>Categories: Items are grouped across Trading, Safety, and Execution tabs.</li> </ul>"},{"location":"components/titan-console/#dependencies","title":"Dependencies","text":"<ul> <li>API: Connects to <code>titan-brain</code> (REST/WS) and <code>titan-execution</code> (WS).</li> <li>Styling: Uses Tailwind CSS &amp; Radix UI.</li> </ul>"},{"location":"components/titan-execution-rs/","title":"Titan Execution (Motor)","text":"<p>Context: Backend Service (Rust) Port: 3002 Role: Order Execution, Exchange Connectivity, HMAC Verification.</p>"},{"location":"components/titan-execution-rs/#key-files","title":"Key Files","text":"<ul> <li><code>src/main.rs</code>: Entry point, adapter bootstrap.</li> <li><code>src/nats_engine.rs</code>: NATS event loop and command processing.</li> <li><code>src/risk_guard.rs</code>: Final risk check before exchange submission.</li> <li><code>src/security.rs</code>: HMAC signature verification logic.</li> <li><code>src/exchange/</code>: 17 exchange adapters (10 CEX + 7 DEX).</li> </ul>"},{"location":"components/titan-execution-rs/#dependencies","title":"Dependencies","text":"<ul> <li>Upstream: Receives commands from <code>titan-brain</code>.</li> <li>Downstream: Connects to Exchange APIs:</li> <li>CEX: Binance, Bybit, OKX, Coinbase, Kraken, KuCoin, Gate.io, MEXC, Crypto.com, dYdX</li> <li>DEX: Uniswap, PancakeSwap, SushiSwap, Curve, Jupiter, GMX, Hyperliquid</li> <li>Safety: ENFORCES <code>risk_policy.json</code> (compiled in).</li> </ul>"},{"location":"components/titan-execution-rs/#staging-deployment","title":"Staging Deployment","text":"<ul> <li>Docker image: Built from <code>rust:latest</code> (stable Rust 2021 edition).</li> <li>Compose: <code>docker-compose.micro.yml</code> \u2014 requires <code>HMAC_SECRET</code> env var.</li> </ul>"},{"location":"components/titan-opsd/","title":"Operations Daemon","text":"<p>Context: Service &gt; Operations Daemon Parent: Architecture Knowledge Graph: Map</p>"},{"location":"components/titan-opsd/#overview","title":"Overview","text":"<p>Service documentation pending.</p>"},{"location":"components/titan-phase1-scavenger/","title":"Titan Scavenger (Phase 1)","text":"<p>Context: Strategy Service (TypeScript/React-based) Port: 8081 Role: Predestination Trap System (Account Builder).</p>"},{"location":"components/titan-phase1-scavenger/#key-files","title":"Key Files","text":"<ul> <li><code>src/index.tsx</code>: Entry point.</li> <li><code>src/App.tsx</code>: Main logic loop.</li> </ul>"},{"location":"components/titan-phase1-scavenger/#dependencies","title":"Dependencies","text":"<ul> <li>Output: Emits <code>titan.evt.scavenger.signal.v1</code> to Brain.</li> <li>Input: Listens to <code>titan.evt.market.*</code> (Market Data).</li> </ul>"},{"location":"components/titan-phase2-hunter/","title":"Titan Hunter (Phase 2)","text":"<p>Context: Strategy Service (TypeScript) Port: 8083 Role: Momentum &amp; Trend Following (Growth Engine).</p>"},{"location":"components/titan-phase2-hunter/#key-files","title":"Key Files","text":"<ul> <li><code>src/index.ts</code>: Entry point.</li> </ul>"},{"location":"components/titan-phase2-hunter/#dependencies","title":"Dependencies","text":"<ul> <li>Output: Emits <code>titan.evt.hunter.signal.v1</code> to Brain.</li> <li>Input: Listens to <code>titan.evt.market.*</code> (Market Data).</li> </ul>"},{"location":"components/titan-phase3-sentinel/","title":"Titan Phase 3 - The Sentinel","text":"<p>Context: Service &gt; Strategy (Sentinel) Parent: Architecture Knowledge Graph: Map</p> <p>Market-neutral hedge fund system for basis arbitrage, funding rate collection, and vacuum arbitrage during liquidation events.</p>"},{"location":"components/titan-phase3-sentinel/#overview","title":"Overview","text":"<p>The Sentinel is an institutional-grade market-neutral hedge fund system that treats the basis (the spread between spot and perpetual futures prices) as a tradable asset class. Unlike passive funding rate arbitrage bots that simply hold positions, The Sentinel actively scalps basis expansion and contraction while maintaining delta neutrality.</p>"},{"location":"components/titan-phase3-sentinel/#three-distinct-edges","title":"Three Distinct Edges","text":"<ol> <li>Passive Edge: Collecting funding rates (the \"carry\")</li> <li>Active Edge: Scalping basis fluctuations (the \"basis trade\")</li> <li>Structural Edge: Absorbing liquidations neutrally (the \"vacuum arb\")</li> </ol>"},{"location":"components/titan-phase3-sentinel/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Titan Sentinel Core                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Statistical \u2502  \u2502  Execution   \u2502  \u2502  Portfolio   \u2502          \u2502\n\u2502  \u2502    Engine    \u2502\u2500\u2500\u2502    Engine    \u2502\u2500\u2500\u2502   Manager    \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502         \u2502                  \u2502                  \u2502                  \u2502\n\u2502         \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502                  \u2502\n\u2502         \u2502          \u2502  Polymarket  \u2502           \u2502                  \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Arb Engine  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                            \u2502                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                            \u2502                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502   Exchange   \u2502  \u2502   Exchange   \u2502  \u2502  Prediction  \u2502          \u2502\n\u2502  \u2502   Gateway    \u2502  \u2502   Gateway    \u2502  \u2502   Market     \u2502          \u2502\n\u2502  \u2502  (Binance)   \u2502  \u2502   (Bybit)    \u2502  \u2502 (Polymarket) \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"components/titan-phase3-sentinel/#quick-start-production","title":"Quick Start (Production)","text":"<p>Run as part of the full Titan stack:</p> <p>Production Ready (Jan 2026).</p> <pre><code>cd ../..\ncd ../..\ndocker compose up -d titan-phase3-sentinel\n</code></pre>"},{"location":"components/titan-phase3-sentinel/#docker-configuration","title":"Docker Configuration","text":"<p>Uses multi-stage build (Alpine Linux) for minimal footprint. - Image: <code>node:22-alpine</code> \u2192 <code>titan/phase3-sentinel:latest</code> - Healthcheck: <code>wget --no-verbose --tries=1 --spider http://localhost:8084/health</code></p>"},{"location":"components/titan-phase3-sentinel/#manual-installation","title":"Manual Installation","text":"<pre><code>cd services/titan-phase3-sentinel\nnpm install\n</code></pre>"},{"location":"components/titan-phase3-sentinel/#development","title":"Development","text":"<pre><code># Build TypeScript\nnpm run build\n\n# Run tests\nnpm test\n\n# Run specific test suites\nnpm run test:unit\nnpm run test:property\nnpm run test:integration\n\n# Watch mode\nnpm run test:watch\n</code></pre>"},{"location":"components/titan-phase3-sentinel/#project-structure","title":"Project Structure","text":"<pre><code>titan-phase3-sentinel/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 types/           # TypeScript interfaces and types\n\u2502   \u251c\u2500\u2500 engine/          # Statistical engine (basis analysis, Z-Score)\n\u2502   \u251c\u2500\u2500 execution/       # Atomic execution, TWAP slicing\n\u2502   \u251c\u2500\u2500 portfolio/       # Portfolio management, rebalancing\n\u2502   \u251c\u2500\u2500 exchanges/       # Exchange gateways, routing\n\u2502   \u251c\u2500\u2500 polymarket/      # Polymarket arbitrage engine\n\u2502   \u2514\u2500\u2500 console/         # Terminal dashboard (Ink/React)\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/            # Unit tests\n\u2502   \u251c\u2500\u2500 property/        # Property-based tests (fast-check)\n\u2502   \u2514\u2500\u2500 integration/     # Integration tests\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 jest.config.cjs\n</code></pre>"},{"location":"components/titan-phase3-sentinel/#key-components","title":"Key Components","text":""},{"location":"components/titan-phase3-sentinel/#statistical-engine","title":"Statistical Engine","text":"<ul> <li>Rolling statistics with Welford's algorithm</li> <li>Z-Score calculation for basis classification</li> <li>Depth-weighted basis calculation</li> </ul>"},{"location":"components/titan-phase3-sentinel/#execution-engine","title":"Execution Engine","text":"<ul> <li>Atomic spot/perpetual execution</li> <li>TWAP order slicing for large orders</li> <li>Abort handling for partial fills</li> </ul>"},{"location":"components/titan-phase3-sentinel/#portfolio-manager","title":"Portfolio Manager","text":"<ul> <li>Position tracking (CORE, SATELLITE, VACUUM)</li> <li>Automated rebalancing (Tier 1, Tier 2, Compounding)</li> <li>Risk management with delta limits</li> </ul>"},{"location":"components/titan-phase3-sentinel/#polymarket-arbitrage-engine","title":"Polymarket Arbitrage Engine","text":"<ul> <li>Latency arbitrage between Binance and Polymarket</li> <li>Real-time price velocity detection</li> <li>CTF Exchange integration</li> </ul>"},{"location":"components/titan-phase3-sentinel/#configuration","title":"Configuration","text":"<p>Environment variables: - <code>BINANCE_API_KEY</code> - Binance API key - <code>BINANCE_API_SECRET</code> - Binance API secret - <code>BYBIT_API_KEY</code> - Bybit API key - <code>BYBIT_API_SECRET</code> - Bybit API secret - <code>POLYGON_RPC_URL</code> - Polygon RPC endpoint for Polymarket - <code>POLYMARKET_PRIVATE_KEY</code> - Private key for Polymarket signing - <code>TITAN_URL</code> - Titan Brain URL (internal) - <code>PROMETHEUS_METRICS</code> - Enable metrics (default: true)</p>"},{"location":"components/titan-phase3-sentinel/#risk-parameters","title":"Risk Parameters","text":"<p>Default risk limits: - Maximum delta: 2% (warning), 5% (critical) - Maximum position size: $50,000 - Maximum leverage: 3x - Daily drawdown limit: 5% (phase-specific; global system limit is -$1,000 per risk_policy) - Critical drawdown: 10% (phase-specific override)</p>"},{"location":"components/titan-phase3-sentinel/#license","title":"License","text":"<p>MIT</p>"},{"location":"components/titan-powerlaw-lab/","title":"Titan Power Law Lab (Phase 4 Research)","text":"<p>Context: Service &gt; Research Lab Status: Experimental / Lab Role: Research into Fractal Market Analysis and Tail Estimation.</p> <p>Research environment for power law distribution analysis, market fractal validation, and Gemini AI integration. This service acts as the \"Sandbox\" for the Titan AI Quant phase.</p>"},{"location":"components/titan-powerlaw-lab/#purpose","title":"Purpose","text":"<ul> <li>Fractal Validation: Confirming power law scaling in price action.</li> <li>Parameter Optimization: Using Gemini AI to find optimal parameters for Scavenger/Hunter/Sentinel phases.</li> <li>Backtesting: Running historical simulations.</li> </ul>"},{"location":"components/titan-powerlaw-lab/#installation","title":"Installation","text":"<pre><code>npm install\n</code></pre>"},{"location":"components/titan-powerlaw-lab/#usage","title":"Usage","text":"<pre><code># Run fractal analysis\nnpm run start:prod -- --mode=analyze --symbol=BTCUSDT\n\n# Run AI optimization cycle\nnpm run optimize:ai\n</code></pre>"},{"location":"components/titan-powerlaw-lab/#status","title":"Status","text":"<p>Production Ready (Jan 2026). Consumes NATS events for real-time Hill Alpha calculation.</p>"},{"location":"components/titan-powerlaw-lab/#architecture-deep-dive","title":"Architecture Deep Dive","text":"<p>Note: This section was merged from <code>docs/architecture/titan-powerlaw-lab.md</code>.</p> <p>The PowerLaw Lab (<code>services/titan-powerlaw-lab</code>) is an experimental service designed to analyze market structure using non-Gaussian statistical methods. It is currently isolated from the hot-path execution loop.</p>"},{"location":"components/titan-powerlaw-lab/#core-research-modules","title":"Core Research Modules","text":"<p>Source: <code>src/</code></p> <ul> <li>Tail Estimators (<code>tail-estimators.ts</code>): Implements Hill Estimators or similar power-law tail index calculations to detect phase shifts in market volatility.</li> <li>Volatility Clustering (<code>volatility-cluster.ts</code>): Analysis of volatility persistence (GARCH-like or fractal dimension analysis).</li> <li>Estimator (<code>estimator.ts</code>): Base abstractions for statistical estimation.</li> </ul>"},{"location":"components/titan-powerlaw-lab/#integration-status","title":"Integration Status","text":"<ul> <li>Trigger: Currently runs as a standalone analysis service or via manual invocation.</li> <li>Output: Generates analysis reports/metrics; publishes to <code>titan.data.powerlaw.metrics.v1.*</code> and <code>titan.evt.powerlaw.*</code> subjects.</li> <li>Purpose: Validating the \"Bulgaria Tax\" hypothesis (fat tails) before integration into the Risk Guardian.</li> </ul>"},{"location":"components/titan-powerlaw-lab/#roadmap","title":"Roadmap","text":"<ol> <li>Validation: Backtest power-law signals against historical crash events.</li> <li>Integration: Connect to Brain as a \"Veto\" signal via <code>titan.evt.powerlaw.impact.v1</code> (e.g., \"High Tail Risk\" \u2192 Reduce Leverage).</li> <li>Production: Promote to a full \"Phase\" or specialized Risk Module.</li> </ol>"},{"location":"connectivity/local-demo/","title":"Titan Connectivity Layer - Local Demo","text":""},{"location":"connectivity/local-demo/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker with <code>docker compose</code></li> <li>Node.js 20+</li> <li>NATS CLI (optional, for debugging)</li> </ul>"},{"location":"connectivity/local-demo/#quick-start","title":"Quick Start","text":"<pre><code># Terminal 1: Start NATS\ndocker compose up nats -d\n\n# Terminal 2: Start Hunter\ncd services/titan-phase2-hunter &amp;&amp; npm run dev\n\n# Terminal 3: Start Brain\ncd services/titan-brain &amp;&amp; npm run dev\n\n# Terminal 4: Verify\ncurl http://localhost:3000/venues | jq\ncurl http://localhost:3000/venues/summary | jq\ncurl http://localhost:3000/health | jq\n</code></pre>"},{"location":"connectivity/local-demo/#expected-output","title":"Expected Output","text":""},{"location":"connectivity/local-demo/#venuessummary","title":"/venues/summary","text":"<pre><code>{\n  \"connected\": 4,\n  \"total\": 8,\n  \"stale\": 0,\n  \"lastUpdate\": \"2026-02-05T15:30:00Z\"\n}\n</code></pre>"},{"location":"connectivity/local-demo/#venues","title":"/venues","text":"<p>Returns array of venue status objects with:</p> <ul> <li><code>venue</code>: Venue identifier</li> <li><code>state</code>: CONNECTED, DEGRADED, or DISCONNECTED</li> <li><code>latencyP50Ms</code>, <code>latencyP99Ms</code>: Latency percentiles</li> <li><code>messageCount</code>: Total messages received</li> <li><code>stale</code>: Boolean flag if no update in 5 seconds</li> </ul>"},{"location":"connectivity/local-demo/#staleness-test","title":"Staleness Test","text":"<ol> <li>Stop Hunter process</li> <li>Wait 5 seconds</li> <li><code>curl /venues</code> shows <code>\"stale\": true</code> for all venues</li> </ol>"},{"location":"connectivity/nats-topology/","title":"Titan Connectivity Layer - NATS Topology","text":""},{"location":"connectivity/nats-topology/#subjects","title":"Subjects","text":"Subject Purpose Producer Consumer <code>titan.data.venues.status.v1</code> Venue WebSocket health Hunter Brain <code>titan.data.venues.trades.v1.{venue}.{symbol}</code> Normalized trades Hunter Any"},{"location":"connectivity/nats-topology/#streams","title":"Streams","text":"Stream Retention Max Age Storage <code>TITAN_VENUE_STATUS</code> Limits 15 min Memory <code>TITAN_MARKET_TRADES</code> Limits 1 hour Memory"},{"location":"connectivity/nats-topology/#kv-buckets","title":"KV Buckets","text":"Bucket Purpose TTL <code>titan-venue-status</code> Last-known venue state 5 min"},{"location":"connectivity/nats-topology/#consumer-configuration","title":"Consumer Configuration","text":"<pre><code># Brain venue status consumer\nname: BRAIN_VENUES_STATUS\ndurable: true\nfilter_subject: titan.data.venues.status.v1\ndeliver_policy: last_per_subject\nack_policy: explicit\nmax_ack_pending: 100\n</code></pre>"},{"location":"connectivity/nats-topology/#nats-client-sdk","title":"NATS Client SDK","text":"<p>Location: <code>packages/shared/src/messaging/NatsClient.ts</code></p> <p>Features:</p> <ul> <li>Automatic reconnection with exponential backoff</li> <li>JetStream publish/subscribe</li> <li>KV bucket operations</li> <li>Connection health monitoring</li> </ul>"},{"location":"connectivity/schemas/","title":"Titan Connectivity Layer - Schemas","text":""},{"location":"connectivity/schemas/#overview","title":"Overview","text":"<p>All schemas live in <code>packages/shared/src/schemas/</code> and are validated with Zod.</p>"},{"location":"connectivity/schemas/#venuestatusv1","title":"VenueStatusV1","text":"<p>Location: <code>venue-status.ts</code></p> <pre><code>interface VenueStatusV1 {\n  venue: VenueId;\n  state: 'CONNECTED' | 'DEGRADED' | 'DISCONNECTED';\n  timestamp: number;\n  lastMessageTime: number;\n  messageCount: number;\n  latencyP50Ms?: number;\n  latencyP99Ms?: number;\n  errorCount: number;\n  parseErrors: number;\n}\n</code></pre>"},{"location":"connectivity/schemas/#markettradev1","title":"MarketTradeV1","text":"<p>Location: <code>market-trade.ts</code></p> <pre><code>interface MarketTradeV1 {\n  venue: VenueId;\n  symbol: string;      // Canonical format: BTC/USDT\n  side: 'buy' | 'sell';\n  price: string;       // Decimal string\n  quantity: string;    // Decimal string\n  timestamp: number;   // Epoch ms\n  tradeId: string;\n  exchange_ts?: number;\n}\n</code></pre>"},{"location":"connectivity/schemas/#symbol-normalization","title":"Symbol Normalization","text":"<p>Location: <code>normalize-symbol.ts</code></p> Function Purpose <code>normalizeSymbol(venue, raw)</code> Raw \u2192 Canonical (e.g., <code>BTCUSDT</code> \u2192 <code>BTC/USDT</code>) <code>denormalizeSymbol(venue, canonical)</code> Canonical \u2192 Exchange-native <p>Tested with 33 unit tests covering all supported venues.</p>"},{"location":"contracts/","title":"Data Contracts &amp; Schemas","text":"<p>\u2190 Back to Index</p> <ul> <li>NATS Intents \u2014 Command schemas.</li> </ul>"},{"location":"contracts/jetstream-topology/","title":"TITAN JetStream Topology Reference","text":"<p>Canonical reference for all NATS JetStream streams, consumers, and KV buckets.</p>"},{"location":"contracts/jetstream-topology/#streams","title":"Streams","text":"Stream Subjects Retention Storage Max Age Max Bytes Duplicate Window Purpose <code>TITAN_CMD</code> <code>titan.cmd.&gt;</code> WorkQueue File 7d \u2014 60s Commands \u2014 exactly-once delivery, deduped <code>TITAN_EVT</code> <code>titan.evt.&gt;</code> Limits File 30d 10 GB \u2014 Events \u2014 durable audit trail <code>TITAN_DATA</code> <code>titan.data.&gt;</code> Limits Memory 15m \u2014 \u2014 Market data \u2014 ephemeral, fast <code>TITAN_SIGNAL</code> <code>titan.signal.&gt;</code> Limits File 1d 5 GB \u2014 Brain signals \u2014 short-lived <code>TITAN_DLQ</code> <code>titan.dlq.&gt;</code> Limits File 30d 1 GB \u2014 Dead-letter queue \u2014 failed messages <code>TITAN_VENUE_STATUS</code> <code>titan.data.venues.status.v1</code> Limits Memory 24h \u2014 \u2014 Venue health telemetry <code>TITAN_MARKET_TRADES</code> <code>titan.data.venues.trades.v1.&gt;</code> Limits File 7d 20 GB \u2014 Normalized market trades <code>TITAN_ORDERBOOKS</code> <code>titan.data.venues.orderbooks.v1.&gt;</code> Limits File 24h 10 GB \u2014 Orderbook snapshots <code>TITAN_EXECUTION_EVENTS</code> <code>titan.evt.execution.{fill,shadow_fill,report,reject}.v1</code> Limits File 30d \u2014 \u2014 Execution audit trail"},{"location":"contracts/jetstream-topology/#durable-consumers","title":"Durable Consumers","text":"Consumer Stream Filter Ack Policy Max Deliver Ack Wait Backoff Owner <code>EXECUTION_CORE</code> <code>TITAN_CMD</code> <code>titan.cmd.execution.&gt;</code> Explicit 5 30s 1s, 5s, 15s, 30s <code>titan-execution-rs</code> <code>brain-venue-status</code> <code>TITAN_VENUE_STATUS</code> <code>titan.data.venues.status.v1</code> Explicit 5 30s \u2014 <code>titan-brain</code> <code>analytics-trades</code> <code>TITAN_MARKET_TRADES</code> <code>titan.data.venues.trades.v1.&gt;</code> Explicit 3 60s \u2014 Analytics"},{"location":"contracts/jetstream-topology/#kv-buckets","title":"KV Buckets","text":"Bucket History TTL Storage Purpose <code>titan-venue-status</code> 5 5m Memory Live venue health state <code>titan-config</code> 10 \u2014 File Runtime config overrides <code>titan-instruments</code> 3 24h File Cached instrument specs"},{"location":"contracts/jetstream-topology/#idempotency","title":"Idempotency","text":"<p>Commands on <code>TITAN_CMD</code> use a 60s <code>duplicate_window</code>. Producers MUST set the <code>Nats-Msg-Id</code> header to the envelope's <code>idempotency_key</code> (or <code>id</code> if no idempotency_key exists). This guarantees at-most-once delivery within the dedup window.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    Nats-Msg-Id: &lt;idempotency_key&gt;    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Brain    \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba   \u2502  TITAN_CMD  \u2502\n\u2502 (TS)     \u2502                                       \u2502  (WorkQueue)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                          \u2502 pull\n                                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                                   \u2502 EXECUTION_  \u2502\n                                                   \u2502 CORE (Rust) \u2502\n                                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                          \u2502 ack/nak\n                                                          \u25bc\n                                                    DLQ after 5 retries\n</code></pre>"},{"location":"contracts/jetstream-topology/#dlq-routing","title":"DLQ Routing","text":"<p>When a message exceeds <code>max_deliver</code> retries, the consumer's advisory event triggers DLQ routing. The execution engine also explicitly publishes to <code>titan.dlq.&gt;</code> for messages that fail validation.</p>"},{"location":"contracts/jetstream-topology/#canonical-sources","title":"Canonical Sources","text":"<ul> <li>TS Stream Definitions: <code>packages/shared/src/messaging/titan_streams.ts</code></li> <li>TS Advanced Config: <code>packages/shared/src/messaging/nats-streams.ts</code></li> <li>Rust Stream Setup: <code>services/titan-execution-rs/src/nats_engine.rs</code></li> </ul>"},{"location":"contracts/nats-intent/","title":"NATS Intent Contract (v1)","text":"<p>This document defines the v1 Intent payload schema sent over NATS for Brain \u2192 Execution. The authoritative JSON Schema is contracts/nats/nats-intent.v1.schema.json.</p>"},{"location":"contracts/nats-intent/#required-fields","title":"Required fields","text":"<ul> <li><code>signal_id</code> (string)</li> <li><code>t_signal</code> (integer ms since epoch) \u2014 legacy alias <code>timestamp</code> accepted</li> <li><code>symbol</code> (string)</li> <li><code>direction</code> (integer: -1 = SHORT, 1 = LONG, 0 = CLOSE/flatten)</li> <li><code>type</code> (string enum: <code>BUY_SETUP</code>, <code>SELL_SETUP</code>, <code>CLOSE_LONG</code>, <code>CLOSE_SHORT</code>, <code>CLOSE</code>)</li> <li><code>size</code> (number)</li> <li><code>status</code> (string enum: <code>PENDING</code>, <code>VALIDATED</code>, <code>REJECTED</code>, <code>EXECUTED</code>, <code>EXPIRED</code>)</li> </ul>"},{"location":"contracts/nats-intent/#nats-subject","title":"NATS subject","text":"<ul> <li>Commands: <code>titan.cmd.execution.place.v1.&lt;venue&gt;.&lt;account&gt;.&lt;symbol&gt;</code></li> <li>Execution consumes: <code>titan.cmd.execution.&gt;</code> (subject segments beyond this are for observability/routing)</li> </ul>"},{"location":"contracts/nats-intent/#optional-fields","title":"Optional fields","text":"<ul> <li>Pricing &amp; risk: <code>entry_zone</code>, <code>stop_loss</code>, <code>take_profits</code>, <code>confidence</code>, <code>leverage</code>,   <code>max_slippage_bps</code>, <code>expected_impact_bps</code>, <code>fill_feasibility</code></li> <li>Timing: <code>t_analysis</code>, <code>t_decision</code>, <code>t_ingress</code>, <code>t_exchange</code></li> <li>Routing &amp; context: <code>source</code>, <code>exchange</code>, <code>position_mode</code>, <code>regime_state</code>, <code>phase</code></li> <li><code>metadata</code> (free-form JSON object; include <code>correlation_id</code> for tracing)</li> </ul>"},{"location":"contracts/nats-intent/#backward-compatibility-rules","title":"Backward compatibility rules","text":"<ul> <li><code>timestamp</code> is accepted as a legacy alias for <code>t_signal</code>.</li> <li><code>entry_zone</code> and <code>take_profits</code> default to empty arrays when omitted.</li> </ul>"},{"location":"contracts/nats-intent/#schema-versioning-migration","title":"Schema versioning &amp; migration","text":"<ul> <li><code>schema_version</code> is optional and defaults to <code>1.0.0</code>.</li> <li>Producers should dual-write <code>t_signal</code> and legacy <code>timestamp</code> during rollout.</li> <li>Consumers should accept <code>timestamp</code> until all publishers are updated.</li> </ul>"},{"location":"contracts/nats-intent/#rollout-plan","title":"Rollout plan","text":"<ol> <li>Deploy Brain publishers first (emit <code>t_signal</code>, <code>timestamp</code>, and <code>schema_version</code>).</li> <li>Deploy Execution with strict schema validation + DLQ routing enabled.</li> <li>Enable routing fan-out via config once validation/DLQ metrics are stable.</li> </ol>"},{"location":"contracts/nats-intent/#example-payload","title":"Example payload","text":"<pre><code>{\n  \"schema_version\": \"1.0.0\",\n  \"signal_id\": \"sig-123\",\n  \"source\": \"brain\",\n  \"symbol\": \"BTCUSDT\",\n  \"direction\": 1,\n  \"type\": \"BUY_SETUP\",\n  \"entry_zone\": [52000, 52500],\n  \"stop_loss\": 51000,\n  \"take_profits\": [54000, 56000],\n  \"size\": 1000,\n  \"status\": \"VALIDATED\",\n  \"t_signal\": 1737267600000,\n  \"metadata\": {\n    \"correlation_id\": \"sig-123\",\n    \"brain_authorized\": true\n  }\n}\n</code></pre>"},{"location":"contracts/safety-model/","title":"TITAN Production Safety Model","text":"<p>Operating manual for kill switches, circuit breakers, and safety interlocks.</p>"},{"location":"contracts/safety-model/#kill-switch-hierarchy","title":"Kill Switch Hierarchy","text":"Switch Scope Trigger Effect Recovery HARD_HALT Global Operator / drift threshold Reject all intents, close all positions Manual <code>OPEN</code> command SOFT_HALT Global Risk limit breach Reject new intents, keep existing positions Auto-clear after cooldown ARM/DISARM Physical interlock Operator toggle Disarmed = reject all intents (fail-safe) Manual re-arm Per-Phase Circuit Breaker Per strategy Loss threshold Disable one phase only Auto-reset or manual"},{"location":"contracts/safety-model/#circuit-breaker-layers","title":"Circuit Breaker Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  REFLEX (Rust, &lt;1ms)                        \u2502\n\u2502  - Staleness monitor \u2192 halt if no tickers   \u2502\n\u2502  - Drift detector \u2192 halt if spread &gt; 50bps  \u2502\n\u2502  - Policy hash mismatch \u2192 reject intent     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  TRANSACTIONAL (Rust, per-intent)            \u2502\n\u2502  - Position limit cap                        \u2502\n\u2502  - Max slippage enforcement                  \u2502\n\u2502  - Duplicate signal id rejection             \u2502\n\u2502  - TTL enforcement (stale intents rejected)  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  STRATEGIC (Brain, per-decision)             \u2502\n\u2502  - Per-phase loss limits                     \u2502\n\u2502  - Portfolio correlation guard               \u2502\n\u2502  - Leverage cap                              \u2502\n\u2502  - DEFCON regime gating                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"contracts/safety-model/#override-audit-requirements","title":"Override Audit Requirements","text":"<p>All manual overrides (halt/resume, arm/disarm, policy changes) are: 1. Published as NATS events on <code>titan.evt.ops.*</code> 2. Persisted in the Redb event log 3. Include <code>operator_id</code>, <code>reason</code>, <code>timestamp</code>, and <code>correlation_id</code></p>"},{"location":"contracts/safety-model/#rbac-model","title":"RBAC Model","text":"Role Permissions <code>operator</code> Arm/disarm, halt/resume, view dashboard <code>admin</code> All operator + policy updates, config changes <code>readonly</code> Dashboard view only <p>RBAC is enforced via NATS user credentials + API auth middleware.</p>"},{"location":"contracts/safety-model/#immutable-audit-log","title":"Immutable Audit Log","text":"<p>Every state change in the execution engine is logged to: 1. Redb \u2014 local durable storage for crash recovery 2. NATS <code>titan.evt.execution.*</code> \u2014 distributed event log for consumers 3. Structured JSON logs \u2014 for external SIEM integration</p>"},{"location":"contracts/versioning-policy/","title":"Titan NATS Contract Versioning Policy","text":"<p>This document governs how NATS subjects and message schemas are versioned.</p>"},{"location":"contracts/versioning-policy/#subject-naming-convention","title":"Subject Naming Convention","text":"<pre><code>titan.{layer}.{domain}.{action}.v{N}[.{partition_tokens}]\n</code></pre> Segment Purpose Examples <code>layer</code> <code>cmd</code>, <code>evt</code>, <code>data</code>, <code>sys</code>, <code>rpc</code>, <code>dlq</code>, <code>ops</code> \u2014 <code>domain</code> Bounded context <code>execution</code>, <code>brain</code>, <code>risk</code>, <code>market</code> <code>action</code> Verb/noun <code>place</code>, <code>fill</code>, <code>ticker</code>, <code>halt</code> <code>vN</code> Schema version (monotonic) <code>v1</code>, <code>v2</code> Partition tokens Optional routing tokens <code>{venue}.{account}.{symbol}</code>"},{"location":"contracts/versioning-policy/#what-constitutes-a-breaking-change","title":"What Constitutes a Breaking Change","text":"<p>Breaking (requires new version <code>v{N+1}</code>): - Removing or renaming a required field - Changing a field's type - Changing array item schema - Adding a new required field without a default</p> <p>Non-breaking (safe within current version): - Adding a new optional field - Widening an enum (adding new values) - Adding a new subject in a new domain</p>"},{"location":"contracts/versioning-policy/#version-lifecycle","title":"Version Lifecycle","text":"<ol> <li>Active: Current version, all producers and consumers use it.</li> <li>Deprecated: Old version still published (dual-publish), new consumers should migrate.</li> <li>Removed: Old version is no longer published. Deadline enforced via CI.</li> </ol>"},{"location":"contracts/versioning-policy/#dual-publishing-during-migration","title":"Dual-Publishing During Migration","text":"<p>Use <code>getDualPublishSubjects()</code> to emit both the old and new subject during migration. The migration deadline is tracked in <code>TITAN_SUBJECTS.LEGACY</code> with <code>@deprecated</code> JSDoc tags.</p>"},{"location":"contracts/versioning-policy/#enforcement","title":"Enforcement","text":"Check Tool CI Gate? TS\u2194Rust subject sync <code>scripts/ci/verify_subjects_sync.sh</code> \u2705 Yes Raw subject usage ban <code>scripts/ci/check_subjects.sh</code> \u2705 Yes Schema backwards compat <code>packages/shared/tests/contract/</code> \u2705 Yes JSON Schema matches Zod <code>packages/shared/tests/contract/</code> \u2705 Yes"},{"location":"contracts/versioning-policy/#canonical-sources","title":"Canonical Sources","text":"<ul> <li>TypeScript: <code>packages/shared/src/messaging/titan_subjects.ts</code></li> <li>Rust: <code>services/titan-execution-rs/src/subjects.rs</code> (must mirror TS)</li> <li>JSON Schemas: <code>packages/shared/schemas/json/</code> and <code>docs/contracts/</code></li> </ul>"},{"location":"design-system/master/","title":"Titan Operator Console - Master Design System","text":"<p>Generated via UI-UX-PRO-MAX Principles (Manual Fallback)</p>"},{"location":"design-system/master/#1-core-identity","title":"1. Core Identity","text":"<ul> <li>Product: Titan Operator Console (Fintech/Crypto Control Plane)</li> <li>Theme: \"Sovereign Citadel\" (Dark Mode First, High Contrast)</li> <li>Font: Inter (headings &amp; body) + JetBrains Mono (code/data)</li> </ul>"},{"location":"design-system/master/#2-color-palette-tailwind","title":"2. Color Palette (Tailwind)","text":""},{"location":"design-system/master/#base-slate","title":"Base (Slate)","text":"<ul> <li><code>bg-background</code>: <code>slate-950</code> (#020617)</li> <li><code>bg-surface</code>: <code>slate-900</code> (#0f172a)</li> <li><code>bg-surface-highlight</code>: <code>slate-800</code> (#1e293b)</li> <li><code>border-default</code>: <code>slate-800</code> (#1e293b)</li> <li><code>text-primary</code>: <code>slate-50</code> (#f8fafc)</li> <li><code>text-secondary</code>: <code>slate-400</code> (#94a3b8)</li> <li><code>text-muted</code>: <code>slate-600</code> (#475569)</li> </ul>"},{"location":"design-system/master/#accents-functional","title":"Accents (Functional)","text":"<ul> <li>Primary (Action): <code>indigo-500</code> (#6366f1) -&gt; Hover: <code>indigo-400</code></li> <li>Success (Health): <code>emerald-500</code> (#10b981)</li> <li>Warning (Risk): <code>amber-500</code> (#f59e0b)</li> <li>Danger (Kill/Stop): <code>rose-500</code> (#f43f5e)</li> <li>Info (Telemetry): <code>sky-500</code> (#0ea5e9)</li> </ul>"},{"location":"design-system/master/#gradients-glassmorphism","title":"Gradients (Glassmorphism)","text":"<ul> <li>Card: <code>bg-slate-900/50 backdrop-blur-md border border-slate-800</code></li> <li>Active Item: <code>bg-indigo-500/10 border-indigo-500/20 text-indigo-400</code></li> </ul>"},{"location":"design-system/master/#3-typography","title":"3. Typography","text":"Role Size Weight Line Height H1 (Page Title) <code>text-3xl</code> <code>font-bold</code> <code>leading-tight</code> H2 (Section) <code>text-xl</code> <code>font-semibold</code> <code>leading-snug</code> Body <code>text-sm</code> <code>font-normal</code> <code>leading-relaxed</code> Data/Mono <code>text-xs</code> <code>font-mono</code> <code>leading-none</code> Label <code>text-xs</code> <code>font-medium</code> <code>uppercase tracking-wider</code>"},{"location":"design-system/master/#4-components","title":"4. Components","text":""},{"location":"design-system/master/#cards","title":"Cards","text":"<pre><code>&lt;div className=\"rounded-xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-6 shadow-xl\"&gt;\n</code></pre>"},{"location":"design-system/master/#buttons","title":"Buttons","text":"<ul> <li>Primary: <code>bg-indigo-600 hover:bg-indigo-500 text-white shadow-lg shadow-indigo-500/20 transition-all active:scale-95</code></li> <li>Destructive: <code>bg-rose-900/50 text-rose-200 border border-rose-800 hover:bg-rose-900 transition-colors</code></li> <li>Ghost: <code>hover:bg-slate-800 text-slate-400 hover:text-white transition-colors</code></li> </ul>"},{"location":"design-system/master/#inputs","title":"Inputs","text":"<ul> <li><code>bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder:text-slate-600</code></li> </ul>"},{"location":"design-system/master/#5-effects-animation","title":"5. Effects &amp; Animation","text":"<ul> <li>Transition: <code>duration-200 ease-out</code></li> <li>Hover: <code>hover:border-slate-600</code></li> <li>Focus: <code>focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500</code></li> </ul>"},{"location":"design-system/master/#6-iconography","title":"6. Iconography","text":"<ul> <li>Set: Lucide React</li> <li>Size: <code>w-4 h-4</code> (default), <code>w-5 h-5</code> (navigation)</li> <li>Stroke: <code>stroke-[1.5]</code> (elegant)</li> </ul>"},{"location":"design-system/master/#7-anti-patterns-do-not-use","title":"7. Anti-Patterns (DO NOT USE)","text":"<ul> <li>\u274c No Emoji Icons (Use Lucide)</li> <li>\u274c No <code>bg-black</code> (Use <code>slate-950</code>)</li> <li>\u274c No Default Scrollbars (Use <code>scrollbar-thin scrollbar-thumb-slate-700</code>)</li> <li>\u274c No Layout Shift on Hover (Use <code>border-transparent</code> vs <code>border-color</code>)</li> </ul>"},{"location":"design-system/pages/dashboard/","title":"Page: dashboard","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/dashboard/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/dashboard/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for dashboard if needed.</li> </ul>"},{"location":"design-system/pages/dashboard/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/deployments/","title":"Page: deployments","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/deployments/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/deployments/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for deployments if needed.</li> </ul>"},{"location":"design-system/pages/deployments/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/evidence/","title":"Page: evidence","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/evidence/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/evidence/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for evidence if needed.</li> </ul>"},{"location":"design-system/pages/evidence/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/execution/","title":"Page: execution","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/execution/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/execution/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for execution if needed.</li> </ul>"},{"location":"design-system/pages/execution/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/incidents/","title":"Page: incidents","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/incidents/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/incidents/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for incidents if needed.</li> </ul>"},{"location":"design-system/pages/incidents/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/keys/","title":"Page: keys","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/keys/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/keys/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for keys if needed.</li> </ul>"},{"location":"design-system/pages/keys/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/risk-policy/","title":"Page: risk-policy","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/risk-policy/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/risk-policy/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for risk-policy if needed.</li> </ul>"},{"location":"design-system/pages/risk-policy/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/setup/","title":"Page: setup","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/setup/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/setup/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for setup if needed.</li> </ul>"},{"location":"design-system/pages/setup/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"design-system/pages/venues/","title":"Page: venues","text":"<p>Extends MASTER</p>"},{"location":"design-system/pages/venues/#layout","title":"Layout","text":"<ul> <li>Follows standard Shell layout.</li> </ul>"},{"location":"design-system/pages/venues/#specific-components","title":"Specific Components","text":"<ul> <li>[ ] Define specific components for venues if needed.</li> </ul>"},{"location":"design-system/pages/venues/#deviations","title":"Deviations","text":"<ul> <li>None (currently strict adherence to Master).</li> </ul>"},{"location":"dev/configuration/","title":"Configuration &amp; Environment Variables","text":"<p>Status: Canonical Scope: Development &amp; Production</p> <p>This document catalogs all configuration switches, environment variables, and file-based configs for the Titan Trading System.</p>"},{"location":"dev/configuration/#1-hierarchy","title":"1. Hierarchy","text":"<p>Titan uses a tiered configuration strategy:</p> <ol> <li>Code Defaults: Hardcoded safe defaults (fail-closed).</li> <li>Configuration Files: <code>config/*.conf</code>, <code>risk_policy.json</code> (Structured data).</li> <li>Environment Variables: <code>.env</code> (Overrides and Secrets).</li> <li>CLI Arguments: Runtime flags (highest precedence).</li> </ol>"},{"location":"dev/configuration/#2-environment-variables-env","title":"2. Environment Variables (<code>.env</code>)","text":"<p>Source of Truth: <code>.env.example</code> in repo root.</p>"},{"location":"dev/configuration/#21-core-system","title":"2.1 Core System","text":"Variable Required Default Description <code>NODE_ENV</code> Yes <code>development</code> <code>production</code> enables optimizations and strict security. <code>TITAN_MODE</code> Yes <code>DISARMED</code> <code>ARMED</code> allows live execution. Default is Disarmed. <code>LOG_LEVEL</code> No <code>info</code> <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>."},{"location":"dev/configuration/#22-orchestration-ports","title":"2.2 Orchestration (Ports)","text":"Variable Service Default <code>BRAIN_PORT</code> titan-brain <code>3100</code> <code>EXECUTION_PORT</code> titan-execution <code>3002</code> <code>CONSOLE_PORT</code> titan-console <code>8080</code> (Internal)"},{"location":"dev/configuration/#23-databases-bus","title":"2.3 Databases &amp; Bus","text":"Variable Description Example / Production Note <code>DATABASE_URL</code> Postgres Connection <code>postgresql://titan:secret@localhost:5432/titan_brain</code> <code>REDIS_URL</code> Redis Connection <code>redis://localhost:6379</code> <code>NATS_URL</code> NATS JetStream <code>nats://localhost:4222</code>"},{"location":"dev/configuration/#24-security-secrets","title":"2.4 Security (Secrets)","text":"<p>Never commit these. Use Vault or <code>.env.prod</code> (chmod 600).</p> Variable Criticality Usage <code>HMAC_SECRET</code> CRITICAL Signs all IPC commands. Fail-closed if missing. <code>TITAN_MASTER_PASSWORD</code> High Auth for Console and Operator actions. <code>JWT_SECRET</code> High Signs operator session tokens. <code>BYBIT_API_KEY</code> High Exchange API Key. <code>BYBIT_API_SECRET</code> High Exchange API Secret."},{"location":"dev/configuration/#3-configuration-files","title":"3. Configuration Files","text":""},{"location":"dev/configuration/#31-nats-configuration-confignatsconf","title":"3.1 NATS Configuration (<code>config/nats.conf</code>)","text":"<ul> <li>Defines JetStream limits (Storage: File, max_mem).</li> <li>Defines ACLs (Access Control Lists) for users (<code>brain</code>, <code>execution</code>, <code>scavenger</code>, etc.).</li> <li>Invariant: Users are isolated. <code>execution</code> cannot publish to <code>titan.cmd.*</code> (unless reacting).</li> </ul>"},{"location":"dev/configuration/#32-risk-policy-packagessharedrisk_policyjson","title":"3.2 Risk Policy (<code>packages/shared/risk_policy.json</code>)","text":"<ul> <li>Canonical definitions of risk limits.</li> <li>Loaded by both Brain (TS) and Execution (Rust).</li> <li>Invariant: Both services verify SHA256 of this file at boot.</li> </ul>"},{"location":"dev/configuration/#33-docker-compose-overrides","title":"3.3 Docker Compose Overrides","text":"<ul> <li><code>docker-compose.yml</code>: Base (Dev).</li> <li><code>docker-compose.prod.yml</code>: Production overlays (restart policies, logging, networks).</li> <li><code>docker-compose.secrets.yml</code>: Local dev injection of real secrets (optional, git-ignored).</li> </ul>"},{"location":"dev/configuration/#4-secret-management-best-practices","title":"4. Secret Management Best Practices","text":"<ol> <li> <p>Production:</p> <ul> <li>Mount <code>.env.prod</code> as a readonly file if possible.</li> <li>Or inject via Orchestrator Secrets (Docker Swarm/K8s).</li> <li>Verify Permissions: <code>chmod 600 config/.env.prod</code>.</li> </ul> </li> <li> <p>Development:</p> <ul> <li>Copy <code>.env.example</code> to <code>.env</code>.</li> <li>Fill in <code>HMAC_SECRET</code> (generate with <code>openssl rand -hex 32</code>).</li> </ul> </li> <li> <p>Rotation:</p> <ul> <li>Secrets are static at boot.</li> <li>Rotation requires Restart of affected services.</li> </ul> </li> </ol>"},{"location":"dev/configuration/#5-runtime-configuration-configregistry","title":"5. Runtime Configuration (ConfigRegistry)","text":"<p>Source: <code>services/titan-brain/src/services/config/ConfigRegistry.ts</code></p> <p>The <code>ConfigRegistry</code> provides a runtime-configurable overlay on top of environment variables and code defaults. It is the single source of truth for all tunable trading, risk, and operational parameters.</p>"},{"location":"dev/configuration/#51-provenance-hierarchy","title":"5.1 Provenance Hierarchy","text":"<p>Values are resolved in priority order (highest first):</p> <ol> <li>Override \u2014 Applied via UI or API (<code>POST /config/override</code>). Stored in PostgreSQL.</li> <li>Environment \u2014 <code>.env.production</code> variables.</li> <li>Default \u2014 Hardcoded in <code>CONFIG_CATALOG</code>.</li> </ol> <p>Each effective value carries a <code>provenance</code> tag (<code>override</code>, <code>env</code>, or <code>default</code>) so operators always know the source.</p>"},{"location":"dev/configuration/#52-safety-tiers","title":"5.2 Safety Tiers","text":"<p>Every config item has a <code>safety</code> level enforcing directional constraints:</p> Safety Behavior <code>immutable</code> Cannot be changed at runtime. Requires signed deploy. <code>tighten_only</code> Can only be moved in the safer direction (reduce risk). <code>raise_only</code> Can only be increased (raise limits). <code>append_only</code> Items can be added but not removed. <code>tunable</code> Free to change in any direction."},{"location":"dev/configuration/#53-catalog-categories","title":"5.3 Catalog Categories","text":"<p>All runtime-tunable parameters are organized into categories:</p> Category Example Keys Description Capital <code>capital.initialEquity</code>, <code>capital.reserveLimit</code> Equity and capital reserves Risk <code>risk.maxRiskPct</code>, <code>risk.maxPositionSizePct</code>, <code>risk.maxTotalLeverage</code> Per-trade and aggregate risk limits Circuit Breaker <code>breaker.maxDailyDrawdown</code>, <code>breaker.minEquity</code>, <code>breaker.emergencyStopLoss</code> Automated halt triggers Safety <code>safety.zscoreThreshold</code>, <code>safety.drawdownVelocityThreshold</code> Statistical anomaly detection Trading Limits <code>trading.minTradeIntervalMs</code>, <code>trading.maxTradesPerHour</code> Frequency throttling Market Sentiment <code>market.fundingGreedThreshold</code>, <code>market.fundingFearThreshold</code> Funding rate signal thresholds Execution <code>execution.maxSpreadPct</code>, <code>execution.maxSlippagePct</code> Fill quality constraints <p>Full catalog: see <code>CONFIG_CATALOG</code> in <code>ConfigRegistry.ts</code>.</p>"},{"location":"dev/configuration/#54-preset-profiles","title":"5.4 Preset Profiles","text":"<p>Three pre-defined risk profiles can be applied via <code>POST /config/preset/:name</code>:</p> Preset Description <code>conservative</code> Lower risk, tighter limits \u2014 capital preservation mode <code>balanced</code> Default production profile \u2014 moderate risk, standard limits <code>aggressive</code> Higher risk tolerance \u2014 for strong conviction periods <p>Each preset applies a coordinated set of overrides atomically.</p>"},{"location":"dev/configuration/#55-api-endpoints","title":"5.5 API Endpoints","text":"Endpoint Method Guard Description <code>/config/catalog</code> GET operator List all config items with metadata <code>/config/effective</code> GET operator Get current effective values with provenance <code>/config/override</code> POST admin Create or update a runtime override <code>/config/override</code> DELETE admin Rollback an override to previous value <code>/config/presets</code> GET operator List available preset profiles <code>/config/preset/:name</code> POST admin Apply a named preset profile <code>/config/receipts</code> GET operator Audit log of all config changes"},{"location":"dev/configuration/#56-ui-titan-console","title":"5.6 UI (Titan Console)","text":"<p>The Settings page (<code>apps/titan-console/src/pages/Settings.tsx</code>) provides a UI for all catalog items:</p> <ul> <li>Dynamic rendering: Each item renders the appropriate widget (slider, input, toggle, select) based on its catalog definition.</li> <li>Provenance badges: Shows whether each value comes from default, env, or override.</li> <li>Save with reason: Every override requires a text reason for the audit trail.</li> <li>Rollback: One-click rollback for any active override.</li> <li>Preset buttons: Quick-apply Conservative/Balanced/Aggressive profiles.</li> </ul>"},{"location":"dev/integration-verification/","title":"Integration Verification Notes","text":""},{"location":"dev/integration-verification/#boot-commands-tested","title":"Boot Commands Tested","text":""},{"location":"dev/integration-verification/#full-system-boot-development","title":"Full System Boot (Development)","text":"<pre><code># Start NATS (required for all services)\ndocker compose -f infrastructure/docker/nats/docker-compose.yml up -d\n\n# Build all services\nnpm run build\n\n# Start individual services\nnpm run start:brain       # Orchestration service\nnpm run start:scavenger   # Phase 1 scanner\nnpm run start:hunter      # Phase 2 execution\nnpm run start:console     # Web operator console\n</code></pre>"},{"location":"dev/integration-verification/#verification-result-boot","title":"Verification Result (Boot)","text":"<pre><code>\u2705 npm run build \u2192 11/11 turbo tasks pass\n\u2705 Provenance generated at: .generated/provenance/provenance.json\n</code></pre>"},{"location":"dev/integration-verification/#test-commands-tested","title":"Test Commands Tested","text":""},{"location":"dev/integration-verification/#unit-tests","title":"Unit Tests","text":"<pre><code>npm test                  # All service tests\nnpm test -w services/titan-phase2-hunter  # Individual service\n</code></pre>"},{"location":"dev/integration-verification/#verification-result-tests","title":"Verification Result (Tests)","text":"<pre><code>\u2705 titan-phase2-hunter: 40 suites, 618 tests (609 passed, 9 skipped)\n\u2705 titan-brain: All tests pass\n\u2705 packages/shared: All tests pass\n</code></pre>"},{"location":"dev/integration-verification/#static-analysis","title":"Static Analysis","text":"<pre><code>npx knip                  # Dead code detection\nnpm audit                 # Security vulnerabilities\nnpm run sota:zombie       # Zombie dependency check\nnpm run sota:circular     # Circular dependency check\n</code></pre>"},{"location":"dev/integration-verification/#verification-result-analysis","title":"Verification Result (Analysis)","text":"<pre><code>\u2705 knip: 0 unused files\n\u2705 npm audit: 0 vulnerabilities\n\u2705 sota:zombie: Pass\n\u2705 sota:circular: Pass\n</code></pre>"},{"location":"dev/integration-verification/#ci-checks-run-locally","title":"CI Checks Run Locally","text":""},{"location":"dev/integration-verification/#build-pipeline","title":"Build Pipeline","text":"<pre><code>npm run build\n</code></pre> <p>Output: <code>Tasks: 11 successful, 11 total</code></p>"},{"location":"dev/integration-verification/#security-scan","title":"Security Scan","text":"<pre><code>npm audit --audit-level=high\n</code></pre> <p>Output: <code>found 0 vulnerabilities</code></p>"},{"location":"dev/integration-verification/#provenance-generation","title":"Provenance Generation","text":"<pre><code>npm run sota:provenance\n</code></pre> <p>Output: <code>\u2705 Provenance generated at: .generated/provenance/provenance.json</code></p>"},{"location":"dev/integration-verification/#evidence-snippets","title":"Evidence Snippets","text":""},{"location":"dev/integration-verification/#turbo-build-output","title":"Turbo Build Output","text":"<pre><code>titan-backtesting:build: cache hit, replaying logs\ntitan-powerlaw-lab:build: cache hit\n@titan/shared:build: cache hit\ntitan-ai-quant:build: cache hit\ntitan-brain:build: cache hit\ntitan-phase1-scavenger:build: cache hit\ntitan-phase2-hunter:build: cache hit\ntitan-phase3-sentinel:build: cache hit\ncanonical-powerlaw-service:build: cache hit\n@titan/harness:build: cache hit\ntitan-console:build: cache hit\n</code></pre>"},{"location":"dev/integration-verification/#npm-audit-output","title":"npm audit Output","text":"<pre><code>audited 2826 packages in 3s\nfound 0 vulnerabilities\n</code></pre>"},{"location":"dev/integration-verification/#knip-dead-code-output","title":"knip Dead Code Output","text":"<pre><code>Unused files (0)\nUnused exports (some - types only, acceptable)\n</code></pre>"},{"location":"dev/integration-verification/#nats-subjects-verification","title":"NATS Subjects Verification","text":"<p>Canonical subject definitions in <code>packages/shared/src/messaging/NatsClient.ts</code>:</p> <ul> <li><code>TitanSubject</code> enum defines all NATS subjects</li> <li>Used by: titan-brain, titan-execution</li> </ul>"},{"location":"dev/integration-verification/#config-validation","title":"Config Validation","text":"<p>Configuration validation via <code>npm run validate:config</code> enforced in CI.</p> <p>Generated: 2026-02-02 Verified by: Systematic hygiene audit</p>"},{"location":"dev/quality-gates/","title":"SOTA Quality Pipeline","text":"<p>Status: Canonical Context: CI/CD Quality Gates</p> <p>This document explains the Titan SOTA (State-of-the-Art) quality pipeline.</p>"},{"location":"dev/quality-gates/#quick-start","title":"Quick Start","text":"<pre><code># Run all quality gates\nnpm run sota:all\n\n# Run specific gates\nnpm run sota:typecheck     # Type checking\nnpm run sota:contracts:schemas  # NATS schema validation\nnpm run sota:runbooks      # Runbook coverage\n</code></pre>"},{"location":"dev/quality-gates/#the-standard-sota-or-bust","title":"The Standard: \"SOTA or Bust\"","text":"<p>We follow a \"State-of-the-Art\" (SOTA) engineering philosophy. Linting is arguably the least we can do. We rely on deep static analysis, mutation testing, and impact analysis to maintain velocity without sacrificing stability.</p>"},{"location":"dev/quality-gates/#gates-overview","title":"Gates Overview","text":""},{"location":"dev/quality-gates/#code-quality","title":"Code Quality","text":"Gate Command Description Circular Deps <code>sota:circular</code> Detects circular imports Architecture <code>sota:arch</code> Enforces module boundaries Complexity <code>sota:complexity</code> Ranks code complexity Dead Code <code>sota:dead</code> Finds unused exports Type Check <code>sota:typecheck</code> TypeScript compilation"},{"location":"dev/quality-gates/#security-supply-chain","title":"Security &amp; Supply Chain","text":"Gate Command Description Secrets <code>sota:secrets</code> Scans for leaked secrets Audit <code>sota:audit</code> npm vulnerability scan License <code>sota:license</code> License compliance SBOM <code>sota:sbom</code> Generate SBOM (CycloneDX)"},{"location":"dev/quality-gates/#contracts-determinism","title":"Contracts &amp; Determinism","text":"Gate Command Description Schemas <code>sota:contracts:schemas</code> Validates NATS schemas Determinism <code>sota:replay:determinism</code> Replay state verification Edge Validation <code>sota:edge:validation</code> Checks ingress validation"},{"location":"dev/quality-gates/#operability","title":"Operability","text":"Gate Command Description Health Deps <code>sota:health:deps</code> Health check coverage Metrics <code>sota:metrics:required</code> Required metrics exist Runbooks <code>sota:runbooks</code> Required runbooks exist Migrations <code>sota:migrations:safety</code> Migration reversibility"},{"location":"dev/quality-gates/#continuous-integration-gates","title":"Continuous Integration Gates","text":""},{"location":"dev/quality-gates/#1-build-basic-lint","title":"1. Build &amp; Basic Lint","text":"<ul> <li>Trigger: Every Push</li> <li>Tools: <code>npm run build</code>, <code>eslint</code>, <code>prettier</code></li> <li>Why: Basic syntax and type correctness.</li> </ul>"},{"location":"dev/quality-gates/#2-sota-hygiene-scan-the-sota-block","title":"2. SOTA Hygiene Scan (The \"SOTA\" Block)","text":"<ul> <li>Trigger: Pull Requests</li> <li>Tools:</li> <li>Dead Code: <code>knip</code> (No unused exports allowed)</li> <li>Zombie Deps: <code>depcheck</code> (No unused packages)</li> <li>Circular Deps: <code>madge</code> (Graphs must be acyclic)</li> <li>Structure: <code>dependency-cruiser</code> (No illegal layer crossings)</li> <li>Secrets: Regex-based scanning for keys.</li> <li>Fail Condition: Any violation halts the merge.</li> </ul>"},{"location":"dev/quality-gates/#3-test-reliability-layer","title":"3. Test Reliability Layer","text":"<ul> <li>Trigger: Nightly or on 'Critical' PRs</li> <li>Tools:</li> <li>Flakiness Detector: <code>npm run sota:flake</code> (Runs suite 10x)</li> <li>Mutation Testing: <code>npm run sota:mutation</code> (Verifies test asserts actually test code)</li> </ul>"},{"location":"dev/quality-gates/#ci-integration","title":"CI Integration","text":"<p>Gates run automatically on:</p> <ul> <li>PR: All gates except mutation testing</li> <li>Nightly: Full suite including mutation testing</li> </ul>"},{"location":"dev/quality-gates/#toolchain-reference","title":"Toolchain Reference","text":"<p>For local development, use the <code>sota:*</code> scripts defined in <code>package.json</code>.</p> Script check Metric / Rule <code>sota:complexity</code> Complexity Cyclomatic &lt; 15, Cognitive &lt; 15 <code>sota:god</code> Maintainability File lines &lt; 400 <code>sota:arch</code> Architecture Layer Violation (e.g. Infrastructure -&gt; Domain) <code>sota:bundle</code> Performance Bundle Size &lt; Budget (e.g. 5MB) <code>sota:impact</code> Velocity Only runs tests for changed workspaces"},{"location":"dev/quality-gates/#interpreting-failures","title":"Interpreting Failures","text":"<p>Each gate prints a clear message on failure:</p> <ul> <li>\u274c indicates a blocking failure</li> <li>\u26a0\ufe0f indicates a warning (may not block)</li> </ul>"},{"location":"dev/quality-gates/#adding-a-new-service","title":"Adding a New Service","text":"<ol> <li>Ensure service has <code>src/</code> directory structure</li> <li>Add health check endpoint with dependency status</li> <li>Add schemas to <code>contracts/nats/&lt;subject&gt;/</code></li> <li>Verify with <code>npm run sota:all</code></li> </ol>"},{"location":"dev/repo_structure/","title":"Repository Structure (Monorepo)","text":"<p>Status: Canonical Toolchain: Turbo Repo + NPM Workspaces</p>"},{"location":"dev/repo_structure/#1-topography","title":"1. Topography","text":"<pre><code>titan/\n\u251c\u2500\u2500 apps/                 # User Interfaces (Frontend)\n\u2502   \u2514\u2500\u2500 titan-console/    # React/Vite Dashboard\n\u251c\u2500\u2500 services/             # Backend Microservices (Dockerized)\n\u2502   \u251c\u2500\u2500 titan-brain/      # Orchestrator (TS)\n\u2502   \u251c\u2500\u2500 titan-execution-rs/ # Execution Engine (Rust)\n\u2502   \u251c\u2500\u2500 titan-phase*/     # Strategies\n\u2502   \u2514\u2500\u2500 titan-opsd/       # Ops Daemon (Node.js)\n\u251c\u2500\u2500 packages/             # Shared Libraries (NPM)\n\u2502   \u251c\u2500\u2500 shared/           # @titan/shared (Types, Schemas, Utils)\n\u2502   \u2514\u2500\u2500 titan-harness/    # Integration Tests\n\u251c\u2500\u2500 config/               # Global Configuration\n\u251c\u2500\u2500 scripts/              # CI/CD and Ops Scripts\n\u2514\u2500\u2500 docs/                 # Documentation (Source of Truth)\n</code></pre>"},{"location":"dev/repo_structure/#2-boundaries","title":"2. Boundaries","text":""},{"location":"dev/repo_structure/#21-services-vs-packages","title":"2.1 Services vs Packages","text":"<ul> <li>Services are runnable applications. They define <code>Dockerfile</code>. They have a <code>main()</code> entrypoint.</li> <li>Packages are libraries. They are imported by services. They export <code>index.ts</code>.</li> </ul>"},{"location":"dev/repo_structure/#22-shared-library-titanshared","title":"2.2 Shared Library (<code>@titan/shared</code>)","text":"<p>The spine of the repo.</p> <ul> <li>What goes here:</li> <li>TS Interfaces (Schemas).</li> <li>NATS Subject Definitions.</li> <li>Test Utilities.</li> <li>Config Parsers.</li> <li>Rule: If 2+ services need it, put it in Shared.</li> </ul>"},{"location":"dev/repo_structure/#3-adding-a-new-service","title":"3. Adding a New Service","text":"<ol> <li>Create folder in <code>services/</code>.</li> <li><code>npm init</code>.</li> <li>Add <code>Dockerfile</code>.</li> <li>Add to <code>docker-compose.yml</code>.</li> <li>Implement <code>/health</code>.</li> <li>Add to <code>titan-console</code> monitoring.</li> </ol>"},{"location":"dev/testing-brain-integration/","title":"Titan Brain Integration Tests - Implementation Summary","text":""},{"location":"dev/testing-brain-integration/#overview","title":"Overview","text":"<p>This document summarizes the comprehensive integration test suite implemented for the Titan Brain service. The integration tests verify the complete system functionality including database connectivity, cache operations, webhook processing, and end-to-end workflows.</p>"},{"location":"dev/testing-brain-integration/#test-suite-structure","title":"Test Suite Structure","text":""},{"location":"dev/testing-brain-integration/#1-test-files-created","title":"1. Test Files Created","text":"File Purpose Test Count Coverage <code>WebhookServer.integration.test.ts</code> Server functionality 25+ tests Health endpoints, metrics, rate limiting, HMAC validation, CORS, error handling <code>DatabaseManager.integration.test.ts</code> Database operations 20+ tests Connection management, queries, transactions, health monitoring, performance <code>CacheManager.integration.test.ts</code> Cache operations 20+ tests Redis connectivity, fallback behavior, operations, health monitoring, performance <code>StartupManager.integration.test.ts</code> Startup/shutdown 15+ tests Startup sequence, health monitoring, error recovery, configuration validation <code>EndToEnd.integration.test.ts</code> Complete system 30+ tests Full system integration, webhook processing, security, performance, graceful shutdown <p>Total: 110+ integration tests covering all major system components</p>"},{"location":"dev/testing-brain-integration/#2-configuration-files","title":"2. Configuration Files","text":"File Purpose <code>jest.integration.config.js</code> Jest configuration for integration tests <code>tests/integration/setup.ts</code> Global test setup and utilities <code>tests/integration/env.ts</code> Environment configuration <code>tests/integration/README.md</code> Comprehensive documentation"},{"location":"dev/testing-brain-integration/#3-packagejson-scripts","title":"3. Package.json Scripts","text":"<pre><code>{\n  \"test\": \"npm run test:unit\",\n  \"test:unit\": \"jest --config jest.config.js\",\n  \"test:integration\": \"jest --config jest.integration.config.js\",\n  \"test:all\": \"npm run test:unit &amp;&amp; npm run test:integration\",\n  \"test:watch:integration\": \"jest --watch --config jest.integration.config.js\",\n  \"test:coverage:integration\": \"jest --coverage --config jest.integration.config.js\",\n  \"test:coverage:all\": \"npm run test:coverage &amp;&amp; npm run test:coverage:integration\"\n}\n</code></pre>"},{"location":"dev/testing-brain-integration/#test-categories-and-coverage","title":"Test Categories and Coverage","text":""},{"location":"dev/testing-brain-integration/#1-webhookserver-integration-tests","title":"1. WebhookServer Integration Tests","text":"<p>Test Categories: - \u2705 Health Endpoints (3 tests) - \u2705 Metrics Endpoints (2 tests) - \u2705 Rate Limiting (2 tests) - \u2705 HMAC Validation (4 tests) - \u2705 Error Handling (3 tests) - \u2705 CORS Handling (2 tests) - \u2705 Logging Integration (2 tests) - \u2705 Performance (2 tests)</p> <p>Key Features Tested: - Health check responses with component status - Prometheus metrics collection - Rate limiting with IP-based throttling - HMAC signature validation and timestamp checking - Malformed request handling - CORS preflight and response headers - Correlation ID handling - Concurrent request processing</p>"},{"location":"dev/testing-brain-integration/#2-databasemanager-integration-tests","title":"2. DatabaseManager Integration Tests","text":"<p>Test Categories: - \u2705 Connection Management (3 tests) - \u2705 Query Operations (4 tests) - \u2705 Transaction Support (2 tests) - \u2705 Health Monitoring (3 tests) - \u2705 Error Handling (3 tests) - \u2705 Performance (2 tests)</p> <p>Key Features Tested: - PostgreSQL connection establishment and pooling - Parameterized queries and result handling - Transaction commit and rollback - Connection health monitoring and metrics - Network timeout and error recovery - High-volume query performance - Connection pool exhaustion handling</p>"},{"location":"dev/testing-brain-integration/#3-cachemanager-integration-tests","title":"3. CacheManager Integration Tests","text":"<p>Test Categories: - \u2705 Connection Management (3 tests) - \u2705 Basic Cache Operations (5 tests) - \u2705 Advanced Operations (3 tests) - \u2705 Fallback Behavior (2 tests) - \u2705 Health Monitoring (3 tests) - \u2705 Error Handling (2 tests) - \u2705 Performance (2 tests)</p> <p>Key Features Tested: - Redis connection and in-memory fallback - GET, SET, DELETE operations with TTL - Large value handling and unicode support - Concurrent operations and consistency - Health status reporting and metrics - Connection failure recovery - High-volume operation performance</p>"},{"location":"dev/testing-brain-integration/#4-startupmanager-integration-tests","title":"4. StartupManager Integration Tests","text":"<p>Test Categories: - \u2705 Startup Sequence (4 tests) - \u2705 Shutdown Sequence (3 tests) - \u2705 Health Monitoring (3 tests) - \u2705 Error Recovery (2 tests) - \u2705 Performance (2 tests) - \u2705 Configuration Validation (2 tests)</p> <p>Key Features Tested: - Complete startup sequence with event emission - Graceful shutdown with timeout handling - Component health monitoring during startup - Retry logic for failed startup steps - Startup performance benchmarking - Configuration validation and error handling</p>"},{"location":"dev/testing-brain-integration/#5-end-to-end-integration-tests","title":"5. End-to-End Integration Tests","text":"<p>Test Categories: - \u2705 System Startup and Health (3 tests) - \u2705 Webhook Processing (4 tests) - \u2705 Rate Limiting (2 tests) - \u2705 Error Handling and Recovery (3 tests) - \u2705 Monitoring and Observability (3 tests) - \u2705 Security (3 tests) - \u2705 Performance (2 tests) - \u2705 Graceful Shutdown (1 test)</p> <p>Key Features Tested: - Complete system integration from startup to shutdown - Authenticated webhook request processing - HMAC signature validation in real scenarios - Rate limiting under actual load - Database and cache failure recovery - Correlation ID tracking and metrics collection - CORS and security header validation - Performance under sustained load - Graceful system shutdown</p>"},{"location":"dev/testing-brain-integration/#prerequisites-and-setup","title":"Prerequisites and Setup","text":""},{"location":"dev/testing-brain-integration/#required-external-services","title":"Required External Services","text":"<ol> <li>PostgreSQL Database</li> <li>Version: 15+</li> <li>Test database: <code>test_titan_brain</code></li> <li> <p>Test user: <code>test_user</code> / <code>test_password</code></p> </li> <li> <p>Redis Cache</p> </li> <li>Version: 7+</li> <li>Test database: 13-15 (different DBs for different test suites)</li> </ol>"},{"location":"dev/testing-brain-integration/#docker-compose-setup","title":"Docker Compose Setup","text":"<pre><code>version: '3.8'\nservices:\n  test-postgres:\n    image: postgres:15\n    environment:\n      POSTGRES_DB: test_titan_brain\n      POSTGRES_USER: test_user\n      POSTGRES_PASSWORD: test_password\n    ports:\n      - \"5432:5432\"\n\n  test-redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n</code></pre>"},{"location":"dev/testing-brain-integration/#environment-variables","title":"Environment Variables","text":"<pre><code># Database\nTEST_DB_HOST=localhost\nTEST_DB_PORT=5432\nTEST_DB_NAME=test_titan_brain\nTEST_DB_USER=test_user\nTEST_DB_PASSWORD=test_password\n\n# Redis\nTEST_REDIS_HOST=localhost\nTEST_REDIS_PORT=6379\nTEST_REDIS_DB=15\n\n# Test Configuration\nTEST_TIMEOUT=60000\nTEST_VERBOSE=false\n</code></pre>"},{"location":"dev/testing-brain-integration/#test-execution","title":"Test Execution","text":""},{"location":"dev/testing-brain-integration/#running-tests","title":"Running Tests","text":"<pre><code># All integration tests\nnpm run test:integration\n\n# Specific test file\nnpx jest --config jest.integration.config.js WebhookServer.integration.test.ts\n\n# With coverage\nnpm run test:coverage:integration\n\n# Watch mode\nnpm run test:watch:integration\n\n# All tests (unit + integration)\nnpm run test:all\n</code></pre>"},{"location":"dev/testing-brain-integration/#test-configuration","title":"Test Configuration","text":"<ul> <li>Timeout: 60 seconds per test (configurable)</li> <li>Concurrency: Limited to 2 workers for integration tests</li> <li>Retry: Failed tests are retried once</li> <li>Coverage: 60% threshold for integration tests</li> <li>Reporting: JUnit XML and HTML coverage reports</li> </ul>"},{"location":"dev/testing-brain-integration/#performance-benchmarks","title":"Performance Benchmarks","text":""},{"location":"dev/testing-brain-integration/#database-performance","title":"Database Performance","text":"<ul> <li>\u2705 Query execution: &lt; 100ms average</li> <li>\u2705 Connection establishment: &lt; 5 seconds</li> <li>\u2705 High-volume queries: 100+ queries in &lt; 10 seconds</li> <li>\u2705 Concurrent operations: 50+ concurrent queries</li> </ul>"},{"location":"dev/testing-brain-integration/#cache-performance","title":"Cache Performance","text":"<ul> <li>\u2705 Operation latency: &lt; 10ms average</li> <li>\u2705 High-volume operations: 1000+ ops in &lt; 30 seconds</li> <li>\u2705 Concurrent operations: 500+ concurrent ops</li> <li>\u2705 Fallback performance: In-memory operations &lt; 1ms</li> </ul>"},{"location":"dev/testing-brain-integration/#server-performance","title":"Server Performance","text":"<ul> <li>\u2705 Health check response: &lt; 500ms average</li> <li>\u2705 Concurrent requests: 50+ concurrent requests</li> <li>\u2705 Sustained load: 5 seconds of continuous requests</li> <li>\u2705 Startup time: &lt; 15 seconds</li> </ul>"},{"location":"dev/testing-brain-integration/#error-handling-and-recovery","title":"Error Handling and Recovery","text":""},{"location":"dev/testing-brain-integration/#database-error-scenarios","title":"Database Error Scenarios","text":"<ul> <li>\u2705 Connection failures and reconnection</li> <li>\u2705 Invalid queries and syntax errors</li> <li>\u2705 Connection pool exhaustion</li> <li>\u2705 Network timeouts</li> </ul>"},{"location":"dev/testing-brain-integration/#cache-error-scenarios","title":"Cache Error Scenarios","text":"<ul> <li>\u2705 Redis connection failures with fallback</li> <li>\u2705 Malformed data handling</li> <li>\u2705 Network timeouts and reconnection</li> <li>\u2705 Memory fallback behavior</li> </ul>"},{"location":"dev/testing-brain-integration/#server-error-scenarios","title":"Server Error Scenarios","text":"<ul> <li>\u2705 Invalid request handling</li> <li>\u2705 Authentication failures</li> <li>\u2705 Rate limiting enforcement</li> <li>\u2705 Component failure recovery</li> </ul>"},{"location":"dev/testing-brain-integration/#security-testing","title":"Security Testing","text":""},{"location":"dev/testing-brain-integration/#authentication-and-authorization","title":"Authentication and Authorization","text":"<ul> <li>\u2705 HMAC signature validation</li> <li>\u2705 Timestamp expiration checking</li> <li>\u2705 Invalid signature rejection</li> <li>\u2705 Missing header handling</li> </ul>"},{"location":"dev/testing-brain-integration/#request-security","title":"Request Security","text":"<ul> <li>\u2705 CORS header validation</li> <li>\u2705 Malformed JSON handling</li> <li>\u2705 Rate limiting enforcement</li> <li>\u2705 Security header presence</li> </ul>"},{"location":"dev/testing-brain-integration/#monitoring-and-observability","title":"Monitoring and Observability","text":""},{"location":"dev/testing-brain-integration/#metrics-collection","title":"Metrics Collection","text":"<ul> <li>\u2705 HTTP request metrics</li> <li>\u2705 Database connection metrics</li> <li>\u2705 Cache operation metrics</li> <li>\u2705 Health check metrics</li> </ul>"},{"location":"dev/testing-brain-integration/#logging-and-tracing","title":"Logging and Tracing","text":"<ul> <li>\u2705 Correlation ID tracking</li> <li>\u2705 Structured log output</li> <li>\u2705 Error event logging</li> <li>\u2705 Performance metrics logging</li> </ul>"},{"location":"dev/testing-brain-integration/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"dev/testing-brain-integration/#github-actions-support","title":"GitHub Actions Support","text":"<ul> <li>\u2705 Service container configuration</li> <li>\u2705 Environment variable setup</li> <li>\u2705 Test execution and reporting</li> <li>\u2705 Coverage report generation</li> </ul>"},{"location":"dev/testing-brain-integration/#test-isolation","title":"Test Isolation","text":"<ul> <li>\u2705 Independent test execution</li> <li>\u2705 Resource cleanup after tests</li> <li>\u2705 Separate database namespaces</li> <li>\u2705 Parallel execution support</li> </ul>"},{"location":"dev/testing-brain-integration/#quality-metrics","title":"Quality Metrics","text":""},{"location":"dev/testing-brain-integration/#test-coverage","title":"Test Coverage","text":"<ul> <li>Integration Test Coverage: 60%+ (configured threshold)</li> <li>Component Coverage: All major components tested</li> <li>Scenario Coverage: Success and failure paths</li> <li>Performance Coverage: Benchmarks for all critical operations</li> </ul>"},{"location":"dev/testing-brain-integration/#test-reliability","title":"Test Reliability","text":"<ul> <li>Flaky Test Prevention: Proper cleanup and isolation</li> <li>Timeout Management: Appropriate timeouts for all operations</li> <li>Error Recovery: Tests handle external service failures</li> <li>Resource Management: Proper connection and memory management</li> </ul>"},{"location":"dev/testing-brain-integration/#future-enhancements","title":"Future Enhancements","text":""},{"location":"dev/testing-brain-integration/#planned-improvements","title":"Planned Improvements","text":"<ol> <li>Load Testing: Add dedicated load testing scenarios</li> <li>Chaos Engineering: Add failure injection tests</li> <li>Security Scanning: Add automated security vulnerability tests</li> <li>Performance Regression: Add performance regression detection</li> <li>Multi-Environment: Add support for different test environments</li> </ol>"},{"location":"dev/testing-brain-integration/#monitoring-enhancements","title":"Monitoring Enhancements","text":"<ol> <li>Real-time Metrics: Add real-time performance monitoring</li> <li>Alerting: Add test failure alerting</li> <li>Dashboards: Add test execution dashboards</li> <li>Trend Analysis: Add performance trend analysis</li> </ol>"},{"location":"dev/testing-brain-integration/#conclusion","title":"Conclusion","text":"<p>The Titan Brain integration test suite provides comprehensive coverage of all system components with:</p> <ul> <li>110+ integration tests covering all major functionality</li> <li>Complete system validation from startup to shutdown</li> <li>Performance benchmarking for all critical operations</li> <li>Error handling verification for all failure scenarios</li> <li>Security testing for authentication and authorization</li> <li>Monitoring validation for observability features</li> </ul> <p>The test suite is designed to: - Run reliably in CI/CD environments - Provide fast feedback on system health - Catch integration issues early - Validate performance requirements - Ensure security compliance</p> <p>This comprehensive integration test suite ensures the Titan Brain service is production-ready and maintains high quality standards throughout development and deployment.</p>"},{"location":"dev/testing_and_ci/","title":"Testing &amp; CI Standard","text":"<p>Status: Canonical Pipeline: GitHub Actions</p>"},{"location":"dev/testing_and_ci/#1-the-strategy","title":"1. The Strategy","text":"<p>Titan employs a \"Shift-Left\" testing strategy.</p> <ol> <li>Static Analysis: Types, Linters, Dependency Checks.</li> <li>Unit Tests: Logic verification (Brain/Risk).</li> <li>Integration Tests: Artifact-based contract verification.</li> <li>Backtests: Simulation of strategies.</li> </ol>"},{"location":"dev/testing_and_ci/#2-test-commands","title":"2. Test Commands","text":""},{"location":"dev/testing_and_ci/#21-unit-tests","title":"2.1 Unit Tests","text":"<pre><code># Brain (Jest)\nnpm run test:brain\n\n# Execution (Rust)\ncargo test --package titan-execution-rs\n</code></pre>"},{"location":"dev/testing_and_ci/#22-integration-the-harness","title":"2.2 Integration (The Harness)","text":"<p>The <code>titan-harness</code> package spins up ephemeral NATS and simulates signals.</p> <pre><code>npm run test:integration\n</code></pre>"},{"location":"dev/testing_and_ci/#3-continuous-integration-ci","title":"3. Continuous Integration (CI)","text":"<p>Our CI pipeline (<code>.github/workflows/ci.yml</code>) enforces the following gates:</p>"},{"location":"dev/testing_and_ci/#31-the-sota-check","title":"3.1 The \"SOTA\" Check","text":"<p>Script: <code>./scripts/ci/check_sota.sh</code></p> <ul> <li>Verifies that <code>package-lock.json</code> is in sync.</li> <li>Verifies that no \"dual truth\" docs exist.</li> <li>Verifies that all NATS subjects used in code are documented in the registry.</li> </ul>"},{"location":"dev/testing_and_ci/#32-contract-validation","title":"3.2 Contract Validation","text":"<p>Script: <code>./scripts/ci/check_contracts.sh</code></p> <ul> <li>Ensures JSON Schemas in <code>@titan/shared</code> match the struct definitions in Rust.</li> </ul>"},{"location":"dev/testing_and_ci/#4-linting","title":"4. Linting","text":"<ul> <li>TypeScript: ESLint + Prettier.</li> <li>Rust: Clippy (<code>cargo clippy</code>).</li> <li>Markdown: <code>markdownlint</code>.</li> </ul> <p>Invariant: CI fails on any warning. We do not tolerate \"noise\" in logs.</p>"},{"location":"explanation/execution-routing/","title":"Execution Routing &amp; Fan-Out","text":"<p>This document describes how the Execution service routes intents to exchanges and how fan-out size splitting is configured.</p>"},{"location":"explanation/execution-routing/#default-routing-behavior","title":"Default routing behavior","text":"<ol> <li>Explicit exchange: If an intent includes <code>exchange</code>, routing is forced to that exchange.</li> <li>Per-source routing: If no <code>exchange</code> is provided, routing uses the configured    per-source rules (see below).</li> <li>Fallback routing: If no per-source rule exists, the default source mapping applies    (<code>scavenger</code> \u2192 bybit+mexc, <code>hunter/sentinel</code> \u2192 binance).</li> </ol>"},{"location":"explanation/execution-routing/#configuration","title":"Configuration","text":"<p>Routing is configured under <code>execution.routing</code> in <code>config/config.json</code> (or overrides).</p> <pre><code>{\n  \"execution\": {\n    \"routing\": {\n      \"fanout\": true,\n      \"weights\": {\n        \"binance\": 0.6,\n        \"bybit\": 0.4\n      },\n      \"per_source\": {\n        \"scavenger\": {\n          \"fanout\": true,\n          \"weights\": { \"bybit\": 0.5, \"mexc\": 0.5 }\n        },\n        \"hunter\": {\n          \"fanout\": false\n        },\n        \"sentinel\": {\n          \"fanout\": false\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"explanation/execution-routing/#notes","title":"Notes","text":"<ul> <li>If <code>weights</code> are provided, fan-out is implicitly enabled and the order size is   split proportionally across exchanges.</li> <li>If <code>fanout</code> is false, only the first resolved exchange is used (single-route mode).</li> <li>The sum of weights does not need to equal 1.0; weights are normalized.</li> <li>Each child order receives a unique <code>client_order_id</code> suffix for reconciliation.</li> </ul>"},{"location":"explanation/execution-routing/#rollout-guidance","title":"Rollout Guidance","text":"<ol> <li>Deploy Brain publishers first (emit <code>t_signal</code> and schema metadata).</li> <li>Deploy Execution with strict schema validation + DLQ enabled.</li> <li>Enable routing fan-out via config once stability is verified.</li> </ol>"},{"location":"explanation/ha-strategy/","title":"Reliability and High Availability Strategy","text":"<p>This document describes the intended HA posture and migration path from single-node to multi-node.</p>"},{"location":"explanation/ha-strategy/#current-baseline-single-vps","title":"Current Baseline (Single VPS)","text":"<ul> <li>Single-node Docker Compose deployment</li> <li>RTO: 15 minutes (container restart/rebuild)</li> <li>RPO: 24 hours (nightly backups)</li> </ul>"},{"location":"explanation/ha-strategy/#target-ha-architecture-multi-node","title":"Target HA Architecture (Multi-Node)","text":"<ul> <li>Brain and phases: active-active across two nodes behind a load balancer</li> <li>Execution: active-active with dedicated NATS consumer groups</li> <li>Postgres: primary + streaming replica with automated failover</li> <li>Redis: sentinel or cluster for failover</li> <li>NATS: 3-node JetStream cluster with RAFT</li> </ul>"},{"location":"explanation/ha-strategy/#failover-strategy","title":"Failover Strategy","text":"<ul> <li>Health checks route traffic away from unhealthy nodes</li> <li>Stateful services fail over via replication (Postgres, Redis, NATS)</li> <li>Use DNS or L4 load balancer for service endpoints</li> </ul>"},{"location":"explanation/ha-strategy/#rtorpo-targets-ha","title":"RTO/RPO Targets (HA)","text":"<ul> <li>Core services: RTO &lt; 5 minutes</li> <li>Datastores: RPO &lt; 5 minutes (continuous replication)</li> </ul>"},{"location":"explanation/ha-strategy/#migration-steps","title":"Migration Steps","text":"<ol> <li>Split infrastructure (DB/Redis/NATS) onto dedicated nodes</li> <li>Introduce replication and automated failover</li> <li>Scale stateless services horizontally</li> <li>Validate failover with controlled chaos tests</li> <li>Update runbooks and SLO dashboards</li> </ol>"},{"location":"explanation/ha-strategy/#open-items","title":"Open Items","text":"<ul> <li>Finalize multi-node secrets distribution (Vault)</li> <li>Implement automated failover scripts</li> </ul>"},{"location":"explanation/legal-and-compliance/","title":"Legal, Compliance, and Intended Use","text":""},{"location":"explanation/legal-and-compliance/#summary","title":"Summary","text":"<p>Titan is designed for research, backtesting, and internal evaluation. Live trading is supported only for authorized operators after legal, compliance, and security review. This document clarifies the permitted use cases and compliance posture referenced by the root README.</p> <p>This document is not legal advice.</p>"},{"location":"explanation/legal-and-compliance/#permitted-use-cases","title":"Permitted Use Cases","text":"<ul> <li>Research and simulation (offline analysis, synthetic data)</li> <li>Paper trading and sandbox exchange testing</li> <li>Production trading by approved operators within compliant jurisdictions</li> </ul>"},{"location":"explanation/legal-and-compliance/#prohibited-or-restricted-use-cases-without-approvals","title":"Prohibited or Restricted Use Cases (Without Approvals)","text":"<ul> <li>Offering Titan as a managed service to third parties without appropriate licenses</li> <li>Trading in jurisdictions where derivatives or perpetual products are restricted</li> <li>Using Titan for customer funds without required registrations, disclosures, or approvals</li> </ul>"},{"location":"explanation/legal-and-compliance/#regulatory-considerations-high-level","title":"Regulatory Considerations (High-Level)","text":"<p>Consult qualified counsel for your jurisdiction. Common considerations include:</p> <ul> <li>Trading on behalf of others: May require registration as a commodity trading advisor (CTA),   commodity pool operator (CPO), investment adviser, broker-dealer, or local equivalent.</li> <li>Derivatives and leverage: Perpetual futures and leverage may be restricted for retail   customers or in certain regions.</li> <li>Exchange terms: API usage, rate limits, and market-making restrictions must be honored.</li> <li>AML/KYC: If the system touches customer assets or custody, AML/KYC obligations may apply.</li> <li>Data privacy: If user data is collected, GDPR/CCPA or local privacy requirements apply.</li> </ul>"},{"location":"explanation/legal-and-compliance/#required-approvals-before-production","title":"Required Approvals Before Production","text":"<ol> <li>Legal and compliance review for target jurisdiction(s)</li> <li>Risk committee sign-off (limits, drawdown policy, kill switch)</li> <li>Security review (secrets management, access control, audit logging)</li> <li>Change management approval for deployment</li> </ol>"},{"location":"explanation/legal-and-compliance/#alignment-with-deployment-guidance","title":"Alignment With Deployment Guidance","text":"<p>Production deployment steps in the root README assume the above approvals are complete. If approvals are not complete, restrict usage to research and paper trading.</p>"},{"location":"explanation/legal-and-compliance/#audit-and-recordkeeping","title":"Audit and Recordkeeping","text":"<p>Maintain audit logs for:</p> <ul> <li>Configuration changes (who/when/why)</li> <li>Operator actions in the Console</li> <li>Trade decisions, fills, and risk events</li> </ul> <p>See <code>docs/operations/data-governance.md</code> for retention policy.</p>"},{"location":"launch/checklist/","title":"Titan Production Launch Checklist","text":""},{"location":"launch/checklist/#pre-launch-t-1-day","title":"Pre-Launch (T-1 Day)","text":"<ul> <li>[ ] Secrets Deployed</li> <li><code>HMAC_SECRET</code> in secrets manager</li> <li>Exchange API credentials configured</li> <li> <p>Alert channel tokens set (PagerDuty, Telegram)</p> </li> <li> <p>[ ] Drills Passed (run in staging)</p> </li> </ul> <pre><code>./scripts/adversarial_drills.sh\n# All 4 must show PASS\n</code></pre> <ul> <li>[ ] Posture Loaded</li> </ul> <pre><code>source config/postures/constrained_alpha.env\n</code></pre> <ul> <li>[ ] Alert Test</li> <li>Send test alert to PagerDuty</li> <li>Verify human received notification</li> </ul>"},{"location":"launch/checklist/#launch-t-0","title":"Launch (T-0)","text":"<ol> <li>Boot with Constrained Posture</li> </ol> <pre><code>HMAC_SECRET=$SECRET ./scripts/boot_prod_like.sh constrained_alpha\n</code></pre> <ol> <li>Verify Health</li> </ol> <pre><code>./scrip../health_check.sh\n</code></pre> <ol> <li>Confirm DISARMED State</li> </ol> <pre><code>./scrip../set_trading_mode.sh disarm \"Pre-launch safety check\" \"&lt;operator_id&gt;\"\ndocker logs titan-brain --tail 100 2&gt;&amp;1 | grep \"SYSTEM DISARMED BY OPERATOR\"\n</code></pre> <ol> <li>ARM When Ready</li> </ol> <pre><code>./scrip../set_trading_mode.sh arm \"Initial launch\" \"&lt;operator_id&gt;\"\n</code></pre>"},{"location":"launch/checklist/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"launch/checklist/#halt-stop-new-orders","title":"HALT (Stop New Orders)","text":"<pre><code>docker exec titan-nats nats pub titan.cmd.sys.halt.v1 \\\n  '{\"state\":\"HARD_HALT\",\"reason\":\"Emergency halt\",\"timestamp\":'$(date +%s)'}'\n</code></pre>"},{"location":"launch/checklist/#flatten-close-all-positions","title":"FLATTEN (Close All Positions)","text":"<pre><code>docker exec titan-nats nats pub titan.cmd.risk.flatten \\\n  '{\"reason\":\"Flatten all\",\"actor_id\":\"&lt;operator&gt;\",\"timestamp\":'$(date +%s)'}'\n</code></pre>"},{"location":"launch/checklist/#disarm-prevent-arming","title":"DISARM (Prevent Arming)","text":"<pre><code>./scrip../set_trading_mode.sh disarm \"Manual disarm\" \"&lt;operator_id&gt;\"\n</code></pre>"},{"location":"launch/checklist/#constraints-in-effect-constrained_alpha","title":"Constraints in Effect (constrained_alpha)","text":"Parameter Value Venue Binance only Symbols BTCUSDT, ETHUSDT, SOLUSDT Max Position $5,000 Daily Loss Limit $500 Max Leverage 2x Orders/Min 10"},{"location":"launch/checklist/#promotion-criteria","title":"Promotion Criteria","text":"<p>To expand posture, ALL must be true over 100+ trades / 7+ days:</p> <ul> <li>0 unsigned commands accepted</li> <li>0 policy hash mismatches</li> <li>&lt;1% reconciliation mismatch rate</li> <li> <p>99% order lifecycle completeness</p> </li> <li>0 circuit breaker trips</li> <li>0 unacked P0 alerts</li> </ul>"},{"location":"operations/","title":"Operations &amp; Reliability","text":"<p>\u2190 Back to Index</p>"},{"location":"operations/#system-reliability","title":"\ud83e\ude7a System Reliability","text":"<ul> <li>Data Governance \u2014 Schema enforcement and migration policies.</li> <li>Event Bus Backlog \u2014 Handling NATS pressure.</li> <li>Truth Collapse \u2014 What happens when consensus fails.</li> </ul>"},{"location":"operations/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":"<ul> <li>Monitoring &amp; Alerting \u2014 Golden signals and paging.</li> <li>Incident Response \u2014 Triage workflows.</li> </ul>"},{"location":"operations/#governance","title":"\ud83d\udcdc Governance","text":"<ul> <li>Configuration Governance \u2014 Environment variables and feature flags.</li> </ul>"},{"location":"operations/#observability","title":"\ud83d\udcca Observability","text":"<ul> <li>Metrics Catalog \u2014 Exhaustive inventory of all Prometheus metrics by service.</li> <li>Dashboard Specification \u2014 Grafana dashboard layout and PromQL queries.</li> <li>Monitoring &amp; Alerting \u2014 SLOs, alert thresholds, and tracing.</li> </ul>"},{"location":"operations/#operational-posture-legacy","title":"Operational Posture (Legacy)","text":"<p>Note: This section was merged from the legacy <code>operations.md</code>.</p>"},{"location":"operations/#the-dull-standard","title":"The \"Dull\" Standard","text":"<p>We prioritize boring, reliable operations over fancy tooling.</p> <ul> <li>Orchestrator: Docker Compose (Single node or Swarm).</li> <li>Logs: JSON stdout/stderr, shipped to vector/loki.</li> <li>Metrics: Prometheus scrape targets.</li> </ul>"},{"location":"operations/#deployment","title":"Deployment","text":"<p>\ud83d\udc49 See Canonical Guide: deployment-standard.md</p>"},{"location":"operations/#quick-commands","title":"Quick Commands","text":"<pre><code># Deploy Production\n./scripts/ops/deploy_prod.sh\n\n# Deploy Staging (Micro-Capital)\n./scripts/ops/deploy_staging.sh\n\n# Emergency Halt (Local)\nnpm run start:prod -- --halt\n</code></pre>"},{"location":"operations/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"operations/#dashboards-grafana","title":"Dashboards (Grafana)","text":"<ul> <li>Titan Overview: Main business metrics (PnL, Exposure).</li> <li>System Health: CPU, RAM, Event Loop Lag, NATS Lag.</li> <li>Risk Board: Circuit breaker states, current drawdowns.</li> </ul>"},{"location":"operations/#key-metrics","title":"Key Metrics","text":"<ul> <li><code>titan_risk_exposure_notional</code>: Total market exposure.</li> <li><code>titan_decision_latency_ms</code>: Brain processing time.</li> <li><code>titan_execution_ack_latency_ms</code>: Exchange round-trip time.</li> </ul>"},{"location":"operations/#incident-response","title":"Incident Response","text":"<p>\ud83d\udc49 Runbooks located in: RUNBOOKS/</p>"},{"location":"operations/#severity-levels","title":"Severity Levels","text":"<ul> <li>SEV-1 (Critical): Fund loss imminent or happening. Action: Global Halt.</li> <li>SEV-2 (Major): Trading stopped, no fund loss. Action: Investigate.</li> <li>SEV-3 (Minor): Degraded performance (e.g., logging lag).</li> </ul>"},{"location":"operations/#drill-schedule","title":"Drill Schedule","text":"<ul> <li>Backup Restoration: Monthly.</li> <li>Circuit Breaker Test: Weekly (Automated).</li> </ul>"},{"location":"operations/#backup-disaster-recovery","title":"Backup &amp; Disaster Recovery","text":""},{"location":"operations/#database-postgres","title":"Database (Postgres)","text":"<ul> <li>Strategy: WAL Archiving + Nightly Dump.</li> <li>Restore: <code>scripts/restore_db.sh &lt;timestamp&gt;</code></li> </ul>"},{"location":"operations/#state-redis","title":"State (Redis)","text":"<ul> <li>Strategy: AOF (Append Only File).</li> <li>Recovery: Automatic replay on restart.</li> </ul>"},{"location":"operations/configuration-governance/","title":"Configuration Governance","text":""},{"location":"operations/configuration-governance/#source-of-truth","title":"Source of Truth","text":"<ul> <li><code>ConfigRegistry.ts</code> (<code>services/titan-brain/src/services/config/ConfigRegistry.ts</code>) is the authoritative runtime configuration source.</li> <li>The <code>CONFIG_CATALOG</code> array defines all tunable parameters with safety constraints, schemas, and defaults.</li> <li>Environment variables (<code>.env.production</code>) serve as the second-tier source, overridden by runtime overrides.</li> <li>Changes to <code>CONFIG_CATALOG</code> definitions require code review. Runtime overrides are applied via the API/UI.</li> </ul>"},{"location":"operations/configuration-governance/#provenance-chain","title":"Provenance Chain","text":"<p>Every effective configuration value carries a provenance tag indicating its source:</p> <ol> <li>override \u2014 Applied at runtime via API or UI. Stored in PostgreSQL with full audit trail.</li> <li>env \u2014 Loaded from environment variables at service startup.</li> <li>default \u2014 Hardcoded in <code>CONFIG_CATALOG</code>.</li> </ol>"},{"location":"operations/configuration-governance/#safety-enforcement","title":"Safety Enforcement","text":"<p>Config items have safety tiers that are enforced on all runtime overrides:</p> Safety Enforcement <code>immutable</code> Rejected at runtime. Requires a signed deploy. <code>tighten_only</code> Can only move in the safer direction (per <code>riskDirection</code>). <code>raise_only</code> Can only be increased. <code>append_only</code> Items can be added but not removed. <code>tunable</code> Unrestricted changes allowed."},{"location":"operations/configuration-governance/#validation-enforcement","title":"Validation Enforcement","text":"<p>Configuration validation is enforced at multiple levels:</p> <ol> <li>Schema validation: Every override is validated against the item's schema (type, min, max) before acceptance.</li> <li>Safety validation: Directional constraints enforced per safety tier.</li> <li>CI workflow: <code>.github/workflows/ci.yml</code> runs <code>npm run validate:config</code>.</li> <li>Pre-deploy check: <code>.github/workflows/deploy.yml</code> runs <code>npm run validate:config</code> before copying artifacts to VPS.</li> </ol> <pre><code>npm run validate:config\n</code></pre> <p>If validation fails, deployment must be blocked until fixed.</p>"},{"location":"operations/configuration-governance/#audit-trail","title":"Audit Trail","text":"<p>Every configuration change generates a signed <code>ConfigReceipt</code> containing:</p> <ul> <li>Unique receipt ID</li> <li>Key, previous value, new value</li> <li>Operator ID and reason</li> <li>HMAC-SHA256 signature (using <code>HMAC_SECRET</code>)</li> <li>Timestamp</li> </ul> <p>Receipts are stored in PostgreSQL and queryable via <code>GET /config/receipts</code>.</p>"},{"location":"operations/configuration-governance/#preset-profiles","title":"Preset Profiles","text":"<p>Three pre-defined risk profiles (<code>conservative</code>, <code>balanced</code>, <code>aggressive</code>) can be applied as coordinated sets of overrides via <code>POST /config/preset/:name</code>. Each preset overrides multiple parameters atomically. Preset application follows the same safety enforcement as individual overrides.</p>"},{"location":"operations/configuration-governance/#change-control","title":"Change Control","text":"<ul> <li>Runtime overrides: Applied via admin-guarded API (<code>POST /config/override</code>). Require a text reason.</li> <li>Catalog changes: All changes to <code>CONFIG_CATALOG</code> require a pull request and approval.</li> <li>Emergency rollback: Any override can be rolled back instantly via <code>DELETE /config/override</code> or the UI rollback button.</li> <li>Audit: All changes are logged with receipts and queryable via API.</li> </ul>"},{"location":"operations/configuration-governance/#ownership","title":"Ownership","text":"<ul> <li><code>CONFIG_CATALOG</code> and <code>ConfigRegistry.ts</code> are owned by the platform team.</li> <li>Phase-specific config items (<code>phase.*</code>) are owned by the respective phase team.</li> <li>Risk-related items require Risk Officer sign-off for catalog changes.</li> </ul>"},{"location":"operations/dashboard-spec/","title":"Operator Command Center \u2014 Dashboard Specification","text":"<p>Status: Canonical Source: Grounded in existing implemented metrics</p>"},{"location":"operations/dashboard-spec/#existing-dashboard","title":"Existing Dashboard","text":"<p>Grafana dashboard: <code>services/titan-brain/monitoring/grafana-dashboard-comprehensive.json</code> Prometheus config: <code>services/titan-brain/monitoring/prometheus-comprehensive.yml</code> (scrapes 6 targets at 5s intervals)</p> <p>[!IMPORTANT] This spec references only metrics that exist in code. Panels marked \ud83d\udd34 require implementation first.</p>"},{"location":"operations/dashboard-spec/#dashboard-layout-4-rows","title":"Dashboard Layout (4 rows)","text":""},{"location":"operations/dashboard-spec/#row-1-system-health-is-the-system-alive","title":"Row 1 \u2014 System Health (\"Is the system alive?\")","text":"Panel Type Query / Source Service Health Matrix Stat grid <code>up{job=~\"titan-.*\"}</code> Brain Health Stat <code>GET :3100/health \u2192 status</code> Scavenger Health Stat <code>GET :8081/health \u2192 status</code> Sentinel Health Stat <code>GET :8084/health \u2192 status</code> Execution Health Stat <code>GET :3002/health \u2192 status</code> NATS Health Stat <code>GET :8222/healthz</code> Circuit Breaker Stat <code>titan_brain_circuit_breaker_active</code> Risk State Stat <code>titan_execution_risk_state</code>"},{"location":"operations/dashboard-spec/#row-2-risk-exposure-are-we-within-limits","title":"Row 2 \u2014 Risk &amp; Exposure (\"Are we within limits?\")","text":"Panel Type Query Portfolio Equity Time series <code>titan_brain_current_equity</code> Daily Drawdown % Gauge + threshold <code>titan_brain_daily_drawdown_percent</code> High Watermark Time series <code>titan_brain_high_watermark</code> Leverage Gauge <code>titan_brain_current_leverage</code> Allocation Weights Pie / bar <code>titan_brain_allocation_weight{phase_id=~\".*\"}</code> Active Positions Stat <code>titan_execution_active_positions</code> Risk Rejections Counter <code>rate(titan_execution_risk_rejections_total[5m])</code> \ud83d\udd34 Funding/Basis \u2014 Not implemented"},{"location":"operations/dashboard-spec/#row-3-latency-throughput-are-we-fast-enough","title":"Row 3 \u2014 Latency &amp; Throughput (\"Are we fast enough?\")","text":"Panel Type Query Signal Latency P95/P99 Time series <code>histogram_quantile(0.95, rate(titan_brain_signal_processing_latency_ms_bucket[5m]))</code> Order Latency P95/P99 Time series <code>histogram_quantile(0.95, rate(titan_execution_order_latency_seconds_bucket[5m]))</code> Slippage Distribution Heatmap <code>titan_execution_slippage_bps_bucket</code> Fill Rate Stat <code>rate(titan_execution_filled_orders_total[5m])</code> Tick Throughput Time series <code>titan_scavenger_tick_processing_rate</code> NATS Consumer Lag Time series <code>nats_lag_messages</code> NATS Storage Time series <code>nats_storage_pressure_bytes</code> DB Query Time P95 Time series <code>histogram_quantile(0.95, rate(titan_brain_database_query_duration_ms_bucket[5m]))</code>"},{"location":"operations/dashboard-spec/#row-4-decisions-truth-are-decisions-correct","title":"Row 4 \u2014 Decisions &amp; Truth (\"Are decisions correct?\")","text":"Panel Type Query Decision Approval Rate Time series <code>rate(titan_brain_decisions_total{approved=\"true\"}[5m]) / rate(titan_brain_decisions_total[5m])</code> Sharpe Ratio by Phase Time series <code>titan_brain_sharpe_ratio{phase_id=~\".*\"}</code> Truth Confidence Gauge <code>titan_brain_truth_confidence_score</code> Drift Events Counter <code>rate(titan_brain_truth_drift_events_total[5m])</code> DLQ Published Counter <code>rate(titan_execution_dlq_published_total[5m])</code> Invalid Intents Counter <code>rate(titan_execution_invalid_intents_total[5m])</code> Adverse Selection Time series <code>titan_execution_bulgaria_adverse_selection_bps</code> Spread Capture Histogram <code>titan_execution_fill_quality_spread_capture_pct</code>"},{"location":"operations/dashboard-spec/#alert-overlay","title":"Alert Overlay","text":"Alert Condition Severity Runbook <code>HighErrorBudgetBurn</code> &gt;14.4\u00d7 error budget burn/1h critical incident_response <code>ExecutionLatencyBreach</code> P99 &gt; 100ms for 2m warning \u2014 <code>BrainLatencyBreach</code> P99 &gt; 500ms for 5m warning \u2014 <code>MarketDataStale</code> No tick &gt; 5s critical exchange_outage <code>ServiceDown</code> <code>up == 0</code> for 30s critical \u2014 <code>HighDrawdown</code> &gt; 5% critical \u2014 <code>HighCPUUsage</code> &gt; 80% for 5m warning \u2014 <code>HighMemoryUsage</code> &gt; 400MB for 5m warning \u2014"},{"location":"operations/data-governance/","title":"Data Engineering and Governance","text":""},{"location":"operations/data-governance/#ownership","title":"Ownership","text":"<ul> <li>Primary owner: Titan Brain team</li> <li>Schema changes: Must be reviewed by platform operations</li> </ul>"},{"location":"operations/data-governance/#schema-migration-policy","title":"Schema Migration Policy","text":"<ul> <li>Use forward-only migrations in <code>services/titan-brain/src/db/migrations</code>.</li> <li>Prefer additive changes (new columns/tables) with safe defaults.</li> <li>Breaking changes require a deprecation window and dual-write if needed.</li> <li>All migrations must be reversible or have a rollback plan.</li> </ul>"},{"location":"operations/data-governance/#migration-workflow","title":"Migration Workflow","text":"<ol> <li>Create migration file with version bump</li> <li>Validate on staging with production-like data volume</li> <li>Run <code>npm run migrate</code> during deployment window</li> <li>Verify schema and application health</li> </ol>"},{"location":"operations/data-governance/#backward-compatibility-rules","title":"Backward Compatibility Rules","text":"<ul> <li>Avoid dropping columns used by active services</li> <li>Gate new fields behind feature flags where possible</li> <li>Maintain compatibility across at least one release cycle</li> </ul>"},{"location":"operations/data-governance/#retention-and-archival","title":"Retention and Archival","text":"<p>Baseline retention (adjust to regulatory requirements):</p> <ul> <li>Orders and fills: 7 years</li> <li>Risk decisions and allocations: 3 years</li> <li>Market data (raw ticks): 30 days</li> <li>Aggregated market data: 1 year</li> <li>Operational logs: 90 days</li> <li>Metrics/telemetry: 90 days</li> </ul> <p>Archival policy:</p> <ul> <li>Export long-term records to immutable object storage</li> <li>Encrypt archives at rest with KMS-managed keys</li> <li>Maintain a searchable index for audits</li> </ul>"},{"location":"operations/data-governance/#data-quality-controls","title":"Data Quality Controls","text":"<ul> <li>Enforce schema validation at ingest</li> <li>Track missing or delayed data feeds</li> <li>Maintain data lineage for backtests</li> </ul>"},{"location":"operations/metrics-catalog/","title":"Metrics Catalog","text":"<p>Status: Canonical Source: Inventory from source code</p>"},{"location":"operations/metrics-catalog/#health-endpoints","title":"Health Endpoints","text":"Service Port Path Dependencies Checked titan-brain 3100 <code>/health</code> DB, Redis, NATS, Config, Memory, Venues titan-brain 3100 <code>/metrics</code> Prometheus prom-client export titan-scavenger 8081 <code>/health</code> Binance WS, Execution svc titan-scavenger 8081 <code>/health/live</code> (liveness only) titan-scavenger 8081 <code>/health/ready</code> Binance connected titan-scavenger 8081 <code>/metrics</code> Prometheus text export titan-sentinel 8084 <code>/health</code> NATS, Binance, Bybit titan-sentinel 8084 <code>/status</code> Regime mode + actions titan-hunter 8083 <code>/metrics</code> (configured in Prometheus, unverified) titan-execution-rs 3002 <code>/health</code> Internal state titan-execution-rs 3002 <code>/metrics</code> Rust prometheus crate NATS 8222 <code>/healthz</code> Cluster status"},{"location":"operations/metrics-catalog/#brain-metrics-titan_brain_-prefix-prom-client","title":"Brain Metrics (<code>titan_brain_*</code> prefix, prom-client)","text":"Metric Name Type Labels Meaning <code>signal_processing_latency_ms</code> histogram <code>phase_id</code>, <code>approved</code> Signal evaluation latency end-to-end <code>decisions_total</code> counter <code>phase_id</code>, <code>approved</code> Total decisions (accept / reject) <code>database_query_duration_ms</code> histogram <code>operation</code>, <code>table</code> DB round-trip per query <code>cache_requests_total</code> counter <code>cache_name</code>, <code>result</code> Cache hit / miss breakdown <code>current_equity</code> gauge \u2014 Portfolio equity USDT <code>allocation_weight</code> gauge <code>phase_id</code> Allocation per phase (0\u20131) <code>circuit_breaker_active</code> gauge \u2014 1 = tripped, 0 = normal <code>open_positions_count</code> gauge <code>phase_id</code> Open positions per phase <code>signal_queue_size</code> gauge \u2014 Pending signal backlog <code>high_watermark</code> gauge \u2014 Peak equity watermark <code>daily_drawdown_percent</code> gauge \u2014 Current drawdown vs. HWM <code>current_leverage</code> gauge \u2014 Combined leverage ratio <code>performance_modifier</code> gauge <code>phase_id</code> Kelly-style modifier <code>sharpe_ratio</code> gauge <code>phase_id</code> Rolling Sharpe <code>sweep_operations_total</code> counter <code>status</code> Sweep success / failure <code>notifications_sent_total</code> counter <code>channel</code>, <code>type</code> Alert dispatch count <code>truth_confidence_score</code> gauge \u2014 SSOT confidence 0\u2013100 <code>truth_drift_events_total</code> counter <code>source</code> Reconciliation drift events"},{"location":"operations/metrics-catalog/#execution-metrics-titan_execution_-prefix-rust-prometheus","title":"Execution Metrics (<code>titan_execution_*</code> prefix, Rust prometheus)","text":"Metric Name Type Labels Meaning <code>order_latency_seconds</code> histogram \u2014 Intent \u2192 Fill latency <code>slippage_bps</code> histogram \u2014 Execution slippage in bps <code>bulgaria_adverse_selection_bps</code> histogram \u2014 Post-fill adverse selection 1s <code>fill_quality_spread_capture_pct</code> histogram \u2014 Effective spread capture % <code>risk_state</code> gauge \u2014 0=Normal, 1=Cautious, 2=Defensive <code>active_positions</code> gauge \u2014 Current open position count <code>filled_orders_total</code> counter \u2014 Successfully filled orders <code>invalid_intents_total</code> counter \u2014 Schema-invalid intents received <code>expired_intents_total</code> counter \u2014 Intents rejected (expired) <code>dlq_published_total</code> counter \u2014 Dead-letter queue publishes <code>fanout_orders_total</code> counter \u2014 Fan-out child orders created <code>position_flips_total</code> counter \u2014 Position direction flips <code>risk_rejections_total</code> counter \u2014 Risk guard rejections <code>rejection_events_total</code> counter \u2014 Rejection telemetry events"},{"location":"operations/metrics-catalog/#nats-telemetry-rust-side","title":"NATS Telemetry (Rust side)","text":"Metric Name Type Meaning <code>nats_lag_messages</code> gauge Consumer lag in messages <code>nats_messages_in_process</code> gauge Messages currently being processed <code>nats_storage_pressure_bytes</code> gauge JetStream storage usage"},{"location":"operations/metrics-catalog/#scavenger-metrics-titan_scavenger_-prefix","title":"Scavenger Metrics (<code>titan_scavenger_*</code> prefix)","text":"Metric Name Type Labels Meaning <code>traps_detected_total</code> counter <code>trap_type</code>, <code>symbol</code> Trap detection events <code>signals_generated_total</code> counter <code>symbol</code>, <code>direction</code>, <code>result</code> Signal generation rate <code>ipc_messages_total</code> counter <code>direction</code>, <code>result</code> IPC sent/received <code>ipc_latency_ms</code> histogram <code>message_type</code> IPC round-trip latency <code>binance_ticks_total</code> counter <code>symbol</code> Raw tick throughput <code>binance_connected</code> gauge \u2014 WS connection status <code>active_traps</code> gauge <code>trap_type</code> Active trap count <code>trap_calculation_duration_ms</code> histogram <code>calculation_type</code> Trap calc latency <code>tick_processing_rate</code> gauge \u2014 Ticks/sec throughput <code>health_status</code> gauge <code>component</code> Component health (1/0) <code>config_reloads_total</code> counter <code>result</code> Config reload count"},{"location":"operations/metrics-catalog/#slo-definitions-from-monitoringslosyaml","title":"SLO Definitions (from <code>monitoring/slos.yaml</code>)","text":"SLO Target Window Alert Availability 99.9% 28d Error budget burn &gt;14.4\u00d7 normal Execution Latency P99 &lt; 100ms 5m <code>ExecutionLatencyBreach</code> Brain Latency P99 &lt; 500ms 5m <code>BrainLatencyBreach</code> Market Data Freshness &lt; 5s stale instant <code>MarketDataStale</code> Daily Drawdown &lt; 5% \u2014 <code>HighDrawdown</code> (from alert-rules)"},{"location":"operations/metrics-catalog/#known-gaps","title":"Known Gaps","text":"# Gap Impact 1 No kill-switch metric or endpoint Cannot prove kill-switch drill 2 Hunter health/metrics endpoint unverified Phase 2 may be blind 3 Sentinel has no <code>/metrics</code> endpoint No Prometheus scrape 4 No funding rate or basis metrics Sentinel strategy metrics invisible 5 No per-venue fill rate metric Cannot diagnose venue-specific issues 6 No event lag metric (brain side) Signal-to-execution lag unmeasured"},{"location":"operations/monitoring-alerting/","title":"Monitoring and Alerting","text":""},{"location":"operations/monitoring-alerting/#slos-and-kpis","title":"SLOs and KPIs","text":"<p>Baseline SLOs used for alerting:</p> <ul> <li>Service availability: 99.9% uptime for Brain and Execution</li> <li>Signal processing latency: P95 &lt; 100ms</li> <li>Order latency: P95 &lt; 1s (exchange-inclusive)</li> <li>Database query latency: P95 &lt; 1000ms</li> <li>Daily drawdown: &lt; 5% (critical threshold)</li> </ul>"},{"location":"operations/monitoring-alerting/#alert-thresholds","title":"Alert Thresholds","text":"<p>Alert rules are defined in <code>monitoring/prometheus/config/alert-rules-comprehensive.yml</code> and include:</p> <ul> <li>ServiceDown: <code>up{job=~\"titan-.*\"} == 0</code> for 30s</li> <li>HighSignalLatency: P95 &gt; 100ms (Brain)</li> <li>HighOrderLatency: P95 &gt; 1s (Execution)</li> <li>LowOrderFillRate: &lt; 80%</li> <li>HighDrawdown: &gt; 5%</li> <li>LowEquity: &lt; $200</li> <li>HighCPUUsage: &gt; 80% for 5m</li> <li>HighMemoryUsage: &gt; 400MB for 5m</li> <li>LowDiskSpace: &lt; 10% free</li> </ul>"},{"location":"operations/monitoring-alerting/#tracing-opentelemetry","title":"Tracing (OpenTelemetry)","text":"<p>Distributed tracing is implemented primarily in the Rust Execution Engine (<code>titan-execution-rs</code>).</p> <ul> <li>Protocol: OTLP/gRPC</li> <li>Endpoint: <code>http://tempo:4317</code> (OTLP/gRPC, internal Docker Network)</li> <li>Standard Tags:</li> <li><code>service.name</code>: <code>titan-execution-rs</code></li> <li><code>service.version</code>: <code>0.1.0</code></li> </ul> <p>Traces allow visualization of the \"Message-to-Fill\" lifecycle across the NATS bus.</p>"},{"location":"operations/monitoring-alerting/#dashboards","title":"Dashboards","text":"<p>Grafana dashboards are provisioned from:</p> <ul> <li><code>services/titan-brain/monitoring/grafana-dashboard-comprehensive.json</code></li> </ul> <p>Use this dashboard for:</p> <ul> <li>Phase-level signal rates and rejection ratios</li> <li>Execution latency and fill rate</li> <li>Brain risk metrics and drawdown state</li> </ul>"},{"location":"operations/monitoring-alerting/#operator-workflow","title":"Operator Workflow","text":"<ol> <li>Monitor the Grafana overview dashboard during market hours</li> <li>Acknowledge alerts and follow runbooks in <code>docs/operations/runbooks</code></li> <li>Escalate critical alerts to the trading operations manager</li> </ol>"},{"location":"operations/scavenger-config/","title":"ConfigManager Usage Guide","text":"<p>The ConfigManager handles all runtime configuration for the Titan Phase 1 Scavenger system.</p>"},{"location":"operations/scavenger-config/#features","title":"Features","text":"<ul> <li>\u2705 Load configuration from file or use defaults</li> <li>\u2705 Save configuration with immediate file write</li> <li>\u2705 Hot-reload support (no restart required)</li> <li>\u2705 Exchange configuration (Binance, Bybit, MEXC)</li> <li>\u2705 Comprehensive validation</li> <li>\u2705 Type-safe configuration interface</li> </ul>"},{"location":"operations/scavenger-config/#quick-start","title":"Quick Start","text":"<pre><code>import { ConfigManager } from './config/ConfigManager';\n\n// Create instance (loads config from ~/.titan-scanner/config.json)\nconst configManager = new ConfigManager();\n\n// Get current config\nconst config = configManager.getConfig();\nconsole.log(`Max Leverage: ${config.maxLeverage}x`);\n\n// Update specific settings\nconfigManager.updateRiskSettings({\n  maxLeverage: 15,\n  stopLossPercent: 0.015,\n});\n\n// Update exchange settings\nconfigManager.updateExchangeSettings('mexc', {\n  enabled: true,\n  executeOn: true,\n});\n\n// Validate configuration\nconst errors = configManager.validateConfig(config);\nif (errors.length &gt; 0) {\n  console.error('Config validation errors:', errors);\n}\n\n// Reset to defaults\nconfigManager.resetToDefaults();\n</code></pre>"},{"location":"operations/scavenger-config/#configuration-structure","title":"Configuration Structure","text":"<pre><code>interface TrapConfig {\n  // Pre-Computation Settings\n  updateInterval: number;        // 60000ms (1 minute)\n  topSymbolsCount: number;       // 20\n\n  // Tripwire Thresholds\n  liquidationConfidence: number; // 95\n  dailyLevelConfidence: number;  // 85\n  bollingerConfidence: number;   // 90\n\n  // Volume Validation\n  minTradesIn100ms: number;      // 50\n  volumeWindowMs: number;        // 100\n\n  // Execution Settings\n  extremeVelocityThreshold: number;   // 0.005 (0.5%/s)\n  moderateVelocityThreshold: number;  // 0.001 (0.1%/s)\n  aggressiveLimitMarkup: number;      // 0.002 (0.2%)\n\n  // Risk Management\n  maxLeverage: number;           // 20\n  stopLossPercent: number;       // 0.01 (1%)\n  targetPercent: number;         // 0.03 (3%)\n\n  // Exchange Settings\n  exchanges: {\n    binance: { enabled: boolean };\n    bybit: { enabled: boolean; executeOn: boolean };\n    mexc: { enabled: boolean; executeOn: boolean };\n  };\n}\n</code></pre>"},{"location":"operations/scavenger-config/#default-values","title":"Default Values","text":"Setting Default Description <code>updateInterval</code> 60000ms Pre-computation cycle interval <code>topSymbolsCount</code> 20 Number of symbols to monitor <code>liquidationConfidence</code> 95 Confidence for liquidation traps <code>dailyLevelConfidence</code> 85 Confidence for daily level traps <code>bollingerConfidence</code> 90 Confidence for Bollinger traps <code>minTradesIn100ms</code> 50 Minimum trades for volume validation <code>volumeWindowMs</code> 100 Volume validation window <code>extremeVelocityThreshold</code> 0.005 Threshold for MARKET orders (0.5%/s) <code>moderateVelocityThreshold</code> 0.001 Threshold for AGGRESSIVE LIMIT (0.1%/s) <code>aggressiveLimitMarkup</code> 0.002 Markup for aggressive limits (0.2%) <code>maxLeverage</code> 20 Maximum leverage allowed <code>stopLossPercent</code> 0.01 Stop loss percentage (1%) <code>targetPercent</code> 0.03 Target profit percentage (3%) <code>exchanges.binance.enabled</code> true Always enabled for signal validation <code>exchanges.bybit.executeOn</code> true Execute on Bybit by default <code>exchanges.mexc.executeOn</code> false MEXC disabled by default"},{"location":"operations/scavenger-config/#configuration-file-location","title":"Configuration File Location","text":"<p>The configuration is stored at: <pre><code>~/.titan-scanner/config.json\n</code></pre></p>"},{"location":"operations/scavenger-config/#hot-reload-example","title":"Hot-Reload Example","text":"<pre><code>// Initial config\nconst config = configManager.getConfig();\nconsole.log(`Leverage: ${config.maxLeverage}x`); // 20x\n\n// Update without restart\nconfigManager.updateConfig({ maxLeverage: 15 });\n\n// Immediately available\nconst updated = configManager.getConfig();\nconsole.log(`Leverage: ${updated.maxLeverage}x`); // 15x\n</code></pre>"},{"location":"operations/scavenger-config/#validation","title":"Validation","text":"<p>The ConfigManager includes comprehensive validation:</p> <pre><code>const config = configManager.getConfig();\n\n// Modify config\nconfig.maxLeverage = 150; // Invalid!\n\n// Validate\nconst errors = configManager.validateConfig(config);\nconsole.log(errors);\n// ['maxLeverage must be between 1 and 100']\n</code></pre>"},{"location":"operations/scavenger-config/#validation-rules","title":"Validation Rules","text":"<ul> <li><code>updateInterval</code>: 10000ms - 300000ms</li> <li><code>topSymbolsCount</code>: 1 - 50</li> <li><code>liquidationConfidence</code>: 0 - 100</li> <li><code>dailyLevelConfidence</code>: 0 - 100</li> <li><code>bollingerConfidence</code>: 0 - 100</li> <li><code>minTradesIn100ms</code>: 1 - 1000</li> <li><code>volumeWindowMs</code>: 10ms - 1000ms</li> <li><code>extremeVelocityThreshold</code>: 0 - 0.1 (10%)</li> <li><code>moderateVelocityThreshold</code>: 0 - 0.05 (5%)</li> <li><code>aggressiveLimitMarkup</code>: 0 - 0.01 (1%)</li> <li><code>maxLeverage</code>: 1 - 100</li> <li><code>stopLossPercent</code>: 0.001 (0.1%) - 0.1 (10%)</li> <li><code>targetPercent</code>: 0.001 (0.1%) - 0.5 (50%)</li> <li>Binance must always be enabled</li> <li>At least one execution exchange must be enabled</li> </ul>"},{"location":"operations/scavenger-config/#integration-with-titantrap","title":"Integration with TitanTrap","text":"<pre><code>import { TitanTrap } from './engine/TitanTrap';\nimport { ConfigManager } from './config/ConfigManager';\n\nconst configManager = new ConfigManager();\nconst titanTrap = new TitanTrap(configManager);\n\n// TitanTrap reads config dynamically\nconst config = configManager.getConfig();\n\n// Use config values\nif (config.exchanges.bybit.executeOn) {\n  await titanTrap.executeOnBybit(trap);\n}\n\nif (config.exchanges.mexc.executeOn) {\n  await titanTrap.executeOnMEXC(trap);\n}\n</code></pre>"},{"location":"operations/scavenger-config/#requirements-satisfied","title":"Requirements Satisfied","text":"<p>This implementation satisfies Requirements 12.1-12.7:</p> <ul> <li>\u2705 12.1: F1 key configuration panel (UI integration point)</li> <li>\u2705 12.2: Regime settings adjustment</li> <li>\u2705 12.3: Flow settings adjustment</li> <li>\u2705 12.4: Risk settings adjustment</li> <li>\u2705 12.5: Save configuration with immediate write and apply</li> <li>\u2705 12.6: Cancel configuration changes</li> <li>\u2705 12.7: Handle corrupted config with defaults</li> </ul>"},{"location":"operations/scavenger-credentials/","title":"CredentialManager - Secure Credential Storage","text":""},{"location":"operations/scavenger-credentials/#overview","title":"Overview","text":"<p>The <code>CredentialManager</code> provides secure storage and retrieval of exchange API credentials using AES-256-GCM authenticated encryption. All credentials are encrypted with a master password and stored in <code>~/.titan-scanner/secrets.enc</code>.</p>"},{"location":"operations/scavenger-credentials/#security-features","title":"Security Features","text":"<ul> <li>AES-256-GCM: Authenticated encryption with 256-bit keys</li> <li>PBKDF2 Key Derivation: 100,000 iterations (OWASP recommended minimum)</li> <li>Random IV: New initialization vector for each encryption</li> <li>Random Salt: New salt for each key derivation</li> <li>Authentication Tag: Prevents tampering with encrypted data</li> <li>Secure File Permissions: Credentials file is readable/writable by owner only (0600)</li> </ul>"},{"location":"operations/scavenger-credentials/#setup","title":"Setup","text":""},{"location":"operations/scavenger-credentials/#1-set-master-password","title":"1. Set Master Password","text":"<p>The master password must be set as an environment variable:</p> <pre><code>export TITAN_MASTER_PASSWORD=\"your-secure-password-here\"\n</code></pre> <p>Requirements: - Minimum 12 characters - Should be strong and unique - Never commit to version control</p>"},{"location":"operations/scavenger-credentials/#2-add-to-env-file-recommended","title":"2. Add to .env File (Recommended)","text":"<p>Create a <code>.env</code> file in your project root:</p> <pre><code># .env\nTITAN_MASTER_PASSWORD=your-secure-password-here\n</code></pre> <p>Then load it in your application:</p> <pre><code>import * as dotenv from 'dotenv';\ndotenv.config();\n</code></pre> <p>IMPORTANT: Add <code>.env</code> to your <code>.gitignore</code> file!</p>"},{"location":"operations/scavenger-credentials/#usage","title":"Usage","text":""},{"location":"operations/scavenger-credentials/#basic-usage","title":"Basic Usage","text":"<pre><code>import { CredentialManager } from './config/CredentialManager';\n\n// Create instance\nconst credManager = new CredentialManager();\n\n// Save credentials\nconst credentials = {\n  binance: {\n    apiKey: 'your-binance-api-key',\n    apiSecret: 'your-binance-api-secret',\n  },\n  bybit: {\n    apiKey: 'your-bybit-api-key',\n    apiSecret: 'your-bybit-api-secret',\n  },\n  mexc: {\n    apiKey: 'your-mexc-api-key',\n    apiSecret: 'your-mexc-api-secret',\n  },\n};\n\ncredManager.saveCredentials(credentials);\n\n// Load credentials\nconst loadedCreds = credManager.loadCredentials();\nconsole.log(loadedCreds.binance.apiKey);\n</code></pre>"},{"location":"operations/scavenger-credentials/#update-single-exchange","title":"Update Single Exchange","text":"<pre><code>// Update Binance credentials\ncredManager.updateExchangeCredentials(\n  'binance',\n  'new-api-key',\n  'new-api-secret'\n);\n\n// Update with skipValidation for partial updates\ncredManager.updateExchangeCredentials(\n  'mexc',\n  'mexc-key',\n  'mexc-secret',\n  true  // Skip validation\n);\n</code></pre>"},{"location":"operations/scavenger-credentials/#check-if-credentials-exist","title":"Check if Credentials Exist","text":"<pre><code>if (credManager.credentialsExist()) {\n  const creds = credManager.loadCredentials();\n  // Use credentials\n} else {\n  console.log('No credentials found. Please set up credentials first.');\n}\n</code></pre>"},{"location":"operations/scavenger-credentials/#delete-credentials","title":"Delete Credentials","text":"<pre><code>credManager.deleteCredentials();\n</code></pre>"},{"location":"operations/scavenger-credentials/#change-master-password","title":"Change Master Password","text":"<pre><code>// Re-encrypts credentials with new password\ncredManager.changeMasterPassword('new-secure-password-12345');\n</code></pre>"},{"location":"operations/scavenger-credentials/#validate-credentials","title":"Validate Credentials","text":"<pre><code>const errors = credManager.validateCredentials(credentials);\n\nif (errors.length &gt; 0) {\n  console.error('Validation errors:', errors);\n} else {\n  console.log('Credentials are valid');\n}\n</code></pre>"},{"location":"operations/scavenger-credentials/#file-structure","title":"File Structure","text":""},{"location":"operations/scavenger-credentials/#encrypted-file-format","title":"Encrypted File Format","text":"<p>The encrypted credentials file (<code>~/.titan-scanner/secrets.enc</code>) contains:</p> <pre><code>{\n  \"version\": 1,\n  \"salt\": \"base64-encoded-salt\",\n  \"iv\": \"base64-encoded-iv\",\n  \"authTag\": \"base64-encoded-auth-tag\",\n  \"encryptedData\": \"base64-encoded-encrypted-credentials\"\n}\n</code></pre>"},{"location":"operations/scavenger-credentials/#credentials-structure","title":"Credentials Structure","text":"<pre><code>interface ExchangeCredentials {\n  binance: {\n    apiKey: string;\n    apiSecret: string;\n  };\n  bybit: {\n    apiKey: string;\n    apiSecret: string;\n  };\n  mexc: {\n    apiKey: string;\n    apiSecret: string;\n  };\n}\n</code></pre>"},{"location":"operations/scavenger-credentials/#validation-rules","title":"Validation Rules","text":"<p>The <code>validateCredentials()</code> method enforces:</p> <ol> <li>Binance credentials are required (always enabled for signal validation)</li> <li>Bybit credentials are required (primary execution exchange)</li> <li>MEXC credentials are optional but if provided, both key and secret must be present</li> <li>No empty strings for required fields</li> </ol>"},{"location":"operations/scavenger-credentials/#security-best-practices","title":"Security Best Practices","text":""},{"location":"operations/scavenger-credentials/#do","title":"DO:","text":"<p>\u2705 Use a strong master password (12+ characters) \u2705 Store master password in environment variable \u2705 Add <code>.env</code> to <code>.gitignore</code> \u2705 Use different passwords for different environments \u2705 Rotate API keys regularly \u2705 Use read-only API keys when possible</p>"},{"location":"operations/scavenger-credentials/#dont","title":"DON'T:","text":"<p>\u274c Commit master password to version control \u274c Share master password via insecure channels \u274c Use weak or common passwords \u274c Store credentials in plain text \u274c Reuse passwords across systems</p>"},{"location":"operations/scavenger-credentials/#error-handling","title":"Error Handling","text":""},{"location":"operations/scavenger-credentials/#common-errors","title":"Common Errors","text":"<p>Master password not set: <pre><code>Error: TITAN_MASTER_PASSWORD environment variable not set\n</code></pre> Solution: Set the environment variable</p> <p>Master password too short: <pre><code>Error: Master password must be at least 12 characters long\n</code></pre> Solution: Use a longer password</p> <p>Incorrect master password: <pre><code>Error: Failed to decrypt credentials\n</code></pre> Solution: Verify the master password is correct</p> <p>Credentials file not found: <pre><code>Error: Credentials file not found: ~/.titan-scanner/secrets.enc\n</code></pre> Solution: Save credentials first using <code>saveCredentials()</code></p> <p>Validation failed: <pre><code>Error: Credential validation failed:\nBinance API key is required\nBybit API secret is required\n</code></pre> Solution: Provide all required credentials</p>"},{"location":"operations/scavenger-credentials/#integration-example","title":"Integration Example","text":""},{"location":"operations/scavenger-credentials/#complete-setup-flow","title":"Complete Setup Flow","text":"<pre><code>import { CredentialManager } from './config/CredentialManager';\nimport * as dotenv from 'dotenv';\n\n// Load environment variables\ndotenv.config();\n\n// Create credential manager\nconst credManager = new CredentialManager();\n\n// Check if credentials exist\nif (!credManager.credentialsExist()) {\n  console.log('Setting up credentials for the first time...');\n\n  // Create credentials\n  const credentials = {\n    binance: {\n      apiKey: process.env.BINANCE_API_KEY || '',\n      apiSecret: process.env.BINANCE_API_SECRET || '',\n    },\n    bybit: {\n      apiKey: process.env.BYBIT_API_KEY || '',\n      apiSecret: process.env.BYBIT_API_SECRET || '',\n    },\n    mexc: {\n      apiKey: process.env.MEXC_API_KEY || '',\n      apiSecret: process.env.MEXC_API_SECRET || '',\n    },\n  };\n\n  // Validate\n  const errors = credManager.validateCredentials(credentials);\n  if (errors.length &gt; 0) {\n    console.error('Credential validation failed:', errors);\n    process.exit(1);\n  }\n\n  // Save\n  credManager.saveCredentials(credentials);\n  console.log('\u2705 Credentials saved successfully');\n}\n\n// Load credentials for use\nconst creds = credManager.loadCredentials();\n\n// Use credentials with exchange clients\nconst binanceClient = new BinanceClient(creds.binance.apiKey, creds.binance.apiSecret);\nconst bybitClient = new BybitClient(creds.bybit.apiKey, creds.bybit.apiSecret);\n</code></pre>"},{"location":"operations/scavenger-credentials/#testing","title":"Testing","text":"<p>Run the test suite:</p> <pre><code>npm test -- CredentialManager.test.ts\n</code></pre> <p>The test suite covers: - Encryption/decryption round-trips - Master password validation - File operations - Error handling - Security properties (IV randomness, authentication) - Credential validation - Update operations</p>"},{"location":"operations/scavenger-credentials/#technical-details","title":"Technical Details","text":""},{"location":"operations/scavenger-credentials/#encryption-algorithm","title":"Encryption Algorithm","text":"<p>AES-256-GCM (Galois/Counter Mode): - Key Size: 256 bits (32 bytes) - IV Size: 128 bits (16 bytes) - Authentication Tag: 128 bits (16 bytes) - Mode: Authenticated encryption with associated data (AEAD)</p>"},{"location":"operations/scavenger-credentials/#key-derivation","title":"Key Derivation","text":"<p>PBKDF2 (Password-Based Key Derivation Function 2): - Hash Function: SHA-256 - Iterations: 100,000 (OWASP recommended minimum) - Salt Size: 256 bits (32 bytes) - Output Key Size: 256 bits (32 bytes)</p>"},{"location":"operations/scavenger-credentials/#why-aes-256-gcm","title":"Why AES-256-GCM?","text":"<ol> <li>Authenticated Encryption: Provides both confidentiality and authenticity</li> <li>Tamper Detection: Authentication tag prevents modification of ciphertext</li> <li>Industry Standard: Widely used and well-tested</li> <li>Performance: Hardware acceleration available on modern CPUs</li> <li>NIST Approved: Recommended by NIST for sensitive data</li> </ol>"},{"location":"operations/scavenger-credentials/#why-pbkdf2","title":"Why PBKDF2?","text":"<ol> <li>Brute Force Resistance: High iteration count slows down password cracking</li> <li>Salt: Prevents rainbow table attacks</li> <li>Standardized: NIST SP 800-132 compliant</li> <li>Widely Supported: Available in Node.js crypto module</li> </ol>"},{"location":"operations/scavenger-credentials/#file-locations","title":"File Locations","text":"<ul> <li>Credentials File: <code>~/.titan-scanner/secrets.enc</code></li> <li>Config Directory: <code>~/.titan-scanner/</code></li> <li>File Permissions: <code>0600</code> (read/write for owner only)</li> </ul>"},{"location":"operations/scavenger-credentials/#api-reference","title":"API Reference","text":""},{"location":"operations/scavenger-credentials/#constructor","title":"Constructor","text":"<pre><code>new CredentialManager()\n</code></pre> <p>Creates a new instance and ensures the credentials directory exists.</p>"},{"location":"operations/scavenger-credentials/#methods","title":"Methods","text":""},{"location":"operations/scavenger-credentials/#savecredentialscredentials-exchangecredentials-void","title":"<code>saveCredentials(credentials: ExchangeCredentials): void</code>","text":"<p>Encrypts and saves credentials to file.</p> <p>Throws: Error if master password is not set or too short</p>"},{"location":"operations/scavenger-credentials/#loadcredentials-exchangecredentials","title":"<code>loadCredentials(): ExchangeCredentials</code>","text":"<p>Loads and decrypts credentials from file.</p> <p>Returns: Decrypted credentials Throws: Error if file doesn't exist or decryption fails</p>"},{"location":"operations/scavenger-credentials/#credentialsexist-boolean","title":"<code>credentialsExist(): boolean</code>","text":"<p>Checks if credentials file exists.</p> <p>Returns: <code>true</code> if file exists, <code>false</code> otherwise</p>"},{"location":"operations/scavenger-credentials/#deletecredentials-boolean","title":"<code>deleteCredentials(): boolean</code>","text":"<p>Deletes the credentials file.</p> <p>Returns: <code>true</code> if file was deleted, <code>false</code> if it didn't exist</p>"},{"location":"operations/scavenger-credentials/#updateexchangecredentialsexchange-apikey-apisecret-skipvalidation-void","title":"<code>updateExchangeCredentials(exchange, apiKey, apiSecret, skipValidation?): void</code>","text":"<p>Updates credentials for a specific exchange.</p> <p>Parameters: - <code>exchange</code>: 'binance' | 'bybit' | 'mexc' - <code>apiKey</code>: API key string - <code>apiSecret</code>: API secret string - <code>skipValidation</code>: Optional boolean to skip validation (default: false)</p>"},{"location":"operations/scavenger-credentials/#validatecredentialscredentials-exchangecredentials-string","title":"<code>validateCredentials(credentials: ExchangeCredentials): string[]</code>","text":"<p>Validates credential structure and completeness.</p> <p>Returns: Array of validation error messages (empty if valid)</p>"},{"location":"operations/scavenger-credentials/#createemptycredentials-exchangecredentials","title":"<code>createEmptyCredentials(): ExchangeCredentials</code>","text":"<p>Creates an empty credentials structure.</p> <p>Returns: Empty credentials object</p>"},{"location":"operations/scavenger-credentials/#changemasterpasswordnewpassword-string-void","title":"<code>changeMasterPassword(newPassword: string): void</code>","text":"<p>Changes the master password and re-encrypts credentials.</p> <p>Parameters: - <code>newPassword</code>: New master password (minimum 12 characters)</p> <p>Throws: Error if new password is too short</p>"},{"location":"operations/scavenger-credentials/#getcredentialspath-string","title":"<code>getCredentialsPath(): string</code>","text":"<p>Gets the path to the encrypted credentials file.</p> <p>Returns: Full path to credentials file</p>"},{"location":"operations/scavenger-credentials/#troubleshooting","title":"Troubleshooting","text":""},{"location":"operations/scavenger-credentials/#issue-titan_master_password-environment-variable-not-set","title":"Issue: \"TITAN_MASTER_PASSWORD environment variable not set\"","text":"<p>Solution: <pre><code>export TITAN_MASTER_PASSWORD=\"your-password\"\n</code></pre></p> <p>Or add to <code>.env</code> file and load with <code>dotenv</code>.</p>"},{"location":"operations/scavenger-credentials/#issue-failed-to-decrypt-credentials","title":"Issue: \"Failed to decrypt credentials\"","text":"<p>Possible causes: 1. Wrong master password 2. Corrupted credentials file 3. File was tampered with</p> <p>Solution: 1. Verify master password is correct 2. If file is corrupted, delete and recreate credentials 3. Check file permissions</p>"},{"location":"operations/scavenger-credentials/#issue-credential-validation-failed","title":"Issue: \"Credential validation failed\"","text":"<p>Solution: Ensure all required fields are provided: - Binance API key and secret (required) - Bybit API key and secret (required) - MEXC credentials (optional, but both key and secret if provided)</p>"},{"location":"operations/scavenger-credentials/#issue-permission-denied-when-accessing-credentials-file","title":"Issue: Permission denied when accessing credentials file","text":"<p>Solution: <pre><code>chmod 600 ~/.titan-scanner/secrets.enc\n</code></pre></p>"},{"location":"operations/scavenger-credentials/#migration-guide","title":"Migration Guide","text":""},{"location":"operations/scavenger-credentials/#from-plain-text-credentials","title":"From Plain Text Credentials","text":"<p>If you're migrating from plain text credentials:</p> <pre><code>// Old way (INSECURE)\nconst apiKey = 'plain-text-key';\nconst apiSecret = 'plain-text-secret';\n\n// New way (SECURE)\nconst credManager = new CredentialManager();\ncredManager.saveCredentials({\n  binance: { apiKey: 'key', apiSecret: 'secret' },\n  bybit: { apiKey: 'key', apiSecret: 'secret' },\n  mexc: { apiKey: '', apiSecret: '' },\n});\n\n// Load when needed\nconst creds = credManager.loadCredentials();\n</code></pre>"},{"location":"operations/scavenger-credentials/#changing-master-password","title":"Changing Master Password","text":"<pre><code>// 1. Load with old password\nprocess.env.TITAN_MASTER_PASSWORD = 'old-password';\nconst credManager = new CredentialManager();\n\n// 2. Change to new password\ncredManager.changeMasterPassword('new-password-12345');\n\n// 3. Update environment variable\nprocess.env.TITAN_MASTER_PASSWORD = 'new-password-12345';\n</code></pre>"},{"location":"operations/scavenger-credentials/#support","title":"Support","text":"<p>For issues or questions: 1. Check this documentation 2. Review test cases in <code>tests/unit/CredentialManager.test.ts</code> 3. Check error messages for specific guidance 4. Verify environment variables are set correctly</p>"},{"location":"operations/scavenger-logging/","title":"Logger Module","text":""},{"location":"operations/scavenger-logging/#overview","title":"Overview","text":"<p>The Logger module provides JSONL (JSON Lines) logging for the Titan Phase 1 Scavenger system. All signals, executions, position closes, and errors are logged to <code>~/.titan-scanner/logs/trades.jsonl</code> for queryable analysis.</p>"},{"location":"operations/scavenger-logging/#features","title":"Features","text":"<p>\u2705 JSONL Format: One JSON object per line for easy parsing with <code>jq</code> or other tools \u2705 Signal Logging: Logs all trap details (type, confidence, leverage, entry/stop/target) \u2705 Execution Logging: Logs fill prices, timestamps, and order types \u2705 Error Logging: Logs errors with full context and stack traces \u2705 Automatic Rotation: Rotates logs when file size exceeds 10MB \u2705 Automatic Compression: Compresses logs older than 30 days using gzip \u2705 Query Support: Built-in query method for filtering logs  </p>"},{"location":"operations/scavenger-logging/#usage","title":"Usage","text":""},{"location":"operations/scavenger-logging/#basic-initialization","title":"Basic Initialization","text":"<pre><code>import { Logger } from './logging/Logger';\n\n// Use default directory (~/.titan-scanner/logs/)\nconst logger = new Logger();\n\n// Or specify custom directory\nconst logger = new Logger('/path/to/logs');\n</code></pre>"},{"location":"operations/scavenger-logging/#logging-signals","title":"Logging Signals","text":"<pre><code>logger.logSignal({\n  symbol: 'BTCUSDT',\n  trapType: 'OI_WIPEOUT',\n  direction: 'LONG',\n  entry: 50000,\n  stop: 49500,\n  target: 51500,\n  confidence: 95,\n  leverage: 20,\n  orderType: 'MARKET',\n  velocity: 0.006,\n  positionSize: 0.1\n});\n</code></pre>"},{"location":"operations/scavenger-logging/#logging-executions","title":"Logging Executions","text":"<pre><code>logger.logExecution({\n  symbol: 'BTCUSDT',\n  trapType: 'OI_WIPEOUT',\n  direction: 'LONG',\n  fillPrice: 50050,\n  fillTimestamp: Date.now(),\n  orderType: 'MARKET',\n  positionSize: 0.1,\n  leverage: 20\n});\n</code></pre>"},{"location":"operations/scavenger-logging/#logging-position-closes","title":"Logging Position Closes","text":"<pre><code>logger.logClose({\n  symbol: 'BTCUSDT',\n  exitPrice: 51500,\n  exitTimestamp: Date.now(),\n  profitPercent: 3.0,\n  closeReason: 'TARGET_HIT',\n  entry: 50000\n});\n</code></pre>"},{"location":"operations/scavenger-logging/#logging-errors","title":"Logging Errors","text":"<pre><code>// With Error object\ntry {\n  await bybitClient.placeOrder(...);\n} catch (error) {\n  logger.logError(error, { symbol: 'BTCUSDT', orderType: 'MARKET' });\n}\n\n// With string message\nlogger.logError('Connection timeout', { exchange: 'Bybit' });\n</code></pre>"},{"location":"operations/scavenger-logging/#querying-logs","title":"Querying Logs","text":"<pre><code>// Get all entries\nconst allEntries = logger.queryLogs();\n\n// Filter by type\nconst signals = logger.queryLogs(entry =&gt; entry.type === 'signal');\n\n// Filter by trap type\nconst oiWipeouts = logger.queryLogs(entry =&gt; entry.trapType === 'OI_WIPEOUT');\n\n// Filter by symbol\nconst btcTrades = logger.queryLogs(entry =&gt; entry.symbol === 'BTCUSDT');\n</code></pre>"},{"location":"operations/scavenger-logging/#log-entry-types","title":"Log Entry Types","text":""},{"location":"operations/scavenger-logging/#signal-entry","title":"Signal Entry","text":"<pre><code>{\n  \"timestamp\": 1704067200000,\n  \"type\": \"signal\",\n  \"symbol\": \"BTCUSDT\",\n  \"trapType\": \"OI_WIPEOUT\",\n  \"direction\": \"LONG\",\n  \"entry\": 50000,\n  \"stop\": 49500,\n  \"target\": 51500,\n  \"confidence\": 95,\n  \"leverage\": 20,\n  \"orderType\": \"MARKET\",\n  \"velocity\": 0.006,\n  \"positionSize\": 0.1\n}\n</code></pre>"},{"location":"operations/scavenger-logging/#execution-entry","title":"Execution Entry","text":"<pre><code>{\n  \"timestamp\": 1704067205000,\n  \"type\": \"execution\",\n  \"symbol\": \"BTCUSDT\",\n  \"trapType\": \"OI_WIPEOUT\",\n  \"direction\": \"LONG\",\n  \"fillPrice\": 50050,\n  \"fillTimestamp\": 1704067205000,\n  \"orderType\": \"MARKET\",\n  \"positionSize\": 0.1,\n  \"leverage\": 20\n}\n</code></pre>"},{"location":"operations/scavenger-logging/#close-entry","title":"Close Entry","text":"<pre><code>{\n  \"timestamp\": 1704067800000,\n  \"type\": \"close\",\n  \"symbol\": \"BTCUSDT\",\n  \"exitPrice\": 51500,\n  \"exitTimestamp\": 1704067800000,\n  \"profitPercent\": 3.0,\n  \"closeReason\": \"TARGET_HIT\",\n  \"entry\": 50000\n}\n</code></pre>"},{"location":"operations/scavenger-logging/#error-entry","title":"Error Entry","text":"<pre><code>{\n  \"timestamp\": 1704067210000,\n  \"type\": \"error\",\n  \"symbol\": \"BTCUSDT\",\n  \"error\": \"Order placement failed\",\n  \"errorStack\": \"Error: Order placement failed\\n    at ...\",\n  \"context\": {\n    \"orderType\": \"MARKET\",\n    \"reason\": \"Insufficient balance\"\n  }\n}\n</code></pre>"},{"location":"operations/scavenger-logging/#command-line-analysis","title":"Command-Line Analysis","text":""},{"location":"operations/scavenger-logging/#using-jq","title":"Using jq","text":"<pre><code># Show all OI_WIPEOUT signals\ncat ~/.titan-scanner/logs/trades.jsonl | jq 'select(.trapType == \"OI_WIPEOUT\")'\n\n# Calculate win rate\ncat ~/.titan-scanner/logs/trades.jsonl | jq -s '\n  map(select(.type == \"close\")) | \n  group_by(.profitPercent &gt; 0) | \n  map({profitable: .[0].profitPercent &gt; 0, count: length})\n'\n\n# Show all errors\ncat ~/.titan-scanner/logs/trades.jsonl | jq 'select(.type == \"error\")'\n\n# Show signals by confidence\ncat ~/.titan-scanner/logs/trades.jsonl | jq 'select(.type == \"signal\") | {symbol, trapType, confidence}'\n\n# Calculate average profit per trap type\ncat ~/.titan-scanner/logs/trades.jsonl | jq -s '\n  map(select(.type == \"close\")) | \n  group_by(.trapType) | \n  map({\n    trapType: .[0].trapType, \n    avgProfit: (map(.profitPercent) | add / length)\n  })\n'\n</code></pre>"},{"location":"operations/scavenger-logging/#using-grep","title":"Using grep","text":"<pre><code># Find all BTCUSDT trades\ngrep \"BTCUSDT\" ~/.titan-scanner/logs/trades.jsonl\n\n# Find all errors\ngrep '\"type\":\"error\"' ~/.titan-scanner/logs/trades.jsonl\n\n# Find all executions\ngrep '\"type\":\"execution\"' ~/.titan-scanner/logs/trades.jsonl\n</code></pre>"},{"location":"operations/scavenger-logging/#log-rotation","title":"Log Rotation","text":"<p>Logs are automatically rotated when the file size exceeds 10MB:</p> <pre><code>~/.titan-scanner/logs/\n\u251c\u2500\u2500 trades.jsonl                    # Current log file\n\u251c\u2500\u2500 trades-2024-01-01T12-30-00.jsonl  # Rotated log\n\u2514\u2500\u2500 trades-2024-01-02T08-15-00.jsonl  # Rotated log\n</code></pre>"},{"location":"operations/scavenger-logging/#log-compression","title":"Log Compression","text":"<p>Logs older than 30 days are automatically compressed using gzip:</p> <pre><code>~/.titan-scanner/logs/\n\u251c\u2500\u2500 trades.jsonl                          # Current log file\n\u251c\u2500\u2500 trades-2023-12-01T12-30-00.jsonl.gz  # Compressed old log\n\u2514\u2500\u2500 trades-2023-12-05T08-15-00.jsonl.gz  # Compressed old log\n</code></pre> <p>To read compressed logs:</p> <pre><code># Decompress and view\ngunzip -c ~/.titan-scanner/logs/trades-2023-12-01T12-30-00.jsonl.gz | jq\n\n# Search in compressed logs\nzgrep \"BTCUSDT\" ~/.titan-scanner/logs/trades-*.jsonl.gz\n</code></pre>"},{"location":"operations/scavenger-logging/#requirements-satisfied","title":"Requirements Satisfied","text":"<p>\u2705 11.1: Append signal data to trades.jsonl file as single JSON object per line \u2705 11.2: Log signal with timestamp, symbol, strategy type, confidence, leverage, entry price, stop price, target price \u2705 11.3: Log execution with fill price, fill timestamp, and order type \u2705 11.4: Log close with exit price, exit timestamp, profit percentage, and close reason \u2705 11.5: Rotate log file when size exceeds 10 MB with timestamp suffix \u2705 11.6: Compress log files older than 30 days to gzip format \u2705 11.7: Support jq command-line tool for JSON filtering  </p>"},{"location":"operations/scavenger-logging/#testing","title":"Testing","text":"<p>Run the test suite:</p> <pre><code>npm test -- Logger.test.ts\n</code></pre> <p>All 16 tests pass, covering: - Initialization - Signal logging - Execution logging - Close logging - Error logging - Log rotation - Log compression - Query functionality</p>"},{"location":"operations/digitalocean/00_create_droplet/","title":"DigitalOcean Droplet Creation Guide","text":"<p>Date: 2026-02-06 Target: Titan Production Droplet</p>"},{"location":"operations/digitalocean/00_create_droplet/#prerequisites","title":"Prerequisites","text":"<ol> <li>DigitalOcean account with billing enabled</li> <li>SSH public key uploaded to DigitalOcean</li> <li>DNS access for <code>titan.peycheff.com</code></li> </ol>"},{"location":"operations/digitalocean/00_create_droplet/#droplet-specification","title":"Droplet Specification","text":"Property Value Region AMS3 (Amsterdam) Image Ubuntu 24.04 LTS Size s-4vcpu-8gb vCPUs 4 RAM 8 GB SSD 160 GB Monthly Cost ~$48/month Hostname titan-prod Tags <code>titan</code>, <code>production</code>"},{"location":"operations/digitalocean/00_create_droplet/#option-a-create-via-web-console","title":"Option A: Create via Web Console","text":"<ol> <li>Log in to cloud.digitalocean.com</li> <li>Click Create \u2192 Droplets</li> <li>Select:</li> <li>Region: Amsterdam (AMS3)</li> <li>Image: Ubuntu 24.04 LTS</li> <li>Size: Basic \u2192 Regular \u2192 $48/mo (4 vCPU, 8 GB RAM)</li> <li>Authentication: SSH Key (select pre-uploaded key)</li> <li>Hostname: <code>titan-prod</code></li> <li>Tags: <code>titan</code>, <code>production</code></li> <li>Monitoring: Enabled \u2713</li> <li>Click Create Droplet</li> <li>Record the IP address</li> </ol>"},{"location":"operations/digitalocean/00_create_droplet/#option-b-create-via-doctl-cli","title":"Option B: Create via doctl CLI","text":"<pre><code># Prerequisites\nbrew install doctl  # macOS\ndoctl auth init     # Configure API token\n\n# Create Droplet\ndoctl compute droplet create titan-prod \\\n  --region ams3 \\\n  --image ubuntu-24-04-x64 \\\n  --size s-4vcpu-8gb \\\n  --ssh-keys \"$(doctl compute ssh-key list --format ID --no-header | head -1)\" \\\n  --enable-monitoring \\\n  --tag-names \"titan,production\" \\\n  --wait\n\n# Get IP address\ndoctl compute droplet list --format Name,PublicIPv4\n</code></pre>"},{"location":"operations/digitalocean/00_create_droplet/#cloud-firewall-configuration","title":"Cloud Firewall Configuration","text":""},{"location":"operations/digitalocean/00_create_droplet/#create-firewall-via-console","title":"Create Firewall via Console","text":"<ol> <li>Go to Networking \u2192 Firewalls</li> <li>Click Create Firewall</li> <li>Name: <code>titan-production</code></li> <li>Inbound Rules:</li> </ol> Type Protocol Port Sources SSH TCP 22 Your IP only (e.g., 1.2.3.4/32) HTTP TCP 80 All IPv4, All IPv6 HTTPS TCP 443 All IPv4, All IPv6 <ol> <li>Outbound Rules: All outbound (default)</li> <li>Apply to: Droplets with tag <code>titan</code></li> <li>Click Create Firewall</li> </ol>"},{"location":"operations/digitalocean/00_create_droplet/#create-firewall-via-doctl","title":"Create Firewall via doctl","text":"<pre><code># Replace YOUR_IP with your operator IP\ndoctl compute firewall create \\\n  --name titan-production \\\n  --inbound-rules \"protocol:tcp,ports:22,address:YOUR_IP/32 protocol:tcp,ports:80,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:443,address:0.0.0.0/0,address:::/0\" \\\n  --outbound-rules \"protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0\" \\\n  --tag-names titan\n</code></pre>"},{"location":"operations/digitalocean/00_create_droplet/#dns-configuration","title":"DNS Configuration","text":"<p>After Droplet creation, update DNS:</p> <ol> <li>Log in to your DNS provider (Cloudflare, Route53, etc.)</li> <li>Create/Update A record:</li> <li>Name: <code>titan</code></li> <li>Type: A</li> <li>Value: <code>&lt;DROPLET_IP&gt;</code></li> <li>TTL: 300 (5 minutes)</li> <li>Verify propagation:    <pre><code>dig +short titan.peycheff.com\n# Should return DROPLET_IP\n</code></pre></li> </ol>"},{"location":"operations/digitalocean/00_create_droplet/#post-creation-checklist","title":"Post-Creation Checklist","text":"<ul> <li>[ ] Droplet created and IP recorded</li> <li>[ ] Cloud Firewall applied (only 22/80/443 open)</li> <li>[ ] DNS A record created for <code>titan.peycheff.com</code></li> <li>[ ] DNS propagated (dig returns correct IP)</li> <li>[ ] SSH access verified: <code>ssh root@&lt;IP&gt;</code></li> </ul>"},{"location":"operations/digitalocean/00_create_droplet/#next-step","title":"Next Step","text":"<p>Run the bootstrap script: <pre><code>ssh root@&lt;DROPLET_IP&gt; 'bash -s' &lt; scripts/ops/do/01_bootstrap_host.sh\n</code></pre></p>"},{"location":"operations/reliability/event-bus-backlog/","title":"Runbook: Event Bus Backlog (Slow Consumers)","text":"<p>\u2190 Back to Operations</p> <p>Severity: High (Performance Degradation) Symptoms:</p> <ul> <li>Execution latency spikes (&gt; 500ms).</li> <li>Log warnings: <code>Slow Consumer Detected</code>.</li> <li>Memory usage increasing on <code>titan-nats</code>.</li> </ul>"},{"location":"operations/reliability/event-bus-backlog/#1-diagnosis","title":"1. Diagnosis","text":"<p>Identify the lagging consumer:</p> <pre><code># List streams and consumers\ndocker exec titan-nats nats stream list\ndocker exec titan-nats nats consumer list TITAN_EXECUTION\n</code></pre> <p>Look for <code>NumPending &gt; 1000</code>.</p>"},{"location":"operations/reliability/event-bus-backlog/#2-mitigation-strategies","title":"2. Mitigation Strategies","text":""},{"location":"operations/reliability/event-bus-backlog/#scenario-a-database-write-bottleneck-execution","title":"Scenario A: Database Write Bottleneck (Execution)","text":"<p>If <code>titan-execution</code> is lagging because PersistToRedb is slow:</p> <ol> <li>Shed Load: Stop new orders via Brain.</li> </ol> <pre><code>curl -X POST http://localhost:3100/admin/system/mode/cautious\n</code></pre> <ol> <li>Increase Resources: (Requires restart)    Bump <code>titan-execution</code> CPU limit in <code>docker-compose.prod.yml</code>.</li> </ol>"},{"location":"operations/reliability/event-bus-backlog/#scenario-b-zombie-consumer","title":"Scenario B: Zombie Consumer","text":"<p>If a consumer ID exists but service is dead/restarted (Ephemeral consumer leak):</p> <ol> <li>Prune Consumers:</li> </ol> <pre><code>docker exec titan-nats nats consumer report TITAN_EXECUTION\n# Identify ID with High Pending and No Activity\ndocker exec titan-nats nats consumer rm TITAN_EXECUTION &lt;CONSUMER_NAME&gt;\n</code></pre>"},{"location":"operations/reliability/event-bus-backlog/#3-emergency-flush-data-loss-risk","title":"3. Emergency Flush (Data Loss Risk)","text":"<p>If system is halted due to full stream (1GB limit hit):</p> <p>[!WARNING] This will delete historical trade events. Accounting may drift.</p> <pre><code>docker exec titan-nats nats stream purge TITAN_EXECUTION\n</code></pre> <p>Post-action: Must run full accounting reconciliation.</p>"},{"location":"operations/reliability/truth-collapse/","title":"Runbook: Truth Confidence Collapse","text":"<p>\u2190 Back to Operations</p> <p>Severity: Critical (Emergency) Symptoms:</p> <ul> <li>System enters <code>DEFENSIVE</code> or <code>HALTED</code> mode.</li> <li>Log error: <code>Truth Confidence &lt; 0.5</code>.</li> <li>Grafana Alert: <code>TruthLayerConfidenceLow</code>.</li> </ul>"},{"location":"operations/reliability/truth-collapse/#1-immediate-action","title":"1. Immediate Action","text":"<ol> <li>ACK the Alert: Signal to team that investigation is underway.</li> <li> <p>Verify Status:</p> <pre><code>curl -s http://localhost:3100/status | jq .mode\n# Expected: \"DEFENSIVE\" or \"EMERGENCY\"\n</code></pre> </li> </ol>"},{"location":"operations/reliability/truth-collapse/#2-diagnosis","title":"2. Diagnosis","text":"<p>Check <code>titan-brain</code> logs for the specific confidence detractor:</p> <pre><code>docker logs titan-brain --tail 100 | grep \"Confidence\"\n</code></pre>"},{"location":"operations/reliability/truth-collapse/#scenario-a-staleness-data-too-old","title":"Scenario A: Staleness (Data too old)","text":"<p>Cause: <code>titan-ai-quant</code> or <code>titan-scavenger</code> not publishing budget updates. Fix:</p> <ol> <li>Restart upstream services:</li> </ol> <pre><code>docker restart titan-ai-quant\n</code></pre> <ol> <li>Verify NATS flow:</li> </ol> <pre><code>nats sub -s nats:4222 \"titan.ai.budget.&gt;\"\n</code></pre>"},{"location":"operations/reliability/truth-collapse/#scenario-b-deviation-equity-mismatch","title":"Scenario B: Deviation (Equity Mismatch)","text":"<p>Cause: Calculated Equity != Exchange Equity &gt; 5% threshold. Fix:</p> <ol> <li>Check Exchange Balances (Binance/Bybit).</li> <li>Check internal accounting in <code>titan-brain</code> DB.</li> <li>If Exchange is correct, force-sync accounting:</li> </ol> <pre><code># DANGEROUS: Only run if you trust Exchange over Internal\ncurl -X POST http://localhost:3100/admin/accounting/sync -H \"Authorization: Bearer &lt;ADMIN_TOKEN&gt;\"\n</code></pre>"},{"location":"operations/reliability/truth-collapse/#3-resolution","title":"3. Resolution","text":"<p>Once confidence restored (&gt; 0.8):</p> <ol> <li>System should auto-recover to <code>NORMAL</code> or <code>CAUTIOUS</code>.</li> <li>If stuck in Defensive:</li> </ol> <pre><code>curl -X POST http://localhost:3100/admin/system/reset-circuit-breaker\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/","title":"Titan Trading System - Incident Response Procedures","text":"<p>\u2190 Back to Operations</p> <p>This document outlines the incident response procedures for the Titan Trading System, including escalation paths, communication protocols, and recovery procedures for various types of incidents.</p>"},{"location":"operations/troubleshooting/incident-response/#incident-classification","title":"Incident Classification","text":""},{"location":"operations/troubleshooting/incident-response/#severity-levels","title":"Severity Levels","text":""},{"location":"operations/troubleshooting/incident-response/#severity-1-critical-response-time-immediate","title":"Severity 1 - Critical (Response Time: Immediate)","text":"<p>Impact: Complete system outage or trading halted Examples:</p> <ul> <li>All services down</li> <li>Circuit breaker activated due to system failure</li> <li>Database corruption or complete data loss</li> <li>Security breach with unauthorized access</li> <li>Exchange API keys compromised</li> </ul> <p>Response Team: On-call engineer + Operations manager + Development lead Communication: Immediate notification to all stakeholders</p>"},{"location":"operations/troubleshooting/incident-response/#severity-2-high-response-time-15-minutes","title":"Severity 2 - High (Response Time: 15 minutes)","text":"<p>Impact: Significant service degradation or partial outage Examples:</p> <ul> <li>Single critical service down (Brain or Execution)</li> <li>WebSocket disconnections affecting real-time updates</li> <li>Position tracking discrepancies</li> <li>High latency (&gt;500ms) in signal processing</li> <li>Memory leaks causing service instability</li> </ul> <p>Response Team: On-call engineer + Operations manager Communication: Notification within 15 minutes</p>"},{"location":"operations/troubleshooting/incident-response/#severity-3-medium-response-time-1-hour","title":"Severity 3 - Medium (Response Time: 1 hour)","text":"<p>Impact: Minor service degradation or non-critical issues Examples:</p> <ul> <li>Console dashboard unavailable</li> <li>AI Quant service failures</li> <li>Non-critical configuration issues</li> <li>Performance degradation (200-500ms latency)</li> <li>Monitoring system alerts</li> </ul> <p>Response Team: On-call engineer Communication: Notification within 1 hour</p>"},{"location":"operations/troubleshooting/incident-response/#severity-4-low-response-time-next-business-day","title":"Severity 4 - Low (Response Time: Next business day)","text":"<p>Impact: Minimal impact or informational Examples:</p> <ul> <li>Documentation updates needed</li> <li>Enhancement requests</li> <li>Non-urgent configuration changes</li> <li>Capacity planning alerts</li> </ul> <p>Response Team: Operations team during business hours Communication: Standard ticketing system</p>"},{"location":"operations/troubleshooting/incident-response/#incident-response-team","title":"Incident Response Team","text":""},{"location":"operations/troubleshooting/incident-response/#roles-and-responsibilities","title":"Roles and Responsibilities","text":""},{"location":"operations/troubleshooting/incident-response/#incident-commander-ic","title":"Incident Commander (IC)","text":"<p>Primary: Operations Manager Backup: Senior On-call Engineer</p> <p>Responsibilities:</p> <ul> <li>Overall incident coordination and decision making</li> <li>Communication with stakeholders and management</li> <li>Resource allocation and escalation decisions</li> <li>Post-incident review coordination</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#technical-lead","title":"Technical Lead","text":"<p>Primary: Development Team Lead Backup: Senior Developer</p> <p>Responsibilities:</p> <ul> <li>Technical analysis and troubleshooting</li> <li>Code-level debugging and fixes</li> <li>Architecture decisions during incident</li> <li>Technical communication to IC</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#operations-lead","title":"Operations Lead","text":"<p>Primary: Senior System Administrator Backup: On-call Engineer</p> <p>Responsibilities:</p> <ul> <li>System-level troubleshooting and recovery</li> <li>Infrastructure changes and scaling</li> <li>Service restart and configuration changes</li> <li>Monitoring and alerting management</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#communications-lead","title":"Communications Lead","text":"<p>Primary: Operations Manager Backup: Business Stakeholder</p> <p>Responsibilities:</p> <ul> <li>External stakeholder communication</li> <li>Status page updates</li> <li>Customer/user notifications</li> <li>Media and regulatory communication (if required)</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#contact-information","title":"Contact Information","text":"<pre><code>Incident Commander:\n- Primary: +1-555-0101 (Operations Manager)\n- Backup: +1-555-0102 (Senior Engineer)\n\nTechnical Lead:\n- Primary: +1-555-0201 (Dev Team Lead)\n- Backup: +1-555-0202 (Senior Developer)\n\nOperations Lead:\n- Primary: +1-555-0301 (SysAdmin)\n- Backup: +1-555-0302 (On-call Engineer)\n\nEscalation:\n- CTO: +1-555-0401\n- CEO: +1-555-0501 (Severity 1 only)\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#incident-response-process","title":"Incident Response Process","text":""},{"location":"operations/troubleshooting/incident-response/#phase-1-detection-and-initial-response-0-5-minutes","title":"Phase 1: Detection and Initial Response (0-5 minutes)","text":""},{"location":"operations/troubleshooting/incident-response/#automatic-detection","title":"Automatic Detection","text":"<ul> <li>Monitoring alerts (Prometheus/Grafana)</li> <li>Health check failures</li> <li>Circuit breaker activations</li> <li>Exception tracking (error rates)</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#manual-detection","title":"Manual Detection","text":"<ul> <li>User reports</li> <li>Operator observations</li> <li>Routine health checks</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#initial-response-checklist","title":"Initial Response Checklist","text":"<pre><code>\u25a1 Acknowledge the incident\n\u25a1 Assess initial severity level\n\u25a1 Check system status dashboard\n\u25a1 Verify if circuit breaker is active\n\u25a1 Check if Master Arm is enabled\n\u25a1 Review recent changes or deployments\n\u25a1 Notify incident response team\n\u25a1 Create incident ticket/channel\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#phase-2-assessment-and-triage-5-15-minutes","title":"Phase 2: Assessment and Triage (5-15 minutes)","text":""},{"location":"operations/troubleshooting/incident-response/#severity-assessment","title":"Severity Assessment","text":"<pre><code># Quick system health check\n./scripts/health-check.sh\n\n# Check service status\npm2 status\n\n# Check recent logs for errors\npm2 logs --lines 100 | grep -i error\n\n# Check system resources\nhtop\ndf -h\nfree -m\n\n# Check network connectivity\nping api.bybit.com\nping api.mexc.com\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#impact-assessment","title":"Impact Assessment","text":"<ul> <li>Number of affected users/services</li> <li>Financial impact (trading halted, positions at risk)</li> <li>Data integrity concerns</li> <li>Security implications</li> <li>Regulatory compliance impact</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#triage-decision-matrix","title":"Triage Decision Matrix","text":"System Status Trading Impact Severity Response All services down Trading halted 1 Immediate all-hands Brain down No new signals 1 Immediate response Execution down No order execution 1 Immediate response Console down No monitoring 2 High priority Scavenger down Phase 1 disabled 2-3 Based on equity level AI Quant down No optimization 3-4 Standard response"},{"location":"operations/troubleshooting/incident-response/#phase-3-containment-and-stabilization-15-60-minutes","title":"Phase 3: Containment and Stabilization (15-60 minutes)","text":""},{"location":"operations/troubleshooting/incident-response/#immediate-containment-actions","title":"Immediate Containment Actions","text":"<p>For Trading System Issues:</p> <pre><code># Emergency flatten all positions (if necessary)\ncurl -X POST https://titan.yourdomain.com/api/execution/flatten-all \\\n  -H \"Content-Type: application/json\" \\\n  -u admin:password \\\n  -d '{\"operator_id\": \"incident_response\"}'\n\n# Disable Master Arm (halt new trading)\ncurl -X POST https://titan.yourdomain.com/api/execution/master-arm \\\n  -H \"Content-Type: application/json\" \\\n  -u admin:password \\\n  -d '{\"enabled\": false, \"operator_id\": \"incident_response\"}'\n\n# Cancel all pending orders\ncurl -X POST https://titan.yourdomain.com/api/execution/cancel-all \\\n  -H \"Content-Type: application/json\" \\\n  -u admin:password \\\n  -d '{\"operator_id\": \"incident_response\"}'\n</code></pre> <p>For Service Failures:</p> <pre><code># Restart failed services\npm2 restart titan-brain\npm2 restart titan-execution\n\n# Check service dependencies\nsystemctl status postgresql\nsystemctl status redis-server\nsystemctl status nginx\n\n# Restart dependencies if needed\nsudo systemctl restart postgresql\nsudo systemctl restart redis-server\n</code></pre> <p>For Database Issues:</p> <pre><code># Check database connectivity\npsql -h localhost -U titan_user -d titan_brain -c \"SELECT 1;\"\n\n# Check database locks\npsql -h localhost -U titan_user -d titan_brain -c \"\n  SELECT pid, usename, application_name, state, query \n  FROM pg_stat_activity \n  WHERE state != 'idle';\"\n\n# Check disk space\ndf -h /var/lib/postgresql/\n\n# If corruption suspected, stop writes and assess\nsudo systemctl stop titan-brain\nsudo systemctl stop titan-execution\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#stabilization-checklist","title":"Stabilization Checklist","text":"<pre><code>\u25a1 Immediate risk mitigation completed\n\u25a1 System state documented and preserved\n\u25a1 Logs collected and preserved\n\u25a1 Monitoring systems functional\n\u25a1 Communication channels established\n\u25a1 Stakeholders notified of status\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#phase-4-investigation-and-diagnosis-parallel-to-containment","title":"Phase 4: Investigation and Diagnosis (Parallel to containment)","text":""},{"location":"operations/troubleshooting/incident-response/#data-collection","title":"Data Collection","text":"<pre><code># Collect system information\n./scripts/collect-diagnostic-info.sh\n\n# Collect service logs\nmkdir -p /tmp/incident-logs\npm2 logs --lines 1000 &gt; /tmp/incident-logs/pm2-logs.txt\njournalctl -u postgresql --since \"1 hour ago\" &gt; /tmp/incident-logs/postgresql.log\njournalctl -u redis --since \"1 hour ago\" &gt; /tmp/incident-logs/redis.log\njournalctl -u nginx --since \"1 hour ago\" &gt; /tmp/incident-logs/nginx.log\n\n# Collect system metrics\nsar -A &gt; /tmp/incident-logs/system-metrics.txt\niostat -x 1 10 &gt; /tmp/incident-logs/io-stats.txt\nnetstat -tuln &gt; /tmp/incident-logs/network-stats.txt\n\n# Database diagnostics\npg_dump --schema-only titan_brain &gt; /tmp/incident-logs/db-schema.sql\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#root-cause-analysis-framework","title":"Root Cause Analysis Framework","text":"<p>5 Whys Analysis:</p> <ol> <li>What happened? (Symptom)</li> <li>Why did it happen? (Immediate cause)</li> <li>Why did that happen? (Underlying cause)</li> <li>Why did that happen? (Root cause)</li> <li>Why did that happen? (Systemic cause)</li> </ol> <p>Timeline Reconstruction:</p> <ul> <li>When did the incident start?</li> <li>What was the sequence of events?</li> <li>What changes occurred before the incident?</li> <li>What alerts fired and when?</li> </ul> <p>Change Analysis:</p> <ul> <li>Recent deployments or configuration changes</li> <li>Infrastructure changes</li> <li>Third-party service changes</li> <li>Market condition changes</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#phase-5-resolution-and-recovery-variable-duration","title":"Phase 5: Resolution and Recovery (Variable duration)","text":""},{"location":"operations/troubleshooting/incident-response/#resolution-strategies-by-incident-type","title":"Resolution Strategies by Incident Type","text":"<p>Service Restart Issues:</p> <pre><code># Clean restart procedure\npm2 stop all\npm2 delete all\npm2 start ecosystem.config.js\n\n# If persistent issues, check for:\n# - Port conflicts\n# - File permission issues\n# - Environment variable problems\n# - Dependency version conflicts\n</code></pre> <p>Database Issues:</p> <pre><code># For connection issues\nsudo systemctl restart postgresql\n# Wait for startup\nsleep 10\n# Test connection\npsql -h localhost -U titan_user -d titan_brain -c \"SELECT 1;\"\n\n# For corruption (if detected)\nsudo -u postgres pg_dump titan_brain &gt; /tmp/backup-before-repair.sql\nsudo -u postgres reindexdb titan_brain\n# Test integrity\nsudo -u postgres vacuumdb --analyze titan_brain\n</code></pre> <p>Network/Connectivity Issues:</p> <pre><code># Check DNS resolution\nnslookup api.bybit.com\nnslookup api.mexc.com\n\n# Check routing\ntraceroute api.bybit.com\n\n# Check firewall\nsudo ufw status\nsudo iptables -L\n\n# Test API connectivity\ncurl -I https://api.bybit.com/v5/market/time\n</code></pre> <p>Performance Issues:</p> <pre><code># Check resource usage\ntop -p $(pgrep -d',' -f titan)\n\n# Check for memory leaks\nps aux --sort=-%mem | head -20\n\n# Check disk I/O\niotop -o\n\n# Restart services if memory leak detected\npm2 restart all\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#recovery-verification","title":"Recovery Verification","text":"<pre><code># Run comprehensive health check\n./scripts/health-check.sh\n\n# Test critical functionality\n./scripts/test-signal-flow.sh --quick\n\n# Verify position accuracy\n./scripts/verify-positions.sh\n\n# Check performance metrics\n./scripts/performance-check.sh\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#phase-6-communication-and-updates","title":"Phase 6: Communication and Updates","text":""},{"location":"operations/troubleshooting/incident-response/#internal-communication-template","title":"Internal Communication Template","text":"<pre><code>INCIDENT UPDATE - [SEVERITY] - [TIMESTAMP]\n\nStatus: [INVESTIGATING/IDENTIFIED/MONITORING/RESOLVED]\nImpact: [Description of current impact]\nServices Affected: [List of affected services]\nEstimated Resolution: [Time estimate or \"Unknown\"]\n\nCurrent Actions:\n- [Action 1]\n- [Action 2]\n\nNext Update: [Time for next update]\n\nIncident Commander: [Name]\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#external-communication-template","title":"External Communication Template","text":"<pre><code>SYSTEM STATUS UPDATE\n\nWe are currently experiencing [brief description of issue].\n\nImpact: [User-facing impact description]\nStatus: [Current status]\nEstimated Resolution: [Time estimate]\n\nWe will provide updates every [frequency] until resolved.\n\nFor real-time updates: [status page URL]\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#communication-channels","title":"Communication Channels","text":"<ul> <li>Internal: Slack #incidents channel</li> <li>External: Status page, email notifications</li> <li>Regulatory: As required by jurisdiction</li> <li>Media: Through designated spokesperson only</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#phase-7-post-incident-activities","title":"Phase 7: Post-Incident Activities","text":""},{"location":"operations/troubleshooting/incident-response/#immediate-post-resolution-within-1-hour","title":"Immediate Post-Resolution (Within 1 hour)","text":"<pre><code>\u25a1 Confirm full service restoration\n\u25a1 Re-enable Master Arm (if appropriate)\n\u25a1 Verify all positions and balances\n\u25a1 Update stakeholders on resolution\n\u25a1 Schedule post-incident review\n\u25a1 Preserve all incident data\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#post-incident-review-within-24-hours","title":"Post-Incident Review (Within 24 hours)","text":"<p>Review Agenda:</p> <ol> <li>Incident timeline and impact assessment</li> <li>Response effectiveness evaluation</li> <li>Root cause analysis findings</li> <li>Action items and improvements</li> <li>Process and procedure updates</li> </ol> <p>Deliverables:</p> <ul> <li>Incident report with timeline</li> <li>Root cause analysis document</li> <li>Action item list with owners and deadlines</li> <li>Process improvement recommendations</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#specific-incident-scenarios","title":"Specific Incident Scenarios","text":""},{"location":"operations/troubleshooting/incident-response/#scenario-1-circuit-breaker-activation","title":"Scenario 1: Circuit Breaker Activation","text":"<p>Immediate Actions:</p> <ol> <li>Verify circuit breaker reason and validity</li> <li>Check if positions need immediate attention</li> <li>Assess market conditions</li> <li>Determine if manual intervention needed</li> </ol> <p>Investigation:</p> <pre><code># Check circuit breaker status\ncurl https://titan.yourdomain.com/api/brain/breaker\n\n# Review recent trading activity\ncurl https://titan.yourdomain.com/api/execution/trades?limit=50\n\n# Check performance metrics\ncurl https://titan.yourdomain.com/api/brain/dashboard\n</code></pre> <p>Resolution:</p> <ul> <li>If valid trigger: Wait for cooldown period</li> <li>If false positive: Manual reset with justification</li> <li>Document decision rationale</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#scenario-2-position-tracking-mismatch","title":"Scenario 2: Position Tracking Mismatch","text":"<p>Immediate Actions:</p> <ol> <li>Halt new trading immediately</li> <li>Compare Shadow State vs exchange positions</li> <li>Identify discrepancy source</li> <li>Determine if manual reconciliation needed</li> </ol> <p>Investigation:</p> <pre><code># Get Shadow State positions\ncurl https://titan.yourdomain.com/api/execution/positions\n\n# Force reconciliation\ncurl -X POST https://titan.yourdomain.com/api/execution/reconcile \\\n  -u admin:password\n\n# Check reconciliation results\ncurl https://titan.yourdomain.com/api/execution/reconciliation-status\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#scenario-3-exchange-api-issues","title":"Scenario 3: Exchange API Issues","text":"<p>Immediate Actions:</p> <ol> <li>Check if issue is exchange-wide or account-specific</li> <li>Switch to backup exchange if available</li> <li>Monitor position status via web interface</li> <li>Prepare for manual intervention if needed</li> </ol> <p>Investigation:</p> <pre><code># Test API connectivity\n./scripts/test-exchange-apis.sh\n\n# Check API rate limits\ncurl -H \"X-BAPI-API-KEY: $BYBIT_API_KEY\" \\\n     \"https://api.bybit.com/v5/account/rate-limit\"\n\n# Check account status\ncurl -H \"X-BAPI-API-KEY: $BYBIT_API_KEY\" \\\n     \"https://api.bybit.com/v5/account/info\"\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#recovery-procedures","title":"Recovery Procedures","text":""},{"location":"operations/troubleshooting/incident-response/#service-recovery-order","title":"Service Recovery Order","text":"<ol> <li>Database Services (PostgreSQL, Redis)</li> <li>Core Services (Brain, Execution)</li> <li>Interface Services (Console)</li> <li>Trading Services (Scavenger, AI Quant)</li> <li>Monitoring Services (Prometheus, Grafana)</li> </ol>"},{"location":"operations/troubleshooting/incident-response/#data-recovery-procedures","title":"Data Recovery Procedures","text":"<p>Database Recovery:</p> <pre><code># Stop all services\npm2 stop all\n\n# Restore from backup (if needed)\nsudo -u postgres psql -d titan_brain &lt; /backup/latest-backup.sql\n\n# Verify data integrity\nsudo -u postgres psql -d titan_brain -c \"\n  SELECT COUNT(*) FROM allocations;\n  SELECT COUNT(*) FROM decisions;\n  SELECT MAX(timestamp) FROM performance;\"\n\n# Restart services\npm2 start ecosystem.config.js\n</code></pre> <p>Configuration Recovery:</p> <pre><code># Restore configuration from backup\ncp /backup/config/.env .env\ncp /backup/config/ecosystem.config.js ecosystem.config.js\n\n# Validate configuration\n./scripts/validate-config.sh\n\n# Restart with new configuration\npm2 reload ecosystem.config.js\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#escalation-procedures","title":"Escalation Procedures","text":""},{"location":"operations/troubleshooting/incident-response/#when-to-escalate","title":"When to Escalate","text":"<p>To Management:</p> <ul> <li>Severity 1 incidents</li> <li>Incidents lasting &gt;2 hours</li> <li>Financial impact &gt;$10,000</li> <li>Security breaches</li> <li>Regulatory implications</li> </ul> <p>To Development Team:</p> <ul> <li>Code-level issues requiring fixes</li> <li>Architecture changes needed</li> <li>Database schema issues</li> <li>Performance optimization needs</li> </ul> <p>To External Vendors:</p> <ul> <li>Exchange API issues</li> <li>Infrastructure provider issues</li> <li>Third-party service failures</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#escalation-contacts","title":"Escalation Contacts","text":"<pre><code>Level 1: On-call Engineer\n- Response: Immediate\n- Authority: Service restart, configuration changes\n\nLevel 2: Operations Manager\n- Response: 15 minutes\n- Authority: Emergency procedures, resource allocation\n\nLevel 3: Technical Director\n- Response: 30 minutes\n- Authority: Architecture changes, vendor escalation\n\nLevel 4: CTO\n- Response: 1 hour\n- Authority: Business decisions, external communication\n\nLevel 5: CEO\n- Response: 2 hours (Severity 1 only)\n- Authority: All decisions\n</code></pre>"},{"location":"operations/troubleshooting/incident-response/#documentation-and-reporting","title":"Documentation and Reporting","text":""},{"location":"operations/troubleshooting/incident-response/#incident-documentation-requirements","title":"Incident Documentation Requirements","text":"<p>During Incident:</p> <ul> <li>Real-time status updates</li> <li>Action log with timestamps</li> <li>Decision rationale documentation</li> <li>Communication log</li> </ul> <p>Post-Incident:</p> <ul> <li>Complete incident report</li> <li>Root cause analysis</li> <li>Financial impact assessment</li> <li>Lessons learned document</li> <li>Process improvement plan</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#regulatory-reporting","title":"Regulatory Reporting","text":"<p>When Required:</p> <ul> <li>Trading system outages &gt;30 minutes</li> <li>Position tracking errors</li> <li>Security incidents</li> <li>Data breaches</li> </ul> <p>Reporting Timeline:</p> <ul> <li>Initial notification: Within 4 hours</li> <li>Detailed report: Within 24 hours</li> <li>Final report: Within 5 business days</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#continuous-improvement","title":"Continuous Improvement","text":""},{"location":"operations/troubleshooting/incident-response/#incident-metrics","title":"Incident Metrics","text":"<p>Response Metrics:</p> <ul> <li>Mean Time to Detection (MTTD)</li> <li>Mean Time to Response (MTTR)</li> <li>Mean Time to Resolution (MTTR)</li> <li>Escalation frequency</li> </ul> <p>Quality Metrics:</p> <ul> <li>Incident recurrence rate</li> <li>False positive rate</li> <li>Customer impact duration</li> <li>Process compliance rate</li> </ul>"},{"location":"operations/troubleshooting/incident-response/#process-improvement","title":"Process Improvement","text":"<p>Monthly Reviews:</p> <ul> <li>Incident trend analysis</li> <li>Process effectiveness review</li> <li>Training needs assessment</li> <li>Tool and automation opportunities</li> </ul> <p>Quarterly Updates:</p> <ul> <li>Procedure documentation updates</li> <li>Contact information verification</li> <li>Escalation path optimization</li> <li>Training program updates</li> </ul> <p>This incident response procedure is reviewed quarterly and updated based on lessons learned from actual incidents and industry best practices.</p>"},{"location":"organism/brain_decision_loop/","title":"The Brain Decision Loop","text":"<p>Status: Canonical Model: Active Inference</p>"},{"location":"organism/brain_decision_loop/#1-the-loop","title":"1. The Loop","text":"<p>The Brain runs a continuous event-driven loop. It does not \"poll\"; it reacts.</p>"},{"location":"organism/brain_decision_loop/#phase-1-sensing-input","title":"Phase 1: Sensing (Input)","text":"<p>Brain subscribes to per-phase signal subjects (<code>titan.evt.scavenger.signal.v1</code>, <code>titan.evt.hunter.&gt;</code>, <code>titan.evt.sentinel.&gt;</code>).</p> <ul> <li>Input: <code>IntentEnvelope&lt;SignalPayload&gt;</code></li> <li>Validation:</li> <li>Is the <code>ts</code> fresh? (&lt; 5s signal staleness; note: HMAC drift tolerance is separate at 5 min per I-10)</li> <li>Is the <code>source</code> authorized?</li> <li>Is <code>risk_score</code> within bounds?</li> </ul>"},{"location":"organism/brain_decision_loop/#phase-2-perception-state-update","title":"Phase 2: Perception (State Update)","text":"<p>Brain updates its internal \"Belief State\" (<code>MarketRegime</code>).</p> <ul> <li>Volatility Check: High vol? Shrink allocations.</li> <li>Budget Check: Do we have free capital in the <code>allocation_history</code>?</li> </ul>"},{"location":"organism/brain_decision_loop/#phase-3-action-selection-policy","title":"Phase 3: Action Selection (Policy)","text":"<p>If the signal is Accepted:</p> <ol> <li>Position Sizing: Applies Kelly Criterion (modified by volatility).</li> <li>Constraints: Checks specific <code>risk_policy.json</code> limits (e.g., Max Open Orders).</li> <li>Signing:<ul> <li>Generates <code>titan.cmd.execution.place.v1</code> payload.</li> <li>Signs payload with <code>HMAC_SECRET</code>.</li> </ul> </li> </ol>"},{"location":"organism/brain_decision_loop/#phase-4-actuation-output","title":"Phase 4: Actuation (Output)","text":"<p>Brain publishes the command to NATS. It then spawns a \"Pending Expectation\":</p> <ul> <li>Expectation: \"I expect a Fill Event within 2 seconds.\"</li> <li>Timeout: If no fill arrives, log <code>TIMEOUT</code> and check system health.</li> </ul>"},{"location":"organism/brain_decision_loop/#2-allocation-logic","title":"2. Allocation Logic","text":"<p>Brain allocates capital based on specific \"Buckets\".</p> <ul> <li>Trap Bucket: For Scavenger. Small, fast turnover.</li> <li>Trend Bucket: For Hunter. Large, slow turnover.</li> <li>Arb Bucket: For Sentinel. High capacity.</li> </ul> <p>Invariant: <code>Sum(Allocations) &lt;= TotalEquity</code>. Brain never allows leverage to exceed global caps (10x).</p>"},{"location":"organism/execution_engine/","title":"Execution Engine (Rust)","text":"<p>Status: Canonical Stack: Rust, Actix, Redb, Tokio</p>"},{"location":"organism/execution_engine/#1-core-responsibilities","title":"1. Core Responsibilities","text":"<p>The Execution Engine (<code>titan-execution-rs</code>) is the somatic motor cortex. It moves the money.</p> <ol> <li>Connector: Manages WebSocket/REST connections to Exchanges.</li> <li>Guardian: Enforces Risk Policy at the point of trade.</li> <li>Ledger: Records local \"Truth\" (Shadow State).</li> </ol>"},{"location":"organism/execution_engine/#2-architecture","title":"2. Architecture","text":""},{"location":"organism/execution_engine/#21-actor-system","title":"2.1 Actor System","text":"<p>The engine uses the Actor Model (Tokio channels):</p> <ul> <li>NatsActor: Handles inbound/outbound event bus traffic.</li> <li>ExchangeActor: Handles specific exchange API mechanics.</li> <li>RiskActor: Synchronous gatekeeper. The bottleneck by design.</li> <li>StateActor: Manages Redb reads/writes.</li> </ul>"},{"location":"organism/execution_engine/#22-persistence-redb","title":"2.2 Persistence (Redb)","text":"<p>We use <code>redb</code> (Embedded, ACID, pure Rust) for local state.</p> <ul> <li>Speed: &lt; 100\u00b5s writes.</li> <li>Safety: MVCC (Multi-Version Concurrency Control).</li> <li>Path: <code>/data/execution.db</code>.</li> </ul>"},{"location":"organism/execution_engine/#3-the-execution-pipeline","title":"3. The Execution Pipeline","text":"<p>When a Command arrives:</p> <ol> <li>Decoder: Validate JSON and HMAC Signature.</li> <li>Risk Check:<ul> <li>Load <code>account_state</code> (Equity, Positions).</li> <li><code>RiskGuard::check(cmd, state)</code>.</li> <li>If Fail: Respond <code>RejectEvent</code> immediately.</li> </ul> </li> <li>Submission:<ul> <li>Serialize to Exchange format (e.g., CCXT-like payload).</li> <li>HTTP POST to Exchange.</li> </ul> </li> <li>Confirmation (<code>EventLoop</code>):<ul> <li>Wait for REST response (Order ID).</li> <li>Wait for WS ExecutionReport (Fill Price).</li> <li>Write to Redb.</li> <li>Ack to NATS.</li> </ul> </li> </ol>"},{"location":"organism/execution_engine/#4-shadow-state","title":"4. Shadow State","text":"<p>Execution maintains a local copy of all Open Orders and Positions. Why?</p> <ul> <li>Speed: Risk checks operate on local RAM, not API calls.</li> <li>Resilience: If Exchange goes dark, we know what we intend to have.</li> </ul> <p>Reconciliation: The Shadow State is periodically (1m) compared against the Exchange State. Discrepancies trigger a Truth Drift Alert.</p>"},{"location":"organism/phases/","title":"Organism Phases (Specialized Organs)","text":"<p>Status: Canonical Concept: Division of Labor</p> <p>The Titan Organism trades through distinct \"Phases\" or organs. Each Phase has a specific psychological profile, capital mandate, and kill condition.</p>"},{"location":"organism/phases/#1-phase-1-scavenger-the-trap","title":"1. Phase 1: Scavenger (The Trap)","text":"<p>Detailed in <code>services/titan-phase1-scavenger</code></p> <ul> <li>Profile: High frequency, low latency, mean reversion.</li> <li>Microstructure: Order Book Imbalance, Trap detection.</li> <li>Capital: Minimal ($200 - $5,000). High leverage (up to 10x).</li> <li>Goal: \"Scavenge\" small inefficiencies. High win-rate, small R/R.</li> <li>Kill Condition: consecutive_losses &gt; 5.</li> </ul>"},{"location":"organism/phases/#2-phase-2-hunter-the-eye","title":"2. Phase 2: Hunter (The Eye)","text":"<p>Detailed in <code>services/titan-phase2-hunter</code></p> <ul> <li>Profile: Trend following, Breakout, Holographic Support/Resistance.</li> <li>Microstructure: Volume Profile (VPVR), Fibonacci, Market Structure.</li> <li>Capital: Moderate ($5k - $50k). Medium leverage (3-5x).</li> <li>Goal: Catch the \"Meat\" of the move. Looser stops, higher R/R.</li> <li>Kill Condition: Volatility &lt; Threshold (Market is dead).</li> </ul>"},{"location":"organism/phases/#3-phase-3-sentinel-the-shield","title":"3. Phase 3: Sentinel (The Shield)","text":"<p>Detailed in <code>services/titan-phase3-sentinel</code></p> <ul> <li>Profile: Market Neutral, Basis Arbitrage (Spot vs Perp).</li> <li>Microstructure: Funding Rate disparity.</li> <li>Capital: High ($50k+). Low leverage (1x - 3x).</li> <li>Goal: Yield farming. Fund the other phases.</li> <li>Kill Condition: Funding Rate flips negative.</li> </ul>"},{"location":"organism/phases/#4-the-brain-the-cortex","title":"4. The Brain (The Cortex)","text":"<p>Detailed in <code>services/titan-brain</code></p> <ul> <li>Profile: Meta-Strategy.</li> <li>Role:</li> <li>Does not generate signals.</li> <li>Evaluates signals from Phases 1-3.</li> <li>Allocates capital dynamically based on Regime.</li> <li>Example: In \"High Volatility Bull\", Brain maximizes Phase 2 (Hunter) and minimizes Phase 3 (Sentinel).</li> </ul>"},{"location":"organism/phases/#5-phase-contracts-the-interface","title":"5. Phase Contracts (The Interface)","text":"<p>All phase services (Scavenger, Hunter, Sentinel) must implement:</p> <ol> <li>Signal Emission:<ul> <li>Subject: <code>titan.evt.&lt;phase_name&gt;.signal.v1</code> (e.g., <code>titan.evt.scavenger.signal.v1</code>)</li> <li>Payload: <code>IntentEnvelope&lt;SignalPayload&gt;</code></li> </ul> </li> <li>Telemetry:<ul> <li>Subject: <code>titan.evt.phase.diagnostics.v1</code></li> <li>Rate: 1Hz</li> </ul> </li> <li>Command Listener:<ul> <li>Subject: <code>titan.cmd.&lt;phase_name&gt;.v1.&gt;</code> (e.g., <code>titan.cmd.hunter.v1.&gt;</code>)</li> <li>Action: Update internal parameters (e.g., stop loss width) on the fly.</li> </ul> </li> </ol>"},{"location":"quality_os/","title":"Titan Autonomous Quality OS","text":"<p>The Titan Quality OS is the autonomous nervous system of the repository. It enforces quality, hygiene, and security through deterministic, evidence-based gates. It treats CI/CD minutes as a burn rate to be optimized and code not as a static asset, but as a living organism that must be actively maintained.</p>"},{"location":"quality_os/#core-philosophy","title":"\ud83e\udde0 Core Philosophy","text":"<ol> <li>Evidence-First: No change is valid without an EvidencePack proving its safety. \"Works on my machine\" is not evidence. A hashed, verifiable artifact from a clean environment is.</li> <li>Deterministic: Given the same input (commit SHA + plan), the Quality OS must produce the exact same output (QualityPack hash).</li> <li>Fail-Closed: If the Quality OS cannot verify safety (e.g., tool failure, ambiguous diff), it escalates to the highest risk level.</li> <li>One Canon: There is only one source of truth. If a doc exists here, it is the law. If it contradicts code, the code is wrong (or the doc is outdated and must be fixed atomically with the code).</li> </ol>"},{"location":"quality_os/#gates-enforcement-levels","title":"\ud83d\udee1\ufe0f Gates (Enforcement Levels)","text":"<p>Run checks based on Diff Risk, not habit.</p> Gate Trigger Scope Purpose Gate A <code>pull_request</code> Diff-Aware Fast, focused feedback. Runs only what is affected by the diff + critical invariants. Gate B <code>push</code> (main) Workspace Full assurance for merged code. Verifies integration across the monorepo. Gate C <code>schedule</code> (nightly) Exhaustive Deep hygiene, long-running chaos tests, full fuzzing, dead code proofs. Gate D <code>release</code> (tag) Release-Grade Provenance, SBOM, policy parity proofs, artifact hashing, signature verification."},{"location":"quality_os/#fix-policy-autonomy-levels","title":"\ud83d\udd27 Fix Policy (Autonomy Levels)","text":"<p>We classify fixes by their safety to determine if they can be auto-applied.</p> Level Policy Description Examples F0 Auto-Apply Proven safe. Machine-verifiable reversibility. No semantic change. Formatting (Prettier), unused imports (in isolated files), sorting JSON keys, fixing broken internal links to canonical targets. F1 PR-Required Safe but impactful. Requires human visibility via PR entry. Dependency updates, performance tuning, refactors altering control flow, schema additions. F2 Human Approval Critical risk. Requires explicit <code>CODEOWNERS</code> sign-off. Execution logic, Risk Policy, NATS ACLs, Encryption/Security rules, DB Migrations altering data."},{"location":"quality_os/#diff-risk-classifier","title":"\ud83d\udcca Diff Risk Classifier","text":"<p>The QualityKernel classifies every PR into a Risk Tier determining required checks.</p> Risk Tier Triggers Required Gates/Checks High <code>services/titan-execution-rs/**</code>, <code>packages/shared/**</code>, <code>config/nats.conf</code>, <code>.github/**</code>, <code>migrations/**</code> Full Gate B + Specialized Security/Contract Checks. Medium <code>services/**</code> (logic), <code>packages/**</code> (lib libraries) Gate A + Integration Tests for affected service. Low <code>docs/**</code>, <code>scripts/**</code> (non-core), <code>**/*.md</code> Gate A (Lint + Link Check only)."},{"location":"quality_os/#evidencepacks-the-receipts","title":"\ud83d\udce6 EvidencePacks (The Receipts)","text":"<p>All Quality OS outputs are JSON objects adhering to strict schemas in <code>packages/quality-os/src/schemas</code>.</p> <ul> <li><code>QualityPack</code>: Test results, coverage, lint status, typecheck results.</li> <li><code>HygienePack</code>: Dead code proofs, doc integrity graph, circular dependency checks.</li> <li><code>SupplyChainPack</code>: Dependency audit (cargo/npm), pinning verification, SBOM.</li> <li><code>CostPack</code>: Runtime minutes, cache hit rates, plan justification.</li> </ul> <p>Every pack is hashed (<code>sha256</code>) and stored in <code>artifacts/quality_os/packs/&lt;build_id&gt;/</code>.</p>"},{"location":"reference/","title":"Reference Documentation","text":"<p>\u2190 Back to Index</p>"},{"location":"reference/#api-protocols","title":"\ud83d\udce1 API &amp; Protocols","text":"<ul> <li>HTTP Endpoints \u2014 Catalog of REST endpoints.</li> <li>Brain API \u2014 Detailed Brain Service API inputs/outputs.</li> <li>NATS Subjects \u2014 Topic hierarchy definition.</li> <li>Scavenger Exchanges \u2014 Supported exchanges reference.</li> <li>Console WebSocket \u2014 Console protocol.</li> </ul>"},{"location":"reference/#data-schema","title":"\ud83d\udcbe Data &amp; Schema","text":"<ul> <li>Database Schema \u2014 Postgres tables and relationships.</li> <li>Schema Catalog \u2014 Data types and JSON schemas.</li> </ul>"},{"location":"reference/#system-source","title":"\ud83d\udcdc System Source","text":"<ul> <li>System Source of Truth \u2014 The Core Axioms.</li> </ul>"},{"location":"reference/#titan-api-overview-merged","title":"Titan API Overview (Merged)","text":"<p>Context: Central Hub for all Titan APIs Status: Canonical</p>"},{"location":"reference/#core-service-apis","title":"\ud83d\udce1 Core Service APIs","text":"Service Protocol Spec Status Titan Brain REST Brain API Canonical Titan Execution NATS / REST NATS Subjects Canonical Console API REST HTTP Endpoints Canonical"},{"location":"reference/#integration-points","title":"\ud83d\udd0c Integration Points","text":"<ul> <li>NATS Event Bus: The nervous system. See NATS Subjects.</li> <li>Webhooks: For external integrations. See <code>api-brain.md</code> for signature verification.</li> <li>WebSocket: Real-time feedback loop.</li> </ul>"},{"location":"reference/#security-headers","title":"\ud83d\udd10 Security Headers","text":"<p>All internal APIs require: - <code>x-titan-auth</code>: Service-to-service token. - <code>x-signature</code>: HMAC-SHA256 of payload (if mutation).</p>"},{"location":"reference/api-brain/","title":"Titan Brain API Documentation","text":"<p>Complete API reference for the Titan Brain orchestrator service.</p>"},{"location":"reference/api-brain/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Authentication</li> <li>Signal Format</li> <li>Webhook Endpoints</li> <li>Dashboard Data Format</li> <li>Error Handling</li> <li>Rate Limiting</li> <li>Manual Trading</li> <li>System Configuration</li> <li>Observability</li> <li>Examples</li> </ul>"},{"location":"reference/api-brain/#overview","title":"Overview","text":""},{"location":"reference/api-brain/#base-url","title":"Base URL","text":"<pre><code>http://localhost:3100\n</code></pre>"},{"location":"reference/api-brain/#content-type","title":"Content Type","text":"<p>All requests and responses use JSON:</p> <pre><code>Content-Type: application/json\n</code></pre>"},{"location":"reference/api-brain/#response-format","title":"Response Format","text":"<p>All responses follow a consistent format:</p> <p>Success Response: <pre><code>{\n  \"field1\": \"value1\",\n  \"field2\": \"value2\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p> <p>Error Response: <pre><code>{\n  \"error\": \"Error message description\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#authentication","title":"Authentication","text":""},{"location":"reference/api-brain/#hmac-signature-verification","title":"HMAC Signature Verification","text":"<p>When <code>WEBHOOK_SECRET</code> is configured, all POST requests must include an HMAC signature.</p> <p>Header: <code>x-signature</code></p> <p>Algorithm: SHA-256</p> <p>Signature Generation:</p> <pre><code>const crypto = require('crypto');\n\nfunction generateSignature(body, secret) {\n  return crypto\n    .createHmac('sha256', secret)\n    .update(JSON.stringify(body))\n    .digest('hex');\n}\n\n// Usage\nconst signature = generateSignature(requestBody, process.env.WEBHOOK_SECRET);\n</code></pre> <p>Example Request with Signature:</p> <pre><code>curl -X POST http://localhost:3100/signal \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-signature: a1b2c3d4e5f6...\" \\\n  -d '{\"signalId\":\"sig_123\",\"phaseId\":\"phase1\",\"symbol\":\"BTCUSDT\",\"side\":\"BUY\",\"requestedSize\":1000}'\n</code></pre>"},{"location":"reference/api-brain/#operator-authentication","title":"Operator Authentication","text":"<p>Admin endpoints require operator credentials in the request body:</p> <pre><code>{\n  \"operatorId\": \"admin\",\n  \"password\": \"secure_password\"\n}\n</code></pre>"},{"location":"reference/api-brain/#signal-format","title":"Signal Format","text":""},{"location":"reference/api-brain/#intent-signal-input","title":"Intent Signal (Input)","text":"<p>The standard signal format for requesting trade permission:</p> <pre><code>interface IntentSignal {\n  /** Unique identifier for idempotency */\n  signalId: string;\n\n  /** Phase originating the signal */\n  phaseId: 'phase1' | 'phase2' | 'phase3' | 'manual';\n\n  /** Trading pair symbol */\n  symbol: string;\n\n  /** Trade direction */\n  side: 'BUY' | 'SELL';\n\n  /** Requested position size in USD notional */\n  requestedSize: number;\n\n  /** Unix timestamp in milliseconds (optional) */\n  timestamp?: number;\n\n  /** Requested leverage (optional) */\n  leverage?: number;\n}\n</code></pre> <p>Example: <pre><code>{\n  \"signalId\": \"sig_phase1_btc_1702500000000\",\n  \"phaseId\": \"phase1\",\n  \"symbol\": \"BTCUSDT\",\n  \"side\": \"BUY\",\n  \"requestedSize\": 1000,\n  \"timestamp\": 1702500000000,\n  \"leverage\": 15\n}\n</code></pre></p>"},{"location":"reference/api-brain/#phase-signal-format-alternative","title":"Phase Signal Format (Alternative)","text":"<p>Phase-specific webhooks accept a slightly different format:</p> <pre><code>interface PhaseSignal {\n  /** Unique identifier */\n  signal_id: string;\n\n  /** Trading pair symbol */\n  symbol: string;\n\n  /** Trade direction */\n  direction: 'LONG' | 'SHORT';\n\n  /** Position size in USD (optional) */\n  size?: number;\n\n  /** Unix timestamp in milliseconds (optional) */\n  timestamp?: number;\n\n  /** Requested leverage (optional) */\n  leverage?: number;\n}\n</code></pre> <p>Example: <pre><code>{\n  \"signal_id\": \"trap_btc_liquidation_1702500000000\",\n  \"symbol\": \"BTCUSDT\",\n  \"direction\": \"LONG\",\n  \"size\": 500,\n  \"leverage\": 5\n}\n</code></pre></p>"},{"location":"reference/api-brain/#brain-decision-output","title":"Brain Decision (Output)","text":"<p>The response format for signal processing:</p> <pre><code>interface BrainDecision {\n  /** Original signal ID */\n  signalId: string;\n\n  /** Whether the signal was approved */\n  approved: boolean;\n\n  /** Authorized position size (may be less than requested) */\n  authorizedSize: number;\n\n  /** Human-readable explanation */\n  reason: string;\n\n  /** Current allocation vector */\n  allocation: AllocationVector;\n\n  /** Phase performance metrics */\n  performance: PhasePerformance;\n\n  /** Risk assessment details */\n  risk: RiskDecision;\n\n  /** Decision timestamp */\n  timestamp: number;\n\n  /** Processing time in milliseconds */\n  processingTime?: number;\n}\n</code></pre> <p>Approved Example: <pre><code>{\n  \"signalId\": \"sig_phase1_btc_1702500000000\",\n  \"approved\": true,\n  \"authorizedSize\": 800,\n  \"reason\": \"Approved with size reduction due to phase weight (80%)\",\n  \"allocation\": {\n    \"w1\": 0.8,\n    \"w2\": 0.2,\n    \"w3\": 0.0,\n    \"timestamp\": 1702500000000\n  },\n  \"performance\": {\n    \"phaseId\": \"phase1\",\n    \"sharpeRatio\": 1.5,\n    \"totalPnL\": 250.00,\n    \"tradeCount\": 15,\n    \"winRate\": 0.65,\n    \"avgWin\": 50.00,\n    \"avgLoss\": 25.00,\n    \"modifier\": 1.0\n  },\n  \"risk\": {\n    \"approved\": true,\n    \"reason\": \"Within risk limits\",\n    \"riskMetrics\": {\n      \"currentLeverage\": 5.0,\n      \"projectedLeverage\": 8.0,\n      \"correlation\": 0.3,\n      \"portfolioDelta\": 500.00,\n      \"portfolioBeta\": 0.85\n    }\n  },\n  \"timestamp\": 1702500000050,\n  \"processingTime\": 45\n}\n</code></pre></p> <p>Vetoed Example: <pre><code>{\n  \"signalId\": \"sig_phase1_btc_1702500000000\",\n  \"approved\": false,\n  \"authorizedSize\": 0,\n  \"reason\": \"Circuit breaker active - trading halted\",\n  \"allocation\": {\n    \"w1\": 0.8,\n    \"w2\": 0.2,\n    \"w3\": 0.0,\n    \"timestamp\": 1702500000000\n  },\n  \"performance\": {\n    \"phaseId\": \"phase1\",\n    \"sharpeRatio\": -0.5,\n    \"totalPnL\": -100.00,\n    \"tradeCount\": 8,\n    \"winRate\": 0.35,\n    \"avgWin\": 30.00,\n    \"avgLoss\": 45.00,\n    \"modifier\": 0.5\n  },\n  \"risk\": {\n    \"approved\": false,\n    \"reason\": \"Circuit breaker active\",\n    \"riskMetrics\": {\n      \"currentLeverage\": 0,\n      \"projectedLeverage\": 0,\n      \"correlation\": 0,\n      \"portfolioDelta\": 0,\n      \"portfolioBeta\": 0\n    }\n  },\n  \"timestamp\": 1702500000012,\n  \"processingTime\": 8\n}\n</code></pre></p>"},{"location":"reference/api-brain/#webhook-endpoints","title":"Webhook Endpoints","text":""},{"location":"reference/api-brain/#core-signal-endpoint","title":"Core Signal Endpoint","text":""},{"location":"reference/api-brain/#post-signal","title":"POST /signal","text":"<p>Process an intent signal from any phase.</p> <p>Request: <pre><code>curl -X POST http://localhost:3100/signal \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"signalId\": \"sig_123\",\n    \"phaseId\": \"phase1\",\n    \"symbol\": \"BTCUSDT\",\n    \"side\": \"BUY\",\n    \"requestedSize\": 1000\n  }'\n</code></pre></p> <p>Response (200 OK): <pre><code>{\n  \"signalId\": \"sig_123\",\n  \"approved\": true,\n  \"authorizedSize\": 800,\n  \"reason\": \"Approved\",\n  \"processingTime\": 45\n}\n</code></pre></p> <p>Response (409 Conflict - Duplicate): <pre><code>{\n  \"error\": \"Duplicate signal ID\",\n  \"signalId\": \"sig_123\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#phase-specific-webhooks","title":"Phase-Specific Webhooks","text":""},{"location":"reference/api-brain/#post-webhookphase1-alias-webhookscavenger","title":"POST /webhook/phase1 (alias: /webhook/scavenger)","text":"<p>Receive signals from Phase 1 (Scavenger).</p> <p>Request: <pre><code>curl -X POST http://localhost:3100/webhook/phase1 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"signal_id\": \"trap_btc_1702500000000\",\n    \"symbol\": \"BTCUSDT\",\n    \"direction\": \"LONG\",\n    \"size\": 500,\n    \"leverage\": 20\n  }'\n</code></pre></p> <p>Response: <pre><code>{\n  \"signalId\": \"trap_btc_1702500000000\",\n  \"approved\": true,\n  \"authorizedSize\": 400,\n  \"reason\": \"Approved with leverage cap adjustment\",\n  \"processingTime\": 38,\n  \"source\": \"phase1\"\n}\n</code></pre></p>"},{"location":"reference/api-brain/#post-webhookphase2-alias-webhookhunter","title":"POST /webhook/phase2 (alias: /webhook/hunter)","text":"<p>Receive signals from Phase 2 (Hunter).</p> <p>Request: <pre><code>curl -X POST http://localhost:3100/webhook/phase2 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"signal_id\": \"hologram_eth_1702500000000\",\n    \"symbol\": \"ETHUSDT\",\n    \"direction\": \"SHORT\",\n    \"size\": 2000,\n    \"leverage\": 5\n  }'\n</code></pre></p>"},{"location":"reference/api-brain/#post-webhookphase3-alias-webhooksentinel","title":"POST /webhook/phase3 (alias: /webhook/sentinel)","text":"<p>Receive signals from Phase 3 (Sentinel).</p> <p>Request: <pre><code>curl -X POST http://localhost:3100/webhook/phase3 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"signal_id\": \"basis_btc_1702500000000\",\n    \"symbol\": \"BTCUSDT\",\n    \"direction\": \"LONG\",\n    \"size\": 10000\n  }'\n</code></pre></p>"},{"location":"reference/api-brain/#phase-registration","title":"Phase Registration","text":""},{"location":"reference/api-brain/#post-phasesregister","title":"POST /phases/register","text":"<p>Register a phase's webhook URL for receiving notifications.</p> <p>Request: <pre><code>curl -X POST http://localhost:3100/phases/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"phaseId\": \"phase1\",\n    \"webhookUrl\": \"http://localhost:3001/brain-notification\"\n  }'\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"message\": \"Phase phase1 webhook registered\",\n  \"phaseId\": \"phase1\",\n  \"webhookUrl\": \"http://localhost:3001/brain-notification\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#get-phasesstatus","title":"GET /phases/status","text":"<p>Get status of all registered phases.</p> <p>Request: <pre><code>curl http://localhost:3100/phases/status\n</code></pre></p> <p>Response: <pre><code>{\n  \"phases\": {\n    \"phase1\": {\n      \"registered\": true,\n      \"webhookUrl\": \"http://localhost:3001/brain-notification\",\n      \"lastSignal\": 1702500000000,\n      \"signalCount\": 150,\n      \"approvalRate\": 0.85\n    },\n    \"phase2\": {\n      \"registered\": true,\n      \"webhookUrl\": \"http://localhost:3002/brain-notification\",\n      \"lastSignal\": 1702499000000,\n      \"signalCount\": 45,\n      \"approvalRate\": 0.72\n    },\n    \"phase3\": {\n      \"registered\": false,\n      \"webhookUrl\": null,\n      \"lastSignal\": null,\n      \"signalCount\": 0,\n      \"approvalRate\": 0\n    }\n  },\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#get-phasesapproval-rates","title":"GET /phases/approval-rates","text":"<p>Get signal approval rates per phase.</p> <p>Request: <pre><code>curl http://localhost:3100/phases/approval-rates\n</code></pre></p> <p>Response: <pre><code>{\n  \"approvalRates\": {\n    \"phase1\": 0.85,\n    \"phase2\": 0.72,\n    \"phase3\": 0.90\n  },\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#dashboard-data-format","title":"Dashboard Data Format","text":""},{"location":"reference/api-brain/#get-dashboard","title":"GET /dashboard","text":"<p>Get comprehensive dashboard data.</p> <p>Request: <pre><code>curl http://localhost:3100/dashboard\n</code></pre></p> <p>Response: <pre><code>{\n  \"nav\": 1500.00,\n  \"allocation\": {\n    \"w1\": 0.8,\n    \"w2\": 0.2,\n    \"w3\": 0.0,\n    \"timestamp\": 1702500000000\n  },\n  \"phaseEquity\": {\n    \"phase1\": 1200.00,\n    \"phase2\": 300.00,\n    \"phase3\": 0.00\n  },\n  \"riskMetrics\": {\n    \"globalLeverage\": 5.0,\n    \"netDelta\": 500.00,\n    \"correlationScore\": 0.3,\n    \"portfolioBeta\": 0.85\n  },\n  \"treasury\": {\n    \"futuresWallet\": 1500.00,\n    \"spotWallet\": 200.00,\n    \"totalSwept\": 200.00,\n    \"highWatermark\": 1700.00,\n    \"lockedProfit\": 200.00,\n    \"riskCapital\": 1500.00\n  },\n  \"circuitBreaker\": {\n    \"active\": false,\n    \"type\": null,\n    \"reason\": null,\n    \"triggeredAt\": null,\n    \"dailyDrawdown\": 0.05,\n    \"consecutiveLosses\": 0,\n    \"equityLevel\": 1500.00,\n    \"cooldownEndsAt\": null\n  },\n  \"recentDecisions\": [\n    {\n      \"signalId\": \"sig_abc123\",\n      \"approved\": true,\n      \"authorizedSize\": 800,\n      \"reason\": \"Approved\",\n      \"timestamp\": 1702499900000\n    }\n  ],\n  \"lastUpdated\": 1702500000000,\n  \"manualOverride\": null,\n  \"warningBannerActive\": false\n}\n</code></pre></p>"},{"location":"reference/api-brain/#dashboard-data-types","title":"Dashboard Data Types","text":"<pre><code>interface DashboardData {\n  /** Net Asset Value (total equity) */\n  nav: number;\n\n  /** Current allocation vector */\n  allocation: AllocationVector;\n\n  /** Equity allocated to each phase */\n  phaseEquity: {\n    phase1: number;\n    phase2: number;\n    phase3: number;\n  };\n\n  /** Current risk metrics */\n  riskMetrics: {\n    globalLeverage: number;\n    netDelta: number;\n    correlationScore: number;\n    portfolioBeta: number;\n    powerLaw?: {\n        alpha: number;\n        volatilityState: 'STABLE' | 'EXPANDING' | 'CONTRACTING' | 'EXTREME';\n        theoreticalMaxLeverage: number;\n    };\n  };\n\n  /** Treasury status */\n  treasury: TreasuryStatus;\n\n  /** Circuit breaker status */\n  circuitBreaker: BreakerStatus;\n\n  /** Recent brain decisions */\n  recentDecisions: BrainDecision[];\n\n  /** Last update timestamp */\n  lastUpdated: number;\n\n  /** Manual override info (if active) */\n  manualOverride: ManualOverride | null;\n\n  /** Warning banner flag */\n  warningBannerActive: boolean;\n\n  /** Current regime state */\n  regimeState?: {\n      current: string;\n      confidence: number;\n      lastShift: number;\n  };\n}\n\ninterface AllocationVector {\n  w1: number;  // Phase 1 weight (0-1)\n  w2: number;  // Phase 2 weight (0-1)\n  w3: number;  // Phase 3 weight (0-1)\n  timestamp: number;\n}\n\ninterface TreasuryStatus {\n  futuresWallet: number;\n  spotWallet: number;\n  totalSwept: number;\n  highWatermark: number;\n  lockedProfit: number;\n  riskCapital: number;\n}\n\ninterface BreakerStatus {\n  active: boolean;\n  type: 'HARD' | 'SOFT' | null;\n  reason: string | null;\n  triggeredAt: number | null;\n  dailyDrawdown: number;\n  consecutiveLosses: number;\n  equityLevel: number;\n  cooldownEndsAt: number | null;\n}\n</code></pre>"},{"location":"reference/api-brain/#get-dashboardextended","title":"GET /dashboard/extended","text":"<p>Get extended dashboard data with additional metrics.</p> <p>Request: <pre><code>curl http://localhost:3100/dashboard/extended\n</code></pre></p> <p>Response: Same as <code>/dashboard</code> with additional fields: - Performance metrics per phase - Historical allocation data - Sweep history - Detailed risk snapshots</p>"},{"location":"reference/api-brain/#get-dashboardexport","title":"GET /dashboard/export","text":"<p>Export dashboard data as a downloadable JSON file.</p> <p>Request: <pre><code>curl -O http://localhost:3100/dashboard/export\n</code></pre></p> <p>Response Headers: <pre><code>Content-Type: application/json\nContent-Disposition: attachment; filename=\"titan-brain-dashboard-1702500000000.json\"\n</code></pre></p> <p>Response Body: <pre><code>{\n  \"version\": \"1.0.0\",\n  \"exportedAt\": \"2024-12-14T10:30:00.000Z\",\n  \"data\": {\n    \"nav\": 1500.00,\n    \"allocation\": { ... },\n    \"phaseEquity\": { ... },\n    \"riskMetrics\": { ... },\n    \"treasury\": { ... },\n    \"circuitBreaker\": { ... },\n    \"recentDecisions\": [ ... ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api-brain/#error-handling","title":"Error Handling","text":""},{"location":"reference/api-brain/#http-status-codes","title":"HTTP Status Codes","text":"Code Description 200 Success 400 Bad Request - Invalid input 401 Unauthorized - Invalid signature or credentials 409 Conflict - Duplicate signal ID 500 Internal Server Error 503 Service Unavailable - System unhealthy"},{"location":"reference/api-brain/#error-response-format","title":"Error Response Format","text":"<pre><code>{\n  \"error\": \"Human-readable error message\",\n  \"timestamp\": 1702500000000,\n  \"details\": {\n    \"field\": \"Additional context\"\n  }\n}\n</code></pre>"},{"location":"reference/api-brain/#common-errors","title":"Common Errors","text":"<p>Invalid Signal Format: <pre><code>{\n  \"error\": \"signalId is required and must be a string\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p> <p>Invalid Phase ID: <pre><code>{\n  \"error\": \"phaseId must be one of: phase1, phase2, phase3\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p> <p>Invalid Side: <pre><code>{\n  \"error\": \"side must be one of: BUY, SELL\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p> <p>Invalid Signature: <pre><code>{\n  \"error\": \"Invalid signature\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p> <p>Duplicate Signal: <pre><code>{\n  \"error\": \"Duplicate signal ID\",\n  \"signalId\": \"sig_123\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#rate-limiting","title":"Rate Limiting","text":"<p>The Brain API exposes a configurable rate limit (default 12 RPS per <code>.env.example:126</code>) but does not enforce strict middleware-level throttling by default. For production deployments, layer additional rate limiting via:</p> <ol> <li>Reverse Proxy Rate Limiting (nginx, HAProxy)</li> <li>API Gateway (Kong, AWS API Gateway)</li> <li>Application-Level (custom middleware)</li> </ol>"},{"location":"reference/api-brain/#recommended-limits","title":"Recommended Limits","text":"Endpoint Recommended Limit <code>/signal</code> 100 req/min <code>/webhook/*</code> 100 req/min per phase <code>/dashboard</code> 60 req/min <code>/admin/*</code> 10 req/min <code>/trade/*</code> 20 req/min <code>/risk/*</code> 10 req/min"},{"location":"reference/api-brain/#manual-trading","title":"Manual Trading","text":""},{"location":"reference/api-brain/#post-trademanual","title":"POST /trade/manual","text":"<p>Execute a manual trade with optional risk bypass.</p> <p>Request Body: <pre><code>{\n  \"symbol\": \"BTCUSDT\",\n  \"side\": \"BUY\",\n  \"size\": 500,\n  \"leverage\": 5,\n  \"bypassRisk\": false,\n  \"exchange\": \"bybit\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"signalId\": \"manual_sys_1702500000000\",\n  \"message\": \"Manual trade executed\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#delete-tradecancel-all","title":"DELETE /trade/cancel-all","text":"<p>Emergency command to cancel all open orders and potentially flatten positions (configurable).</p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"message\": \"All trades cancelled\",\n  \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#system-configuration","title":"System Configuration","text":""},{"location":"reference/api-brain/#patch-riskconfig","title":"PATCH /risk/config","text":"<p>Hot-patch risk parameters at runtime.</p> <p>Request Body: <pre><code>{\n    \"maxDrawdown\": 0.15,\n    \"leverageCaps\": {\n        \"MICRO\": 20,\n        \"SMALL\": 10,\n        \"MEDIUM\": 5,\n        \"INSTITUTIONAL\": 2\n    },\n    \"maxCorrelationInfo\": 0.7\n}\n</code></pre></p> <p>Response: <pre><code>{\n    \"success\": true,\n    \"config\": { ... },\n    \"timestamp\": 1702500000000\n}\n</code></pre></p>"},{"location":"reference/api-brain/#observability","title":"Observability","text":""},{"location":"reference/api-brain/#get-metrics","title":"GET /metrics","text":"<p>Exposes Prometheus metrics for scraping.</p> <p>Metrics: *   <code>titan_brain_current_equity</code>: Current NAV. *   <code>titan_brain_sharpe_ratio</code>: Rolling Sharpe per phase. *   <code>titan_brain_circuit_breaker_active</code>: 1 if active, 0 if inactive. *   <code>titan_brain_signal_processing_latency_ms</code>: Histogram of processing time.</p>"},{"location":"reference/api-brain/#examples","title":"Examples","text":""},{"location":"reference/api-brain/#complete-signal-flow-example","title":"Complete Signal Flow Example","text":"<pre><code>const axios = require('axios');\nconst crypto = require('crypto');\n\nconst BRAIN_URL = 'http://localhost:3100';\nconst WEBHOOK_SECRET = process.env.WEBHOOK_SECRET;\n\n// Generate unique signal ID\nfunction generateSignalId(phase, symbol) {\n  return `${phase}_${symbol}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// Generate HMAC signature\nfunction sign(body) {\n  if (!WEBHOOK_SECRET) return null;\n  return crypto\n    .createHmac('sha256', WEBHOOK_SECRET)\n    .update(JSON.stringify(body))\n    .digest('hex');\n}\n\n// Send signal to Brain\nasync function sendSignal(phase, symbol, direction, size, leverage) {\n  const signal = {\n    signal_id: generateSignalId(phase, symbol),\n    symbol,\n    direction,\n    size,\n    leverage,\n    timestamp: Date.now()\n  };\n\n  const headers = {\n    'Content-Type': 'application/json'\n  };\n\n  const signature = sign(signal);\n  if (signature) {\n    headers['x-signature'] = signature;\n  }\n\n  try {\n    const response = await axios.post(\n      `${BRAIN_URL}/webhook/${phase}`,\n      signal,\n      { headers }\n    );\n\n    const decision = response.data;\n\n    if (decision.approved) {\n      console.log(`\u2705 Signal approved: ${decision.authorizedSize} USD`);\n      console.log(`   Reason: ${decision.reason}`);\n      console.log(`   Processing time: ${decision.processingTime}ms`);\n      return decision;\n    } else {\n      console.log(`\u274c Signal vetoed: ${decision.reason}`);\n      return null;\n    }\n  } catch (error) {\n    if (error.response) {\n      console.error(`Error: ${error.response.data.error}`);\n    } else {\n      console.error(`Network error: ${error.message}`);\n    }\n    return null;\n  }\n}\n\n// Example usage\nasync function main() {\n  // Check system status first\n  const status = await axios.get(`${BRAIN_URL}/status`);\n  console.log(`System status: ${status.data.status}`);\n  console.log(`Current equity: $${status.data.equity}`);\n\n  if (status.data.circuitBreaker === 'active') {\n    console.log('\u26a0\ufe0f Circuit breaker is active - signals will be vetoed');\n    return;\n  }\n\n  // Send a signal\n  const decision = await sendSignal(\n    'phase1',\n    'BTCUSDT',\n    'LONG',\n    500,\n    15\n  );\n\n  if (decision) {\n    // Proceed with execution using authorized size\n    console.log(`Executing trade with ${decision.authorizedSize} USD`);\n  }\n}\n\nmain();\n</code></pre>"},{"location":"reference/api-brain/#dashboard-polling-example","title":"Dashboard Polling Example","text":"<pre><code>const axios = require('axios');\n\nconst BRAIN_URL = 'http://localhost:3100';\nconst POLL_INTERVAL = 5000; // 5 seconds\n\nasync function pollDashboard() {\n  try {\n    const response = await axios.get(`${BRAIN_URL}/dashboard`);\n    const data = response.data;\n\n    console.clear();\n    console.log('=== TITAN BRAIN DASHBOARD ===');\n    console.log(`NAV: $${data.nav.toFixed(2)}`);\n    console.log(`Allocation: P1=${(data.allocation.w1 * 100).toFixed(0)}% P2=${(data.allocation.w2 * 100).toFixed(0)}% P3=${(data.allocation.w3 * 100).toFixed(0)}%`);\n    console.log(`Leverage: ${data.riskMetrics.globalLeverage.toFixed(1)}x`);\n    console.log(`Delta: $${data.riskMetrics.netDelta.toFixed(2)}`);\n    console.log(`Circuit Breaker: ${data.circuitBreaker.active ? '\ud83d\udd34 ACTIVE' : '\ud83d\udfe2 Inactive'}`);\n    console.log(`High Watermark: $${data.treasury.highWatermark.toFixed(2)}`);\n    console.log(`Total Swept: $${data.treasury.totalSwept.toFixed(2)}`);\n    console.log(`Last Updated: ${new Date(data.lastUpdated).toISOString()}`);\n\n  } catch (error) {\n    console.error('Failed to fetch dashboard:', error.message);\n  }\n}\n\n// Start polling\nsetInterval(pollDashboard, POLL_INTERVAL);\npollDashboard();\n</code></pre>"},{"location":"reference/api-brain/#circuit-breaker-reset-example","title":"Circuit Breaker Reset Example","text":"<pre><code>const axios = require('axios');\n\nconst BRAIN_URL = 'http://localhost:3100';\n\nasync function resetCircuitBreaker(operatorId) {\n  try {\n    // Check current status\n    const status = await axios.get(`${BRAIN_URL}/breaker`);\n\n    if (!status.data.active) {\n      console.log('Circuit breaker is not active');\n      return;\n    }\n\n    console.log(`Circuit breaker active: ${status.data.reason}`);\n    console.log(`Triggered at: ${new Date(status.data.triggeredAt).toISOString()}`);\n\n    // Reset the breaker\n    const response = await axios.post(\n      `${BRAIN_URL}/breaker/reset`,\n      { operatorId },\n      { headers: { 'Content-Type': 'application/json' } }\n    );\n\n    console.log(`\u2705 ${response.data.message}`);\n    console.log(`   Operator: ${response.data.operatorId}`);\n\n  } catch (error) {\n    console.error('Failed to reset circuit breaker:', error.response?.data?.error || error.message);\n  }\n}\n\n// Usage\nresetCircuitBreaker('admin');\n</code></pre>"},{"location":"reference/api-brain/#manual-override-example","title":"Manual Override Example","text":"<pre><code>const axios = require('axios');\n\nconst BRAIN_URL = 'http://localhost:3100';\n\nasync function createOverride(operatorId, password, allocation, reason, durationHours) {\n  try {\n    const response = await axios.post(\n      `${BRAIN_URL}/admin/override`,\n      {\n        operatorId,\n        password,\n        allocation,\n        reason,\n        durationHours\n      },\n      { headers: { 'Content-Type': 'application/json' } }\n    );\n\n    console.log(`\u2705 ${response.data.message}`);\n    console.log(`   New allocation: P1=${allocation.w1} P2=${allocation.w2} P3=${allocation.w3}`);\n    console.log(`   Reason: ${reason}`);\n    console.log(`   Duration: ${durationHours} hours`);\n\n  } catch (error) {\n    console.error('Failed to create override:', error.response?.data?.error || error.message);\n  }\n}\n\n// Example: Shift allocation to Phase 2 for 24 hours\ncreateOverride(\n  'admin',\n  'secure_password',\n  { w1: 0.2, w2: 0.8, w3: 0.0 },\n  'Market conditions favor swing trading',\n  24\n);\n</code></pre>"},{"location":"reference/api-brain/#changelog","title":"Changelog","text":""},{"location":"reference/api-brain/#v100-december-2024","title":"v1.0.0 (December 2024)","text":"<ul> <li>Initial release</li> <li>Core signal processing</li> <li>Phase webhooks</li> <li>Dashboard API</li> <li>Circuit breaker management</li> <li>Manual override support</li> </ul>"},{"location":"reference/api-brain/#v110-january-2026-current","title":"v1.1.0 (January 2026) -&gt; Current","text":"<ul> <li>PowerLaw Integration: Added <code>powerlaw_metrics</code> to Dashboard and Risk logic.</li> <li>Steerability: Added <code>/trade/manual</code> and <code>/trade/cancel-all</code> endpoints.</li> <li>Dynamic Risk: Added <code>/risk/config</code> endpoint.</li> <li>Observability: Added <code>/dashboard/extended</code> endpoint.</li> </ul>"},{"location":"reference/api-http-catalog/","title":"HTTP Interfaces &amp; Ports","text":"<p>Status: Canonical Scope: Internal API Surfaces</p> <p>Titan is primarily Event-Driven (NATS). HTTP is used for:</p> <ol> <li>Health Checks (Orchestration).</li> <li>Metrics (Prometheus).</li> <li>Console BFF (UI Data).</li> <li>Legacy REST adapters (Exchange Proxy).</li> </ol> <p>Invariant: Trading Commands NEVER go over HTTP (except internal adapter calls to exchange). All internal command and control is NATS.</p>"},{"location":"reference/api-http-catalog/#1-service-port-map","title":"1. Service Port Map","text":"Service Port Internal URL Public? <code>titan-brain</code> 3100 <code>http://titan-brain:3100</code> \u274c NO <code>titan-execution-rs</code> 3002 <code>http://titan-execution:3002</code> \u274c NO <code>titan-console-api</code> 3000 <code>http://titan-console-api:3000</code> \u274c NO <code>titan-console</code> 8080 N/A (Static Files via Traefik) \u2705 YES (443) <code>titan-phase1</code> 8081 <code>http://titan-phase1-scavenger:8081</code> \u274c NO <code>titan-ai-quant</code> 8082 <code>http://titan-ai-quant:8082</code> \u274c NO <code>titan-phase2</code> 8083 <code>http://titan-phase2-hunter:8083</code> \u274c NO <code>titan-phase3</code> 8084 <code>http://titan-phase3-sentinel:8084</code> \u274c NO"},{"location":"reference/api-http-catalog/#2-standard-endpoints","title":"2. Standard Endpoints","text":"<p>All services MUST implement:</p>"},{"location":"reference/api-http-catalog/#21-health-get","title":"2.1 <code>/health</code> (GET)","text":"<p>Returns <code>200 OK</code> if the service is alive.</p> <ul> <li>Brain: Checks DB connection and NATS connection.</li> <li>Execution: Checks Redb connection.</li> </ul>"},{"location":"reference/api-http-catalog/#22-metrics-get","title":"2.2 <code>/metrics</code> (GET)","text":"<p>Returns Prometheus-formatted metrics.</p> <ul> <li>Scraped by Prometheus on port <code>9090</code>.</li> </ul>"},{"location":"reference/api-http-catalog/#3-console-api-bff","title":"3. Console API (BFF)","text":"<p>Port: <code>3000</code>. Acts as the gateway for the Frontend.</p> <ul> <li>Authentication: JWT (Cookie).</li> <li>Routes:</li> <li><code>POST /auth/login</code>: Admin login.</li> <li><code>GET /api/status</code>: System-wide status aggregation.</li> <li><code>GET /api/history</code>: Trade history (from Postgres).</li> </ul>"},{"location":"reference/api-http-catalog/#4-execution-rs","title":"4. Execution-RS","text":"<p>Port: <code>3002</code>.</p> <ul> <li>Note: This HTTP server is minimal. Most action happens on NATS.</li> <li><code>GET /state</code>: Admin-only dump of internal state (requires VPN/Localhost).</li> </ul>"},{"location":"reference/api-nats-subjects/","title":"NATS JetStream Reference","text":"<p>Status: Canonical Authority: <code>@titan/shared</code> Auto-Generated: Partially (via <code>SOTA_QUALITY.md</code>)</p>"},{"location":"reference/api-nats-subjects/#1-subject-taxonomy","title":"1. Subject Taxonomy","text":"<p>Titan uses a strict hierarchical subject space: <code>titan.&lt;type&gt;.&lt;domain&gt;.&lt;action&gt;.&lt;version&gt;</code>.</p> <ul> <li>CMD (<code>titan.cmd.&gt;</code>): Commands. Actions that mutate state. 1-to-1 (Queue Group).</li> <li>EVT (<code>titan.evt.&gt;</code>): Events. Facts that happened. 1-to-Many (Broadcast).</li> <li>DATA (<code>titan.data.&gt;</code>): Ephemeral high-frequency data (Tickers).</li> </ul>"},{"location":"reference/api-nats-subjects/#2-stream-definitions","title":"2. Stream Definitions","text":"Stream Description Retention Subjects <code>TITAN_COMMANDS</code> Critical Registry WorkQueue <code>titan.cmd.&gt;</code> <code>TITAN_EVENTS</code> Audit Log Limits (Age/Size) <code>titan.evt.&gt;</code> <code>TITAN_DATA</code> Telemetry Limits (Interest) <code>titan.data.&gt;</code>"},{"location":"reference/api-nats-subjects/#3-subject-catalog","title":"3. Subject Catalog","text":""},{"location":"reference/api-nats-subjects/#31-commands-critical","title":"3.1 Commands (Critical)","text":"Subject Pattern Payload Description <code>titan.cmd.execution.place.v1</code> <code>IntentEnvelope</code> Brain \u2192 Execution. The only way to trade. <code>titan.cmd.sys.halt.v1</code> <code>HaltPayload</code> Operator \u2192 System. Instant Kill Switch. <code>titan.cmd.operator.arm.v1</code> <code>ArmPayload</code> Operator \u2192 System. Re-enable trading. <code>titan.cmd.operator.disarm.v1</code> <code>DisarmPayload</code> Operator \u2192 System. Pause trading safely. <code>titan.cmd.ai.optimize.v1</code> <code>OptimizePayload</code> Brain \u2192 AI Quant. Request new parameters."},{"location":"reference/api-nats-subjects/#32-events-signals-fills","title":"3.2 Events (Signals &amp; Fills)","text":"Subject Pattern Payload Description <code>titan.evt.execution.fill.v1</code> <code>FillEvent</code> Execution \u2192 Brain. Trade confirmed. <code>titan.evt.execution.reject.v1</code> <code>RejectEvent</code> Execution \u2192 Brain. Order failed validation. <code>titan.evt.scavenger.signal.v1</code> <code>SignalPayload</code> Scavenger \u2192 Brain. Trap detected. <code>titan.evt.hunter.signal.v1</code> <code>SignalPayload</code> Hunter \u2192 Brain. Structure detected. <code>titan.evt.sentinel.signal.v1</code> <code>SignalPayload</code> Sentinel \u2192 Brain. Arb opportunity. <code>titan.evt.phase.diagnostics.v1</code> <code>PhasePosture</code> All Phases \u2192 Brain. Heartbeat/Health."},{"location":"reference/api-nats-subjects/#33-data-metrics","title":"3.3 Data (Metrics)","text":"Subject Pattern Description <code>titan.data.market.ticker.v1</code> Normalized ticker updates (from Execution/Feed). <code>titan.data.powerlaw.metrics.v1</code> Real-time Power Law deviation metrics. <code>titan.data.dashboard.update.v1</code> Aggregated view for Console UI."},{"location":"reference/api-nats-subjects/#4-message-envelopes","title":"4. Message Envelopes","text":"<p>All critical messages (<code>CMD</code>, <code>EVT</code>) must be wrapped in the Intent Envelope.</p> <pre><code>interface IntentEnvelope&lt;T&gt; {\n  type: string;      // Message type identifier\n  id: string;        // UUID v4 (serves as nonce for dedup/replay prevention)\n  source: string;    // e.g., \"titan-brain\"\n  ts: number;        // Unix ms\n  payload: T;        // Actual message content\n  sig?: string;      // HMAC-SHA256 (Required for Commands)\n}\n</code></pre>"},{"location":"reference/api-ws-console/","title":"Console WebSocket Protocol","text":"<p>The Console WebSocket provides real-time updates for the Titan Console dashboard. It delivers live data for equity changes, position updates, signal notifications, and system status changes.</p>"},{"location":"reference/api-ws-console/#connection-details","title":"Connection Details","text":"<ul> <li>URL: <code>ws://localhost:3101/ws/console</code> (development)</li> <li>URL: <code>wss://titan-brain.yourdomain.com/ws/console</code> (production)</li> <li>Protocol: WebSocket (RFC 6455)</li> <li>Authentication: None (internal service communication)</li> <li>Reconnection: Automatic with exponential backoff</li> </ul>"},{"location":"reference/api-ws-console/#message-format","title":"Message Format","text":"<p>All messages follow a consistent JSON format:</p> <pre><code>{\n  \"type\": \"MESSAGE_TYPE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {}\n}\n</code></pre>"},{"location":"reference/api-ws-console/#message-types","title":"Message Types","text":""},{"location":"reference/api-ws-console/#1-equity_update","title":"1. EQUITY_UPDATE","text":"<p>Real-time equity and P&amp;L updates.</p> <pre><code>{\n  \"type\": \"EQUITY_UPDATE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"equity\": 2450.00,\n    \"daily_pnl\": 125.50,\n    \"daily_pnl_pct\": 5.4,\n    \"weekly_pnl\": 245.75,\n    \"weekly_pnl_pct\": 11.2,\n    \"total_pnl\": 1450.00,\n    \"high_watermark\": 2500.00,\n    \"drawdown\": -2.0,\n    \"drawdown_pct\": -2.0\n  }\n}\n</code></pre> <p>Fields:</p> <ul> <li><code>equity</code>: Current account equity in USD</li> <li><code>daily_pnl</code>: Daily profit/loss in USD</li> <li><code>daily_pnl_pct</code>: Daily P&amp;L as percentage</li> <li><code>weekly_pnl</code>: Weekly profit/loss in USD</li> <li><code>weekly_pnl_pct</code>: Weekly P&amp;L as percentage</li> <li><code>total_pnl</code>: Total profit/loss since inception</li> <li><code>high_watermark</code>: Highest equity reached</li> <li><code>drawdown</code>: Current drawdown in USD</li> <li><code>drawdown_pct</code>: Current drawdown as percentage</li> </ul>"},{"location":"reference/api-ws-console/#2-position_update","title":"2. POSITION_UPDATE","text":"<p>Position changes and updates.</p> <pre><code>{\n  \"type\": \"POSITION_UPDATE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"action\": \"OPENED\",\n    \"symbol\": \"BTCUSDT\",\n    \"position\": {\n      \"symbol\": \"BTCUSDT\",\n      \"side\": \"LONG\",\n      \"size\": 0.1,\n      \"entry_price\": 43250.50,\n      \"current_price\": 43300.00,\n      \"unrealized_pnl\": 4.95,\n      \"unrealized_pnl_pct\": 0.11,\n      \"liquidation_price\": 41500.00,\n      \"stop_loss\": 42800.00,\n      \"take_profit\": 44000.00,\n      \"leverage\": 15,\n      \"margin_used\": 288.34,\n      \"timestamp\": \"2024-12-18T10:30:00.000Z\"\n    }\n  }\n}\n</code></pre> <p>Actions:</p> <ul> <li><code>OPENED</code>: New position opened</li> <li><code>UPDATED</code>: Position size or price updated</li> <li><code>CLOSED</code>: Position closed</li> <li><code>LIQUIDATED</code>: Position liquidated</li> </ul>"},{"location":"reference/api-ws-console/#3-signal_notification","title":"3. SIGNAL_NOTIFICATION","text":"<p>Signal processing notifications.</p> <pre><code>{\n  \"type\": \"SIGNAL_NOTIFICATION\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"signal_id\": \"titan_BTCUSDT_12345_1\",\n    \"type\": \"CONFIRM\",\n    \"symbol\": \"BTCUSDT\",\n    \"direction\": \"LONG\",\n    \"status\": \"FILLED\",\n    \"entry_price\": 43250.50,\n    \"size\": 0.1,\n    \"phase\": \"PHASE_1_KICKSTARTER\",\n    \"regime_state\": 1,\n    \"confidence\": 95,\n    \"processing_time_ms\": 45\n  }\n}\n</code></pre> <p>Signal Types:</p> <ul> <li><code>PREPARE</code>: Signal preparation</li> <li><code>CONFIRM</code>: Signal confirmation and execution</li> <li><code>ABORT</code>: Signal abortion</li> <li><code>HEARTBEAT</code>: System heartbeat</li> </ul> <p>Status Values:</p> <ul> <li><code>PENDING</code>: Signal received, processing</li> <li><code>FILLED</code>: Order filled successfully</li> <li><code>REJECTED</code>: Signal rejected by safety gates</li> <li><code>CANCELLED</code>: Signal cancelled or aborted</li> <li><code>ERROR</code>: Processing error occurred</li> </ul>"},{"location":"reference/api-ws-console/#4-master_arm_change","title":"4. MASTER_ARM_CHANGE","text":"<p>Master Arm status changes.</p> <pre><code>{\n  \"type\": \"MASTER_ARM_CHANGE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"master_arm\": true,\n    \"previous_state\": false,\n    \"changed_by\": \"admin\",\n    \"reason\": \"Manual enable by operator\",\n    \"auto_disabled\": false\n  }\n}\n</code></pre> <p>Fields:</p> <ul> <li><code>master_arm</code>: New Master Arm state (true/false)</li> <li><code>previous_state</code>: Previous Master Arm state</li> <li><code>changed_by</code>: Operator who made the change</li> <li><code>reason</code>: Reason for the change</li> <li><code>auto_disabled</code>: Whether change was automatic (e.g., circuit breaker)</li> </ul>"},{"location":"reference/api-ws-console/#5-circuit_breaker_update","title":"5. CIRCUIT_BREAKER_UPDATE","text":"<p>Circuit breaker status changes.</p> <pre><code>{\n  \"type\": \"CIRCUIT_BREAKER_UPDATE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"active\": true,\n    \"type\": \"SOFT\",\n    \"reason\": \"Daily drawdown exceeded 5%\",\n    \"triggered_at\": 1702499800000,\n    \"daily_drawdown\": -5.2,\n    \"consecutive_losses\": 3,\n    \"equity_level\": 2326.00,\n    \"cooldown_ends_at\": 1702514400000\n  }\n}\n</code></pre> <p>Circuit Breaker Types:</p> <ul> <li><code>SOFT</code>: Warning level, reduced position sizes</li> <li><code>HARD</code>: Trading halted, positions may be closed</li> </ul>"},{"location":"reference/api-ws-console/#6-config_change","title":"6. CONFIG_CHANGE","text":"<p>Configuration updates.</p> <pre><code>{\n  \"type\": \"CONFIG_CHANGE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"updates\": [\n      {\n        \"type\": \"risk_tuner\",\n        \"updated\": true\n      },\n      {\n        \"type\": \"asset_whitelist\",\n        \"updated\": true,\n        \"disabled_assets\": [\"DOGEUSDT\"]\n      }\n    ],\n    \"operator_id\": \"admin\"\n  }\n}\n</code></pre>"},{"location":"reference/api-ws-console/#7-system_status_update","title":"7. SYSTEM_STATUS_UPDATE","text":"<p>System component status changes.</p> <pre><code>{\n  \"type\": \"SYSTEM_STATUS_UPDATE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"component\": \"broker\",\n    \"status\": \"connected\",\n    \"previous_status\": \"disconnected\",\n    \"details\": {\n      \"broker\": \"BYBIT\",\n      \"reconnected_at\": 1702500000000,\n      \"connection_attempts\": 3\n    }\n  }\n}\n</code></pre> <p>Components:</p> <ul> <li><code>broker</code>: Broker connection status</li> <li><code>database</code>: Database connection status</li> <li><code>l2_cache</code>: Level 2 data cache status</li> <li><code>websocket</code>: WebSocket server status</li> <li><code>heartbeat</code>: System heartbeat status</li> </ul>"},{"location":"reference/api-ws-console/#8-emergency_flatten","title":"8. EMERGENCY_FLATTEN","text":"<p>Emergency flatten notifications.</p> <pre><code>{\n  \"type\": \"EMERGENCY_FLATTEN\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"action\": \"FLATTEN_ALL\",\n    \"closed_count\": 3,\n    \"reason\": \"PANIC_FLATTEN_ALL\",\n    \"operator_id\": \"admin\",\n    \"positions_closed\": [\n      {\n        \"symbol\": \"BTCUSDT\",\n        \"side\": \"LONG\",\n        \"size\": 0.1,\n        \"exit_price\": 43200.00,\n        \"pnl\": -5.05\n      },\n      {\n        \"symbol\": \"ETHUSDT\",\n        \"side\": \"SHORT\",\n        \"size\": 2.5,\n        \"exit_price\": 2285.00,\n        \"pnl\": 12.50\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"reference/api-ws-console/#9-performance_update","title":"9. PERFORMANCE_UPDATE","text":"<p>Performance metrics updates.</p> <pre><code>{\n  \"type\": \"PERFORMANCE_UPDATE\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"timeframe\": \"1D\",\n    \"win_rate\": 68.5,\n    \"profit_factor\": 2.15,\n    \"sharpe_ratio\": 1.85,\n    \"total_trades\": 12,\n    \"winning_trades\": 8,\n    \"losing_trades\": 4,\n    \"avg_win\": 45.20,\n    \"avg_loss\": -21.05,\n    \"largest_win\": 125.50,\n    \"largest_loss\": -35.75,\n    \"expectancy\": 23.45\n  }\n}\n</code></pre>"},{"location":"reference/api-ws-console/#10-phase_transition","title":"10. PHASE_TRANSITION","text":"<p>Phase transition notifications.</p> <pre><code>{\n  \"type\": \"PHASE_TRANSITION\",\n  \"timestamp\": 1702500000000,\n  \"data\": {\n    \"from_phase\": \"PHASE_1_KICKSTARTER\",\n    \"to_phase\": \"PHASE_2_TREND_RIDER\",\n    \"equity\": 5250.00,\n    \"threshold\": 5000.00,\n    \"reason\": \"Equity threshold exceeded\",\n    \"new_risk_pct\": 2.0,\n    \"new_max_leverage\": 5\n  }\n}\n</code></pre>"},{"location":"reference/api-ws-console/#connection-management","title":"Connection Management","text":""},{"location":"reference/api-ws-console/#connection-lifecycle","title":"Connection Lifecycle","text":"<ol> <li>Connect: Client establishes WebSocket connection</li> <li>Subscribe: Automatic subscription to all message types</li> <li>Receive: Real-time message delivery</li> <li>Disconnect: Graceful or unexpected disconnection</li> <li>Reconnect: Automatic reconnection with backoff</li> </ol>"},{"location":"reference/api-ws-console/#reconnection-strategy","title":"Reconnection Strategy","text":"<p>The client should implement automatic reconnection with exponential backoff:</p> <pre><code>class ConsoleWebSocket {\n  constructor(url) {\n    this.url = url;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 10;\n    this.reconnectInterval = 1000; // Start with 1 second\n    this.maxReconnectInterval = 30000; // Max 30 seconds\n    this.connect();\n  }\n\n  connect() {\n    this.ws = new WebSocket(this.url);\n\n    this.ws.onopen = () =&gt; {\n      console.log('Console WebSocket connected');\n      this.reconnectAttempts = 0;\n      this.reconnectInterval = 1000;\n    };\n\n    this.ws.onmessage = (event) =&gt; {\n      const message = JSON.parse(event.data);\n      this.handleMessage(message);\n    };\n\n    this.ws.onclose = () =&gt; {\n      console.log('Console WebSocket disconnected');\n      this.scheduleReconnect();\n    };\n\n    this.ws.onerror = (error) =&gt; {\n      console.error('Console WebSocket error:', error);\n    };\n  }\n\n  scheduleReconnect() {\n    if (this.reconnectAttempts &lt; this.maxReconnectAttempts) {\n      setTimeout(() =&gt; {\n        this.reconnectAttempts++;\n        console.log(`Reconnecting... (attempt ${this.reconnectAttempts})`);\n        this.connect();\n      }, this.reconnectInterval);\n\n      // Exponential backoff\n      this.reconnectInterval = Math.min(\n        this.reconnectInterval * 2,\n        this.maxReconnectInterval\n      );\n    }\n  }\n\n  handleMessage(message) {\n    switch (message.type) {\n      case 'EQUITY_UPDATE':\n        this.updateEquityDisplay(message.data);\n        break;\n      case 'POSITION_UPDATE':\n        this.updatePositionDisplay(message.data);\n        break;\n      case 'SIGNAL_NOTIFICATION':\n        this.showSignalNotification(message.data);\n        break;\n      // ... handle other message types\n    }\n  }\n}\n</code></pre>"},{"location":"reference/api-ws-console/#error-handling","title":"Error Handling","text":"<p>Handle WebSocket errors gracefully:</p> <pre><code>ws.onerror = (error) =&gt; {\n  console.error('WebSocket error:', error);\n\n  // Show user notification\n  showNotification('Connection error - attempting to reconnect...', 'warning');\n\n  // Update UI to show disconnected state\n  updateConnectionStatus('disconnected');\n};\n\nws.onclose = (event) =&gt; {\n  if (event.wasClean) {\n    console.log('WebSocket closed cleanly');\n  } else {\n    console.log('WebSocket connection lost');\n    showNotification('Connection lost - reconnecting...', 'error');\n  }\n\n  updateConnectionStatus('reconnecting');\n};\n</code></pre>"},{"location":"reference/api-ws-console/#message-filtering","title":"Message Filtering","text":"<p>Clients can filter messages based on type or content:</p> <pre><code>class MessageFilter {\n  constructor() {\n    this.filters = new Set();\n  }\n\n  addFilter(type) {\n    this.filters.add(type);\n  }\n\n  removeFilter(type) {\n    this.filters.delete(type);\n  }\n\n  shouldProcess(message) {\n    if (this.filters.size === 0) return true;\n    return this.filters.has(message.type);\n  }\n}\n\n// Usage\nconst filter = new MessageFilter();\nfilter.addFilter('EQUITY_UPDATE');\nfilter.addFilter('POSITION_UPDATE');\n\nws.onmessage = (event) =&gt; {\n  const message = JSON.parse(event.data);\n  if (filter.shouldProcess(message)) {\n    handleMessage(message);\n  }\n};\n</code></pre>"},{"location":"reference/api-ws-console/#rate-limiting","title":"Rate Limiting","text":"<p>The WebSocket server implements rate limiting to prevent abuse:</p> <ul> <li>Message Rate: Maximum 100 messages per second per connection</li> <li>Connection Rate: Maximum 10 connections per minute per IP</li> <li>Burst Allowance: Up to 200 messages in a 2-second burst</li> </ul>"},{"location":"reference/api-ws-console/#security-considerations","title":"Security Considerations","text":"<ol> <li>Origin Validation: Server validates WebSocket origin headers</li> <li>Rate Limiting: Prevents DoS attacks via message flooding</li> <li>Message Validation: All incoming messages are validated</li> <li>Connection Limits: Maximum concurrent connections per IP</li> <li>Heartbeat: Regular ping/pong to detect dead connections</li> </ol>"},{"location":"reference/api-ws-console/#testing","title":"Testing","text":""},{"location":"reference/api-ws-console/#websocket-testing-tool","title":"WebSocket Testing Tool","text":"<pre><code>// Simple WebSocket test client\nconst testClient = new WebSocket('ws://localhost:3002/ws/console');\n\ntestClient.onopen = () =&gt; {\n  console.log('Test client connected');\n};\n\ntestClient.onmessage = (event) =&gt; {\n  const message = JSON.parse(event.data);\n  console.log('Received:', message.type, message.data);\n};\n\ntestClient.onclose = () =&gt; {\n  console.log('Test client disconnected');\n};\n</code></pre>"},{"location":"reference/api-ws-console/#message-validation","title":"Message Validation","text":"<pre><code>function validateMessage(message) {\n  if (!message.type || !message.timestamp) {\n    throw new Error('Invalid message format');\n  }\n\n  if (typeof message.timestamp !== 'number') {\n    throw new Error('Invalid timestamp');\n  }\n\n  if (!message.data || typeof message.data !== 'object') {\n    throw new Error('Invalid message data');\n  }\n\n  return true;\n}\n</code></pre>"},{"location":"reference/api-ws-console/#performance-considerations","title":"Performance Considerations","text":"<ol> <li>Message Batching: Server batches rapid updates to prevent flooding</li> <li>Compression: WebSocket compression enabled for large messages</li> <li>Delta Updates: Only changed fields sent for position updates</li> <li>Throttling: High-frequency updates throttled to reasonable rates</li> <li>Buffer Management: Client should implement message buffering for UI updates</li> </ol>"},{"location":"reference/api-ws-console/#troubleshooting","title":"Troubleshooting","text":""},{"location":"reference/api-ws-console/#common-issues","title":"Common Issues","text":"<ol> <li>Connection Refused: Check if Execution service is running on port 3002</li> <li>Frequent Disconnections: Check network stability and firewall settings</li> <li>Missing Messages: Verify message filtering and error handling</li> <li>High Latency: Check server load and network conditions</li> </ol>"},{"location":"reference/api-ws-console/#debug-mode","title":"Debug Mode","text":"<p>Enable debug logging for troubleshooting:</p> <pre><code>const DEBUG = true;\n\nws.onmessage = (event) =&gt; {\n  const message = JSON.parse(event.data);\n\n  if (DEBUG) {\n    console.log(`[${new Date().toISOString()}] Received:`, message);\n  }\n\n  handleMessage(message);\n};\n</code></pre> <p>This protocol ensures reliable, real-time communication between the Titan Execution service and Console dashboard, providing operators with immediate visibility into system status and trading activity.</p>"},{"location":"reference/database/","title":"Database Reference (PostgreSQL)","text":"<p>Status: Canonical Schema: <code>services/titan-brain/src/db/schema.sql</code> Owner: Titan Brain</p> <p>The Database (<code>titan_brain</code>) is the persistent memory of the organism.</p>"},{"location":"reference/database/#1-schema-overview","title":"1. Schema Overview","text":""},{"location":"reference/database/#11-core-tables-the-ledger","title":"1.1 Core Tables (The Ledger)","text":"Table Description Partitioned? Owner <code>fills</code> Record of every executed trade. YES (Monthly) Execution/Brain <code>event_log</code> Event sourcing journal. YES (Monthly) Brain <code>brain_decisions</code> Why a trade was taken (Audit). No Brain <code>circuit_breaker_events</code> Halt/Resume log. No Brain"},{"location":"reference/database/#12-state-tables","title":"1.2 State Tables","text":"Table Description <code>allocation_history</code> Time-series of capital allocation per phase. <code>high_watermark</code> Peak equity tracking (for drawdown calc). <code>operators</code> Admin users and permissions. <code>config_history</code> Audit trail of config changes."},{"location":"reference/database/#2-partitioning-strategy","title":"2. Partitioning Strategy","text":"<p>High-volume tables are partitioned by time (Monthly) to ensure query performance and efficient archival.</p> <ul> <li>Fills: <code>fills_y2026m02</code>, <code>fills_y2026m03</code>...</li> <li>Events: <code>event_log_y2026m02</code>...</li> </ul> <p>Maintenance: Partitions are managed automatically by the <code>pg_partman</code> extension (or manual migration scripts in <code>services/titan-brain/migrations</code>).</p>"},{"location":"reference/database/#3-row-level-security-rls","title":"3. Row Level Security (RLS)","text":"<p>All tables have RLS enabled by default to prevent accidental cross-tenant data leaks (though Titan is currently single-tenant).</p>"},{"location":"reference/database/#4-migrations","title":"4. Migrations","text":"<p>Located in: <code>services/titan-brain/migrations/</code>.</p> <p>Runners: - Dev: <code>npm run start:brain</code> (auto-migrates on boot via <code>src/db/migrate.ts</code>) - Production: <code>scripts/ops/run_migrations.sh</code> (idempotent, tracks applied migrations in <code>_titan_migrations</code> table with SHA256 hashes, fails closed on drift) - CI: <code>scripts/ci/test_fresh_bootstrap.sh</code> (ephemeral Postgres \u2192 migrate \u2192 validate \u2192 idempotency proof)</p> <p>Invariant: Schema changes must be backward compatible or require a maintenance window.</p>"},{"location":"reference/scavenger-exchanges/","title":"Exchange Clients","text":"<p>This directory contains exchange client implementations for the Titan Phase 1 Scavenger (Predestination Engine).</p>"},{"location":"reference/scavenger-exchanges/#important-execution-refactored-december-6-2024","title":"\u26a0\ufe0f IMPORTANT: Execution Refactored (December 6, 2024)","text":"<p>ExchangeGateway, BybitPerpsClient, and MEXCPerpsClient have been REMOVED as part of the Hub-and-Spoke architecture integration (Task 1.7).</p> <p>All order execution now goes through the unified Execution Service via Fast Path IPC (Unix Domain Socket).</p>"},{"location":"reference/scavenger-exchanges/#overview","title":"Overview","text":"<p>The Predestination Engine now uses a Signal-Only architecture: - Binance Spot (Signal Validator): Confirms breakouts with volume - KEPT - Fast Path IPC (Execution): Sends PREPARE/CONFIRM/ABORT signals to Execution Service - NEW - Execution Service (Hub): Handles all order placement, position tracking, risk management - CENTRALIZED</p>"},{"location":"reference/scavenger-exchanges/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Detection Layer (The Spider)                 \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  BinanceSpotClient (Signal Validator)                    \u2502   \u2502\n\u2502  \u2502  - WebSocket AggTrades subscription                      \u2502   \u2502\n\u2502  \u2502  - Volume validation (50+ trades in 100ms)               \u2502   \u2502\n\u2502  \u2502  - Reconnection logic (3 retries, 2s delay)              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502                      TRAP_SPRUNG event                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Execution Layer (The Bite)                    \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  BybitPerpsClient (Primary Execution)                    \u2502   \u2502\n\u2502  \u2502  - Market data (OHLCV, OI, funding, volume)              \u2502   \u2502\n\u2502  \u2502  - Order placement with HMAC signature                   \u2502   \u2502\n\u2502  \u2502  - Leverage and risk management                          \u2502   \u2502\n\u2502  \u2502  - 2-second timeout protection                           \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  MEXCPerpsClient (Alternative Execution)                 \u2502   \u2502\n\u2502  \u2502  - Order placement with MEXC-specific format             \u2502   \u2502\n\u2502  \u2502  - HMAC signature authentication                         \u2502   \u2502\n\u2502  \u2502  - Rate limiting (10 req/s with queuing)                 \u2502   \u2502\n\u2502  \u2502  - 2-second timeout protection                           \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/scavenger-exchanges/#client-implementations","title":"Client Implementations","text":""},{"location":"reference/scavenger-exchanges/#binancespotclient-kept","title":"BinanceSpotClient (KEPT)","text":"<p>Purpose: Signal validator using Binance Spot WebSocket</p> <p>Key Features: - Real-time AggTrades WebSocket subscription - Volume validation (50+ trades in 100ms) - Automatic reconnection (3 retries, 2s delay) - Callback system for trade events</p> <p>Usage: <pre><code>const client = new BinanceSpotClient();\n\n// Subscribe to symbols\nawait client.subscribeAggTrades(['BTCUSDT', 'ETHUSDT']);\n\n// Register callback for trade events\nclient.onTrade('BTCUSDT', (trades) =&gt; {\n  console.log(`Received ${trades.length} trades`);\n});\n</code></pre></p>"},{"location":"reference/scavenger-exchanges/#bybitperpsclient-removed-task-17","title":"BybitPerpsClient (REMOVED - Task 1.7)","text":"<p>Reason: Execution now handled by unified Execution Service</p> <p>Replacement: Fast Path IPC \u2192 Execution Service \u2192 BrokerGateway \u2192 Bybit</p>"},{"location":"reference/scavenger-exchanges/#mexcperpsclient-removed-task-17","title":"MEXCPerpsClient (REMOVED - Task 1.7)","text":"<p>Reason: Execution now handled by unified Execution Service</p> <p>Replacement: Fast Path IPC \u2192 Execution Service \u2192 BrokerGateway \u2192 MEXC</p>"},{"location":"reference/scavenger-exchanges/#exchangegateway-removed-task-17","title":"ExchangeGateway (REMOVED - Task 1.7)","text":"<p>Reason: Multi-exchange orchestration now handled by Execution Service</p> <p>Replacement: Fast Path IPC sends PREPARE/CONFIRM/ABORT signals to Execution Service, which handles all execution logic</p>"},{"location":"reference/scavenger-exchanges/#rate-limiting","title":"Rate Limiting","text":""},{"location":"reference/scavenger-exchanges/#binance-spot-kept","title":"Binance Spot (KEPT)","text":"<ul> <li>No explicit rate limiting (WebSocket)</li> <li>Automatic reconnection on disconnect</li> </ul>"},{"location":"reference/scavenger-exchanges/#execution-service-new","title":"Execution Service (NEW)","text":"<ul> <li>Global rate limiting handled by Execution Service</li> <li>Bybit: 120 req/s per IP</li> <li>MEXC: 10 req/s with queuing</li> <li>All rate limiting centralized in BrokerGateway</li> </ul>"},{"location":"reference/scavenger-exchanges/#error-handling","title":"Error Handling","text":""},{"location":"reference/scavenger-exchanges/#binancespotclient-kept_1","title":"BinanceSpotClient (KEPT)","text":"<ul> <li>Timeout Protection: WebSocket reconnection</li> <li>Error Logging: Detailed error messages with context</li> <li>Graceful Degradation: Continue operating on disconnect</li> </ul>"},{"location":"reference/scavenger-exchanges/#execution-service-new_1","title":"Execution Service (NEW)","text":"<ul> <li>Timeout Protection: 2-second timeout on order placement</li> <li>Error Logging: Centralized logging via TelemetryService</li> <li>Graceful Degradation: Shadow State prevents ghost positions</li> </ul>"},{"location":"reference/scavenger-exchanges/#testing","title":"Testing","text":"<p>Remaining tests: - <code>BinanceSpotClient.test.ts</code>: WebSocket subscription, reconnection, callbacks</p> <p>Removed tests (execution now in Execution Service): - ~~<code>BybitPerpsClient.test.ts</code>~~ (REMOVED - Task 1.7) - ~~<code>MEXCPerpsClient.test.ts</code>~~ (REMOVED - Task 1.7) - ~~<code>ExchangeGateway.test.ts</code>~~ (REMOVED - Task 1.7)</p> <p>Run tests: <pre><code>npm test -- BinanceSpotClient.test.ts\n</code></pre></p>"},{"location":"reference/scavenger-exchanges/#requirements-coverage","title":"Requirements Coverage","text":""},{"location":"reference/scavenger-exchanges/#binancespotclient-kept_2","title":"BinanceSpotClient (KEPT)","text":"<ul> <li>\u2705 3.1-3.7: Detection Layer (WebSocket monitoring, volume validation)</li> </ul>"},{"location":"reference/scavenger-exchanges/#execution-service-new-task-17","title":"Execution Service (NEW - Task 1.7)","text":"<ul> <li>\u2705 2.1: Fetch OHLCV data for tripwire calculation (via BrokerGateway)</li> <li>\u2705 4.1-4.7: Execution Layer (order placement, risk management)</li> <li>\u2705 10.1-10.7: Multi-Exchange support (via BrokerGateway)</li> <li>\u2705 Robustness #5: Order timeout protection</li> <li>\u2705 Rate limiting (10 req/s MEXC, 120 req/s Bybit)</li> <li>\u2705 HMAC signature authentication</li> <li>\u2705 Shadow State (prevents ghost positions)</li> <li>\u2705 Phase Manager (automatic phase transitions)</li> </ul>"},{"location":"reference/scavenger-exchanges/#next-steps","title":"Next Steps","text":"<ol> <li>\u2705 Task 1.7: Remove duplicate exchange execution from Scavenger (COMPLETED)</li> <li>Task 1.8-1.10: Implement Fast Path IPC Client in Scavenger</li> <li>Task 1.11: Add headless mode to Scavenger</li> <li>Task 1.12-1.14: Console integration (Phase 1 Tab)</li> <li>Task 1.15-1.20: Startup scripts and end-to-end testing</li> </ol>"},{"location":"reference/schema_catalog/","title":"Schema Catalog","text":"<p>Index of all system contracts and data schemas.</p>"},{"location":"reference/schema_catalog/#event-bus-nats","title":"Event Bus (NATS)","text":"<ul> <li>AsyncAPI Spec</li> <li>Subjects: Defined in <code>packages/shared/src/messaging/powerlaw_subjects.ts</code>.</li> </ul>"},{"location":"reference/schema_catalog/#http-api","title":"HTTP API","text":"<ul> <li>OpenAPI Spec</li> <li>Titan Brain: Orchestration API.</li> </ul>"},{"location":"reference/schema_catalog/#database","title":"Database","text":"<ul> <li>Schema SQL</li> <li>Migrations: <code>services/titan-brain/migrations/</code></li> </ul>"},{"location":"reference/schema_catalog/#configuration","title":"Configuration","text":"<ul> <li>Risk Policy</li> <li>Fee Schedule</li> </ul>"},{"location":"research/ai_quant_pipeline/","title":"AI Quant Pipeline","text":"<p>Status: Canonical Engine: Google Gemini 2.0 Flash</p> <p>Titan uses Generative AI not to trade, but to optimize. The AI is a Researcher, not a Trader.</p>"},{"location":"research/ai_quant_pipeline/#1-the-loop","title":"1. The Loop","text":"<ol> <li>Data Ingestion: <code>titan-ai-quant</code> ingests 30 days of trade logs (<code>fills</code> table) and market data.</li> <li>Analysis:<ul> <li>It computes \"Actionable Discrepancies\" (e.g., \"Stop losses were too tight in clusters A, B, C\").</li> <li>It prompts Gemini 2.0: \"Given risk policy X and performance Y, suggest parameter Z modifications.\"</li> </ul> </li> <li>Proposal:<ul> <li>AI generates a <code>ParameterProposal</code> (JSON).</li> <li>Example: <code>hunter.entry_threshold: 0.5 -&gt; 0.55</code>.</li> </ul> </li> <li>Simulation:<ul> <li>The Proposal is run through <code>titan-backtesting</code>.</li> </ul> </li> <li>Review:<ul> <li>If Backtest &gt; Baseline, likely candidate.</li> <li>Operator Step: Human must review and click \"Merge\".</li> </ul> </li> </ol>"},{"location":"research/ai_quant_pipeline/#2-safety-invariants","title":"2. Safety Invariants","text":"<ol> <li>No Direct Control: The AI cannot issue <code>titan.cmd.execution.place</code>. It never touches the order book.</li> <li>Bounded Context: The AI can only modify specific \"Tunable Parameters\" defined in the strategy schema. It cannot change the Risk Policy.</li> <li>Deterministic output: We set <code>temperature: 0</code> for analysis tasks to ensure reproducibility.</li> </ol>"},{"location":"research/reproducibility/","title":"Research &amp; Reproducibility Standards","text":"<p>Status: Canonical Philosophy: Scientific Skepticism</p> <p>In Titan, we assume all backtests are overfit until proven otherwise.</p>"},{"location":"research/reproducibility/#1-the-burden-of-proof","title":"1. The Burden of Proof","text":"<p>Any new strategy (Phase) or parameter change (AI Quant) must pass the Triple Gate:</p> <ol> <li>Backtest (Simulation): Does it work on historical data?</li> <li>Forward Test (Paper): Does it work on live data without money?</li> <li>Canary Test (Live): Does it work with $100?</li> </ol>"},{"location":"research/reproducibility/#2-methodology","title":"2. Methodology","text":""},{"location":"research/reproducibility/#21-walk-forward-optimization","title":"2.1 Walk-Forward Optimization","text":"<p>Strategies must be trained on Period A and tested on Period B.</p> <ul> <li>Train: Jan - Jun</li> <li>Test: Jul - Dec</li> <li>Invariant: Testing on Training data is forbidden.</li> </ul>"},{"location":"research/reproducibility/#22-regime-bucketing","title":"2.2 Regime Bucketing","text":"<p>Strategies must be tagged with their intended regime.</p> <ul> <li><code>BULL_TREND</code></li> <li><code>BEAR_TREND</code></li> <li><code>CHOP_SIDEWAYS</code></li> <li><code>HIGH_VOLATILITY</code></li> </ul> <p>Performance is measured conditioned on the regime. A Trend strategy losing money in Chop is acceptable (if Brain allocates 0 to it).</p>"},{"location":"research/reproducibility/#23-transaction-costs-the-killer","title":"2.3 Transaction Costs (The Killer)","text":"<p>Simulations must include:</p> <ul> <li>Taker Fee: 0.055% (Standard) or 0.02% (VIP).</li> <li>Slippage: Assumed 5bps + volatility impact.</li> <li>Latency: Assumed 50ms internal + 50ms network.</li> </ul>"},{"location":"research/reproducibility/#3-rejection-criteria","title":"3. Rejection Criteria","text":"<p>A strategy is REJECTED if:</p> <ul> <li>Sharpe Ratio &lt; 1.0 (Annualized).</li> <li>Max Drawdown &gt; 20%.</li> <li>Correlation to BTC Buy &amp; Hold &gt; 0.8 (We seek alpha, not beta).</li> </ul>"},{"location":"research/workflow/","title":"Quant Research and Strategy Promotion Workflow","text":"<p>This workflow defines how research progresses from idea to production across phase strategies and AI Quant outputs.</p>"},{"location":"research/workflow/#lifecycle-stages","title":"Lifecycle Stages","text":"<ol> <li>Research</li> <li>Hypothesis, data selection, and feature engineering</li> <li> <p>Document expected edge and failure modes</p> </li> <li> <p>Backtest (via <code>services/titan-backtesting</code>)</p> </li> <li>Use historical data and realistic execution assumptions</li> <li>Include fees, slippage, and latency models</li> <li> <p>Produce a reproducible report in <code>.generated/</code></p> </li> <li> <p>Review</p> </li> <li>Peer review of code, data assumptions, and results</li> <li> <p>Risk review for drawdowns, tail events, and leverage usage</p> </li> <li> <p>Paper Trading</p> </li> <li>Deploy to sandbox exchanges or shadow execution</li> <li> <p>Validate signals, sizing, and operational safety</p> </li> <li> <p>Rollout</p> </li> <li>Gradual allocation with capital limits</li> <li>Monitor KPIs and rollback on regression</li> </ol>"},{"location":"research/workflow/#ai-quant-outputs","title":"AI Quant Outputs","text":"<p>AI Quant suggestions are advisory and must be validated before deployment:</p> <ul> <li>Reproduce outputs using deterministic backtests</li> <li>Validate out-of-sample performance (walk-forward or holdout)</li> <li>Stress-test against adverse regimes</li> <li>Check for overfitting and parameter instability</li> <li>Require human approval before promotion</li> </ul>"},{"location":"research/workflow/#promotion-checklist","title":"Promotion Checklist","text":"<ul> <li>[ ] Backtest report stored and reproducible</li> <li>[ ] Risk review completed and signed off</li> <li>[ ] Paper trading results meet thresholds</li> <li>[ ] Monitoring alerts configured</li> <li>[ ] Rollback plan documented</li> </ul>"},{"location":"research/workflow/#ownership","title":"Ownership","text":"<ul> <li>Strategy owners: Phase team leads</li> <li>Reviewers: Risk and platform operations</li> <li>Final approval: Trading operations manager</li> </ul>"},{"location":"rfcs/004_execution_hot_standby/","title":"RFC 004: Execution Service High Availability (Hot Standby)","text":"<p>Status: Proposed Date: 2026-02-02 Author: Antigravity</p>"},{"location":"rfcs/004_execution_hot_standby/#1-problem-statement","title":"1. Problem Statement","text":"<p>The <code>titan-execution-rs</code> service is currently a Single Point of Failure (SPOF). If the instance crashes, order management and position tracking stops. Restarting takes time, during which market risk is unmanaged.</p>"},{"location":"rfcs/004_execution_hot_standby/#2-proposed-solution-active-passive-hot-standby","title":"2. Proposed Solution: Active-Passive Hot Standby","text":"<p>We propose running two instances of <code>titan-execution-rs</code>:</p> <ol> <li>Active: Processes orders, manages connections to exchanges, publishes fills.</li> <li>Standby: Subscribes to the same inputs but DOES NOT send orders to exchanges. It maintains local state (Shadow State) in sync with the Active instance via NATS events.</li> </ol>"},{"location":"rfcs/004_execution_hot_standby/#3-architecture","title":"3. Architecture","text":""},{"location":"rfcs/004_execution_hot_standby/#31-startup-configuration","title":"3.1 Startup Configuration","text":"<p>Both instances start with the same configuration but different identity tags (e.g., <code>primary</code> vs <code>backup</code>). A new flag <code>--active-standby</code> or environment variable <code>EXECUTION_MODE=active|standby</code> will be introduced.</p>"},{"location":"rfcs/004_execution_hot_standby/#32-leadership-election-future-scope","title":"3.2 Leadership Election (Future Scope)","text":"<p>Ideally, we use NATS JetStream KeyValue (KV) for leadership election.</p> <ul> <li><code>KV_ELECTION: { key: \"leader\", value: \"&lt;instance_id&gt;\", lease: 5s }</code></li> <li>If leader lease expires, Standby promotes itself to Active.</li> </ul>"},{"location":"rfcs/004_execution_hot_standby/#33-state-synchronization","title":"3.3 State Synchronization","text":"<ul> <li>Inputs: Both subscribe to <code>titan.cmd.execution.place.v1.&gt;</code>.</li> <li>Outputs: only Active publishes to <code>titan.evt.execution.*</code>.</li> <li>Standby Behavior:</li> <li>Ingests <code>titan.cmd.execution.place...</code> (updates internal intent state).</li> <li>Ingests <code>titan.evt.execution.fill...</code> (updates internal position state).</li> <li>If promoted, it already has the latest state.</li> </ul>"},{"location":"rfcs/004_execution_hot_standby/#4-implementation-phase-1-the-flag","title":"4. Implementation Phase 1: The Flag","text":"<p>Add a startup flag/config to control the behavior.</p> <pre><code>struct Config {\n    // ...\n    /// If true, runs in hot-standby mode (no exchange connectivity)\n    pub hot_standby: bool,\n}\n</code></pre>"},{"location":"rfcs/004_execution_hot_standby/#5-risks","title":"5. Risks","text":"<ul> <li>Split Brain: Both think they are active. Mitigation: NATS KV atomic logic.</li> <li>State Drift: Standby misses a fill. Mitigation: Periodic state reconciliation snapshots.</li> </ul>"},{"location":"rfcs/004_execution_hot_standby/#6-action-plan","title":"6. Action Plan","text":"<ol> <li>Add <code>active_standby</code> configuration field to <code>titan-execution-rs</code>.</li> <li>Implement logic to suppress exchange writes when <code>hot_standby</code> is true.</li> <li>Deploy 2nd instance in <code>docker-compose.prod.yml</code>.</li> </ol>"},{"location":"risk/circuit_breakers/","title":"Circuit Breakers &amp; Kill Switches","text":"<p>Status: Canonical Mechanism: State Machine in <code>titan-execution-rs</code></p>"},{"location":"risk/circuit_breakers/#1-risk-states","title":"1. Risk States","text":"<p>The system operates in one of 4 states. Transitions are one-way (downward) during a trading session, requiring operator intervention to reset (upward).</p> State Trigger Effect \ud83d\udfe2 NORMAL Default Full limits apply. \ud83d\udfe1 CAUTIOUS Drawdown &gt; 50% of Limit Position Sizing = 0.5x. \ud83d\udfe0 DEFENSIVE Drawdown &gt; 75% of Limit No New Positions. Reduce Only. \ud83d\udd34 EMERGENCY Max daily loss breached OR <code>HALT</code> Cmd Flatten All. Cancel All."},{"location":"risk/circuit_breakers/#2-triggers","title":"2. Triggers","text":""},{"location":"risk/circuit_breakers/#21-daily-drawdown","title":"2.1 Daily Drawdown","text":"<ul> <li>Monitored by Brain.</li> <li>If Equity drops below <code>StartingEquity - MaxDailyLoss</code>, a <code>CMD.SYS.HALT</code> (<code>titan.cmd.sys.halt.v1</code>) is fired.</li> </ul>"},{"location":"risk/circuit_breakers/#22-truth-collapse-drift","title":"2.2 Truth Collapse (Drift)","text":"<ul> <li>Monitored by Reconciliation Loop.</li> <li>If <code>|LocalPos - RemotePos| &gt; Tolerance</code>, the system enters EMERGENCY.</li> </ul>"},{"location":"risk/circuit_breakers/#23-sentinel-failure","title":"2.3 Sentinel Failure","text":"<ul> <li>If <code>titan-phase3-sentinel</code> stops emitting heartbeats (&gt; 10s), Brain triggers DEFENSIVE.</li> </ul>"},{"location":"risk/circuit_breakers/#3-operator-controls","title":"3. Operator Controls","text":""},{"location":"risk/circuit_breakers/#31-the-big-red-button-halt","title":"3.1 The Big Red Button (HALT)","text":"<p>Manual override to kill the system.</p> <pre><code># Via NATS (from Host)\ndocker exec titan-nats nats pub titan.cmd.sys.halt.v1 '{\"state\":\"HARD_HALT\",\"reason\":\"Manual\",\"timestamp\":12345}'\n</code></pre> <p>Effect:</p> <ul> <li>Cancels all open orders.</li> <li>Closes all positions (Market).</li> <li>Rejects all future commands.</li> </ul>"},{"location":"risk/circuit_breakers/#32-reset-re-arm","title":"3.2 Reset / Re-Arm","text":"<p>To return to <code>NORMAL</code> state, an Operator must sign an Arm command.</p> <pre><code>./scrip../set_trading_mode.sh arm \"Post-incident re-arm\" \"&lt;operator_id&gt;\"\n</code></pre> <p>Prerequisite:</p> <ul> <li>Root cause resolved.</li> <li>Operator manually reviewed logs.</li> </ul>"},{"location":"risk/risk_policy/","title":"Titan Risk Policy","text":"<p>Status: Canonical Source Definitions: <code>packages/shared/risk_policy.json</code> Enforcement: Brain (Strategic) &amp; Execution (Transactional)</p>"},{"location":"risk/risk_policy/#1-the-constitution","title":"1. The Constitution","text":"<p>The Risk Policy is the immutable constitution of the organism. It defines the boundaries that cannot be crossed, regardless of profit potential.</p> <p>Invariant: The Policy Hash (<code>policy_hash</code>) must match between Brain and Execution at handshake. If it differs, the system Halts.</p>"},{"location":"risk/risk_policy/#2-global-limits","title":"2. Global Limits","text":"Parameter Value Meaning Max Account Leverage <code>10.0x</code> Hard cap on total notion / total equity. Max Position Notional <code>$50,000</code> Max size of any single position. Max Daily Loss <code>-$1,000</code> Kill switch trigger level. Max Open Orders <code>5</code> per Symbol. Prevents order spam/runaway. Max Slippage <code>100 bps</code> (1%) Execution bounds for market orders."},{"location":"risk/risk_policy/#3-the-immune-system-layers","title":"3. The \"Immune System\" Layers","text":""},{"location":"risk/risk_policy/#layer-1-strategic-brain","title":"Layer 1: Strategic (Brain)","text":"<ul> <li>Allocation: Brain will not allocate capital to a Phase if the budget is exhausted.</li> <li>Correlation: Brain checks portfolio correlation. If <code>Corr(BTC, ETH) &gt; 0.7</code>, it imposes a <code>correlationPenalty</code> (0.5x sizing).</li> </ul>"},{"location":"risk/risk_policy/#layer-2-transactional-execution-riskguard","title":"Layer 2: Transactional (Execution RiskGuard)","text":"<p>Situated in Rust <code>services/titan-execution-rs/src/risk_guard.rs</code>.</p> <ul> <li>Pre-Flight Check: Every command is simulated against the \"Shadow State\".</li> <li>Rejection: If <code>NewLeverage &gt; MaxLeverage</code>, the command is rejected with <code>RISK_VIOLATION</code>.</li> </ul>"},{"location":"risk/risk_policy/#layer-3-reflexive-circuit-breakers","title":"Layer 3: Reflexive (Circuit Breakers)","text":"<p>See Circuit Breakers.</p>"},{"location":"risk/risk_policy/#4-policy-update-protocol","title":"4. Policy Update Protocol","text":"<p>Changing the policy is a Nuclear Operation.</p> <ol> <li>Edit: Modify <code>packages/shared/risk_policy.json</code> on <code>main</code>.</li> <li>Deploy:</li> <li>Both Brain and Execution must be redeployed.</li> <li>They will compute the new SHA256 hash on boot.</li> <li>Handshake will verify the new hash match.</li> <li>Audit: The change is logged in the <code>config_history</code> table.</li> </ol>"},{"location":"risk/risk_policy/#5-approved-instruments","title":"5. Approved Instruments","text":"<p>Whitelist Only:</p> <ul> <li><code>BTC/USDT</code></li> <li><code>ETH/USDT</code></li> <li><code>SOL/USDT</code></li> </ul> <p>Trading any other symbol results in immediate command rejection.</p>"},{"location":"runbooks/","title":"Runbooks &amp; Procedures","text":"<p>\u2190 Back to Index</p> <p>Panic Button: If you are deploying, see the Production Guide.</p>"},{"location":"runbooks/#incident-response","title":"\ud83d\udea8 Incident Response","text":"<ul> <li>Incident Response Framework \u2014 The meta-guide for all incidents.</li> <li>Kill Switch \u2014 Emergency halt of all trading.</li> <li>Rollback Procedure \u2014 Emergency revert instructions.</li> <li>PowerLaw Modes \u2014 Understanding system operating modes.</li> </ul>"},{"location":"runbooks/#specific-outage-scenarios","title":"\ud83d\udcc9 Specific Outage Scenarios","text":"<ul> <li>Exchange Outage \u2014 When Bybit/Binance goes dark.</li> <li>NATS Outage \u2014 Event bus failure handling.</li> <li>Postgres Outage \u2014 Database recovery.</li> </ul>"},{"location":"runbooks/#guides","title":"\ud83d\udcda Guides","text":"<ul> <li>Production Deployment Guide \u2014 Manual vs CI deployment.</li> <li>Deploy Runbook \u2014 Step-by-step production deploy procedure.</li> <li>Key Rotation \u2014 Secret rotation for DB, HMAC, and exchange keys.</li> <li>Drill Scripts \u2014 Incident drill scripts and report template.</li> </ul>"},{"location":"runbooks/deploy/","title":"Deploy Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>Scope: Production deployment to DigitalOcean <code>titan-prod</code> Target: <code>/opt/titan</code> on droplet</p>"},{"location":"runbooks/deploy/#pre-deploy-checklist","title":"Pre-Deploy Checklist","text":"<ul> <li>[ ] All CI gates green on <code>main</code></li> <li>[ ] No open critical issues</li> <li>[ ] Backup taken: <code>./scripts/ops/backup_db.sh pre_deploy</code></li> <li>[ ] Notify stakeholders</li> </ul>"},{"location":"runbooks/deploy/#procedure","title":"Procedure","text":"<pre><code># 1. SSH to production\nssh deploy@&lt;DROPLET_IP&gt;\n\n# 2. Pull latest\ncd /opt/titan\ngit fetch origin main\ngit checkout main\ngit pull origin main\n\n# 3. Build images\ndocker compose -f docker-compose.prod.yml build --no-cache\n\n# 4. Rolling restart (infra first, then services)\ndocker compose -f docker-compose.prod.yml up -d titan-postgres titan-nats\nsleep 10\n\ndocker compose -f docker-compose.prod.yml up -d titan-execution\nsleep 5\n\ndocker compose -f docker-compose.prod.yml up -d titan-brain\nsleep 5\n\ndocker compose -f docker-compose.prod.yml up -d titan-scavenger titan-sentinel\n\n# 5. Verify health\ncurl -s localhost:3100/health | jq .status\ncurl -s localhost:8081/health | jq .status\ncurl -s localhost:8084/health | jq .status\ncurl -s localhost:3002/health | jq .status\ndocker exec titan-nats nats stream ls\n</code></pre>"},{"location":"runbooks/deploy/#post-deploy-verification","title":"Post-Deploy Verification","text":"<pre><code># Check all containers running\ndocker compose -f docker-compose.prod.yml ps\n\n# Verify no error spikes in last 5 minutes\ndocker compose -f docker-compose.prod.yml logs --since 5m 2&gt;&amp;1 | grep -i error | wc -l\n\n# Check metrics endpoint responds\ncurl -s localhost:3100/metrics | head -5\n</code></pre>"},{"location":"runbooks/deploy/#rollback-trigger","title":"Rollback Trigger","text":"<p>If any health check returns <code>unhealthy</code> within 5 minutes, execute rollback.md.</p>"},{"location":"runbooks/drill_scripts/","title":"Incident Drill Scripts","text":"<p>\u2190 Back to Runbooks</p> <p>Prerequisites: Running docker-compose stack with all services healthy</p>"},{"location":"runbooks/drill_scripts/#drill-1-exchange-disconnect-storm","title":"Drill 1: Exchange Disconnect Storm","text":"<p>Purpose: Verify system behavior when all exchange WebSocket connections drop simultaneously. Runbook: exchange_outage.md</p> <pre><code>#!/bin/bash\n# drill_exchange_disconnect.sh\nset -euo pipefail\nTIMESTAMP=$(date -u +%Y%m%dT%H%M%SZ)\nLOG=\"drill_exchange_disconnect_${TIMESTAMP}.log\"\n\necho \"=== DRILL: Exchange Disconnect Storm ===\" | tee \"$LOG\"\n\n# 1. Capture baseline health\ncurl -s localhost:8081/health | tee -a \"$LOG\"\ncurl -s localhost:8084/health | tee -a \"$LOG\"\n\n# 2. Simulate: Docker network disconnect\ndocker network disconnect titan_default titan-scavenger 2&gt;/dev/null || true\ndocker network disconnect titan_default titan-sentinel 2&gt;/dev/null || true\nsleep 10\n\n# 3. Verify brain detects degradation\ncurl -s localhost:3100/health | jq '.components' | tee -a \"$LOG\"\n\n# 4. Verify NO new orders placed\ndocker compose -f docker-compose.prod.yml logs --since 15s titan-execution 2&gt;&amp;1 | grep -i \"fill\\|order\" | tee -a \"$LOG\" || echo \"No fills (expected)\" | tee -a \"$LOG\"\n\n# 5. Reconnect\ndocker network connect titan_default titan-scavenger 2&gt;/dev/null || true\ndocker network connect titan_default titan-sentinel 2&gt;/dev/null || true\nsleep 15\n\n# 6. Verify recovery\ncurl -s localhost:8081/health | tee -a \"$LOG\"\ncurl -s localhost:3100/health | jq '.status' | tee -a \"$LOG\"\necho \"=== DRILL COMPLETE ===\" | tee -a \"$LOG\"\n</code></pre>"},{"location":"runbooks/drill_scripts/#drill-2-nats-interruption","title":"Drill 2: NATS Interruption","text":"<p>Purpose: Verify brain/execution survive NATS restart with no message loss (JetStream replay). Runbook: nats_outage.md</p> <pre><code>#!/bin/bash\n# drill_nats_interruption.sh\nset -euo pipefail\nTIMESTAMP=$(date -u +%Y%m%dT%H%M%SZ)\nLOG=\"drill_nats_interruption_${TIMESTAMP}.log\"\n\necho \"=== DRILL: NATS Interruption ===\" | tee \"$LOG\"\n\n# 1. Baseline\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"nats\")' | tee -a \"$LOG\"\ncurl -s localhost:3002/metrics | grep nats_lag | tee -a \"$LOG\"\n\n# 2. Kill NATS\ndocker stop titan-nats | tee -a \"$LOG\"\nsleep 5\n\n# 3. Verify services are still alive (not crashed)\ndocker ps --format '{{.Names}} {{.Status}}' | grep titan | tee -a \"$LOG\"\n\n# 4. Restart NATS\ndocker start titan-nats | tee -a \"$LOG\"\nsleep 15\n\n# 5. Verify reconnection\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"nats\")' | tee -a \"$LOG\"\ncurl -s localhost:3002/metrics | grep nats_lag | tee -a \"$LOG\"\necho \"=== DRILL COMPLETE ===\" | tee -a \"$LOG\"\n</code></pre>"},{"location":"runbooks/drill_scripts/#drill-3-database-restart","title":"Drill 3: Database Restart","text":"<p>Purpose: Verify brain handles Postgres restart gracefully and resumes operations.</p> <pre><code>#!/bin/bash\n# drill_database_restart.sh\nset -euo pipefail\nTIMESTAMP=$(date -u +%Y%m%dT%H%M%SZ)\nLOG=\"drill_database_restart_${TIMESTAMP}.log\"\n\necho \"=== DRILL: Database Restart ===\" | tee \"$LOG\"\n\n# 1. Baseline\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"database\")' | tee -a \"$LOG\"\n\n# 2. Restart Postgres\ndocker restart titan-postgres | tee -a \"$LOG\"\nsleep 5\n\n# 3. Brain health during restart\ncurl -s localhost:3100/health | jq '.status' | tee -a \"$LOG\"\n\n# 4. Wait for Postgres ready\nfor i in $(seq 1 12); do\n  docker exec titan-postgres pg_isready 2&gt;/dev/null &amp;&amp; break || sleep 5\ndone\n\n# 5. Verify brain reconnects\nsleep 10\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"database\")' | tee -a \"$LOG\"\necho \"=== DRILL COMPLETE ===\" | tee -a \"$LOG\"\n</code></pre>"},{"location":"runbooks/drill_scripts/#drill-4-kill-switch","title":"Drill 4: Kill Switch","text":"<p>Purpose: Prove that all trading halts immediately and recovers cleanly. Runbook: kill_switch.md</p> <pre><code>#!/bin/bash\n# drill_kill_switch.sh\nset -euo pipefail\nTIMESTAMP=$(date -u +%Y%m%dT%H%M%SZ)\nLOG=\"drill_kill_switch_${TIMESTAMP}.log\"\n\necho \"=== DRILL: Kill Switch ===\" | tee \"$LOG\"\n\n# 1. Baseline\ncurl -s localhost:3100/health | tee -a \"$LOG\"\ncurl -s localhost:3002/metrics | grep \"filled_orders_total\\|active_positions\" | tee -a \"$LOG\"\n\n# 2. Kill signal producers\ndocker compose -f docker-compose.prod.yml stop titan-scavenger titan-sentinel\nsleep 10\n\n# 3. Verify no new intents\ndocker compose -f docker-compose.prod.yml logs --since 15s titan-execution 2&gt;&amp;1 | grep -ic \"intent\\|fill\" | tee -a \"$LOG\" || echo \"0\" | tee -a \"$LOG\"\n\n# 4. Recovery\ndocker compose -f docker-compose.prod.yml up -d titan-scavenger titan-sentinel\nsleep 15\n\n# 5. Verify full recovery\ncurl -s localhost:8081/health | jq '.status' | tee -a \"$LOG\"\ncurl -s localhost:3100/health | jq '.status' | tee -a \"$LOG\"\necho \"=== DRILL COMPLETE ===\" | tee -a \"$LOG\"\n</code></pre>"},{"location":"runbooks/drill_scripts/#drill-report-template","title":"Drill Report Template","text":"<pre><code># Drill Report: [Drill Name]\n\n**Date**: YYYY-MM-DD HH:MM UTC\n**Operator**: [Name]\n**Environment**: [staging / prod]\n\n## Result: PASS / FAIL / PARTIAL\n\n## Timeline\n| Time (UTC) | Event |\n|:-----------|:------|\n| HH:MM:SS | Drill started |\n| HH:MM:SS | [Action taken] |\n| HH:MM:SS | Drill completed |\n\n## Evidence\n- Log file: `drill_*_TIMESTAMP.log`\n- Health snapshots: [paste or attach JSON]\n\n## Findings\n- [What worked]\n- [What didn't work]\n\n## Action Items\n- [ ] [Fix needed]\n</code></pre>"},{"location":"runbooks/exchange_outage/","title":"Exchange Outage Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>Services affected: titan-scavenger, titan-sentinel, titan-hunter Severity: Critical (no market data = flying blind)</p>"},{"location":"runbooks/exchange_outage/#detection","title":"Detection","text":"<ul> <li>Alert: <code>MarketDataStale</code> (no tick &gt; 5s) \u2014 severity critical</li> <li>Health: <code>GET :8081/health</code> \u2192 <code>connections.binance: \"disconnected\"</code></li> <li>Health: <code>GET :8084/health</code> \u2192 <code>dependencies.binance: \"disconnected\"</code></li> <li>Metric: <code>titan_scavenger_binance_connected == 0</code></li> </ul>"},{"location":"runbooks/exchange_outage/#immediate-actions-2-minutes","title":"Immediate Actions (&lt; 2 minutes)","text":"<pre><code># 1. Confirm which exchanges are affected\ncurl -s localhost:8081/health | jq '.connections'\ncurl -s localhost:8084/health | jq '.dependencies'\n\n# 2. Check exchange status externally\n# Binance: https://www.binance.com/en/support/announcement\n# Bybit: https://announcements.bybit.com/\n\n# 3. Check if it's our side (network/credentials)\ndocker compose -f docker-compose.prod.yml logs --since 2m titan-scavenger 2&gt;&amp;1 | grep -i \"websocket\\|disconnect\\|error\"\ndocker compose -f docker-compose.prod.yml logs --since 2m titan-sentinel 2&gt;&amp;1 | grep -i \"websocket\\|disconnect\\|error\"\n</code></pre>"},{"location":"runbooks/exchange_outage/#if-exchange-side-outage","title":"If Exchange-Side Outage","text":"<ol> <li>Services should auto-reconnect when exchange recovers</li> <li>Monitor <code>titan_scavenger_binance_connected</code> gauge for recovery</li> <li>Verify no stale positions: open positions should be frozen (no new signals)</li> <li>Do NOT restart services \u2014 reconnect logic handles this</li> </ol>"},{"location":"runbooks/exchange_outage/#if-credentialnetwork-issue","title":"If Credential/Network Issue","text":"<pre><code># Rotate API keys if compromised\n# 1. Generate new keys on exchange\n# 2. Update .env.prod\n# 3. Restart affected services\ndocker compose -f docker-compose.prod.yml restart titan-scavenger titan-sentinel\n</code></pre>"},{"location":"runbooks/exchange_outage/#recovery-verification","title":"Recovery Verification","text":"<pre><code>curl -s localhost:8081/health | jq '.status'\n# Expect: \"healthy\"\n# Verify tick flow resumed:\ncurl -s localhost:8081/metrics 2&gt;/dev/null | grep \"binance_ticks_total\"\n</code></pre>"},{"location":"runbooks/exchange_outage/#escalation","title":"Escalation","text":"<ul> <li>If recovery fails after 15 minutes, escalate to on-call lead</li> </ul>"},{"location":"runbooks/incident_response/","title":"Incident Response Protocol","text":"<p>\u2190 Back to Runbooks</p> <p>Status: Canonical Policy: Stop the Line</p>"},{"location":"runbooks/incident_response/#1-severity-levels","title":"1. Severity Levels","text":"Level Definition Response Time Example SEV-1 (CRITICAL) Capital at risk. Trading Halted. Immediate Exchange API disconnect while in position; Truth Drift; Host compromise. SEV-2 (HIGH) Core function degraded. Trading Paused. &lt; 15 mins History sync failing; Strategy latency spiking. SEV-3 (LOW) Non-critical bug. Trading continues. Next day UI glitch; Logging noise."},{"location":"runbooks/incident_response/#2-response-procedures","title":"2. Response Procedures","text":""},{"location":"runbooks/incident_response/#21-the-kill-switch-sev-1","title":"2.1 The Kill Switch (SEV-1)","text":"<p>[!IMPORTANT] When to use: Market anomaly, runaway algo, potential compromise, or unverified behavior. \"Better safe than sorry.\"</p> <p>Procedure:</p> <ol> <li> <p>Execute Halt (System-Wide):     Publish the system halt command via NATS CLI.</p> <pre><code>nats pub \"titan.cmd.sys.halt.v1\" '{\"reason\": \"MANUAL_INTERVENTION\", \"operator\": \"human\"}'\n</code></pre> </li> <li> <p>Verify Halt:</p> <ul> <li>Console: Check header is RED (System Halted).</li> <li>Logs: Verify <code>titan-execution</code> logs show: <code>Order Rejected: System Halted</code>.</li> </ul> <pre><code>docker logs titan-execution-rs --tail 50 | grep \"System Halted\"\n</code></pre> </li> <li> <p>Flatten Positions (Optional):     &gt; [!WARNING]     &gt; Only execute if market conditions allow liquidating all positions.</p> <pre><code>nats pub \"titan.cmd.risk.flatten\" '{\"symbol\": \"ALL\", \"reason\": \"EMERGENCY_FLATTEN\"}'\n</code></pre> </li> <li> <p>Isolate Input:     Stop strategy services to prevent new signal generation.</p> <pre><code>docker compose stop titan-phase1-scavenger titan-phase2-hunter titan-phase3-sentinel\n</code></pre> </li> </ol>"},{"location":"runbooks/incident_response/#22-data-corruption-state-recovery","title":"2.2 Data Corruption / State Recovery","text":"<p>When to use: <code>ShadowState</code> mismatch, duplicate fills, or invalid sequence numbers.</p> <ol> <li>Halt System (See Step 2.1).</li> <li> <p>Snapshot Truth (DB):</p> <pre><code>pg_dump -U postgres -h localhost -d titan_prod &gt; dump_$(date +%s).sql\n</code></pre> </li> <li> <p>Reset Execution State:     If JetStream state is corrupt, delete the consumer to force a replay or fresh start.</p> <pre><code># Delete the persistent consumer\nnats consumer delete TITAN_EXECUTION execution_group\n</code></pre> </li> <li> <p>Restart Execution Service:</p> <pre><code>docker compose restart titan-execution-rs\n</code></pre> </li> <li> <p>Re-Verify State:</p> <ul> <li>Compare <code>titan-console</code> positions with Exchange GUI.</li> <li>If mismatch persists, manually align DB state to Exchange truth.</li> </ul> </li> </ol>"},{"location":"runbooks/incident_response/#23-security-breach-unsignedinvalid-commands","title":"2.3 Security Breach (Unsigned/Invalid Commands)","text":"<p>When to use: Alert <code>Security: Unsigned Command Detected</code> or <code>HMAC Verification Failed</code>.</p> <ol> <li>Rotate Secrets Immediately:<ul> <li>Generate new <code>HMAC_SECRET</code>.</li> <li>Update <code>.env.prod</code> (or Vault).</li> </ul> </li> <li> <p>Rolling Restart:</p> <pre><code>docker compose restart titan-brain titan-execution-rs\n</code></pre> </li> <li> <p>Forensics:</p> <ul> <li>Isolate logs for the actor ID.</li> <li>Revoke Exchange API keys if compromise is suspected.</li> </ul> </li> </ol>"},{"location":"runbooks/incident_response/#3-maintenance-procedures","title":"3. Maintenance Procedures","text":""},{"location":"runbooks/incident_response/#a-deployment-rollback","title":"A. Deployment Rollback","text":"<p>When to use: New deployment fails health check or verification.</p> <ol> <li> <p>Check Last Good State:</p> <pre><code>cat /opt/titan/state/last_known_good.json\n</code></pre> </li> <li> <p>Execute Rollback Script:</p> <pre><code>/opt/titan/scripts/rollback.sh\n</code></pre> </li> <li> <p>Verify:</p> <pre><code>/opt/titan/scripts/verify.sh\n</code></pre> </li> </ol>"},{"location":"runbooks/incident_response/#b-database-migration-failure","title":"B. Database Migration Failure","text":"<p>When to use: <code>sota:db</code> fails in prod.</p> <ol> <li> <p>Rollback Migration:</p> <pre><code>npm run db:down\n</code></pre> </li> <li> <p>Restore Backup (if data loss occurred):     Use the most recent <code>dump_*.sql</code>.</p> </li> </ol>"},{"location":"runbooks/incident_response/#4-post-incident","title":"4. Post-Incident","text":"<p>Every SEV-1 and SEV-2 requires a Post-Mortem within 24 hours.</p>"},{"location":"runbooks/incident_response/#post-mortem-template","title":"Post-Mortem Template","text":"<ul> <li>Summary: What happened?</li> <li>Timeline: Detection -&gt; Mitigation -&gt; Resolution.</li> <li>Root Cause: The technical \"Why\".</li> <li>Corrective Actions: (Jira tickets).</li> <li>[ ] Fix the bug.</li> <li>[ ] Add the test case (Regression prevention).</li> <li>[ ] Update documentation.</li> </ul>"},{"location":"runbooks/key_rotation/","title":"Key Rotation Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>Scope: Rotate secrets without service interruption (where possible) Secrets: DB password, HMAC secret, exchange API keys</p>"},{"location":"runbooks/key_rotation/#1-database-password-rotation","title":"1. Database Password Rotation","text":"<p>Impact: Brief brain/execution downtime during restart.</p> <pre><code># 1. Stop consumers\ndocker compose -f docker-compose.prod.yml stop titan-brain titan-execution\n\n# 2. Update password in Postgres\ndocker exec -it titan-postgres psql -U titan -d titan_brain -c \\\n  \"ALTER USER titan WITH PASSWORD '&lt;NEW_PASSWORD&gt;';\"\n\n# 3. Update .env.prod\nsed -i 's/TITAN_DB_PASSWORD=.*/TITAN_DB_PASSWORD=&lt;NEW_PASSWORD&gt;/' .env.prod\n\n# 4. Restart consumers\ndocker compose -f docker-compose.prod.yml up -d titan-brain titan-execution\n\n# 5. Verify\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"database\")'\n</code></pre>"},{"location":"runbooks/key_rotation/#2-hmac-secret-rotation-critical","title":"2. HMAC Secret Rotation (Critical)","text":"<p>Impact: Invalidates ALL in-flight HMAC signatures. Requires atomic restart of brain + execution.</p> <pre><code># 1. Generate new secret\nNEW_HMAC=$(openssl rand -hex 32)\necho \"New HMAC: $NEW_HMAC\"\n\n# 2. Update .env.prod\nsed -i \"s/HMAC_SECRET=.*/HMAC_SECRET=$NEW_HMAC/\" .env.prod\n\n# 3. Atomic restart (both must restart simultaneously)\ndocker compose -f docker-compose.prod.yml up -d --force-recreate titan-brain titan-execution\n\n# 4. Verify NATS communication restored\ndocker compose -f docker-compose.prod.yml logs --since 30s titan-brain 2&gt;&amp;1 | grep -i \"hmac\\|signature\\|auth\"\n</code></pre>"},{"location":"runbooks/key_rotation/#3-exchange-api-key-rotation","title":"3. Exchange API Key Rotation","text":"<p>Impact: Temporary loss of trading capability on rotated exchange.</p> <pre><code># 1. Generate new keys on exchange (Binance/Bybit web console)\n# 2. Update .env.prod with new keys\n# 3. Restart market data consumers\ndocker compose -f docker-compose.prod.yml restart titan-scavenger titan-sentinel\n\n# 4. Verify connectivity\ncurl -s localhost:8081/health | jq '.connections.binance'\n</code></pre>"},{"location":"runbooks/key_rotation/#post-rotation-checklist","title":"Post-Rotation Checklist","text":"<ul> <li>[ ] Verify all health endpoints return <code>healthy</code></li> <li>[ ] Verify metrics scrape is working (<code>curl localhost:3100/metrics | head</code>)</li> <li>[ ] Verify no HMAC errors in logs for 5 minutes</li> <li>[ ] Old secrets have been securely deleted (not in shell history)</li> </ul>"},{"location":"runbooks/kill_switch/","title":"Kill Switch Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>Scope: Emergency halt of all trading activity When: Runaway losses, system compromise, or regulatory event</p>"},{"location":"runbooks/kill_switch/#current-state","title":"Current State","text":"<p>[!CAUTION] No dedicated kill-switch endpoint or metric exists in code. The circuit breaker in <code>titan-execution-rs</code> (<code>circuit_breaker_active</code> gauge) is the closest mechanism. The Sentinel has a <code>DEFENSIVE</code> / <code>EMERGENCY</code> mode, but no single-endpoint kill.</p>"},{"location":"runbooks/kill_switch/#emergency-stop-procedure-manual","title":"Emergency Stop Procedure (Manual)","text":"<pre><code># === OPTION A: Stop All Services (Nuclear) ===\n# Time: ~10 seconds. All positions remain open on exchange.\ndocker compose -f docker-compose.prod.yml stop titan-brain titan-execution titan-scavenger titan-sentinel\n\n# === OPTION B: Stop Signal Flow Only ===\n# Stops new signals but keeps position management alive.\ndocker compose -f docker-compose.prod.yml stop titan-scavenger titan-sentinel\n# Brain and execution stay up to manage existing positions.\n\n# === OPTION C: Trigger Circuit Breaker via Brain ===\n# If Brain HTTP API is available:\n# This depends on whether TitanBrain exposes a circuit breaker trigger endpoint.\n# Currently: circuit_breaker_active gauge exists but no HTTP trigger found.\n</code></pre>"},{"location":"runbooks/kill_switch/#post-kill-verification","title":"Post-Kill Verification","text":"<pre><code># Confirm no new orders being placed\ndocker compose -f docker-compose.prod.yml logs --since 1m titan-execution 2&gt;&amp;1 | grep -i \"fill\\|order\\|intent\"\n# Expect: NO new fills\n\n# Check position state\ncurl -s localhost:3100/health | jq '.components'\n\n# Check exchange directly for open positions\n# (Manual via Binance/Bybit web console)\n</code></pre>"},{"location":"runbooks/kill_switch/#recovery-from-kill","title":"Recovery From Kill","text":"<pre><code># 1. Confirm root cause is resolved\n# 2. Verify DB state is consistent\ndocker exec titan-postgres pg_isready\ncurl -s localhost:3100/health | jq .\n\n# 3. Restart in safe order\ndocker compose -f docker-compose.prod.yml up -d titan-brain\nsleep 10\ndocker compose -f docker-compose.prod.yml up -d titan-execution\nsleep 5\ndocker compose -f docker-compose.prod.yml up -d titan-scavenger titan-sentinel\n\n# 4. Verify health\ncurl -s localhost:3100/health | jq .status\n</code></pre>"},{"location":"runbooks/kill_switch/#required-implementation-gap","title":"Required Implementation (Gap)","text":"<p>To make this a proper kill switch, we need: 1. <code>POST /api/kill-switch</code> endpoint on Brain that sets <code>circuit_breaker_active = 1</code> and halts all signal processing 2. <code>titan_brain_kill_switch_active</code> gauge metric 3. Persistent state (survives restart) \u2014 store kill state in DB 4. Dashboard panel showing kill-switch state</p>"},{"location":"runbooks/nats_outage/","title":"NATS Partition Recovery Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>Scope: NATS JetStream partition, split-brain, or message loss recovery Critical: Brain and Execution communicate exclusively via NATS</p>"},{"location":"runbooks/nats_outage/#detection","title":"Detection","text":"<ul> <li>Health: <code>GET :3100/health</code> \u2192 NATS component <code>unhealthy</code></li> <li>Metric: <code>nats_lag_messages</code> spike</li> <li>Metric: <code>nats_storage_pressure_bytes</code> near limit</li> <li>Logs: <code>\"connection refused\"</code>, <code>\"timeout\"</code>, <code>\"no responders\"</code> in brain/execution</li> </ul>"},{"location":"runbooks/nats_outage/#immediate-actions","title":"Immediate Actions","text":"<pre><code># 1. Check NATS container\ndocker ps | grep nats\ndocker logs titan-nats --tail 50\n\n# 2. Check NATS cluster health\ncurl -s http://localhost:8222/healthz | jq .\ndocker exec titan-nats nats stream ls\ndocker exec titan-nats nats stream info TITAN_INTENTS 2&gt;/dev/null\ndocker exec titan-nats nats consumer ls TITAN_INTENTS 2&gt;/dev/null\n\n# 3. Check consumer lag\ndocker exec titan-nats nats consumer info TITAN_INTENTS execution-consumer 2&gt;/dev/null\n</code></pre>"},{"location":"runbooks/nats_outage/#if-nats-container-down","title":"If NATS Container Down","text":"<pre><code># 1. Restart NATS (data persisted in JetStream volumes)\ndocker compose -f docker-compose.prod.yml restart titan-nats\n\n# 2. Wait for reconnection (services have retry logic)\nsleep 15\n\n# 3. Verify all services reconnected\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"nats\")'\ncurl -s localhost:8081/health | jq '.connections'\n</code></pre>"},{"location":"runbooks/nats_outage/#if-stream-corrupted","title":"If Stream Corrupted","text":"<pre><code># 1. Stop producers/consumers\ndocker compose -f docker-compose.prod.yml stop titan-brain titan-execution titan-scavenger titan-sentinel\n\n# 2. Purge and recreate stream\ndocker exec titan-nats nats stream purge TITAN_INTENTS --force\n\n# 3. Restart all services (they will re-establish from current state)\ndocker compose -f docker-compose.prod.yml up -d\n\n# 4. Verify stream is operational\ndocker exec titan-nats nats stream ls\n</code></pre>"},{"location":"runbooks/nats_outage/#if-storage-pressure","title":"If Storage Pressure","text":"<pre><code># Check storage usage\ndocker exec titan-nats nats stream info TITAN_INTENTS | grep -i \"storage\\|bytes\\|messages\"\n\n# If at limit, purge old messages\ndocker exec titan-nats nats stream purge TITAN_INTENTS --keep 1000 --force\n</code></pre>"},{"location":"runbooks/nats_outage/#recovery-verification","title":"Recovery Verification","text":"<pre><code># Verify NATS metrics are flowing\ncurl -s localhost:3002/metrics | grep nats_lag\ncurl -s localhost:3100/health | jq '.components[] | select(.name==\"nats\")'\n# Expect: status = \"healthy\"\n</code></pre>"},{"location":"runbooks/nats_outage/#escalation","title":"Escalation","text":"<ul> <li>If recovery fails after 15 minutes, escalate to on-call lead</li> </ul>"},{"location":"runbooks/postgres_outage/","title":"Postgres Outage Runbook","text":"<p>\u2190 Back to Runbooks</p>"},{"location":"runbooks/postgres_outage/#symptoms","title":"Symptoms","text":"<ul> <li>Services fail to query/write to database</li> <li>Health checks fail on DB connectivity</li> <li>Logs show \"connection refused\" or \"too many connections\"</li> </ul>"},{"location":"runbooks/postgres_outage/#immediate-actions","title":"Immediate Actions","text":"<ol> <li>Check Postgres container: <code>docker ps | grep postgres</code></li> <li>Check Postgres logs: <code>docker logs titan-postgres --tail 100</code></li> <li>Verify connections: <code>docker exec titan-postgres psql -U postgres -c \"SELECT count(*) FROM pg_stat_activity;\"</code></li> </ol>"},{"location":"runbooks/postgres_outage/#recovery","title":"Recovery","text":"<ol> <li>Restart Postgres: <code>docker restart titan-postgres</code></li> <li>If connection exhaustion, kill idle connections</li> <li>If data corruption suspected, restore from backup (see restore_drill)</li> </ol>"},{"location":"runbooks/postgres_outage/#escalation","title":"Escalation","text":"<ul> <li>Data loss suspected: Immediately escalate to on-call lead</li> </ul>"},{"location":"runbooks/powerlaw-modes/","title":"PowerLaw Mode Runbooks","text":"<p>\u2190 Back to Runbooks</p> <p>Operational procedures for Titan's Power Law tail-risk system.</p>"},{"location":"runbooks/powerlaw-modes/#mode-overview","title":"Mode Overview","text":"Mode Constraints Published Brain Impact Execution Engine SHADOW Yes (no effect) Logs only No enforcement ADVISORY Yes (alerts) Alerts to console Soft limits, warnings ENFORCEMENT Yes (enforced) Active alerts Hard limits, blocks trades"},{"location":"runbooks/powerlaw-modes/#shadow-mode","title":"SHADOW Mode","text":"<p>Purpose: Observe PowerLaw metrics without affecting trading.</p>"},{"location":"runbooks/powerlaw-modes/#activation","title":"Activation","text":"<pre><code># Via environment\nPOWERLAW_MODE=shadow\n\n# Via Brain API\ncurl -X POST http://brain:8080/api/powerlaw/mode \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"mode\": \"SHADOW\"}'\n</code></pre>"},{"location":"runbooks/powerlaw-modes/#monitoring","title":"Monitoring","text":"<ul> <li>Check metrics at <code>/metrics</code> endpoint</li> <li>Watch <code>titan_powerlaw_tail_alpha</code> gauge</li> <li>Review logs for constraint computation</li> </ul>"},{"location":"runbooks/powerlaw-modes/#expected-behavior","title":"Expected Behavior","text":"<ul> <li>Constraints published to NATS</li> <li>No trading impact</li> <li>Console shows real-time metrics</li> <li>Execution engine ignores constraints</li> </ul>"},{"location":"runbooks/powerlaw-modes/#advisory-mode","title":"ADVISORY Mode","text":"<p>Purpose: Alert operators to tail-risk conditions without blocking trades.</p>"},{"location":"runbooks/powerlaw-modes/#activation_1","title":"Activation","text":"<pre><code>POWERLAW_MODE=advisory\n</code></pre>"},{"location":"runbooks/powerlaw-modes/#monitoring_1","title":"Monitoring","text":"<ul> <li>Console alerts for high-risk conditions</li> <li>Prometheus alerting on <code>health_status &lt; 1</code></li> <li>Impact events in <code>titan.evt.powerlaw.impact.v1</code></li> </ul>"},{"location":"runbooks/powerlaw-modes/#expected-behavior_1","title":"Expected Behavior","text":"<ul> <li>Soft constraints computed</li> <li>Warnings in execution engine logs</li> <li>Orders not blocked (logged only)</li> <li>Impact events record decisions</li> </ul>"},{"location":"runbooks/powerlaw-modes/#enforcement-mode","title":"ENFORCEMENT Mode","text":"<p>Purpose: Actively enforce tail-risk constraints on order flow.</p>"},{"location":"runbooks/powerlaw-modes/#activation_2","title":"Activation","text":"<pre><code>POWERLAW_MODE=enforcement\n</code></pre>"},{"location":"runbooks/powerlaw-modes/#pre-flight-checks","title":"Pre-Flight Checks","text":"<ol> <li>Verify metrics computation is stable (\u03b1 in expected range)</li> <li>Confirm TTL settings (<code>ttl_ms</code> default: 120000)</li> <li>Check execution engine constraint store is receiving updates</li> <li>Review recent impact events for expected patterns</li> </ol>"},{"location":"runbooks/powerlaw-modes/#monitoring_2","title":"Monitoring","text":"<ul> <li><code>titan_powerlaw_constraints_published_total</code> counter</li> <li>Execution engine logs for blocked/modified orders</li> <li>Console shows active constraints per symbol</li> </ul>"},{"location":"runbooks/powerlaw-modes/#expected-behavior_2","title":"Expected Behavior","text":"<ul> <li>Hard constraints enforced</li> <li>Orders exceeding limits rejected</li> <li><code>reduce_only</code> blocks new positions when triggered</li> <li>Impact events log all enforcement actions</li> </ul>"},{"location":"runbooks/powerlaw-modes/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"runbooks/powerlaw-modes/#disable-powerlaw-enforcement","title":"Disable PowerLaw Enforcement","text":"<pre><code># Immediate disable via env\nPOWERLAW_MODE=shadow\n\n# Or via API\ncurl -X POST http://brain:8080/api/powerlaw/mode \\\n  -d '{\"mode\": \"SHADOW\"}'\n</code></pre>"},{"location":"runbooks/powerlaw-modes/#stale-constraints","title":"Stale Constraints","text":"<p>If constraints become stale (<code>ttl_ms</code> expired):</p> <ul> <li>Execution engine falls back to defensive defaults</li> <li><code>reduce_only: true</code> activated</li> <li>Max notional reduced to <code>100_000</code></li> </ul>"},{"location":"runbooks/powerlaw-modes/#metric-health-degradation","title":"Metric Health Degradation","text":"Status Action <code>ok</code> Normal operation <code>stale</code> Investigate data pipeline <code>low_sample</code> Check market data feed <code>fit_failed</code> Review estimator logs"},{"location":"runbooks/powerlaw-modes/#grafana-dashboard-queries","title":"Grafana Dashboard Queries","text":"<pre><code># Tail Alpha per Symbol\ntitan_powerlaw_tail_alpha{venue=\"binance\"}\n\n# Health Status Distribution\ncount by (status) (titan_powerlaw_health_status)\n\n# Constraints Published Rate\nrate(titan_powerlaw_constraints_published_total[5m])\n\n# Computation Latency\nhistogram_quantile(0.95, titan_powerlaw_computation_duration_ms_bucket)\n</code></pre>"},{"location":"runbooks/production_guide/","title":"Titan Production Runbook","text":"<p>\u2190 Back to Index</p>"},{"location":"runbooks/production_guide/#cicd-deployment-failure","title":"CI/CD Deployment Failure","text":"<p>If a deployment fails, the pipeline will mark the job as failed. <code>scripts/ci/deploy.sh</code> will initiate an automatic rollback.</p>"},{"location":"runbooks/production_guide/#to-investigate","title":"To Investigate","text":"<ol> <li>Check GitHub Actions run logs.</li> <li>SSH into droplet: <code>ssh titan-deploy@&lt;IP&gt;</code></li> <li>Check deployment logs: <code>/opt/titan/logs/deploy.log</code> and <code>deploy-&lt;timestamp&gt;.log</code>.</li> <li>Check container logs: <code>docker compose logs --tail=100</code></li> </ol>"},{"location":"runbooks/production_guide/#common-causes","title":"Common Causes","text":"<ol> <li>Migration Failure: Database migration failed. Check <code>titan-brain</code> logs. Migrations tracked in <code>_titan_migrations</code> table \u2014 check for SHA256 drift (changed file after apply). Re-run: <code>./scripts/ops/run_migrations.sh</code>.</li> <li>Health Verification: Services didn't start in time. Check <code>docker compose ps</code> and <code>titan-brain</code> health.</li> <li>Policy Hash Parity: Brain and Execution policy mismatch. Check logs for \"Policy hash handshake\".</li> </ol>"},{"location":"runbooks/production_guide/#manual-deployment","title":"Manual Deployment","text":"<p>To trigger a deployment manually (bypass CI or run a specific SHA):</p> <ol> <li> <p>SSH into droplet.</p> <pre><code>ssh titan-deploy@&lt;IP&gt;\n</code></pre> </li> <li> <p>Navigate to titan root.</p> <pre><code>cd /opt/titan\n</code></pre> </li> <li> <p>Identify the SHA you want to deploy (or <code>latest</code>).</p> <ul> <li>Ideally, use CI artifacts.</li> <li>If you must pull fresh: Ensure <code>.env.prod</code> is valid.</li> </ul> </li> <li> <p>Run deployment script (if you have the artifact package locally):</p> <pre><code># This requires the deployment package structure (scripts, compose, evidence)\n# usually downloaded from GH Actions artifacts.\n# To re-deploy CURRENT installed scripts:\n/opt/titan/scripts/deploy.sh &lt;SHA&gt;\n</code></pre> </li> </ol>"},{"location":"runbooks/production_guide/#manual-rollback","title":"Manual Rollback","text":"<p>If automatic rollback failed or you need to revert to a specific version manually:</p> <ol> <li>SSH into droplet.</li> <li> <p>List releases:</p> <pre><code>ls -l /opt/titan/releases/\n</code></pre> </li> <li> <p>Identify the target release directory (e.g., <code>20240101-abcdef</code>).</p> </li> <li> <p>Run rollback script:</p> <pre><code>/opt/titan/scripts/rollback.sh\n</code></pre> <ul> <li> <p>Or manually:</p> <pre><code>ln -sfn /opt/titan/releases/&lt;target-dir&gt; /opt/titan/current\ncd /opt/titan/current\ndocker compose up -d --remove-orphans\n</code></pre> </li> </ul> </li> </ol>"},{"location":"runbooks/production_guide/#rotating-secrets","title":"Rotating Secrets","text":"<ol> <li> <p>Edit the master secrets file:</p> <pre><code>nano /opt/titan/compose/.env.prod\n</code></pre> </li> <li> <p>Restart containers to pick up changes:</p> <pre><code>cd /opt/titan/current\ndocker compose up -d\n</code></pre> </li> </ol>"},{"location":"runbooks/production_guide/#registry-credentials","title":"Registry Credentials","text":"<p>Registry credentials (GHCR) are stored in <code>~/.docker/config.json</code> for the <code>titan-deploy</code> user. To rotate:</p> <ol> <li>Generate new PAT (Personal Access Token) with <code>read:packages</code> scope.</li> <li> <p>On droplet:</p> <pre><code>docker login ghcr.io -u &lt;USERNAME&gt; -p &lt;NEW_TOKEN&gt;\n</code></pre> </li> </ol>"},{"location":"runbooks/production_guide/#evidence-logs","title":"Evidence Logs","text":"<p>Deployment evidence is stored in:</p> <ol> <li><code>/opt/titan/releases/&lt;id&gt;/evidence/</code> (digests.json)</li> <li><code>/opt/titan/logs/deploy.log</code> (Global log)</li> <li>GitHub Actions Artifacts (Zipped evidence bundle)</li> </ol>"},{"location":"runbooks/rollback/","title":"Rollback Runbook","text":"<p>\u2190 Back to Runbooks</p> <p>When: Any deploy causes health degradation, elevated errors, or unexpected behavior Time budget: Complete within 10 minutes of decision to rollback</p>"},{"location":"runbooks/rollback/#decision-criteria","title":"Decision Criteria","text":"<p>Rollback immediately if any of: - Brain health endpoint returns <code>unhealthy</code> for &gt; 2 minutes - Error rate exceeds 1% (visible in Prometheus) - Circuit breaker trips unexpectedly - Drawdown exceeds 3% post-deploy</p>"},{"location":"runbooks/rollback/#procedure","title":"Procedure","text":"<pre><code># 1. Identify the last-known-good commit\ngit log --oneline -5\n# Note the commit SHA before the bad deploy\n\n# 2. Stop all application services (preserve infra)\ndocker compose -f docker-compose.prod.yml stop titan-brain titan-execution titan-scavenger titan-sentinel\n\n# 3. Checkout previous version\ngit checkout &lt;LAST_GOOD_SHA&gt;\n\n# 4. Rebuild\ndocker compose -f docker-compose.prod.yml build --no-cache titan-brain titan-execution titan-scavenger titan-sentinel\n\n# 5. Restart\ndocker compose -f docker-compose.prod.yml up -d titan-brain titan-execution titan-scavenger titan-sentinel\n\n# 6. Verify\ncurl -s localhost:3100/health | jq .\ncurl -s localhost:8081/health | jq .\ncurl -s localhost:3002/health | jq .\n</code></pre>"},{"location":"runbooks/rollback/#post-rollback","title":"Post-Rollback","text":"<ol> <li>Document the incident</li> <li>Create a hotfix branch from <code>main</code></li> <li>Schedule post-mortem within 24h</li> <li>Notify stakeholders of rollback</li> </ol>"},{"location":"setup/infrastructure/","title":"Titan Infrastructure Setup Guide","text":"<p>This guide provides comprehensive instructions for provisioning and configuring the infrastructure required for the Titan Trading System production deployment.</p>"},{"location":"setup/infrastructure/#overview","title":"Overview","text":"<p>The Titan Trading System requires a robust infrastructure foundation with specific minimum requirements to ensure reliable, high-frequency trading operations. This setup includes:</p> <ul> <li>VPS instance with minimum specifications (8GB RAM, 4 CPU cores)</li> <li>Base dependencies (Node.js v22+, Redis, PM2, Nginx)</li> <li>Security hardening (firewall, fail2ban, SSL certificates)</li> <li>System optimization for high-frequency trading</li> <li>Automated security updates</li> </ul>"},{"location":"setup/infrastructure/#prerequisites","title":"Prerequisites","text":"<ul> <li>Ubuntu 22.04 LTS server (recommended)</li> <li>Root or sudo access</li> <li>Domain name (optional, for SSL certificates)</li> <li>Email address (for SSL certificate registration)</li> </ul>"},{"location":"setup/infrastructure/#quick-start","title":"Quick Start","text":""},{"location":"setup/infrastructure/#1-basic-infrastructure-provisioning","title":"1. Basic Infrastructure Provisioning","text":"<pre><code># Clone the repository and navigate to scripts\ncd titan-production-deployment\nchmod +x scripts/provision-infrastructure.sh\n\n# Run basic provisioning\n./scripts/provision-infrastructure.sh\n\n# Or with SSL setup (recommended)\n./scripts/provision-infrastructure.sh -d yourdomain.com -e admin@yourdomain.com\n</code></pre>"},{"location":"setup/infrastructure/#2-validate-installation","title":"2. Validate Installation","text":"<p>Manually verify service status:</p> <pre><code>docker compose -f docker-compose.prod.yml ps\n</code></pre>"},{"location":"setup/infrastructure/#3-configure-environment","title":"3. Configure Environment","text":"<pre><code># Copy and customize environment configuration\ncp config/deployment/infrastructure.env.example config/deployment/infrastructure.env\nnano config/deployment/infrastructure.env\n</code></pre>"},{"location":"setup/infrastructure/#detailed-setup-instructions","title":"Detailed Setup Instructions","text":""},{"location":"setup/infrastructure/#system-requirements-validation","title":"System Requirements Validation","text":"<p>The infrastructure must meet these minimum requirements:</p> Component Minimum Requirement Recommended RAM 8GB 16GB+ CPU Cores 4 8+ Disk Space 50GB free 100GB+ SSD Network 100 Mbps 1 Gbps OS Ubuntu 22.04 LTS Ubuntu 22.04 LTS"},{"location":"setup/infrastructure/#dependencies-installation","title":"Dependencies Installation","text":""},{"location":"setup/infrastructure/#nodejs-v22","title":"Node.js v22+","text":"<ul> <li>Installed via NodeSource repository</li> <li>Includes npm package manager</li> <li>Global PM2 installation for process management</li> </ul>"},{"location":"setup/infrastructure/#redis","title":"Redis","text":"<ul> <li>Latest stable version</li> <li>Configured for production use</li> <li>Memory limit: 2GB with LRU eviction policy</li> <li>Bound to localhost (127.0.0.1) for security</li> </ul>"},{"location":"setup/infrastructure/#pm2-process-manager","title":"PM2 Process Manager","text":"<ul> <li>Global installation via npm</li> <li>Configured for automatic startup</li> <li>Process monitoring and auto-restart capabilities</li> </ul>"},{"location":"setup/infrastructure/#nginx-web-server","title":"Nginx Web Server","text":"<ul> <li>Latest stable version</li> <li>Configured as reverse proxy</li> <li>SSL/TLS termination support</li> <li>Gzip compression enabled</li> </ul>"},{"location":"setup/infrastructure/#security-configuration","title":"Security Configuration","text":""},{"location":"setup/infrastructure/#ufw-firewall","title":"UFW Firewall","text":"<pre><code># Default policies\nufw default deny incoming\nufw default allow outgoing\n\n# Allowed ports\nufw allow 22/tcp    # SSH\nufw allow 80/tcp    # HTTP\nufw allow 443/tcp   # HTTPS\n\n# Restricted ports\nufw allow from 127.0.0.1 to any port 6379  # Redis localhost only\n</code></pre>"},{"location":"setup/infrastructure/#fail2ban-protection","title":"fail2ban Protection","text":"<ul> <li>SSH brute force protection (3 attempts, 1-hour ban)</li> <li>Nginx authentication failure protection</li> <li>Custom jail configurations for trading system</li> </ul>"},{"location":"setup/infrastructure/#ssl-certificates","title":"SSL Certificates","text":"<ul> <li>Let's Encrypt certificates via Certbot</li> <li>Automatic renewal via systemd timer</li> <li>Strong cipher suites and protocols</li> </ul>"},{"location":"setup/infrastructure/#automatic-security-updates","title":"Automatic Security Updates","text":"<ul> <li>Unattended upgrades for security patches</li> <li>Configurable reboot policies</li> <li>Email notifications for critical updates</li> </ul>"},{"location":"setup/infrastructure/#system-optimization","title":"System Optimization","text":""},{"location":"setup/infrastructure/#file-descriptor-limits","title":"File Descriptor Limits","text":"<pre><code># /e../limits.conf\ntitan soft nofile 65536\ntitan hard nofile 65536\ntitan soft nproc 32768\ntitan hard nproc 32768\n</code></pre>"},{"location":"setup/infrastructure/#kernel-parameters","title":"Kernel Parameters","text":"<pre><code># /etc/sysctl.conf\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.ipv4.tcp_rmem = 4096 87380 16777216\nnet.ipv4.tcp_wmem = 4096 65536 16777216\nnet.core.netdev_max_backlog = 5000\nvm.swappiness = 10\n</code></pre>"},{"location":"setup/infrastructure/#configuration-files","title":"Configuration Files","text":""},{"location":"setup/infrastructure/#infrastructure-configuration","title":"Infrastructure Configuration","text":"<ul> <li><code>config/infrastructure.config.json</code> - Main infrastructure configuration</li> <li><code>config/deployment/infrastructure.env</code> - Environment-specific settings</li> </ul>"},{"location":"setup/infrastructure/#security-configuration_1","title":"Security Configuration","text":"<ul> <li><code>/etc/fail2ban/jail.local</code> - fail2ban jail configuration</li> <li><code>/etc/ufw/applications.d/titan</code> - UFW application profile</li> <li><code>/etc/nginx/sites-available/titan</code> - Nginx virtual host configuration</li> </ul>"},{"location":"setup/infrastructure/#validation-and-testing","title":"Validation and Testing","text":""},{"location":"setup/infrastructure/#infrastructure-validation","title":"Infrastructure Validation","text":"<p>Ensure all containers are running and healthy:</p> <pre><code>docker compose -f docker-compose.prod.yml ps\n</code></pre> <p>The output should show <code>healthy</code> status for core services (nats, redis, postgres).</p>"},{"location":"setup/infrastructure/#manual-validation-commands","title":"Manual Validation Commands","text":"<pre><code># Check system resources\nfree -h                    # Memory\nnproc                     # CPU cores\ndf -h                     # Disk space\n\n# Check services\nsystemctl status redis-server\nsystemctl status nginx\nsystemctl status fail2ban\n\n# Check network connectivity\nredis-cli ping            # Redis connectivity\ncurl -I http://localhost  # Nginx response\n\n# Check security\nsudo ufw status verbose   # Firewall rules\nsudo fail2ban-client status  # fail2ban status\n</code></pre>"},{"location":"setup/infrastructure/#troubleshooting","title":"Troubleshooting","text":""},{"location":"setup/infrastructure/#common-issues","title":"Common Issues","text":""},{"location":"setup/infrastructure/#insufficient-resources","title":"Insufficient Resources","text":"<pre><code># Check current usage\nhtop                      # Real-time system monitor\niotop                     # Disk I/O monitor\nnethogs                   # Network usage by process\n</code></pre>"},{"location":"setup/infrastructure/#service-startup-failures","title":"Service Startup Failures","text":"<pre><code># Check service logs\njournalctl -u redis-server -f\njournalctl -u nginx -f\njournalctl -u fail2ban -f\n\n# Check configuration syntax\nnginx -t                  # Nginx config test\nredis-server --test-memory 1024  # Redis memory test\n</code></pre>"},{"location":"setup/infrastructure/#network-connectivity-issues","title":"Network Connectivity Issues","text":"<pre><code># Check port bindings\nnetstat -tlnp | grep :80   # HTTP\nnetstat -tlnp | grep :443  # HTTPS\nnetstat -tlnp | grep :6379 # Redis\n\n# Test connectivity\ntelnet localhost 6379     # Redis\ncurl -v http://localhost  # HTTP\n</code></pre>"},{"location":"setup/infrastructure/#ssl-certificate-issues","title":"SSL Certificate Issues","text":"<pre><code># Check certificate status\ncertbot certificates\n\n# Test SSL configuration\nopenssl s_client -connect yourdomain.com:443\n\n# Renew certificates manually\ncertbot renew --dry-run\n</code></pre>"},{"location":"setup/infrastructure/#log-locations","title":"Log Locations","text":"Service Log Location System <code>/var/log/syslog</code> Nginx <code>/var/log/nginx/</code> Redis <code>/var/log/redis/</code> fail2ban <code>/var/log/fail2ban.log</code> UFW <code>/var/log/ufw.log</code> Certbot <code>/var/log/letsencrypt/</code>"},{"location":"setup/infrastructure/#security-best-practices","title":"Security Best Practices","text":""},{"location":"setup/infrastructure/#regular-maintenance","title":"Regular Maintenance","text":"<ul> <li>Update system packages monthly</li> <li>Review firewall rules quarterly</li> <li>Rotate SSL certificates (automatic)</li> <li>Monitor fail2ban logs weekly</li> <li>Audit user access monthly</li> </ul>"},{"location":"setup/infrastructure/#monitoring-recommendations","title":"Monitoring Recommendations","text":"<ul> <li>Set up log monitoring and alerting</li> <li>Monitor system resource usage</li> <li>Track failed authentication attempts</li> <li>Monitor SSL certificate expiration</li> <li>Set up uptime monitoring</li> </ul>"},{"location":"setup/infrastructure/#backup-considerations","title":"Backup Considerations","text":"<ul> <li>Regular configuration backups</li> <li>SSL certificate backups</li> <li>Database backups (Redis snapshots)</li> <li>Log file archival</li> <li>Disaster recovery testing</li> </ul>"},{"location":"setup/infrastructure/#next-steps","title":"Next Steps","text":"<p>After successful infrastructure provisioning:</p> <ol> <li>Deploy Titan Services</li> </ol> <pre><code>docker compose -f docker-compose.prod.yml up -d --build --remove-orphans\n</code></pre> <ol> <li>Verify Logs</li> </ol> <pre><code>docker compose -f docker-compose.prod.yml logs -f\n</code></pre>"},{"location":"setup/infrastructure/#support-and-documentation","title":"Support and Documentation","text":"<p>See Production Deployment</p> <ul> <li>Security Guide</li> <li>Monitoring</li> <li>Troubleshooting Guide</li> </ul> <p>For additional support, refer to the operational runbooks in <code>docs/operations/runbooks/</code>.</p>"},{"location":"setup/redis-security/","title":"Redis Security Guide for Titan Trading System","text":""},{"location":"setup/redis-security/#overview","title":"Overview","text":"<p>This guide provides comprehensive instructions for securing Redis in the Titan trading system production environment. Redis stores critical trading data and system state, making its security paramount.</p>"},{"location":"setup/redis-security/#security-requirements","title":"Security Requirements","text":""},{"location":"setup/redis-security/#authentication","title":"Authentication","text":"<ul> <li>Password Protection: Redis must be configured with a strong password</li> <li>Password Rotation: Passwords should be rotated every 90 days</li> <li>Environment Variables: Passwords must be stored in environment variables, never in code</li> </ul>"},{"location":"setup/redis-security/#network-security","title":"Network Security","text":"<ul> <li>Bind Address: Redis should only bind to localhost (127.0.0.1)</li> <li>Protected Mode: Always enable protected mode</li> <li>Firewall: Block Redis port (6379) from external access</li> </ul>"},{"location":"setup/redis-security/#command-security","title":"Command Security","text":"<ul> <li>Dangerous Commands: Disable or rename dangerous commands</li> <li>Command Renaming: Rename administrative commands to prevent unauthorized access</li> </ul>"},{"location":"setup/redis-security/#quick-setup","title":"Quick Setup","text":""},{"location":"setup/redis-security/#automatic-setup-recommended","title":"Automatic Setup (Recommended)","text":"<pre><code># Run the automated setup script\nsudo ./scripts/setup-redis-secure.sh\n\n# This will:\n# 1. Generate a secure password\n# 2. Configure Redis with secure settings\n# 3. Save password to .env file\n# 4. Restart Redis service\n# 5. Test the configuration\n</code></pre>"},{"location":"setup/redis-security/#manual-setup","title":"Manual Setup","text":"<p>If you prefer manual configuration:</p> <pre><code># 1. Generate a secure password\nREDIS_PASSWORD=$(openssl rand -base64 32 | tr -d \"=+/\" | cut -c1-32)\n\n# 2. Configure Redis\nsudo ./scripts/setup-redis-secure.sh --password \"$REDIS_PASSWORD\"\n\n# 3. Test the configuration\nsudo ./scripts/setup-redis-secure.sh --test-only --password \"$REDIS_PASSWORD\"\n</code></pre>"},{"location":"setup/redis-security/#configuration-details","title":"Configuration Details","text":""},{"location":"setup/redis-security/#redis-configuration-file","title":"Redis Configuration File","text":"<p>The secure Redis configuration (<code>config/redis-secure.conf</code>) includes:</p> <pre><code># Authentication\nrequirepass ${REDIS_PASSWORD}\n\n# Network Security\nbind 127.0.0.1 ::1\nprotected-mode yes\nport 6379\n\n# Disable Dangerous Commands\nrename-command FLUSHDB \"\"\nrename-command FLUSHALL \"\"\nrename-command KEYS \"\"\nrename-command CONFIG \"CONFIG_b840fc02d524045429941cc15f59e41cb7be6c52\"\nrename-command SHUTDOWN \"SHUTDOWN_b840fc02d524045429941cc15f59e41cb7be6c52\"\nrename-command DEBUG \"\"\nrename-command EVAL \"\"\n\n# Memory and Performance\nmaxmemory 2gb\nmaxmemory-policy allkeys-lru\n\n# Persistence\nsave 900 1\nsave 300 10\nsave 60 10000\nappendonly yes\n</code></pre>"},{"location":"setup/redis-security/#environment-variables","title":"Environment Variables","text":"<p>Store Redis credentials in <code>.env</code> file:</p> <pre><code># Redis Configuration\nREDIS_PASSWORD=your_secure_password_here\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_DB=0\n</code></pre> <p>Important: Never commit the <code>.env</code> file to version control!</p>"},{"location":"setup/redis-security/#application-integration","title":"Application Integration","text":""},{"location":"setup/redis-security/#nodejs-connection","title":"Node.js Connection","text":"<pre><code>const redis = require('redis');\n\nconst client = redis.createClient({\n  host: process.env.REDIS_HOST || 'localhost',\n  port: process.env.REDIS_PORT || 6379,\n  password: process.env.REDIS_PASSWORD,\n  db: process.env.REDIS_DB || 0,\n  retry_strategy: (options) =&gt; {\n    if (options.error &amp;&amp; options.error.code === 'ECONNREFUSED') {\n      return new Error('Redis server connection refused');\n    }\n    if (options.total_retry_time &gt; 1000 * 60 * 60) {\n      return new Error('Redis retry time exhausted');\n    }\n    if (options.attempt &gt; 10) {\n      return undefined;\n    }\n    return Math.min(options.attempt * 100, 3000);\n  }\n});\n\nclient.on('error', (err) =&gt; {\n  console.error('Redis Client Error:', err);\n});\n\nclient.on('connect', () =&gt; {\n  console.log('Connected to Redis');\n});\n</code></pre>"},{"location":"setup/redis-security/#connection-string-format","title":"Connection String Format","text":"<pre><code>redis://localhost:6379\nredis://:password@localhost:6379\nredis://:password@localhost:6379/0\n</code></pre>"},{"location":"setup/redis-security/#security-best-practices","title":"Security Best Practices","text":""},{"location":"setup/redis-security/#password-management","title":"Password Management","text":"<ol> <li>Strong Passwords: Use passwords with at least 32 characters</li> <li>Random Generation: Use cryptographically secure random generation</li> <li>Regular Rotation: Rotate passwords every 90 days</li> <li>Secure Storage: Store passwords in environment variables or secure vaults</li> </ol>"},{"location":"setup/redis-security/#network-security_1","title":"Network Security","text":"<ol> <li>Localhost Only: Bind Redis to localhost only</li> <li>Firewall Rules: Block external access to Redis port</li> <li>VPN Access: Use VPN for remote administration</li> <li>SSL/TLS: Consider Redis with SSL/TLS for additional security</li> </ol>"},{"location":"setup/redis-security/#monitoring-and-auditing","title":"Monitoring and Auditing","text":"<ol> <li>Connection Monitoring: Monitor Redis connections</li> <li>Command Auditing: Log administrative commands</li> <li>Performance Monitoring: Monitor Redis performance metrics</li> <li>Security Alerts: Set up alerts for authentication failures</li> </ol>"},{"location":"setup/redis-security/#disaster-recovery-integration","title":"Disaster Recovery Integration","text":""},{"location":"setup/redis-security/#backup-security","title":"Backup Security","text":"<pre><code># Secure Redis backup\nredis-cli -a \"$REDIS_PASSWORD\" --rdb /backups/redis/dump-$(date +%Y%m%d).rdb\n\n# Encrypt backup\ngpg --symmetric --cipher-algo AES256 /backups/redis/dump-$(date +%Y%m%d).rdb\n</code></pre>"},{"location":"setup/redis-security/#recovery-with-authentication","title":"Recovery with Authentication","text":"<p>The disaster recovery system automatically handles Redis authentication:</p> <pre><code># Recovery steps include authentication\n{\n  \"id\": \"restore-redis-data\",\n  \"command\": \"redis-cli -a ${REDIS_PASSWORD} --rdb /var/lib/redis/dump.rdb\",\n  \"environment\": {\n    \"REDIS_PASSWORD\": \"${REDIS_PASSWORD}\"\n  }\n}\n</code></pre>"},{"location":"setup/redis-security/#testing-and-validation","title":"Testing and Validation","text":""},{"location":"setup/redis-security/#connection-testing","title":"Connection Testing","text":"<pre><code># Test Redis connection\nredis-cli -a \"$REDIS_PASSWORD\" ping\n\n# Test authentication requirement\nredis-cli ping  # Should return NOAUTH error\n\n# Test basic operations\nredis-cli -a \"$REDIS_PASSWORD\" set test_key \"test_value\"\nredis-cli -a \"$REDIS_PASSWORD\" get test_key\nredis-cli -a \"$REDIS_PASSWORD\" del test_key\n</code></pre>"},{"location":"setup/redis-security/#security-validation","title":"Security Validation","text":"<pre><code># Check Redis configuration\nredis-cli -a \"$REDIS_PASSWORD\" CONFIG GET requirepass\nredis-cli -a \"$REDIS_PASSWORD\" CONFIG GET bind\n\n# Verify dangerous commands are disabled\nredis-cli -a \"$REDIS_PASSWORD\" FLUSHDB  # Should return error\nredis-cli -a \"$REDIS_PASSWORD\" KEYS \"*\"  # Should return error\n</code></pre>"},{"location":"setup/redis-security/#performance-testing","title":"Performance Testing","text":"<pre><code># Redis benchmark with authentication\nredis-benchmark -a \"$REDIS_PASSWORD\" -n 10000 -c 10\n\n# Memory usage check\nredis-cli -a \"$REDIS_PASSWORD\" INFO memory\n</code></pre>"},{"location":"setup/redis-security/#troubleshooting","title":"Troubleshooting","text":""},{"location":"setup/redis-security/#common-issues","title":"Common Issues","text":"<ol> <li>Authentication Failures</li> </ol> <pre><code># Check password in .env file\ngrep REDIS_PASSWORD .env\n\n# Test with correct password\nredis-cli -a \"$(grep REDIS_PASSWORD .env | cut -d'=' -f2)\" ping\n</code></pre> <ol> <li>Connection Refused</li> </ol> <pre><code># Check if Redis is running\nsudo systemctl status redis\n\n# Check Redis logs\nsudo tail -f /var/log/redis/redis-server.log\n</code></pre> <ol> <li>Permission Denied</li> </ol> <pre><code># Check Redis configuration file permissions\nls -la /etc/redis/redis.conf\n\n# Fix permissions if needed\nsudo chown redis:redis /etc/redis/redis.conf\nsudo chmod 640 /etc/redis/redis.conf\n</code></pre>"},{"location":"setup/redis-security/#error-messages","title":"Error Messages","text":"Error Cause Solution <code>NOAUTH Authentication required</code> No password provided Use <code>-a password</code> option <code>ERR invalid password</code> Wrong password Check password in .env file <code>Could not connect to Redis</code> Redis not running Start Redis service <code>Connection refused</code> Wrong host/port Check connection parameters"},{"location":"setup/redis-security/#security-checklist","title":"Security Checklist","text":"<ul> <li>[ ] Redis password configured and strong (32+ characters)</li> <li>[ ] Password stored in environment variables</li> <li>[ ] Redis bound to localhost only</li> <li>[ ] Protected mode enabled</li> <li>[ ] Dangerous commands disabled or renamed</li> <li>[ ] Firewall rules configured</li> <li>[ ] Regular password rotation scheduled</li> <li>[ ] Backup encryption configured</li> <li>[ ] Monitoring and alerting set up</li> <li>[ ] Security testing performed</li> </ul>"},{"location":"setup/redis-security/#password-rotation-procedure","title":"Password Rotation Procedure","text":""},{"location":"setup/redis-security/#monthly-password-rotation","title":"Monthly Password Rotation","text":"<ol> <li>Generate New Password</li> </ol> <pre><code>NEW_PASSWORD=$(openssl rand -base64 32 | tr -d \"=+/\" | cut -c1-32)\n</code></pre> <ol> <li>Update Configuration</li> </ol> <pre><code>sudo ./scripts/setup-redis-secure.sh --password \"$NEW_PASSWORD\"\n</code></pre> <ol> <li>Update Applications</li> </ol> <pre><code># Update .env file\nsed -i \"s/REDIS_PASSWORD=.*/REDIS_PASSWORD=$NEW_PASSWORD/\" .env\n\n# Restart applications\npm2 restart all\n</code></pre> <ol> <li>Verify Connectivity</li> </ol> <pre><code>redis-cli -a \"$NEW_PASSWORD\" ping\n</code></pre>"},{"location":"setup/redis-security/#compliance-and-auditing","title":"Compliance and Auditing","text":""},{"location":"setup/redis-security/#security-audit-log","title":"Security Audit Log","text":"<p>Keep a record of security changes:</p> <pre><code># Log password rotation\necho \"$(date): Redis password rotated by $(whoami)\" &gt;&gt; /var/log/redis-security.log\n\n# Log configuration changes\necho \"$(date): Redis configuration updated by $(whoami)\" &gt;&gt; /var/log/redis-security.log\n</code></pre>"},{"location":"setup/redis-security/#compliance-requirements","title":"Compliance Requirements","text":"<ul> <li>PCI DSS: If handling payment data, ensure Redis meets PCI requirements</li> <li>SOX: For financial systems, maintain audit trails</li> <li>GDPR: If storing personal data, ensure proper encryption and access controls</li> </ul>"},{"location":"setup/redis-security/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"setup/redis-security/#password-reset","title":"Password Reset","text":"<p>If Redis password is lost or compromised:</p> <ol> <li>Stop Redis</li> </ol> <pre><code>sudo systemctl stop redis\n</code></pre> <ol> <li>Temporarily Disable Auth</li> </ol> <pre><code>sudo sed -i 's/requirepass/#requirepass/' /etc/redis/redis.conf\n</code></pre> <ol> <li>Start Redis</li> </ol> <pre><code>sudo systemctl start redis\n</code></pre> <ol> <li>Set New Password</li> </ol> <pre><code>redis-cli CONFIG SET requirepass \"new_secure_password\"\n</code></pre> <ol> <li>Update Configuration</li> </ol> <pre><code>sudo ./scripts/setup-redis-secure.sh --password \"new_secure_password\"\n</code></pre>"},{"location":"setup/redis-security/#security-incident-response","title":"Security Incident Response","text":"<ol> <li>Immediate Actions</li> <li>Change Redis password immediately</li> <li>Check Redis logs for unauthorized access</li> <li>Review application logs for anomalies</li> <li> <p>Notify security team</p> </li> <li> <p>Investigation</p> </li> <li>Analyze Redis command history</li> <li>Check network connections</li> <li>Review system access logs</li> <li> <p>Document findings</p> </li> <li> <p>Recovery</p> </li> <li>Restore from clean backup if needed</li> <li>Update security configurations</li> <li>Implement additional monitoring</li> <li>Update incident response procedures</li> </ol>"},{"location":"setup/redis-security/#additional-resources","title":"Additional Resources","text":"<ul> <li>Redis Security Documentation</li> <li>Redis Configuration Guide</li> <li>Redis Best Practices</li> <li>Titan System Architecture</li> </ul>"},{"location":"specs/tla/","title":"TLA+ Formal Specifications","text":"<p>Formal verification specifications for the Titan Trading System using TLA+ (Temporal Logic of Actions).</p>"},{"location":"specs/tla/#specifications","title":"Specifications","text":""},{"location":"specs/tla/#orderlifecycletla","title":"<code>OrderLifecycle.tla</code>","text":"<p>Models the order state machine with safety properties:</p> <ul> <li>No Double-Spend: Orders cannot be filled beyond their maximum amount</li> <li>Halt Enforcement: No order processing during global halt</li> <li>Terminal State Finality: Terminal states (FILLED, CANCELLED, REJECTED, EXPIRED) cannot transition</li> <li>Valid Transitions Only: State machine follows defined transition graph</li> </ul> <p>State Machine: <pre><code>PENDING \u2192 OPEN \u2192 PARTIALLY_FILLED \u2192 FILLED\n    \u2193       \u2193           \u2193\n REJECTED  EXPIRED    CANCELLED\n</code></pre></p>"},{"location":"specs/tla/#riskpolicytla","title":"<code>RiskPolicy.tla</code>","text":"<p>Models risk policy enforcement with breaker conditions:</p> <ul> <li>Position Limits: Positions never exceed capital * MaxPositionPct</li> <li>Leverage Limits: Leverage never exceeds MaxLeverage</li> <li>Drawdown Breaker: Circuit breaker trips when drawdown &gt; MaxDrawdownPct</li> <li>Daily Loss Breaker: Circuit breaker trips when daily loss &gt; MaxDailyLossPct</li> </ul> <p>Breaker Hierarchy: <pre><code>DRAWDOWN &gt; DAILY_LOSS &gt; POSITION_LIMIT &gt; LEVERAGE\n</code></pre></p>"},{"location":"specs/tla/#running-model-checker","title":"Running Model Checker","text":"<p>Install TLA+ Toolbox or use command-line TLC:</p> <pre><code># Check OrderLifecycle with small model\ntlc OrderLifecycle.tla -config order.cfg\n\n# Check RiskPolicy with small model\ntlc RiskPolicy.tla -config risk.cfg\n</code></pre>"},{"location":"specs/tla/#model-configurations","title":"Model Configurations","text":"<p>Create <code>order.cfg</code>: <pre><code>CONSTANTS\n    Orders = {o1, o2, o3}\n    MaxFillAmount = 100\n    MaxHaltTime = 10\n\nSPECIFICATION Spec\n\nINVARIANTS\n    TypeInvariant\n    NoDoubleFill\n\nPROPERTIES\n    TerminalStateIsFinal\n</code></pre></p> <p>Create <code>risk.cfg</code>: <pre><code>CONSTANTS\n    MaxCapital = 10000\n    MaxPositionPct = 50\n    MaxDrawdownPct = 20\n    MaxDailyLossPct = 10\n    MaxLeverage = 5\n\nSPECIFICATION Spec\n\nINVARIANTS\n    TypeInvariant\n    SafetyInvariant\n    DrawdownBreakerCorrect\n    DailyLossBreakerCorrect\n</code></pre></p>"},{"location":"specs/tla/#ci-integration","title":"CI Integration","text":"<p>The specifications can be verified in CI using:</p> <pre><code># .github/workflows/tla-verify.yml\nname: TLA+ Verification\non: [push, pull_request]\njobs:\n  verify:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: docker://toolbox/tla:latest\n        with:\n          args: tlc -workers auto docs/specs/tla/OrderLifecycle.tla\n</code></pre>"},{"location":"specs/tla/#related-code","title":"Related Code","text":"Spec Implementation OrderLifecycle <code>titan-execution-rs/src/order_manager.rs</code>, <code>titan-execution-rs/src/engine/state_machine.rs</code> RiskPolicy <code>titan-brain/src/features/Risk/RiskGuardian.ts</code>, <code>@titan/shared/src/schemas/RiskPolicy.ts</code>"},{"location":"specs/tla/#references","title":"References","text":"<ul> <li>TLA+ Home</li> <li>Learn TLA+</li> <li>Amazon's Use of TLA+</li> </ul>"}]}